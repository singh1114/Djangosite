webpackJsonp([0],{1642:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _assign2=__webpack_require__(34);var _assign3=_interopRequireDefault(_assign2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _card=__webpack_require__(89);var _card2=_interopRequireDefault(_card);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"CompactCard",render:function render(){var props=(0,_assign3.default)({},this.props,{className:(0,_classnames2.default)(this.props.className,"is-compact")});return _react2.default.createElement(_card2.default,props,this.props.children)}});module.exports=exports["default"]},1643:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.recordTracksRailcarInteract=exports.recordTracksRailcarRender=undefined;var _set=__webpack_require__(748);var _set2=_interopRequireDefault(_set);var _assign=__webpack_require__(5);var _assign2=_interopRequireDefault(_assign);exports.recordAction=recordAction;exports.recordGaEvent=recordGaEvent;exports.recordPermalinkClick=recordPermalinkClick;exports.recordTrack=recordTrack;exports.recordTracksRailcar=recordTracksRailcar;exports.recordTrackForPost=recordTrackForPost;exports.pageViewForPost=pageViewForPost;exports.recordFollow=recordFollow;exports.recordUnfollow=recordUnfollow;var _assign3=__webpack_require__(34);var _assign4=_interopRequireDefault(_assign3);var _debug=__webpack_require__(3);var _debug2=_interopRequireDefault(_debug);var _partial=__webpack_require__(286);var _partial2=_interopRequireDefault(_partial);var _analytics=__webpack_require__(20);var _readerFeedSubscriptions=__webpack_require__(1768);var _readerFeedSubscriptions2=_interopRequireDefault(_readerFeedSubscriptions);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var debug=(0,_debug2.default)("calypso:reader:stats");function recordAction(action){debug("reader action",action);_analytics.mc.bumpStat("reader_actions",action)}function recordGaEvent(action,label,value){debug.apply(undefined,["reader ga event"].concat(Array.prototype.slice.call(arguments)));_analytics.ga.recordEvent("Reader",action,label,value)}function recordPermalinkClick(where){_analytics.mc.bumpStat({reader_actions:"visited_post_permalink",reader_permalink_source:where});recordTrack("calypso_reader_permalink_click",{source:where})}function getLocation(){if(typeof window==="undefined"){return"unknown"}var path=window.location.pathname;if(path==="/"){return"following"}if(path.indexOf("/tag/")===0){return"topic_page"}if(path.match(/^\/read\/(blogs|feeds)\/([0-9]+)\/posts\/([0-9]+)$/i)){return"single_post"}if(path.match(/^\/read\/(blogs|feeds)\/([0-9]+)$/i)){return"blog_page"}if(path.indexOf("/read/list/")===0){return"list"}if(path.indexOf("/activities/likes")===0){return"postlike"}if(path.indexOf("/recommendations/mine")===0){return"recommended_foryou"}if(path.indexOf("/recommendations/start")===0){return"recommended_cold_start"}if(path.indexOf("/recommendations")===0){return"recommended_topics"}if(path.indexOf("/following/edit")===0){return"following_edit"}if(path.indexOf("/discover")===0){return"discover"}if(path.indexOf("/read/recommendations/posts")===0){return"recommended_posts"}if(path.indexOf("/read/search")===0){return"search"}return"unknown"}function recordTrack(eventName,eventProperties){debug.apply(undefined,["reader track"].concat(Array.prototype.slice.call(arguments)));var subCount=_readerFeedSubscriptions2.default.getTotalSubscriptions();var location=getLocation();eventProperties=(0,_assign2.default)({ui_algo:location},eventProperties);if(subCount!=null){eventProperties=(0,_assign2.default)({subscription_count:subCount},eventProperties)}if(false){if("blog_id"in eventProperties&&"post_id"in eventProperties&&!("is_jetpack"in eventProperties)){console.warn("consider using recordTrackForPost...",eventName,eventProperties)}}_analytics.tracks.recordEvent(eventName,eventProperties)}var tracksRailcarEventWhitelist=new _set2.default;tracksRailcarEventWhitelist.add("calypso_reader_related_post_from_same_site_clicked").add("calypso_reader_related_post_from_other_site_clicked").add("calypso_reader_related_post_site_clicked").add("calypso_reader_article_liked").add("calypso_reader_article_commented_on").add("calypso_reader_article_opened").add("calypso_reader_startcard_clicked").add("calypso_reader_searchcard_clicked").add("calypso_reader_author_link_clicked");function recordTracksRailcar(action,eventName,railcar){recordTrack(action,(0,_assign2.default)({action:eventName.replace("calypso_reader_","")},railcar))}var recordTracksRailcarRender=exports.recordTracksRailcarRender=(0,_partial2.default)(recordTracksRailcar,"calypso_traintracks_render");var recordTracksRailcarInteract=exports.recordTracksRailcarInteract=(0,_partial2.default)(recordTracksRailcar,"calypso_traintracks_interact");function recordTrackForPost(eventName){var post=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var additionalProps=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};recordTrack(eventName,(0,_assign4.default)({blog_id:!post.is_external&&post.site_ID>0?post.site_ID:undefined,post_id:!post.is_external&&post.ID>0?post.ID:undefined,feed_id:post.feed_ID>0?post.feed_ID:undefined,feed_item_id:post.feed_item_ID>0?post.feed_item_ID:undefined,is_jetpack:post.is_jetpack},additionalProps));if(post.railcar&&tracksRailcarEventWhitelist.has(eventName)){recordTracksRailcarInteract(eventName,post.railcar)}else if(false){console.warn("Consider whitelisting reader track",eventName)}}function pageViewForPost(blogId,blogUrl,postId,isPrivate){var params={ref:"http://wordpress.com/",reader:1,host:blogUrl.replace(/.*?:\/\//g,""),blog:blogId,post:postId};if(isPrivate){params.priv=1}debug("reader page view for post",params);_analytics.mc.bumpStatWithPageView(params)}function recordFollow(url,railcar){var source=getLocation();_analytics.mc.bumpStat("reader_follows",source);recordAction("followed_blog");recordGaEvent("Clicked Follow Blog",source);recordTrack("calypso_reader_site_followed",{url:url,source:source});if(railcar){recordTracksRailcarInteract("site_followed",railcar)}}function recordUnfollow(url,railcar){var source=getLocation();_analytics.mc.bumpStat("reader_unfollows",source);recordAction("unfollowed_blog");recordGaEvent("Clicked Unfollow Blog",source);recordTrack("calypso_reader_site_unfollowed",{url:url,source:source});if(railcar){recordTracksRailcarInteract("site_unfollowed",railcar)}}},1644:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _compact=__webpack_require__(1642);var _compact2=_interopRequireDefault(_compact);var _count=__webpack_require__(730);var _count2=_interopRequireDefault(_count);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"section-header",getDefaultProps:function getDefaultProps(){return{label:"",href:null}},render:function render(){var classes=(0,_classnames2.default)(this.props.className,"section-header");return _react2.default.createElement(_compact2.default,{className:classes,href:this.props.href},_react2.default.createElement("div",{className:"section-header__label"},_react2.default.createElement("span",null,this.props.label),"number"===typeof this.props.count&&_react2.default.createElement(_count2.default,{count:this.props.count})),_react2.default.createElement("div",{className:"section-header__actions"},this.props.children))}});module.exports=exports["default"]},1646:function(module,exports,__webpack_require__){"use strict";var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}module.exports=_react2.default.createClass({displayName:"FormInputValidation",propTypes:{isError:_react2.default.PropTypes.bool,text:_react2.default.PropTypes.string,icon:_react2.default.PropTypes.string},getDefaultProps:function getDefaultProps(){return{isError:false}},render:function render(){var classes=(0,_classnames2.default)({"form-input-validation":true,"is-error":this.props.isError});var icon=this.props.isError?"notice-outline":"checkmark";return _react2.default.createElement("div",{className:classes},_react2.default.createElement("span",null,_react2.default.createElement(_gridicon2.default,{size:24,icon:this.props.icon?this.props.icon:icon})," ",this.props.text))}})},1649:function(module,exports,__webpack_require__){"use strict";var _includes=__webpack_require__(30);var _includes2=_interopRequireDefault(_includes);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var url=__webpack_require__(70),i18n=__webpack_require__(11),moment=__webpack_require__(447);var postNormalizer=__webpack_require__(2641),sites=__webpack_require__(53)();var utils={getEditURL:function getEditURL(post,site){var basePath="";if(!(0,_includes2.default)(["post","page"],post.type)){basePath="/edit"}return basePath+"/"+post.type+"/"+site.slug+"/"+post.ID},getPreviewURL:function getPreviewURL(post){var parsed,site,previewUrl;if(!post||!post.URL||post.status==="trash"){return""}if(post.preview_URL){previewUrl=post.preview_URL}else if(post.status==="publish"){previewUrl=post.URL}else{parsed=url.parse(post.URL,true);parsed.query.preview="true";delete parsed.search;previewUrl=url.format(parsed)}if(post.site_ID){site=sites.getSite(post.site_ID);if(site.options.is_mapped_domain){previewUrl=previewUrl.replace(site.URL,site.options.unmapped_url)}if(site.options&&site.options.frame_nonce){parsed=url.parse(previewUrl,true);parsed.query["frame-nonce"]=site.options.frame_nonce;delete parsed.search;previewUrl=url.format(parsed)}}return previewUrl},userCan:function userCan(capability,post){var hasCap=post.capabilities&&post.capabilities[capability];if(capability==="edit_post"){return hasCap&&post.status!=="trash"}return hasCap},isPublished:function isPublished(post){return post&&(post.status==="publish"||post.status==="private"||this.isBackDatedPublished(post))},isPrivate:function isPrivate(post){return post&&"private"===post.status},isPending:function isPending(post){return post&&"pending"===post.status},getEditedTime:function getEditedTime(post){if(!post){return}if(post.status==="publish"||post.status==="future"){return post.date}return post.modified},isBackDatedPublished:function isBackDatedPublished(post){if(!post||post.status!=="future"){return false}return moment(post.date).isBefore(moment())},isFutureDated:function isFutureDated(post){if(!post){return false}var oneMinute=1e3*60;return post&&+new Date+oneMinute<+new Date(post.date)},isBackDated:function isBackDated(post){if(!post||!post.date||!post.modified){return false}return moment(post.date).isBefore(moment(post.modified))},isPage:function isPage(post){if(!post){return false}return post&&"page"===post.type},normalizeSync:function normalizeSync(post,callback){var imageWidth=653;postNormalizer(post,[postNormalizer.decodeEntities,postNormalizer.stripHTML,postNormalizer.safeImageProperties(imageWidth),postNormalizer.firstPassCanonicalImage,postNormalizer.withContentDOM([postNormalizer.content.removeStyles,postNormalizer.content.safeContentImages(imageWidth)])],callback)},getVisibility:function getVisibility(post){if(!post){return}if(post.password){return"password"}if("private"===post.status){return"private"}return"public"},normalizeAsync:function normalizeAsync(post,callback){postNormalizer(post,[postNormalizer.keepValidImages(72,72)],callback)},getPermalinkBasePath:function getPermalinkBasePath(post){if(!post){return}var path=post.URL;if(!this.isPublished(post)&&post.other_URLs&&post.other_URLs.permalink_URL){path=post.other_URLs.permalink_URL}return this.removeSlug(path)},getPagePath:function getPagePath(post){if(!post){return}if(!this.isPublished(post)){return this.getPermalinkBasePath(post)}return this.removeSlug(post.URL)},removeSlug:function removeSlug(path){if(!path){return}var pathParts=path.slice(0,-1).split("/");pathParts[pathParts.length-1]="";return pathParts.join("/")},getFeaturedImageId:function getFeaturedImageId(post){if(!post){return}if("featured_image"in post&&!/^https?:\/\//.test(post.featured_image)){return post.featured_image}if(post.post_thumbnail){return post.post_thumbnail.ID}},getOffsetDate:function getOffsetDate(date,tz){if(!tz){return i18n.moment(date)}return i18n.moment(moment.tz(date,tz))}};module.exports=utils},1650:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _card=__webpack_require__(89);var _card2=_interopRequireDefault(_card);var _back=__webpack_require__(2519);var _back2=_interopRequireDefault(_back);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var HeaderCake=function(_Component){(0,_inherits3.default)(HeaderCake,_Component);function HeaderCake(){(0,_classCallCheck3.default)(this,HeaderCake);return(0,_possibleConstructorReturn3.default)(this,(HeaderCake.__proto__||(0,_getPrototypeOf2.default)(HeaderCake)).apply(this,arguments))}(0,_createClass3.default)(HeaderCake,[{key:"render",value:function render(){var _props=this.props;var backText=_props.backText;var backHref=_props.backHref;var classes=(0,_classnames2.default)("header-cake",this.props.className,{"is-compact":this.props.isCompact});return _react2.default.createElement(_card2.default,{className:classes},_react2.default.createElement(_back2.default,{text:backText,href:backHref,onClick:this.props.onClick}),_react2.default.createElement("div",{className:"header-cake__title",onClick:this.props.onTitleClick},this.props.children),_react2.default.createElement(_back2.default,{text:backText,href:backHref,spacer:true}))}}]);return HeaderCake}(_react.Component);exports.default=HeaderCake;HeaderCake.displayName="HeaderCake";HeaderCake.propTypes={onClick:_react.PropTypes.func,onTitleClick:_react.PropTypes.func,backText:_react.PropTypes.string,backHref:_react.PropTypes.string};HeaderCake.defaultProps={isCompact:false};module.exports=exports["default"]},1652:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);var _omit2=__webpack_require__(18);var _omit3=_interopRequireDefault(_omit2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var handlerMouseOver=function handlerMouseOver(event){event.target.focus()};var PopoverItem=function PopoverItem(props){var focusOnHover=props.focusOnHover;var className=props.className;var href=props.href;var icon=props.icon;var children=props.children;var Component=href?"a":"button";return _react2.default.createElement(Component,(0,_extends3.default)({role:"menuitem",onMouseOver:focusOnHover?handlerMouseOver:null,tabIndex:"-1"},(0,_omit3.default)(props,"icon","focusOnHover"),{className:(0,_classnames2.default)("popover__menu-item",className)}),icon&&_react2.default.createElement(_gridicon2.default,{icon:icon,size:18}),children)};PopoverItem.displayName="PopoverMenuItem";PopoverItem.propTypes={href:_react.PropTypes.string,className:_react.PropTypes.string,icon:_react.PropTypes.string,focusOnHover:_react.PropTypes.bool,children:_react.PropTypes.node};PopoverItem.defaultProps={focusOnHover:true};exports.default=PopoverItem;module.exports=exports["default"]},1654:function(module,exports,__webpack_require__){"use strict";var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var React=__webpack_require__(1),classnames=__webpack_require__(10),omit=__webpack_require__(18);module.exports=React.createClass({displayName:"FormInputCheckbox",render:function render(){var otherProps=omit(this.props,["className","type"]);return React.createElement("input",(0,_extends3.default)({},otherProps,{type:"checkbox",className:classnames(this.props.className,"form-checkbox")}))}})},1656:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1);var SidebarNavigation=__webpack_require__(1762),AllSitesIcon=__webpack_require__(821),SiteIcon=__webpack_require__(281),sites=__webpack_require__(53)();module.exports=React.createClass({displayName:"SidebarNavigation",render:function render(){var site=sites.getSelectedSite(),currentSiteTitle=site.title,allSitesClass;if(!site){currentSiteTitle=this.translate("All Sites");allSitesClass="all-sites"}return React.createElement(SidebarNavigation,{linkClassName:allSitesClass,sectionName:"site",sectionTitle:currentSiteTitle},site?React.createElement(SiteIcon,{site:site,size:30}):React.createElement(AllSitesIcon,{sites:sites.get()}))}})},1660:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1),PureRenderMixin=__webpack_require__(111),classNames=__webpack_require__(10);var Count=__webpack_require__(730);var NavItem=React.createClass({displayName:"NavItem",mixins:[PureRenderMixin],propTypes:{itemType:React.PropTypes.string,path:React.PropTypes.string,selected:React.PropTypes.bool,tabIndex:React.PropTypes.number,onClick:React.PropTypes.func,isExternalLink:React.PropTypes.bool,disabled:React.PropTypes.bool,count:React.PropTypes.number,className:React.PropTypes.string},render:function render(){var itemClassPrefix=this.props.itemType?this.props.itemType:"tab",itemClassName,target,onClick,itemClasses={"is-selected":this.props.selected,"is-external":this.props.isExternalLink};itemClasses["section-nav-"+itemClassPrefix]=true;itemClassName=classNames(this.props.className,itemClasses);if(this.props.isExternalLink){target="_blank"}if(!this.props.disabled){onClick=this.props.onClick}return React.createElement("li",{className:itemClassName},React.createElement("a",{href:this.props.path,target:target,className:"section-nav-"+itemClassPrefix+"__link",onTouchTap:onClick,tabIndex:this.props.tabIndex||0,"aria-selected":this.props.selected,disabled:this.props.disabled,role:"menuitem",rel:this.props.isExternalLink?"external":null},React.createElement("span",{className:"section-nav-"+itemClassPrefix+"__text"},this.props.children,"number"===typeof this.props.count&&React.createElement(Count,{count:this.props.count}))))}});module.exports=NavItem},1661:function(module,exports,__webpack_require__){"use strict";var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ReactDom=__webpack_require__(44),React=__webpack_require__(1),debounce=__webpack_require__(278),classNames=__webpack_require__(10);var SelectDropdown=__webpack_require__(1761),DropdownItem=__webpack_require__(1809),viewport=__webpack_require__(92);var MOBILE_PANEL_THRESHOLD=480;var NavTabs=React.createClass({displayName:"NavTabs",propTypes:{selectedText:React.PropTypes.string,selectedCount:React.PropTypes.number,label:React.PropTypes.string,hasSiblingControls:React.PropTypes.bool},getDefaultProps:function getDefaultProps(){return{hasSiblingControls:false}},getInitialState:function getInitialState(){return{isDropdown:false}},componentDidMount:function componentDidMount(){this.setDropdown();this.debouncedAfterResize=debounce(this.setDropdown,300);window.addEventListener("resize",this.debouncedAfterResize)},componentWillReceiveProps:function componentWillReceiveProps(){this.setDropdown()},componentWillUnmount:function componentWillUnmount(){window.removeEventListener("resize",this.debouncedAfterResize)},render:function render(){var tabs=React.Children.map(this.props.children,function(child,index){return child&&React.cloneElement(child,{ref:"tab-"+index})});var tabsClassName=classNames({"section-nav-tabs":true,"is-dropdown":this.state.isDropdown,"is-open":this.state.isDropdownOpen,"has-siblings":this.props.hasSiblingControls});var innerWidth=viewport.getWindowInnerWidth();return React.createElement("div",{className:"section-nav-group",ref:"navGroup"},React.createElement("div",{className:tabsClassName},this.props.label&&React.createElement("h6",{className:"section-nav-group__label"},this.props.label),React.createElement("ul",{className:"section-nav-tabs__list",role:"menu",onKeyDown:this.keyHandler},tabs),this.state.isDropdown&&innerWidth>MOBILE_PANEL_THRESHOLD&&this.getDropdown()))},getTabWidths:function getTabWidths(){var totalWidth=0;React.Children.forEach(this.props.children,function(child,index){if(!child){return}var tabWidth=ReactDom.findDOMNode(this.refs["tab-"+index]).offsetWidth;totalWidth+=tabWidth}.bind(this));this.tabsWidth=totalWidth},getDropdown:function getDropdown(){var dropdownOptions=React.Children.map(this.props.children,function(child,index){if(!child){return null}return React.createElement(DropdownItem,(0,_extends3.default)({},child.props,{key:"navTabsDropdown-"+index}),child.props.children)});return React.createElement(SelectDropdown,{className:"section-nav-tabs__dropdown",selectedText:this.props.selectedText,selectedCount:this.props.selectedCount},dropdownOptions)},setDropdown:function setDropdown(){var navGroupWidth;if(window.innerWidth>MOBILE_PANEL_THRESHOLD){if(!this.refs.navGroup){return}navGroupWidth=this.refs.navGroup.offsetWidth;if(!this.tabsWidth){this.getTabWidths()}if(navGroupWidth<=this.tabsWidth&&!this.state.isDropdown){this.setState({isDropdown:true})}else if(navGroupWidth>this.tabsWidth&&this.state.isDropdown){this.setState({isDropdown:false})}}else if(window.innerWidth<=MOBILE_PANEL_THRESHOLD&&this.state.isDropdown){this.setState({isDropdown:false})}},keyHandler:function keyHandler(event){switch(event.keyCode){case 32:case 13:event.preventDefault();document.activeElement.click();break}}});module.exports=NavTabs},1664:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1),isEqual=__webpack_require__(98),classNames=__webpack_require__(10);var NavTabs=__webpack_require__(1661),NavItem=__webpack_require__(1660),Search=__webpack_require__(717);var SectionNav=React.createClass({displayName:"SectionNav",propTypes:{children:React.PropTypes.node,selectedText:React.PropTypes.node,selectedCount:React.PropTypes.number,hasPinnedItems:React.PropTypes.bool,onMobileNavPanelOpen:React.PropTypes.func},getInitialState:function getInitialState(){return{mobileOpen:false}},getDefaultProps:function getDefaultProps(){return{onMobileNavPanelOpen:function onMobileNavPanelOpen(){}}},componentWillMount:function componentWillMount(){this.checkForSiblingControls(this.props.children)},componentWillReceiveProps:function componentWillReceiveProps(nextProps){if(isEqual(this.props,nextProps)){return}this.checkForSiblingControls(nextProps.children);if(!this.hasSiblingControls){this.closeMobilePanel()}},render:function render(){var children=this.getChildren(),className;if(!children){className=classNames({"section-nav":true,"is-empty":true});return React.createElement("div",{className:className},React.createElement("div",{className:"section-nav__panel"},React.createElement(NavItem,null)))}className=classNames({"section-nav":true,"is-open":this.state.mobileOpen,"has-pinned-items":this.hasPinnedSearch||this.props.hasPinnedItems});return React.createElement("div",{className:className},React.createElement("div",{className:"section-nav__mobile-header",onTouchTap:this.toggleMobileOpenState},React.createElement("span",{className:"section-nav__mobile-header-text"},this.props.selectedText)),React.createElement("div",{className:"section-nav__panel"},children))},getChildren:function getChildren(){return React.Children.map(this.props.children,function(child){var extraProps={hasSiblingControls:this.hasSiblingControls,closeSectionNavMobilePanel:this.closeMobilePanel};if(!child){return null}if(child.type===NavTabs&&!child.props.selectedText&&typeof this.props.selectedText==="string"){extraProps.selectedText=this.props.selectedText}if(child.type===NavTabs&&this.props.selectedCount){extraProps.selectedCount=this.props.selectedCount}if(child.type===Search){if(child.props.pinned){this.hasPinnedSearch=true}extraProps.onSearch=this.generateOnSearch(child.props.onSearch)}return React.cloneElement(child,extraProps)}.bind(this))},closeMobilePanel:function closeMobilePanel(){if(window.innerWidth<480&&this.state.mobileOpen){this.setState({mobileOpen:false})}},toggleMobileOpenState:function toggleMobileOpenState(){var mobileOpen=!this.state.mobileOpen;this.setState({mobileOpen:mobileOpen});if(mobileOpen){this.props.onMobileNavPanelOpen()}},generateOnSearch:function generateOnSearch(existingOnSearch){return function(){existingOnSearch.apply(this,arguments);this.closeMobilePanel()}.bind(this)},checkForSiblingControls:function checkForSiblingControls(children){this.hasSiblingControls=false;React.Children.forEach(children,function(child,index){if(index&&child&&child.type!==Search){this.hasSiblingControls=true}}.bind(this))}});module.exports=SectionNav},1667:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);var _omit2=__webpack_require__(18);var _omit3=_interopRequireDefault(_omit2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"FormSettingExplanation",propTypes:{noValidate:_react2.default.PropTypes.bool,isIndented:_react2.default.PropTypes.bool,className:_react2.default.PropTypes.string},getDefaultProps:function getDefaultProps(){return{noValidate:false,isIndented:false}},render:function render(){var classes=(0,_classnames2.default)(this.props.className,"form-setting-explanation",{"no-validate":this.props.noValidate,"is-indented":this.props.isIndented});return _react2.default.createElement("p",(0,_extends3.default)({},(0,_omit3.default)(this.props,"className","noValidate","isIndented"),{className:classes}),this.props.children)}});module.exports=exports["default"]},1668:function(module,exports,__webpack_require__){"use strict";var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var React=__webpack_require__(1),classnames=__webpack_require__(10),omit=__webpack_require__(18);module.exports=React.createClass({displayName:"FormTextarea",render:function render(){return React.createElement("textarea",(0,_extends3.default)({},omit(this.props,"className"),{className:classnames(this.props.className,"form-textarea")}),this.props.children)}})},1673:function(module,exports,__webpack_require__){"use strict";var ReactDom=__webpack_require__(44),React=__webpack_require__(1);var Popover=__webpack_require__(386);var PopoverMenu=React.createClass({displayName:"PopoverMenu",propTypes:{isVisible:React.PropTypes.bool.isRequired,onClose:React.PropTypes.func.isRequired,position:React.PropTypes.string,className:React.PropTypes.string,rootClassName:React.PropTypes.string},getDefaultProps:function getDefaultProps(){return{position:"top"}},componentWillUnmount:function componentWillUnmount(){this._previouslyFocusedElement=null},render:function render(){var children=React.Children.map(this.props.children,this._setPropsOnChild,this);return React.createElement(Popover,{isVisible:this.props.isVisible,context:this.props.context,position:this.props.position,onClose:this._onClose,onShow:this._onShow,className:this.props.className,rootClassName:this.props.rootClassName},React.createElement("div",{ref:"menu",role:"menu",className:"popover__menu",onKeyDown:this._onKeyDown,tabIndex:"-1"},children))},_setPropsOnChild:function _setPropsOnChild(child){if(child==null){return child}var boundOnClose=this._onClose.bind(this,child.props.action),onClick=boundOnClose;if(child.props.onClick){onClick=child.props.onClick.bind(null,boundOnClose)}return React.cloneElement(child,{onClick:onClick})},_onShow:function _onShow(){var elementToFocus=ReactDom.findDOMNode(this.refs.menu);this._previouslyFocusedElement=document.activeElement;if(elementToFocus){elementToFocus.focus()}},_isInvalidTarget:function _isInvalidTarget(target){return target.tagName==="HR"},_getClosestSibling:function _getClosestSibling(target){var isDownwardMotion=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var menu=ReactDom.findDOMNode(this.refs.menu);var first=menu.firstChild,last=menu.lastChild;if(!isDownwardMotion){first=menu.lastChild;last=menu.firstChild}if(target===menu){return first}var closest=target[isDownwardMotion?"nextSibling":"previousSibling"];var sibling=closest||last;return this._isInvalidTarget(sibling)?this._getClosestSibling(sibling,isDownwardMotion):sibling},_onKeyDown:function _onKeyDown(event){var handled=false,target=event.target,elementToFocus;switch(event.keyCode){case 9:this.props.onClose();handled=true;break;case 38:elementToFocus=this._getClosestSibling(target,false);handled=true;break;case 40:elementToFocus=this._getClosestSibling(target,true);handled=true;break;default:break}if(elementToFocus){elementToFocus.focus()}if(handled){event.preventDefault()}},_onClose:function _onClose(action){if(this._previouslyFocusedElement){this._previouslyFocusedElement.focus();this._previouslyFocusedElement=null}if(this.props.onClose){this.props.onClose(action)}}});module.exports=PopoverMenu},1674:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _get2=__webpack_require__(24);var _get3=_interopRequireDefault(_get2);var _find2=__webpack_require__(27);var _find3=_interopRequireDefault(_find2);exports.isDiscoverEnabled=isDiscoverEnabled;exports.isDiscoverPost=isDiscoverPost;exports.isDiscoverSitePick=isDiscoverSitePick;exports.isInternalDiscoverPost=isInternalDiscoverPost;exports.getSiteUrl=getSiteUrl;exports.hasSource=hasSource;exports.getSourceData=getSourceData;exports.getLinkProps=getLinkProps;exports.getSourceFollowUrl=getSourceFollowUrl;var _url=__webpack_require__(70);var _url2=_interopRequireDefault(_url);var _config=__webpack_require__(12);var _config2=_interopRequireDefault(_config);var _debug=__webpack_require__(3);var _debug2=_interopRequireDefault(_debug);var _utils=__webpack_require__(169);
var _utils2=_interopRequireDefault(_utils);var _route=__webpack_require__(1740);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var debug=(0,_debug2.default)("calypso:reader:discover");function isDiscoverEnabled(){return _utils2.default.getLocaleSlug()==="en"}function isDiscoverPost(post){return!!((0,_get3.default)(post,"discover_metadata")||(0,_get3.default)(post,"site_ID")===(0,_config2.default)("discover_blog_id"))}function isDiscoverSitePick(post){var metaData=(0,_get3.default)(post,"discover_metadata.discover_fp_post_formats");return!!(metaData&&(0,_find3.default)(metaData,{slug:"site-pick"}))}function isInternalDiscoverPost(post){return!!(0,_get3.default)(post,"discover_metadata.featured_post_wpcom_data")}function getSiteUrl(post){var blogId=(0,_get3.default)(post,"discover_metadata.featured_post_wpcom_data.blog_id");return blogId?(0,_route.getSiteUrl)(blogId):(0,_get3.default)(post,"discover_metadata.permalink")}function hasSource(post){return this.isDiscoverPost(post)&&!this.isDiscoverSitePick(post)}function getSourceData(post){var sourceData=(0,_get3.default)(post,"discover_metadata.featured_post_wpcom_data");if(sourceData&&!this.isDiscoverSitePick(post)){return{blogId:(0,_get3.default)(sourceData,"blog_id"),postId:(0,_get3.default)(sourceData,"post_id")}}return null}function getLinkProps(linkUrl){var parsedUrl=_url2.default.parse(linkUrl),hostname=(0,_get3.default)(parsedUrl,"hostname"),isExternal=hostname&&hostname!==window.location.hostname;return{rel:isExternal?"external":"",target:isExternal?"_blank":""}}function getSourceFollowUrl(post){var followUrl=void 0;if(!isDiscoverPost(post)){return}if(isInternalDiscoverPost(post)){followUrl=(0,_get3.default)(post,"discover_metadata.attribution.blog_url")}return followUrl||""}},1691:function(module,exports,__webpack_require__){"use strict";var _keys=__webpack_require__(39);var _keys2=_interopRequireDefault(_keys);var _debug=__webpack_require__(3);var _debug2=_interopRequireDefault(_debug);var _omit=__webpack_require__(18);var _omit2=_interopRequireDefault(_omit);var _page=__webpack_require__(33);var _page2=_interopRequireDefault(_page);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactDom=__webpack_require__(44);var _reactDom2=_interopRequireDefault(_reactDom);var _detectHistoryNavigation=__webpack_require__(810);var _detectHistoryNavigation2=_interopRequireDefault(_detectHistoryNavigation);var _actions=__webpack_require__(2617);var _actions2=_interopRequireDefault(_actions);var _positionsStore=__webpack_require__(2245);var _positionsStore2=_interopRequireDefault(_positionsStore);var _scrollStore=__webpack_require__(2246);var _scrollStore2=_interopRequireDefault(_scrollStore);var _scrollHelper=__webpack_require__(2520);var _scrollHelper2=_interopRequireDefault(_scrollHelper);var _scrollTo=__webpack_require__(410);var _scrollTo2=_interopRequireDefault(_scrollTo);var _reactSmartSetState=__webpack_require__(1710);var _reactSmartSetState2=_interopRequireDefault(_reactSmartSetState);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var debug=(0,_debug2.default)("calypso:infinite-list");module.exports=_react2.default.createClass({displayName:"InfiniteList",lastScrollTop:-1,scrollRAFHandle:false,scrollHelper:null,isScrolling:false,propTypes:{items:_react2.default.PropTypes.array.isRequired,fetchingNextPage:_react2.default.PropTypes.bool.isRequired,lastPage:_react2.default.PropTypes.bool.isRequired,guessedItemHeight:_react2.default.PropTypes.number.isRequired,itemsPerRow:_react2.default.PropTypes.number,fetchNextPage:_react2.default.PropTypes.func.isRequired,getItemRef:_react2.default.PropTypes.func.isRequired,renderItem:_react2.default.PropTypes.func.isRequired,renderLoadingPlaceholders:_react2.default.PropTypes.func.isRequired,renderTrailingItems:_react2.default.PropTypes.func,context:_react2.default.PropTypes.oneOfType([_react2.default.PropTypes.object,_react2.default.PropTypes.bool])},getDefaultProps:function getDefaultProps(){return{itemsPerRow:1,renderTrailingItems:function renderTrailingItems(){}}},smartSetState:_reactSmartSetState2.default,componentWillMount:function componentWillMount(){var url=_page2.default.current;var newState=void 0,scrollPosition=void 0;if(_detectHistoryNavigation2.default.loadedViaHistory()){newState=_positionsStore2.default.get(url);scrollPosition=_scrollStore2.default.get(url)}if(newState&&scrollPosition){debug("overriding scrollTop:",scrollPosition);newState.scrollTop=scrollPosition}this.scrollHelper=new _scrollHelper2.default(this.boundsForRef);this.scrollHelper.props=this.props;if(this._contextLoaded()){this._scrollContainer=this.props.context||window;this.scrollHelper.updateContextHeight(this.getCurrentContextHeight())}this.isScrolling=false;if(newState){debug("infinite-list positions loaded from store")}else{debug("infinite-list positions reset for new list");newState={firstRenderedIndex:0,topPlaceholderHeight:0,lastRenderedIndex:this.scrollHelper.initialLastRenderedIndex(),bottomPlaceholderHeight:0,scrollTop:0}}debug("infinite list mounting",newState);this.setState(newState)},componentDidMount:function componentDidMount(){if(this._contextLoaded()){this._setContainerY(this.state.scrollTop)}if(_detectHistoryNavigation2.default.loadedViaHistory()){this._overrideHistoryScroll()}debug("setting scrollTop:",this.state.scrollTop);this.updateScroll({triggeredByScroll:false});if(this._contextLoaded()){this._scrollContainer.addEventListener("scroll",this.onScroll)}},componentWillReceiveProps:function componentWillReceiveProps(newProps){this.scrollHelper.props=newProps;if(!this.isScrolling){this.cancelAnimationFrame();this.updateScroll({triggeredByScroll:false})}if(newProps.context===this.props.context){return}if(this._contextLoaded()){this._scrollContainer.removeEventListener("scroll",this._resetScroll)}},componentDidUpdate:function componentDidUpdate(prevProps){if(!this._contextLoaded()){return}if(this.props.context!==prevProps.context){if(this._scrollContainer){this._scrollContainer.removeEventListener("scroll",this.onScroll)}this._scrollContainer=this.props.context||window;this._scrollContainer.addEventListener("scroll",this.onScroll);if(_detectHistoryNavigation2.default.loadedViaHistory()){this._overrideHistoryScroll()}}if(!this.isScrolling){this.cancelAnimationFrame();this.updateScroll({triggeredByScroll:false})}},reset:function reset(){this.cancelAnimationFrame();this.scrollHelper=new _scrollHelper2.default(this.boundsForRef);this.scrollHelper.props=this.props;if(this._contextLoaded()){this._scrollContainer=this.props.context||window;this.scrollHelper.updateContextHeight(this.getCurrentContextHeight())}this.isScrolling=false;this.setState({firstRenderedIndex:0,topPlaceholderHeight:0,lastRenderedIndex:this.scrollHelper.initialLastRenderedIndex(),bottomPlaceholderHeight:0,scrollTop:0})},componentWillUnmount:function componentWillUnmount(){this._scrollContainer.removeEventListener("scroll",this.onScroll);this._scrollContainer.removeEventListener("scroll",this._resetScroll);this.cancelAnimationFrame()},cancelAnimationFrame:function cancelAnimationFrame(){if(this.scrollRAFHandle){window.cancelAnimationFrame(this.scrollRAFHandle);this.scrollRAFHandle=null}this.lastScrollTop=-1},onScroll:function onScroll(){if(this.isScrolling){return}if(!this.scrollRAFHandle&&this.getCurrentScrollTop()!==this.lastScrollTop){this.scrollRAFHandle=window.requestAnimationFrame(this.scrollChecks)}},getCurrentContextHeight:function getCurrentContextHeight(){var context=this.props.context||window.document.documentElement;return context.clientHeight},getCurrentScrollTop:function getCurrentScrollTop(){if(this.props.context){debug("getting scrollTop from context");return this.props.context.scrollTop}return window.pageYOffset},scrollChecks:function scrollChecks(){if(!this.isMounted()||this.getCurrentScrollTop()===this.lastScrollTop){this.scrollRAFHandle=null;return}this.updateScroll({triggeredByScroll:true})},scrollToTop:function scrollToTop(){var _this=this;this.cancelAnimationFrame();this.isScrolling=true;if(this.props.context&&this.props.context!==window){this.props.context.scrollTop=0;this.updateScroll({triggeredByScroll:false});this.isScrolling=false}else{(0,_scrollTo2.default)({x:0,y:0,duration:250,onComplete:function onComplete(){if(_this.isMounted()){_this.updateScroll({triggeredByScroll:false})}_this.isScrolling=false}})}},updateScroll:function updateScroll(options){var url=_page2.default.current;var newState=void 0;if(!this._contextLoaded()){return}this.lastScrollTop=this.getCurrentScrollTop();_actions2.default.storeScroll(url,this.lastScrollTop);this.scrollHelper.updateContextHeight(this.getCurrentContextHeight());this.scrollHelper.scrollPosition=this.lastScrollTop;this.scrollHelper.triggeredByScroll=options.triggeredByScroll;this.scrollHelper.updatePlaceholderDimensions();this.scrollHelper.scrollChecks(this.state);if(this.scrollHelper.stateUpdated){newState={firstRenderedIndex:this.scrollHelper.firstRenderedIndex,topPlaceholderHeight:this.scrollHelper.topPlaceholderHeight,lastRenderedIndex:this.scrollHelper.lastRenderedIndex,bottomPlaceholderHeight:this.scrollHelper.bottomPlaceholderHeight,scrollTop:this.lastScrollTop};this.lastScrollTop=-1;debug("new scroll positions",newState,this.state);this.smartSetState(newState);_actions2.default.storePositions(url,newState)}this.scrollRAFHandle=window.requestAnimationFrame(this.scrollChecks)},boundsForRef:function boundsForRef(ref){if(ref in this.refs){return _reactDom2.default.findDOMNode(this.refs[ref]).getBoundingClientRect()}return null},getVisibleItemIndexes:function getVisibleItemIndexes(options){var container=_reactDom2.default.findDOMNode(this),visibleItemIndexes=[],firstIndex=this.state.firstRenderedIndex,lastIndex=this.state.lastRenderedIndex,offsetTop=options&&options.offsetTop?options.offsetTop:0;var windowHeight=void 0,rect=void 0,children=void 0,i=void 0,offsetBottom=options&&options.offsetBottom?options.offsetBottom:0;offsetBottom=offsetBottom||0;if(lastIndex>-1){children=container.children;for(i=1;i<children.length-1;i++){rect=container.children[i].getBoundingClientRect();windowHeight=window.innerHeight||document.documentElement.clientHeight;if(rect.top<0&&Math.abs(rect.top)<rect.height-offsetTop||rect.top>0&&rect.top<windowHeight-offsetBottom){visibleItemIndexes.push({index:firstIndex+i-1,bounds:rect})}}}return visibleItemIndexes},render:function render(){var propsToTransfer=(0,_omit2.default)(this.props,(0,_keys2.default)(this.constructor.propTypes)),spacerClassName="infinite-list__spacer";var i=void 0,lastRenderedIndex=this.state.lastRenderedIndex,itemsToRender=[];if(lastRenderedIndex===-1||lastRenderedIndex>this.props.items.length-1){debug("resetting lastRenderedIndex, currently at %s, %d items",lastRenderedIndex,this.props.items.length);lastRenderedIndex=Math.min(this.state.firstRenderedIndex+this.scrollHelper.initialLastRenderedIndex(),this.props.items.length-1);debug("reset lastRenderedIndex to %s",lastRenderedIndex)}debug("rendering %d to %d",this.state.firstRenderedIndex,lastRenderedIndex);for(i=this.state.firstRenderedIndex;i<=lastRenderedIndex;i++){itemsToRender.push(this.props.renderItem(this.props.items[i],i))}if(this.props.fetchingNextPage){itemsToRender=itemsToRender.concat(this.props.renderLoadingPlaceholders())}return _react2.default.createElement("div",propsToTransfer,_react2.default.createElement("div",{ref:"topPlaceholder",className:spacerClassName,style:{height:this.state.topPlaceholderHeight}}),itemsToRender,this.props.renderTrailingItems(),_react2.default.createElement("div",{ref:"bottomPlaceholder",className:spacerClassName,style:{height:this.state.bottomPlaceholderHeight}}))},_setContainerY:function _setContainerY(position){if(this.props.context&&this.props.context!==window){this.props.context.scrollTop=position;return}window.scrollTo(0,position)},_overrideHistoryScroll:function _overrideHistoryScroll(){if(!this._contextLoaded()){return}this._scrollContainer.addEventListener("scroll",this._resetScroll)},_resetScroll:function _resetScroll(event){var position=this.state.scrollTop;if(!this._contextLoaded()){return}debug("history setting scroll position:",event);this._setContainerY(position);this._scrollContainer.removeEventListener("scroll",this._resetScroll);debug("override scroll position from HTML5 history popstate:",position)},_contextLoaded:function _contextLoaded(){return this.props.context||this.props.context===false||!("context"in this.props)}})},1710:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _keys=__webpack_require__(39);var _keys2=_interopRequireDefault(_keys);exports.default=smartSetState;function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function smartSetState(newState){var hasNewValues=(0,_keys2.default)(newState).some(function(key){return!(this.state&&this.state.hasOwnProperty(key))||this.state[key]!==newState[key]},this);if(hasNewValues){this.setState(newState);return true}return false}module.exports=exports["default"]},1711:function(module,exports,__webpack_require__){"use strict";var _url=__webpack_require__(115);var Immutable=__webpack_require__(113),omit=__webpack_require__(18),has=__webpack_require__(175),trim=__webpack_require__(219);var Dispatcher=__webpack_require__(42),Emitter=__webpack_require__(36),SiteStoreActionType=__webpack_require__(1738).action,FeedStoreActionType=__webpack_require__(1749).action,State=__webpack_require__(1738).state;var sites={},SiteStore;SiteStore={get:function get(siteId){return sites[siteId]}};Emitter(SiteStore);SiteStore.setMaxListeners(100);function adaptSite(attributes){if(!attributes.state){attributes.state=State.COMPLETE}attributes.has_featured=has(attributes,"meta.links.featured");attributes=omit(attributes,["meta"]);if(attributes.URL){attributes.domain=(0,_url.withoutHttp)(attributes.URL);attributes.slug=attributes.domain.replace(/\//g,"::")}attributes.title=trim(attributes.name)||attributes.domain;if(attributes.options&&attributes.options.is_mapped_domain&&!attributes.is_jetpack){attributes.wpcom_url=(0,_url.withoutHttp)(attributes.options.unmapped_url)}if(attributes.options&&attributes.options.is_redirect){attributes.slug=(0,_url.withoutHttp)(attributes.options.unmapped_url);attributes.domain=attributes.slug}return attributes}function setSite(attributes){var site=sites[attributes.ID],newSite;attributes=adaptSite(attributes);if(site){newSite=site.mergeDeep(attributes)}else{newSite=Immutable.fromJS(attributes)}if(newSite===site){return}sites[attributes.ID]=newSite;SiteStore.emit("change")}function setManySites(siteList){var adaptedSites=siteList.map(adaptSite),changes=0;adaptedSites.forEach(function(site){var existing=sites[site.ID],newSite;if(existing){newSite=existing.mergeDeep(site);if(newSite===existing){return}}else{newSite=Immutable.fromJS(site)}sites[site.ID]=newSite;changes++});if(changes>0){SiteStore.emit("change")}}SiteStore.dispatchToken=Dispatcher.register(function(payload){var action=payload&&payload.action;if(!action){return}switch(action.type){case SiteStoreActionType.RECEIVE_FETCH:if(action.error){setSite({ID:action.siteId,state:State.ERROR,error:action.error})}else{setSite(action.data)}break;case SiteStoreActionType.RECEIVE_BULK_UPDATE:setManySites(action.data);break;case FeedStoreActionType.RECEIVE_FETCH:if(action.data&&action.data.meta&&action.data.meta.data&&action.data.meta.data.site){setSite(action.data.meta.data.site)}break}});module.exports=SiteStore},1723:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _mixin=__webpack_require__(111);var _mixin2=_interopRequireDefault(_mixin);var _reactRedux=__webpack_require__(15);var _redux=__webpack_require__(6);var _followButton=__webpack_require__(2515);var _followButton2=_interopRequireDefault(_followButton);var _button=__webpack_require__(1886);var _button2=_interopRequireDefault(_button);var _stats=__webpack_require__(1643);var stats=_interopRequireWildcard(_stats);var _actions=__webpack_require__(3296);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ReaderFollowButton=_react2.default.createClass({displayName:"ReaderFollowButton",mixins:[_mixin2.default],propTypes:{onFollowToggle:_react2.default.PropTypes.func,railcar:_react2.default.PropTypes.object},recordFollowToggle:function recordFollowToggle(isFollowing){stats[isFollowing?"recordFollow":"recordUnfollow"](this.props.siteUrl,this.props.railcar);isFollowing?this.props.recordFollow(this.props.siteUrl):this.props.recordUnfollow(this.props.siteUrl);if(this.props.onFollowToggle){this.props.onFollowToggle(isFollowing)}},render:function render(){if(this.props.isButtonOnly){return _react2.default.createElement(_button2.default,(0,_extends3.default)({},this.props,{onFollowToggle:this.recordFollowToggle}))}return _react2.default.createElement(_followButton2.default,(0,_extends3.default)({},this.props,{onFollowToggle:this.recordFollowToggle}))}});exports.default=(0,_reactRedux.connect)(function(state){return{}},function(dispatch){return(0,_redux.bindActionCreators)({recordFollow:_actions.recordFollow,recordUnfollow:_actions.recordUnfollow},dispatch)})(ReaderFollowButton);module.exports=exports["default"]},1734:function(module,exports){function head(array){return array&&array.length?array[0]:undefined}module.exports=head},1738:function(module,exports){"use strict";module.exports={action:{FETCH:"FETCH_SITE",RECEIVE_FETCH:"RECEIVE_FETCH_SITE",RECEIVE_BULK_UPDATE:"RECEIVE_BULK_SITE_UPDATE"},state:{PENDING:1,COMPLETE:2,ERROR:4}}},1740:function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getPrettySiteUrl=getPrettySiteUrl;exports.getPrettyFeedUrl=getPrettyFeedUrl;exports.getSiteUrl=getSiteUrl;exports.getFeedUrl=getFeedUrl;exports.getStreamUrl=getStreamUrl;exports.getStreamUrlFromPost=getStreamUrlFromPost;exports.getPostUrl=getPostUrl;var FEED_URL_BASE="/read/feeds/";var SITE_URL_BASE="/read/blogs/";var PRETTY_FEED_URLS={12733228:"/discover"};var PRETTY_SITE_URLS={53424024:"/discover"};function getPrettySiteUrl(siteID){return PRETTY_SITE_URLS[siteID]}function getPrettyFeedUrl(feedID){return PRETTY_FEED_URLS[feedID]}function getSiteUrl(siteID){return getPrettySiteUrl(siteID)||SITE_URL_BASE+siteID}function getFeedUrl(feedID){return getPrettyFeedUrl(feedID)||FEED_URL_BASE+feedID}function getStreamUrl(feedID,siteID){if(feedID){return getFeedUrl(feedID)}return getSiteUrl(siteID)}function getStreamUrlFromPost(post){if(post.feed_ID){return getFeedUrl(post.feed_ID)}return getSiteUrl(post.site_ID)}function getPostUrl(post){if(post.feed_ID&&post.feed_item_ID){return"/read/feeds/"+post.feed_ID+"/posts/"+post.feed_item_ID}else if(post.is_external){return"/read/feeds/"+post.feed_ID+"/posts/"+post.ID}return"/read/blogs/"+post.site_ID+"/posts/"+post.ID}},1749:function(module,exports){"use strict";module.exports={action:{FETCH:"FEED_FETCH",RECEIVE_FETCH:"RECEIVE_FEED_FETCH",RECEIVE_BULK_UPDATE:"RECEIVE_BULK_FEED_UPDATE"},state:{COMPLETE:2,ERROR:4}}},1750:function(module,exports,__webpack_require__){"use strict";var Immutable=__webpack_require__(113),pick=__webpack_require__(91);var ActionType=__webpack_require__(1749).action,State=__webpack_require__(1749).state,Dispatcher=__webpack_require__(42),Emitter=__webpack_require__(36),decodeEntities=__webpack_require__(81).decodeEntities;var feeds={},FeedStore={get:function get(feedId){return feeds[feedId]}},FeedRecord=Immutable.Record({feed_ID:null,blog_ID:null,name:"",URL:"",feed_URL:"",subscribers_count:0,state:State.PENDING,error:undefined});function setFeed(feedId,feed){if(feed!==feeds[feedId]){feeds[feedId]=feed;FeedStore.emit("change")}}function setFeeds(feedList){var hadChanges=false;feedList.forEach(function(feed){if(feed!==feeds[feed.feed_ID]){feeds[feed.feed_ID]=feed;hadChanges=true}});if(hadChanges){FeedStore.emit("change")}}function receiveError(feedId,error){receiveFeed(feedId,{state:State.ERROR,error:error})}function acceptFeed(feedId,attributes){var feed=feeds[feedId];if(!feed){feed=new FeedRecord({feed_ID:feedId})}attributes=pick(attributes,["feed_ID","blog_ID","name","URL","feed_URL","subscribers_count","state","error"]);if(attributes.name){attributes.name=decodeEntities(attributes.name)}if(!attributes.state){attributes.state=State.COMPLETE}feed=feed.merge(attributes);return feed}function receiveFeed(feedId,attributes){setFeed(feedId,acceptFeed(feedId,attributes))}function receiveFeeds(newFeeds){setFeeds(newFeeds.map(function(feed){return acceptFeed(feed.feed_ID,feed)}))}Emitter(FeedStore);FeedStore.setMaxListeners(100);FeedStore.dispatchToken=Dispatcher.register(function(payload){var action=payload&&payload.action;if(!action){return}switch(action.type){case ActionType.RECEIVE_FETCH:if(action.error){receiveError(action.feedId,action.error)}else{receiveFeed(action.feedId,action.data)}break;case ActionType.RECEIVE_BULK_UPDATE:receiveFeeds(action.data);break}});module.exports=FeedStore},1751:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ensureStoreLoading=ensureStoreLoading;exports.trackPageLoad=trackPageLoad;exports.trackScrollPage=trackScrollPage;exports.trackUpdatesLoaded=trackUpdatesLoaded;exports.setPageTitle=setPageTitle;exports.userHasHistory=userHasHistory;var _moment=__webpack_require__(4);var _moment2=_interopRequireDefault(_moment);var _i18nCalypso=__webpack_require__(11);var _i18nCalypso2=_interopRequireDefault(_i18nCalypso);var _analytics=__webpack_require__(20);var _analytics2=_interopRequireDefault(_analytics);var _stats=__webpack_require__(1643);var _actions=__webpack_require__(712);var _actions2=__webpack_require__(1898);var _actions3=_interopRequireDefault(_actions2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function ensureStoreLoading(store,context){if(store.getPage()===1){if(context&&context.query&&context.query.at){var startDate=(0,_moment2.default)(context.query.at);if(startDate.isValid()){store.startDate=startDate.format()}}_actions3.default.fetchNextPage(store.id)}return store}function trackPageLoad(path,title,readerView){_analytics2.default.pageView.record(path,title);_analytics2.default.mc.bumpStat("reader_views",readerView==="full_post"?readerView:readerView+"_load")}function trackScrollPage(path,title,category,readerView,pageNum){_analytics2.default.ga.recordEvent(category,"Loaded Next Page","page",pageNum);(0,_stats.recordTrack)("calypso_reader_infinite_scroll_performed",{path:path,page:pageNum,section:readerView});_analytics2.default.pageView.record(path,title);_analytics2.default.mc.bumpStat({newdash_pageviews:"scroll",reader_views:readerView+"_scroll"})}function trackUpdatesLoaded(key){_analytics2.default.mc.bumpStat("reader_views",key+"_load_new");_analytics2.default.ga.recordEvent("Reader","Clicked Load New Posts",key);(0,_stats.recordTrack)("calypso_reader_load_new_posts",{section:key})}function setPageTitle(context,title){context.store.dispatch((0,_actions.setDocumentHeadTitle)(_i18nCalypso2.default.translate("%s  Reader",{args:title})))}function userHasHistory(context){return!!context.lastRoute}},1752:function(module,exports,__webpack_require__){"use strict";var _reactDom=__webpack_require__(44);var _reactDom2=_interopRequireDefault(_reactDom);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _page=__webpack_require__(33);var _page2=_interopRequireDefault(_page);var _reactRedux=__webpack_require__(15);var _i18nCalypso=__webpack_require__(11);var _i18nCalypso2=_interopRequireDefault(_i18nCalypso);var _config=__webpack_require__(12);var _config2=_interopRequireDefault(_config);var _defer=__webpack_require__(385);var _defer2=_interopRequireDefault(_defer);var _abtest=__webpack_require__(280);var _route=__webpack_require__(132);var _route2=_interopRequireDefault(_route);var _feedStreamStore=__webpack_require__(1764);var _feedStreamStore2=_interopRequireDefault(_feedStreamStore);var _controllerHelper=__webpack_require__(1751);var _feedError=__webpack_require__(2002);var _feedError2=_interopRequireDefault(_feedError);var _actions=__webpack_require__(1845);var _actions2=_interopRequireDefault(_actions);var _route3=__webpack_require__(1740);var _stats=__webpack_require__(1643);var _selectors=__webpack_require__(90);var _actions3=__webpack_require__(2180);var _selectors2=__webpack_require__(2015);var _actions4=__webpack_require__(2186);var _sectionsPreload=__webpack_require__(142);var _reactHelpers=__webpack_require__(711);var _sidebar=__webpack_require__(3216);var _sidebar2=_interopRequireDefault(_sidebar);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var analyticsPageTitle="Reader";var activeAbTests=[];var lastRoute=null;function userHasHistory(context){return!!context.lastRoute}function renderFeedError(context){(0,_reactHelpers.renderWithReduxStore)(_react2.default.createElement(_feedError2.default),document.getElementById("primary"),context.store)}module.exports={initAbTests:function initAbTests(context,next){activeAbTests.forEach(function(test){return(0,_abtest.abtest)(test)});next()},prettyRedirects:function prettyRedirects(context,next){var redirect=void 0;if(context.params.blog_id){redirect=(0,_route3.getPrettySiteUrl)(context.params.blog_id)}else if(context.params.feed_id){redirect=(0,_route3.getPrettyFeedUrl)(context.params.feed_id)}if(redirect){return _page2.default.redirect(redirect)}next()},legacyRedirects:function legacyRedirects(context,next){var legacyPathRegexes={feedStream:/^\/read\/blog\/feed\/([0-9]+)$/i,feedFullPost:/^\/read\/post\/feed\/([0-9]+)\/([0-9]+)$/i,blogStream:/^\/read\/blog\/id\/([0-9]+)$/i,blogFullPost:/^\/read\/post\/id\/([0-9]+)\/([0-9]+)$/i};if(context.path.match(legacyPathRegexes.feedStream)){_page2.default.redirect("/read/feeds/"+context.params.feed_id)}else if(context.path.match(legacyPathRegexes.feedFullPost)){_page2.default.redirect("/read/feeds/"+context.params.feed_id+"/posts/"+context.params.post_id)}else if(context.path.match(legacyPathRegexes.blogStream)){_page2.default.redirect("/read/blogs/"+context.params.blog_id)}else if(context.path.match(legacyPathRegexes.blogFullPost)){_page2.default.redirect("/read/blogs/"+context.params.blog_id+"/posts/"+context.params.post_id)}next()},updateLastRoute:function updateLastRoute(context,next){if(lastRoute){context.lastRoute=lastRoute}lastRoute=context.path;next()},incompleteUrlRedirects:function incompleteUrlRedirects(context,next){var redirect=void 0;if(context.path.match(/^\/read\/feeds\/([0-9]+)\/posts$/i)){redirect="/read/feeds/"+context.params.feed_id}else if(context.path.match(/^\/read\/blogs\/([0-9]+)\/posts$/i)){redirect="/read/blogs/"+context.params.blog_id}if(redirect){return _page2.default.redirect(redirect)}next()},preloadReaderBundle:function preloadReaderBundle(context,next){(0,_sectionsPreload.preload)("reader");next()},loadSubscriptions:function loadSubscriptions(context,next){var FeedSubscriptionStore=__webpack_require__(1768),PostEmailSubscriptionStore=__webpack_require__(2272),CommentEmailSubscriptionStore=__webpack_require__(2266);_actions2.default.fetchAll();next()},checkForColdStart:function checkForColdStart(context,next){var FeedSubscriptionStore=__webpack_require__(1768);var user=(0,_selectors.getCurrentUser)(context.store.getState());var numberofTries=3;var graduationThreshold=void 0;if((0,_abtest.abtest)("coldStartReader")==="noEmailColdStartWithAutofollows"){graduationThreshold=(0,_config2.default)("reader_cold_start_graduation_threshold_with_autofollows")}else{graduationThreshold=(0,_config2.default)("reader_cold_start_graduation_threshold")}if(!user){next();return}if(!user.is_new_reader){next();return}function checkSubCount(tries){if(FeedSubscriptionStore.getCurrentPage()>0||FeedSubscriptionStore.isLastPage()){if(FeedSubscriptionStore.getTotalSubscriptions()<graduationThreshold){(0,_defer2.default)(_page2.default.redirect.bind(_page2.default,"/recommendations/start"))}else{if(!(0,_selectors2.isRequestingGraduation)(context.store.getState())){context.store.dispatch((0,_actions3.requestGraduate)())}(0,_defer2.default)(next)}}else if(tries>-1){FeedSubscriptionStore.once("change",checkSubCount.bind(null,--tries))}else{(0,_defer2.default)(next)}}checkSubCount(numberofTries)},sidebar:function sidebar(context,next){(0,_reactHelpers.renderWithReduxStore)(_react2.default.createElement(_reactRedux.Provider,{store:context.store},_react2.default.createElement(_sidebar2.default,{path:context.path})),document.getElementById("secondary"),context.store);next()},unmountSidebar:function unmountSidebar(context,next){_reactDom2.default.unmountComponentAtNode(document.getElementById("secondary"));next()},following:function following(context){var StreamComponent=__webpack_require__(1753),basePath=_route2.default.sectionify(context.path),fullAnalyticsPageTitle=analyticsPageTitle+" > Following",followingStore=(0,_feedStreamStore2.default)("following"),mcKey="following";(0,_controllerHelper.ensureStoreLoading)(followingStore,context);(0,_controllerHelper.trackPageLoad)(basePath,fullAnalyticsPageTitle,mcKey);(0,_stats.recordTrack)("calypso_reader_following_loaded");(0,_controllerHelper.setPageTitle)(context,_i18nCalypso2.default.translate("Following"));_reactDom2.default.render(_react2.default.createElement(_reactRedux.Provider,{store:context.store},_react2.default.createElement(StreamComponent,{key:"following",listName:_i18nCalypso2.default.translate("Followed Sites"),store:followingStore,trackScrollPage:_controllerHelper.trackScrollPage.bind(null,basePath,fullAnalyticsPageTitle,analyticsPageTitle,mcKey),onUpdatesShown:_controllerHelper.trackUpdatesLoaded.bind(null,mcKey)})),document.getElementById("primary"))},feedDiscovery:function feedDiscovery(context,next){var feedLookup=__webpack_require__(2604);if(!context.params.feed_id.match(/^\d+$/)){feedLookup(context.params.feed_id).then(function(feedId){_page2.default.redirect("/read/feeds/"+feedId)}).catch(function(){renderFeedError(context)})}else{next()}},feedListing:function feedListing(context){var FeedStream=__webpack_require__(3180),basePath="/read/feeds/:feed_id",fullAnalyticsPageTitle=analyticsPageTitle+" > Feed > "+context.params.feed_id,feedStore=(0,_feedStreamStore2.default)("feed:"+context.params.feed_id),mcKey="blog";(0,_controllerHelper.ensureStoreLoading)(feedStore,context);(0,_controllerHelper.trackPageLoad)(basePath,fullAnalyticsPageTitle,mcKey);(0,_stats.recordTrack)("calypso_reader_blog_preview",{feed_id:context.params.feed_id});(0,_reactHelpers.renderWithReduxStore)(_react2.default.createElement(FeedStream,{key:"feed-"+context.params.feed_id,store:feedStore,feedId:context.params.feed_id,trackScrollPage:_controllerHelper.trackScrollPage.bind(null,basePath,fullAnalyticsPageTitle,analyticsPageTitle,mcKey),onUpdatesShown:_controllerHelper.trackUpdatesLoaded.bind(null,mcKey),suppressSiteNameLink:true,showBack:userHasHistory(context)}),document.getElementById("primary"),context.store)},blogListing:function blogListing(context){var SiteStream=__webpack_require__(2356),basePath="/read/blogs/:blog_id",fullAnalyticsPageTitle=analyticsPageTitle+" > Site > "+context.params.blog_id,feedStore=(0,_feedStreamStore2.default)("site:"+context.params.blog_id),mcKey="blog";(0,_controllerHelper.ensureStoreLoading)(feedStore,context);(0,_controllerHelper.trackPageLoad)(basePath,fullAnalyticsPageTitle,mcKey);(0,_stats.recordTrack)("calypso_reader_blog_preview",{
blog_id:context.params.blog_id});(0,_reactHelpers.renderWithReduxStore)(_react2.default.createElement(SiteStream,{key:"site-"+context.params.blog_id,store:feedStore,siteId:context.params.blog_id,trackScrollPage:_controllerHelper.trackScrollPage.bind(null,basePath,fullAnalyticsPageTitle,analyticsPageTitle,mcKey),onUpdatesShown:_controllerHelper.trackUpdatesLoaded.bind(null,mcKey),suppressSiteNameLink:true,showBack:userHasHistory(context)}),document.getElementById("primary"),context.store)},removePost:function removePost(context,next){context.store.dispatch((0,_actions4.hideReaderFullPost)());next()},readA8C:function readA8C(context){var StreamComponent=__webpack_require__(1753),basePath=_route2.default.sectionify(context.path),fullAnalyticsPageTitle=analyticsPageTitle+" > A8C",feedStore=(0,_feedStreamStore2.default)("a8c"),mcKey="a8c";(0,_controllerHelper.ensureStoreLoading)(feedStore,context);(0,_controllerHelper.trackPageLoad)(basePath,fullAnalyticsPageTitle,mcKey);(0,_controllerHelper.setPageTitle)(context,"Automattic");_reactDom2.default.render(_react2.default.createElement(_reactRedux.Provider,{store:context.store},_react2.default.createElement(StreamComponent,{key:"read-a8c",className:"is-a8c",listName:"Automattic",store:feedStore,trackScrollPage:_controllerHelper.trackScrollPage.bind(null,basePath,fullAnalyticsPageTitle,analyticsPageTitle,mcKey),onUpdatesShown:_controllerHelper.trackUpdatesLoaded.bind(null,mcKey)})),document.getElementById("primary"))}}},1753:function(module,exports,__webpack_require__){"use strict";var ReactDom=__webpack_require__(44),React=__webpack_require__(1),classnames=__webpack_require__(10),noop=__webpack_require__(38),times=__webpack_require__(716);var Main=__webpack_require__(166),DISPLAY_TYPES=__webpack_require__(2067),EmptyContent=__webpack_require__(3235),FeedStreamStoreActions=__webpack_require__(1898),FeedPostStoreActions=__webpack_require__(1813),ListGap=__webpack_require__(3196),LikeStore=__webpack_require__(2070),LikeStoreActions=__webpack_require__(1975),LikeHelper=__webpack_require__(1919),InfiniteList=__webpack_require__(1691),MobileBackToSidebar=__webpack_require__(1888),Post=__webpack_require__(3240),CrossPost=__webpack_require__(3241),page=__webpack_require__(33),PostUnavailable=__webpack_require__(3239),PostPlaceholder=__webpack_require__(3238),PostStore=__webpack_require__(1763),UpdateNotice=__webpack_require__(3245),PostBlocked=__webpack_require__(3237),KeyboardShortcuts=__webpack_require__(296),scrollTo=__webpack_require__(410),XPostHelper=__webpack_require__(2357);var GUESSED_POST_HEIGHT=600,HEADER_OFFSET_TOP=46;module.exports=React.createClass({displayName:"ReaderFollowing",propTypes:{store:React.PropTypes.object.isRequired,trackScrollPage:React.PropTypes.func.isRequired,suppressSiteNameLink:React.PropTypes.bool,showPostHeader:React.PropTypes.bool,showFollowInHeader:React.PropTypes.bool,onUpdatesShown:React.PropTypes.func,emptyContent:React.PropTypes.object,className:React.PropTypes.string,showDefaultEmptyContentIfMissing:React.PropTypes.bool,showPrimaryFollowButtonOnCards:React.PropTypes.bool,showMobileBackToSidebar:React.PropTypes.bool},getDefaultProps:function getDefaultProps(){return{showPostHeader:true,suppressSiteNameLink:false,showFollowInHeader:false,onShowUpdates:noop,className:"",showDefaultEmptyContentIfMissing:true,showPrimaryFollowButtonOnCards:false,showMobileBackToSidebar:true}},getInitialState:function getInitialState(){return this.getStateFromStores()},getStateFromStores:function getStateFromStores(store){store=store||this.props.store;return{posts:store.get(),updateCount:store.getUpdateCount(),selectedIndex:store.getSelectedIndex()}},updateState:function updateState(store){this.setState(this.getStateFromStores(store))},componentDidUpdate:function componentDidUpdate(prevProps,prevState){if(prevState.selectedIndex!==this.state.selectedIndex){this.scrollToSelectedPost(true);if(this.isPostFullScreen()){this.showSelectedPost({replaceHistory:true})}}},_popstate:function _popstate(){if(this.state.selectedIndex>-1&&history.scrollRestoration!=="manual"){this.scrollToSelectedPost(false)}},cardClassForPost:function cardClassForPost(post){if(this.props.cardFactory){var externalPostClass=this.props.cardFactory(post);if(externalPostClass){return externalPostClass}}if(post.display_type&DISPLAY_TYPES.X_POST){return CrossPost}if(post.is_site_blocked){return PostBlocked}return Post},scrollToSelectedPost:function scrollToSelectedPost(animate){var HEADER_OFFSET=-80,selectedNode,boundingClientRect,documentElement,windowTop,scrollY;selectedNode=ReactDom.findDOMNode(this).querySelector(".is-selected");if(selectedNode){documentElement=document.documentElement;selectedNode.focus();windowTop=(window.pageYOffset||documentElement.scrollTop)-(documentElement.clientTop||0);boundingClientRect=selectedNode.getBoundingClientRect();scrollY=parseInt(windowTop+boundingClientRect.top+HEADER_OFFSET,10);if(animate){scrollTo({x:0,y:scrollY,duration:200})}else{window.scrollTo(0,scrollY)}}},componentDidMount:function componentDidMount(){this.props.store.on("change",this.updateState);PostStore.on("change",this.updateState);KeyboardShortcuts.on("move-selection-down",this.selectNextItem);KeyboardShortcuts.on("move-selection-up",this.selectPrevItem);KeyboardShortcuts.on("open-selection",this.showSelectedPost);KeyboardShortcuts.on("like-selection",this.toggleLikeOnSelectedPost);KeyboardShortcuts.on("go-to-top",this.goToTop);window.addEventListener("popstate",this._popstate);if("scrollRestoration"in history){history.scrollRestoration="manual"}},componentWillUnmount:function componentWillUnmount(){this.props.store.off("change",this.updateState);PostStore.off("change",this.updateState);KeyboardShortcuts.off("move-selection-down",this.selectNextItem);KeyboardShortcuts.off("move-selection-up",this.selectPrevItem);KeyboardShortcuts.off("open-selection",this.showSelectedPost);KeyboardShortcuts.off("like-selection",this.toggleLikeOnSelectedPost);KeyboardShortcuts.off("go-to-top",this.goToTop);window.removeEventListener("popstate",this._popstate);if("scrollRestoration"in history){history.scrollRestoration="auto"}},componentWillReceiveProps:function componentWillReceiveProps(nextProps){if(nextProps.store!==this.props.store){this.props.store.off("change",this.updateState);nextProps.store.on("change",this.updateState);this.updateState(nextProps.store);this._list&&this._list.reset()}},showSelectedPost:function showSelectedPost(options){var postKey=this.props.store.getSelectedPost(),mappedPost;if(!!postKey){if(postKey.isGap===true){return this._selectedGap.handleClick()}var post=PostStore.get(postKey);if(this.cardClassForPost(post)===CrossPost&&!options.replaceHistory){return this.showFullXPost(XPostHelper.getXPostMetadata(post))}if(!!postKey.feedId){mappedPost={feed_ID:postKey.feedId,feed_item_ID:postKey.postId}}else{mappedPost={site_ID:postKey.blogId,ID:postKey.postId}}this.showFullPost(mappedPost,options)}},toggleLikeOnSelectedPost:function toggleLikeOnSelectedPost(){var postKey=this.props.store.getSelectedPost();var post=void 0;if(postKey&&!postKey.isGap){post=PostStore.get(postKey)}var xPostMetadata=XPostHelper.getXPostMetadata(post);if(!!xPostMetadata.postURL){if(this.isPostFullScreen()&&xPostMetadata.blogId&&xPostMetadata.postId){this.toggleLikeAction(xPostMetadata.blogId,xPostMetadata.postId)}return}if(LikeHelper.shouldShowLikes(post)){this.toggleLikeAction(post.site_ID,post.ID)}},toggleLikeAction:function toggleLikeAction(siteId,postId){var liked=LikeStore.isPostLikedByCurrentUser(siteId,postId);if(liked===null){return}LikeStoreActions[liked?"unlikePost":"likePost"](siteId,postId)},isPostFullScreen:function isPostFullScreen(){return!!window.location.pathname.match(/^\/read\/(blogs|feeds)\/([0-9]+)\/posts\/([0-9]+)$/i)},goToTop:function goToTop(){if(this.state.updateCount&&this.state.updateCount>0){this.showUpdates()}else{FeedStreamStoreActions.selectItem(this.props.store.id,0)}},getVisibleItemIndexes:function getVisibleItemIndexes(){return this._list&&this._list.getVisibleItemIndexes({offsetTop:HEADER_OFFSET_TOP})},selectNextItem:function selectNextItem(){var visibleIndexes=this.getVisibleItemIndexes(),visibleIndex,index,i;if(visibleIndexes&&visibleIndexes.length>0){index=visibleIndexes[0].index;for(i=0;i<visibleIndexes.length;i++){visibleIndex=visibleIndexes[i];if(visibleIndex.bounds.top>0){index=visibleIndex.index;break}}if(index===this.state.selectedIndex){FeedStreamStoreActions.selectNextItem(this.props.store.id,index)}else{FeedStreamStoreActions.selectItem(this.props.store.id,index)}}},selectPrevItem:function selectPrevItem(){var visibleIndexes=this.getVisibleItemIndexes(),visibleIndex,index,i;if(visibleIndexes&&visibleIndexes.length>0){index=visibleIndexes[0].index;for(i=0;i<visibleIndexes.length;i++){visibleIndex=visibleIndexes[i];if(visibleIndex.bounds.top<0){index=visibleIndex.index;break}}if(index===this.state.selectedIndex){FeedStreamStoreActions.selectPrevItem(this.props.store.id,index)}else{FeedStreamStoreActions.selectItem(this.props.store.id,index)}}},fetchNextPage:function fetchNextPage(options){if(this.props.store.isLastPage()||this.props.store.isFetchingNextPage()){return}if(options.triggeredByScroll){this.props.trackScrollPage(this.props.store.getPage()+1)}FeedStreamStoreActions.fetchNextPage(this.props.store.id)},showUpdates:function showUpdates(){this.props.onUpdatesShown();FeedStreamStoreActions.showUpdates(this.props.store.id);if(this._list){this._list.scrollToTop()}},renderLoadingPlaceholders:function renderLoadingPlaceholders(){var count=this.state.posts.length?2:this.props.store.getPerPage(),placeholders=[];times(count,function(i){placeholders.push(React.createElement(PostPlaceholder,{key:"feed-post-placeholder-"+i}))});return placeholders},getPostRef:function getPostRef(postKey){return"feed-post-"+(postKey.feedId||postKey.blogId)+"-"+postKey.postId},showFullXPost:function showFullXPost(xMetadata){if(xMetadata.blogId&&xMetadata.postId){var mappedPost={site_ID:xMetadata.blogId,ID:xMetadata.postId};this.showFullPost(mappedPost)}else{window.open(xMetadata.postURL)}},showFullPost:function showFullPost(post,options){options=options||{};var hashtag="";if(options.comments){hashtag+="#comments"}var method=options&&options.replaceHistory?"replace":"show";if(post.feed_ID&&post.feed_item_ID){page[method]("/read/feeds/"+post.feed_ID+"/posts/"+post.feed_item_ID+hashtag)}else{page[method]("/read/blogs/"+post.site_ID+"/posts/"+post.ID+hashtag)}},renderPost:function renderPost(postKey,index){var _this=this;var post,postState,itemKey,content,PostClass,isSelected=index===this.state.selectedIndex;if(postKey.isGap){return React.createElement(ListGap,{ref:function ref(c){if(isSelected){_this._selectedGap=c}},key:"gap-"+postKey.from+"-"+postKey.to,gap:postKey,selected:isSelected,store:this.props.store})}post=PostStore.get(postKey);postState=post._state;itemKey=this.getPostRef(postKey);if(!post||postState==="minimal"){FeedPostStoreActions.fetchPost(postKey);postState="pending"}switch(postState){case"pending":content=React.createElement(PostPlaceholder,{key:"feed-post-placeholder-"+itemKey});break;case"error":content=React.createElement(PostUnavailable,{key:"feed-post-unavailable-"+itemKey,post:post});break;default:PostClass=this.cardClassForPost(post);if(PostClass===CrossPost){var xMetadata=XPostHelper.getXPostMetadata(post);content=React.createElement(CrossPost,{ref:itemKey,key:itemKey,post:post,isSelected:isSelected,xMetadata:xMetadata,xPostedTo:this.props.store.getSitesCrossPostedTo(xMetadata.commentURL||xMetadata.postURL),handleClick:this.showFullXPost})}else{content=React.createElement(PostClass,{ref:itemKey,key:itemKey,post:post,isSelected:isSelected,xPostedTo:this.props.store.getSitesCrossPostedTo(post.URL),suppressSiteNameLink:this.props.suppressSiteNameLink,showPostHeader:this.props.showPostHeader,showFollowInHeader:this.props.showFollowInHeader,handleClick:this.showFullPost,showPrimaryFollowButtonOnCards:this.props.showPrimaryFollowButtonOnCards})}}return content},render:function render(){var _this2=this;var store=this.props.store,hasNoPosts=store.isLastPage()&&(!this.state.posts||this.state.posts.length===0),body,showingStream;if(hasNoPosts||store.hasRecentError("invalid_tag")){body=this.props.emptyContent;if(!body&&this.props.showDefaultEmptyContentIfMissing){body=React.createElement(EmptyContent,null)}showingStream=false}else{body=React.createElement(InfiniteList,{ref:function ref(c){return _this2._list=c},className:"reader__content",items:this.state.posts,lastPage:this.props.store.isLastPage(),fetchingNextPage:this.props.store.isFetchingNextPage(),guessedItemHeight:GUESSED_POST_HEIGHT,fetchNextPage:this.fetchNextPage,getItemRef:this.getPostRef,renderItem:this.renderPost,renderLoadingPlaceholders:this.renderLoadingPlaceholders});showingStream=true}return React.createElement(Main,{className:classnames("following",this.props.className)},this.props.showMobileBackToSidebar&&React.createElement(MobileBackToSidebar,null,React.createElement("h1",null,this.props.listName)),React.createElement(UpdateNotice,{count:this.state.updateCount,onClick:this.showUpdates}),this.props.children,body,showingStream&&this.props.store.isLastPage()&&this.state.posts.length?React.createElement("div",{className:"infinite-scroll-end"}):null)}})},1761:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _reactDom=__webpack_require__(44);var _reactDom2=_interopRequireDefault(_reactDom);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _find=__webpack_require__(27);var _find2=_interopRequireDefault(_find);var _filter=__webpack_require__(77);var _filter2=_interopRequireDefault(_filter);var _findIndex=__webpack_require__(214);var _findIndex2=_interopRequireDefault(_findIndex);var _map=__webpack_require__(45);var _map2=_interopRequireDefault(_map);var _result=__webpack_require__(2419);var _result2=_interopRequireDefault(_result);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _item=__webpack_require__(1809);var _item2=_interopRequireDefault(_item);var _separator=__webpack_require__(2228);var _separator2=_interopRequireDefault(_separator);var _label=__webpack_require__(2532);var _label2=_interopRequireDefault(_label);var _count=__webpack_require__(730);var _count2=_interopRequireDefault(_count);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var Component=_react2.default.Component;var PropTypes=_react2.default.PropTypes;var SelectDropdown=function(_Component){(0,_inherits3.default)(SelectDropdown,_Component);function SelectDropdown(props){(0,_classCallCheck3.default)(this,SelectDropdown);var _this=(0,_possibleConstructorReturn3.default)(this,(SelectDropdown.__proto__||(0,_getPrototypeOf2.default)(SelectDropdown)).call(this,props));_this.navigateItem=_this.navigateItem.bind(_this);_this.toggleDropdown=_this.toggleDropdown.bind(_this);_this.handleOutsideClick=_this.handleOutsideClick.bind(_this);var initialState={isOpen:false};if(props.options.length){initialState.selected=_this.getInitialSelectedItem(props)}_this.state=initialState;return _this}(0,_createClass3.default)(SelectDropdown,[{key:"componentWillMount",value:function componentWillMount(){this.setState({instanceId:++SelectDropdown.instances})}},{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){if(this.state.isOpen){this.closeDropdown()}if(typeof this.state.selected!=="undefined"&&this.props.initialSelected!==nextProps.initialSelected){this.setState({selected:nextProps.initialSelected})}}},{key:"componentWillUnmount",value:function componentWillUnmount(){window.removeEventListener("click",this.handleOutsideClick)}},{key:"componentDidUpdate",value:function componentDidUpdate(prevProps,prevState){if(this.state.isOpen){window.addEventListener("click",this.handleOutsideClick)}else{window.removeEventListener("click",this.handleOutsideClick)}if(this.state.isOpen!==prevState.isOpen){this.props.onToggle({target:this,open:this.state.isOpen})}}},{key:"getInitialSelectedItem",value:function getInitialSelectedItem(props){props=props||this.props;if(props.initialSelected){return props.initialSelected}if(!props.options.length){return}var selectedItem=(0,_find2.default)(props.options,function(value){return!value.isLabel});return selectedItem&&selectedItem.value}},{key:"dropdownOptions",value:function dropdownOptions(){var refIndex=0;var self=this;if(this.props.children){return _react2.default.Children.map(this.props.children,function(child,index){if(!child){return null}var newChild=_react2.default.cloneElement(child,{ref:child.type===_item2.default?"item-"+refIndex:null,key:"item-"+index,onClick:function onClick(event){self.refs.dropdownContainer.focus();if(typeof child.props.onClick==="function"){child.props.onClick(event)}}});if(child.type===_item2.default){refIndex++}return newChild},this)}return this.props.options.map(function(item,index){if(!item){return _react2.default.createElement(_separator2.default,{key:"dropdown-separator-"+this.state.instanceId+"-"+index})}if(item.isLabel){return _react2.default.createElement(_label2.default,{key:"dropdown-label-"+this.state.instanceId+"-"+index},item.label)}var dropdownItem=_react2.default.createElement(_item2.default,{key:"dropdown-item-"+this.state.instanceId+"-"+item.value,ref:"item-"+refIndex,selected:this.state.selected===item.value,onClick:this.onSelectItem(item),path:item.path},item.label);refIndex++;return dropdownItem},this)}},{key:"render",value:function render(){var dropdownClasses={"select-dropdown":true,"is-compact":this.props.compact,"is-open":this.state.isOpen};if(this.props.className){this.props.className.split(" ").forEach(function(className){dropdownClasses[className]=true})}var dropdownClassName=(0,_classnames2.default)(dropdownClasses);var selectedText=this.props.selectedText?this.props.selectedText:(0,_result2.default)((0,_find2.default)(this.props.options,{value:this.state.selected}),"label");return _react2.default.createElement("div",{style:this.props.style,className:dropdownClassName},_react2.default.createElement("div",{ref:"dropdownContainer",className:"select-dropdown__container",valueLink:this.props.valueLink,onKeyDown:this.navigateItem,tabIndex:this.props.tabIndex||0,"aria-haspopup":"true","aria-owns":"select-submenu-"+this.state.instanceId,"aria-controls":"select-submenu-"+this.state.instanceId,"aria-expanded":this.state.isOpen,"data-tip-target":this.props.tipTarget,onClick:this.toggleDropdown},_react2.default.createElement("div",{id:"select-dropdown-"+this.state.instanceId,className:"select-dropdown__header"},_react2.default.createElement("span",{className:"select-dropdown__header-text"},selectedText),"number"===typeof this.props.selectedCount&&_react2.default.createElement(_count2.default,{count:this.props.selectedCount})),_react2.default.createElement("ul",{id:"select-submenu-"+this.state.instanceId,className:"select-dropdown__options",role:"menu","aria-labelledby":"select-dropdown-"+this.state.instanceId,"aria-expanded":this.state.isOpen},this.dropdownOptions())))}},{key:"toggleDropdown",value:function toggleDropdown(){this.setState({isOpen:!this.state.isOpen})}},{key:"openDropdown",value:function openDropdown(){this.setState({isOpen:true})}},{key:"closeDropdown",value:function closeDropdown(){if(this.state.isOpen){delete this.focused;this.setState({isOpen:false})}}},{key:"onSelectItem",value:function onSelectItem(option){return this.selectItem.bind(this,option)}},{key:"selectItem",value:function selectItem(option){if(!option){return}if(this.props.onSelect){this.props.onSelect(option)}this.setState({selected:option.value});this.refs.dropdownContainer.focus()}},{key:"navigateItem",value:function navigateItem(event){switch(event.keyCode){case 9:this.navigateItemByTabKey(event);break;case 32:case 13:event.preventDefault();this.activateItem();break;case 38:event.preventDefault();this.focusSibling("previous");this.openDropdown();break;case 40:event.preventDefault();this.focusSibling("next");this.openDropdown();break;case 27:event.preventDefault();this.closeDropdown();this.refs.dropdownContainer.focus();break}}},{key:"navigateItemByTabKey",value:function navigateItemByTabKey(event){if(!this.state.isOpen){return}event.preventDefault();var direction=event.shiftKey?"previous":"next";this.focusSibling(direction)}},{key:"activateItem",value:function activateItem(){if(!this.state.isOpen){return this.openDropdown()}document.activeElement.click()}},{key:"focusSibling",value:function focusSibling(direction){if(!this.state.isOpen){return}var items=void 0,focusedIndex=void 0;if(this.props.options.length){items=(0,_map2.default)((0,_filter2.default)(this.props.options,function(item){return item&&!item.isLabel}),"value");focusedIndex=typeof this.focused==="number"?this.focused:items.indexOf(this.state.selected)}else{items=(0,_filter2.default)(this.props.children,function(item){return item.type===_item2.default});focusedIndex=typeof this.focused==="number"?this.focused:(0,_findIndex2.default)(items,function(item){return item.props.selected})}var increment=direction==="previous"?-1:1;var newIndex=focusedIndex+increment;if(newIndex>=items.length||newIndex<0){return}_reactDom2.default.findDOMNode(this.refs["item-"+newIndex].refs.itemLink).focus();this.focused=newIndex}},{key:"handleOutsideClick",value:function handleOutsideClick(event){if(!_reactDom2.default.findDOMNode(this.refs.dropdownContainer).contains(event.target)){this.closeDropdown()}}}]);return SelectDropdown}(Component);SelectDropdown.propTypes={selectedText:PropTypes.string,selectedCount:PropTypes.number,initialSelected:PropTypes.string,className:PropTypes.string,style:PropTypes.object,onSelect:PropTypes.func,onToggle:PropTypes.func,focusSibling:PropTypes.func,tabIndex:PropTypes.number,options:PropTypes.arrayOf(PropTypes.shape({value:PropTypes.string.isRequired,label:PropTypes.string.isRequired,path:PropTypes.string}))};SelectDropdown.defaultProps={options:[],onSelect:function onSelect(){},onToggle:function onToggle(){},style:{}};SelectDropdown.instances=0;exports.default=SelectDropdown;module.exports=exports["default"]},1762:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactRedux=__webpack_require__(15);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _selectors=__webpack_require__(774);var _actions=__webpack_require__(82);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var SidebarNavigation=function(_React$Component){(0,_inherits3.default)(SidebarNavigation,_React$Component);function SidebarNavigation(props){(0,_classCallCheck3.default)(this,SidebarNavigation);var _this=(0,_possibleConstructorReturn3.default)(this,(SidebarNavigation.__proto__||(0,_getPrototypeOf2.default)(SidebarNavigation)).call(this,props));_this.toggleSidebar=_this.toggleSidebar.bind(_this);return _this}(0,_createClass3.default)(SidebarNavigation,[{key:"toggleSidebar",value:function toggleSidebar(event){event.preventDefault();this.props.setLayoutFocus("sidebar")}},{key:"render",value:function render(){return _react2.default.createElement("header",{className:"current-section"},_react2.default.createElement("a",{onTouchTap:this.toggleSidebar,className:this.props.linkClassName},_react2.default.createElement(_gridicon2.default,{icon:"chevron-left"}),this.props.children,_react2.default.createElement("div",null,_react2.default.createElement("p",{className:"current-section__"+this.props.sectionName+"-title"},this.props.sectionTitle),_react2.default.createElement("h1",{className:"current-section__section-title"},this.props.title))))}}]);return SidebarNavigation}(_react2.default.Component);SidebarNavigation.propTypes={title:_react.PropTypes.string,linkClassName:_react.PropTypes.string,sectionTitle:_react.PropTypes.string,sectionName:_react.PropTypes.string.isRequired,setLayoutFocus:_react.PropTypes.func.isRequired};exports.default=(0,_reactRedux.connect)(function(state){return{title:(0,_selectors.getDocumentHeadTitle)(state)}},{setLayoutFocus:_actions.setLayoutFocus})(SidebarNavigation);module.exports=exports["default"]},1763:function(module,exports,__webpack_require__){"use strict";var _assign=__webpack_require__(5);var _assign2=_interopRequireDefault(_assign);var _keys=__webpack_require__(39);var _keys2=_interopRequireDefault(_keys);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var assign=__webpack_require__(34),config=__webpack_require__(12),debug=__webpack_require__(3)("calypso:feed-post-store"),forEach=__webpack_require__(114),isEqual=__webpack_require__(98),forOwn=__webpack_require__(287),clone=__webpack_require__(212),defer=__webpack_require__(385);var Dispatcher=__webpack_require__(42);var emitter=__webpack_require__(36);var _require=__webpack_require__(2366);var runFastRules=_require.runFastRules;var runSlowRules=_require.runSlowRules;var FeedPostActionType=__webpack_require__(1971).action;var FeedStreamActionType=__webpack_require__(1972).action;var ReaderSiteBlockActionType=__webpack_require__(1906).action;var SiteStore=__webpack_require__(1711);var SiteState=__webpack_require__(1738).state;var stats=__webpack_require__(1643);var _posts={},_postsForBlogs={};function blogKey(postKey){return postKey.blogId+"-"+postKey.postId}var FeedPostStore={get:function get(postKey){if(!postKey){return}if(postKey.blogId){return _postsForBlogs[blogKey(postKey)]}else if(postKey.feedId&&postKey.postId){return _posts[postKey.postId]}}};if(config("env")==="development"){assign(FeedPostStore,{_all:function _all(){return _posts},_reset:function _reset(){_posts={};_postsForBlogs={}}})}emitter(FeedPostStore);FeedPostStore.dispatchToken=Dispatcher.register(function(payload){var action=payload&&payload.action;if(!action){return}switch(action.type){case FeedPostActionType.FETCH_FEED_POST:receivePending(action);break;case FeedStreamActionType.RECEIVE_PAGE:case FeedStreamActionType.RECEIVE_UPDATES:case FeedStreamActionType.RECEIVE_GAP:if(!action.error&&action.data.posts){forEach(action.data.posts,receivePostFromPage)}break;case FeedPostActionType.RECEIVE_FEED_POST:if(action.error){var error={status_code:-1,errorCode:"-",message:action.error.toString()};if(action.blogId){receiveBlogError(action.blogId,action.postId,error)}else{receiveError(action.feedId,action.postId,error)}}else if(action.blogId){receiveBlogPost(action.blogId,action.postId,action.data)}else{receivePost(action.feedId,action.postId,action.data)}break;case FeedPostActionType.RECEIVE_NORMALIZED_FEED_POST:setPost(action.data.feed_item_ID,action.data);break;case FeedPostActionType.MARK_FEED_POST_SEEN:markPostSeen(action.data.post,action.data.source);break;case ReaderSiteBlockActionType.BLOCK_SITE:markBlockedSitePosts(action.siteId,true);break;case ReaderSiteBlockActionType.RECEIVE_BLOCK_SITE:markBlockedSitePosts(action.siteId,action.data&&action.data.success);break;case ReaderSiteBlockActionType.UNBLOCK_SITE:markBlockedSitePosts(action.siteId,false);break;case ReaderSiteBlockActionType.RECEIVE_UNBLOCK_SITE:markBlockedSitePosts(action.siteId,!(action.data&&action.data.success));break}});function _setFeedPost(id,post){if(!id){return false}var cachedPost=_posts[id];post.feed_item_ID=id;if(cachedPost&&isEqual(post,cachedPost)){return false}_posts[id]=post;return true}function _setBlogPost(post){if(!post||!post.site_ID||post.is_external){return false}var key=blogKey({blogId:post.site_ID,postId:post.ID});var cachedPost=_postsForBlogs[key];if(cachedPost&&isEqual(post,cachedPost)){return false}_postsForBlogs[key]=post;return true}function setPost(id,post){var changedFeed=_setFeedPost(id,post),changedBlog=_setBlogPost(post),changed=changedFeed||changedBlog;if(changed){FeedPostStore.emit("change")}}function receivePending(action){if(action.blogId){var post={site_ID:action.blogId,ID:action.postId};var currentPost=_postsForBlogs[blogKey(action.blogId,action.postId)];post=assign(post,currentPost,{_state:"pending"});setPost(null,post)}else{var _post={feed_ID:action.feedId,feed_item_ID:action.postId};var _currentPost=_posts[action.postId];_post=assign(_post,_currentPost,{_state:"pending"});setPost(action.postId,_post)}}function receivePostFromPage(newPost){if(!(newPost&&newPost.ID)){return}if(newPost.feed_ID&&!newPost.site_ID&&newPost.ID&&!_posts[newPost.ID]){setPost(newPost.ID,assign({},newPost,{_state:"minimal"}))}else if(newPost.site_ID&&!_postsForBlogs[blogKey({blogId:newPost.site_ID,postId:newPost.ID})]){setPost(null,assign({},newPost,{_state:"minimal"}))}}function receivePost(feedId,postId,post){if(!post){return}if(post.errors||post.status_code===404){receiveError(feedId,postId,post)}else{normalizePost(feedId,postId,post)}}function receiveBlogPost(blogId,postId,post){if(!post){return}if(post.errors||post.status_code===404){post.site_ID=blogId;post.ID=postId;post.is_external=false;receiveError(null,null,post)}else{normalizePost(null,null,post)}}function receiveError(feedId,postId,error){var statusCode=void 0,errorCode=void 0,message=void 0;if(error.status_code){statusCode=error.status_code;if(error.errors){errorCode=error.errors.error;message=error.errors.message}}else{errorCode=(0,_keys2.default)(error.errors)[0];if(errorCode){statusCode=error.error_data[errorCode];message=error.errors[errorCode][0]}}setPost(postId,{feed_ID:feedId,feed_item_ID:postId,site_ID:error.site_ID,ID:error.ID,date:error.date,_state:"error",message:message,errorCode:errorCode,statusCode:statusCode})}function receiveBlogError(blogId,postId,error){error.site_ID=blogId;error.ID=postId;error.is_external=false;receiveError(null,null,error)}function normalizePost(feedId,postId,post){if(!post){debug("post is required");return}var normalizedPost=runFastRules(post);setPost(postId,normalizedPost);defer(function(){runSlowRules(normalizedPost).then(setPost.bind(null,postId))})}function markPostSeen(post){if(!post){return}var originalPost=post;if(!post._seen){post=(0,_assign2.default)({_seen:true},post)}if(post.site_ID){var site=SiteStore.get(post.site_ID);var isNotAdmin=!(site&&site.getIn(["capabilities","manage_options"],false));if(site&&site.get("state")===SiteState.COMPLETE){if(site.get("is_private")||isNotAdmin){stats.pageViewForPost(site.get("ID"),site.get("URL"),post.ID,site.get("is_private"))}}}if(originalPost!==post){setPost(post.feed_item_ID,post)}}function markBlockedSitePosts(siteId,isSiteBlocked){forOwn(_postsForBlogs,function(post){if(post.site_ID===siteId&&post.is_site_blocked!==isSiteBlocked){var newPost=clone(post);newPost.is_site_blocked=isSiteBlocked;setPost(newPost.feed_item_ID,newPost)}})}module.exports=FeedPostStore},1764:function(module,exports,__webpack_require__){"use strict";var _toArray2=__webpack_require__(838);var _toArray3=_interopRequireDefault(_toArray2);
function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var config=__webpack_require__(12),Dispatcher=__webpack_require__(42),FeedStream=__webpack_require__(2606),PagedStream=__webpack_require__(2607),FeedStreamCache=__webpack_require__(2241),analytics=__webpack_require__(20),forEach=__webpack_require__(114),wpcomUndoc=__webpack_require__(28).undocumented();function feedKeyMaker(post){return{feedId:post.feed_ID,postId:post.ID}}function siteKeyMaker(post){return{blogId:post.site_ID,postId:post.ID}}function mixedKeyMaker(post){if(post.feed_ID&&post.feed_item_ID){return{feedId:post.feed_ID,postId:post.feed_item_ID}}return siteKeyMaker(post)}function addMetaToNextPageFetch(params){params.meta="post,discover_original_post"}function limitSiteParams(params){params.fields="ID,site_ID,date"}function limitSiteParamsForLikes(params){limitSiteParams(params);params.fields+=",date_liked"}function trainTracksProxyForStream(stream,callback){return function(err,response){var eventName="calypso_traintracks_render";if(response&&response.algorithm){stream.algorithm=response.algorithm}forEach(response&&response.posts,function(post){if(post.railcar){analytics.tracks.recordEvent(eventName,post.railcar)}});callback(err,response)}}function getStoreForFeed(storeId){var feedId=storeId.split(":")[1],fetcher=function fetchFeedById(query,callback){query.ID=feedId;wpcomUndoc.readFeedPosts(query,callback)};return new FeedStream({id:storeId,fetcher:fetcher,keyMaker:feedKeyMaker,onNextPageFetch:addMetaToNextPageFetch})}function getStoreForTag(storeId){var slug=storeId.split(":")[1];var fetcher=function fetcher(query,callback){query.tag=slug;wpcomUndoc.readTagPosts(query,callback)};if(config.isEnabled("reader/tags-with-elasticsearch")){return new PagedStream({id:storeId,fetcher:fetcher,keyMaker:siteKeyMaker,perPage:5})}else{return new FeedStream({id:storeId,fetcher:fetcher,keyMaker:mixedKeyMaker,onGapFetch:limitSiteParams,onUpdateFetch:limitSiteParams,dateProperty:"tagged_on"})}}function getStoreForSearch(storeId){var slug=storeId.split(":")[1];var stream=new PagedStream({id:storeId,fetcher:fetcher,keyMaker:siteKeyMaker,perPage:5});function fetcher(query,callback){query.q=slug;query.meta="site";wpcomUndoc.readSearch(query,trainTracksProxyForStream(stream,callback))}return stream}function getStoreForList(storeId){var listKey=storeId.split(":")[1];var _listKey$split=listKey.split("-");var _listKey$split2=(0,_toArray3.default)(_listKey$split);var listOwner=_listKey$split2[0];var listSlug=_listKey$split2.slice(1);var fetcher=function fetcher(query,callback){query.owner=listOwner;query.slug=listSlug.join("-");wpcomUndoc.readListPosts(query,callback)};return new FeedStream({id:storeId,fetcher:fetcher,keyMaker:mixedKeyMaker,onGapFetch:limitSiteParams,onUpdateFetch:limitSiteParams})}function getStoreForSite(storeId){var siteId=storeId.split(":")[1],fetcher=function fetcher(query,callback){query.site=siteId;wpcomUndoc.readSitePosts(query,callback)};return new FeedStream({id:storeId,fetcher:fetcher,keyMaker:siteKeyMaker,onGapFetch:limitSiteParams,onUpdateFetch:limitSiteParams})}function getStoreForFeatured(storeId){var siteId=storeId.split(":")[1],fetcher=function fetcher(query,callback){wpcomUndoc.readSiteFeatured(siteId,query,callback)};return new FeedStream({id:storeId,fetcher:fetcher,keyMaker:siteKeyMaker,onGapFetch:limitSiteParams,onUpdateFetch:limitSiteParams})}function getStoreForRecommendedPosts(storeId){var stream=new PagedStream({id:storeId,fetcher:fetcher,keyMaker:siteKeyMaker,perPage:5});function fetcher(query,callback){if("coldstart_posts"===storeId){query.algorithm="read:recommendations:posts/es/2"}else{query.algorithm="read:recommendations:posts/es/1"}wpcomUndoc.readRecommendedPosts(query,trainTracksProxyForStream(stream,callback))}var oldNextPageFetch=stream.onNextPageFetch;stream.onNextPageFetch=function(params){oldNextPageFetch.call(this,params);params.algorithm=stream.algorithm};return stream}function feedStoreFactory(storeId){var store=FeedStreamCache.get(storeId);if(store){return store}if(storeId==="following"){store=new FeedStream({id:storeId,fetcher:wpcomUndoc.readFollowing.bind(wpcomUndoc),keyMaker:feedKeyMaker,onNextPageFetch:addMetaToNextPageFetch})}else if(storeId==="a8c"){store=new FeedStream({id:storeId,fetcher:wpcomUndoc.readA8C.bind(wpcomUndoc),keyMaker:feedKeyMaker,onNextPageFetch:addMetaToNextPageFetch})}else if(storeId==="likes"){store=new FeedStream({id:storeId,fetcher:wpcomUndoc.readLiked.bind(wpcomUndoc),keyMaker:siteKeyMaker,onGapFetch:limitSiteParamsForLikes,onUpdateFetch:limitSiteParamsForLikes,dateProperty:"date_liked"})}else if(storeId==="recommendations_posts"){store=getStoreForRecommendedPosts(storeId)}else if(storeId==="coldstart_posts"){store=getStoreForRecommendedPosts(storeId)}else if(storeId.indexOf("feed:")===0){store=getStoreForFeed(storeId)}else if(storeId.indexOf("tag:")===0){store=getStoreForTag(storeId)}else if(storeId.indexOf("list:")===0){store=getStoreForList(storeId)}else if(storeId.indexOf("site:")===0){store=getStoreForSite(storeId)}else if(storeId.indexOf("featured:")===0){store=getStoreForFeatured(storeId)}else if(storeId.indexOf("search:")===0){store=getStoreForSearch(storeId)}else{throw new Error("Unknown feed store ID")}store.dispatchToken=Dispatcher.register(store.handlePayload.bind(store));FeedStreamCache.set(storeId,store);return store}module.exports=feedStoreFactory},1767:function(module,exports,__webpack_require__){"use strict";var keyMirror=__webpack_require__(116);module.exports.action=keyMirror({FOLLOW_READER_FEED:null,UNFOLLOW_READER_FEED:null,RECEIVE_FOLLOW_READER_FEED:null,RECEIVE_UNFOLLOW_READER_FEED:null,DISMISS_FOLLOW_ERROR:null,RECEIVE_FEED_SUBSCRIPTIONS:null,FETCH_NEXT_FEED_SUBSCRIPTIONS_PAGE:null});module.exports.error=keyMirror({UNABLE_TO_FOLLOW:null,UNABLE_TO_UNFOLLOW:null});module.exports.state=keyMirror({SUBSCRIBED:null,UNSUBSCRIBED:null})},1768:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _assign=__webpack_require__(5);var _assign2=_interopRequireDefault(_assign);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var debug=__webpack_require__(3)("calypso:reader:feed-subs");var Dispatcher=__webpack_require__(42),reject=__webpack_require__(209),findLast=__webpack_require__(1867),get=__webpack_require__(24),last=__webpack_require__(215),Immutable=__webpack_require__(113),clone=__webpack_require__(212),map=__webpack_require__(45),forEach=__webpack_require__(114);var Emitter=__webpack_require__(36),ActionTypes=__webpack_require__(1767).action,ErrorTypes=__webpack_require__(1767).error,FeedSubscriptionHelper=__webpack_require__(2267),States=__webpack_require__(1767).state,FeedActionTypes=__webpack_require__(1749).action;var subscriptionsTemplate={list:Immutable.List(),count:0};var subscriptions=clone(subscriptionsTemplate),errors=[],perPage=50,currentPage=0,_isLastPage=false,_isFetching=false,totalSubscriptions=0,subscriptionTemplate=Immutable.Map({state:States.SUBSCRIBED});var FeedSubscriptionStore={receiveFollow:function receiveFollow(action){var subscription={URL:action.data.url};debug("receiveFollow: "+action.data.url);if(addSubscription(subscription)){FeedSubscriptionStore.emit("change")}},receiveUnfollow:function receiveUnfollow(action){var siteUrl=FeedSubscriptionHelper.prepareSiteUrl(action.data.url);debug("receiveUnfollow: "+siteUrl);if(removeSubscription({URL:siteUrl})){FeedSubscriptionStore.emit("change")}},receiveFollowResponse:function receiveFollowResponse(action){var updatedSubscriptionInfo=void 0;var siteUrl=FeedSubscriptionHelper.prepareSiteUrl(action.url);debug("receiveFollowResponse: "+siteUrl);if(!action.error&&action.data&&action.data.subscribed&&!action.data.info){FeedSubscriptionStore.removeErrorsForSiteUrl(siteUrl);if(action.data.subscription){updatedSubscriptionInfo=action.data.subscription;updatedSubscriptionInfo.state=States.SUBSCRIBED;updateSubscription(siteUrl,updatedSubscriptionInfo);debug("updateSubscription "+siteUrl);debug(updatedSubscriptionInfo);FeedSubscriptionStore.emit("add",this.getSubscription(siteUrl))}FeedSubscriptionStore.emit("change");return}var errorInfo=get(action,"data.info");errors.push({URL:action.url,errorType:ErrorTypes.UNABLE_TO_FOLLOW,info:errorInfo,timestamp:Date.now()});if(errorInfo!=="already_subscribed"){removeSubscription({URL:siteUrl})}FeedSubscriptionStore.emit("change")},receiveUnfollowResponse:function receiveUnfollowResponse(action){if(!action.error&&action.data&&!action.data.subscribed){debug("receiveUnfollowResponse: "+action.url);FeedSubscriptionStore.removeErrorsForSiteUrl(action.url);FeedSubscriptionStore.emit("remove",action.url);return}errors.push({URL:action.url,errorType:ErrorTypes.UNABLE_TO_UNFOLLOW,info:get(action,"data.info"),timestamp:Date.now()});if(addSubscription({URL:action.url})){FeedSubscriptionStore.emit("change")}},receiveSubscriptions:function receiveSubscriptions(data){if(!(data&&data.subscriptions)){return}var subscriptionsWithState=map(data.subscriptions,function(sub){sub.URL=FeedSubscriptionHelper.prepareSiteUrl(sub.URL);return subscriptionTemplate.merge(sub)});if(data.number===0||data.page===40){_isLastPage=true}subscriptions.list=subscriptions.list.asMutable();forEach(subscriptionsWithState,function(subscription){_acceptSubscription(subscription,false)});subscriptions.list=subscriptions.list.sort(function(a,b){var aDate=a.get("date_subscribed"),bDate=b.get("date_subscribed");if(aDate>bDate){return-1}if(aDate<bDate){return 1}return b.get("feed_ID")-a.get("feed_ID")});subscriptions.list=subscriptions.list.asImmutable();currentPage=data.page;if(currentPage===1){totalSubscriptions=data.total_subscriptions}subscriptions.count=subscriptions.list.count();FeedSubscriptionStore.emit("change")},getIsFollowingBySiteUrl:function getIsFollowingBySiteUrl(siteUrl){return!!this.getSubscription(siteUrl)},getSubscriptions:function getSubscriptions(){return subscriptions},getSubscription:function getSubscription(siteUrl){var preparedSiteUrl=FeedSubscriptionHelper.prepareSiteUrl(siteUrl);return subscriptions.list.find(function(subscription){return subscription.get("URL")===preparedSiteUrl&&subscription.get("state")===States.SUBSCRIBED})},getTotalSubscriptions:function getTotalSubscriptions(){return totalSubscriptions},getLastError:function getLastError(){return last(errors)},isFetching:function isFetching(){return _isFetching},setIsFetching:function setIsFetching(val){_isFetching=val;FeedSubscriptionStore.emitChange()},getLastErrorBySiteUrl:function getLastErrorBySiteUrl(siteUrl){return findLast(errors,{URL:FeedSubscriptionHelper.prepareSiteUrl(siteUrl)})},removeErrorsForSiteUrl:function removeErrorsForSiteUrl(siteUrl){var newErrors=reject(errors,{URL:FeedSubscriptionHelper.prepareSiteUrl(siteUrl)});if(newErrors.length===errors.length){return false}errors=newErrors;return true},dismissError:function dismissError(error){this.removeErrorsForSiteUrl(error.data.URL);FeedSubscriptionStore.emit("change")},clearErrors:function clearErrors(){errors=[]},clearSubscriptions:function clearSubscriptions(){subscriptions=clone(subscriptionsTemplate);totalSubscriptions=0},isLastPage:function isLastPage(){return _isLastPage},getCurrentPage:function getCurrentPage(){return currentPage},getPerPage:function getPerPage(){return perPage},setPerPage:function setPerPage(newPerPage){perPage=newPerPage}};function _acceptSubscription(subscription){var addToTop=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var subs=subscriptions.list;var existingIndex=subs.findIndex(function(value){return value.get("URL")===subscription.get("URL")});if(existingIndex!==-1){subs=subs.mergeIn([existingIndex],subscription);if(subs!==subscriptions.list){subscriptions.list=subs;return true}return false}subscriptions.list=subs[addToTop?"unshift":"push"](subscription);return true}function addSubscription(subscription){var addToTop=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(!subscription||!subscription.URL){return}var preparedSiteUrl=FeedSubscriptionHelper.prepareSiteUrl(subscription.URL);var existingSubscription=subscriptions.list.find(function(sub){return sub.get("URL")===preparedSiteUrl});if(existingSubscription){return updateSubscription(preparedSiteUrl,subscriptionTemplate)}subscription.URL=preparedSiteUrl;var newSubscription=subscriptionTemplate.merge(subscription);_acceptSubscription(newSubscription,addToTop);subscriptions.count++;totalSubscriptions++;return true}function updateSubscription(url,newSubscriptionInfo){if(!url||!newSubscriptionInfo){return}var preparedSiteUrl=FeedSubscriptionHelper.prepareSiteUrl(url);var subscriptionIndex=subscriptions.list.findIndex(function(item){return item.get("URL")===preparedSiteUrl});if(subscriptionIndex===-1){return}var existingSubscription=subscriptions.list.get(subscriptionIndex);newSubscriptionInfo=Immutable.fromJS(newSubscriptionInfo);if(existingSubscription.get("state")===States.UNSUBSCRIBED&&newSubscriptionInfo.get("state")===States.SUBSCRIBED){newSubscriptionInfo=newSubscriptionInfo.merge({is_refollow:true})}var newSubscriptionInfoUrl=newSubscriptionInfo.get("URL");if(newSubscriptionInfoUrl){debug("New subscription URL is "+newSubscriptionInfoUrl);newSubscriptionInfo=newSubscriptionInfo.set("URL",FeedSubscriptionHelper.prepareSiteUrl(newSubscriptionInfoUrl))}var updatedSubscription=existingSubscription.merge(newSubscriptionInfo);var updatedSubscriptionsList=subscriptions.list.set(subscriptionIndex,updatedSubscription);if(updatedSubscriptionsList===subscriptions.list){return false}subscriptions.list=updatedSubscriptionsList;if(existingSubscription.get("state")===States.UNSUBSCRIBED&&updatedSubscription.get("state")===States.SUBSCRIBED){totalSubscriptions++}return true}function removeSubscription(subscription){if(!subscription||!subscription.URL){return}var newSubscriptionInfo={state:States.UNSUBSCRIBED};updateSubscription(subscription.URL,newSubscriptionInfo);if(totalSubscriptions>0){totalSubscriptions--}return true}Emitter(FeedSubscriptionStore);FeedSubscriptionStore.setMaxListeners(100);FeedSubscriptionStore.dispatchToken=Dispatcher.register(function(payload){var action=payload.action;if(!action){return}switch(action.type){case ActionTypes.FOLLOW_READER_FEED:FeedSubscriptionStore.receiveFollow(action);break;case ActionTypes.UNFOLLOW_READER_FEED:FeedSubscriptionStore.receiveUnfollow(action);break;case ActionTypes.RECEIVE_FOLLOW_READER_FEED:FeedSubscriptionStore.receiveFollowResponse(action);break;case ActionTypes.RECEIVE_UNFOLLOW_READER_FEED:FeedSubscriptionStore.receiveUnfollowResponse(action);break;case ActionTypes.DISMISS_FOLLOW_ERROR:FeedSubscriptionStore.dismissError(action);break;case ActionTypes.RECEIVE_FEED_SUBSCRIPTIONS:if(action.data&&!action.data.errors){FeedSubscriptionStore.receiveSubscriptions(action.data)}break;case FeedActionTypes.RECEIVE_FETCH:if(action.data&&action.data.is_following){var subscription=(0,_assign2.default)({},action.data,{URL:action.data.feed_URL});addSubscription(subscription)}break}});exports.default=FeedSubscriptionStore;module.exports=exports["default"]},1769:function(module,exports,__webpack_require__){"use strict";var _slicedToArray2=__webpack_require__(137);var _slicedToArray3=_interopRequireDefault(_slicedToArray2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var assign=__webpack_require__(34),omit=__webpack_require__(18),url=__webpack_require__(70);var IMAGE_SCALE_FACTOR=typeof window!=="undefined"&&window.devicePixelRatio&&window.devicePixelRatio>1?2:1;function resizeImageUrl(imageUrl,params){var parsedUrl=url.parse(imageUrl,true,true);if(!/^https?:$/.test(parsedUrl.protocol)){return imageUrl}parsedUrl.query=omit(parsedUrl.query,["w","h","resize","fit"]);var localParams=assign({},params);if(localParams.w){localParams.w*=IMAGE_SCALE_FACTOR}if(localParams.h){localParams.h*=IMAGE_SCALE_FACTOR}if(localParams.resize){var _localParams$resize$s=localParams.resize.split(",");var _localParams$resize$s2=(0,_slicedToArray3.default)(_localParams$resize$s,2);var width=_localParams$resize$s2[0];var height=_localParams$resize$s2[1];width*=IMAGE_SCALE_FACTOR;height*=IMAGE_SCALE_FACTOR;localParams.resize=width+","+height}parsedUrl.query=assign(parsedUrl.query,localParams);delete parsedUrl.search;return url.format(parsedUrl)}module.exports=resizeImageUrl},1790:function(module,exports,__webpack_require__){"use strict";var debug=__webpack_require__(3)("calyso:reader:post-time"),React=__webpack_require__(1),PureRenderMixin=__webpack_require__(111);var smartSetState=__webpack_require__(1710),ticker=__webpack_require__(2665),humanDate=__webpack_require__(817);var PostTime=React.createClass({displayName:"PostTime",mixins:[PureRenderMixin],componentWillMount:function componentWillMount(){this._update()},componentDidMount:function componentDidMount(){debug("listening for ticks");ticker.on("tick",this._update)},componentWillReceiveProps:function componentWillReceiveProps(nextProps){this._update(nextProps.date)},componentWillUnmount:function componentWillUnmount(){ticker.off("tick",this._update)},smartSetState:smartSetState,_update:function _update(date){date=date||this.props.date;this.smartSetState({ago:humanDate(date)})},render:function render(){var date=this.props.date;return React.createElement("time",{className:this.props.className,dateTime:date,title:this.moment(date).format("llll")},this.state.ago)}});module.exports=PostTime},1809:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1),classNames=__webpack_require__(10);var Count=__webpack_require__(730);var SelectDropdownItem=React.createClass({displayName:"SelectDropdownItem",propTypes:{children:React.PropTypes.string.isRequired,path:React.PropTypes.string,selected:React.PropTypes.bool,onClick:React.PropTypes.func,count:React.PropTypes.number},getDefaultProps:function getDefaultProps(){return{selected:false}},render:function render(){var optionClassName=classNames(this.props.className,{"select-dropdown__item":true,"is-selected":this.props.selected,"is-disabled":this.props.disabled});return React.createElement("li",{className:"select-dropdown__option"},React.createElement("a",{ref:"itemLink",href:this.props.path,className:optionClassName,onClick:this.props.disabled?null:this.props.onClick,"data-bold-text":this.props.value||this.props.children,role:"menuitem",tabIndex:0,"aria-selected":this.props.selected},React.createElement("span",{className:"select-dropdown__item-text"},this.props.children),"number"===typeof this.props.count&&React.createElement("span",{"data-text":this.props.count,className:"select-dropdown__item-count"},React.createElement(Count,{count:this.props.count}))))}});module.exports=SelectDropdownItem},1813:function(module,exports,__webpack_require__){"use strict";var assign=__webpack_require__(34),defer=__webpack_require__(385);var Dispatcher=__webpack_require__(42),ACTION=__webpack_require__(1971).action,PostFetcher=__webpack_require__(2605),wpcom=__webpack_require__(28);var feedPostFetcher=void 0,blogPostFetcher=void 0,FeedPostActions=void 0;feedPostFetcher=new PostFetcher({makeRequest:function makeRequest(postKey){return wpcom.undocumented().readFeedPost(postKey)},onFetch:function onFetch(postKey){Dispatcher.handleViewAction({type:ACTION.FETCH_FEED_POST,feedId:postKey.feedId,postId:postKey.postId})},onError:function onError(error,postKey){FeedPostActions.receivePost(error,null,{feedId:postKey.feedId,postId:postKey.postId})},onPostReceived:function onPostReceived(feedId,postId,post){FeedPostActions.receivePost(null,post,{feedId:feedId,postId:postId})}});blogPostFetcher=new PostFetcher({makeRequest:function makeRequest(postKey){return wpcom.undocumented().readSitePost({site:postKey.blogId,postId:postKey.postId})},onFetch:function onFetch(postKey){Dispatcher.handleViewAction({type:ACTION.FETCH_FEED_POST,blogId:postKey.blogId,postId:postKey.postId})},onError:function onError(error,postKey){FeedPostActions.receivePost(error,null,{blogId:postKey.blogId,postId:postKey.postId})},onPostReceived:function onPostReceived(blogId,postId,post){FeedPostActions.receivePost(null,post,{blogId:blogId,postId:postId})}});FeedPostActions={fetchPost:function fetchPost(postKey){var fetcher=postKey.blogId?blogPostFetcher:feedPostFetcher;fetcher.add(postKey)},receivePost:function receivePost(error,data,postKey){var fetcher=postKey.blogId?blogPostFetcher:feedPostFetcher;if(data){fetcher.remove(postKey)}Dispatcher.handleServerAction(assign({type:ACTION.RECEIVE_FEED_POST,data:data,error:error},postKey))},markSeen:function markSeen(post,source){defer(function(){Dispatcher.handleViewAction({type:ACTION.MARK_FEED_POST_SEEN,data:{post:post,source:source}})})}};module.exports=FeedPostActions},1815:function(module,exports,__webpack_require__){"use strict";var Dispatcher=__webpack_require__(42),ActionTypes=__webpack_require__(1738).action,wpcom=__webpack_require__(28);var fetchingSites={};var SitesStoreActions={fetch:function fetch(siteId){if(fetchingSites[siteId]){return}fetchingSites[siteId]=true;wpcom.undocumented().readSite({site:siteId},function(error,data){delete fetchingSites[siteId];SitesStoreActions.receiveFetch(siteId,error,data)})},receiveFetch:function receiveFetch(siteId,error,data){Dispatcher.handleServerAction({type:ActionTypes.RECEIVE_FETCH,siteId:siteId,error:error,data:data})}};module.exports=SitesStoreActions},1834:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _noop=__webpack_require__(38);var _noop2=_interopRequireDefault(_noop);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var CommentButton=_react2.default.createClass({displayName:"CommentButton",propTypes:{onClick:_react2.default.PropTypes.func,tagName:_react2.default.PropTypes.string,commentCount:_react2.default.PropTypes.number,showLabel:_react2.default.PropTypes.bool},getDefaultProps:function getDefaultProps(){return{onClick:_noop2.default,tagName:"li",size:24,commentCount:0,showLabel:true}},onClick:function onClick(event){event.preventDefault()},onTap:function onTap(){this.props.onClick()},render:function render(){var label=void 0;var containerTag=this.props.tagName,commentCount=this.props.commentCount,commentCountComponent=_react2.default.createElement("span",{className:"comment-button__label-count"},commentCount);if(commentCount===0){label=_react2.default.createElement("span",{className:"comment-button__label-status"},this.translate("Comment",{context:"verb"}))}else{label=this.translate("{{count/}}{{span}}Comment{{/span}}","{{count/}}{{span}}Comments{{/span}}",{components:{count:commentCountComponent,span:_react2.default.createElement("span",{className:"comment-button__label-status"})},count:commentCount})}var labelElement=_react2.default.createElement("span",{className:"comment-button__label"},this.props.showLabel?label:commentCount>0&&commentCountComponent);return _react2.default.createElement(containerTag,{className:"comment-button",onTouchTap:this.onTap,onClick:this.onClick},_react2.default.createElement(_gridicon2.default,{icon:"comment",size:this.props.size,className:"comment-button__icon"}),labelElement)}});exports.default=CommentButton;module.exports=exports["default"]},1841:function(module,exports){"use strict";var inflight={};module.exports={requestInflight:function requestInflight(requestKey){return requestKey in inflight},requestTracker:function requestTracker(requestKey,callback){inflight[requestKey]=true;return function(error,data){delete inflight[requestKey];callback(error,data)}}}},1845:function(module,exports,__webpack_require__){"use strict";var get=__webpack_require__(24);var Dispatcher=__webpack_require__(42),wpcom=__webpack_require__(28),ActionTypes=__webpack_require__(1767).action,FeedSubscriptionHelper=__webpack_require__(2267),inflight=__webpack_require__(1841),FeedSubscriptionStore=__webpack_require__(1768),SiteStoreActionTypes=__webpack_require__(1738).action,FeedStoreActionTypes=__webpack_require__(1749).action;var FeedSubscriptionActions={follow:function follow(url,fetchMeta){var meta;if(!url){return}var preparedUrl=FeedSubscriptionHelper.prepareSiteUrl(url);if(fetchMeta){meta="feed,site"}Dispatcher.handleViewAction({type:ActionTypes.FOLLOW_READER_FEED,url:url,data:{url:preparedUrl}});wpcom.undocumented().followReaderFeed({url:preparedUrl,meta:meta},function(error,data){Dispatcher.handleServerAction({type:ActionTypes.RECEIVE_FOLLOW_READER_FEED,url:preparedUrl,data:data,error:error});receiveSubscriptionMeta(data)})},unfollow:function unfollow(url,blogId){if(!url){return}var preparedUrl=FeedSubscriptionHelper.prepareSiteUrl(url);Dispatcher.handleViewAction({type:ActionTypes.UNFOLLOW_READER_FEED,url:url,data:{url:preparedUrl}});wpcom.undocumented().unfollowReaderFeed({url:preparedUrl},function(error,data){Dispatcher.handleServerAction({type:ActionTypes.RECEIVE_UNFOLLOW_READER_FEED,url:preparedUrl,blogId:blogId,data:data,error:error})})},dismissError:function dismissError(error){if(!error){return}Dispatcher.handleViewAction({type:ActionTypes.DISMISS_FOLLOW_ERROR,data:error})},fetch:function fetch(params,cb){var requestKey="following_mine",callback;if(!params){params=getNextPageParams()}requestKey=requestKey+"_page"+params.page;if(inflight.requestInflight(requestKey)){return}callback=inflight.requestTracker(requestKey,function(error,data){FeedSubscriptionStore.setIsFetching(false);FeedSubscriptionActions.receiveFollowingList(error,data);if(cb){cb(error,data)}});FeedSubscriptionStore.setIsFetching(true);wpcom.undocumented().readFollowingMine(params,callback)},fetchAll:function fetchAll(){var processKey="following_mine_all";if(inflight.requestInflight(processKey)){return}var onDone=inflight.requestTracker(processKey,function(){});function _loop(err){if(err||FeedSubscriptionStore.isLastPage()){onDone();return}FeedSubscriptionActions.fetchNextPage(_loop)}_loop()},fetchNextPage:function fetchNextPage(cb){var params;if(FeedSubscriptionStore.isLastPage()){return}Dispatcher.handleViewAction({type:ActionTypes.FETCH_NEXT_FEED_SUBSCRIPTIONS_PAGE});params=getNextPageParams();FeedSubscriptionActions.fetch(params,cb)},receiveFollowingList:function receiveFollowingList(error,data){Dispatcher.handleServerAction({type:ActionTypes.RECEIVE_FEED_SUBSCRIPTIONS,error:error,data:data});if(!data||!data.subscriptions||!data.subscriptions.length){return}var sites=[],feeds=[];data.subscriptions.forEach(function(sub){var site=get(sub,"meta.data.site"),feed=get(sub,"meta.data.feed");if(site){sites.push(site)}if(feed){feeds.push(feed)}});if(sites.length>0){Dispatcher.handleServerAction({type:SiteStoreActionTypes.RECEIVE_BULK_UPDATE,data:sites})}if(feeds.length>0){Dispatcher.handleServerAction({type:FeedStoreActionTypes.RECEIVE_BULK_UPDATE,data:feeds})}}};function getNextPageParams(){var params={number:FeedSubscriptionStore.getPerPage(),meta:"feed,site"},currentPage=FeedSubscriptionStore.getCurrentPage();if(currentPage){params.page=currentPage+1}return params}function receiveSubscriptionMeta(subscription){if(get(subscription,"meta.data.site")){Dispatcher.handleServerAction({type:SiteStoreActionTypes.RECEIVE_FETCH,siteId:subscription.meta.data.site.ID,data:subscription.meta.data.site})}if(get(subscription,"meta.data.feed")){Dispatcher.handleServerAction({type:FeedStoreActionTypes.RECEIVE_FETCH,feedId:subscription.meta.data.feed.feed_ID,data:subscription.meta.data.feed})}}module.exports=FeedSubscriptionActions},1857:function(module,exports,__webpack_require__){"use strict";var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);var _stats=__webpack_require__(1643);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var React=__webpack_require__(1);var postStore=__webpack_require__(1763);var LikeButtonContainer=__webpack_require__(2445);var ReaderLikeButton=React.createClass({displayName:"ReaderLikeButton",recordLikeToggle:function recordLikeToggle(liked){var post=postStore.get({blogId:this.props.siteId,postId:this.props.postId});(0,_stats.recordAction)(liked?"liked_post":"unliked_post");(0,_stats.recordGaEvent)(liked?"Clicked Like Post":"Clicked Unlike Post");(0,_stats.recordTrackForPost)(liked?"calypso_reader_article_liked":"calypso_reader_article_unliked",post,{context:this.props.fullPost?"full-post":"card"})},render:function render(){return React.createElement(LikeButtonContainer,(0,_extends3.default)({},this.props,{onLikeToggle:this.recordLikeToggle}))}});module.exports=ReaderLikeButton},1859:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getSubscribedLists=undefined;exports.isRequestingList=isRequestingList;exports.isRequestingSubscribedLists=isRequestingSubscribedLists;exports.isUpdatedList=isUpdatedList;exports.hasError=hasError;exports.getListByOwnerAndSlug=getListByOwnerAndSlug;exports.isSubscribedByOwnerAndSlug=isSubscribedByOwnerAndSlug;exports.isMissingByOwnerAndSlug=isMissingByOwnerAndSlug;var _filter=__webpack_require__(77);var _filter2=_interopRequireDefault(_filter);var _includes=__webpack_require__(30);var _includes2=_interopRequireDefault(_includes);var _sortBy=__webpack_require__(136);var _sortBy2=_interopRequireDefault(_sortBy);var _find=__webpack_require__(27);var _find2=_interopRequireDefault(_find);var _has=__webpack_require__(175);var _has2=_interopRequireDefault(_has);var _createSelector=__webpack_require__(100);var _createSelector2=_interopRequireDefault(_createSelector);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function isRequestingList(state){return!!state.reader.lists.isRequestingList}function isRequestingSubscribedLists(state){return!!state.reader.lists.isRequestingLists}var getSubscribedLists=exports.getSubscribedLists=(0,_createSelector2.default)(function(state){return(0,_sortBy2.default)((0,_filter2.default)(state.reader.lists.items,function(item){return(0,_includes2.default)(state.reader.lists.subscribedLists,item.ID)}),"slug")},function(state){return[state.reader.lists.items,state.reader.lists.subscribedLists]});function isUpdatedList(state,listId){if(!(0,_has2.default)(state,"reader.lists.updatedLists")){return false}return(0,_includes2.default)(state.reader.lists.updatedLists,listId)}function hasError(state,listId){if(!(0,_has2.default)(state,"reader.lists.errors")){return false}return listId in state.reader.lists.errors}function getListByOwnerAndSlug(state,owner,slug){if(!(0,_has2.default)(state,"reader.lists.items")||!owner||!slug){return}var preparedOwner=owner.toLowerCase();var preparedSlug=slug.toLowerCase();return(0,_find2.default)(state.reader.lists.items,function(list){return list.owner===preparedOwner&&list.slug===preparedSlug})}function isSubscribedByOwnerAndSlug(state,owner,slug){var list=getListByOwnerAndSlug(state,owner,slug);if(!list){return false}return(0,_includes2.default)(state.reader.lists.subscribedLists,list.ID)}function isMissingByOwnerAndSlug(state,owner,slug){var preparedOwner=owner.toLowerCase();var preparedSlug=slug.toLowerCase();return!!(0,_find2.default)(state.reader.lists.missingLists,function(list){return list.owner===preparedOwner&&list.slug===preparedSlug})}},1866:function(module,exports){var nativeFloor=Math.floor,nativeRandom=Math.random;function baseRandom(lower,upper){return lower+nativeFloor(nativeRandom()*(upper-lower+1))}module.exports=baseRandom},1867:function(module,exports,__webpack_require__){var createFind=__webpack_require__(854),findLastIndex=__webpack_require__(3504);var findLast=createFind(findLastIndex);module.exports=findLast},1886:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _noop2=__webpack_require__(38);var _noop3=_interopRequireDefault(_noop2);
var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var FollowButton=_react2.default.createClass({displayName:"FollowButton",propTypes:{following:_react.PropTypes.bool.isRequired,onFollowToggle:_react.PropTypes.func,iconSize:_react.PropTypes.number,tagName:_react.PropTypes.oneOfType([_react.PropTypes.string,_react.PropTypes.func]),disabled:_react.PropTypes.bool},getDefaultProps:function getDefaultProps(){return{following:false,onFollowToggle:_noop3.default,iconSize:20,tagName:"button",disabled:false}},componentWillMount:function componentWillMount(){this.strings={FOLLOW:this.translate("Follow"),FOLLOWING:this.translate("Following")}},toggleFollow:function toggleFollow(event){if(event){event.preventDefault()}if(this.props.disabled){return}if(this.props.onFollowToggle){this.props.onFollowToggle(!this.props.following)}},render:function render(){var label=this.strings.FOLLOW;var menuClasses=["button","follow-button","has-icon"];var iconSize=this.props.iconSize;if(this.props.following){menuClasses.push("is-following");label=this.strings.FOLLOWING}if(this.props.disabled){menuClasses.push("is-disabled")}var followingIcon=_react2.default.createElement("svg",{key:"following",className:"gridicon gridicon__following",height:iconSize+"px",width:iconSize+"px",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},_react2.default.createElement("g",null,_react2.default.createElement("path",{d:"M23 13.482L15.508 21 12 17.4l1.412-1.388 2.106 2.188 6.094-6.094L23 13.482zm-7.455 1.862L20 10.89V2H2v14c0 1.1.9 2 2 2h4.538l4.913-4.832 2.095 2.176zM8 13H4v-1h4v1zm3-2H4v-1h7v1zm0-2H4V8h7v1zm7-3H4V4h14v2z"}))),followIcon=_react2.default.createElement("svg",{key:"follow",className:"gridicon gridicon__follow",height:iconSize+"px",width:iconSize+"px",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},_react2.default.createElement("g",null,_react2.default.createElement("path",{d:"M23 16v2h-3v3h-2v-3h-3v-2h3v-3h2v3h3zM20 2v9h-4v3h-3v4H4c-1.1 0-2-.9-2-2V2h18zM8 13v-1H4v1h4zm3-3H4v1h7v-1zm0-2H4v1h7V8zm7-4H4v2h14V4z"}))),followLabel=_react2.default.createElement("span",{key:"label",className:"follow-button__label"},label);return _react2.default.createElement(this.props.tagName,{onClick:this.toggleFollow,className:menuClasses.join(" "),title:label},[followingIcon,followIcon,followLabel])}});exports.default=FollowButton;module.exports=exports["default"]},1888:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactRedux=__webpack_require__(15);var _actions=__webpack_require__(82);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var MobileBackToSidebar=_react2.default.createClass({displayName:"MobileBackToSidebar",toggleSidebar:function toggleSidebar(event){event.preventDefault();this.props.setLayoutFocus("sidebar")},render:function render(){return _react2.default.createElement("div",{className:"mobile-back-to-sidebar",onTouchTap:this.toggleSidebar},_react2.default.createElement("svg",{className:"gridicon gridicon-back-arrow mobile-back-to-sidebar__icon",height:"24",width:"24",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},_react2.default.createElement("g",null,_react2.default.createElement("path",{d:"M8.886 4L7 5.886 13.114 12 7 18.114 8.886 20l8-8"}))),_react2.default.createElement("span",{className:"mobile-back-to-sidebar__content"},this.props.children))}});exports.default=(0,_reactRedux.connect)(null,{setLayoutFocus:_actions.setLayoutFocus})(MobileBackToSidebar);module.exports=exports["default"]},1889:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var PostExcerpt=_react2.default.createClass({displayName:"PostExcerpt",propTypes:{content:_react2.default.PropTypes.string.isRequired,maxLength:_react2.default.PropTypes.number},defaultProps:{maxLength:80},render:function render(){if(!this.props.content){return null}var classes=(0,_classnames2.default)({"post-excerpt":true,"is-long":this.props.content.length>this.props.maxLength});return _react2.default.createElement("div",{className:classes,dangerouslySetInnerHTML:{__html:this.props.content}})}});exports.default=PostExcerpt;module.exports=exports["default"]},1897:function(module,exports,__webpack_require__){"use strict";var ActionType=__webpack_require__(1749).action,Dispatcher=__webpack_require__(42),inflight=__webpack_require__(1841),wpcom=__webpack_require__(28);function requestKey(feedId){return"feed-"+feedId}var FeedStoreActions={fetch:function fetch(feedId){var key=requestKey(feedId);if(inflight.requestInflight(key)){return}wpcom.undocumented().readFeed({ID:feedId,meta:"site"},inflight.requestTracker(key,FeedStoreActions.receiveFeedFetch.bind(FeedStoreActions,feedId)))},receiveFeedFetch:function receiveFeedFetch(feedId,error,data){Dispatcher.handleServerAction({type:ActionType.RECEIVE_FETCH,feedId:feedId,error:error,data:data})}};module.exports=FeedStoreActions},1898:function(module,exports,__webpack_require__){"use strict";var forEach=__webpack_require__(114),get=__webpack_require__(24);var Dispatcher=__webpack_require__(42),ActionType=__webpack_require__(1972).action,FeedPostStoreActions=__webpack_require__(1813),feedPostListCache=__webpack_require__(2241),SiteStoreActions=__webpack_require__(1815),FeedStreamActions;function getNextPageParams(store){var params={orderBy:store.orderBy,number:store.perPage,meta:"post,discover_original_post"},lastDate=store.getLastItemWithDate();if(lastDate){params.before=lastDate}else{params.number=4;if(store.startDate){params.before=store.startDate}}return params}FeedStreamActions={fetchNextPage:function fetchNextPage(id){var store=feedPostListCache.get(id),params;if(!store||store.isLastPage()||store.isFetchingNextPage()||store.hasRecentError()){return}Dispatcher.handleViewAction({type:ActionType.FETCH_NEXT_PAGE,id:id});params=getNextPageParams(store);store.onNextPageFetch(params);store.fetcher(params,FeedStreamActions.receivePage.bind(FeedStreamActions,store.id))},receivePage:function receivePage(id,error,data){if(!error&&data&&data.posts){forEach(data.posts,function(post){if(post&&get(post,"meta.data.discover_original_post")){FeedPostStoreActions.receivePost(null,post.meta.data.discover_original_post,{blogId:post.meta.data.discover_original_post.site_ID,postId:post.meta.data.discover_original_post.ID})}if(get(post,"meta.data.site")){SiteStoreActions.receiveFetch(post.site_ID,null,post.meta.data.site)}if(post&&get(post,"meta.data.post")){FeedPostStoreActions.receivePost(null,post.meta.data.post,{feedId:post.feed_ID,postId:post.ID})}else if(post&&post.feed_ID&&post.feed_item_ID){FeedPostStoreActions.receivePost(null,post,{feedId:post.feed_ID,postId:post.feed_item_ID})}else if(post&&post.site_ID){FeedPostStoreActions.receivePost(null,post,{blogId:post.site_ID,postId:post.ID})}})}Dispatcher.handleServerAction({type:ActionType.RECEIVE_PAGE,id:id,error:error,data:data})},receiveUpdates:function receiveUpdates(id,error,data){Dispatcher.handleServerAction({type:ActionType.RECEIVE_UPDATES,id:id,error:error,data:data})},showUpdates:function showUpdates(id){Dispatcher.handleViewAction({type:ActionType.SHOW_UPDATES,id:id})},selectNextItem:function selectNextItem(id,selectedIndex){Dispatcher.handleViewAction({type:ActionType.SELECT_NEXT_ITEM,id:id,selectedIndex:selectedIndex})},selectPrevItem:function selectPrevItem(id,selectedIndex){Dispatcher.handleViewAction({type:ActionType.SELECT_PREV_ITEM,id:id,selectedIndex:selectedIndex})},selectItem:function selectItem(id,selectedIndex){Dispatcher.handleViewAction({type:ActionType.SELECT_ITEM,id:id,selectedIndex:selectedIndex})},fillGap:function fillGap(id,gap){var store=feedPostListCache.get(id),params;if(!store){return}Dispatcher.handleViewAction({type:ActionType.FILL_GAP,id:id,gap:gap});params={before:gap.to.toISOString(),after:gap.from.toISOString(),number:store.gapFillCount,orderBy:store.orderBy};store.onGapFetch(params);store.fetcher(params,FeedStreamActions.receiveGap.bind(FeedStreamActions,store.id,gap))},receiveGap:function receiveGap(id,gap,error,data){Dispatcher.handleServerAction({type:ActionType.RECEIVE_GAP,id:id,gap:gap,error:error,data:data})}};module.exports=FeedStreamActions},1905:function(module,exports,__webpack_require__){"use strict";var _formatting=__webpack_require__(81);var _dispatcher=__webpack_require__(42);var _dispatcher2=_interopRequireDefault(_dispatcher);var _emitter=__webpack_require__(36);var _emitter2=_interopRequireDefault(_emitter);var _isEqual=__webpack_require__(98);var _isEqual2=_interopRequireDefault(_isEqual);var _last=__webpack_require__(215);var _last2=_interopRequireDefault(_last);var _constants=__webpack_require__(2270);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var lists={},errors=[],updatedLists={},_isFetching=false,ListStore;function keyForList(owner,slug){return decodeURIComponent(owner)+"-"+decodeURIComponent(slug)}function getListURL(list){return"/read/list/"+encodeURIComponent(list.owner)+"/"+encodeURIComponent(list.slug)}ListStore={get:function get(owner,slug){return lists[keyForList(owner,slug)]},getLastError:function getLastError(){return(0,_last2.default)(errors)},isUpdated:function isUpdated(listId){return!!updatedLists[listId]},isFetching:function isFetching(){return _isFetching},setIsFetching:function setIsFetching(val){_isFetching=val}};(0,_emitter2.default)(ListStore);function receiveList(newList){var existing=ListStore.get(newList.owner,newList.slug);newList.URL=getListURL(newList);newList.title=(0,_formatting.decodeEntities)(newList.title);if(!(0,_isEqual2.default)(existing,newList)){lists[keyForList(newList.owner,newList.slug)]=newList;ListStore.emit("change")}}function markUpdatedList(newList){updatedLists[newList.ID]=true;ListStore.emit("change")}function markPending(owner,slug){var key=keyForList(owner,slug),list=lists[key];if(!list){list={owner:owner,slug:slug,title:slug,ID:null,_state:"pending"};lists[key]=list;ListStore.emit("change")}}function clearUpdatedLists(){updatedLists={};ListStore.emit("change")}ListStore.dispatchToken=_dispatcher2.default.register(function(payload){var action=payload.action;if(!action){return}if(action.error){errors.push(action.error);return}switch(action.type){case _constants.action.RECEIVE_READER_LIST:if(action.data&&action.data.list){receiveList(action.data.list)}break;case _constants.action.RECEIVE_READER_LISTS:if(action.data&&action.data.lists){action.data.lists.forEach(receiveList)}break;case _constants.action.UPDATE_READER_LIST:receiveList(action.data);break;case _constants.action.RECEIVE_CREATE_READER_LIST:case _constants.action.RECEIVE_UPDATE_READER_LIST:receiveList(action.data);markUpdatedList(action.data);break;case _constants.action.FOLLOW_LIST:markPending(action.data.owner,action.data.slug);break;case _constants.action.RECEIVE_FOLLOW_LIST:receiveList(action.data);break;case _constants.action.DISMISS_READER_LIST_NOTICE:clearUpdatedLists();break}});module.exports=ListStore},1906:function(module,exports,__webpack_require__){"use strict";var keyMirror=__webpack_require__(116);module.exports.action=keyMirror({BLOCK_SITE:null,RECEIVE_BLOCK_SITE:null,UNBLOCK_SITE:null,RECEIVE_UNBLOCK_SITE:null,DISMISS_BLOCK_ERROR:null});module.exports.error=keyMirror({UNABLE_TO_BLOCK:null,UNABLE_TO_UNBLOCK:null})},1918:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=HeaderBack;var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _headerCake=__webpack_require__(1650);var _headerCake2=_interopRequireDefault(_headerCake);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function goBack(){if(typeof window!=="undefined"){window.history.back()}}function HeaderBack(){return _react2.default.createElement(_headerCake2.default,{isCompact:false,onClick:goBack})}module.exports=exports["default"]},1919:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _helper=__webpack_require__(1674);exports.default={shouldShowLikes:function shouldShowLikes(post){var showLikes=false;if((0,_helper.isDiscoverPost)(post)){if((0,_helper.isInternalDiscoverPost)(post)&&!(0,_helper.isDiscoverSitePick)(post)){showLikes=true}}else if(post&&post.site_ID&&!post.is_external){showLikes=true}return showLikes}};module.exports=exports["default"]},1962:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _mixin=__webpack_require__(111);var _mixin2=_interopRequireDefault(_mixin);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _icons=__webpack_require__(2444);var _icons2=_interopRequireDefault(_icons);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var LikeButton=_react2.default.createClass({displayName:"LikeButton",mixins:[_mixin2.default],propTypes:{liked:_react2.default.PropTypes.bool,showZeroCount:_react2.default.PropTypes.bool,likeCount:_react2.default.PropTypes.number,showLabel:_react2.default.PropTypes.bool,tagName:_react2.default.PropTypes.string,onLikeToggle:_react2.default.PropTypes.func,likedLabel:_react2.default.PropTypes.string,isMini:_react2.default.PropTypes.bool,animateLike:_react2.default.PropTypes.bool},getDefaultProps:function getDefaultProps(){return{liked:false,showZeroCount:false,likeCount:0,showLabel:true,isMini:false,animateLike:true}},toggleLiked:function toggleLiked(event){if(event){event.preventDefault()}if(this.props.onLikeToggle){this.props.onLikeToggle(!this.props.liked)}},render:function render(){var showLikeCount=this.props.likeCount>0||this.props.showZeroCount;var likeCount=this.props.likeCount;var containerTag=this.props.tagName||"li";var containerClasses={"like-button":true,"ignore-click":true,"is-mini":this.props.isMini,"is-animated":this.props.animateLike,"has-count":showLikeCount,"has-label":this.props.showLabel};var likeLabel=this.translate("Like",{comment:'Label for a button to "like" a post.'});var iconSize=24;if(this.props.liked){containerClasses["is-liked"]=true;if(this.props.likedLabel){likeLabel=this.props.likedLabel}else{likeLabel=this.translate("Liked",{comment:'Displayed when a person "likes" a post.'})}}if(showLikeCount){likeLabel=this.translate("Like","Likes",{count:likeCount,comment:'Displayed when a person "likes" a post.'})}if(this.props.isMini){iconSize=18}var labelElement=_react2.default.createElement("span",{className:"like-button__label"},_react2.default.createElement("span",{className:"like-button__label-count"},showLikeCount?likeCount:""),this.props.showLabel&&_react2.default.createElement("span",{className:"like-button__label-status"},likeLabel));return _react2.default.createElement(containerTag,{className:(0,_classnames2.default)(containerClasses),onTouchTap:this.toggleLiked},_react2.default.createElement(_icons2.default,{size:iconSize}),labelElement)}});exports.default=LikeButton;module.exports=exports["default"]},1971:function(module,exports,__webpack_require__){"use strict";var keyMirror=__webpack_require__(116);module.exports={action:keyMirror({FETCH_FEED_POST:null,RECEIVE_FEED_POST:null,MARK_FEED_POST_SEEN:null,RECEIVE_NORMALIZED_FEED_POST:null})}},1972:function(module,exports){"use strict";module.exports={action:{FETCH_NEXT_PAGE:"FETCH_NEXT_FEED_STREAM_PAGE",RECEIVE_PAGE:"RECEIVE_FEED_STREAM_PAGE",SHOW_UPDATES:"SHOW_FEED_STREAM_UPDATES",RECEIVE_UPDATES:"RECEIVE_FEED_STREAM_UPDATES",FILL_GAP:"FILL_FEED_STREAM_GAP",RECEIVE_GAP:"RECEIVE_FEED_STREAM_GAP",SELECT_ITEM:"SELECT_ITEM",SELECT_NEXT_ITEM:"SELECT_NEXT_ITEM",SELECT_PREV_ITEM:"SELECT_PREV_ITEM"}}},1975:function(module,exports,__webpack_require__){"use strict";var debug=__webpack_require__(3)("calypso:like-store:actions");var Dispatcher=__webpack_require__(42),key=__webpack_require__(2247).key,wpcom=__webpack_require__(28);var inflight={};function requestInflight(requestKey){return requestKey in inflight}function requestTracker(requestKey,callback){inflight[requestKey]=true;return function(error,data){delete inflight[requestKey];callback(error,data)}}function getQuery(){return{source:"reader"}}var LikeActions={fetchLikes:function fetchLikes(siteId,postId){if(requestInflight(key(siteId,postId))){return}var requestKey=key(siteId,postId),callback=requestTracker(requestKey,function(error,data){LikeActions.receivePostLikes(error,siteId,postId,data)});wpcom.site(siteId).post(postId).likesList(callback)},likePost:function likePost(siteId,postId){Dispatcher.handleViewAction({type:"LIKE_POST",siteId:siteId,postId:postId});wpcom.site(siteId).post(postId).like().add(getQuery(),function(error,data){LikeActions.receiveLikeResponse(error,siteId,postId,data)})},unlikePost:function unlikePost(siteId,postId){Dispatcher.handleViewAction({type:"UNLIKE_POST",siteId:siteId,postId:postId});wpcom.site(siteId).post(postId).like().del(getQuery(),function(error,data){LikeActions.receiveUnlikeResponse(error,siteId,postId,data)})},receivePostLikes:function receivePostLikes(error,siteId,postId,data){Dispatcher.handleServerAction({type:"RECEIVE_POST_LIKES",error:error,siteId:siteId,postId:postId,data:data})},receiveLikeResponse:function receiveLikeResponse(error,siteId,postId,data){Dispatcher.handleServerAction({type:"RECEIVE_LIKE_RESPONSE",error:error,siteId:siteId,postId:postId,data:data})},receiveUnlikeResponse:function receiveUnlikeResponse(error,siteId,postId,data){Dispatcher.handleServerAction({type:"RECEIVE_UNLIKE_RESPONSE",error:error,siteId:siteId,postId:postId,data:data})}};module.exports=LikeActions},1980:function(module,exports,__webpack_require__){"use strict";var keyMirror=__webpack_require__(116);module.exports.action=keyMirror({SUBSCRIBE_TO_COMMENT_EMAILS:null,UNSUBSCRIBE_FROM_COMMENT_EMAILS:null,RECEIVE_SUBSCRIBE_TO_COMMENT_EMAILS:null,RECEIVE_UNSUBSCRIBE_FROM_COMMENT_EMAILS:null});module.exports.error=keyMirror({UNABLE_TO_SUBSCRIBE:null,UNABLE_TO_UNSUBSCRIBE:null});module.exports.state=keyMirror({SUBSCRIBED:null,UNSUBSCRIBED:null})},1981:function(module,exports,__webpack_require__){"use strict";var keyMirror=__webpack_require__(116);module.exports.action=keyMirror({SUBSCRIBE_TO_POST_EMAILS:null,UNSUBSCRIBE_FROM_POST_EMAILS:null,UPDATE_POST_EMAIL_DELIVERY_FREQUENCY:null,RECEIVE_SUBSCRIBE_TO_POST_EMAILS:null,RECEIVE_UPDATE_POST_EMAIL_DELIVERY_FREQUENCY:null,RECEIVE_UNSUBSCRIBE_FROM_POST_EMAILS:null});module.exports.error=keyMirror({UNABLE_TO_SUBSCRIBE:null,UNABLE_TO_UNSUBSCRIBE:null,UNABLE_TO_UPDATE_DELIVERY_FREQUENCY:null});module.exports.state=keyMirror({SUBSCRIBED:null,UNSUBSCRIBED:null})},2001:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.isDailyPostChallengeOrPrompt=isDailyPostChallengeOrPrompt;exports.getDailyPostType=getDailyPostType;var _config=__webpack_require__(12);var _config2=_interopRequireDefault(_config);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var types={dp_prompt:"prompt",dp_photo_challenge:"photo",dp_discover:"discover"};function isDailyPostChallengeOrPrompt(post){return post.site_ID===(0,_config2.default)("daily_post_blog_id")&&!!types[post.type]}function getDailyPostType(post){return types[post.type]}},2002:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _i18nCalypso=__webpack_require__(11);var _i18nCalypso2=_interopRequireDefault(_i18nCalypso);var _main=__webpack_require__(166);var _main2=_interopRequireDefault(_main);var _mobileBackToSidebar=__webpack_require__(1888);var _mobileBackToSidebar2=_interopRequireDefault(_mobileBackToSidebar);var _emptyContent=__webpack_require__(207);var _emptyContent2=_interopRequireDefault(_emptyContent);var _stats=__webpack_require__(1643);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var FeedError=_react2.default.createClass({displayName:"FeedError",getDefaultProps:function getDefaultProps(){return{message:_i18nCalypso2.default.translate("Sorry, we can't find that stream.")}},recordAction:function recordAction(){(0,_stats.recordAction)("clicked_discover_on_404");(0,_stats.recordGaEvent)("Clicked Discover on 404");(0,_stats.recordTrack)("calypso_reader_discover_on_feed_error_clicked")},recordSecondaryAction:function recordSecondaryAction(){(0,_stats.recordAction)("clicked_recommendations_on_404");(0,_stats.recordGaEvent)("Clicked Recommendations on 404");(0,_stats.recordTrack)("calypso_reader_recommendations_on_feed_error_clicked")},render:function render(){var action=_react2.default.createElement("a",{className:"empty-content__action button is-primary",onClick:this.recordAction,href:"/discover"},this.translate("Explore Discover")),secondaryAction=_react2.default.createElement("a",{className:"empty-content__action button",onClick:this.recordSecondaryAction,href:"/recommendations"},this.translate("Get recommendations on who to follow"));return _react2.default.createElement(_main2.default,null,_react2.default.createElement(_mobileBackToSidebar2.default,null,_react2.default.createElement("h1",null,this.props.sidebarTitle)),_react2.default.createElement(_emptyContent2.default,{action:action,secondaryAction:secondaryAction,title:this.props.message,illustration:"/calypso/images/drake/drake-404.svg",illustrationWidth:500}))}});FeedError.propTypes={sidebarTitle:_react2.default.PropTypes.string};exports.default=FeedError;module.exports=exports["default"]},2003:function(module,exports,__webpack_require__){"use strict";var _route=__webpack_require__(1740);var _url=__webpack_require__(115);module.exports={formatUrlForDisplay:function formatUrlForDisplay(url){if(!url){return}return(0,_url.withoutHttp)(url).replace(/\/$/,"")},getFeedTitle:function getFeedTitle(siteData,feedData,displayUrl){var feedTitle;if(siteData&&siteData.get("name")){feedTitle=siteData.get("name")}else if(feedData&&feedData.name){feedTitle=feedData.name}else{feedTitle=displayUrl}return feedTitle},getFeedStreamUrl:function getFeedStreamUrl(siteData,feedData){if(!siteData&&!feedData){return null}if(feedData){return(0,_route.getFeedUrl)(feedData.feed_ID)}return(0,_route.getSiteUrl)(siteData.get("ID"))},getSiteUrl:function getSiteUrl(siteData,feedData,subscription){var siteUrl;if(siteData&&siteData.get("URL")){siteUrl=siteData.get("URL")}else if(feedData&&feedData.URL){siteUrl=feedData.URL}else if(subscription&&subscription.get("URL")){siteUrl=subscription.get("URL")}return siteUrl}}},2004:function(module,exports,__webpack_require__){"use strict";var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _some=__webpack_require__(63);var _some2=_interopRequireDefault(_some);var _startsWith=__webpack_require__(83);var _startsWith2=_interopRequireDefault(_startsWith);var _assign=__webpack_require__(34);var _assign2=_interopRequireDefault(_assign);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}module.exports={itemLinkClass:function itemLinkClass(path,currentPath,additionalClasses){var basePathLowerCase=decodeURIComponent(currentPath).split("?")[0].replace(/\/edit$/,"").toLowerCase(),pathLowerCase=decodeURIComponent(path).replace(/\/edit$/,"").toLowerCase();var selected=basePathLowerCase===pathLowerCase,isActionButtonSelected=false;if(pathLowerCase==="/"&&!selected){selected="/following"===basePathLowerCase}var pathWithoutQueryString=currentPath.split("?")[0];if(selected&&!!pathWithoutQueryString.match(/\/edit$/)){isActionButtonSelected=true}return(0,_classnames2.default)((0,_assign2.default)({selected:selected,"is-action-button-selected":isActionButtonSelected},additionalClasses))},itemLinkClassStartsWithOneOf:function itemLinkClassStartsWithOneOf(paths,currentPath,additionalClasses){var selected=this.pathStartsWithOneOf(paths,currentPath);return(0,_classnames2.default)((0,_assign2.default)({selected:selected},additionalClasses))},pathStartsWithOneOf:function pathStartsWithOneOf(paths,currentPath){return(0,_some2.default)(paths,function(path){return(0,_startsWith2.default)(currentPath.toLowerCase(),path.toLowerCase())})}}},2005:function(module,exports,__webpack_require__){"use strict";var url=__webpack_require__(70);var i18n=__webpack_require__(11),SiteState=__webpack_require__(1738).state,FeedDisplayHelper=__webpack_require__(2003);function siteNameFromSiteAndPost(site,post){var siteName=void 0;if(site&&(site.title||site.domain)){siteName=site.title||site.domain}else if(site&&site.get&&site.get("state")===SiteState.COMPLETE){siteName=site.get("title")||site.get("domain")}else if(post){if(post.site_name){siteName=post.site_name}else if(post.site_URL){siteName=url.parse(post.site_URL).hostname}}if(!siteName){siteName=i18n.translate("(no title)")}return siteName}function siteishFromSiteAndPost(site,post){if(site){return site.toJS()}if(post){return{title:siteNameFromSiteAndPost(site,post),domain:FeedDisplayHelper.formatUrlForDisplay(post.site_URL)}}return{title:"",domain:""}}function isSpecialClick(event){return event.button>0||event.metaKey||event.controlKey||event.shiftKey||event.altKey}function isPostNotFound(post){if(post===undefined){return false}return post.statusCode===404}module.exports={siteNameFromSiteAndPost:siteNameFromSiteAndPost,siteishFromSiteAndPost:siteishFromSiteAndPost,isSpecialClick:isSpecialClick,isPostNotFound:isPostNotFound}},2011:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _assign=__webpack_require__(5);var _assign2=_interopRequireDefault(_assign);var _promise=__webpack_require__(49);var _promise2=_interopRequireDefault(_promise);exports.receiveLists=receiveLists;exports.requestSubscribedLists=requestSubscribedLists;exports.requestList=requestList;exports.followList=followList;exports.unfollowList=unfollowList;exports.updateListDetails=updateListDetails;exports.dismissListNotice=dismissListNotice;exports.updateTitle=updateTitle;exports.updateDescription=updateDescription;var _wp=__webpack_require__(28);var _wp2=_interopRequireDefault(_wp);var _actionTypes=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function receiveLists(lists){return{type:_actionTypes.READER_LISTS_RECEIVE,lists:lists}}function requestSubscribedLists(){return function(dispatch){dispatch({type:_actionTypes.READER_LISTS_REQUEST});return new _promise2.default(function(resolve,reject){_wp2.default.undocumented().readLists(function(error,data){error?reject(error):resolve(data)})}).then(function(data){dispatch(receiveLists(data.lists));dispatch({type:_actionTypes.READER_LISTS_REQUEST_SUCCESS,data:data})}).catch(function(error){dispatch({type:_actionTypes.READER_LISTS_REQUEST_FAILURE,error:error})})}}function requestList(owner,slug){return function(dispatch){dispatch({type:_actionTypes.READER_LIST_REQUEST});var query=createQuery(owner,slug);return new _promise2.default(function(resolve,reject){_wp2.default.undocumented().readList(query,function(error,data){if(error){var errorInfo={error:error,owner:owner,slug:slug};reject(errorInfo)}else{resolve(data)}})}).then(function(data){dispatch({type:_actionTypes.READER_LIST_REQUEST_SUCCESS,data:data})}).catch(function(errorInfo){dispatch({type:_actionTypes.READER_LIST_REQUEST_FAILURE,error:errorInfo.error,owner:errorInfo.owner,slug:errorInfo.slug})})}}function followList(owner,slug){return function(dispatch){dispatch({type:_actionTypes.READER_LISTS_FOLLOW,owner:owner,slug:slug});var query=createQuery(owner,slug);return new _promise2.default(function(resolve,reject){_wp2.default.undocumented().followList(query,function(error,data){error?reject(error):resolve(data)})}).then(function(data){dispatch(receiveLists([data.list]));dispatch({type:_actionTypes.READER_LISTS_FOLLOW_SUCCESS,data:data})}).catch(function(error){dispatch({type:_actionTypes.READER_LISTS_FOLLOW_FAILURE,error:error})})}}function unfollowList(owner,slug){return function(dispatch){dispatch({type:_actionTypes.READER_LISTS_UNFOLLOW,owner:owner,slug:slug});var query=createQuery(owner,slug);return new _promise2.default(function(resolve,reject){_wp2.default.undocumented().unfollowList(query,function(error,data){error?reject(error):resolve(data)})}).then(function(data){dispatch({type:_actionTypes.READER_LISTS_UNFOLLOW_SUCCESS,data:data})}).catch(function(error){dispatch({type:_actionTypes.READER_LISTS_UNFOLLOW_FAILURE,error:error})})}}function updateListDetails(list){if(!list||!list.owner||!list.slug||!list.title){throw new Error("List owner, slug and title are required")}var preparedOwner=decodeURIComponent(list.owner);var preparedSlug=decodeURIComponent(list.slug);var preparedList=(0,_assign2.default)({},list,{owner:preparedOwner,slug:preparedSlug});return function(dispatch){dispatch({type:_actionTypes.READER_LIST_UPDATE,list:list});return new _promise2.default(function(resolve,reject){_wp2.default.undocumented().readListsUpdate(preparedList,function(error,data){if(error){dispatch({type:_actionTypes.READER_LIST_UPDATE_FAILURE,list:list,error:error});reject(error)}else{dispatch({type:_actionTypes.READER_LIST_UPDATE_SUCCESS,list:list,data:data});resolve()}})})}}function dismissListNotice(listId){return function(dispatch){dispatch({type:_actionTypes.READER_LIST_DISMISS_NOTICE,listId:listId})}}function updateTitle(listId,newTitle){return function(dispatch){dispatch({type:_actionTypes.READER_LIST_UPDATE_TITLE,listId:listId,title:newTitle})}}function updateDescription(listId,newDescription){return function(dispatch){dispatch({type:_actionTypes.READER_LIST_UPDATE_DESCRIPTION,listId:listId,description:newDescription})}}function createQuery(owner,slug){var preparedOwner=decodeURIComponent(owner);var preparedSlug=decodeURIComponent(slug);return{owner:preparedOwner,slug:preparedSlug}}},2012:function(module,exports){"use strict";module.exports={UNCLASSIFIED:0,PHOTO_ONLY:1,LARGE_BANNER:2,ONE_LINER:4,LANDSCAPE_BANNER:8,PORTRAIT_BANNER:16,GALLERY:32,VIDEO:64,THUMBNAIL:128,CANONICAL_IN_CONTENT:256,FEATURED_VIDEO:512,X_POST:1024}},2015:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getRecommendationIds=undefined;exports.isRequestingRecommendations=isRequestingRecommendations;exports.getRecommendationById=getRecommendationById;exports.getRecommendations=getRecommendations;exports.getRecommendationsInteractedWith=getRecommendationsInteractedWith;exports.hasInteractedWithRecommendation=hasInteractedWithRecommendation;exports.hasGraduatedRecommendations=hasGraduatedRecommendations;exports.isRequestingGraduation=isRequestingGraduation;var _includes=__webpack_require__(30);var _includes2=_interopRequireDefault(_includes);var _find=__webpack_require__(27);var _find2=_interopRequireDefault(_find);var _map=__webpack_require__(45);var _map2=_interopRequireDefault(_map);var _debug=__webpack_require__(3);var _debug2=_interopRequireDefault(_debug);var _createSelector=__webpack_require__(100);var _createSelector2=_interopRequireDefault(_createSelector);var _selectors=__webpack_require__(90);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var debug=(0,_debug2.default)("calypso:reader:start");function isRequestingRecommendations(state){return!!state.reader.start.isRequestingRecommendations}function getRecommendationById(state,recommendationId){
return(0,_find2.default)(state.reader.start.items,{ID:recommendationId})}function getRecommendations(state){return state.reader.start.items}var getRecommendationIds=exports.getRecommendationIds=(0,_createSelector2.default)(function(state){return(0,_map2.default)(state.reader.start.items,"ID")},function(state){return[state.reader.start.items]});function getRecommendationsInteractedWith(state){return state.reader.start.recommendationsInteractedWith}function hasInteractedWithRecommendation(state,recommendationId){return(0,_includes2.default)(state.reader.start.recommendationsInteractedWith,recommendationId)}function hasGraduatedRecommendations(state){var graduated=state.reader.start.hasGraduated;if(graduated===null){var user=(0,_selectors.getCurrentUser)(state);graduated=!user.is_new_reader}return graduated}function isRequestingGraduation(state){return state.reader.start.isRequestingGraduation}},2021:function(module,exports,__webpack_require__){var baseExtremum=__webpack_require__(2205),baseGt=__webpack_require__(2415),baseIteratee=__webpack_require__(35);function maxBy(array,iteratee){return array&&array.length?baseExtremum(array,baseIteratee(iteratee,2),baseGt):undefined}module.exports=maxBy},2022:function(module,exports,__webpack_require__){var baseRandom=__webpack_require__(1866),isArrayLike=__webpack_require__(67),values=__webpack_require__(210);function sample(collection){var array=isArrayLike(collection)?collection:values(collection),length=array.length;return length>0?array[baseRandom(0,length-1)]:undefined}module.exports=sample},2023:function(module,exports){(function(global){var location=global.location||{};var twemoji=function(){"use strict";var twemoji={base:(location.protocol==="https:"?"https:":"http:")+"//twemoji.maxcdn.com/",ext:".png",size:"36x36",className:"emoji",convert:{fromCodePoint:fromCodePoint,toCodePoint:toCodePoint},onerror:function onerror(){if(this.parentNode){this.parentNode.replaceChild(createText(this.alt),this)}},parse:parse,replace:replace,test:test},re=/((?:\ud83c\udde8\ud83c\uddf3|\ud83c\uddfa\ud83c\uddf8|\ud83c\uddf7\ud83c\uddfa|\ud83c\uddf0\ud83c\uddf7|\ud83c\uddef\ud83c\uddf5|\ud83c\uddee\ud83c\uddf9|\ud83c\uddec\ud83c\udde7|\ud83c\uddeb\ud83c\uddf7|\ud83c\uddea\ud83c\uddf8|\ud83c\udde9\ud83c\uddea|\u0039\ufe0f?\u20e3|\u0038\ufe0f?\u20e3|\u0037\ufe0f?\u20e3|\u0036\ufe0f?\u20e3|\u0035\ufe0f?\u20e3|\u0034\ufe0f?\u20e3|\u0033\ufe0f?\u20e3|\u0032\ufe0f?\u20e3|\u0031\ufe0f?\u20e3|\u0030\ufe0f?\u20e3|\u0023\ufe0f?\u20e3|\ud83d\udeb3|\ud83d\udeb1|\ud83d\udeb0|\ud83d\udeaf|\ud83d\udeae|\ud83d\udea6|\ud83d\udea3|\ud83d\udea1|\ud83d\udea0|\ud83d\ude9f|\ud83d\ude9e|\ud83d\ude9d|\ud83d\ude9c|\ud83d\ude9b|\ud83d\ude98|\ud83d\ude96|\ud83d\ude94|\ud83d\ude90|\ud83d\ude8e|\ud83d\ude8d|\ud83d\ude8b|\ud83d\ude8a|\ud83d\ude88|\ud83d\ude86|\ud83d\ude82|\ud83d\ude81|\ud83d\ude36|\ud83d\ude34|\ud83d\ude2f|\ud83d\ude2e|\ud83d\ude2c|\ud83d\ude27|\ud83d\ude26|\ud83d\ude1f|\ud83d\ude1b|\ud83d\ude19|\ud83d\ude17|\ud83d\ude15|\ud83d\ude11|\ud83d\ude10|\ud83d\ude0e|\ud83d\ude08|\ud83d\ude07|\ud83d\ude00|\ud83d\udd67|\ud83d\udd66|\ud83d\udd65|\ud83d\udd64|\ud83d\udd63|\ud83d\udd62|\ud83d\udd61|\ud83d\udd60|\ud83d\udd5f|\ud83d\udd5e|\ud83d\udd5d|\ud83d\udd5c|\ud83d\udd2d|\ud83d\udd2c|\ud83d\udd15|\ud83d\udd09|\ud83d\udd08|\ud83d\udd07|\ud83d\udd06|\ud83d\udd05|\ud83d\udd04|\ud83d\udd02|\ud83d\udd01|\ud83d\udd00|\ud83d\udcf5|\ud83d\udcef|\ud83d\udced|\ud83d\udcec|\ud83d\udcb7|\ud83d\udcb6|\ud83d\udcad|\ud83d\udc6d|\ud83d\udc6c|\ud83d\udc65|\ud83d\udc2a|\ud83d\udc16|\ud83d\udc15|\ud83d\udc13|\ud83d\udc10|\ud83d\udc0f|\ud83d\udc0b|\ud83d\udc0a|\ud83d\udc09|\ud83d\udc08|\ud83d\udc07|\ud83d\udc06|\ud83d\udc05|\ud83d\udc04|\ud83d\udc03|\ud83d\udc02|\ud83d\udc01|\ud83d\udc00|\ud83c\udfe4|\ud83c\udfc9|\ud83c\udfc7|\ud83c\udf7c|\ud83c\udf50|\ud83c\udf4b|\ud83c\udf33|\ud83c\udf32|\ud83c\udf1e|\ud83c\udf1d|\ud83c\udf1c|\ud83c\udf1a|\ud83c\udf18|\ud83c\udccf|\ud83c\udd70|\ud83c\udd71|\ud83c\udd7e|\ud83c\udd8e|\ud83c\udd91|\ud83c\udd92|\ud83c\udd93|\ud83c\udd94|\ud83c\udd95|\ud83c\udd96|\ud83c\udd97|\ud83c\udd98|\ud83c\udd99|\ud83c\udd9a|\ud83d\udc77|\ud83d\udec5|\ud83d\udec4|\ud83d\udec3|\ud83d\udec2|\ud83d\udec1|\ud83d\udebf|\ud83d\udeb8|\ud83d\udeb7|\ud83d\udeb5|\ud83c\ude01|\ud83c\ude02|\ud83c\ude32|\ud83c\ude33|\ud83c\ude34|\ud83c\ude35|\ud83c\ude36|\ud83c\ude37|\ud83c\ude38|\ud83c\ude39|\ud83c\ude3a|\ud83c\ude50|\ud83c\ude51|\ud83c\udf00|\ud83c\udf01|\ud83c\udf02|\ud83c\udf03|\ud83c\udf04|\ud83c\udf05|\ud83c\udf06|\ud83c\udf07|\ud83c\udf08|\ud83c\udf09|\ud83c\udf0a|\ud83c\udf0b|\ud83c\udf0c|\ud83c\udf0f|\ud83c\udf11|\ud83c\udf13|\ud83c\udf14|\ud83c\udf15|\ud83c\udf19|\ud83c\udf1b|\ud83c\udf1f|\ud83c\udf20|\ud83c\udf30|\ud83c\udf31|\ud83c\udf34|\ud83c\udf35|\ud83c\udf37|\ud83c\udf38|\ud83c\udf39|\ud83c\udf3a|\ud83c\udf3b|\ud83c\udf3c|\ud83c\udf3d|\ud83c\udf3e|\ud83c\udf3f|\ud83c\udf40|\ud83c\udf41|\ud83c\udf42|\ud83c\udf43|\ud83c\udf44|\ud83c\udf45|\ud83c\udf46|\ud83c\udf47|\ud83c\udf48|\ud83c\udf49|\ud83c\udf4a|\ud83c\udf4c|\ud83c\udf4d|\ud83c\udf4e|\ud83c\udf4f|\ud83c\udf51|\ud83c\udf52|\ud83c\udf53|\ud83c\udf54|\ud83c\udf55|\ud83c\udf56|\ud83c\udf57|\ud83c\udf58|\ud83c\udf59|\ud83c\udf5a|\ud83c\udf5b|\ud83c\udf5c|\ud83c\udf5d|\ud83c\udf5e|\ud83c\udf5f|\ud83c\udf60|\ud83c\udf61|\ud83c\udf62|\ud83c\udf63|\ud83c\udf64|\ud83c\udf65|\ud83c\udf66|\ud83c\udf67|\ud83c\udf68|\ud83c\udf69|\ud83c\udf6a|\ud83c\udf6b|\ud83c\udf6c|\ud83c\udf6d|\ud83c\udf6e|\ud83c\udf6f|\ud83c\udf70|\ud83c\udf71|\ud83c\udf72|\ud83c\udf73|\ud83c\udf74|\ud83c\udf75|\ud83c\udf76|\ud83c\udf77|\ud83c\udf78|\ud83c\udf79|\ud83c\udf7a|\ud83c\udf7b|\ud83c\udf80|\ud83c\udf81|\ud83c\udf82|\ud83c\udf83|\ud83c\udf84|\ud83c\udf85|\ud83c\udf86|\ud83c\udf87|\ud83c\udf88|\ud83c\udf89|\ud83c\udf8a|\ud83c\udf8b|\ud83c\udf8c|\ud83c\udf8d|\ud83c\udf8e|\ud83c\udf8f|\ud83c\udf90|\ud83c\udf91|\ud83c\udf92|\ud83c\udf93|\ud83c\udfa0|\ud83c\udfa1|\ud83c\udfa2|\ud83c\udfa3|\ud83c\udfa4|\ud83c\udfa5|\ud83c\udfa6|\ud83c\udfa7|\ud83c\udfa8|\ud83c\udfa9|\ud83c\udfaa|\ud83c\udfab|\ud83c\udfac|\ud83c\udfad|\ud83c\udfae|\ud83c\udfaf|\ud83c\udfb0|\ud83c\udfb1|\ud83c\udfb2|\ud83c\udfb3|\ud83c\udfb4|\ud83c\udfb5|\ud83c\udfb6|\ud83c\udfb7|\ud83c\udfb8|\ud83c\udfb9|\ud83c\udfba|\ud83c\udfbb|\ud83c\udfbc|\ud83c\udfbd|\ud83c\udfbe|\ud83c\udfbf|\ud83c\udfc0|\ud83c\udfc1|\ud83c\udfc2|\ud83c\udfc3|\ud83c\udfc4|\ud83c\udfc6|\ud83c\udfc8|\ud83c\udfca|\ud83c\udfe0|\ud83c\udfe1|\ud83c\udfe2|\ud83c\udfe3|\ud83c\udfe5|\ud83c\udfe6|\ud83c\udfe7|\ud83c\udfe8|\ud83c\udfe9|\ud83c\udfea|\ud83c\udfeb|\ud83c\udfec|\ud83c\udfed|\ud83c\udfee|\ud83c\udfef|\ud83c\udff0|\ud83d\udc0c|\ud83d\udc0d|\ud83d\udc0e|\ud83d\udc11|\ud83d\udc12|\ud83d\udc14|\ud83d\udc17|\ud83d\udc18|\ud83d\udc19|\ud83d\udc1a|\ud83d\udc1b|\ud83d\udc1c|\ud83d\udc1d|\ud83d\udc1e|\ud83d\udc1f|\ud83d\udc20|\ud83d\udc21|\ud83d\udc22|\ud83d\udc23|\ud83d\udc24|\ud83d\udc25|\ud83d\udc26|\ud83d\udc27|\ud83d\udc28|\ud83d\udc29|\ud83d\udc2b|\ud83d\udc2c|\ud83d\udc2d|\ud83d\udc2e|\ud83d\udc2f|\ud83d\udc30|\ud83d\udc31|\ud83d\udc32|\ud83d\udc33|\ud83d\udc34|\ud83d\udc35|\ud83d\udc36|\ud83d\udc37|\ud83d\udc38|\ud83d\udc39|\ud83d\udc3a|\ud83d\udc3b|\ud83d\udc3c|\ud83d\udc3d|\ud83d\udc3e|\ud83d\udc40|\ud83d\udc42|\ud83d\udc43|\ud83d\udc44|\ud83d\udc45|\ud83d\udc46|\ud83d\udc47|\ud83d\udc48|\ud83d\udc49|\ud83d\udc4a|\ud83d\udc4b|\ud83d\udc4c|\ud83d\udc4d|\ud83d\udc4e|\ud83d\udc4f|\ud83d\udc50|\ud83d\udc51|\ud83d\udc52|\ud83d\udc53|\ud83d\udc54|\ud83d\udc55|\ud83d\udc56|\ud83d\udc57|\ud83d\udc58|\ud83d\udc59|\ud83d\udc5a|\ud83d\udc5b|\ud83d\udc5c|\ud83d\udc5d|\ud83d\udc5e|\ud83d\udc5f|\ud83d\udc60|\ud83d\udc61|\ud83d\udc62|\ud83d\udc63|\ud83d\udc64|\ud83d\udc66|\ud83d\udc67|\ud83d\udc68|\ud83d\udc69|\ud83d\udc6a|\ud83d\udc6b|\ud83d\udc6e|\ud83d\udc6f|\ud83d\udc70|\ud83d\udc71|\ud83d\udc72|\ud83d\udc73|\ud83d\udc74|\ud83d\udc75|\ud83d\udc76|\ud83d\udeb4|\ud83d\udc78|\ud83d\udc79|\ud83d\udc7a|\ud83d\udc7b|\ud83d\udc7c|\ud83d\udc7d|\ud83d\udc7e|\ud83d\udc7f|\ud83d\udc80|\ud83d\udc81|\ud83d\udc82|\ud83d\udc83|\ud83d\udc84|\ud83d\udc85|\ud83d\udc86|\ud83d\udc87|\ud83d\udc88|\ud83d\udc89|\ud83d\udc8a|\ud83d\udc8b|\ud83d\udc8c|\ud83d\udc8d|\ud83d\udc8e|\ud83d\udc8f|\ud83d\udc90|\ud83d\udc91|\ud83d\udc92|\ud83d\udc93|\ud83d\udc94|\ud83d\udc95|\ud83d\udc96|\ud83d\udc97|\ud83d\udc98|\ud83d\udc99|\ud83d\udc9a|\ud83d\udc9b|\ud83d\udc9c|\ud83d\udc9d|\ud83d\udc9e|\ud83d\udc9f|\ud83d\udca0|\ud83d\udca1|\ud83d\udca2|\ud83d\udca3|\ud83d\udca4|\ud83d\udca5|\ud83d\udca6|\ud83d\udca7|\ud83d\udca8|\ud83d\udca9|\ud83d\udcaa|\ud83d\udcab|\ud83d\udcac|\ud83d\udcae|\ud83d\udcaf|\ud83d\udcb0|\ud83d\udcb1|\ud83d\udcb2|\ud83d\udcb3|\ud83d\udcb4|\ud83d\udcb5|\ud83d\udcb8|\ud83d\udcb9|\ud83d\udcba|\ud83d\udcbb|\ud83d\udcbc|\ud83d\udcbd|\ud83d\udcbe|\ud83d\udcbf|\ud83d\udcc0|\ud83d\udcc1|\ud83d\udcc2|\ud83d\udcc3|\ud83d\udcc4|\ud83d\udcc5|\ud83d\udcc6|\ud83d\udcc7|\ud83d\udcc8|\ud83d\udcc9|\ud83d\udcca|\ud83d\udccb|\ud83d\udccc|\ud83d\udccd|\ud83d\udcce|\ud83d\udccf|\ud83d\udcd0|\ud83d\udcd1|\ud83d\udcd2|\ud83d\udcd3|\ud83d\udcd4|\ud83d\udcd5|\ud83d\udcd6|\ud83d\udcd7|\ud83d\udcd8|\ud83d\udcd9|\ud83d\udcda|\ud83d\udcdb|\ud83d\udcdc|\ud83d\udcdd|\ud83d\udcde|\ud83d\udcdf|\ud83d\udce0|\ud83d\udce1|\ud83d\udce2|\ud83d\udce3|\ud83d\udce4|\ud83d\udce5|\ud83d\udce6|\ud83d\udce7|\ud83d\udce8|\ud83d\udce9|\ud83d\udcea|\ud83d\udceb|\ud83d\udcee|\ud83d\udcf0|\ud83d\udcf1|\ud83d\udcf2|\ud83d\udcf3|\ud83d\udcf4|\ud83d\udcf6|\ud83d\udcf7|\ud83d\udcf9|\ud83d\udcfa|\ud83d\udcfb|\ud83d\udcfc|\ud83d\udd03|\ud83d\udd0a|\ud83d\udd0b|\ud83d\udd0c|\ud83d\udd0d|\ud83d\udd0e|\ud83d\udd0f|\ud83d\udd10|\ud83d\udd11|\ud83d\udd12|\ud83d\udd13|\ud83d\udd14|\ud83d\udd16|\ud83d\udd17|\ud83d\udd18|\ud83d\udd19|\ud83d\udd1a|\ud83d\udd1b|\ud83d\udd1c|\ud83d\udd1d|\ud83d\udd1e|\ud83d\udd1f|\ud83d\udd20|\ud83d\udd21|\ud83d\udd22|\ud83d\udd23|\ud83d\udd24|\ud83d\udd25|\ud83d\udd26|\ud83d\udd27|\ud83d\udd28|\ud83d\udd29|\ud83d\udd2a|\ud83d\udd2b|\ud83d\udd2e|\ud83d\udd2f|\ud83d\udd30|\ud83d\udd31|\ud83d\udd32|\ud83d\udd33|\ud83d\udd34|\ud83d\udd35|\ud83d\udd36|\ud83d\udd37|\ud83d\udd38|\ud83d\udd39|\ud83d\udd3a|\ud83d\udd3b|\ud83d\udd3c|\ud83d\udd3d|\ud83d\udd50|\ud83d\udd51|\ud83d\udd52|\ud83d\udd53|\ud83d\udd54|\ud83d\udd55|\ud83d\udd56|\ud83d\udd57|\ud83d\udd58|\ud83d\udd59|\ud83d\udd5a|\ud83d\udd5b|\ud83d\uddfb|\ud83d\uddfc|\ud83d\uddfd|\ud83d\uddfe|\ud83d\uddff|\ud83d\ude01|\ud83d\ude02|\ud83d\ude03|\ud83d\ude04|\ud83d\ude05|\ud83d\ude06|\ud83d\ude09|\ud83d\ude0a|\ud83d\ude0b|\ud83d\ude0c|\ud83d\ude0d|\ud83d\ude0f|\ud83d\ude12|\ud83d\ude13|\ud83d\ude14|\ud83d\ude16|\ud83d\ude18|\ud83d\ude1a|\ud83d\ude1c|\ud83d\ude1d|\ud83d\ude1e|\ud83d\ude20|\ud83d\ude21|\ud83d\ude22|\ud83d\ude23|\ud83d\ude24|\ud83d\ude25|\ud83d\ude28|\ud83d\ude29|\ud83d\ude2a|\ud83d\ude2b|\ud83d\ude2d|\ud83d\ude30|\ud83d\ude31|\ud83d\ude32|\ud83d\ude33|\ud83d\ude35|\ud83d\ude37|\ud83d\ude38|\ud83d\ude39|\ud83d\ude3a|\ud83d\ude3b|\ud83d\ude3c|\ud83d\ude3d|\ud83d\ude3e|\ud83d\ude3f|\ud83d\ude40|\ud83d\ude45|\ud83d\ude46|\ud83d\ude47|\ud83d\ude48|\ud83d\ude49|\ud83d\ude4a|\ud83d\ude4b|\ud83d\ude4c|\ud83d\ude4d|\ud83d\ude4e|\ud83d\ude4f|\ud83d\ude80|\ud83d\ude83|\ud83d\ude84|\ud83d\ude85|\ud83d\ude87|\ud83d\ude89|\ud83d\ude8c|\ud83d\ude8f|\ud83d\ude91|\ud83d\ude92|\ud83d\ude93|\ud83d\ude95|\ud83d\ude97|\ud83d\ude99|\ud83d\ude9a|\ud83d\udea2|\ud83d\udea4|\ud83d\udea5|\ud83d\udea7|\ud83d\udea8|\ud83d\udea9|\ud83d\udeaa|\ud83d\udeab|\ud83d\udeac|\ud83d\udead|\ud83d\udeb2|\ud83d\udeb6|\ud83d\udeb9|\ud83d\udeba|\ud83d\udebb|\ud83d\udebc|\ud83d\udebd|\ud83d\udebe|\ud83d\udec0|\ud83c\udde6|\ud83c\udde7|\ud83c\udde8|\ud83c\udde9|\ud83c\uddea|\ud83c\uddeb|\ud83c\uddec|\ud83c\udded|\ud83c\uddee|\ud83c\uddef|\ud83c\uddf0|\ud83c\uddf1|\ud83c\uddf2|\ud83c\uddf3|\ud83c\uddf4|\ud83c\uddf5|\ud83c\uddf6|\ud83c\uddf7|\ud83c\uddf8|\ud83c\uddf9|\ud83c\uddfa|\ud83c\uddfb|\ud83c\uddfc|\ud83c\uddfd|\ud83c\uddfe|\ud83c\uddff|\ud83c\udf0d|\ud83c\udf0e|\ud83c\udf10|\ud83c\udf12|\ud83c\udf16|\ud83c\udf17|\ue50a|\u3030|\u27b0|\u2797|\u2796|\u2795|\u2755|\u2754|\u2753|\u274e|\u274c|\u2728|\u270b|\u270a|\u2705|\u26ce|\u23f3|\u23f0|\u23ec|\u23eb|\u23ea|\u23e9|\u2122|\u27bf|\u00a9|\u00ae)|(?:(?:\ud83c\udc04|\ud83c\udd7f|\ud83c\ude1a|\ud83c\ude2f|\u3299|\u303d|\u2b55|\u2b50|\u2b1c|\u2b1b|\u2b07|\u2b06|\u2b05|\u2935|\u2934|\u27a1|\u2764|\u2757|\u2747|\u2744|\u2734|\u2733|\u2716|\u2714|\u2712|\u270f|\u270c|\u2709|\u2708|\u2702|\u26fd|\u26fa|\u26f5|\u26f3|\u26f2|\u26ea|\u26d4|\u26c5|\u26c4|\u26be|\u26bd|\u26ab|\u26aa|\u26a1|\u26a0|\u2693|\u267f|\u267b|\u3297|\u2666|\u2665|\u2663|\u2660|\u2653|\u2652|\u2651|\u2650|\u264f|\u264e|\u264d|\u264c|\u264b|\u264a|\u2649|\u2648|\u263a|\u261d|\u2615|\u2614|\u2611|\u260e|\u2601|\u2600|\u25fe|\u25fd|\u25fc|\u25fb|\u25c0|\u25b6|\u25ab|\u25aa|\u24c2|\u231b|\u231a|\u21aa|\u21a9|\u2199|\u2198|\u2197|\u2196|\u2195|\u2194|\u2139|\u2049|\u203c|\u2668)([\uFE0E\uFE0F]?)))/g,shouldntBeParsed=/IFRAME|NOFRAMES|NOSCRIPT|SCRIPT|SELECT|STYLE|TEXTAREA/,fromCharCode=String.fromCharCode;return twemoji;function createText(text){return document.createTextNode(text)}function defaultImageSrcGenerator(icon,options){return"".concat(options.base,options.size,"/",icon,options.ext)}function grabAllTextNodes(node,allText){var childNodes=node.childNodes,length=childNodes.length,subnode,nodeType;while(length--){subnode=childNodes[length];nodeType=subnode.nodeType;if(nodeType===3){allText.push(subnode)}else if(nodeType===1&&!shouldntBeParsed.test(subnode.nodeName)){grabAllTextNodes(subnode,allText)}}return allText}function grabTheRightIcon(icon,variant){return toCodePoint(variant===""?icon.slice(0,-1):icon.length===3&&icon.charAt(1)===""?icon.charAt(0)+icon.charAt(2):icon)}function parseNode(node,options){var allText=grabAllTextNodes(node,[]),length=allText.length,modified,fragment,subnode,text,match,i,index,img,alt,icon,variant,src;while(length--){modified=false;fragment=document.createDocumentFragment();subnode=allText[length];text=subnode.nodeValue;i=0;while(match=re.exec(text)){index=match.index;if(index!==i){fragment.appendChild(createText(text.slice(i,index)))}alt=match[0];icon=match[1];variant=match[2];i=index+alt.length;if(variant!==""){src=options.callback(grabTheRightIcon(icon,variant),options,variant);if(src){img=new Image;img.onerror=twemoji.onerror;img.className=options.className;img.setAttribute("draggable","false");img.alt=alt;img.src=src;modified=true;fragment.appendChild(img)}}if(!img)fragment.appendChild(createText(alt));img=null}if(modified){if(i<text.length){fragment.appendChild(createText(text.slice(i)))}subnode.parentNode.replaceChild(fragment,subnode)}}return node}function parseString(str,options){return replace(str,function(match,icon,variant){var src;if(variant!==""){src=options.callback(grabTheRightIcon(icon,variant),options,variant);if(src){match="<img ".concat('class="',options.className,'" ','draggable="false" ','alt="',match,'" ','src="',src,'"',">")}}return match})}function toSizeSquaredAsset(value){return typeof value==="number"?value+"x"+value:value}function fromCodePoint(codepoint){var code=typeof codepoint==="string"?parseInt(codepoint,16):codepoint;if(code<65536){return fromCharCode(code)}code-=65536;return fromCharCode(55296+(code>>10),56320+(code&1023))}function parse(what,how){if(!how||typeof how==="function"){how={callback:how}}return(typeof what==="string"?parseString:parseNode)(what,{callback:how.callback||defaultImageSrcGenerator,base:typeof how.base==="string"?how.base:twemoji.base,ext:how.ext||twemoji.ext,size:how.folder||toSizeSquaredAsset(how.size||twemoji.size),className:how.className||twemoji.className})}function replace(text,callback){return String(text).replace(re,callback)}function test(text){re.lastIndex=0;var result=re.test(text);re.lastIndex=0;return result}function toCodePoint(unicodeSurrogates,sep){var r=[],c=0,p=0,i=0;while(i<unicodeSurrogates.length){c=unicodeSurrogates.charCodeAt(i++);if(p){r.push((65536+(p-55296<<10)+(c-56320)).toString(16));p=0}else if(55296<=c&&c<=56319){p=c}else{r.push(c.toString(16))}}return r.join(sep||"-")}}();if(!location.protocol){twemoji.base=twemoji.base.replace(/^http:/,"")}module.exports=twemoji}).call(exports,function(){return this}())},2043:function(module,exports,__webpack_require__){(function(global){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _promise=__webpack_require__(49);var _promise2=_interopRequireDefault(_promise);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactDom=__webpack_require__(44);var _reactDom2=_interopRequireDefault(_reactDom);var _mixin=__webpack_require__(111);var _mixin2=_interopRequireDefault(_mixin);var _filter=__webpack_require__(77);var _filter2=_interopRequireDefault(_filter);var _forEach=__webpack_require__(114);var _forEach2=_interopRequireDefault(_forEach);var _forOwn=__webpack_require__(287);var _forOwn2=_interopRequireDefault(_forOwn);var _noop=__webpack_require__(38);var _noop2=_interopRequireDefault(_noop);var _assign=__webpack_require__(34);var _assign2=_interopRequireDefault(_assign);var _loadScript=__webpack_require__(227);var _debug=__webpack_require__(3);var _debug2=_interopRequireDefault(_debug);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var debug=(0,_debug2.default)("calypso:components:embed-container");var embedsToLookFor={'blockquote[class^="instagram-"]':embedInstagram,'blockquote[class^="twitter-"]':embedTwitter,"fb\\:post, [class^=fb-]":embedFacebook,"[class^=tumblr-]":embedTumblr,".jetpack-slideshow":embedSlideshow};var cacheBustQuery="?v="+Math.floor((new Date).getTime()/(1e3*60*60*24*10));var SLIDESHOW_URLS={CSS:"https://s0.wp.com/wp-content/mu-plugins/shortcodes/css/slideshow-shortcode.css"+cacheBustQuery,CYCLE_JS:"https://s0.wp.com/wp-content/mu-plugins/shortcodes/js/jquery.cycle.js"+cacheBustQuery,JS:"https://s0.wp.com/wp-content/mu-plugins/shortcodes/js/slideshow-shortcode.js"+cacheBustQuery,SPINNER:"https://s0.wp.com/wp-content/mu-plugins/shortcodes/img/slideshow-loader.gif"+cacheBustQuery};function processEmbeds(domNode){(0,_forOwn2.default)(embedsToLookFor,function(fn,embedSelector){var nodes=domNode.querySelectorAll(embedSelector);(0,_forEach2.default)((0,_filter2.default)(nodes,nodeNeedsProcessing),fn)})}function nodeNeedsProcessing(domNode){if(domNode.hasAttribute("data-wpcom-embed-processed")){return false}domNode.setAttribute("data-wpcom-embed-processed","1");return true}function loadCSS(cssUrl){var link=(0,_assign2.default)(document.createElement("link"),{rel:"stylesheet",type:"text/css",href:cssUrl});document.head.appendChild(link)}var loaders={};function loadAndRun(scriptUrl,callback){var loader=loaders[scriptUrl];if(!loader){loader=new _promise2.default(function(resolve,reject){(0,_loadScript.loadScript)(scriptUrl,function(err){if(err){reject(err)}else{resolve()}})});loaders[scriptUrl]=loader}loader.then(callback,function(err){debug("error loading "+scriptUrl,err);loaders[scriptUrl]=null})}function embedInstagram(domNode){debug("processing instagram for",domNode);if(typeof instgrm!=="undefined"){global.instgrm.Embeds.process();return}loadAndRun("https://platform.instagram.com/en_US/embeds.js",embedInstagram.bind(null,domNode))}function embedTwitter(domNode){debug("processing twitter for",domNode);if(typeof twttr!=="undefined"){global.twttr.widgets.load(domNode);return}loadAndRun("https://platform.twitter.com/widgets.js",embedTwitter.bind(null,domNode))}function embedFacebook(domNode){debug("processing facebook for",domNode);if(typeof fb!=="undefined"){return}loadAndRun("https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.2",_noop2.default)}var tumblrLoader=void 0;function embedTumblr(domNode){debug("processing tumblr for",domNode);if(tumblrLoader){return}tumblrLoader=true;function removeScript(){(0,_forEach2.default)(document.querySelectorAll('script[src="https://secure.assets.tumblr.com/post.js"]'),function(el){el.parentNode.removeChild(el)});tumblrLoader=false}setTimeout(function(){(0,_loadScript.loadScript)("https://secure.assets.tumblr.com/post.js",removeScript)},30)}function triggerJQueryLoadEvent(){window.jQuery("body").trigger("post-load")}function createSlideshow(){if(window.JetpackSlideshow){triggerJQueryLoadEvent()}loadAndRun(SLIDESHOW_URLS.JS,function(){triggerJQueryLoadEvent()})}var slideshowCSSPresent=document.head.querySelector('link[href="'+SLIDESHOW_URLS.CSS+'"]');function embedSlideshow(domNode){debug("processing slideshow for",domNode);window.jetpackSlideshowSettings={spinner:SLIDESHOW_URLS.SPINNER};if(!slideshowCSSPresent){slideshowCSSPresent=true;loadCSS(SLIDESHOW_URLS.CSS)}var warningElements=domNode.parentNode.getElementsByClassName("jetpack-slideshow-noscript");(0,_forEach2.default)(warningElements,function(el){el.classList.add("hidden")});if(window.jQuery&&window.jQuery.prototype.cycle){createSlideshow()}else if(window.jQuery&&!window.jQuery.prototype.cycle){loadAndRun(SLIDESHOW_URLS.CYCLE_JS,function(){createSlideshow()})}else{(0,_loadScript.loadjQueryDependentScript)(SLIDESHOW_URLS.CYCLE_JS,function(){createSlideshow()})}}exports.default=_react2.default.createClass({displayName:"embed-container",mixins:[_mixin2.default],componentDidMount:function componentDidMount(){debug("did mount");processEmbeds(_reactDom2.default.findDOMNode(this))},componentDidUpdate:function componentDidUpdate(){debug("did update");processEmbeds(_reactDom2.default.findDOMNode(this))},componentWillUnmount:function componentWillUnmount(){debug("unmounting")},render:function render(){return _react2.default.Children.only(this.props.children)}});module.exports=exports["default"]}).call(exports,function(){return this}())},2067:function(module,exports){"use strict";module.exports={UNCLASSIFIED:0,PHOTO_ONLY:1,LARGE_BANNER:2,ONE_LINER:4,LANDSCAPE_BANNER:8,PORTRAIT_BANNER:16,GALLERY:32,VIDEO:64,THUMBNAIL:128,CANONICAL_IN_CONTENT:256,FEATURED_VIDEO:512,X_POST:1024}},2070:function(module,exports,__webpack_require__){"use strict";var assign=__webpack_require__(34),clone=__webpack_require__(212),config=__webpack_require__(12),isEqual=__webpack_require__(98);var Dispatcher=__webpack_require__(42),Emitter=__webpack_require__(36),FeedPostStoreActionType=__webpack_require__(1971).action,LikeActions=__webpack_require__(1975),key=__webpack_require__(2247).key;var _likesForPost={},LikeStore,receivedErrors=[];function getLikes(siteId,postId){return _likesForPost[key(siteId,postId)]}function setLikes(siteId,postId,likes){_likesForPost[key(siteId,postId)]=likes}LikeStore={getLikersForPost:function getLikersForPost(siteId,postId){var likes=getLikes(siteId,postId);if(likes&&likes.likes){return likes.likes}LikeActions.fetchLikes(siteId,postId);return null},getLikeCountForPost:function getLikeCountForPost(siteId,postId){var likes=getLikes(siteId,postId);if(likes&&likes.count!=null){return likes.count}LikeActions.fetchLikes(siteId,postId);return null},isPostLikedByCurrentUser:function isPostLikedByCurrentUser(siteId,postId){var likes=getLikes(siteId,postId);if(likes&&likes.i_like!=null){return likes.i_like}LikeActions.fetchLikes(siteId,postId);return null},receivePostLikes:function receivePostLikes(action){if(!action||action.error){if(action.error){receivedErrors.push(action)}return}if(!action.siteId||!action.postId){return}var currentLike=getLikes(action.siteId,action.postId);var receivedLike={count:action.data.found,likes:action.data.likes,i_like:action.data.i_like};if(!isEqual(receivedLike,currentLike)){setLikes(action.siteId,action.postId,receivedLike);LikeStore.emit("change")}},receiveUserLikeChange:function receiveUserLikeChange(action){if(!action||action.error){if(action.error){receivedErrors.push(action)}return}this.receivePost(action.siteId,action.postId,action.data)},receivePost:function receivePost(siteId,postId,post){if(!siteId||!postId||!post||post.is_external){return}var currentLike=getLikes(siteId,postId)||{};if(currentLike.count!==post.like_count||currentLike.i_like!==post.i_like){setLikes(siteId,postId,{count:post.like_count,likes:currentLike.likes,i_like:!!post.i_like});LikeStore.emit("change")}},receiveLike:function receiveLike(action){var current=getLikes(action.siteId,action.postId),newLikes=clone(current);newLikes.count+=1;newLikes.i_like=true;setLikes(action.siteId,action.postId,newLikes);LikeStore.emit("change")},receiveUnlike:function receiveUnlike(action){var current=getLikes(action.siteId,action.postId),newLikes=clone(current);newLikes.count-=1;newLikes.i_like=false;setLikes(action.siteId,action.postId,newLikes);LikeStore.emit("change")}};if(config("env")==="development"){assign(LikeStore,{_all:function _all(){return _likesForPost},_reset:function _reset(){_likesForPost={}}})}Emitter(LikeStore);LikeStore.setMaxListeners(100);LikeStore.dispatchToken=Dispatcher.register(function(payload){var action=payload.action;switch(action.type){case"LIKE_POST":LikeStore.receiveLike(action);break;case"UNLIKE_POST":LikeStore.receiveUnlike(action);break;case"RECEIVE_POST_LIKES":LikeStore.receivePostLikes(action);break;case"RECEIVE_LIKE_RESPONSE":case"RECEIVE_UNLIKE_RESPONSE":LikeStore.receiveUserLikeChange(action);break;case FeedPostStoreActionType.RECEIVE_FEED_POST:if(!action.data){return}LikeStore.receivePost(action.data.site_ID,action.data.ID,action.data);break}});module.exports=LikeStore},2080:function(module,exports,__webpack_require__){"use strict";var Dispatcher=__webpack_require__(42),wpcom=__webpack_require__(28).undocumented(),ActionTypes=__webpack_require__(1906).action;var SiteBlockActions={block:function block(siteId){if(!siteId){return}Dispatcher.handleViewAction({type:ActionTypes.BLOCK_SITE,siteId:siteId,data:{siteId:siteId}});wpcom.me().blockSite(siteId,function(error,data){Dispatcher.handleServerAction({type:ActionTypes.RECEIVE_BLOCK_SITE,siteId:siteId,data:data,error:error})})},unblock:function unblock(siteId){if(!siteId){return}Dispatcher.handleViewAction({type:ActionTypes.UNBLOCK_SITE,siteId:siteId,data:{siteId:siteId}});wpcom.me().unblockSite(siteId,function(error,data){Dispatcher.handleServerAction({type:ActionTypes.RECEIVE_UNBLOCK_SITE,siteId:siteId,data:data,error:error})})},dismissError:function dismissError(error){if(!error){return}Dispatcher.handleViewAction({type:ActionTypes.DISMISS_BLOCK_ERROR,data:error})}};module.exports=SiteBlockActions},2081:function(module,exports,__webpack_require__){"use strict";var Dispatcher=__webpack_require__(42),isEqual=__webpack_require__(98),map=__webpack_require__(45),reject=__webpack_require__(209),find=__webpack_require__(27);var emitter=__webpack_require__(36),TagStore=__webpack_require__(2275),TagSubscriptionStore;var subscriptions=null;function sortSubscriptions(a,b){if(a.slug>b.slug){return 1}if(a.slug<b.slug){return-1}return 0}TagSubscriptionStore={get:function get(){return subscriptions&&subscriptions.map(function(sub){return TagStore.get(sub.slug)||sub})},isSubscribed:function isSubscribed(slug){return!!find(subscriptions,{slug:slug})},getSubscription:function getSubscription(slug){return find(subscriptions,{slug:slug})},receiveSubscriptions:function receiveSubscriptions(newSubscriptions){newSubscriptions=map(newSubscriptions,function(sub){return{ID:sub.ID,slug:sub.slug.toLowerCase()}});newSubscriptions.sort(sortSubscriptions);if(!isEqual(newSubscriptions,subscriptions)){subscriptions=newSubscriptions;TagSubscriptionStore.emit("change")}},receiveFollowComplete:function receiveFollowComplete(tagId){var tag=find(subscriptions,{ID:tagId});if(tag){TagSubscriptionStore.emit("add",tag)}},receiveFollowTag:function receiveFollowTag(newTag){if(subscriptions===null){subscriptions=[]}subscriptions.push({ID:"pending",slug:newTag.slug.toLowerCase()});subscriptions.sort(sortSubscriptions);TagSubscriptionStore.emit("change")},receiveUnfollowTag:function receiveUnfollowTag(slug){var newSubscriptions=reject(subscriptions,{slug:slug});if(newSubscriptions.length!==subscriptions.length){subscriptions=newSubscriptions;TagSubscriptionStore.emit("change")}}};emitter(TagSubscriptionStore);TagSubscriptionStore.dispatchToken=Dispatcher.register(function(payload){var action=payload.action;if(!action){return}Dispatcher.waitFor([TagStore.dispatchToken]);switch(action.type){case"FOLLOW_READER_TAG":TagSubscriptionStore.receiveFollowTag(action.data);break;case"UNFOLLOW_READER_TAG":TagSubscriptionStore.receiveUnfollowTag(action.data.slug);break;case"RECEIVE_READER_TAG_SUBSCRIPTIONS":case"RECEIVE_UNFOLLOW_READER_TAG":if(action.error){return}TagSubscriptionStore.receiveSubscriptions(action.data.tags);break;case"RECEIVE_FOLLOW_READER_TAG":if(action.error){TagSubscriptionStore.receiveUnfollowTag(action.newSlug);return}TagSubscriptionStore.receiveSubscriptions(action.data.tags);TagSubscriptionStore.receiveFollowComplete(action.data.added_tag);break}});module.exports=TagSubscriptionStore},2082:function(module,exports,__webpack_require__){"use strict";var keyMirror=__webpack_require__(116);module.exports.action=keyMirror({RECEIVE_TEAMS:null});module.exports.error=keyMirror({UNABLE_TO_RECEIVE_TEAMS:null})},2163:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _defer2=__webpack_require__(385);var _defer3=_interopRequireDefault(_defer2);var _get2=__webpack_require__(24);var _get3=_interopRequireDefault(_get2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _page=__webpack_require__(33);var _page2=_interopRequireDefault(_page);var _qs=__webpack_require__(220);var _qs2=_interopRequireDefault(_qs);var _i18nCalypso=__webpack_require__(11);var _sectionsPreload=__webpack_require__(142);var _sitesPopover=__webpack_require__(782);var _sitesPopover2=_interopRequireDefault(_sitesPopover);var _button=__webpack_require__(69);var _button2=_interopRequireDefault(_button);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _actions=__webpack_require__(1813);var _sitesList=__webpack_require__(53);var _sitesList2=_interopRequireDefault(_sitesList);var _stats=__webpack_require__(1643);var _helper=__webpack_require__(2001);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var sitesList=(0,_sitesList2.default)();function getPingbackAttributes(post){var typeTitles={prompt:(0,_i18nCalypso.translate)("Daily Prompt: "),photo:(0,_i18nCalypso.translate)("Photo Challenge: "),discover:(0,_i18nCalypso.translate)("Discover Challenge: ")};var title=typeTitles[(0,_helper.getDailyPostType)(post)]+post.title;return{title:title,url:post.URL}}function preventDefault(event){event.preventDefault()}function preloadEditor(){(0,_sectionsPreload.preload)("post-editor")}function onlyOneSite(){return sitesList.data.length===1}var DailyPostButton=function(_React$Component){(0,_inherits3.default)(DailyPostButton,_React$Component);function DailyPostButton(){(0,_classCallCheck3.default)(this,DailyPostButton);var _this=(0,_possibleConstructorReturn3.default)(this,(DailyPostButton.__proto__||(0,_getPrototypeOf2.default)(DailyPostButton)).call(this));_this.state={showingMenu:false};_this._closeTimerId=null;_this._isMounted=false;["openEditorWithSite","toggle","closeMenu","renderSitesPopover"].forEach(function(method){return _this[method]=_this[method].bind(_this)});return _this}(0,_createClass3.default)(DailyPostButton,[{key:"componentDidMount",value:function componentDidMount(){this._isMounted=true}},{key:"componentWillUnmount",
value:function componentWillUnmount(){this._isMounted=false;if(this._closeTimerId){clearTimeout(this._closeTimerId);this._closeDefer=null}}},{key:"_deferMenuChange",value:function _deferMenuChange(showingMenu){var _this2=this;if(this._closeTimerId){clearTimeout(this._closeTimerId)}this._closeTimerId=(0,_defer3.default)(function(){_this2._closeTimerId=null;_this2.setState({showingMenu:showingMenu})})}},{key:"openEditorWithSite",value:function openEditorWithSite(siteSlug){var pingbackAttributes=getPingbackAttributes(this.props.post);(0,_stats.recordAction)("daily_post_challenge");(0,_stats.recordGaEvent)("Clicked on Daily Post challenge");(0,_stats.recordTrackForPost)("calypso_reader_daily_post_challenge_site_picked",this.props.post);(0,_actions.markSeen)(this.props.post);(0,_page2.default)("/post/"+siteSlug+"?"+_qs2.default.stringify(pingbackAttributes));return true}},{key:"toggle",value:function toggle(event){preventDefault(event);if(!this.state.showingMenu){(0,_stats.recordAction)("open_daily_post_challenge");(0,_stats.recordGaEvent)("Opened Daily Post Challenge");(0,_stats.recordTrackForPost)("calypso_reader_daily_post_challenge_opened",this.props.post);if(onlyOneSite()){var primarySlug=(0,_get3.default)(sitesList.getPrimary(),"slug");return this.openEditorWithSite(primarySlug)}}this._deferMenuChange(!this.state.showingMenu)}},{key:"closeMenu",value:function closeMenu(){if(this._isMounted){this._deferMenuChange(false)}}},{key:"renderSitesPopover",value:function renderSitesPopover(){return _react2.default.createElement(_sitesPopover2.default,{key:"menu",header:_react2.default.createElement("div",null," ",(0,_i18nCalypso.translate)("Post on")," "),sites:sitesList,context:this.refs&&this.refs.dailyPostButton,visible:this.state.showingMenu,groups:true,onSiteSelect:this.openEditorWithSite,onClose:this.closeMenu,position:"top",className:"is-reader"})}},{key:"render",value:function render(){var canParticipate=!!sitesList.getPrimary();var title=(0,_get3.default)(this.props,"post.title");var buttonClasses=(0,_classnames2.default)({reader__daily_post_button:true,"ignore-click":true,"is-active":this.state.showingMenu});if(!canParticipate){return null}return _react2.default.createElement(this.props.tagName,{className:"reader__daily-post",onTouchTap:this.toggle,onClick:preventDefault,onTouchStart:preloadEditor,onMouseEnter:preloadEditor},[_react2.default.createElement(_button2.default,{ref:"dailyPostButton",key:"button",compact:true,primary:true,className:buttonClasses},_react2.default.createElement(_gridicon2.default,{icon:"create"}),_react2.default.createElement("span",null,(0,_i18nCalypso.translate)("Post about %(title)s",{args:{title:title}})," ")),this.state.showingMenu?this.renderSitesPopover():null])}}]);return DailyPostButton}(_react2.default.Component);DailyPostButton.propTypes={post:_react2.default.PropTypes.object.isRequired,position:_react2.default.PropTypes.string,tagName:_react2.default.PropTypes.string};DailyPostButton.defaultProps={position:"top",tagName:"li"};exports.default=DailyPostButton;module.exports=exports["default"]},2164:function(module,exports,__webpack_require__){"use strict";var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _i18nCalypso=__webpack_require__(11);var _followButton=__webpack_require__(1723);var _followButton2=_interopRequireDefault(_followButton);var _helper=__webpack_require__(1674);var _stats=__webpack_require__(2348);var discoverStats=_interopRequireWildcard(_stats);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var DiscoverSiteAttribution=function(_React$Component){(0,_inherits3.default)(DiscoverSiteAttribution,_React$Component);function DiscoverSiteAttribution(props){(0,_classCallCheck3.default)(this,DiscoverSiteAttribution);var _this=(0,_possibleConstructorReturn3.default)(this,(DiscoverSiteAttribution.__proto__||(0,_getPrototypeOf2.default)(DiscoverSiteAttribution)).call(this,props));["recordSiteClick","recordFollowToggle"].forEach(function(method){_this[method]=_this[method].bind(_this)});return _this}(0,_createClass3.default)(DiscoverSiteAttribution,[{key:"recordSiteClick",value:function recordSiteClick(){discoverStats.recordSiteClick(this.props.siteUrl)}},{key:"recordFollowToggle",value:function recordFollowToggle(isFollowing){discoverStats.recordFollowToggle(isFollowing,this.props.siteUrl)}},{key:"render",value:function render(){var attribution=this.props.attribution;var classes=(0,_classnames2.default)("discover-attribution is-site",{"is-missing-avatar":!attribution.avatar_url});var siteLinkProps=(0,_helper.getLinkProps)(this.props.siteUrl);var siteClasses=(0,_classnames2.default)("discover-attribution__blog ignore-click");return _react2.default.createElement("div",{className:classes},attribution.avatar_url?_react2.default.createElement("img",{className:"gravatar",src:encodeURI(attribution.avatar_url),alt:"Avatar",width:"20",height:"20"}):_react2.default.createElement("span",{className:"noticon noticon-website"}),_react2.default.createElement("span",null,_react2.default.createElement("a",(0,_extends3.default)({},siteLinkProps,{className:siteClasses,href:encodeURI(this.props.siteUrl),onClick:this.recordSiteClick}),(0,_i18nCalypso.translate)("visit")," ",_react2.default.createElement("em",null,attribution.blog_name))),!!this.props.followUrl?_react2.default.createElement(_followButton2.default,{siteUrl:this.props.followUrl,iconSize:20,onFollowToggle:this.recordFollowToggle}):null)}}]);return DiscoverSiteAttribution}(_react2.default.Component);DiscoverSiteAttribution.propTypes={attribution:_react2.default.PropTypes.shape({blog_name:_react2.default.PropTypes.string.isRequired,blog_url:_react2.default.PropTypes.string.isRequired,avatar_url:_react2.default.PropTypes.string}).isRequired,siteUrl:_react2.default.PropTypes.string.isRequired,followUrl:_react2.default.PropTypes.string.isRequired};module.exports=DiscoverSiteAttribution},2172:function(module,exports){"use strict";module.exports={shouldShowShare:function shouldShowShare(post){return!post.site_is_private}}},2173:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1),url=__webpack_require__(70),defer=__webpack_require__(385),config=__webpack_require__(12),classnames=__webpack_require__(10),qs=__webpack_require__(220),page=__webpack_require__(33);var PopoverMenu=__webpack_require__(1673),PopoverMenuItem=__webpack_require__(1652),Gridicon=__webpack_require__(26),sitesList=__webpack_require__(53)(),stats=__webpack_require__(1643),SocialLogo=__webpack_require__(758),SitesPopover=__webpack_require__(782),sections=__webpack_require__(142);var actionMap={twitter:function twitter(post){var twitterUrl={scheme:"https",hostname:"twitter.com",pathname:"/intent/tweet",query:{text:post.title,url:post.URL,via:"wordpressdotcom"}};twitterUrl=url.format(twitterUrl);window.open(twitterUrl,"twitter","width=550,height=420,resizeable,scrollbars")},facebook:function facebook(post){var fackbookUrl={scheme:"https",hostname:"www.facebook.com",pathname:"/sharer.php",query:{u:post.URL,app_id:config("facebook_api_key")}};fackbookUrl=url.format(fackbookUrl);window.open(fackbookUrl,"facebook","width=626,height=436,resizeable,scrollbars")}};function buildQuerystringForPost(post){var primarySite=sitesList.getPrimary();if(!primarySite){return}var args={};if(post.content_embeds&&post.content_embeds.length){args.embed=post.content_embeds[0].embedUrl||post.content_embeds[0].src}if(post.canonical_image&&post.canonical_image.uri){args.image=post.canonical_image.uri}args.title=post.title+"  "+post.site_name;args.text=post.excerpt;args.url=post.URL;return qs.stringify(args)}var ReaderShare=React.createClass({displayName:"ReaderShare",getInitialState:function getInitialState(){return{showingMenu:false}},getDefaultProps:function getDefaultProps(){return{position:"top",tagName:"li"}},componentWillUnmount:function componentWillUnmount(){if(this._closeHandle){clearTimeout(this._closeHandle);this._closeHandle=null}},_deferMenuChange:function _deferMenuChange(showing){var _this=this;if(this._closeHandle){clearTimeout(this._closeHandle)}this._closeHandle=defer(function(){_this._closeHandle=null;_this.setState({showingMenu:showing})})},toggle:function toggle(event){event.preventDefault();if(!this.state.showingMenu){var target=!!sitesList.getPrimary()?"wordpress":"external";stats.recordAction("open_share");stats.recordGaEvent("Opened Share to "+target);stats.recordTrack("calypso_reader_share_opened",{target:target})}this._deferMenuChange(!this.state.showingMenu)},killClick:function killClick(event){event.preventDefault()},closeMenu:function closeMenu(){if(this.isMounted()){this._deferMenuChange(false)}},pickSiteToShareTo:function pickSiteToShareTo(slug){stats.recordAction("share_wordpress");stats.recordGaEvent("Clicked on Share to WordPress");stats.recordTrack("calypso_reader_share_to_site");page("/post/"+slug+"?"+buildQuerystringForPost(this.props.post));return true},closeExternalShareMenu:function closeExternalShareMenu(action){this.closeMenu();var actionFunc=actionMap[action];if(actionFunc){stats.recordAction("share_"+action);stats.recordGaEvent("Clicked on Share to "+action);stats.recordTrack("calypso_reader_share_action_picked",{action:action});actionFunc(this.props.post)}},preloadEditor:function preloadEditor(){sections.preload("post-editor")},render:function render(){var canShareToWordpress=!!sitesList.getPrimary(),buttonClasses=classnames({"reader-share_button":true,"ignore-click":true,"is-active":this.state.showingMenu});return React.createElement(this.props.tagName,{className:"reader-share",onClick:this.killClick,onTouchTap:this.toggle,onTouchStart:this.preloadEditor,onMouseEnter:this.preloadEditor,ref:"shareButton"},[React.createElement("span",{key:"button",ref:"shareButton",className:buttonClasses},React.createElement(Gridicon,{icon:"share",size:24}),React.createElement("span",{className:"reader-share__button-label"},this.translate("Share",{comment:"Share the post"}))),this.state.showingMenu&&(canShareToWordpress?React.createElement(SitesPopover,{key:"menu",header:React.createElement("div",null,this.translate("Share on:")),sites:sitesList,context:this.refs&&this.refs.shareButton,visible:this.state.showingMenu,groups:true,onSiteSelect:this.pickSiteToShareTo,onClose:this.closeMenu,position:this.props.position,className:"is-reader"}):React.createElement(PopoverMenu,{key:"menu",context:this.refs&&this.refs.shareButton,isVisible:this.state.showingMenu,onClose:this.closeExternalShareMenu,position:this.props.position,className:"popover reader-share__popover"},React.createElement(PopoverMenuItem,{action:"twitter",className:"reader-share__popover-item"},React.createElement(SocialLogo,{icon:"twitter"}),React.createElement("span",null,"Twitter")),React.createElement(PopoverMenuItem,{action:"facebook",className:"reader-share__popover-item"},React.createElement(SocialLogo,{icon:"facebook"}),React.createElement("span",null,"Facebook"))))])}});module.exports=ReaderShare},2180:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _property2=__webpack_require__(171);var _property3=_interopRequireDefault(_property2);var _omit2=__webpack_require__(18);var _omit3=_interopRequireDefault(_omit2);var _map2=__webpack_require__(45);var _map3=_interopRequireDefault(_map2);var _get2=__webpack_require__(24);var _get3=_interopRequireDefault(_get2);exports.receiveRecommendations=receiveRecommendations;exports.recordRecommendationInteraction=recordRecommendationInteraction;exports.requestRecommendations=requestRecommendations;exports.requestGraduate=requestGraduate;var _debug=__webpack_require__(3);var _debug2=_interopRequireDefault(_debug);var _wp=__webpack_require__(28);var _wp2=_interopRequireDefault(_wp);var _actionTypes=__webpack_require__(2);var _actions=__webpack_require__(3299);var _actions2=__webpack_require__(2365);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var debug=(0,_debug2.default)("calypso:redux:reader-start");function receiveRecommendations(recommendations){return{type:_actionTypes.READER_START_RECOMMENDATIONS_RECEIVE,recommendations:recommendations}}function recordRecommendationInteraction(recommendationId,siteId,postId){return function(dispatch){debug("User interacted with recommendation "+recommendationId);var numberOfRecommendationsToLoad=3;dispatch(requestRecommendations(siteId,postId,numberOfRecommendationsToLoad));dispatch({type:_actionTypes.READER_START_RECOMMENDATION_INTERACTION,recommendationId:recommendationId})}}function requestRecommendations(originSiteId,originPostId,limit){return function(dispatch){dispatch({type:_actionTypes.READER_START_RECOMMENDATIONS_REQUEST});if(!limit){limit=20}var query={meta:"site,post",origin_site_ID:originSiteId,origin_post_ID:originPostId,number:limit};debug("Requesting recommendations for site "+originSiteId+" and post "+originPostId);return _wp2.default.undocumented().readRecommendationsStart(query).then(function(data){var sites=(0,_map3.default)(data.recommendations,(0,_property3.default)("meta.data.site"));var posts=(0,_map3.default)(data.recommendations,function(rec){var post=(0,_get3.default)(rec,"meta.data.post");if(post&&rec.railcar){post.railcar=rec.railcar}return post});dispatch((0,_actions.updateSites)(sites));return dispatch((0,_actions2.receivePosts)(posts)).then(function(){var recommendations=(0,_map3.default)(data.recommendations,function(recommendation){return(0,_omit3.default)(recommendation,"meta")});dispatch(receiveRecommendations(recommendations));dispatch({type:_actionTypes.READER_START_RECOMMENDATIONS_REQUEST_SUCCESS,data:data})})},function(error){dispatch({type:_actionTypes.READER_START_RECOMMENDATIONS_REQUEST_FAILURE,error:error})})}}function requestGraduate(){return function(dispatch){dispatch({type:_actionTypes.READER_START_GRADUATE_REQUEST});debug("Graduating user from cold start");return _wp2.default.undocumented().graduateNewReader().then(function(data){dispatch({type:_actionTypes.READER_START_GRADUATE_REQUEST_SUCCESS,data:data});dispatch({type:_actionTypes.READER_START_GRADUATED})},function(error){dispatch({type:_actionTypes.READER_START_GRADUATE_REQUEST_FAILURE,error:error})})}}},2186:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.showReaderFullPost=showReaderFullPost;exports.hideReaderFullPost=hideReaderFullPost;var _actionTypes=__webpack_require__(2);function showReaderFullPost(){return{type:_actionTypes.READER_FULLPOST_SHOW}}function hideReaderFullPost(){return{type:_actionTypes.READER_FULLPOST_HIDE}}},2190:function(module,exports,__webpack_require__){module.exports=__webpack_require__(3362)},2205:function(module,exports,__webpack_require__){var isSymbol=__webpack_require__(148);function baseExtremum(array,iteratee,comparator){var index=-1,length=array.length;while(++index<length){var value=array[index],current=iteratee(value);if(current!=null&&(computed===undefined?current===current&&!isSymbol(current):comparator(current,computed))){var computed=current,result=value}}return result}module.exports=baseExtremum},2228:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1);var SelectDropdownSeparator=React.createClass({displayName:"SelectDropdownSeparator",render:function render(){return React.createElement("li",{className:"select-dropdown__separator"})}});module.exports=SelectDropdownSeparator},2241:function(module,exports,__webpack_require__){"use strict";var _lruCache=__webpack_require__(805);var _lruCache2=_interopRequireDefault(_lruCache);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var cache=(0,_lruCache2.default)(10);var specialCache={};function isSpecialStream(id){return/^following|a8c|likes/.test(id)}module.exports={get:function get(id){if(isSpecialStream(id)){return specialCache[id]}return cache.get(id)},set:function set(id,store){if(isSpecialStream(id)){specialCache[id]=store}else{cache.set(id,store)}}}},2245:function(module,exports,__webpack_require__){"use strict";var debug=__webpack_require__(3)("calypso:infinite-list:positions-store"),Dispatcher=__webpack_require__(42),isEqual=__webpack_require__(98);var emitter=__webpack_require__(36);var _infiniteListPositions={},InfiniteListPositionsStore={get:function get(url){debug("positions-store:get(): ",url,_infiniteListPositions);return _infiniteListPositions[url]}};emitter(InfiniteListPositionsStore);function storeInfiniteListPositions(url,positions){var oldPositions=InfiniteListPositionsStore.get(url);debug("comparing positions:",url,oldPositions,positions);if(isEqual(oldPositions,positions)){return}debug("storing values:",url,positions);_infiniteListPositions[url]=positions;InfiniteListPositionsStore.emit("change")}InfiniteListPositionsStore.dispatchToken=Dispatcher.register(function(payload){var action=payload.action;switch(action.type){case"INFINITE_LIST_POSITION_CHANGED":storeInfiniteListPositions(action.url,action.positions);break}});module.exports=InfiniteListPositionsStore},2246:function(module,exports,__webpack_require__){"use strict";var Dispatcher=__webpack_require__(42);var _scrollStore={},InfiniteListScrollStore={get:function get(url){return _scrollStore[url]}};function storeInfiniteListScrollPosition(url,scrollPosition){var oldScrollPosition=InfiniteListScrollStore.get(url);if(oldScrollPosition===scrollPosition){return}_scrollStore[url]=scrollPosition}InfiniteListScrollStore.dispatchToken=Dispatcher.register(function(payload){var action=payload.action;switch(action.type){case"SCROLL_CHANGED":storeInfiniteListScrollPosition(action.url,action.scrollPosition);break}});module.exports=InfiniteListScrollStore},2247:function(module,exports){"use strict";module.exports={key:function key(siteId,postId){if(!siteId||!postId){throw new Error("siteId and postId must be non-empty")}return siteId+"-"+postId}}},2248:function(module,exports,__webpack_require__){"use strict";var throttle=__webpack_require__(388);var ObserveWindowSizeMixin={componentDidMount:function componentDidMount(){this._handleWindowResize=throttle(this.onWindowResize,100);window.addEventListener("resize",this._handleWindowResize)},componentWillUnmount:function componentWillUnmount(){window.removeEventListener("resize",this._handleWindowResize)}};module.exports=ObserveWindowSizeMixin},2251:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=detectEmbeds;var _endsWith=__webpack_require__(283);var _endsWith2=_interopRequireDefault(_endsWith);var _filter=__webpack_require__(77);var _filter2=_interopRequireDefault(_filter);var _forEach=__webpack_require__(114);var _forEach2=_interopRequireDefault(_forEach);var _forOwn=__webpack_require__(287);var _forOwn2=_interopRequireDefault(_forOwn);var _map=__webpack_require__(45);var _map2=_interopRequireDefault(_map);var _some=__webpack_require__(63);var _some2=_interopRequireDefault(_some);var _toArray=__webpack_require__(401);var _toArray2=_interopRequireDefault(_toArray);var _url=__webpack_require__(70);var _url2=_interopRequireDefault(_url);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function detectEmbeds(post,dom){if(!dom){throw new Error("this transform must be used as part of withContentDOM")}var embeds=(0,_toArray2.default)(dom.querySelectorAll("iframe"));var iframeWhitelist=["youtube.com","youtube-nocookie.com","videopress.com","vimeo.com","cloudup.com","soundcloud.com","8tracks.com","spotify.com","me.sh","bandcamp.com","kickstarter.com","facebook.com","embed.itunes.apple.com"];var iframeNoSandbox=["spotify.com","kickstarter.com"];embeds=(0,_filter2.default)(embeds,function(iframe){var iframeSrc=iframe.src&&_url2.default.parse(iframe.src).hostname.toLowerCase();return(0,_some2.default)(iframeWhitelist,function(accepted){return(0,_endsWith2.default)("."+iframeSrc,"."+accepted)})});var content_embeds=(0,_map2.default)(embeds,function(iframe){var node=iframe,embedType=null,aspectRatio,width,height,matches;var iframeHost=iframe.src&&_url2.default.parse(iframe.src).hostname.toLowerCase();var trustedHost=(0,_some2.default)(iframeNoSandbox,function(accepted){return(0,_endsWith2.default)("."+iframeHost,"."+accepted)});if(trustedHost){iframe.removeAttribute("sandbox")}else{iframe.setAttribute("sandbox","allow-same-origin allow-scripts allow-popups")}if(iframe.width&&iframe.height){width=Number(iframe.width);height=Number(iframe.height);if(!isNaN(width)&&!isNaN(height)){aspectRatio=width/height}if(isNaN(width)){width=iframe.width}if(isNaN(height)){height=iframe.height}}var embedUrl=iframe.getAttribute("data-wpcom-embed-url");do{if(!node.className){continue}matches=node.className.match(/\bembed-([-a-zA-Z0-9_]+)\b/);if(matches){embedType=matches[1];break}}while(node=node.parentNode);return{type:embedType,src:iframe.src,embedUrl:embedUrl,iframe:iframe.outerHTML,aspectRatio:aspectRatio,width:width,height:height}});var funnyEmbedSelectors={'blockquote[class^="instagram-"]':"instagram",'blockquote[class^="twitter-"]':"twitter","fb\\:post":"facebook",'[class^="fb-"]':"facebook"};(0,_forOwn2.default)(funnyEmbedSelectors,function(type,selector){var funnyEmbeds=(0,_toArray2.default)(dom.querySelectorAll(selector));(0,_forEach2.default)(funnyEmbeds,function(node){content_embeds.push({type:"special-"+type,content:node.outerHTML})})});if(content_embeds.length){post.content_embeds=content_embeds}return post}module.exports=exports["default"]},2252:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=detectPolls;var _forEach=__webpack_require__(114);var _forEach2=_interopRequireDefault(_forEach);var _i18nCalypso=__webpack_require__(11);var _i18nCalypso2=_interopRequireDefault(_i18nCalypso);var _utils=__webpack_require__(404);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function detectPolls(post,dom){if(!dom){throw new Error("this transform must be used as part of withContentDOM")}var noscripts=dom.querySelectorAll("noscript");(0,_forEach2.default)(noscripts,function(noscript){if(!noscript.firstChild){return}var noscriptDom=(0,_utils.domForHtml)(noscript.innerHTML);var pollLink=noscriptDom.querySelector('a[href^="http://polldaddy.com/poll/"]');if(pollLink){var pollId=pollLink.href.match(/https?:\/\/polldaddy.com\/poll\/([0-9]+)/)[1];if(pollId){var p=document.createElement("p");p.innerHTML='<a target="_blank" rel="external noopener noreferrer" href="https://polldaddy.com/poll/'+pollId+'">'+_i18nCalypso2.default.translate("Take our poll")+"</a>";noscript.parentNode.replaceChild(p,noscript)}}});return post}module.exports=exports["default"]},2253:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _keys=__webpack_require__(39);var _keys2=_interopRequireDefault(_keys);exports.disableAutoPlayOnMedia=disableAutoPlayOnMedia;exports.disableAutoPlayOnEmbeds=disableAutoPlayOnEmbeds;var _forEach=__webpack_require__(114);var _forEach2=_interopRequireDefault(_forEach);var _url=__webpack_require__(70);var _url2=_interopRequireDefault(_url);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function stripAutoPlays(query){var keys=(0,_keys2.default)(query).filter(function(k){return/^auto_?play$/i.test(k)});(0,_forEach2.default)(keys,function(key){var val=query[key].toLowerCase();if(val==="1"){query[key]="0"}else if(val==="true"){query[key]="false"}});return query}function disableAutoPlayOnMedia(post,dom){if(!dom){throw new Error("this transform must be used as part of withContentDOM")}(0,_forEach2.default)(dom.querySelectorAll("audio, video"),function(el){return el.autoplay=false});return post}function disableAutoPlayOnEmbeds(post,dom){if(!dom){throw new Error("this transform must be used as part of withContentDOM")}(0,_forEach2.default)(dom.querySelectorAll("iframe"),function(embed){var srcUrl=_url2.default.parse(embed.src,true,true);if(srcUrl.query){srcUrl.query=stripAutoPlays(srcUrl.query);srcUrl.search=null;embed.src=_url2.default.format(srcUrl)}});return post}},2254:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=makeEmbedsSecure;var _forEach=__webpack_require__(114);var _forEach2=_interopRequireDefault(_forEach);var _startsWith=__webpack_require__(83);var _startsWith2=_interopRequireDefault(_startsWith);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function makeEmbedsSecure(post,dom){if(!dom){throw new Error("this transform must be used as part of withContentDOM")}var iframes=dom.querySelectorAll("iframe");var badFrames=[];(0,_forEach2.default)(iframes,function(iframe){iframe.setAttribute("sandbox","");if(!(0,_startsWith2.default)(iframe.src,"http")){badFrames.push(iframe)}else{iframe.src=iframe.src.replace(/^http:/,"https:")}});(0,_forEach2.default)(badFrames,function(frame){frame.parentNode.removeChild(frame)});if(post.is_external||post.is_jetpack){var embeds=dom.querySelectorAll("embed,object");(0,_forEach2.default)(embeds,function(embed){embed.parentNode.removeChild(embed)})}return post}module.exports=exports["default"]},2255:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=removeContentStyles;var _forEach=__webpack_require__(114);var _forEach2=_interopRequireDefault(_forEach);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function removeContentStyles(post,dom){if(!dom){throw new Error("this transform must be used as part of withContentDOM")}if(dom.querySelector('.gallery, .tiled-gallery, blockquote[class^="instagram-"], blockquote[class^="twitter-"]')){return post}var styled=dom.querySelectorAll("[style]");(0,_forEach2.default)(styled,function(element){element.removeAttribute("style")});(0,_forEach2.default)(dom.querySelectorAll("style"),function(element){element.parentNode&&element.parentNode.removeChild(element)});return post}module.exports=exports["default"]},2256:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(maxWidth){return function safeContentImages(post,dom){var content_images=[],images=void 0;if(!dom){throw new Error("this transform must be used as part of withContentDOM")}images=dom.querySelectorAll("img[src]");(0,_forEach2.default)(images,function(image){var imgSource=image.getAttribute("src"),parsedImgSrc=_url2.default.parse(imgSource,false,true),hostName=parsedImgSrc.hostname;var safeSource=void 0;if(!hostName){imgSource=_url2.default.resolve(post.URL,imgSource);parsedImgSrc=_url2.default.parse(imgSource,false,true)}safeSource=(0,_safeImageUrl2.default)(imgSource);if(!safeSource&&parsedImgSrc.search){parsedImgSrc.search=null;parsedImgSrc.query=null;safeSource=(0,_safeImageUrl2.default)(_url2.default.format(parsedImgSrc))}removeUnsafeAttributes(image);if(!safeSource||imageShouldBeRemovedFromContent(imgSource)){image.parentNode.removeChild(image);image.setAttribute("src",TRANSPARENT_GIF);image.removeAttribute("srcset");return}if(maxWidth){safeSource=(0,_utils.maxWidthPhotonishURL)(safeSource,maxWidth)}image.setAttribute("src",safeSource);if(image.hasAttribute("srcset")){var imgSrcSet=void 0;try{imgSrcSet=_srcset2.default.parse(image.getAttribute("srcset"))}catch(ex){imgSrcSet=[]}imgSrcSet=imgSrcSet.map(function(imgSrc){if(!_url2.default.parse(imgSrc.url,false,true).hostname){imgSrc.url=_url2.default.resolve(post.URL,imgSrc.url)}imgSrc.url=(0,_safeImageUrl2.default)(imgSrc.url);return imgSrc}).filter(function(imgSrc){return imgSrc.url});var newSrcSet=_srcset2.default.stringify(imgSrcSet);if(newSrcSet){image.setAttribute("srcset",newSrcSet)}else{image.removeAttribute("srcset")}}if(isCandidateForContentImage(imgSource)){content_images.push({src:safeSource,original_src:imgSource,width:image.width,height:image.height})}});content_images=(0,_filter2.default)(content_images,function(image){if(!image.src)return false;var edgeLength=image.height+image.width;return edgeLength===0||edgeLength>2});if(content_images.length){post.content_images=content_images}return post}};var _filter=__webpack_require__(77);var _filter2=_interopRequireDefault(_filter);var _forEach=__webpack_require__(114);var _forEach2=_interopRequireDefault(_forEach);var _every=__webpack_require__(218);var _every2=_interopRequireDefault(_every);var _some=__webpack_require__(63);var _some2=_interopRequireDefault(_some);var _startsWith=__webpack_require__(83);var _startsWith2=_interopRequireDefault(_startsWith);var _toArray=__webpack_require__(401);var _toArray2=_interopRequireDefault(_toArray);var _url=__webpack_require__(70);var _url2=_interopRequireDefault(_url);var _srcset=__webpack_require__(3558);var _srcset2=_interopRequireDefault(_srcset);var _safeImageUrl=__webpack_require__(290);var _safeImageUrl2=_interopRequireDefault(_safeImageUrl);var _utils=__webpack_require__(404);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var TRANSPARENT_GIF="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";function removeUnsafeAttributes(node){if(!node||!node.hasAttributes()){return}(0,_forEach2.default)((0,_toArray2.default)(node.attributes),function(attr){if((0,_startsWith2.default)(attr.name,"on")){node.removeAttribute(attr.name)}})}var bannedUrlParts=["feeds.feedburner.com","feeds.wordpress.com/",".feedsportal.com","wp-includes","wp-content/themes","wp-content/plugins","stats.wordpress.com","pixel.wp.com"];function imageShouldBeRemovedFromContent(imageUrl){return(0,_some2.default)(bannedUrlParts,function(part){return imageUrl&&imageUrl.toLowerCase().indexOf(part)!==-1})}var excludedContentImageUrlParts=["gravatar.com","/wpcom-smileys/"];function isCandidateForContentImage(imageUrl){return!imageShouldBeRemovedFromContent(imageUrl)&&(0,_every2.default)(excludedContentImageUrlParts,function(part){return imageUrl&&imageUrl.toLowerCase().indexOf(part)===-1})}module.exports=exports["default"]},2257:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=wordCountAndReadingTime;var _trim=__webpack_require__(219);var _trim2=_interopRequireDefault(_trim);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var READING_WORDS_PER_SECOND=250/60;function wordCountAndReadingTime(post,dom){if(!dom){throw new Error("this transform must be used as part of withContentDOM")}var textContent=(0,_trim2.default)(dom.textContent);post.word_count=(textContent.replace(/['";:,.?\-!]+/g,"").match(/\S+/g)||[]).length;if(post.word_count>0){post.reading_time=Math.ceil(post.word_count/READING_WORDS_PER_SECOND)}return post}module.exports=exports["default"]},2258:function(module,exports,__webpack_require__){"use strict";
Object.defineProperty(exports,"__esModule",{value:true});exports.default=keepValidImages;var _filter=__webpack_require__(77);var _filter2=_interopRequireDefault(_filter);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function imageHasMinWidthAndHeight(width,height){return function(image){return image.naturalWidth>=width&&image.naturalHeight>=height}}function keepValidImages(minWidth,minHeight){return function keepValidImagesForWidthAndHeight(post){var imageFilter=imageHasMinWidthAndHeight(minWidth,minHeight);if(post.images){post.images=(0,_filter2.default)(post.images,imageFilter)}if(post.content_images){post.content_images=(0,_filter2.default)(post.content_images,imageFilter)}return post}}module.exports=exports["default"]},2259:function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=makeSiteIDSafeForAPI;function makeSiteIDSafeForAPI(post){if(post.site_id){post.normalized_site_id=(""+post.site_id).replace(/::/g,"/")}return post}module.exports=exports["default"]},2260:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _find2=__webpack_require__(27);var _find3=_interopRequireDefault(_find2);exports.default=pickCanonicalImage;var _debug=__webpack_require__(3);var _debug2=_interopRequireDefault(_debug);var _utils=__webpack_require__(404);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var debug=(0,_debug2.default)("calypso:post-normalizer:pick-canonical-image");function candidateForCanonicalImage(image){if(!image){return false}if(image.naturalWidth<350){debug(image&&image.src,": not wide enough");return false}if(image.naturalWidth*image.naturalHeight<3e4){debug(image&&image.src,": not enough area");return false}return true}function pickCanonicalImage(post){var canonicalImage=void 0;if(post.canonical_image){post.canonical_image=null}if(post.images){canonicalImage=(0,_find3.default)(post.images,candidateForCanonicalImage);if(canonicalImage){canonicalImage={uri:canonicalImage.src,width:canonicalImage.naturalWidth,height:canonicalImage.naturalHeight}}}else if((0,_utils.thumbIsLikelyImage)(post.post_thumbnail)){canonicalImage={uri:post.post_thumbnail.URL,width:post.post_thumbnail.width,height:post.post_thumbnail.height}}else if(post.featured_image){canonicalImage={uri:post.featured_image,width:0,height:0}}if(canonicalImage){post.canonical_image=canonicalImage}return post}module.exports=exports["default"]},2261:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=pickPrimaryTag;var _maxBy=__webpack_require__(2021);var _maxBy2=_interopRequireDefault(_maxBy);var _values=__webpack_require__(210);var _values2=_interopRequireDefault(_values);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function pickPrimaryTag(post){var primary_tag=(0,_maxBy2.default)((0,_values2.default)(post.tags),function(tag){return tag.post_count});if(primary_tag!==undefined){post.primary_tag=primary_tag}return post}module.exports=exports["default"]},2262:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=preventWidows;var _forEach=__webpack_require__(114);var _forEach2=_interopRequireDefault(_forEach);var _formatting=__webpack_require__(81);var _formatting2=_interopRequireDefault(_formatting);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function preventWidows(post){(0,_forEach2.default)(["excerpt"],function(prop){if(post[prop]){post[prop]=_formatting2.default.preventWidows(post[prop],2)}});return post}module.exports=exports["default"]},2263:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=safeImagePropertiesForWidth;var _forOwn=__webpack_require__(287);var _forOwn2=_interopRequireDefault(_forOwn);var _startsWith=__webpack_require__(83);var _startsWith2=_interopRequireDefault(_startsWith);var _utils=__webpack_require__(404);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function safeImagePropertiesForWidth(maxWidth){return function safeImageProperties(post){(0,_utils.makeImageURLSafe)(post.author,"avatar_URL",maxWidth);(0,_utils.makeImageURLSafe)(post,"featured_image",maxWidth,post.URL);if(post.post_thumbnail){(0,_utils.makeImageURLSafe)(post.post_thumbnail,"URL",maxWidth,post.URL)}if(post.featured_media&&post.featured_media.type==="image"){(0,_utils.makeImageURLSafe)(post.featured_media,"uri",maxWidth,post.URL)}if(post.canonical_image&&post.canonical_image.type==="image"){(0,_utils.makeImageURLSafe)(post.canonical_image,"uri",maxWidth,post.URL)}if(post.attachments){(0,_forOwn2.default)(post.attachments,function(attachment){if((0,_startsWith2.default)(attachment.mime_type,"image/")){(0,_utils.makeImageURLSafe)(attachment,"URL",maxWidth,post.URL)}})}return post}}module.exports=exports["default"]},2264:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _promise=__webpack_require__(49);var _promise2=_interopRequireDefault(_promise);var _uniq2=__webpack_require__(223);var _uniq3=_interopRequireDefault(_uniq2);var _pull2=__webpack_require__(3516);var _pull3=_interopRequireDefault(_pull2);var _pick2=__webpack_require__(91);var _pick3=_interopRequireDefault(_pick2);var _map2=__webpack_require__(45);var _map3=_interopRequireDefault(_map2);var _forEach2=__webpack_require__(114);var _forEach3=_interopRequireDefault(_forEach2);var _flow2=__webpack_require__(232);var _flow3=_interopRequireDefault(_flow2);var _find2=__webpack_require__(27);var _find3=_interopRequireDefault(_find2);var _filter2=__webpack_require__(77);var _filter3=_interopRequireDefault(_filter2);exports.default=waitForImagesToLoad;var _utils=__webpack_require__(404);var _debug=__webpack_require__(3);var _debug2=_interopRequireDefault(_debug);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var debug=(0,_debug2.default)("calypso:post-normalizer:wait-for-images-to-load");function convertImageToObject(image){return(0,_pick3.default)(image,["src","naturalWidth","naturalHeight"])}function imageForURL(imageUrl){var img=new Image;img.src=imageUrl;return img}function promiseForImage(image){if(image.complete&&image.naturalWidth>0){return _promise2.default.resolve(image)}return new _promise2.default(function(resolve,reject){image.onload=function(){return resolve(image)};image.onerror=function(){return reject(image)}})}var promiseForURL=(0,_flow3.default)(imageForURL,promiseForImage);function waitForImagesToLoad(post){return new _promise2.default(function(resolve){function acceptLoadedImages(images){if(post.featured_image){if(!(0,_find3.default)(images,{src:post.featured_image})){post.featured_image=null}}post.images=(0,_map3.default)(images,convertImageToObject);post.content_images=(0,_filter3.default)((0,_map3.default)(post.content_images,function(image){return(0,_find3.default)(post.images,{src:image.src})}),Boolean);resolve(post)}var imagesToCheck=[];if((0,_utils.thumbIsLikelyImage)(post.post_thumbnail)){imagesToCheck.push(post.post_thumbnail.URL)}else if(post.featured_image){imagesToCheck.push(post.featured_image)}(0,_forEach3.default)(post.content_images,function(image){imagesToCheck.push(image.src)});if(imagesToCheck.length===0){resolve(post);return}imagesToCheck=(0,_uniq3.default)(imagesToCheck);var promises=(0,_map3.default)(imagesToCheck,promiseForURL);var imagesLoaded={};(0,_forEach3.default)(promises,function(promise){promise.then(function(image){imagesLoaded[image.src]=image}).catch(function(err){debug("failed to load image",err,post);return null}).then(function(){promises=(0,_pull3.default)(promises,promise);if(promises.length===0){var imagesInOrder=(0,_filter3.default)((0,_map3.default)(imagesToCheck,function(src){return imagesLoaded[src]}),Boolean);acceptLoadedImages(imagesInOrder)}}).catch(function(err){debug("Fulfilling promise failed",err)})})})}module.exports=exports["default"]},2265:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=createDomTransformRunner;var _reduce=__webpack_require__(117);var _reduce2=_interopRequireDefault(_reduce);var _utils=__webpack_require__(404);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function createDomTransformRunner(transforms){return function withContentDOM(post){if(!post||!post.content||!transforms){return post}var dom=(0,_utils.domForHtml)(post.content);post=(0,_reduce2.default)(transforms,function(memo,transform){return transform(memo,dom)},post);post.content=dom.innerHTML;dom.innerHTML="";return post}}module.exports=exports["default"]},2266:function(module,exports,__webpack_require__){"use strict";var Dispatcher=__webpack_require__(42),reject=__webpack_require__(209),findLast=__webpack_require__(1867),get=__webpack_require__(24),last=__webpack_require__(215),Immutable=__webpack_require__(113),forEach=__webpack_require__(114);var Emitter=__webpack_require__(36),ActionTypes=__webpack_require__(1980).action,ErrorTypes=__webpack_require__(1980).error,States=__webpack_require__(1980).state,FeedSubscriptionActionTypes=__webpack_require__(1767).action;var subscriptions={},errors=[],subscriptionTemplate=Immutable.Map({state:States.SUBSCRIBED});var CommentEmailSubscriptionStore={receiveSubscribe:function receiveSubscribe(action){var subscription={blog_id:action.blog_id};if(addSubscription(subscription)){CommentEmailSubscriptionStore.emit("change")}},receiveUnsubscribe:function receiveUnsubscribe(action){if(removeSubscription(action.blog_id)){CommentEmailSubscriptionStore.emit("change")}},receiveSubscribeResponse:function receiveSubscribeResponse(action){var updatedSubscriptionInfo=void 0;if(!action.error&&action.data&&action.data.subscribed){CommentEmailSubscriptionStore.removeErrorsForBlog(action.blog_id);if(action.data.subscription){updatedSubscriptionInfo=action.data.subscription;updatedSubscriptionInfo.state=States.SUBSCRIBED;updateSubscription(action.data.subscription.blog_id,updatedSubscriptionInfo);CommentEmailSubscriptionStore.emit("add",updatedSubscriptionInfo)}CommentEmailSubscriptionStore.emit("change");return}errors.push({blogId:action.blog_id,errorType:ErrorTypes.UNABLE_TO_SUBSCRIBE,timestamp:Date.now()});if(removeSubscription(action.blog_id)){CommentEmailSubscriptionStore.emit("change")}},receiveUnsubscribeResponse:function receiveUnsubscribeResponse(action){if(!action.error&&action.data&&!action.data.subscribed){CommentEmailSubscriptionStore.removeErrorsForBlog(action.blog_id);CommentEmailSubscriptionStore.emit("change");return}errors.push({blogId:action.blog_id,errorType:ErrorTypes.UNABLE_TO_UNSUBSCRIBE,timestamp:Date.now()});if(addSubscription({blog_id:action.blog_id})){CommentEmailSubscriptionStore.emit("change")}},getSubscription:function getSubscription(blogId){var sub=subscriptions[blogId];if(sub&&sub.get("state")===States.SUBSCRIBED){return sub}return undefined},getIsSubscribed:function getIsSubscribed(blogId){return!!CommentEmailSubscriptionStore.getSubscription(blogId)},getLastError:function getLastError(){return last(errors)},getLastErrorByBlog:function getLastErrorByBlog(blogId){return findLast(errors,{blogId:blogId})},removeErrorsForBlog:function removeErrorsForBlog(blogId){var newErrors=reject(errors,{blogId:blogId});if(newErrors.length===errors.length){return false}errors=newErrors;return true},dismissError:function dismissError(error){this.removeErrorsForSiteUrl(error.data.URL);CommentEmailSubscriptionStore.emit("change")},clearErrors:function clearErrors(){errors=[]},clearSubscriptions:function clearSubscriptions(){subscriptions={}},receiveFeedSubscriptions:function receiveFeedSubscriptions(action){var addedSubscriptionCount=0,emailSubscription=void 0;if(!action.data||action.data&&(action.data.errors||!action.data.subscriptions)){return}forEach(action.data.subscriptions,function(subscription){emailSubscription=get(subscription,"delivery_methods.email");if(emailSubscription&&emailSubscription.send_comments){addSubscription({blog_id:subscription.blog_ID});addedSubscriptionCount++}});if(addedSubscriptionCount>0){CommentEmailSubscriptionStore.emit("change")}},receiveFeedUnfollow:function receiveFeedUnfollow(action){if(action.blogId){removeSubscription(action.blogId);CommentEmailSubscriptionStore.emit("change")}}};function addSubscription(subscription){if(!subscription||!subscription.blog_id){return}var existingSubscription=subscriptions[subscription.blog_id];if(existingSubscription){return updateSubscription(subscription.blog_id,subscriptionTemplate)}var newSubscription=subscriptionTemplate.merge(subscription);subscriptions[subscription.blog_id]=newSubscription;return true}function updateSubscription(blogId,newSubscriptionInfo){if(!blogId||!newSubscriptionInfo){return}var existingSubscription=subscriptions[blogId];if(!existingSubscription){return false}var updatedSubscription=existingSubscription.merge(newSubscriptionInfo);if(updatedSubscription===existingSubscription){return false}subscriptions[blogId]=updatedSubscription;return true}function removeSubscription(blogId){if(!blogId){return}if(!CommentEmailSubscriptionStore.getSubscription(blogId)){return false}subscriptions[blogId]=null;return true}Emitter(CommentEmailSubscriptionStore);CommentEmailSubscriptionStore.setMaxListeners(200);CommentEmailSubscriptionStore.dispatchToken=Dispatcher.register(function(payload){var action=payload.action;if(!action){return}switch(action.type){case ActionTypes.SUBSCRIBE_TO_COMMENT_EMAILS:CommentEmailSubscriptionStore.receiveSubscribe(action);break;case ActionTypes.UNSUBSCRIBE_FROM_COMMENT_EMAILS:CommentEmailSubscriptionStore.receiveUnsubscribe(action);break;case ActionTypes.RECEIVE_SUBSCRIBE_TO_COMMENT_EMAILS:CommentEmailSubscriptionStore.receiveSubscribeResponse(action);break;case ActionTypes.RECEIVE_UNSUBSCRIBE_FROM_COMMENT_EMAILS:CommentEmailSubscriptionStore.receiveUnsubscribeResponse(action);break;case FeedSubscriptionActionTypes.RECEIVE_FEED_SUBSCRIPTIONS:CommentEmailSubscriptionStore.receiveFeedSubscriptions(action);break;case FeedSubscriptionActionTypes.RECEIVE_UNFOLLOW_READER_FEED:CommentEmailSubscriptionStore.receiveFeedUnfollow(action);break}});module.exports=CommentEmailSubscriptionStore},2267:function(module,exports,__webpack_require__){"use strict";var untrailingslashit=__webpack_require__(293);module.exports={prepareSiteUrl:function prepareSiteUrl(url){var preparedUrl=url&&untrailingslashit(url.replace("https://","http://"));return preparedUrl}}},2270:function(module,exports){"use strict";module.exports.action={UPDATE_READER_LIST:"UPDATE_READER_LIST",RECEIVE_UPDATE_READER_LIST:"RECEIVE_UPDATE_READER_LIST",DISMISS_READER_LIST_NOTICE:"DISMISS_READER_LIST_NOTICE",RECEIVE_READER_LIST:"RECEIVE_READER_LIST",RECEIVE_READER_LISTS:"RECEIVE_READER_LISTS",FOLLOW_LIST:"FOLLOW_LIST",RECEIVE_FOLLOW_LIST:"RECEIVE_FOLLOW_LIST",RECEIVE_FOLLOW_LIST_ERROR:"RECEIVE_FOLLOW_LIST_ERROR",UNFOLLOW_LIST:"UNFOLLOW_LIST",RECEIVE_UNFOLLOW_LIST:"RECEIVE_UNFOLLOW_LIST",RECEIVE_UNFOLLOW_LIST_ERROR:"RECEIVE_UNFOLLOW_LIST_ERROR",CREATE_READER_LIST:"CREATE_READER_LIST",RECEIVE_CREATE_READER_LIST:"RECEIVE_CREATE_READER_LIST"}},2271:function(module,exports,__webpack_require__){"use strict";var Dispatcher=__webpack_require__(42),find=__webpack_require__(27),reject=__webpack_require__(209),isEqual=__webpack_require__(98);var emitter=__webpack_require__(36),ListStore=__webpack_require__(1905);var lists=null,errors=[],ReaderListStore,_isFetching=false;function mapApiToId(list){return{owner:list.owner,slug:list.slug}}function sortList(){lists.sort(function(a,b){var aTitle=ListStore.get(a.owner,a.slug).title,bTitle=ListStore.get(b.owner,b.slug).title;return aTitle.localeCompare(bTitle)})}ReaderListStore={get:function get(){return lists&&lists.map(function(list){return ListStore.get(list.owner,list.slug)})},findByOwnerAndSlug:function findByOwnerAndSlug(owner,slug){return find(lists,{owner:owner,slug:slug})},isSubscribed:function isSubscribed(owner,slug){return!!this.findByOwnerAndSlug(owner,slug)},receiveLists:function receiveLists(newLists){newLists=newLists.map(mapApiToId);if(!isEqual(newLists,lists)){lists=newLists;ReaderListStore.emit("change")}},followList:function followList(newList){newList=mapApiToId(newList);if(find(lists,newList)){return newList}lists.push(newList);sortList();ReaderListStore.emit("change");return newList},unfollowList:function unfollowList(data){var key=mapApiToId(data),newList=reject(lists,key);if(newList.length!==lists.length){lists=newList;sortList();ReaderListStore.emit("change")}},receiveCreateReaderList:function receiveCreateReaderList(newList){newList=ReaderListStore.followList(newList);ReaderListStore.emit("create",newList)},isFetching:function isFetching(){return _isFetching},setIsFetching:function setIsFetching(val){_isFetching=val;ReaderListStore.emitChange()}};emitter(ReaderListStore);ReaderListStore.dispatchToken=Dispatcher.register(function(payload){var action=payload.action;if(!action){return}Dispatcher.waitFor([ListStore.dispatchToken]);if(action.error){errors.push(action.error);return}switch(action.type){case"RECEIVE_READER_LISTS":ReaderListStore.receiveLists(action.data.lists);break;case"FOLLOW_LIST":case"RECEIVE_FOLLOW_LIST":ReaderListStore.followList(action.data);break;case"RECEIVE_FOLLOW_LIST_ERROR":ReaderListStore.unfollowList(action.data);break;case"UNFOLLOW_LIST":case"RECEIVE_UNFOLLOW_LIST":ReaderListStore.unfollowList(action.data);break;case"RECEIVE_UNFOLLOW_LIST_ERROR":ReaderListStore.followList(action.data);break;case"RECEIVE_CREATE_READER_LIST":ReaderListStore.receiveCreateReaderList(action.data);break}});module.exports=ReaderListStore},2272:function(module,exports,__webpack_require__){"use strict";var Dispatcher=__webpack_require__(42),reject=__webpack_require__(209),findLast=__webpack_require__(1867),get=__webpack_require__(24),last=__webpack_require__(215),Immutable=__webpack_require__(113),forEach=__webpack_require__(114);var Emitter=__webpack_require__(36),ActionTypes=__webpack_require__(1981).action,ErrorTypes=__webpack_require__(1981).error,States=__webpack_require__(1981).state,FeedSubscriptionActionTypes=__webpack_require__(1767).action;var subscriptions={},errors=[],subscriptionTemplate=Immutable.Map({state:States.SUBSCRIBED});var PostEmailSubscriptionStore={receiveSubscribe:function receiveSubscribe(action){var deliveryFrequency="instantly";if(action.delivery_frequency){deliveryFrequency=action.delivery_frequency}var subscription={blog_id:action.blog_id,delivery_frequency:deliveryFrequency};if(addSubscription(subscription)){PostEmailSubscriptionStore.emit("change")}},receiveUnsubscribe:function receiveUnsubscribe(action){if(removeSubscription(action.blog_id)){PostEmailSubscriptionStore.emit("change")}},receiveSubscribeResponse:function receiveSubscribeResponse(action){var updatedSubscriptionInfo=void 0;if(!action.error&&action.data&&action.data.subscribed){PostEmailSubscriptionStore.removeErrorsForBlog(action.blog_id);if(action.data.subscription){updatedSubscriptionInfo=action.data.subscription;updatedSubscriptionInfo.state=States.SUBSCRIBED;updateSubscription(action.data.subscription.blog_id,updatedSubscriptionInfo);PostEmailSubscriptionStore.emit("add",updatedSubscriptionInfo)}PostEmailSubscriptionStore.emit("change");return}errors.push({blogId:action.blog_id,errorType:ErrorTypes.UNABLE_TO_SUBSCRIBE,timestamp:Date.now()});if(removeSubscription(action.blog_id)){PostEmailSubscriptionStore.emit("change")}},receiveUnsubscribeResponse:function receiveUnsubscribeResponse(action){if(!action.error&&action.data&&!action.data.subscribed){PostEmailSubscriptionStore.removeErrorsForBlog(action.blog_id);PostEmailSubscriptionStore.emit("change");return}errors.push({blogId:action.blog_id,errorType:ErrorTypes.UNABLE_TO_UNSUBSCRIBE,timestamp:Date.now()});if(addSubscription({blog_id:action.blog_id})){PostEmailSubscriptionStore.emit("change")}},receiveUpdateDeliveryFrequency:function receiveUpdateDeliveryFrequency(action){var subscription={blog_id:action.blog_id,delivery_frequency:action.delivery_frequency};if(!PostEmailSubscriptionStore.getSubscription(action.blog_id)){addSubscription(subscription)}else{updateSubscription(action.blog_id,subscription)}},receiveUpdateDeliveryFrequencyResponse:function receiveUpdateDeliveryFrequencyResponse(action){if(!action.error&&action.data.success&&action.data.subscribed){PostEmailSubscriptionStore.removeErrorsForBlog(action.blog_id);PostEmailSubscriptionStore.emit("change");return}errors.push({blogId:action.blog_id,errorType:ErrorTypes.UNABLE_TO_UPDATE_DELIVERY_FREQUENCY,timestamp:Date.now()});var originalDeliveryFrequency=get(action,"data.subscription.delivery_frequency");if(originalDeliveryFrequency){if(updateSubscription(action.blog_id,{delivery_frequency:originalDeliveryFrequency})){PostEmailSubscriptionStore.emit("change")}}},getSubscription:function getSubscription(blogId){var subscription=subscriptions[blogId];if(subscription&&subscription.get("state")===States.SUBSCRIBED){return subscription}return undefined},getIsSubscribed:function getIsSubscribed(blogId){return!!PostEmailSubscriptionStore.getSubscription(blogId)},getLastError:function getLastError(){return last(errors)},getLastErrorByBlog:function getLastErrorByBlog(blogId){return findLast(errors,{blogId:blogId})},removeErrorsForBlog:function removeErrorsForBlog(blogId){var newErrors=reject(errors,{blogId:blogId});if(newErrors.length===errors.length){return false}errors=newErrors;return true},dismissError:function dismissError(error){this.removeErrorsForSiteUrl(error.data.URL);PostEmailSubscriptionStore.emit("change")},clearErrors:function clearErrors(){errors=[]},clearSubscriptions:function clearSubscriptions(){subscriptions={}},receiveFeedSubscriptions:function receiveFeedSubscriptions(action){var addedSubscriptionCount=0,postEmailSubscription=void 0;if(!action.data||action.data&&(action.data.errors||!action.data.subscriptions)){return}forEach(action.data.subscriptions,function(subscription){postEmailSubscription=get(subscription,"delivery_methods.email");if(postEmailSubscription&&postEmailSubscription.send_posts){addSubscription({blog_id:subscription.blog_ID,delivery_frequency:postEmailSubscription.post_delivery_frequency});addedSubscriptionCount++}});if(addedSubscriptionCount>0){PostEmailSubscriptionStore.emit("change")}},receiveFeedUnfollow:function receiveFeedUnfollow(action){if(action.blogId){removeSubscription(action.blogId);PostEmailSubscriptionStore.emit("change")}}};function addSubscription(subscription){if(!subscription||!subscription.blog_id){return}var existingSubscription=subscriptions[subscription.blog_id];if(existingSubscription){return updateSubscription(subscription.blog_id,subscriptionTemplate)}var newSubscription=subscriptionTemplate.merge(subscription);subscriptions[subscription.blog_id]=newSubscription;return true}function updateSubscription(blogId,newSubscriptionInfo){if(!blogId||!newSubscriptionInfo){return}var existingSubscription=subscriptions[blogId];if(!existingSubscription){return}var updatedSubscription=existingSubscription.merge(newSubscriptionInfo);if(updatedSubscription===existingSubscription){return false}subscriptions[blogId]=updatedSubscription;return true}function removeSubscription(blogId){if(!blogId){return}if(!PostEmailSubscriptionStore.getSubscription(blogId)){return true}var newSubscriptionInfo={state:States.UNSUBSCRIBED};updateSubscription(blogId,newSubscriptionInfo);return true}Emitter(PostEmailSubscriptionStore);PostEmailSubscriptionStore.setMaxListeners(200);PostEmailSubscriptionStore.dispatchToken=Dispatcher.register(function(payload){var action=payload.action;if(!action){return}switch(action.type){case ActionTypes.SUBSCRIBE_TO_POST_EMAILS:PostEmailSubscriptionStore.receiveSubscribe(action);break;case ActionTypes.UNSUBSCRIBE_FROM_POST_EMAILS:PostEmailSubscriptionStore.receiveUnsubscribe(action);break;case ActionTypes.RECEIVE_SUBSCRIBE_TO_POST_EMAILS:PostEmailSubscriptionStore.receiveSubscribeResponse(action);break;case ActionTypes.RECEIVE_UNSUBSCRIBE_FROM_POST_EMAILS:PostEmailSubscriptionStore.receiveUnsubscribeResponse(action);break;case ActionTypes.UPDATE_POST_EMAIL_DELIVERY_FREQUENCY:PostEmailSubscriptionStore.receiveUpdateDeliveryFrequency(action);break;case ActionTypes.RECEIVE_UPDATE_POST_EMAIL_DELIVERY_FREQUENCY:PostEmailSubscriptionStore.receiveUpdateDeliveryFrequencyResponse(action);break;case FeedSubscriptionActionTypes.RECEIVE_FEED_SUBSCRIPTIONS:PostEmailSubscriptionStore.receiveFeedSubscriptions(action);break;case FeedSubscriptionActionTypes.RECEIVE_UNFOLLOW_READER_FEED:PostEmailSubscriptionStore.receiveFeedUnfollow(action);break}});module.exports=PostEmailSubscriptionStore},2273:function(module,exports,__webpack_require__){"use strict";var Dispatcher=__webpack_require__(42),reject=__webpack_require__(209),find=__webpack_require__(27),findLast=__webpack_require__(1867);var emitter=__webpack_require__(36),ActionTypes=__webpack_require__(1906).action,ErrorTypes=__webpack_require__(1906).error;var blockedSites=[],errors=[];var SiteBlockStore={getIsBlocked:function getIsBlocked(siteId){var isBlocked=false;if(find(blockedSites,{siteId:siteId})){isBlocked=true}return isBlocked},receiveBlock:function receiveBlock(action){SiteBlockStore.addBlockedSite(action.data.siteId)},receiveUnblock:function receiveUnblock(action){SiteBlockStore.removeBlockedSite(action.data.siteId)},receiveBlockResponse:function receiveBlockResponse(action){if(!action.error&&action.data&&action.data.success){SiteBlockStore.removeErrorsForSite(action.siteId);return}errors.push({siteId:action.siteId,errorType:ErrorTypes.UNABLE_TO_BLOCK,timestamp:Date.now()});SiteBlockStore.removeBlockedSite(action.siteId)},receiveUnblockResponse:function receiveUnblockResponse(action){if(!action.error&&action.data&&action.data.success){SiteBlockStore.removeErrorsForSite(action.siteId);return}errors.push({siteId:action.siteId,errorType:ErrorTypes.UNABLE_TO_UNBLOCK,timestamp:Date.now()});SiteBlockStore.addBlockedSite(action.siteId)},addBlockedSite:function addBlockedSite(siteId){blockedSites.push({siteId:siteId});SiteBlockStore.emit("change");SiteBlockStore.emit("block",siteId);return true},removeBlockedSite:function removeBlockedSite(siteId){var newBlockedSites=reject(blockedSites,{siteId:siteId});if(newBlockedSites.length===blockedSites.length){return false}blockedSites=newBlockedSites;SiteBlockStore.emit("change");return true},removeErrorsForSite:function removeErrorsForSite(siteId){var newErrors=reject(errors,{siteId:siteId});if(newErrors.length===errors.length){return false}errors=newErrors;return true},getLastErrorBySite:function getLastErrorBySite(siteId){var lastError=findLast(errors,{siteId:siteId});if(!lastError){return null}return lastError},dismissError:function dismissError(error){this.removeErrorsForSite(error.data.siteId);SiteBlockStore.emit("change")}};emitter(SiteBlockStore);SiteBlockStore.setMaxListeners(100);SiteBlockStore.dispatchToken=Dispatcher.register(function(payload){var action=payload.action;if(!action){return}switch(action.type){case ActionTypes.BLOCK_SITE:SiteBlockStore.receiveBlock(action);break;case ActionTypes.UNBLOCK_SITE:SiteBlockStore.receiveUnblock(action);break;case ActionTypes.RECEIVE_BLOCK_SITE:SiteBlockStore.receiveBlockResponse(action);break;case ActionTypes.RECEIVE_UNBLOCK_SITE:SiteBlockStore.receiveUnblockResponse(action);break;case ActionTypes.DISMISS_BLOCK_ERROR:SiteBlockStore.dismissError(action);break}});module.exports=SiteBlockStore},2274:function(module,exports,__webpack_require__){"use strict";var trim=__webpack_require__(219);var has=__webpack_require__(175);var Dispatcher=__webpack_require__(42),wpcom=__webpack_require__(28);var tagsLoading={},subscriptionsLoading=false;var ReaderTagActions={fetchSubscriptions:function fetchSubscriptions(){if(subscriptionsLoading){return}subscriptionsLoading=true;wpcom.undocumented().readTags(function(error,data){subscriptionsLoading=false;Dispatcher.handleServerAction({type:"RECEIVE_READER_TAG_SUBSCRIPTIONS",data:data,error:error})})},fetchTag:function fetchTag(slug){if(tagsLoading[slug]){return}tagsLoading[slug]=true;wpcom.undocumented().readTag({slug:slug},function(error,data){delete tagsLoading[slug];if(!error&&data&&has(data,"tag.error_data")){error=data.tag.error_data}Dispatcher.handleServerAction({type:"RECEIVE_READER_TAG",data:data,error:error})})},slugify:function slugify(tag){return encodeURIComponent(trim(tag).toLowerCase().replace(/\s+/g,"-").replace(/-{2,}/g,"-"))},follow:function follow(newTag){var newTagTitle,newTagSlug;if(newTag&&newTag.slug){newTagTitle=newTag.title;newTagSlug=newTag.slug}else{newTagTitle=newTag;newTagSlug=ReaderTagActions.slugify(newTag)}if(!newTagSlug){return}Dispatcher.handleViewAction({type:"FOLLOW_READER_TAG",data:{title:newTagTitle,slug:newTagSlug}});wpcom.undocumented().followReaderTag(newTagSlug,function(error,data){Dispatcher.handleServerAction({type:"RECEIVE_FOLLOW_READER_TAG",data:data,error:error,newSlug:newTagSlug})})},unfollow:function unfollow(tag){Dispatcher.handleViewAction({type:"UNFOLLOW_READER_TAG",data:{slug:tag.slug}});wpcom.undocumented().unfollowReaderTag(tag.slug,function(error,data){Dispatcher.handleServerAction({type:"RECEIVE_UNFOLLOW_READER_TAG",data:data,error:error})})}};module.exports=ReaderTagActions},2275:function(module,exports,__webpack_require__){"use strict";var _forOwn=__webpack_require__(287);var _forOwn2=_interopRequireDefault(_forOwn);var _formatting=__webpack_require__(81);var _dispatcher=__webpack_require__(42);var _dispatcher2=_interopRequireDefault(_dispatcher);var _emitter=__webpack_require__(36);var _emitter2=_interopRequireDefault(_emitter);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var tags={};var TagStore={get:function get(slug){return tags[slug]}};(0,_emitter2.default)(TagStore);function receiveTags(newTags){(0,_forOwn2.default)(newTags,function(sub){sub.URL="/tag/"+sub.slug;sub.title=(0,_formatting.decodeEntities)(sub.title);sub.slug=sub.slug.toLowerCase();tags[sub.slug]=sub});TagStore.emit("change")}function markPending(slug){var tag=tags[slug];if(!tag){tag={slug:slug,title:slug,ID:null,_state:"pending"};tags[slug]=tag;TagStore.emit("change")}}TagStore.dispatchToken=_dispatcher2.default.register(function(payload){var action=payload.action;if(!action||action.error){return}switch(action.type){case"FOLLOW_READER_TAG":markPending(action.slug);break;case"RECEIVE_READER_TAG":if(action.data&&action.data.tag){receiveTags([action.data.tag])}break;case"RECEIVE_READER_TAG_SUBSCRIPTIONS":case"RECEIVE_UNFOLLOW_READER_TAG":case"RECEIVE_FOLLOW_READER_TAG":if(action.data&&action.data.tags){receiveTags(action.data.tags)}break}});module.exports=TagStore},2347:function(module,exports,__webpack_require__){"use strict";var DiscoverHelper=__webpack_require__(1674);module.exports={shouldShowComments:function shouldShowComments(post){var showComments=false,isDiscoverPost=DiscoverHelper.isDiscoverPost(post);if(isDiscoverPost){if(DiscoverHelper.isInternalDiscoverPost(post)&&!DiscoverHelper.isDiscoverSitePick(post)){showComments=true}}else if(!post.is_jetpack&&post.discussion&&(post.discussion.comments_open||post.discussion.comment_count>0)){showComments=true}return showComments}}},2348:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.recordAuthorClick=recordAuthorClick;exports.recordSiteClick=recordSiteClick;exports.recordFollowToggle=recordFollowToggle;var _stats=__webpack_require__(1643);function recordAuthorClick(author){(0,_stats.recordGaEvent)("Clicked Discover Card Attribution Author");(0,_stats.recordAction)("discover_card_author_clicked");(0,_stats.recordTrack)("calypso_reader_author_on_discover_card_clicked",{
author_url:author})}function recordSiteClick(siteUrl){(0,_stats.recordGaEvent)("Clicked Discover Card Site Link");(0,_stats.recordAction)("discover_card_site_clicked");(0,_stats.recordTrack)("calypso_reader_site_on_discover_card_clicked",{site_url:siteUrl})}function recordFollowToggle(isFollowing,siteUrl){(0,_stats.recordAction)("discover_card_following_clicked");if(isFollowing){(0,_stats.recordGaEvent)("Clicked Follow Discover Site");(0,_stats.recordAction)("discover_card_site_followed");(0,_stats.recordTrack)("calypso_reader_discover_site_followed",{site_url:siteUrl})}else{(0,_stats.recordGaEvent)("Clicked Unfollow Discover Site");(0,_stats.recordAction)("discover_card_site_unfollowed");(0,_stats.recordTrack)("calypso_reader_discover_site_unfollowed",{site_url:siteUrl})}}},2349:function(module,exports,__webpack_require__){"use strict";var classnames=__webpack_require__(10),React=__webpack_require__(1),url=__webpack_require__(70);var Card=__webpack_require__(89),ReaderFollowButton=__webpack_require__(1723),resizeImageUrl=__webpack_require__(1769),safeImageUrl=__webpack_require__(290),Site=__webpack_require__(279),feedState=__webpack_require__(1749).state;var FeedHeader=React.createClass({displayName:"FeedHeader",getInitialState:function getInitialState(){return{siteish:this.buildSiteish(this.props.site,this.props.feed)}},componentWillReceiveProps:function componentWillReceiveProps(nextProps){if(nextProps.site!==this.props.site||nextProps.feed!==this.props.feed){this.setState({siteish:this.buildSiteish(nextProps.site,nextProps.feed)})}},buildSiteish:function buildSiteish(site,feed){var siteish=site&&site.toJS();if(!siteish&&feed){siteish={title:feed.name||feed.URL&&url.parse(feed.URL).hostname||feed.feed_URL&&url.parse(feed.feed_URL).hostname,domain:feed.URL&&url.parse(feed.URL).hostname||feed.feed_URL&&url.parse(feed.feed_URL).hostname,URL:feed.feed_URL||feed.URL}}return siteish},getFollowerCount:function getFollowerCount(feed,site){if(site&&site.get("subscribers_count")){return site.get("subscribers_count")}if(feed&&feed.subscribers_count>0){return feed.subscribers_count}return null},render:function render(){var site=this.props.site,feed=this.props.feed,headerImage=site&&site.getIn(["options","header_image"]),headerColor=site&&site.getIn(["options","background_color"]),followerCount=this.getFollowerCount(feed,site),headerImageUrl,classes;if(headerImage&&headerImage.get("width")>300){headerImageUrl=resizeImageUrl(safeImageUrl(headerImage.get("url")),{w:600})}classes=classnames({"feed-header":true,"is-placeholder":!this.state.siteish});return React.createElement("div",{className:classes},React.createElement(Card,{className:"feed-header__site"},React.createElement("div",{className:"feed-header__image",style:headerColor?{backgroundColor:"#"+headerColor}:null},headerImageUrl?React.createElement("img",{src:headerImageUrl}):null),this.state.siteish?React.createElement(Site,{site:this.state.siteish,href:this.state.siteish.URL,indicator:false}):null,this.props.feed&&this.props.feed.state===feedState.COMPLETE?React.createElement("div",{className:"feed-header__follow"},React.createElement(ReaderFollowButton,{siteUrl:this.props.feed.feed_URL,iconSize:24})):null),React.createElement("div",{className:"feed-header__details"},React.createElement("p",{className:"feed-header__description"},site&&site.get("description")),followerCount?React.createElement("small",{className:"feed-header__follow-count"}," ",this.translate("%s follower","%s followers",{count:followerCount,args:[this.numberFormat(followerCount)]})):null))}});module.exports=FeedHeader},2351:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _externalLink=__webpack_require__(394);var _externalLink2=_interopRequireDefault(_externalLink);var _gravatar=__webpack_require__(710);var _gravatar2=_interopRequireDefault(_gravatar);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _postTime=__webpack_require__(1790);var _postTime2=_interopRequireDefault(_postTime);var _utils=__webpack_require__(2005);var _stats=__webpack_require__(1643);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var PostByline=function(_React$Component){(0,_inherits3.default)(PostByline,_React$Component);function PostByline(){(0,_classCallCheck3.default)(this,PostByline);var _this=(0,_possibleConstructorReturn3.default)(this,(PostByline.__proto__||(0,_getPrototypeOf2.default)(PostByline)).call(this));_this.recordTagClick=_this.recordTagClick.bind(_this);_this.recordAuthorClick=_this.recordAuthorClick.bind(_this);return _this}(0,_createClass3.default)(PostByline,[{key:"recordTagClick",value:function recordTagClick(){(0,_stats.recordAction)("click_tag");(0,_stats.recordGaEvent)("Clicked Tag Link");(0,_stats.recordTrackForPost)("calypso_reader_tag_clicked",this.props.post,{tag:this.props.post.primary_tag.slug})}},{key:"recordDateClick",value:function recordDateClick(){(0,_stats.recordPermalinkClick)("timestamp");(0,_stats.recordGaEvent)("Clicked Post Permalink","timestamp")}},{key:"recordAuthorClick",value:function recordAuthorClick(){(0,_stats.recordAction)("click_author");(0,_stats.recordGaEvent)("Clicked Author Link");(0,_stats.recordTrackForPost)("calypso_reader_author_link_clicked",this.props.post)}},{key:"renderAuthorName",value:function renderAuthorName(){var post=this.props.post,gravatar=_react2.default.createElement(_gravatar2.default,{user:post.author,size:24}),authorName=_react2.default.createElement("span",{className:"byline__author-name"},post.author.name);if(!post.author.URL){return _react2.default.createElement("span",null,gravatar,authorName)}return _react2.default.createElement(_externalLink2.default,{href:post.author.URL,target:"_blank",onClick:this.recordAuthorClick},gravatar,authorName)}},{key:"render",value:function render(){var _props=this.props;var post=_props.post;var site=_props.site;var icon=_props.icon;var isDiscoverPost=_props.isDiscoverPost;var primaryTag=post&&post.primary_tag;var siteName=(0,_utils.siteNameFromSiteAndPost)(site,post);if(!siteName){siteName=this.translate("(no title)")}return _react2.default.createElement("ul",{className:"reader-post-byline"},!isDiscoverPost&&post.author&&post.author.name?_react2.default.createElement("li",{className:"reader-post-byline__author"},this.renderAuthorName()):null,post.date&&post.URL?_react2.default.createElement("li",{className:"reader-post-byline__date"},_react2.default.createElement("a",{className:"reader-post-byline__date-link",onClick:this.recordDateClick,href:post.URL,target:"_blank",rel:"noopener noreferrer"},_react2.default.createElement(_postTime2.default,{date:post.date}),icon?_react2.default.createElement(_gridicon2.default,{icon:"external",size:14}):null)):null,primaryTag?_react2.default.createElement("li",{className:"reader-post-byline__tag"},_react2.default.createElement("a",{href:"/tag/"+primaryTag.slug,className:"ignore-click",onClick:this.recordTagClick},_react2.default.createElement(_gridicon2.default,{icon:"tag",size:16})," ",primaryTag.name)):null)}}]);return PostByline}(_react2.default.Component);PostByline.propTypes={post:_react2.default.PropTypes.object.isRequired,site:_react2.default.PropTypes.object,icon:_react2.default.PropTypes.bool,isDiscoverPost:_react2.default.PropTypes.bool};PostByline.defaultProps={icon:false,isDiscoverPost:false};exports.default=PostByline;module.exports=exports["default"]},2352:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1),shallowEqual=__webpack_require__(291),debug=__webpack_require__(3)("calypso:reader:post-options-error");var FeedSubscriptionStore=__webpack_require__(1768),FeedSubscriptionActions=__webpack_require__(1845),FeedSubscriptionStoreErrorTypes=__webpack_require__(1767).error,Notice=__webpack_require__(76),SiteBlockStore=__webpack_require__(2273),SiteBlockActions=__webpack_require__(2080),SiteBlockStoreErrorTypes=__webpack_require__(1906).error,stats=__webpack_require__(1643);var PostErrors=React.createClass({displayName:"PostErrors",propTypes:{post:React.PropTypes.object.isRequired},getInitialState:function getInitialState(){return this.getStateFromStores()},componentDidMount:function componentDidMount(){SiteBlockStore.on("change",this.updateState);FeedSubscriptionStore.on("change",this.updateState)},componentWillUnmount:function componentWillUnmount(){SiteBlockStore.off("change",this.updateState);FeedSubscriptionStore.off("change",this.updateState)},getStateFromStores:function getStateFromStores(){return{blockError:SiteBlockStore.getLastErrorBySite(this.props.post.site_ID),followError:FeedSubscriptionStore.getLastErrorBySiteUrl(this.props.post.site_URL)}},updateState:function updateState(){var newState=this.getStateFromStores();if(!shallowEqual(newState,this.state)){this.setState(this.getStateFromStores())}},render:function render(){var post=this.props.post,errors=[];if(this.state.followError){errors.push(React.createElement(PostError,{key:"followError"+post.ID,error:this.state.followError}))}if(this.state.blockError){errors.push(React.createElement(PostError,{key:"blockError"+post.ID,error:this.state.blockError}))}if(errors.length<1){return null}return React.createElement("div",{className:"reader-post-errors"},errors)}});var PostError=React.createClass({displayName:"PostError",propTypes:{error:React.PropTypes.object.isRequired},getMessage:function getMessage(errorType){var message;switch(errorType){case SiteBlockStoreErrorTypes.UNABLE_TO_BLOCK:message=this.translate("Sorry, we couldn't block this site. Please try again in a while.");break;case FeedSubscriptionStoreErrorTypes.UNABLE_TO_FOLLOW:message=this.translate("Sorry, we couldn't follow this site. Please try again in a while.");break;case FeedSubscriptionStoreErrorTypes.UNABLE_TO_UNFOLLOW:message=this.translate("Sorry, we couldn't unfollow this site. Please try again in a while.");break}return message},dismissError:function dismissError(event){var error=this.props.error;event.preventDefault();if(error.errorType===FeedSubscriptionStoreErrorTypes.UNABLE_TO_FOLLOW||error.errorType===FeedSubscriptionStoreErrorTypes.UNABLE_TO_UNFOLLOW){FeedSubscriptionActions.dismissError(error);stats.recordAction("dismiss_follow_error");stats.recordGaEvent("Clicked Dismiss Follow Error");stats.recordTrack("calypso_reader_follow_error_dismissed")}else if(error.errorType===SiteBlockStoreErrorTypes.UNABLE_TO_BLOCK){SiteBlockActions.dismissError(error);stats.recordAction("dismiss_block_error");stats.recordGaEvent("Clicked Dismiss Block Error");stats.recordTrack("calypso_reader_block_error_dismissed")}},render:function render(){var error=this.props.error,message=this.getMessage(error.errorType);if(!message){return null}return React.createElement(Notice,{isCompact:true,text:message,className:"reader-post-errors__notice",onDismissClick:this.dismissError,status:"is-error"})}});module.exports=PostErrors},2354:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _noop=__webpack_require__(38);var _noop2=_interopRequireDefault(_noop);var _page=__webpack_require__(33);var _page2=_interopRequireDefault(_page);var _get=__webpack_require__(24);var _get2=_interopRequireDefault(_get);var _menu=__webpack_require__(1673);var _menu2=_interopRequireDefault(_menu);var _menuItem=__webpack_require__(1652);var _menuItem2=_interopRequireDefault(_menuItem);var _readerFeedSubscriptions=__webpack_require__(1768);var _readerFeedSubscriptions2=_interopRequireDefault(_readerFeedSubscriptions);var _readerSiteStore=__webpack_require__(1711);var _readerSiteStore2=_interopRequireDefault(_readerSiteStore);var _feedStore=__webpack_require__(1750);var _feedStore2=_interopRequireDefault(_feedStore);var _actions=__webpack_require__(1897);var _actions2=_interopRequireDefault(_actions);var _readerSiteBlocks=__webpack_require__(2273);var _readerSiteBlocks2=_interopRequireDefault(_readerSiteBlocks);var _actions3=__webpack_require__(2080);var _actions4=_interopRequireDefault(_actions3);var _utils=__webpack_require__(1649);var _utils2=_interopRequireDefault(_utils);var _followButton=__webpack_require__(1723);var _followButton2=_interopRequireDefault(_followButton);var _helper=__webpack_require__(1674);var DiscoverHelper=_interopRequireWildcard(_helper);var _reactSmartSetState=__webpack_require__(1710);var _reactSmartSetState2=_interopRequireDefault(_reactSmartSetState);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var stats=__webpack_require__(1643);var PostOptions=_react2.default.createClass({displayName:"PostOptions",propTypes:{post:_react2.default.PropTypes.object.isRequired,onBlock:_react2.default.PropTypes.func},getDefaultProps:function getDefaultProps(){return{onBlock:_noop2.default,position:"top left"}},smartSetState:_reactSmartSetState2.default,getInitialState:function getInitialState(){var state=this.getStateFromStores();state.popoverPosition=this.props.position;state.showPopoverMenu=false;return state},componentDidMount:function componentDidMount(){_readerSiteBlocks2.default.on("change",this.updateState);_readerFeedSubscriptions2.default.on("change",this.updateState);_feedStore2.default.on("change",this.updateState)},componentWillUnmount:function componentWillUnmount(){_readerSiteBlocks2.default.off("change",this.updateState);_readerFeedSubscriptions2.default.off("change",this.updateState);_feedStore2.default.off("change",this.updateState)},getStateFromStores:function getStateFromStores(){var siteId=this.props.post.site_ID,feed=this.getFeed(),followUrl=this.getFollowUrl(feed);return{isBlocked:_readerSiteBlocks2.default.getIsBlocked(siteId),blockError:_readerSiteBlocks2.default.getLastErrorBySite(siteId),feed:this.getFeed(),followUrl:followUrl,followError:_readerFeedSubscriptions2.default.getLastErrorBySiteUrl(followUrl)}},updateState:function updateState(){this.smartSetState(this.getStateFromStores());if(this.state.blockError||this.state.followError){this.state.showPopoverMenu=false}},blockSite:function blockSite(){stats.recordAction("blocked_blog");stats.recordGaEvent("Clicked Block Site");stats.recordTrackForPost("calypso_reader_block_site",this.props.post);_actions4.default.block(this.props.post.site_ID);this.props.onBlock()},reportPost:function reportPost(){if(!this.props.post||!this.props.post.URL){return}stats.recordAction("report_post");stats.recordGaEvent("Clicked Report Post","post_options");stats.recordTrackForPost("calypso_reader_post_reported",this.props.post);window.open("https://wordpress.com/abuse/?report_url="+encodeURIComponent(this.props.post.URL),"_blank")},getFollowUrl:function getFollowUrl(feed){return feed?feed.get("feed_URL"):this.props.post.site_URL},getFeed:function getFeed(){var feedId=(0,_get2.default)(this.props,"post.feed_ID");if(!feedId||feedId<1){return}var feed=_feedStore2.default.get(feedId);if(!feed){_actions2.default.fetch(feedId)}return feed},_showPopoverMenu:function _showPopoverMenu(){var newState=!this.state.showPopoverMenu;this.setState({showPopover:false,showPopoverMenu:newState});stats.recordAction(newState?"open_post_options_menu":"close_post_options_menu");stats.recordGaEvent(newState?"Open Post Options Menu":"Close Post Options Menu");stats.recordTrackForPost("calypso_reader_post_options_menu_"+(newState?"opened":"closed"),this.props.post)},_closePopoverMenu:function _closePopoverMenu(){if(this.isMounted()){this.setState({showPopoverMenu:false})}},editPost:function editPost(closeMenu){var post=this.props.post,site=_readerSiteStore2.default.get(this.props.post.site_ID);var editUrl="//wordpress.com/post/"+post.site_ID+"/"+post.ID+"/";closeMenu();if(site&&site.get("slug")){editUrl=_utils2.default.getEditURL(post,site.toJS())}stats.recordAction("edit_post");stats.recordGaEvent("Clicked Edit Post","post_options");stats.recordTrackForPost("calypso_reader_edit_post_clicked",this.props.post);setTimeout(function(){if(editUrl.indexOf("//")===0){window.location.href=editUrl}else{(0,_page2.default)(editUrl)}},100)},render:function render(){var post=this.props.post,isEditPossible=_utils2.default.userCan("edit_post",post),isDiscoverPost=DiscoverHelper.isDiscoverPost(post);var triggerClasses=["post-options__trigger","ignore-click"],isBlockPossible=false;if(this.state.showPopoverMenu){triggerClasses.push("is-triggered")}triggerClasses=triggerClasses.join(" ");if(post.site_ID&&!post.is_external&&!post.is_jetpack&&!isEditPossible&&!isDiscoverPost){isBlockPossible=true}return _react2.default.createElement("span",{className:"post-options"},_react2.default.createElement("span",{className:triggerClasses,ref:"popoverMenuButton",onClick:this._showPopoverMenu},_react2.default.createElement("svg",{className:"gridicon gridicon__ellipsis",height:"24",width:"24",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},_react2.default.createElement("g",null,_react2.default.createElement("circle",{cx:"5",cy:"12",r:"2"}),_react2.default.createElement("circle",{cx:"19",cy:"12",r:"2"}),_react2.default.createElement("circle",{cx:"12",cy:"12",r:"2"}))),_react2.default.createElement("span",{className:"post-options__label"},this.translate("More"))),_react2.default.createElement(_menu2.default,{isVisible:this.state.showPopoverMenu,onClose:this._closePopoverMenu,position:this.state.popoverPosition,context:this.refs&&this.refs.popoverMenuButton},_react2.default.createElement(_followButton2.default,{tagName:_menuItem2.default,siteUrl:this.state.followUrl}),isEditPossible?_react2.default.createElement(_menuItem2.default,{onClick:this.editPost,className:"post-options__edit has-icon"},_react2.default.createElement("svg",{className:"gridicon gridicon__edit",height:"20",width:"20",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},_react2.default.createElement("g",null,_react2.default.createElement("path",{d:"M4 15v5h5l9-9-5-5-9 9zM16 3l-2 2 5 5 2-2-5-5z"}))),this.translate("Edit Post")):null,isBlockPossible||isDiscoverPost?_react2.default.createElement("hr",{className:"post-options__hr"}):null,isBlockPossible?_react2.default.createElement(_menuItem2.default,{onClick:this.blockSite},this.translate("Block Site")):null,isBlockPossible||isDiscoverPost?_react2.default.createElement(_menuItem2.default,{onClick:this.reportPost},this.translate("Report this Post")):null))}});exports.default=PostOptions;module.exports=exports["default"]},2355:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _menu=__webpack_require__(396);var _menu2=_interopRequireDefault(_menu);var _expandableHeading=__webpack_require__(3215);var _expandableHeading2=_interopRequireDefault(_expandableHeading);var _expandableAddForm=__webpack_require__(3214);var _expandableAddForm2=_interopRequireDefault(_expandableAddForm);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ExpandableSidebarMenu=_react2.default.createClass({displayName:"ExpandableSidebarMenu",propTypes:{title:_react2.default.PropTypes.oneOfType([_react2.default.PropTypes.string,_react2.default.PropTypes.element]).isRequired,count:_react2.default.PropTypes.number,addLabel:_react2.default.PropTypes.string,addPlaceholder:_react2.default.PropTypes.string,onAddSubmit:_react2.default.PropTypes.func,onAddClick:_react2.default.PropTypes.func,onClick:_react2.default.PropTypes.func},getDefaultProps:function getDefaultProps(){return{expanded:false}},render:function render(){var classes=(0,_classnames2.default)(this.props.className,{"is-toggle-open":!!this.props.expanded,"is-togglable":true});return _react2.default.createElement(_menu2.default,{className:classes},_react2.default.createElement(_expandableHeading2.default,{title:this.props.title,count:this.props.count,onClick:this.props.onClick}),_react2.default.createElement(_expandableAddForm2.default,{addLabel:this.props.addLabel,addPlaceholder:this.props.addPlaceholder,onAddClick:this.props.onAddClick,onAddSubmit:this.props.onAddSubmit}),_react2.default.createElement("ul",{className:"sidebar__menu-list"},this.props.children))}});exports.default=ExpandableSidebarMenu;module.exports=exports["default"]},2356:function(module,exports,__webpack_require__){"use strict";var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var React=__webpack_require__(1),page=__webpack_require__(33),includes=__webpack_require__(30);var DocumentHead=__webpack_require__(721),FeedHeader=__webpack_require__(2349),FeedFeatured=__webpack_require__(3227),EmptyContent=__webpack_require__(3226),Stream=__webpack_require__(1753),HeaderBack=__webpack_require__(1918),SiteStore=__webpack_require__(1711),SiteStoreActions=__webpack_require__(1815),SiteState=__webpack_require__(1738).state,FeedError=__webpack_require__(2002),FeedStore=__webpack_require__(1750),FeedStoreActions=__webpack_require__(1897),FeedState=__webpack_require__(1749).state,FeedStreamStoreActions=__webpack_require__(1898),feedStreamFactory=__webpack_require__(1764),smartSetState=__webpack_require__(1710);function checkForRedirect(site){if(site&&site.get("prefer_feed")&&site.get("feed_ID")){setTimeout(function(){page.replace("/read/feeds/"+site.get("feed_ID"))},0)}}var SiteStream=React.createClass({displayName:"SiteStream",getDefaultProps:function getDefaultProps(){return{showBack:true}},getInitialState:function getInitialState(){return this.getState()},componentDidMount:function componentDidMount(){SiteStore.on("change",this.updateState);FeedStore.on("change",this.updateState)},componentWillUnmount:function componentWillUnmount(){SiteStore.off("change",this.updateState);FeedStore.off("change",this.updateState)},componentWillReceiveProps:function componentWillReceiveProps(nextProps){if(nextProps.siteId!==this.props.siteId){this.updateState(nextProps)}},smartSetState:smartSetState,getState:function getState(){var props=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.props;var _getSiteAndFeed=this.getSiteAndFeed(props.siteId);var site=_getSiteAndFeed.site;var feed=_getSiteAndFeed.feed;checkForRedirect(site);var state={feed:feed,site:site,title:props.title||this.getTitle(site)};return state},updateState:function updateState(){var props=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.props;var state=this.getState(props);checkForRedirect(state.site);this.smartSetState(state)},getSiteAndFeed:function getSiteAndFeed(siteId){var site=SiteStore.get(siteId),feed;if(!site){SiteStoreActions.fetch(siteId)}if(site&&!includes([SiteState.COMPLETE,SiteState.ERROR],site.get("state"))){site=null}if(site&&site.get("state")===SiteState.COMPLETE&&site.get("feed_ID")){feed=FeedStore.get(site.get("feed_ID"));if(!feed){setTimeout(function(){FeedStoreActions.fetch(site.get("feed_ID"))},0)}else if(feed.state!==FeedState.COMPLETE){feed=null}}return{site:site,feed:feed}},getTitle:function getTitle(site){if(!site){return}if(site.get("state")===SiteState.COMPLETE){return site.get("title")||site.get("domain")}else if(site.get("state")===SiteState.ERROR){return this.translate("Error fetching site")}},goBack:function goBack(){if(typeof window!=="undefined"){window.history.back()}},render:function render(){var site=this.state.site,title=this.state.title,emptyContent=React.createElement(EmptyContent,null),featuredStore=null,featuredContent=null;if(!title){title=this.translate("Loading Site")}if(site&&site.get("state")===SiteState.ERROR){return React.createElement(FeedError,{sidebarTitle:title})}if(site&&site.get("has_featured")){featuredStore=feedStreamFactory("featured:"+site.get("ID"));setTimeout(function(){return FeedStreamStoreActions.fetchNextPage(featuredStore.id)},0);featuredContent=React.createElement(FeedFeatured,{store:featuredStore})}return React.createElement(Stream,(0,_extends3.default)({},this.props,{listName:title,emptyContent:emptyContent,showPostHeader:false}),React.createElement(DocumentHead,{title:this.translate("%s  Reader",{args:title})}),this.props.showBack&&React.createElement(HeaderBack,null),React.createElement(FeedHeader,{site:this.state.site,feed:this.state.feed}),featuredContent)}});module.exports=SiteStream},2357:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _keys=__webpack_require__(39);var _keys2=_interopRequireDefault(_keys);var _url=__webpack_require__(70);var _url2=_interopRequireDefault(_url);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={getXPostMetadata:function getXPostMetadata(post){var xPostMetadata={siteURL:null,postURL:null,commentURL:null,blogId:null,postId:null};if(post&&post.metadata){var keys=(0,_keys2.default)(post.metadata);for(var i=0;i<keys.length;i++){var meta=post.metadata[keys[i]];if(meta.key==="_xpost_original_permalink"||meta.key==="xcomment_original_permalink"){var parsedURL=_url2.default.parse(meta.value,false,false);xPostMetadata.siteURL=parsedURL.protocol+"//"+parsedURL.host;xPostMetadata.postURL=""+xPostMetadata.siteURL+parsedURL.path;if(parsedURL.hash&&parsedURL.hash.indexOf("#comment-")===0){xPostMetadata.commentURL=parsedURL.href}}else if(meta.key==="xpost_origin"){var ids=meta.value.split(":");xPostMetadata.blogId=ids[0];xPostMetadata.postId=ids[1]}}}return xPostMetadata}};module.exports=exports["default"]},2365:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _promise=__webpack_require__(49);var _promise2=_interopRequireDefault(_promise);exports.receivePosts=receivePosts;var _filter=__webpack_require__(77);var _filter2=_interopRequireDefault(_filter);var _forEach=__webpack_require__(114);var _forEach2=_interopRequireDefault(_forEach);var _map=__webpack_require__(45);var _map2=_interopRequireDefault(_map);var _isUndefined=__webpack_require__(743);var _isUndefined2=_interopRequireDefault(_isUndefined);var _reject=__webpack_require__(209);var _reject2=_interopRequireDefault(_reject);var _actionTypes=__webpack_require__(2);var _analytics=__webpack_require__(20);var _analytics2=_interopRequireDefault(_analytics);var _normalizationRules=__webpack_require__(2366);var _dispatcher=__webpack_require__(42);var _dispatcher2=_interopRequireDefault(_dispatcher);var _constants=__webpack_require__(1971);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function trackRailcarRender(post){_analytics2.default.tracks.recordEvent("calypso_traintracks_render",post.railcar)}function receivePosts(posts){if(!posts){return _promise2.default.resolve([])}return function(dispatch){var withoutUndefined=(0,_reject2.default)(posts,_isUndefined2.default);var normalizedPosts=(0,_map2.default)(withoutUndefined,_normalizationRules.runFastRules);(0,_forEach2.default)((0,_map2.default)(normalizedPosts,_normalizationRules.runSlowRules),function(slowPromise){slowPromise.then(function(post){dispatch({type:_actionTypes.READER_POSTS_RECEIVE,posts:[post]});_dispatcher2.default.handleServerAction({data:post,type:_constants.action.RECEIVE_NORMALIZED_FEED_POST})})});dispatch({type:_actionTypes.READER_POSTS_RECEIVE,posts:normalizedPosts});(0,_forEach2.default)(normalizedPosts,function(post){_dispatcher2.default.handleServerAction({data:post,type:_constants.action.RECEIVE_NORMALIZED_FEED_POST})});(0,_forEach2.default)((0,_filter2.default)(normalizedPosts,"railcar"),trackRailcarRender);return _promise2.default.resolve(normalizedPosts)}}},2366:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _assign=__webpack_require__(5);var _assign2=_interopRequireDefault(_assign);exports.runFastRules=runFastRules;exports.runSlowRules=runSlowRules;var _find=__webpack_require__(27);var _find2=_interopRequireDefault(_find);var _flow=__webpack_require__(232);var _flow2=_interopRequireDefault(_flow);var _forEach=__webpack_require__(114);var _forEach2=_interopRequireDefault(_forEach);var _url=__webpack_require__(70);var _url2=_interopRequireDefault(_url);var _matches=__webpack_require__(426);var _matches2=_interopRequireDefault(_matches);var _resizeImageUrl=__webpack_require__(1769);var _resizeImageUrl2=_interopRequireDefault(_resizeImageUrl);var _displayTypes=__webpack_require__(2012);var _displayTypes2=_interopRequireDefault(_displayTypes);var _ruleCreateBetterExcerpt=__webpack_require__(786);var _ruleCreateBetterExcerpt2=_interopRequireDefault(_ruleCreateBetterExcerpt);var _ruleContentDetectEmbeds=__webpack_require__(2251);var _ruleContentDetectEmbeds2=_interopRequireDefault(_ruleContentDetectEmbeds);var _ruleContentDetectPolls=__webpack_require__(2252);var _ruleContentDetectPolls2=_interopRequireDefault(_ruleContentDetectPolls);var _ruleContentMakeEmbedsSecure=__webpack_require__(2254);var _ruleContentMakeEmbedsSecure2=_interopRequireDefault(_ruleContentMakeEmbedsSecure);var _ruleContentRemoveStyles=__webpack_require__(2255);var _ruleContentRemoveStyles2=_interopRequireDefault(_ruleContentRemoveStyles);var _ruleContentSafeImages=__webpack_require__(2256);var _ruleContentSafeImages2=_interopRequireDefault(_ruleContentSafeImages);var _ruleContentWordCount=__webpack_require__(2257);var _ruleContentWordCount2=_interopRequireDefault(_ruleContentWordCount);var _ruleContentDisableAutoplay=__webpack_require__(2253);var _ruleDecodeEntities=__webpack_require__(787);var _ruleDecodeEntities2=_interopRequireDefault(_ruleDecodeEntities);var _ruleFirstPassCanonicalImage=__webpack_require__(788);var _ruleFirstPassCanonicalImage2=_interopRequireDefault(_ruleFirstPassCanonicalImage);var _ruleMakeSiteIdSafeForApi=__webpack_require__(2259);var _ruleMakeSiteIdSafeForApi2=_interopRequireDefault(_ruleMakeSiteIdSafeForApi);var _rulePickPrimaryTag=__webpack_require__(2261);var _rulePickPrimaryTag2=_interopRequireDefault(_rulePickPrimaryTag);var _rulePreventWidows=__webpack_require__(2262);var _rulePreventWidows2=_interopRequireDefault(_rulePreventWidows);var _ruleSafeImageProperties=__webpack_require__(2263);var _ruleSafeImageProperties2=_interopRequireDefault(_ruleSafeImageProperties);var _ruleStripHtml=__webpack_require__(789);var _ruleStripHtml2=_interopRequireDefault(_ruleStripHtml);var _ruleWithContentDom=__webpack_require__(2265);var _ruleWithContentDom2=_interopRequireDefault(_ruleWithContentDom);var _ruleKeepValidImages=__webpack_require__(2258);var _ruleKeepValidImages2=_interopRequireDefault(_ruleKeepValidImages);var _rulePickCanonicalImage=__webpack_require__(2260);var _rulePickCanonicalImage2=_interopRequireDefault(_rulePickCanonicalImage);var _ruleWaitForImagesToLoad=__webpack_require__(2264);var _ruleWaitForImagesToLoad2=_interopRequireDefault(_ruleWaitForImagesToLoad);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var READER_CONTENT_WIDTH=720,DISCOVER_FULL_BLEED_WIDTH=1082,PHOTO_ONLY_MIN_WIDTH=READER_CONTENT_WIDTH*.8,DISCOVER_BLOG_ID=53424024;
function discoverFullBleedImages(post,dom){if(post.site_ID===DISCOVER_BLOG_ID){var images=dom.querySelectorAll(".fullbleed img, img.fullbleed");(0,_forEach2.default)(images,function(image){var newSrc=(0,_resizeImageUrl2.default)(image.src,{w:DISCOVER_FULL_BLEED_WIDTH});var oldImageObject=(0,_find2.default)(post.content_images,{src:image.src});oldImageObject.src=newSrc;image.src=newSrc})}return post}function classifyPost(post){var canonicalImage=post.canonical_image;var displayType=_displayTypes2.default.UNCLASSIFIED,canonicalAspect=void 0;if(post.images&&post.images.length>=1&&canonicalImage&&canonicalImage.width>=PHOTO_ONLY_MIN_WIDTH&&post.word_count<100){displayType^=_displayTypes2.default.PHOTO_ONLY}if(canonicalImage){(function(){if(canonicalImage.width>=600){displayType^=_displayTypes2.default.LARGE_BANNER}if(canonicalImage.height&&canonicalImage.width){canonicalAspect=canonicalImage.width/canonicalImage.height;if(canonicalAspect>=2&&canonicalImage.width>=600){displayType^=_displayTypes2.default.LANDSCAPE_BANNER}else if(canonicalAspect<1&&canonicalImage.height>160){displayType^=_displayTypes2.default.PORTRAIT_BANNER}else if(canonicalAspect>.7&&canonicalAspect<1.3&&canonicalImage.width<200){displayType^=_displayTypes2.default.THUMBNAIL}}var canonicalImageUrl=_url2.default.parse(canonicalImage.uri,true,true),canonicalImageUrlImportantParts={hostname:canonicalImageUrl.hostname,pathname:canonicalImageUrl.pathname,query:canonicalImageUrl.query},matcher=(0,_matches2.default)(canonicalImageUrlImportantParts);if((0,_find2.default)(post.content_images,function(img){var imgUrl=_url2.default.parse(img.src,true,true);return matcher(imgUrl)})){displayType^=_displayTypes2.default.CANONICAL_IN_CONTENT}})()}if(post.content_embeds&&post.content_embeds.length>=1){if(!canonicalImage||post.content_embeds.length===1){displayType^=_displayTypes2.default.FEATURED_VIDEO}}if(post.content_images&&post.content_images.length>2){displayType^=_displayTypes2.default.GALLERY}if(post.tags&&post.tags["p2-xpost"]){displayType^=_displayTypes2.default.X_POST}post.display_type=displayType;return post}var fastPostNormalizationRules=(0,_flow2.default)([_ruleDecodeEntities2.default,_ruleStripHtml2.default,_rulePreventWidows2.default,_ruleMakeSiteIdSafeForApi2.default,_rulePickPrimaryTag2.default,(0,_ruleSafeImageProperties2.default)(READER_CONTENT_WIDTH),_ruleFirstPassCanonicalImage2.default,(0,_ruleWithContentDom2.default)([_ruleContentRemoveStyles2.default,(0,_ruleContentSafeImages2.default)(READER_CONTENT_WIDTH),discoverFullBleedImages,_ruleContentMakeEmbedsSecure2.default,_ruleContentDisableAutoplay.disableAutoPlayOnEmbeds,_ruleContentDisableAutoplay.disableAutoPlayOnMedia,_ruleContentDetectEmbeds2.default,_ruleContentDetectPolls2.default,_ruleContentWordCount2.default]),_ruleCreateBetterExcerpt2.default,classifyPost]);function runFastRules(post){if(!post){return post}post=(0,_assign2.default)({},post);fastPostNormalizationRules(post);return post}var slowSyncRules=(0,_flow2.default)([(0,_ruleKeepValidImages2.default)(144,72),_rulePickCanonicalImage2.default,classifyPost]);function runSlowRules(post){post=(0,_assign2.default)({},post);return(0,_ruleWaitForImagesToLoad2.default)(post).then(slowSyncRules)}},2415:function(module,exports){function baseGt(value,other){return value>other}module.exports=baseGt},2419:function(module,exports,__webpack_require__){var castPath=__webpack_require__(179),isFunction=__webpack_require__(119),isKey=__webpack_require__(122),toKey=__webpack_require__(84);function result(object,path,defaultValue){path=isKey(path,object)?[path]:castPath(path);var index=-1,length=path.length;if(!length){object=undefined;length=1}while(++index<length){var value=object==null?undefined:object[toKey(path[index])];if(value===undefined){index=length;value=defaultValue}object=isFunction(value)?value.call(object):value}return object}module.exports=result},2428:function(module,exports){(function(global){"use strict";function uniqNoSet(arr){var ret=[];for(var i=0;i<arr.length;i++){if(ret.indexOf(arr[i])===-1){ret.push(arr[i])}}return ret}function uniqSet(arr){var seen=new Set;return arr.filter(function(el){if(!seen.has(el)){seen.add(el);return true}return false})}function uniqSetWithForEach(arr){var ret=[];new Set(arr).forEach(function(el){ret.push(el)});return ret}function doesForEachActuallyWork(){var ret=false;new Set([true]).forEach(function(el){ret=el});return ret===true}if("Set"in global){if(typeof Set.prototype.forEach==="function"&&doesForEachActuallyWork()){module.exports=uniqSetWithForEach}else{module.exports=uniqSet}}else{module.exports=uniqNoSet}}).call(exports,function(){return this}())},2429:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.AppPromo=exports.getPromoLink=undefined;var _sample2=__webpack_require__(2022);var _sample3=_interopRequireDefault(_sample2);var _noop2=__webpack_require__(38);var _noop3=_interopRequireDefault(_noop2);var _identity2=__webpack_require__(99);var _identity3=_interopRequireDefault(_identity2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactRedux=__webpack_require__(15);var _store=__webpack_require__(46);var _store2=_interopRequireDefault(_store);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _i18nCalypso=__webpack_require__(11);var _actions=__webpack_require__(133);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var getRandomPromo=function getRandomPromo(){var promoOptions=[{promoCode:"a0001",message:"WordPress.com your way  desktop app now available for Mac, Windows, and Linux.",type:"desktop"},{promoCode:"a0002",message:"Get WordPress.com app for your desktop.",type:"desktop"},{promoCode:"a0003",message:"WordPress.com app now available for desktop.",type:"desktop"},{promoCode:"a0005",message:"WordPress.com at your fingertips  download app for desktop.",type:"desktop"},{promoCode:"a0006",message:"WordPress.com in the palm of your hands  download app for mobile.",type:"mobile"}];return(0,_sample3.default)(promoOptions)};var getPromoLink=exports.getPromoLink=function getPromoLink(location,promoDetails){var type=promoDetails.type;var promoCode=promoDetails.promoCode;return"https://apps.wordpress.com/"+type+"/?ref=promo_"+location+"_"+promoCode};var AppPromo=exports.AppPromo=_react2.default.createClass({displayName:"AppPromo",propTypes:{location:_react2.default.PropTypes.string.isRequired},getInitialState:function getInitialState(){var promoItem=this.props.promoItem||getRandomPromo();return{promoItem:promoItem,showPromo:true}},componentDidMount:function componentDidMount(){this.props.recordTracksEvent("calypso_desktop_promo_view",{promo_location:this.props.location,promo_code:this.state.promoItem.promoCode})},recordClickEvent:function recordClickEvent(){this.props.recordTracksEvent("calypso_desktop_promo_click",{promo_location:this.props.location,promo_code:this.state.promoItem.promoCode})},dismiss:function dismiss(){this.setState({showPromo:false});this.props.saveDismissal();this.props.recordTracksEvent("calypso_desktop_promo_dismiss",{promo_location:this.props.location,promo_code:this.state.promoItem.promoCode})},render:function render(){if(!this.state.showPromo){return null}var _props=this.props;var location=_props.location;var translate=_props.translate;var promoItem=this.state.promoItem;return _react2.default.createElement("div",{className:"app-promo"},_react2.default.createElement("span",{tabIndex:"0",className:"app-promo__dismiss",onClick:this.dismiss},_react2.default.createElement(_gridicon2.default,{icon:"cross",size:24}),_react2.default.createElement("span",{className:"app-promo__screen-reader-text"},translate("Dismiss"))),_react2.default.createElement("a",{onClick:this.recordClickEvent,className:"app-promo__link",title:"Try the desktop app!",href:this.props.getPromoLink(location,promoItem),target:"_blank",rel:"noopener noreferrer"},_react2.default.createElement("img",{className:"app-promo__icon",src:"/calypso/images/reader/promo-app-icon.png",width:"32",height:"32",alt:"WordPress Desktop Icon"}),promoItem.message))}});AppPromo.defaultProps={translate:_identity3.default,recordTracksEvent:_noop3.default,saveDismissal:function saveDismissal(){return _store2.default.set("desktop_promo_disabled",true)},getPromoLink:getPromoLink};exports.default=(0,_reactRedux.connect)(null,{recordTracksEvent:_actions.recordTracksEvent})((0,_i18nCalypso.localize)(AppPromo))},2444:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var LikeIcons=function LikeIcons(_ref){var size=_ref.size;return _react2.default.createElement("span",{className:"like-button__like-icons"},_react2.default.createElement(_gridicon2.default,{icon:"star",size:size}),_react2.default.createElement(_gridicon2.default,{icon:"star-outline",size:size}))};LikeIcons.propTypes={size:_react2.default.PropTypes.number};LikeIcons.defaultProps={size:24};exports.default=LikeIcons;module.exports=exports["default"]},2445:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);var _noop2=__webpack_require__(38);var _noop3=_interopRequireDefault(_noop2);var _omit2=__webpack_require__(18);var _omit3=_interopRequireDefault(_omit2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _mixin=__webpack_require__(111);var _mixin2=_interopRequireDefault(_mixin);var _actions=__webpack_require__(1975);var _actions2=_interopRequireDefault(_actions);var _button=__webpack_require__(1962);var _button2=_interopRequireDefault(_button);var _likeStore=__webpack_require__(2070);var _likeStore2=_interopRequireDefault(_likeStore);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var LikeButtonContainer=_react2.default.createClass({displayName:"LikeButtonContainer",propTypes:{siteId:_react2.default.PropTypes.number.isRequired,postId:_react2.default.PropTypes.number.isRequired,showZeroCount:_react2.default.PropTypes.bool,tagName:_react2.default.PropTypes.string,onLikeToggle:_react2.default.PropTypes.func},mixins:[_mixin2.default],getDefaultProps:function getDefaultProps(){return{onLikeToggle:_noop3.default}},getInitialState:function getInitialState(){return this.getStateFromStores()},getStateFromStores:function getStateFromStores(){var props=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.props;var animateLike=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;return{likeCount:_likeStore2.default.getLikeCountForPost(props.siteId,props.postId)||0,iLike:_likeStore2.default.isPostLikedByCurrentUser(props.siteId,props.postId),animateLike:animateLike}},componentWillReceiveProps:function componentWillReceiveProps(nextProps){if(this.props.siteId!==nextProps.siteId||this.props.postId!==nextProps.postId){var newState=this.getStateFromStores(nextProps,false);this.setState(newState)}},componentDidMount:function componentDidMount(){_likeStore2.default.on("change",this.onStoreChange)},componentWillUnmount:function componentWillUnmount(){_likeStore2.default.off("change",this.onStoreChange)},onStoreChange:function onStoreChange(){var newState=this.getStateFromStores();if(newState.likeCount!==this.state.likeCount||newState.iLike!==this.state.iLike){this.setState(newState)}},handleLikeToggle:function handleLikeToggle(liked){_actions2.default[liked?"likePost":"unlikePost"](this.props.siteId,this.props.postId);this.props.onLikeToggle(liked)},render:function render(){var props=(0,_omit3.default)(this.props,["siteId","postId"]);return _react2.default.createElement(_button2.default,(0,_extends3.default)({},props,{likeCount:this.state.likeCount,liked:this.state.iLike,animateLike:this.state.animateLike,onLikeToggle:this.handleLikeToggle}))}});exports.default=LikeButtonContainer;module.exports=exports["default"]},2502:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _react=__webpack_require__(1);var _reactRedux=__webpack_require__(15);var _redux=__webpack_require__(6);var _selectors=__webpack_require__(1859);var _actions=__webpack_require__(2011);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var QueryReaderLists=function(_Component){(0,_inherits3.default)(QueryReaderLists,_Component);function QueryReaderLists(){(0,_classCallCheck3.default)(this,QueryReaderLists);return(0,_possibleConstructorReturn3.default)(this,(QueryReaderLists.__proto__||(0,_getPrototypeOf2.default)(QueryReaderLists)).apply(this,arguments))}(0,_createClass3.default)(QueryReaderLists,[{key:"componentWillMount",value:function componentWillMount(){if(this.props.isRequestingSubscribedLists){return}this.props.requestSubscribedLists()}},{key:"render",value:function render(){return null}}]);return QueryReaderLists}(_react.Component);QueryReaderLists.propTypes={isRequestingSubscribedLists:_react.PropTypes.bool,requestSubscribedLists:_react.PropTypes.func};QueryReaderLists.defaultProps={requestSubscribedLists:function requestSubscribedLists(){}};exports.default=(0,_reactRedux.connect)(function(state){return{isRequestingSubscribedLists:(0,_selectors.isRequestingSubscribedLists)(state)}},function(dispatch){return(0,_redux.bindActionCreators)({requestSubscribedLists:_actions.requestSubscribedLists},dispatch)})(QueryReaderLists);module.exports=exports["default"]},2515:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _noop2=__webpack_require__(38);var _noop3=_interopRequireDefault(_noop2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _button=__webpack_require__(1886);var _button2=_interopRequireDefault(_button);var _actions=__webpack_require__(1845);var _actions2=_interopRequireDefault(_actions);var _readerFeedSubscriptions=__webpack_require__(1768);var _readerFeedSubscriptions2=_interopRequireDefault(_readerFeedSubscriptions);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var FollowButtonContainer=_react2.default.createClass({displayName:"FollowButtonContainer",propTypes:{siteUrl:_react2.default.PropTypes.string.isRequired,iconSize:_react2.default.PropTypes.number,onFollowToggle:_react2.default.PropTypes.func},getDefaultProps:function getDefaultProps(){return{onFollowToggle:_noop3.default}},getInitialState:function getInitialState(){return this.getStateFromStores()},getStateFromStores:function getStateFromStores(){return{following:_readerFeedSubscriptions2.default.getIsFollowingBySiteUrl(this.props.siteUrl)}},componentDidMount:function componentDidMount(){_readerFeedSubscriptions2.default.on("change",this.onStoreChange)},componentWillUnmount:function componentWillUnmount(){_readerFeedSubscriptions2.default.off("change",this.onStoreChange)},onStoreChange:function onStoreChange(){var newState=this.getStateFromStores();if(newState.following!==this.state.following){this.setState(newState)}},handleFollowToggle:function handleFollowToggle(following){_actions2.default[following?"follow":"unfollow"](this.props.siteUrl);this.props.onFollowToggle(following)},render:function render(){return _react2.default.createElement(_button2.default,{following:this.state.following,onFollowToggle:this.handleFollowToggle,iconSize:this.props.iconSize,tagName:this.props.tagName,disabled:this.props.disabled})}});exports.default=FollowButtonContainer;module.exports=exports["default"]},2519:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _i18nCalypso=__webpack_require__(11);var _i18nCalypso2=_interopRequireDefault(_i18nCalypso);var _observeWindowResize=__webpack_require__(2248);var _observeWindowResize2=_interopRequireDefault(_observeWindowResize);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _button=__webpack_require__(69);var _button2=_interopRequireDefault(_button);var _viewport=__webpack_require__(92);var _viewport2=_interopRequireDefault(_viewport);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var HIDE_BACK_CRITERIA={windowWidth:480,characterLength:8};exports.default=_react2.default.createClass({displayName:"HeaderCakeBack",mixins:[_observeWindowResize2.default],propTypes:{onClick:_react.PropTypes.func,href:_react.PropTypes.string,text:_react.PropTypes.string,spacer:_react.PropTypes.bool},getDefaultProps:function getDefaultProps(){return{spacer:false,disabled:false}},hideText:function hideText(text){var windowWidth=_viewport2.default.getWindowInnerWidth();if(windowWidth<=HIDE_BACK_CRITERIA.windowWidth&&text.length>=HIDE_BACK_CRITERIA.characterLength||windowWidth<=300){return true}return false},render:function render(){var _props=this.props;var _props$text=_props.text;var text=_props$text===undefined?_i18nCalypso2.default.translate("Back"):_props$text;var href=_props.href;var onClick=_props.onClick;var spacer=_props.spacer;var linkClasses=(0,_classnames2.default)({"header-cake__back":true,"is-spacer":spacer});return _react2.default.createElement(_button2.default,{compact:true,borderless:true,className:linkClasses,href:href,onClick:onClick,disabled:spacer},_react2.default.createElement(_gridicon2.default,{icon:"arrow-left",size:18}),!this.hideText(text)&&text)},onWindowResize:function onWindowResize(){this.forceUpdate()}});module.exports=exports["default"]},2520:function(module,exports,__webpack_require__){"use strict";var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _debug=__webpack_require__(3);var _debug2=_interopRequireDefault(_debug);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var debug=(0,_debug2.default)("calypso:infinite-list:helper");var ScrollHelper=function(){function ScrollHelper(boundsForRef){(0,_classCallCheck3.default)(this,ScrollHelper);this.boundsForRef=boundsForRef;this.itemHeights={};this.contextHeight=null;this.topHideLevelHard=null;this.topHideLevelSoft=null;this.bottomHideLevelHard=null;this.bottomHideLevelSoft=null;this.bottomHideLevelUltraSoft=null;this.props=null;this.scrollPosition=null;this.containerTop=null;this.topPlaceholderHeight=null;this.bottomPlaceholderHeight=null;this.containerBottom=null;this.stateUpdated=null;this.firstRenderedIndex=null;this.lastRenderedIndex=null}(0,_createClass3.default)(ScrollHelper,[{key:"storedItemHeight",value:function storedItemHeight(itemKey){var height=this.props.guessedItemHeight;if(itemKey in this.itemHeights){height=this.itemHeights[itemKey]}return height}},{key:"forEachInRow",value:function forEachInRow(index,callback,context){if("function"!==typeof callback){return}if(context){callback=callback.bind(context)}var firstIndexInRow=index-index%this.props.itemsPerRow,lastIndexInRow=Math.min(firstIndexInRow+this.props.itemsPerRow,this.props.items.length)-1;for(var i=firstIndexInRow;i<=lastIndexInRow;i++){callback(this.props.items[i],i)}}},{key:"storeRowItemHeights",value:function storeRowItemHeights(fromDirection,index){this.forEachInRow(index,function(item){var itemKey=this.props.getItemRef(item),itemBounds=this.boundsForRef(itemKey);var height=void 0;if(itemBounds){if("bottom"===fromDirection){height=this.containerBottom-this.bottomPlaceholderHeight-itemBounds.top}else{height=itemBounds.bottom-(this.containerTop+this.topPlaceholderHeight)}}else{height=this.props.guessedItemHeight}this.itemHeights[itemKey]=height},this)}},{key:"deleteRowItemHeights",value:function deleteRowItemHeights(index){var _this=this;this.forEachInRow(index,function(item){var itemKey=_this.props.getItemRef(item);delete _this.itemHeights[itemKey]},this)}},{key:"getRowHeight",value:function getRowHeight(index){var _this2=this;var maxHeight=0;this.forEachInRow(index,function(item){var itemKey=_this2.props.getItemRef(item),height=_this2.storedItemHeight(itemKey);maxHeight=Math.max(maxHeight,height)},this);return maxHeight}},{key:"updateContextHeight",value:function updateContextHeight(contextHeight){if(this.contextHeight===contextHeight){return}this.contextHeight=contextHeight;this.topHideLevelHard=Math.min(-1*contextHeight,-5*this.props.guessedItemHeight);this.topHideLevelSoft=Math.min(-2*contextHeight,-10*this.props.guessedItemHeight);this.bottomHideLevelHard=contextHeight+Math.max(contextHeight,5*this.props.guessedItemHeight);this.bottomHideLevelSoft=contextHeight+Math.max(2*contextHeight,10*this.props.guessedItemHeight);this.bottomHideLevelUltraSoft=contextHeight+Math.max(3*contextHeight,15*this.props.guessedItemHeight)}},{key:"initialLastRenderedIndex",value:function initialLastRenderedIndex(){return Math.min(this.props.items.length-1,Math.floor(this.bottomHideLevelSoft/this.props.guessedItemHeight)-1)}},{key:"updatePlaceholderDimensions",value:function updatePlaceholderDimensions(){var topPlaceholderRect=this.boundsForRef("topPlaceholder"),bottomPlaceholderRect=this.boundsForRef("bottomPlaceholder");this.topPlaceholderHeight=topPlaceholderRect.height;this.containerTop=topPlaceholderRect.top;this.bottomPlaceholderHeight=bottomPlaceholderRect.height;this.containerBottom=bottomPlaceholderRect.bottom}},{key:"scrollChecks",value:function scrollChecks(state){this.reset(state);this.adjustLastRenderedIndex();if(this.shouldHideItemsAbove()){this.hideItemsAbove()}else if(this.shouldShowItemsAbove()){this.showItemsAbove()}if(this.shouldHideItemsBelow()){this.hideItemsBelow()}else if(this.shouldShowItemsBelow()){this.showItemsBelow()}if(this.shouldLoadNextPage()){this.loadNextPage()}}},{key:"reset",value:function reset(state){this.stateUpdated=false;this.firstRenderedIndex=state.firstRenderedIndex;this.lastRenderedIndex=state.lastRenderedIndex}},{key:"adjustLastRenderedIndex",value:function adjustLastRenderedIndex(){var offset=this.initialLastRenderedIndex(),lastIndex=this.lastRenderedIndex||0,firstIndex=this.firstRenderedIndex||0,itemCount=this.props.items.length;var newIndex=lastIndex;if(itemCount===0){newIndex=-1}if(lastIndex>=itemCount){newIndex=Math.min(firstIndex+offset,itemCount-1)}if(newIndex===-1&&itemCount>0&&firstIndex===0){newIndex=offset}if(newIndex!==this.lastRenderedIndex){this.stateUpdated=true;this.lastRenderedIndex=newIndex}}},{key:"shouldHideItemsAbove",value:function shouldHideItemsAbove(){return this.containerTop+this.topPlaceholderHeight<this.topHideLevelSoft}},{key:"hideItemsAbove",value:function hideItemsAbove(){var rowHeight=void 0,rowBottom=void 0;while(this.firstRenderedIndex<this.props.items.length){this.storeRowItemHeights("top",this.firstRenderedIndex);rowHeight=this.getRowHeight(this.firstRenderedIndex);rowBottom=this.containerTop+this.topPlaceholderHeight+rowHeight;if(rowBottom>this.topHideLevelHard){this.deleteRowItemHeights(this.firstRenderedIndex);break}this.topPlaceholderHeight+=rowHeight;this.firstRenderedIndex+=this.props.itemsPerRow;this.stateUpdated=true;debug("hiding top item",rowHeight,this.topPlaceholderHeight)}}},{key:"shouldShowItemsAbove",value:function shouldShowItemsAbove(){return this.containerTop+this.topPlaceholderHeight>this.topHideLevelHard}},{key:"showItemsAbove",value:function showItemsAbove(){var rowHeight=void 0,newPlaceholderBottom=void 0;while(this.firstRenderedIndex>0){rowHeight=this.getRowHeight(this.firstRenderedIndex-this.props.itemsPerRow);newPlaceholderBottom=this.containerTop+this.topPlaceholderHeight-rowHeight;if(newPlaceholderBottom<this.topHideLevelSoft){break}this.deleteRowItemHeights(this.firstRenderedIndex-this.props.itemsPerRow);this.firstRenderedIndex-=this.props.itemsPerRow;this.firstRenderedIndex=Math.max(0,this.firstRenderedIndex);if(this.firstRenderedIndex<=0){this.topPlaceholderHeight=0}else{this.topPlaceholderHeight=Math.max(0,this.topPlaceholderHeight-rowHeight)}this.stateUpdated=true;debug("showing top item",rowHeight,this.topPlaceholderHeight)}}},{key:"shouldHideItemsBelow",value:function shouldHideItemsBelow(){var placeholderTop=this.containerBottom-this.bottomPlaceholderHeight;return placeholderTop>this.bottomHideLevelUltraSoft}},{key:"hideItemsBelow",value:function hideItemsBelow(){var rowTop=void 0,rowHeight=void 0;while(this.lastRenderedIndex>=0){this.storeRowItemHeights("bottom",this.lastRenderedIndex);rowHeight=this.getRowHeight(this.lastRenderedIndex);rowTop=this.containerBottom-this.bottomPlaceholderHeight-rowHeight;if(rowTop<this.bottomHideLevelHard){this.deleteRowItemHeights(this.lastRenderedIndex);break}this.bottomPlaceholderHeight+=rowHeight;this.lastRenderedIndex-=this.props.itemsPerRow;this.stateUpdated=true;debug("hiding bottom item",rowHeight,this.bottomPlaceholderHeight)}}},{key:"shouldShowItemsBelow",value:function shouldShowItemsBelow(){var placeholderTop=this.containerBottom-this.bottomPlaceholderHeight;return placeholderTop<this.bottomHideLevelHard}},{key:"showItemsBelow",value:function showItemsBelow(){var rowHeight=void 0,itemTop=void 0,placeholderTop=void 0;while(this.lastRenderedIndex<this.props.items.length-1){rowHeight=this.getRowHeight(this.lastRenderedIndex+this.props.itemsPerRow);placeholderTop=this.containerBottom-this.bottomPlaceholderHeight;itemTop=placeholderTop+rowHeight;if(itemTop>this.bottomHideLevelSoft&&placeholderTop>this.bottomHideLevelHard){break}this.deleteRowItemHeights(this.lastRenderedIndex+this.props.itemsPerRow);if(this.bottomPlaceholderHeight-rowHeight<0){this.containerBottom+=rowHeight-this.bottomPlaceholderHeight;this.bottomPlaceholderHeight=0}else{this.bottomPlaceholderHeight-=rowHeight}this.lastRenderedIndex+=this.props.itemsPerRow;this.lastRenderedIndex=Math.min(this.lastRenderedIndex,this.props.items.length-1);if(this.lastRenderedIndex>=this.props.items.length-1){this.bottomPlaceholderHeight=0}this.stateUpdated=true;debug("showing bottom item",rowHeight,this.bottomPlaceholderHeight)}}},{key:"shouldLoadNextPage",value:function shouldLoadNextPage(){if(this.props.fetchingNextPage||this.props.lastPage){return false}return this.bottomPlaceholderHeight===0&&this.containerBottom<this.bottomHideLevelHard}},{key:"loadNextPage",value:function loadNextPage(){var _this3=this;var triggeredByScroll=this.triggeredByScroll;debug("fetching next page",this.containerBottom,this.bottomPlaceholderHeight);if(this.scrollPosition>this.contextHeight){triggeredByScroll=true}setTimeout(function(){if(_this3.props.fetchingNextPage||_this3.props.lastPage){return false}_this3.props.fetchNextPage({triggeredByScroll:triggeredByScroll})},0)}}]);return ScrollHelper}();module.exports=ScrollHelper},2532:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var Component=_react2.default.Component;var stopPropagation=function stopPropagation(event){return event.stopPropagation()};var SelectDropdownLabel=function(_Component){(0,_inherits3.default)(SelectDropdownLabel,_Component);function SelectDropdownLabel(){(0,_classCallCheck3.default)(this,SelectDropdownLabel);return(0,_possibleConstructorReturn3.default)(this,(SelectDropdownLabel.__proto__||(0,_getPrototypeOf2.default)(SelectDropdownLabel)).apply(this,arguments))}(0,_createClass3.default)(SelectDropdownLabel,[{key:"render",value:function render(){return _react2.default.createElement("li",{onClick:stopPropagation,className:"select-dropdown__label"},_react2.default.createElement("label",null,this.props.children))}}]);return SelectDropdownLabel}(Component);exports.default=SelectDropdownLabel;module.exports=exports["default"]},2604:function(module,exports,__webpack_require__){"use strict";var isEmpty=__webpack_require__(80),head=__webpack_require__(1734),lruCache=__webpack_require__(805);var inflight=__webpack_require__(1841),wpcom=__webpack_require__(28);var cache=lruCache(10);function requestKey(feedId){return"feed-lookup-"+feedId}function discover(feedUrl){var key=requestKey(feedUrl);if(inflight.requestInflight(key)){return cache.get(feedUrl)}return wpcom.undocumented().discoverFeed({url:feedUrl})}function feedLookup(feedUrl){var promiseForFeedId=cache.get(feedUrl);if(promiseForFeedId){return promiseForFeedId}promiseForFeedId=discover(feedUrl).then(function(response){var feed;if(!isEmpty(response.feeds)){feed=head(response.feeds);if(!isEmpty(feed.feed_ID)){return feed.feed_ID}}});cache.set(feedUrl,promiseForFeedId);return promiseForFeedId}module.exports=feedLookup},2605:function(module,exports,__webpack_require__){"use strict";var assign=__webpack_require__(34),Immutable=__webpack_require__(113),noop=__webpack_require__(38);var FeedPostStore=__webpack_require__(1763);function PostFetcher(options){assign(this,{onFetch:noop,onPostReceived:noop,onError:noop},options);this.postsToFetch=Immutable.OrderedSet();this.batchQueued=false}assign(PostFetcher.prototype,{add:function add(postKey){this.postsToFetch=this.postsToFetch.add(Immutable.fromJS(postKey));if(!this.batchQueued){this.batchQueued=setTimeout(this.run.bind(this),0)}},remove:function remove(postKey){this.postsToFetch=this.postsToFetch.delete(Immutable.fromJS(postKey))},run:function run(){var toFetch=this.postsToFetch;this.batchQueued=false;if(toFetch.size===0){return}toFetch.forEach(function(postKey){var _this=this;postKey=postKey.toJS();var post=FeedPostStore.get(postKey);if(post&&post._state!=="minimal"){throw new Error(post._state)}this.onFetch(postKey);this.makeRequest(postKey).then(function(data){_this.onPostReceived(postKey.blogId||postKey.feedId,postKey.postId,data)},function(err){_this.onError(err,postKey)})},this);this.postsToFetch=Immutable.OrderedSet()}});module.exports=PostFetcher},2606:function(module,exports,__webpack_require__){"use strict";var assign=__webpack_require__(34),debug=__webpack_require__(3)("calypso:feed-store:post-list-store"),filter=__webpack_require__(77),forEach=__webpack_require__(114),map=__webpack_require__(45),moment=__webpack_require__(4),noop=__webpack_require__(38),get=__webpack_require__(24),url=__webpack_require__(70);var Dispatcher=__webpack_require__(42),Emitter=__webpack_require__(36),FeedPostStore=__webpack_require__(1763),FeedStreamActions=__webpack_require__(1898),ActionTypes=__webpack_require__(1972).action,PollerPool=__webpack_require__(221),FeedSubscriptionStore=__webpack_require__(1768),XPostHelper=__webpack_require__(2357);
var FeedStream=function FeedStream(spec){if(!spec){throw new Error("must supply a feed stream spec")}if(!spec.id){throw new Error("missing id")}if(!spec.fetcher){throw new Error("missing fetcher")}if(!spec.keyMaker){throw new Error("must supply keyMaker")}this.id=spec.id;assign(this,{id:spec.id,postKeys:[],pendingPostKeys:[],postById:{},errors:[],fetcher:spec.fetcher,page:1,perPage:7,selectedIndex:-1,xPostedByURL:{},maxUpdates:40,gapFillCount:21,orderBy:"date",_isLastPage:false,_isFetchingNextPage:false,keyMaker:spec.keyMaker,onNextPageFetch:spec.onNextPageFetch||noop,onGapFetch:spec.onGapFetch||noop,onUpdateFetch:spec.onUpdateFetch||noop,dateProperty:spec.dateProperty||"date",poller:PollerPool.add(this,"pollForUpdates",{interval:60*1e3,leading:false,pauseWhenHidden:false}),startDate:spec.startDate})};assign(FeedStream.prototype,{destroy:function destroy(){PollerPool.remove(this.poller)},handlePayload:function handlePayload(payload){var action=payload&&payload.action;if(!action){return}if(action.id!==this.id){return}Dispatcher.waitFor([FeedPostStore.dispatchToken]);switch(action.type){case ActionTypes.RECEIVE_PAGE:this.receivePage(action.id,action.error,action.data);break;case ActionTypes.RECEIVE_UPDATES:this.receiveUpdates(action.id,action.error,action.data);break;case ActionTypes.SHOW_UPDATES:this.acceptUpdates();break;case ActionTypes.RECEIVE_GAP:this.receiveFeedGap(action.gap,action.error,action.data);break;case ActionTypes.FETCH_NEXT_PAGE:this.setIsFetchingNextPage(true);break;case ActionTypes.SELECT_ITEM:this.selectItem(action.selectedIndex);break;case ActionTypes.SELECT_NEXT_ITEM:this.selectNextItem(action.selectedIndex);break;case ActionTypes.SELECT_PREV_ITEM:this.selectPrevItem(action.selectedIndex);break}},get:function get(){return this.postKeys},getID:function getID(){return this.id},getAll:function getAll(){return map(this.postKeys,function(key){return key.isGap?key:FeedPostStore.get(key)})},getPage:function getPage(){return this.page},getPerPage:function getPerPage(){return this.perPage},getUpdateCount:function getUpdateCount(){return this.pendingPostKeys.length},getSelectedPost:function getSelectedPost(){if(this.selectedIndex>=0&&this.selectedIndex<this.postKeys.length){return this.postKeys[this.selectedIndex]}return null},getSelectedIndex:function getSelectedIndex(){return this.selectedIndex},isLastPage:function isLastPage(){return this._isLastPage},isFetchingNextPage:function isFetchingNextPage(){return this._isFetchingNextPage},_isValidPostOrGap:function _isValidPostOrGap(postKey){var post;if(postKey.isGap===true){return true}post=FeedPostStore.get(postKey);return post&&post._state!=="error"&&post._state!=="pending"&&post._state!=="minimal"},selectNextItem:function selectNextItem(selectedIndex){var nextIndex=selectedIndex+1;if(nextIndex>-1&&nextIndex<this.postKeys.length){if(this._isValidPostOrGap(this.postKeys[nextIndex])){this.selectedIndex=nextIndex;this.emit("change")}else{this.selectNextItem(nextIndex)}}},selectPrevItem:function selectPrevItem(selectedIndex){var nextIndex=selectedIndex-1;if(nextIndex>-1&&nextIndex<this.postKeys.length){if(this._isValidPostOrGap(this.postKeys[nextIndex])){this.selectedIndex=nextIndex;this.emit("change")}else{this.selectPrevItem(nextIndex)}}},selectItem:function selectItem(selectedIndex){this.selectNextItem(selectedIndex-1)},getLastItemWithDate:function getLastItemWithDate(){var i,key,date;i=this.postKeys.length-1;if(i===-1){return}do{key=this.postKeys[i];if(!key.isGap){date=FeedPostStore.get(key)[this.dateProperty]}--i}while(!date&&i!==-1);return date},getFirstItemWithDate:function getFirstItemWithDate(){var i,key,date;if(this.postKeys.length===0){return}i=0;do{key=this.postKeys[i];if(!key.isGap){date=FeedPostStore.get(key)[this.dateProperty]}++i}while(!date&&i<this.postKeys.length);return date},hasRecentError:function hasRecentError(errorType){var aMinuteAgo=Date.now()-60*1e3;return this.errors.some(function(error){return error.timestamp&&error.timestamp>aMinuteAgo&&(!errorType||errorType===error.error)})},setIsFetchingNextPage:function setIsFetchingNextPage(val){this._isFetchingNextPage=val;this.emit("change")},pollForUpdates:function pollForUpdates(){if(this.isFetchingUpdates){debug("already fetching, skip");return}if(!this.postKeys.length){debug("skipping poll because we have no posts");return}var mostRecentDate=this.getFirstItemWithDate(),params=void 0;if(!mostRecentDate){return}this.isFetchingUpdates=true;params={orderBy:this.orderBy,number:this.maxUpdates,before:moment().toISOString(),after:mostRecentDate};this.onUpdateFetch(params);debug("polling for updates");this.fetcher(params,function(error,data){debug("poll response received",error,data);this.isFetchingUpdates=false;FeedStreamActions.receiveUpdates(this.id,error,data)}.bind(this))},getSitesCrossPostedTo:function getSitesCrossPostedTo(postURL){return this.xPostedByURL[postURL]},_getPostFromMetadata:function _getPostFromMetadata(postWrapper){if(postWrapper&&get(postWrapper,"meta.data.discover_original_post")){return postWrapper.meta.data.discover_original_post}else if(postWrapper&&get(postWrapper,"meta.data.post")){return postWrapper.meta.data.post}else if(postWrapper.feed_ID||postWrapper.site_ID){return postWrapper}return null},_addXPost:function _addXPost(postURL,xPostedBy){if(this.xPostedByURL[postURL]){var sites=this.xPostedByURL[postURL];sites=sites.filter(function(site){return site.siteName!==xPostedBy.siteName&&site.siteURL!==xPostedBy.siteURL});sites.push(xPostedBy);this.xPostedByURL[postURL]=sites}else{this.xPostedByURL[postURL]=[xPostedBy]}},filterFollowedXPosts:function filterFollowedXPosts(posts){var _this=this;return posts.filter(function(postWrapper){var post=_this._getPostFromMetadata(postWrapper);if(post&&post.tags&&post.tags["p2-xpost"]){var xPostMetadata=XPostHelper.getXPostMetadata(post);if(!xPostMetadata.postURL){return false}var isFollowing=FeedSubscriptionStore.getIsFollowingBySiteUrl(xPostMetadata.siteURL);var siteName="+"+url.parse(post.site_URL).hostname.split(".")[0];var xPostedBy={siteURL:post.site_URL,siteName:siteName};_this._addXPost(xPostMetadata.postURL,xPostedBy);if(xPostMetadata.commentURL){_this._addXPost(xPostMetadata.commentURL,xPostedBy);return _this.xPostedByURL[xPostMetadata.commentURL].length===1}if(!isFollowing){return _this.xPostedByURL[xPostMetadata.postURL].length===1}return false}return true})},filterNewPosts:function filterNewPosts(posts){var postById=this.postById;posts=filter(posts,function(post){return!(post.ID in postById)});posts=this.filterFollowedXPosts(posts);return map(posts,this.keyMaker)},receivePage:function receivePage(id,error,data){var _this2=this;var posts,postKeys;if(id!==this.id){return}debug("receiving page in %s",this.id);this._isFetchingNextPage=false;if(error){debug("Error fetching posts from API:",error);error.timestamp=Date.now();this.errors.push(error);this.emit("change");return}posts=data&&data.posts;if(!posts){return}if(!posts.length){this._isLastPage=true;this.emit("change");return}postKeys=this.filterNewPosts(posts);if(postKeys.length){(function(){var postById=_this2.postById;forEach(postKeys,function(postKey){postById[postKey.postId]=true});_this2.postKeys=_this2.postKeys.concat(postKeys);_this2.page++;_this2.emit("change")})()}},receiveUpdates:function receiveUpdates(id,error,data){var postKeys;if(id!==this.id){return}if(error){return}if(data&&data.posts){postKeys=this.filterNewPosts(data.posts);if(postKeys.length>0){this.pendingPostKeys=postKeys;this.pendingDateAfter=moment(FeedPostStore.get(this.keyMaker(data.posts[data.posts.length-1]))[this.dateProperty]);this.emit("change")}}},acceptUpdates:function acceptUpdates(){if(this.pendingPostKeys.length===0){return}var postById=this.postById;forEach(this.pendingPostKeys,function(postKey){postById[postKey.postId]=true});var mostRecentPostDate=moment(FeedPostStore.get(this.postKeys[0])[this.dateProperty]);if(this.pendingDateAfter>mostRecentPostDate){this.pendingPostKeys.push({isGap:true,from:mostRecentPostDate,to:this.pendingDateAfter})}this.postKeys=this.pendingPostKeys.concat(this.postKeys);if(this.selectedIndex>-1){this.selectedIndex=-1}this.pendingPostKeys=[];this.pendingDateAfter=null;this.emit("change")},receiveFeedGap:function receiveFeedGap(gap,error,data){if(error){this.errors.push(error);this.emit("change");return}var posts=data&&data.posts;if(!posts){return}var indexOfGap=this.postKeys.indexOf(gap);if(indexOfGap===-1){debug("gap %o not found",gap);return}var beforeGap=this.postKeys.slice(0,indexOfGap),afterGap=this.postKeys.slice(indexOfGap+1),gapItems=this.filterNewPosts(posts),afterGapDate=moment(FeedPostStore.get(afterGap[0])[this.dateProperty]);if(posts.length===this.gapFillCount){if(moment(posts[posts.length-1][this.dateProperty])>afterGapDate){gapItems.push({isGap:true,from:afterGapDate,to:moment(posts[posts.length-1][this.dateProperty])})}}this.postKeys=beforeGap.concat(gapItems,afterGap);this.emit("change")}});Emitter(FeedStream.prototype);module.exports=FeedStream},2607:function(module,exports,__webpack_require__){"use strict";var assign=__webpack_require__(34),debug=__webpack_require__(3)("calypso:feed-store:post-list-store"),filter=__webpack_require__(77),forEach=__webpack_require__(114),map=__webpack_require__(45);var Dispatcher=__webpack_require__(42),Emitter=__webpack_require__(36),FeedPostStore=__webpack_require__(1763),ActionTypes=__webpack_require__(1972).action;var PagedStream=function PagedStream(spec){if(!spec){throw new Error("must supply a paged stream spec")}if(!spec.id){throw new Error("missing id")}if(!spec.fetcher){throw new Error("missing fetcher")}if(!spec.keyMaker){throw new Error("must supply keyMaker")}this.id=spec.id;assign(this,{id:spec.id,postKeys:[],pendingPostKeys:[],postById:{},errors:[],fetcher:spec.fetcher,page:1,perPage:spec.perPage||10,query:spec.query,selectedIndex:-1,orderBy:"date",_isLastPage:false,_isFetchingNextPage:false,keyMaker:spec.keyMaker})};assign(PagedStream.prototype,{handlePayload:function handlePayload(payload){var action=payload&&payload.action;if(!action){return}if(action.id!==this.id){return}Dispatcher.waitFor([FeedPostStore.dispatchToken]);switch(action.type){case ActionTypes.RECEIVE_PAGE:this.receivePage(action.id,action.error,action.data);break;case ActionTypes.FETCH_NEXT_PAGE:this.setIsFetchingNextPage(true);break;case ActionTypes.SELECT_ITEM:this.selectItem(action.selectedIndex);break;case ActionTypes.SELECT_NEXT_ITEM:this.selectNextItem(action.selectedIndex);break;case ActionTypes.SELECT_PREV_ITEM:this.selectPrevItem(action.selectedIndex);break;case ActionTypes.CHANGE_QUERY:this.resetQuery(action.query);break}},get:function get(){return this.postKeys},getID:function getID(){return this.id},getAll:function getAll(){return map(this.postKeys,function(key){return FeedPostStore.get(key)})},getPage:function getPage(){return this.page},getPerPage:function getPerPage(){return this.perPage},getUpdateCount:function getUpdateCount(){return 0},getSelectedPost:function getSelectedPost(){if(this.selectedIndex>=0&&this.selectedIndex<this.postKeys.length){return this.postKeys[this.selectedIndex]}return null},getSelectedIndex:function getSelectedIndex(){return this.selectedIndex},isLastPage:function isLastPage(){return this._isLastPage},isFetchingNextPage:function isFetchingNextPage(){return this._isFetchingNextPage},_isValidPostOrGap:function _isValidPostOrGap(postKey){var post=FeedPostStore.get(postKey);return post&&post._state!=="error"&&post._state!=="pending"&&post._state!=="minimal"},selectNextItem:function selectNextItem(selectedIndex){var nextIndex=selectedIndex+1;if(nextIndex>-1&&nextIndex<this.postKeys.length){if(this._isValidPostOrGap(this.postKeys[nextIndex])){this.selectedIndex=nextIndex;this.emit("change")}else{this.selectNextItem(nextIndex)}}},selectPrevItem:function selectPrevItem(selectedIndex){var nextIndex=selectedIndex-1;if(nextIndex>-1&&nextIndex<this.postKeys.length){if(this._isValidPostOrGap(this.postKeys[nextIndex])){this.selectedIndex=nextIndex;this.emit("change")}else{this.selectPrevItem(nextIndex)}}},selectItem:function selectItem(selectedIndex){this.selectNextItem(selectedIndex-1)},onNextPageFetch:function onNextPageFetch(params){params.offset=(this.page-1)*this.perPage;params.before=this.startDate||undefined;params.after=undefined;params.number=this.perPage},getLastItemWithDate:function getLastItemWithDate(){return null},getFirstItemWithDate:function getFirstItemWithDate(){return null},hasRecentError:function hasRecentError(errorType){var aMinuteAgo=Date.now()-60*1e3;return this.errors.some(function(error){return error.timestamp&&error.timestamp>aMinuteAgo&&(!errorType||errorType===error.error)})},setIsFetchingNextPage:function setIsFetchingNextPage(val){this._isFetchingNextPage=val;this.emit("change")},filterNewPosts:function filterNewPosts(posts){var postById=this.postById;posts=filter(posts,function(post){return!(post.ID in postById)});return map(posts,this.keyMaker)},getSitesCrossPostedTo:function getSitesCrossPostedTo(){return null},receivePage:function receivePage(id,error,data){var _this=this;var posts,postKeys;if(id!==this.id){return}debug("receiving page in %s",this.id);this._isFetchingNextPage=false;if(error){debug("Error fetching posts from API:",error);error.timestamp=Date.now();this.errors.push(error);this.emit("change");return}posts=data&&data.posts;if(!posts){return}if(!posts.length){this._isLastPage=true;this.emit("change");return}postKeys=this.filterNewPosts(posts);if(postKeys.length){(function(){var postById=_this.postById;forEach(postKeys,function(postKey){postById[postKey.postId]=true});_this.postKeys=_this.postKeys.concat(postKeys);_this.page++;_this.emit("change")})()}}});Emitter(PagedStream.prototype);module.exports=PagedStream},2617:function(module,exports,__webpack_require__){"use strict";var Dispatcher=__webpack_require__(42),scrollStore=__webpack_require__(2246),positionsStore=__webpack_require__(2245),isEqual=__webpack_require__(98),throttle=__webpack_require__(388);var _lastCalledPositions=null,_lastCalledScroll=null;var THROTTLE_INTERVAL_MS=1e3;var THROTTLE_OPTIONS={leading:false};module.exports={storePositions:throttle(function(url,positions){if(!_lastCalledPositions){setTimeout(function(){var storedPositions=positionsStore.get(_lastCalledPositions.url);if(!isEqual(_lastCalledPositions.positions,storedPositions)){Dispatcher.handleViewAction({type:"INFINITE_LIST_POSITION_CHANGED",url:_lastCalledPositions.url,positions:_lastCalledPositions.positions})}_lastCalledPositions=null},0)}_lastCalledPositions={url:url,positions:positions}},THROTTLE_INTERVAL_MS,THROTTLE_OPTIONS),storeScroll:throttle(function(url,scrollPosition){if(!_lastCalledScroll){setTimeout(function(){var storedScroll=scrollStore.get(_lastCalledScroll.url);if(_lastCalledScroll.scrollPosition!==storedScroll){Dispatcher.handleViewAction({type:"SCROLL_CHANGED",url:_lastCalledScroll.url,scrollPosition:_lastCalledScroll.scrollPosition})}_lastCalledScroll=null},0)}_lastCalledScroll={url:url,scrollPosition:scrollPosition}},THROTTLE_INTERVAL_MS,THROTTLE_OPTIONS)}},2641:function(module,exports,__webpack_require__){"use strict";var _assign=__webpack_require__(5);var _assign2=_interopRequireDefault(_assign);var _ruleDecodeEntities=__webpack_require__(787);var _ruleDecodeEntities2=_interopRequireDefault(_ruleDecodeEntities);var _ruleStripHtml=__webpack_require__(789);var _ruleStripHtml2=_interopRequireDefault(_ruleStripHtml);var _rulePreventWidows=__webpack_require__(2262);var _rulePreventWidows2=_interopRequireDefault(_rulePreventWidows);var _ruleFirstPassCanonicalImage=__webpack_require__(788);var _ruleFirstPassCanonicalImage2=_interopRequireDefault(_ruleFirstPassCanonicalImage);var _ruleMakeSiteIdSafeForApi=__webpack_require__(2259);var _ruleMakeSiteIdSafeForApi2=_interopRequireDefault(_ruleMakeSiteIdSafeForApi);var _rulePickPrimaryTag=__webpack_require__(2261);var _rulePickPrimaryTag2=_interopRequireDefault(_rulePickPrimaryTag);var _ruleSafeImageProperties=__webpack_require__(2263);var _ruleSafeImageProperties2=_interopRequireDefault(_ruleSafeImageProperties);var _ruleWaitForImagesToLoad=__webpack_require__(2264);var _ruleWaitForImagesToLoad2=_interopRequireDefault(_ruleWaitForImagesToLoad);var _ruleKeepValidImages=__webpack_require__(2258);var _ruleKeepValidImages2=_interopRequireDefault(_ruleKeepValidImages);var _rulePickCanonicalImage=__webpack_require__(2260);var _rulePickCanonicalImage2=_interopRequireDefault(_rulePickCanonicalImage);var _ruleCreateBetterExcerpt=__webpack_require__(786);var _ruleCreateBetterExcerpt2=_interopRequireDefault(_ruleCreateBetterExcerpt);var _ruleWithContentDom=__webpack_require__(2265);var _ruleWithContentDom2=_interopRequireDefault(_ruleWithContentDom);var _ruleContentRemoveStyles=__webpack_require__(2255);var _ruleContentRemoveStyles2=_interopRequireDefault(_ruleContentRemoveStyles);var _ruleContentSafeImages=__webpack_require__(2256);var _ruleContentSafeImages2=_interopRequireDefault(_ruleContentSafeImages);var _ruleContentMakeEmbedsSecure=__webpack_require__(2254);var _ruleContentMakeEmbedsSecure2=_interopRequireDefault(_ruleContentMakeEmbedsSecure);var _ruleContentWordCount=__webpack_require__(2257);var _ruleContentWordCount2=_interopRequireDefault(_ruleContentWordCount);var _ruleContentDetectEmbeds=__webpack_require__(2251);var _ruleContentDetectEmbeds2=_interopRequireDefault(_ruleContentDetectEmbeds);var _ruleContentDisableAutoplay=__webpack_require__(2253);var _ruleContentDetectPolls=__webpack_require__(2252);var _ruleContentDetectPolls2=_interopRequireDefault(_ruleContentDetectPolls);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var async=__webpack_require__(751),debug=__webpack_require__(3)("calypso:post-normalizer");function debugForPost(post){return function(msg){debug(post.global_ID+": "+msg)}}function normalizePost(post,transforms,callback){if(!callback){throw new Error("must supply a callback")}if(!post||!transforms){debug("no post or no transform");callback(null,post);return}var normalizedPost=(0,_assign2.default)({},post),postDebug=debugForPost(post);postDebug("running transforms");async.eachSeries(transforms,function(transform,transformCallback){postDebug("running transform "+(transform.name||"anonymous"));transform(normalizedPost,transformCallback)},function(err){postDebug("transforms complete");if(err){callback(err)}else{callback(null,normalizedPost)}})}function wrapSync(fn){return function wrapped(post,callback){fn(post);callback()}}normalizePost.decodeEntities=wrapSync(_ruleDecodeEntities2.default);normalizePost.stripHTML=wrapSync(_ruleStripHtml2.default);normalizePost.preventWidows=wrapSync(_rulePreventWidows2.default);normalizePost.firstPassCanonicalImage=wrapSync(_ruleFirstPassCanonicalImage2.default);normalizePost.makeSiteIDSafeForAPI=wrapSync(_ruleMakeSiteIdSafeForApi2.default);normalizePost.pickPrimaryTag=wrapSync(_rulePickPrimaryTag2.default);normalizePost.safeImageProperties=function(maxWidth){return wrapSync((0,_ruleSafeImageProperties2.default)(maxWidth))};normalizePost.waitForImagesToLoad=function waitForImagesToLoadAdapter(post,callback){(0,_ruleWaitForImagesToLoad2.default)(post).then(function(){callback()},function(err){callback(err)})};normalizePost.keepValidImages=function(minWidth,minHeight){return wrapSync((0,_ruleKeepValidImages2.default)(minWidth,minHeight))};normalizePost.pickCanonicalImage=wrapSync(_rulePickCanonicalImage2.default);normalizePost.createBetterExcerpt=wrapSync(_ruleCreateBetterExcerpt2.default);normalizePost.withContentDOM=function(transforms){return function(post,callback){(0,_ruleWithContentDom2.default)(transforms)(post);callback()}};normalizePost.content={removeStyles:_ruleContentRemoveStyles2.default,safeContentImages:_ruleContentSafeImages2.default,makeEmbedsSecure:_ruleContentMakeEmbedsSecure2.default,wordCountAndReadingTime:_ruleContentWordCount2.default,detectEmbeds:_ruleContentDetectEmbeds2.default,disableAutoPlayOnMedia:_ruleContentDisableAutoplay.disableAutoPlayOnMedia,disableAutoPlayOnEmbeds:_ruleContentDisableAutoplay.disableAutoPlayOnEmbeds,detectPolls:_ruleContentDetectPolls2.default};module.exports=normalizePost},2649:function(module,exports,__webpack_require__){"use strict";var _dispatcher=__webpack_require__(42);var _dispatcher2=_interopRequireDefault(_dispatcher);var _wp=__webpack_require__(28);var _wp2=_interopRequireDefault(_wp);var _lists=__webpack_require__(1905);var _lists2=_interopRequireDefault(_lists);var _subscriptions=__webpack_require__(2271);var _subscriptions2=_interopRequireDefault(_subscriptions);var _constants=__webpack_require__(2270);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var fetchingLists={};var ReaderListActions={fetchSubscriptions:function fetchSubscriptions(){if(_subscriptions2.default.isFetching()){return}_subscriptions2.default.setIsFetching(true);_wp2.default.undocumented().readLists(function(error,data){_subscriptions2.default.setIsFetching(false);_dispatcher2.default.handleServerAction({type:_constants.action.RECEIVE_READER_LISTS,data:data,error:error})})},follow:function follow(owner,slug){var query={owner:owner,slug:slug};_dispatcher2.default.handleViewAction({type:_constants.action.FOLLOW_LIST,data:query});_wp2.default.undocumented().followList(query,function(error,data){if(error||!(data&&data.following)){_dispatcher2.default.handleServerAction({type:_constants.action.RECEIVE_FOLLOW_LIST_ERROR,data:{owner:query.owner,slug:query.slug,error:error,following:data&&data.following}});return}_dispatcher2.default.handleServerAction({type:_constants.action.RECEIVE_FOLLOW_LIST,data:{owner:query.owner,slug:query.slug,title:data.title},error:error})})},unfollow:function unfollow(owner,slug){var query={owner:owner,slug:slug};_dispatcher2.default.handleViewAction({type:_constants.action.UNFOLLOW_LIST,data:query});_wp2.default.undocumented().unfollowList(query,function(error,data){if(error||data&&data.following){_dispatcher2.default.handleServerAction({type:_constants.action.RECEIVE_UNFOLLOW_LIST_ERROR,data:{owner:query.owner,slug:query.slug,error:error,following:data&&data.following}});return}_dispatcher2.default.handleServerAction({type:_constants.action.RECEIVE_UNFOLLOW_LIST,data:{owner:query.owner,slug:query.slug,title:data.title},error:error})})},fetchList:function fetchList(owner,slug){var key=owner+"-"+slug;if(fetchingLists[key]){return}fetchingLists[key]=true;_lists2.default.setIsFetching(true);_wp2.default.undocumented().readList({owner:owner,slug:slug},function(error,data){delete fetchingLists[key];_lists2.default.setIsFetching(false);_dispatcher2.default.handleServerAction({type:_constants.action.RECEIVE_READER_LIST,data:data,error:error})})},create:function create(title){if(!title){throw new Error("List title is required")}_dispatcher2.default.handleViewAction({type:_constants.action.CREATE_READER_LIST,data:{title:title}});_wp2.default.undocumented().readListsNew(title,function(error,data){_dispatcher2.default.handleServerAction({type:_constants.action.RECEIVE_CREATE_READER_LIST,data:data,error:error})})},update:function update(params){if(!params.owner||!params.slug||!params.title){throw new Error("List owner, slug and title are required")}_dispatcher2.default.handleViewAction({type:_constants.action.UPDATE_READER_LIST,data:params});_wp2.default.undocumented().readListsUpdate(params,function(error,data){_dispatcher2.default.handleServerAction({type:_constants.action.RECEIVE_UPDATE_READER_LIST,data:data,error:error})})},dismissNotice:function dismissNotice(listId){if(!listId){throw new Error("List ID is required")}_dispatcher2.default.handleViewAction({type:_constants.action.DISMISS_READER_LIST_NOTICE,listId:listId})}};module.exports=ReaderListActions},2651:function(module,exports,__webpack_require__){"use strict";var Dispatcher=__webpack_require__(42),wpcom=__webpack_require__(28),RECEIVE_TEAMS=__webpack_require__(2082).action.RECEIVE_TEAMS;var isFetching=false;module.exports={fetch:function fetch(){if(isFetching){return}var batch=wpcom.batch();batch.add("/read/tags");batch.add("/read/lists");batch.add("/read/teams");isFetching=true;batch.run({apiVersion:"1.2"},function(error,data){if(error){Dispatcher.handleServerAction({type:"RECEIVE_READER_TAG_SUBSCRIPTIONS",data:null,error:error});Dispatcher.handleServerAction({type:"RECEIVE_READER_LISTS",data:null,error:error});Dispatcher.handleServerAction({type:RECEIVE_TEAMS,data:null,error:error});return}function checkForBatchErrorAndDispatch(actionType,key){var response=data[key];var batchError=undefined;if(response&&response.errors){batchError=response.errors;response=undefined}Dispatcher.handleServerAction({type:actionType,data:response,error:batchError})}checkForBatchErrorAndDispatch("RECEIVE_READER_TAG_SUBSCRIPTIONS","/read/tags");checkForBatchErrorAndDispatch("RECEIVE_READER_LISTS","/read/lists");checkForBatchErrorAndDispatch("RECEIVE_TEAMS","/read/teams");isFetching=false})}}},2652:function(module,exports,__webpack_require__){"use strict";var Dispatcher=__webpack_require__(42),some=__webpack_require__(63),assign=__webpack_require__(34),config=__webpack_require__(12);var emitter=__webpack_require__(36),ActionTypes=__webpack_require__(2082).action,ErrorTypes=__webpack_require__(2082).error;var teams=null,errors=[];var TeamStore={get:function get(){return teams},hasRecentError:function hasRecentError(){var recentTimeIntervalSeconds=120,dateNow=Date.now();return some(errors,function(error){return dateNow-error.timestamp<recentTimeIntervalSeconds*1e3})}};function receiveTeamsResponse(action){if(action.error){errors.push({error:action.error,errorType:ErrorTypes.UNABLE_TO_RECEIVE_TEAMS,timestamp:Date.now()});return}if(!action.data||!action.data.teams){errors.push({error:"invalid format",errorType:ErrorTypes.UNABLE_TO_RECEIVE_TEAMS,timestamp:Date.now()});return}teams=action.data.teams;TeamStore.emit("change")}if(config("env")==="development"){assign(TeamStore,{_reset:function _reset(){teams=null;errors=[]}})}emitter(TeamStore);TeamStore.dispatchToken=Dispatcher.register(function(payload){var action=payload.action;if(!action){return}switch(action.type){case ActionTypes.RECEIVE_TEAMS:receiveTeamsResponse(action);break}});module.exports=TeamStore},2665:function(module,exports,__webpack_require__){"use strict";var Emitter=__webpack_require__(36),wrap=__webpack_require__(3527),debug=__webpack_require__(3)("calypso:ticker");var ticker={};Emitter(ticker);ticker.on=wrap(ticker.on,function(func,type,callback){func.call(this,type,callback);ticker._start();if(!ticker._listening){if(document){debug("listening for vis change");document.addEventListener("visibilitychange",ticker.handleVisibilityChange,false)}ticker._listening=true}});ticker._start=function(){if(ticker.listeners("tick").length===0){debug("no listeners, abort start");return}debug("%d listeners active",ticker.listeners("tick").length);if(!ticker.interval){debug("starting interval");ticker.interval=setInterval(ticker.tick,1e4)}};ticker._stop=function(){if(ticker.interval){debug("killing interval");clearInterval(ticker.interval);ticker.interval=null}};ticker.tick=function(){debug("tick");ticker.emit("tick")};ticker.off=wrap(ticker.off,function(func,type,callback){func.call(this,type,callback);if(this.listeners("tick").length===0&&this.interval){ticker._stop();if(ticker._listening){if(document){debug("killing vis listener");document.removeEventListener("visibilitychange",ticker.handleVisibilityChange,false)}ticker._listening=false}}});ticker.handleVisibilityChange=function(){debug("viz change");if(document.hidden){debug("stopping");ticker._stop()}else{debug("restarting");ticker._start()}};ticker.setMaxListeners(100);module.exports=ticker},3177:function(module,exports,__webpack_require__){"use strict";var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _i18nCalypso=__webpack_require__(11);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _followButton=__webpack_require__(1723);var _followButton2=_interopRequireDefault(_followButton);var _helper=__webpack_require__(1674);var _stats=__webpack_require__(2348);var discoverStats=_interopRequireWildcard(_stats);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var DiscoverPostAttribution=function(_React$Component){(0,_inherits3.default)(DiscoverPostAttribution,_React$Component);function DiscoverPostAttribution(props){(0,_classCallCheck3.default)(this,DiscoverPostAttribution);var _this=(0,_possibleConstructorReturn3.default)(this,(DiscoverPostAttribution.__proto__||(0,_getPrototypeOf2.default)(DiscoverPostAttribution)).call(this,props));["recordAuthorClick","recordSiteClick","recordFollowToggle"].forEach(function(method){return _this[method]=_this[method].bind(_this)});return _this}(0,_createClass3.default)(DiscoverPostAttribution,[{key:"recordAuthorClick",value:function recordAuthorClick(){discoverStats.recordAuthorClick(this.props.attribution.author_url)}},{key:"recordSiteClick",value:function recordSiteClick(){discoverStats.recordSiteClick(this.props.siteUrl)}},{key:"recordFollowToggle",value:function recordFollowToggle(isFollowing){discoverStats.recordFollowToggle(isFollowing,this.props.siteUrl)}},{key:"render",value:function render(){var attribution=this.props.attribution;var classes=(0,_classnames2.default)("discover-attribution is-post",{"is-missing-avatar":!attribution.avatar_url});var siteLinkProps=(0,_helper.getLinkProps)(this.props.siteUrl);var siteClasses=(0,_classnames2.default)("discover-attribution__blog ignore-click");return _react2.default.createElement("div",{className:classes},attribution.avatar_url?_react2.default.createElement("img",{className:"gravatar",src:encodeURI(attribution.avatar_url),alt:"Avatar",width:"20",height:"20"}):_react2.default.createElement(_gridicon2.default,{icon:"arrow-right"}),_react2.default.createElement("span",{className:"discover-attribution__text"},(0,_i18nCalypso.translate)("Originally posted by"),"",_react2.default.createElement("a",{className:"discover-attribution__author",target:"_blank",rel:"external noopener noreferrer",onClick:this.recordAuthorClick,href:encodeURI(attribution.author_url)},attribution.author_name),"",(0,_i18nCalypso.translate)("on"),"",_react2.default.createElement("a",(0,_extends3.default)({},siteLinkProps,{className:siteClasses,onClick:this.recordSiteClick,href:encodeURI(this.props.siteUrl)}),attribution.blog_name),!!this.props.followUrl?_react2.default.createElement(_followButton2.default,{siteUrl:this.props.followUrl,iconSize:20,onFollowToggle:this.recordFollowToggle}):null))}}]);return DiscoverPostAttribution}(_react2.default.Component);DiscoverPostAttribution.propTypes={attribution:_react2.default.PropTypes.shape({author_name:_react2.default.PropTypes.string.isRequired,author_url:_react2.default.PropTypes.string.isRequired,blog_name:_react2.default.PropTypes.string.isRequired,blog_url:_react2.default.PropTypes.string.isRequired,avatar_url:_react2.default.PropTypes.string}).isRequired,siteUrl:_react2.default.PropTypes.string.isRequired,
followUrl:_react2.default.PropTypes.string.isRequired};module.exports=DiscoverPostAttribution},3178:function(module,exports,__webpack_require__){"use strict";var _percentageRegex=__webpack_require__(3533);var _percentageRegex2=_interopRequireDefault(_percentageRegex);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var percentageRegex=(0,_percentageRegex2.default)({exact:true});var isPercentage=function isPercentage(val){return percentageRegex.test(val)};var embedsConfig={default:{sizingFunction:function defaultEmbedSizingFunction(embed,availableWidth){var aspectRatio=embed.aspectRatio;var width=embed.width;var height=embed.height;if(!isNaN(aspectRatio)){width=availableWidth;height=availableWidth/aspectRatio}if(isPercentage(width)){width=availableWidth*(parseInt(width,10)/100)}if(isPercentage(height)){height=width*(parseInt(height,10)/100)}return{width:(width|0)+"px",height:(height|0)+"px"}}},spotify:{sizingFunction:function spotifyEmbedSizingFunction(embed,availableWidth){var height;if(embed.aspectRatio){height=Math.min(availableWidth/embed.aspectRatio,availableWidth+80)}else{height=availableWidth+80}return{width:availableWidth+"px",height:height+"px"}},urlRegex:/\/\/embed.spotify.com/},soundcloud:{sizingFunction:function soundcloudEmbedSizingFunction(embed,availableWidth){var aspectRatio=embed.aspectRatio||1,height="100%";if(embed.iframe.indexOf("visual=true")>-1){height=Math.floor(availableWidth/aspectRatio)+"px"}return{width:availableWidth+"px",height:height}},urlRegex:/\/\/w\.soundcloud\.com\/player/}};function extractUrlFromIframe(iframeHtml){var urlRegex=new RegExp('src="([^"]+)"'),res=urlRegex.exec(iframeHtml);return res.length>1?res[1]:null}function resolveEmbedConfig(embed){var embedType,url;if(embedsConfig.hasOwnProperty(embed.type)){return embedsConfig[embed.type]}url=extractUrlFromIframe(embed.iframe);if(url){for(embedType in embedsConfig){if(embedsConfig.hasOwnProperty(embedType)&&embedsConfig[embedType].urlRegex){if(url.match(embedsConfig[embedType].urlRegex)){return embedsConfig[embedType]}}}}return embedsConfig.default}module.exports={getEmbedSizingFunction:function getEmbedSizingFunction(embed){var embedConfig=resolveEmbedConfig(embed);return embedConfig.sizingFunction.bind(embedConfig,embed)}}},3179:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1);var EmptyContent=__webpack_require__(207),stats=__webpack_require__(1643),discoverHelper=__webpack_require__(1674);var FeedEmptyContent=React.createClass({displayName:"FeedEmptyContent",shouldComponentUpdate:function shouldComponentUpdate(){return false},recordAction:function recordAction(){stats.recordAction("clicked_discover_on_empty");stats.recordGaEvent("Clicked Discover on EmptyContent");stats.recordTrack("calypso_reader_discover_on_empty_feed_clicked")},recordSecondaryAction:function recordSecondaryAction(){stats.recordAction("clicked_recommendations_on_empty");stats.recordGaEvent("Clicked Recommendations on EmptyContent");stats.recordTrack("calypso_reader_recommendations_on_empty_feed_clicked")},render:function render(){var action=discoverHelper.isDiscoverEnabled()?React.createElement("a",{className:"empty-content__action button is-primary",onClick:this.recordAction,href:"/discover"},this.translate("Explore Discover")):null,secondaryAction=React.createElement("a",{className:"empty-content__action button",onClick:this.recordSecondaryAction,href:"/recommendations"},this.translate("Get recommendations on who to follow"));return React.createElement(EmptyContent,{title:this.translate("No recent posts"),line:this.translate("This site has not posted anything recently."),action:action,secondaryAction:secondaryAction,illustration:"/calypso/images/drake/drake-empty-results.svg",illustrationWidth:500})}});module.exports=FeedEmptyContent},3180:function(module,exports,__webpack_require__){"use strict";var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);var _keys=__webpack_require__(39);var _keys2=_interopRequireDefault(_keys);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var React=__webpack_require__(1),url=__webpack_require__(70);var EmptyContent=__webpack_require__(3179),DocumentHead=__webpack_require__(721),Stream=__webpack_require__(1753),FeedHeader=__webpack_require__(2349),FeedStore=__webpack_require__(1750),FeedStoreActions=__webpack_require__(1897),FeedStoreState=__webpack_require__(1749).state,FeedError=__webpack_require__(2002),HeaderBack=__webpack_require__(1918),SiteStore=__webpack_require__(1711),SiteState=__webpack_require__(1738).state;var FeedStream=React.createClass({displayName:"FeedStream",getDefaultProps:function getDefaultProps(){return{showBack:true}},getInitialState:function getInitialState(){var feed=this.getFeed(),site=this.getSite(feed),title=this.getTitle(feed,site);return{title:title,feed:feed,site:site}},componentDidMount:function componentDidMount(){FeedStore.on("change",this.updateState);SiteStore.on("change",this.updateState)},componentWillUnmount:function componentWillUnmount(){FeedStore.off("change",this.updateState);SiteStore.off("change",this.updateState)},componentWillReceiveProps:function componentWillReceiveProps(nextProps){if(nextProps.feedId!==this.props.feedId){this.updateState()}},getTitle:function getTitle(feed,site){var title;if(!feed&&!site){return this.translate("Loading Feed")}if(feed.state===FeedStoreState.ERROR){title=this.translate("Error fetching feed")}else if(feed.state===FeedStoreState.COMPLETE){title=feed.name}if(!title&&site){title=site.get("name")}if(!title&&feed){title=feed.URL||feed.feed_URL;if(title){title=url.parse(title).hostname}}if(!title&&site){title=site.get("URL");if(title){title=url.parse(title).hostname}}if(!title){title=this.translate("Loading Feed")}return title},getFeed:function getFeed(){var feed=FeedStore.get(this.props.feedId);if(!feed){FeedStoreActions.fetch(this.props.feedId)}return feed},getSite:function getSite(){var feed=FeedStore.get(this.props.feedId),site;if(feed&&feed.blog_ID){site=SiteStore.get(feed.blog_ID);if(site&&site.get("state")!==SiteState.COMPLETE){site=null}}return site},updateState:function updateState(){var feed=this.getFeed(),site=this.getSite(),title=this.getTitle(feed,site),newState={};if(feed!==this.state.feed){newState.feed=feed}if(title!==this.state.title){newState.title=title}if(site&&site!==this.state.site){newState.site=site}if((0,_keys2.default)(newState).length>0){this.setState(newState)}},render:function render(){var feed=FeedStore.get(this.props.feedId),emptyContent=React.createElement(EmptyContent,null);if(feed&&feed.state===FeedStoreState.ERROR){return React.createElement(FeedError,{sidebarTitle:this.state.title})}return React.createElement(Stream,(0,_extends3.default)({},this.props,{listName:this.state.title,emptyContent:emptyContent,showPostHeader:false}),React.createElement(DocumentHead,{title:this.translate("%s  Reader",{args:this.state.title})}),this.props.showBack&&React.createElement(HeaderBack,null),React.createElement(FeedHeader,{feed:feed,site:this.state.site}))}});module.exports=FeedStream},3196:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1),classnames=__webpack_require__(10);var FeedStreamStoreActions=__webpack_require__(1898),stats=__webpack_require__(1643);var Gap=React.createClass({displayName:"Gap",propTypes:{gap:React.PropTypes.object.isRequired,store:React.PropTypes.object.isRequired,selected:React.PropTypes.bool},getInitialState:function getInitialState(){return{isFilling:false}},render:function render(){var classes=classnames({"reader-list-gap":true,"is-filling":this.state.isFilling,"is-selected":this.props.selected});return React.createElement("div",{className:classes,onTouchTap:this.handleClick},React.createElement("button",{type:"button",className:"button reader-list-gap__button"},this.translate("Load More Posts")))},handleClick:function handleClick(){FeedStreamStoreActions.fillGap(this.props.store.id,this.props.gap);this.setState({isFilling:true});stats.recordAction("fill_gap");stats.recordGaEvent("Clicked Fill Gap");stats.recordTrack("calypso_reader_filled_gap",{stream:this.props.store.id})}});module.exports=Gap},3206:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _noop=__webpack_require__(38);var _noop2=_interopRequireDefault(_noop);var _site=__webpack_require__(279);var _site2=_interopRequireDefault(_site);var _followButton=__webpack_require__(1723);var _followButton2=_interopRequireDefault(_followButton);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var PostHeader=function PostHeader(_ref){var site=_ref.site;var siteUrl=_ref.siteUrl;var showFollow=_ref.showFollow;var onSiteSelect=_ref.onSiteSelect;var onSiteClick=_ref.onSiteClick;return _react2.default.createElement("div",{className:"reader__post-header"},showFollow?_react2.default.createElement(_followButton2.default,{siteUrl:siteUrl}):null,_react2.default.createElement(_site2.default,{site:site,href:siteUrl,onSelect:onSiteSelect,onClick:onSiteClick}))};PostHeader.propTypes={site:_react2.default.PropTypes.object,siteUrl:_react2.default.PropTypes.string,showFollow:_react2.default.PropTypes.bool,onSiteSelect:_react2.default.PropTypes.func,onSiteClick:_react2.default.PropTypes.func};PostHeader.defaultProps={showFollow:false,onSiteSelect:_noop2.default,onSiteClick:_noop2.default};exports.default=PostHeader;module.exports=exports["default"]},3207:function(module,exports,__webpack_require__){"use strict";var ReactDom=__webpack_require__(44),React=__webpack_require__(1),PureRenderMixin=__webpack_require__(111),resizeImageUrl=__webpack_require__(1769),domScrollIntoView=__webpack_require__(2190),ReactCSSTransitionGroup=__webpack_require__(736);var stats=__webpack_require__(1643),viewport=__webpack_require__(92);var PostImages=React.createClass({displayName:"PostImages",getInitialState:function getInitialState(){return{viewing:false,visibleIndex:0}},_isInput:function _isInput(element){return["INPUT","TEXTAREA"].indexOf(element.nodeName)>-1},handleKeyDown:function handleKeyDown(event){var keyCodes=[27,37,39],nextIndex;if(!this._isInput(event.target)&&keyCodes.indexOf(event.keyCode)>-1&&viewport.isDesktop()){switch(event.keyCode){case 27:this.toggleGallery(event);break;case 37:nextIndex=(this.state.visibleIndex-1+this.props.postImages.length)%this.props.postImages.length;this.scrollToImage(nextIndex);break;case 39:nextIndex=(this.state.visibleIndex+1)%this.props.postImages.length;this.scrollToImage(nextIndex);break}}},componentDidUpdate:function componentDidUpdate(prevProps,prevState){if(this.state.viewing!==prevState.viewing){if(this.state.viewing){if(viewport.isDesktop()){window.addEventListener("keydown",this.handleKeyDown)}}else{window.removeEventListener("keydown",this.handleKeyDown)}}},componentWillUnmount:function componentWillUnmount(){window.removeEventListener("keydown",this.handleKeyDown)},scrollToImage:function scrollToImage(nextIndex){this.setState({visibleIndex:nextIndex});var container=ReactDom.findDOMNode(this._fullListContainer);var images=ReactDom.findDOMNode(this._fullList).children;domScrollIntoView(images[nextIndex],container,{alignWithLeft:true})},toggleGallery:function toggleGallery(event){if(event.defaultPrevented){return}event.preventDefault();var newState=!this.state.viewing;stats.recordAction(newState?"open_gallery":"close_gallery");stats.recordGaEvent(newState?"Clicked Open Gallery":"Clicked Close Gallery");stats.recordTrack("calypso_reader_post_gallery_"+(newState?"opened":"closed"),{image_count:this.props.postImages&&this.props.postImages.length});this.setState({viewing:newState});document.documentElement.classList.toggle("reader-gallery-open")},ignoreClick:function ignoreClick(event){event.preventDefault()},render:function render(){var _this=this;var images=this.props.postImages,count=images.length,containerClasses=["reader-post-images","ignore-click"],fullList;if(count<2){return null}if(this.state.viewing){fullList=images.map(function(image,index){return React.createElement("li",{key:"full-image-"+index,className:"reader-post-images__full-image"},React.createElement("img",{src:resizeImageUrl(image.src,{h:800,w:800}),onClick:this.ignoreClick}))},this)}if(this.state.viewing){containerClasses.push("is-viewing")}containerClasses=containerClasses.join(" ");return React.createElement("div",{className:containerClasses,onClick:this.toggleGallery},React.createElement(PostImageThumbList,{postImages:images}),React.createElement("span",{className:"reader-post-images__label"},this.translate("View Gallery")),React.createElement("span",{className:"reader-post-images__count"},this.translate("%(count)d image","%(count)d images",{count:count,args:{count:count}})),React.createElement("div",{className:"reader-post-images__full-list",ref:function ref(c){return _this._fullListContainer=c}},React.createElement("span",{className:"reader-post-images__close"},this.translate("Close")),React.createElement(ReactCSSTransitionGroup,{ref:function ref(c){return _this._fullList=c},component:"ol",transitionEnterTimeout:200,transitionLeaveTimeout:200,transitionName:"gallery-image",transitionEnter:true,transitionLeave:true},fullList)))}});var PostImageThumbList=React.createClass({displayName:"PostImageThumbList",mixins:[PureRenderMixin],render:function render(){var images=this.props.postImages,thumbList=images.map(function(image,index){return React.createElement("li",{key:"thumb-image-"+index,className:"reader-post-images__image"},React.createElement("img",{src:resizeImageUrl(image.src,{resize:"40,40"})}))});return React.createElement("ol",{className:"reader-post-images__list"},thumbList)}});module.exports=PostImages},3208:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1);var ExternalLink=__webpack_require__(394),stats=__webpack_require__(1643);var PostPermalink=React.createClass({displayName:"PostPermalink",propTypes:{siteName:React.PropTypes.string,postUrl:React.PropTypes.string},recordClick:function recordClick(){stats.recordPermalinkClick("card_visit_link");stats.recordGaEvent("Clicked Card Permalink")},render:function render(){if(!this.props.siteName||!this.props.postUrl){return null}return React.createElement("li",{className:"post-permalink",onClick:this.recordClick},React.createElement(ExternalLink,{href:this.props.postUrl,target:"_blank",icon:true,iconSize:16},this.translate("Visit",{comment:"Visit the post on the original site"})))}});module.exports=PostPermalink},3214:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _noop=__webpack_require__(38);var _noop2=_interopRequireDefault(_noop);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _button=__webpack_require__(69);var _button2=_interopRequireDefault(_button);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ExpandableSidebarAddForm=_react2.default.createClass({displayName:"ExpandableSidebarAddForm",propTypes:{addLabel:_react2.default.PropTypes.string,addPlaceholder:_react2.default.PropTypes.string,onAddSubmit:_react2.default.PropTypes.func,onAddClick:_react2.default.PropTypes.func},getInitialState:function getInitialState(){return{isAdding:false}},getDefaultProps:function getDefaultProps(){return{onAddSubmit:_noop2.default,onAddClick:_noop2.default}},toggleAdd:function toggleAdd(){if(!this.state.isAdding){this.refs.menuAddInput.focus();this.props.onAddClick()}this.setState({isAdding:!this.state.isAdding})},handleAddKeyDown:function handleAddKeyDown(event){var inputValue=this.refs.menuAddInput.value;if(event.keyCode===13&&inputValue.length>0){event.preventDefault();this.props.onAddSubmit(inputValue);this.refs.menuAddInput.value="";this.toggleAdd()}},render:function render(){var classes=(0,_classnames2.default)("sidebar__menu-add-item",{"is-add-open":this.state.isAdding});return _react2.default.createElement("div",{className:classes},_react2.default.createElement(_button2.default,{compact:true,className:"sidebar__menu-add-button",onClick:this.toggleAdd},this.translate("Add")),_react2.default.createElement("div",{className:"sidebar__menu-add"},_react2.default.createElement("input",{"aria-label":this.props.addLabel,className:"sidebar__menu-add-input",type:"text",placeholder:this.props.addPlaceholder,ref:"menuAddInput",onKeyDown:this.handleAddKeyDown}),_react2.default.createElement(_gridicon2.default,{icon:"cross-small",onClick:this.toggleAdd})))}});exports.default=ExpandableSidebarAddForm;module.exports=exports["default"]},3215:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _noop=__webpack_require__(38);var _noop2=_interopRequireDefault(_noop);var _heading=__webpack_require__(395);var _heading2=_interopRequireDefault(_heading);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _count=__webpack_require__(730);var _count2=_interopRequireDefault(_count);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ExpandableSidebarHeading=function ExpandableSidebarHeading(_ref){var title=_ref.title;var count=_ref.count;var onClick=_ref.onClick;return _react2.default.createElement(_heading2.default,{onClick:onClick},_react2.default.createElement(_gridicon2.default,{icon:"chevron-down"}),_react2.default.createElement("span",null,title),_react2.default.createElement(_count2.default,{count:count}))};ExpandableSidebarHeading.propTypes={title:_react2.default.PropTypes.string.isRequired,count:_react2.default.PropTypes.number,onClick:_react2.default.PropTypes.func};ExpandableSidebarHeading.defaultProps={onClick:_noop2.default};exports.default=ExpandableSidebarHeading;module.exports=exports["default"]},3216:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.shouldRenderAppPromo=exports.ReaderSidebar=undefined;var _every2=__webpack_require__(218);var _every3=_interopRequireDefault(_every2);var _identity2=__webpack_require__(99);var _identity3=_interopRequireDefault(_identity2);var _startsWith2=__webpack_require__(83);var _startsWith3=_interopRequireDefault(_startsWith2);var _defer2=__webpack_require__(385);var _defer3=_interopRequireDefault(_defer2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _componentClosest=__webpack_require__(729);var _componentClosest2=_interopRequireDefault(_componentClosest);var _page=__webpack_require__(33);var _page2=_interopRequireDefault(_page);var _url=__webpack_require__(70);var _url2=_interopRequireDefault(_url);var _redux=__webpack_require__(6);var _reactRedux=__webpack_require__(15);var _store=__webpack_require__(46);var _store2=_interopRequireDefault(_store);var _subscriptions=__webpack_require__(2081);var _subscriptions2=_interopRequireDefault(_subscriptions);var _subscriptions3=__webpack_require__(2271);var _subscriptions4=_interopRequireDefault(_subscriptions3);var _lists=__webpack_require__(1905);var _lists2=_interopRequireDefault(_lists);var _readerTeams=__webpack_require__(2652);var _readerTeams2=_interopRequireDefault(_readerTeams);var _sidebar=__webpack_require__(731);var _sidebar2=_interopRequireDefault(_sidebar);var _actions=__webpack_require__(2651);var _actions2=_interopRequireDefault(_actions);var _footer=__webpack_require__(783);var _footer2=_interopRequireDefault(_footer);var _heading=__webpack_require__(395);var _heading2=_interopRequireDefault(_heading);var _menu=__webpack_require__(396);var _menu2=_interopRequireDefault(_menu);var _region=__webpack_require__(427);var _region2=_interopRequireDefault(_region);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _helper=__webpack_require__(1674);var _readerSidebarTags=__webpack_require__(3220);var _readerSidebarTags2=_interopRequireDefault(_readerSidebarTags);var _readerSidebarLists=__webpack_require__(3217);var _readerSidebarLists2=_interopRequireDefault(_readerSidebarLists);var _readerSidebarTeams=__webpack_require__(3223);var _readerSidebarTeams2=_interopRequireDefault(_readerSidebarTeams);var _helper2=__webpack_require__(2004);var _helper3=_interopRequireDefault(_helper2);var _actions3=__webpack_require__(3311);var _selectors=__webpack_require__(1859);var _queryReaderLists=__webpack_require__(2502);var _queryReaderLists2=_interopRequireDefault(_queryReaderLists);var _dataObserve=__webpack_require__(131);var _dataObserve2=_interopRequireDefault(_dataObserve);var _config=__webpack_require__(12);var _config2=_interopRequireDefault(_config);var _userSettings=__webpack_require__(387);var _userSettings2=_interopRequireDefault(_userSettings);var _appPromo=__webpack_require__(2429);var _appPromo2=_interopRequireDefault(_appPromo);var _actions4=__webpack_require__(82);var _utils=__webpack_require__(169);var _utils2=_interopRequireDefault(_utils);var _viewport=__webpack_require__(92);var _viewport2=_interopRequireDefault(_viewport);var _i18nCalypso=__webpack_require__(11);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ReaderSidebar=exports.ReaderSidebar=_react2.default.createClass({displayName:"ReaderSidebar",mixins:[(0,_dataObserve2.default)("userSettings")],componentDidMount:function componentDidMount(){_subscriptions2.default.on("change",this.updateState);_subscriptions2.default.on("add",this.highlightNewTag);_lists2.default.on("change",this.updateState);_subscriptions4.default.on("change",this.updateState);_subscriptions4.default.on("create",this.highlightNewList);_readerTeams2.default.on("change",this.updateState);this.openExpandableMenuForCurrentTagOrList()},componentWillUnmount:function componentWillUnmount(){_subscriptions2.default.off("change",this.updateState);_subscriptions2.default.off("add",this.highlightNewTag);_lists2.default.off("change",this.updateState);_subscriptions4.default.off("change",this.updateState);_subscriptions4.default.off("create",this.highlightNewList);_readerTeams2.default.off("change",this.updateState)},getInitialState:function getInitialState(){return this.getStateFromStores()},getStateFromStores:function getStateFromStores(){var tags=_subscriptions2.default.get();var teams=_readerTeams2.default.get();if(!(tags&&teams)){_actions2.default.fetch()}return{tags:tags,teams:teams}},updateState:function updateState(){this.setState(this.getStateFromStores())},handleClick:function handleClick(event){if(!event.isDefaultPrevented()&&(0,_componentClosest2.default)(event.target,"a,span",true)){this.props.setNextLayoutFocus("content");window.scrollTo(0,0)}},highlightNewList:function highlightNewList(list){list=_lists2.default.get(list.owner,list.slug);window.location.href=_url2.default.resolve("https://wordpress.com",list.URL+"/edit")},highlightNewTag:function highlightNewTag(tag){(0,_defer3.default)(function(){(0,_page2.default)("/tag/"+tag.slug);window.scrollTo(0,0)})},openExpandableMenuForCurrentTagOrList:function openExpandableMenuForCurrentTagOrList(){var pathParts=this.props.path.split("/");if((0,_startsWith3.default)(this.props.path,"/tag/")){var tagSlug=pathParts[2];if(tagSlug){if(!this.props.isTagsOpen){this.props.toggleTagsVisibility();this.setState({currentTag:tagSlug})}}}if((0,_startsWith3.default)(this.props.path,"/read/list/")){var listOwner=pathParts[3];var listSlug=pathParts[4];if(listOwner&&listSlug){if(!this.props.isListsOpen){this.props.toggleListsVisibility();this.setState({currentListOwner:listOwner,currentListSlug:listSlug})}}}},render:function render(){return _react2.default.createElement(_sidebar2.default,{onClick:this.handleClick},_react2.default.createElement(_region2.default,null,_react2.default.createElement(_menu2.default,null,_react2.default.createElement(_heading2.default,null,this.props.translate("Streams")),_react2.default.createElement("ul",null,_react2.default.createElement("li",{className:_helper3.default.itemLinkClass("/",this.props.path,{"sidebar-streams__following":true})},_react2.default.createElement("a",{href:"/"},_react2.default.createElement(_gridicon2.default,{icon:"checkmark-circle",size:24}),_react2.default.createElement("span",{className:"menu-link-text"},this.props.translate("Followed Sites"))),_react2.default.createElement("a",{href:"/following/edit",className:"sidebar__button"},this.props.translate("Manage"))),_react2.default.createElement(_readerSidebarTeams2.default,{teams:this.state.teams,path:this.props.path}),_config2.default.isEnabled("reader/recommendations/posts")&&_react2.default.createElement("li",{className:_helper3.default.itemLinkClass("/recommendations/posts",this.props.path,{"sidebar-streams__post-recommendations":true})},_react2.default.createElement("a",{href:"/recommendations/posts"},_react2.default.createElement(_gridicon2.default,{icon:"star",size:24}),_react2.default.createElement("span",{className:"menu-link-text"},this.props.translate("Recommended Posts (Alpha)")))),_config2.default.isEnabled("reader/recommendations/posts")&&_react2.default.createElement("li",{className:_helper3.default.itemLinkClass("/recommendations/cold",this.props.path,{"sidebar-streams__post-recommendations":true})},_react2.default.createElement("a",{href:"/recommendations/cold"},_react2.default.createElement(_gridicon2.default,{icon:"star",size:24}),_react2.default.createElement("span",{className:"menu-link-text"},this.props.translate("Coldstart (Alpha)")))),(0,_helper.isDiscoverEnabled)()?_react2.default.createElement("li",{className:_helper3.default.itemLinkClass("/discover",this.props.path,{"sidebar-streams__discover":true})},_react2.default.createElement("a",{href:"/discover"},_react2.default.createElement(_gridicon2.default,{icon:"my-sites"}),_react2.default.createElement("span",{className:"menu-link-text"},this.props.translate("Discover")))):null,_config2.default.isEnabled("reader/search")&&_react2.default.createElement("li",{className:_helper3.default.itemLinkClass("/read/search",this.props.path,{"sidebar-streams__search":true})},_react2.default.createElement("a",{href:"/read/search"},_react2.default.createElement(_gridicon2.default,{icon:"search",size:24}),_react2.default.createElement("span",{className:"menu-link-text"},this.props.translate("Search")))),_react2.default.createElement("li",{className:_helper3.default.itemLinkClass("/recommendations",this.props.path,{"sidebar-streams__recommendations":true})},_react2.default.createElement("a",{href:"/recommendations"},_react2.default.createElement(_gridicon2.default,{icon:"thumbs-up",size:24}),_react2.default.createElement("span",{className:"menu-link-text"},this.props.translate("Recommendations")))),_react2.default.createElement("li",{className:_helper3.default.itemLinkClass("/activities/likes",this.props.path,{"sidebar-activity__likes":true})},_react2.default.createElement("a",{href:"/activities/likes"},_react2.default.createElement(_gridicon2.default,{icon:"star",size:24}),_react2.default.createElement("span",{className:"menu-link-text"},this.props.translate("My Likes")))))),_react2.default.createElement(_queryReaderLists2.default,null),_react2.default.createElement(_readerSidebarLists2.default,{lists:this.props.subscribedLists,path:this.props.path,isOpen:this.props.isListsOpen,onClick:this.props.toggleListsVisibility,currentListOwner:this.state.currentListOwner,currentListSlug:this.state.currentListSlug}),_react2.default.createElement(_readerSidebarTags2.default,{tags:this.state.tags,path:this.props.path,isOpen:this.props.isTagsOpen,onClick:this.props.toggleTagsVisibility,onTagExists:this.highlightNewTag,currentTag:this.state.currentTag})),this.props.shouldRenderAppPromo&&_react2.default.createElement("div",{className:"sidebar__app-promo"},_react2.default.createElement(_appPromo2.default,{location:"reader",locale:_utils2.default.getLocaleSlug()})),_react2.default.createElement(_footer2.default,null))}});ReaderSidebar.defaultProps={translate:_identity3.default};var shouldRenderAppPromo=exports.shouldRenderAppPromo=function shouldRenderAppPromo(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var haveUserSettingsLoaded=_userSettings2.default.getSetting(" is_desktop_app_user")===null;var _options$isDesktopPro=options.isDesktopPromoDisabled;var isDesktopPromoDisabled=_options$isDesktopPro===undefined?_store2.default.get("desktop_promo_disabled"):_options$isDesktopPro;var _options$isViewportMo=options.isViewportMobile;var isViewportMobile=_options$isViewportMo===undefined?_viewport2.default.isMobile():_options$isViewportMo;var _options$isUserLocale=options.isUserLocaleEnglish;var isUserLocaleEnglish=_options$isUserLocale===undefined?"en"===_utils2.default.getLocaleSlug():_options$isUserLocale;var _options$isDesktopPro2=options.isDesktopPromoConfiguredToRun;var isDesktopPromoConfiguredToRun=_options$isDesktopPro2===undefined?_config2.default.isEnabled("desktop-promo"):_options$isDesktopPro2;var _options$isUserDeskto=options.isUserDesktopAppUser;var isUserDesktopAppUser=_options$isUserDeskto===undefined?haveUserSettingsLoaded||_userSettings2.default.getSetting("is_desktop_app_user"):_options$isUserDeskto;var _options$isUserOnChro=options.isUserOnChromeOs;var isUserOnChromeOs=_options$isUserOnChro===undefined?/\bCrOS\b/.test(navigator.userAgent):_options$isUserOnChro;return(0,_every3.default)([!isDesktopPromoDisabled,isUserLocaleEnglish,!isViewportMobile,!isUserOnChromeOs,isDesktopPromoConfiguredToRun,!isUserDesktopAppUser])};exports.default=(0,_reactRedux.connect)(function(state){return{isListsOpen:state.ui.reader.sidebar.isListsOpen,isTagsOpen:state.ui.reader.sidebar.isTagsOpen,subscribedLists:(0,_selectors.getSubscribedLists)(state),shouldRenderAppPromo:shouldRenderAppPromo()}},function(dispatch){return(0,_redux.bindActionCreators)({toggleListsVisibility:_actions3.toggleReaderSidebarLists,toggleTagsVisibility:_actions3.toggleReaderSidebarTags,setNextLayoutFocus:_actions4.setNextLayoutFocus},dispatch)})((0,_i18nCalypso.localize)(ReaderSidebar))},3217:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _expandable=__webpack_require__(2355);var _expandable2=_interopRequireDefault(_expandable);var _list=__webpack_require__(3219);var _list2=_interopRequireDefault(_list);var _actions=__webpack_require__(2649);var _actions2=_interopRequireDefault(_actions);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var stats=__webpack_require__(1643);var ReaderSidebarLists=_react2.default.createClass({displayName:"ReaderSidebarLists",propTypes:{lists:_react2.default.PropTypes.array,path:_react2.default.PropTypes.string.isRequired,isOpen:_react2.default.PropTypes.bool,onClick:_react2.default.PropTypes.func,currentListOwner:_react2.default.PropTypes.string,currentListSlug:_react2.default.PropTypes.string},createList:function createList(list){stats.recordAction("add_list");stats.recordGaEvent("Clicked Create List");stats.recordTrack("calypso_reader_create_list_clicked");_actions2.default.create(list)},handleAddClick:function handleAddClick(){stats.recordAction("add_list_open_input");stats.recordGaEvent("Clicked Add List to Open Input");stats.recordTrack("calypso_reader_add_list_clicked")},render:function render(){var listCount=this.props.lists?this.props.lists.length:0;return _react2.default.createElement(_expandable2.default,{expanded:this.props.isOpen,title:this.translate("Lists"),count:listCount,addLabel:this.translate("New list name"),
addPlaceholder:this.translate("Give your list a name"),onAddClick:this.handleAddClick,onAddSubmit:this.createList,onClick:this.props.onClick},_react2.default.createElement(_list2.default,this.props))}});exports.default=ReaderSidebarLists;module.exports=exports["default"]},3218:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactDom=__webpack_require__(44);var _reactDom2=_interopRequireDefault(_reactDom);var _last=__webpack_require__(215);var _last2=_interopRequireDefault(_last);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _config=__webpack_require__(12);var _config2=_interopRequireDefault(_config);var _helper=__webpack_require__(2004);var _helper2=_interopRequireDefault(_helper);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ReaderSidebarListsListItem=_react2.default.createClass({displayName:"ReaderSidebarListsListItem",propTypes:{list:_react2.default.PropTypes.object.isRequired,path:_react2.default.PropTypes.string.isRequired,currentListOwner:_react2.default.PropTypes.string,currentListSlug:_react2.default.PropTypes.string},componentDidMount:function componentDidMount(){if(this.props.list.slug===this.props.currentListSlug&&this.props.list.owner===this.props.currentListOwner){var node=_reactDom2.default.findDOMNode(this);node.scrollIntoView()}},render:function render(){var list=this.props.list;var listRelativeUrl="/read/list/"+list.owner+"/"+list.slug;var listManageUrl="https://wordpress.com"+listRelativeUrl+"/edit";var listRel="external";if(_config2.default.isEnabled("reader/list-management")){listManageUrl=listRelativeUrl+"/edit";listRel=""}var listManagementUrls=[listRelativeUrl+"/tags",listRelativeUrl+"/edit",listRelativeUrl+"/sites"];var lastPathSegment=(0,_last2.default)(this.props.path.split("/"));var isCurrentList=lastPathSegment&&lastPathSegment.toLowerCase()===list.slug.toLowerCase()&&_helper2.default.pathStartsWithOneOf([listRelativeUrl],this.props.path);var isActionButtonSelected=_helper2.default.pathStartsWithOneOf(listManagementUrls,this.props.path);var classes=(0,_classnames2.default)({"sidebar__menu-item has-buttons":true,selected:isCurrentList||isActionButtonSelected,"is-action-button-selected":isActionButtonSelected});return _react2.default.createElement("li",{className:classes,key:list.ID},_react2.default.createElement("a",{className:"sidebar__menu-item-label",href:listRelativeUrl},_react2.default.createElement("div",{className:"sidebar__menu-item-listname"},list.title)),list.is_owner?_react2.default.createElement("a",{href:listManageUrl,rel:listRel,className:"add-new"},this.translate("Manage")):null)}});exports.default=ReaderSidebarListsListItem;module.exports=exports["default"]},3219:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _map=__webpack_require__(45);var _map2=_interopRequireDefault(_map);var _listItem=__webpack_require__(3218);var _listItem2=_interopRequireDefault(_listItem);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ReaderSidebarListsList=_react2.default.createClass({displayName:"ReaderSidebarListsList",propTypes:{lists:_react2.default.PropTypes.array,path:_react2.default.PropTypes.string.isRequired,currentListOwner:_react2.default.PropTypes.string,currentListSlug:_react2.default.PropTypes.string},renderItems:function renderItems(){var _props=this.props;var currentListOwner=_props.currentListOwner;var currentListSlug=_props.currentListSlug;var path=_props.path;return(0,_map2.default)(this.props.lists,function(list){return _react2.default.createElement(_listItem2.default,{key:list.ID,list:list,path:path,currentListOwner:currentListOwner,currentListSlug:currentListSlug})})},render:function render(){if(!this.props.lists||this.props.lists.length===0){return _react2.default.createElement("li",{key:"empty",className:"sidebar__menu-empty"},this.translate("Collect sites together by adding alist."))}return _react2.default.createElement("div",null,this.renderItems())}});exports.default=ReaderSidebarListsList;module.exports=exports["default"]},3220:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _componentClosest=__webpack_require__(729);var _componentClosest2=_interopRequireDefault(_componentClosest);var _expandable=__webpack_require__(2355);var _expandable2=_interopRequireDefault(_expandable);var _list=__webpack_require__(3222);var _list2=_interopRequireDefault(_list);var _subscriptions=__webpack_require__(2081);var _subscriptions2=_interopRequireDefault(_subscriptions);var _actions=__webpack_require__(2274);var _actions2=_interopRequireDefault(_actions);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var stats=__webpack_require__(1643);var ReaderSidebarTags=_react2.default.createClass({displayName:"ReaderSidebarTags",propTypes:{tags:_react2.default.PropTypes.array,path:_react2.default.PropTypes.string.isRequired,isOpen:_react2.default.PropTypes.bool,onClick:_react2.default.PropTypes.func,currentTag:_react2.default.PropTypes.string,onTagExists:_react2.default.PropTypes.func},followTag:function followTag(tag){var subscription=_subscriptions2.default.getSubscription(_actions2.default.slugify(tag));if(subscription){this.props.onTagExists(subscription)}else{_actions2.default.follow(tag);stats.recordAction("followed_topic");stats.recordGaEvent("Clicked Follow Topic",tag);stats.recordTrack("calypso_reader_reader_tag_followed",{tag:tag})}},unfollowTag:function unfollowTag(event){var node=(0,_componentClosest2.default)(event.target,"[data-tag-slug]",true);event.preventDefault();if(node&&node.dataset.tagSlug){stats.recordAction("unfollowed_topic");stats.recordGaEvent("Clicked Unfollow Topic",node.dataset.tagSlug);stats.recordTrack("calypso_reader_reader_tag_unfollowed",{tag:node.dataset.tagSlug});_actions2.default.unfollow({slug:node.dataset.tagSlug})}},handleAddClick:function handleAddClick(){stats.recordAction("follow_topic_open_input");stats.recordGaEvent("Clicked Add Topic to Open Input");stats.recordTrack("calypso_reader_add_tag_clicked")},render:function render(){var tagCount=this.props.tags?this.props.tags.length:0;return _react2.default.createElement(_expandable2.default,{expanded:this.props.isOpen,title:this.translate("Tags"),count:tagCount,addLabel:this.translate("New tag name"),addPlaceholder:this.translate("Add any tag"),onAddSubmit:this.followTag,onAddClick:this.handleAddClick,onClick:this.props.onClick},_react2.default.createElement(_list2.default,(0,_extends3.default)({},this.props,{onUnfollow:this.unfollowTag})))}});exports.default=ReaderSidebarTags;module.exports=exports["default"]},3221:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactDom=__webpack_require__(44);var _reactDom2=_interopRequireDefault(_reactDom);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _helper=__webpack_require__(2004);var _helper2=_interopRequireDefault(_helper);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ReaderSidebarTagsListItem=_react2.default.createClass({displayName:"ReaderSidebarTagsListItem",propTypes:{tag:_react2.default.PropTypes.object.isRequired,onUnfollow:_react2.default.PropTypes.func.isRequired,path:_react2.default.PropTypes.string.isRequired,currentTag:_react2.default.PropTypes.string},componentDidMount:function componentDidMount(){if(this.props.currentTag&&this.props.tag.slug===this.props.currentTag){var node=_reactDom2.default.findDOMNode(this);node.scrollIntoView()}},render:function render(){var tag=this.props.tag;return _react2.default.createElement("li",{key:tag.ID,className:_helper2.default.itemLinkClass("/tag/"+tag.slug,this.props.path,{"sidebar-dynamic-menu__tag":true})},_react2.default.createElement("a",{className:"sidebar__menu-item-label",href:tag.URL},_react2.default.createElement("div",{className:"sidebar__menu-item-tagname"},tag.display_name||tag.slug)),tag.ID!=="pending"?_react2.default.createElement("button",{className:"sidebar__menu-action","data-tag-slug":tag.slug,onClick:this.props.onUnfollow},_react2.default.createElement(_gridicon2.default,{icon:"cross-small"}),_react2.default.createElement("span",{className:"sidebar__menu-action-label"},this.translate("Unfollow"))):null)}});exports.default=ReaderSidebarTagsListItem;module.exports=exports["default"]},3222:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _map=__webpack_require__(45);var _map2=_interopRequireDefault(_map);var _listItem=__webpack_require__(3221);var _listItem2=_interopRequireDefault(_listItem);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ReaderSidebarTagsList=_react2.default.createClass({displayName:"ReaderSidebarTagsList",propTypes:{tags:_react2.default.PropTypes.array,onUnfollow:_react2.default.PropTypes.func.isRequired,path:_react2.default.PropTypes.string.isRequired,currentTag:_react2.default.PropTypes.string},renderItems:function renderItems(){var _props=this.props;var path=_props.path;var onUnfollow=_props.onUnfollow;var currentTag=_props.currentTag;return(0,_map2.default)(this.props.tags,function(tag){return _react2.default.createElement(_listItem2.default,{key:tag.ID,tag:tag,path:path,onUnfollow:onUnfollow,currentTag:currentTag})})},render:function render(){if(!this.props.tags||this.props.tags.length===0){return _react2.default.createElement("li",{key:"empty",className:"sidebar__menu-empty"},this.translate("Find relevant posts by adding atag."))}return _react2.default.createElement("div",null,this.renderItems())}});exports.default=ReaderSidebarTagsList;module.exports=exports["default"]},3223:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _map=__webpack_require__(45);var _map2=_interopRequireDefault(_map);var _listItem=__webpack_require__(3224);var _listItem2=_interopRequireDefault(_listItem);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ReaderSidebarTeams=_react2.default.createClass({displayName:"ReaderSidebarTeams",propTypes:{teams:_react2.default.PropTypes.array,path:_react2.default.PropTypes.string.isRequired},renderItems:function renderItems(){var path=this.props.path;return(0,_map2.default)(this.props.teams,function(team){return _react2.default.createElement(_listItem2.default,{key:team.slug,team:team,path:path})})},render:function render(){if(!this.props.teams){return null}return _react2.default.createElement("div",null,this.renderItems())}});exports.default=ReaderSidebarTeams;module.exports=exports["default"]},3224:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _helper=__webpack_require__(2004);var _helper2=_interopRequireDefault(_helper);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ReaderSidebarTeamsListItem=_react2.default.createClass({displayName:"ReaderSidebarTeamsListItem",propTypes:{team:_react2.default.PropTypes.object.isRequired,path:_react2.default.PropTypes.string.isRequired},render:function render(){var team=this.props.team;var teamUri="/read/"+encodeURIComponent(team.slug);return _react2.default.createElement("li",{key:team.slug,className:_helper2.default.itemLinkClass(teamUri,this.props.path,{"sidebar-streams__team":true})},_react2.default.createElement("a",{href:teamUri},_react2.default.createElement("svg",{className:"gridicon gridicon-"+team.slug,width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16"},_react2.default.createElement("path",{d:"M7.99 1.57C3.75 1.57 1 4.57 1 7.8v0.4c0 3.18 2.75 6.24 6.99 6.24 4.26 0 7.01-3.05 7.01-6.24V7.8C15 4.57 12.25 1.57 7.99 1.57zM12.74 8.13c0 2.32-1.69 4.42-4.74 4.42 -3.05 0-4.73-2.1-4.73-4.42V7.84c0-2.32 1.67-4.38 4.73-4.38 3.06 0 4.75 2.07 4.75 4.39V8.13z"}),_react2.default.createElement("path",{d:"M9.47 5.73C9.07 5.47 8.52 5.59 8.26 6L6.21 9.17c-0.26 0.41-0.15 0.95 0.26 1.21 0.4 0.26 0.95 0.14 1.21-0.26l2.05-3.17C9.99 6.53 9.88 5.99 9.47 5.73z"})),_react2.default.createElement("span",{className:"menu-link-text"},team.title)))}});exports.default=ReaderSidebarTeamsListItem;module.exports=exports["default"]},3225:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _mixin=__webpack_require__(111);var _mixin2=_interopRequireDefault(_mixin);var _siteIcon=__webpack_require__(281);var _siteIcon2=_interopRequireDefault(_siteIcon);var _gravatar=__webpack_require__(710);var _gravatar2=_interopRequireDefault(_gravatar);var _readerSiteStore=__webpack_require__(1711);var _readerSiteStore2=_interopRequireDefault(_readerSiteStore);var _actions=__webpack_require__(1815);var _actions2=_interopRequireDefault(_actions);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var SiteAndAuthorIcon=_react2.default.createClass({displayName:"SiteAndAuthorIcon",mixins:[_mixin2.default],propTypes:{siteId:_react2.default.PropTypes.number.isRequired,isExternal:_react2.default.PropTypes.bool.isRequired,user:_react2.default.PropTypes.object.isRequired},getInitialState:function getInitialState(){return this.getStateFromStores()},getStateFromStores:function getStateFromStores(){var props=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.props;var site=void 0;var siteId=!props.isExternal&&props.siteId;if(siteId){site=_readerSiteStore2.default.get(siteId);if(!site){_actions2.default.fetch(siteId)}}return{site:site}},componentDidMount:function componentDidMount(){_readerSiteStore2.default.on("change",this.updateState)},componentWillUnmount:function componentWillUnmount(){_readerSiteStore2.default.off("change",this.updateState)},componentWillReceiveProps:function componentWillReceiveProps(nextProps){if(nextProps.siteId!==this.props.siteId){this.updateState(nextProps)}},updateState:function updateState(props){var newState=this.getStateFromStores(props);if(newState.site!==this.state.site){this.setState(newState)}},render:function render(){var site=this.state.site?this.state.site.toJS():{};return _react2.default.createElement("div",{className:"reader__site-and-author-icon"},_react2.default.createElement(_siteIcon2.default,{site:site}),_react2.default.createElement(_gravatar2.default,{user:this.props.user,size:24}))}});exports.default=SiteAndAuthorIcon;module.exports=exports["default"]},3226:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1);var EmptyContent=__webpack_require__(207),stats=__webpack_require__(1643),discoverHelper=__webpack_require__(1674);var SiteEmptyContent=React.createClass({displayName:"SiteEmptyContent",shouldComponentUpdate:function shouldComponentUpdate(){return false},recordAction:function recordAction(){stats.recordAction("clicked_discover_on_empty");stats.recordGaEvent("Clicked Discover on EmptyContent");stats.recordTrack("calypso_reader_discover_on_empty_site_stream_clicked")},recordSecondaryAction:function recordSecondaryAction(){stats.recordAction("clicked_recommendations_on_empty");stats.recordGaEvent("Clicked Recommendations on EmptyContent");stats.recordTrack("calypso_reader_recommendations_on_empty_site_stream_clicked")},render:function render(){var action=discoverHelper.isDiscoverEnabled()?React.createElement("a",{className:"empty-content__action button is-primary",onClick:this.recordAction,href:"/discover"},this.translate("Explore Discover")):null,secondaryAction=React.createElement("a",{className:"empty-content__action button",onClick:this.recordSecondaryAction,href:"/recommendations"},this.translate("Get recommendations on who to follow"));return React.createElement(EmptyContent,{title:this.translate("No Posts"),line:this.translate("This site has not posted anything yet. Try back later."),action:action,secondaryAction:secondaryAction,illustration:"/calypso/images/drake/drake-empty-results.svg",illustrationWidth:500})}});module.exports=SiteEmptyContent},3227:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _mixin=__webpack_require__(111);var _mixin2=_interopRequireDefault(_mixin);var _card=__webpack_require__(89);var _card2=_interopRequireDefault(_card);var _page=__webpack_require__(33);var _page2=_interopRequireDefault(_page);var _feedPostStore=__webpack_require__(1763);var _feedPostStore2=_interopRequireDefault(_feedPostStore);var _actions=__webpack_require__(1813);var _actions2=_interopRequireDefault(_actions);var _helper=__webpack_require__(1674);var _stats=__webpack_require__(1643);var stats=_interopRequireWildcard(_stats);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"FeedFeatured",mixins:[_mixin2.default],getInitialState:function getInitialState(){return this.getStateFromStores()},getStateFromStores:function getStateFromStores(){var _this=this;var store=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.props.store;var posts=store.get().map(function(postKey){var post=_feedPostStore2.default.get(postKey);if(_this.shouldFetch(post)){_actions2.default.fetchPost(postKey);return{post:post}}var source=_this.getSourcePost(post),url=_this.getPostUrl(source||post);return{post:post,source:source,url:url}});return{posts:posts}},updateState:function updateState(store){this.setState(this.getStateFromStores(store))},componentDidMount:function componentDidMount(){this.props.store.on("change",this.updateState);_feedPostStore2.default.on("change",this.updateState)},componentWillUnmount:function componentWillUnmount(){this.props.store.off("change",this.updateState);_feedPostStore2.default.off("change",this.updateState)},componentWillReceiveProps:function componentWillReceiveProps(nextProps){if(nextProps.store!==this.props.store){this.updateState()}},shouldFetch:function shouldFetch(post){return!post||post._state==="minimal"},getSourcePost:function getSourcePost(post){var data=(0,_helper.getSourceData)(post);if(!data){return null}return _feedPostStore2.default.get(data)},getPostUrl:function getPostUrl(post){return"/read/blogs/"+post.site_ID+"/posts/"+post.ID},handleClick:function handleClick(postData){var post=postData.post;stats.recordTrackForPost("calypso_reader_clicked_featured_post",post);stats.recordAction("clicked_featured_post");stats.recordGaEvent("Clicked Featured Post");(0,_page2.default)(postData.url)},renderPosts:function renderPosts(){var _this2=this;return this.state.posts.map(function(postData){var post=postData.post,postState=post._state;switch(postState){case"minimal":case"pending":case"error":break;default:var style={backgroundImage:post.canonical_image&&post.canonical_image.uri?"url("+post.canonical_image.uri+")":null};return _react2.default.createElement("div",{key:post.ID,className:"reader__featured-post",onClick:_this2.handleClick.bind(_this2,postData)},_react2.default.createElement("div",{className:"reader__featured-post-image",style:style}),_react2.default.createElement("h2",{className:"reader__featured-post-title"},post.title))}})},render:function render(){if(!this.state.posts){return null}return _react2.default.createElement(_card2.default,{className:"reader__featured-card"},_react2.default.createElement("div",{className:"reader__featured-header"},_react2.default.createElement("div",{className:"reader__featured-title"},this.translate("Highlights")),_react2.default.createElement("div",{className:"reader__featured-description"},this.translate("What were reading this week."))),_react2.default.createElement("div",{className:"reader__featured-posts"},this.renderPosts()))}});module.exports=exports["default"]},3235:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1);var EmptyContent=__webpack_require__(207),stats=__webpack_require__(1643),discoverHelper=__webpack_require__(1674);var FollowingEmptyContent=React.createClass({displayName:"FollowingEmptyContent",shouldComponentUpdate:function shouldComponentUpdate(){return false},recordAction:function recordAction(){stats.recordAction("clicked_discover_on_empty");stats.recordGaEvent("Clicked Discover on EmptyContent");stats.recordTrack("calypso_reader_discover_on_empty_stream_clicked")},recordSecondaryAction:function recordSecondaryAction(){stats.recordAction("clicked_recommendations_on_empty");stats.recordGaEvent("Clicked Recommendations on EmptyContent");stats.recordTrack("calypso_reader_recommendations_on_empty_stream_clicked")},render:function render(){var action=discoverHelper.isDiscoverEnabled()?React.createElement("a",{className:"empty-content__action button is-primary",onClick:this.recordAction,href:"/discover"},this.translate("Explore Discover")):null,secondaryAction=React.createElement("a",{className:"empty-content__action button",onClick:this.recordSecondaryAction,href:"/recommendations"},this.translate("Get recommendations on who to follow"));return React.createElement(EmptyContent,{title:this.translate("Welcome to the Reader"),line:this.translate("Recent posts from blogs and sites you follow will appear here."),action:action,secondaryAction:secondaryAction,illustration:"/calypso/images/drake/drake-all-done.svg",illustrationWidth:500})}});module.exports=FollowingEmptyContent},3236:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _throttle2=__webpack_require__(388);var _throttle3=_interopRequireDefault(_throttle2);var _constant2=__webpack_require__(734);var _constant3=_interopRequireDefault(_constant2);var _assign2=__webpack_require__(34);var _assign3=_interopRequireDefault(_assign2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactDom=__webpack_require__(44);var _reactDom2=_interopRequireDefault(_reactDom);var _embedHelper=__webpack_require__(3178);var _embedHelper2=_interopRequireDefault(_embedHelper);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var maxWidth=function maxWidth(){return Math.min(720,window.innerWidth)};var FeaturedAsset=function(_React$Component){(0,_inherits3.default)(FeaturedAsset,_React$Component);function FeaturedAsset(props){(0,_classCallCheck3.default)(this,FeaturedAsset);var _this=(0,_possibleConstructorReturn3.default)(this,(FeaturedAsset.__proto__||(0,_getPrototypeOf2.default)(FeaturedAsset)).call(this,props));_this.state={suppressFeaturedImage:false,useFeaturedEmbed:props.useFeaturedEmbed};["handleImageError","updateFeatureSize","getMaxFeaturedWidthSize","setEmbedSizingStrategy","handleResize"].forEach(function(method){_this[method]=_this[method].bind(_this)});_this.setEmbedSizingStrategy(props.featuredEmbed);_this.setImageSizingStrategy(props.featuredImage);return _this}(0,_createClass3.default)(FeaturedAsset,[{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){if(nextProps.featuredImage!==this.props.featuredImage){this.setState({suppressFeaturedImage:false,useFeaturedEmbed:nextProps.useFeaturedEmbed});this.setImageSizingStrategy(nextProps.featuredImage)}if(nextProps.featuredEmbed!==this.props.featuredEmbed){this.setEmbedSizingStrategy(nextProps.featuredEmbed)}}},{key:"componentWillMount",value:function componentWillMount(){this._unmounted=false}},{key:"componentWillUnmount",value:function componentWillUnmount(){this._unmounted=true;window.removeEventListener("resize",this._handleResize)}},{key:"componentDidMount",value:function componentDidMount(){this.updateFeatureSize();this._handleResize=(0,_throttle3.default)(this.handleResize,100);window.addEventListener("resize",this._handleResize)}},{key:"handleResize",value:function handleResize(){this.updateFeatureSize()}},{key:"getMaxFeaturedWidthSize",value:function getMaxFeaturedWidthSize(){return _reactDom2.default.findDOMNode(this).parentNode.offsetWidth}},{key:"setEmbedSizingStrategy",value:function setEmbedSizingStrategy(featuredEmbed){var _this2=this;var sizingFunction=(0,_constant3.default)({});if(featuredEmbed){(function(){var embedSize=_embedHelper2.default.getEmbedSizingFunction(featuredEmbed);sizingFunction=function sizingFunction(){var available=arguments.length>0&&arguments[0]!==undefined?arguments[0]:_this2.getMaxFeaturedWidthSize();return embedSize(available)}})()}this.getEmbedSize=sizingFunction}},{key:"setImageSizingStrategy",value:function setImageSizingStrategy(featuredImage){var _this3=this;var sizingFunction=(0,_constant3.default)({});if(featuredImage&&featuredImage.width>=maxWidth()){sizingFunction=function sizingFunction(){var available=arguments.length>0&&arguments[0]!==undefined?arguments[0]:_this3.getMaxFeaturedWidthSize();var aspectRatio=featuredImage.width/featuredImage.height,height=Math.floor(available/aspectRatio)+"px",width=available+"px";return{width:width,height:height}}}this.getImageSize=sizingFunction}},{key:"updateFeatureSize",value:function updateFeatureSize(){if(this.refs.featuredImage){var img=_reactDom2.default.findDOMNode(this.refs.featuredImage);(0,_assign3.default)(img.style,this.getImageSize())}if(this.refs.featuredEmbed){var iframe=_reactDom2.default.findDOMNode(this.refs.featuredEmbed).querySelector("iframe");(0,_assign3.default)(iframe.style,this.getEmbedSize())}}},{key:"handleImageError",value:function handleImageError(){if(!this._unmounted){this.setState({suppressFeaturedImage:true,useFeaturedEmbed:!!this.props.featuredEmbed})}}},{key:"render",value:function render(){if(this.state.useFeaturedEmbed){return _react2.default.createElement("div",{ref:"featuredEmbed",className:"reader__post-featured-video",key:"featuredVideo",dangerouslySetInnerHTML:{__html:this.props.featuredEmbed.iframe}})}return _react2.default.createElement("div",{className:"reader__post-featured-image"},!this.state.suppressFeaturedImage?_react2.default.createElement("img",{className:"reader__post-featured-image-image",ref:"featuredImage",src:this.props.featuredImage.uri,onError:this.handleImageError}):null)}}]);return FeaturedAsset}(_react2.default.Component);exports.default=FeaturedAsset;FeaturedAsset.propTypes={featuredEmbed:_react2.default.PropTypes.object,featuredImage:_react2.default.PropTypes.object,useFeaturedEmbed:_react2.default.PropTypes.bool};module.exports=exports["default"]},3237:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1),PureRenderMixin=__webpack_require__(111);var analytics=__webpack_require__(20),stats=__webpack_require__(1643),SiteBlockActions=__webpack_require__(2080),Card=__webpack_require__(89);var PostBlocked=React.createClass({displayName:"PostBlocked",mixins:[PureRenderMixin],unblock:function unblock(){analytics.mc.bumpStat("reader_actions","unblocked_blog");analytics.ga.recordEvent("reader_actions","Clicked Unblock Site");stats.recordTrack("calypso_reader_unblock_site",{blog_id:this.props.post.site_ID});SiteBlockActions.unblock(this.props.post.site_ID)},render:function render(){var post=this.props.post;return React.createElement(Card,{tagName:"article",className:"reader__card is-blocked"},React.createElement("p",null,this.translate("You have blocked posts from %(site_name)s.",{args:{site_name:post.site_name}}),React.createElement("a",{onClick:this.unblock},this.translate("Undo"),"?")))}});module.exports=PostBlocked},3238:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _mixin=__webpack_require__(111);var _mixin2=_interopRequireDefault(_mixin);var _card=__webpack_require__(89);var _card2=_interopRequireDefault(_card);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var PostPlaceholder=_react2.default.createClass({displayName:"PostPlaceholder",mixins:[_mixin2.default],render:function render(){return _react2.default.createElement(_card2.default,{tagName:"article",className:"reader__card is-placeholder"},_react2.default.createElement("div",{className:"reader__post-header"},_react2.default.createElement("h1",{className:"reader__post-title"},_react2.default.createElement("a",{className:"reader__post-title-link",target:"_blank",rel:"noopener noreferrer"},_react2.default.createElement("span",{className:"reader__placeholder-text"},"Loading interesting posts"))),_react2.default.createElement("div",{className:"reader__post-byline"},_react2.default.createElement("span",{className:"site-icon",height:"16",width:"16"}),_react2.default.createElement("h4",{className:"reader__site-name"},_react2.default.createElement("span",{className:"reader__placeholder-text"},"Loading Sites")),_react2.default.createElement("time",{className:"reader__post-time"},_react2.default.createElement("span",{className:"reader__placeholder-text"},"10 min")))),_react2.default.createElement("div",{className:"reader__post-excerpt"},_react2.default.createElement("p",null,_react2.default.createElement("span",{className:"reader__placeholder-text"},"Please wait while we grab all the interesting posts, photos, videos and more to show you in Reader. It shouldnt take long."))),_react2.default.createElement("ul",{className:"reader__post-footer"},_react2.default.createElement("li",{className:"reader__post-read-time"},_react2.default.createElement("span",{className:"reader__placeholder-text"},"10 min read"))))}});exports.default=PostPlaceholder;module.exports=exports["default"]},3239:function(module,exports,__webpack_require__){"use strict";var _stringify=__webpack_require__(40);var _stringify2=_interopRequireDefault(_stringify);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var React=__webpack_require__(1),PureRenderMixin=__webpack_require__(111),config=__webpack_require__(12);var Card=__webpack_require__(89);var PostUnavailable=React.createClass({displayName:"PostUnavailable",mixins:[PureRenderMixin],componentWillMount:function componentWillMount(){this.errors={unauthorized:this.translate("This is a post on a private site that youre following, but not currently a member of. Please request membership to display these posts in Reader."),default:this.translate("An error occurred loading this post.")}},
render:function render(){var errorMessage=this.errors[this.props.post.errorCode||"default"]||this.errors.default;if(this.props.post.statusCode===404){return null}return React.createElement(Card,{tagName:"article",className:"reader__card is-error"},React.createElement("div",{className:"reader__post-header"},React.createElement("h1",{className:"reader__post-title"},React.createElement("a",{className:"reader__post-title-link",target:"_blank",rel:"noopener noreferrer"},React.createElement("span",{className:"reader__placeholder-text"},"Oops!")))),React.createElement("div",{className:"reader__post-excerpt"},React.createElement("p",null,errorMessage),config.isEnabled("reader/full-errors")?React.createElement("pre",null,(0,_stringify2.default)(this.props.post,null,"  ")):null))}});module.exports=PostUnavailable},3240:function(module,exports,__webpack_require__){"use strict";var ReactDom=__webpack_require__(44),React=__webpack_require__(1),PureRenderMixin=__webpack_require__(111),assign=__webpack_require__(34),classnames=__webpack_require__(10),closest=__webpack_require__(729),head=__webpack_require__(1734),filter=__webpack_require__(77),forOwn=__webpack_require__(287),startsWith=__webpack_require__(83),twemoji=__webpack_require__(2023),get=__webpack_require__(24),page=__webpack_require__(33),pick=__webpack_require__(91);var Card=__webpack_require__(89),CommentButton=__webpack_require__(1834),DISPLAY_TYPES=__webpack_require__(2067),EmbedContainer=__webpack_require__(2043),LikeButton=__webpack_require__(1857),ObserveWindowSizeMixin=__webpack_require__(2248),PostHeader=__webpack_require__(3206),PostByline=__webpack_require__(2351),PostImages=__webpack_require__(3207),PostOptions=__webpack_require__(2354),PostErrors=__webpack_require__(2352),PostExcerpt=__webpack_require__(1889),SiteStore=__webpack_require__(1711),SiteStoreActions=__webpack_require__(1815),Share=__webpack_require__(2173),ShareHelper=__webpack_require__(2172),utils=__webpack_require__(2005),PostCommentHelper=__webpack_require__(2347),LikeHelper=__webpack_require__(1919),readerRoute=__webpack_require__(1740),stats=__webpack_require__(1643),PostPermalink=__webpack_require__(3208),DailyPostHelper=__webpack_require__(2001),DailyPostButton=__webpack_require__(2163),DiscoverPostAttribution=__webpack_require__(3177),DiscoverSiteAttribution=__webpack_require__(2164),DiscoverHelper=__webpack_require__(1674),FeedPostStore=__webpack_require__(1763),FeedPostStoreActions=__webpack_require__(1813),Gridicon=__webpack_require__(26),smartSetState=__webpack_require__(1710),FeaturedAsset=__webpack_require__(3236);var Post=React.createClass({displayName:"Post",mixins:[PureRenderMixin,ObserveWindowSizeMixin],propTypes:{post:React.PropTypes.object.isRequired,isSelected:React.PropTypes.bool.isRequired,xPostedTo:React.PropTypes.array,suppressSiteNameLink:React.PropTypes.bool,showPostHeader:React.PropTypes.bool,showFollowInHeader:React.PropTypes.bool,additionalClasses:React.PropTypes.object,handleClick:React.PropTypes.func.isRequired},smartSetState:smartSetState,shouldApplyIsLong:function shouldApplyIsLong(){var node=ReactDom.findDOMNode(this.refs.siteName);return!!(node&&node.scrollWidth>node.offsetWidth+2)},onWindowResize:function onWindowResize(){this.checkSiteNameForOverflow()},getInitialState:function getInitialState(){return this.getStateFromStores()},getDefaultProps:function getDefaultProps(){return{showFollowInHeader:false}},getStateFromStores:function getStateFromStores(props){var post,siteId,site,originalPost,isDiscoverPost,isDiscoverSitePick;props=props||this.props;post=props.post;siteId=!post.is_external&&post.site_ID;isDiscoverPost=post&&DiscoverHelper.isDiscoverPost(post);if(isDiscoverPost){isDiscoverSitePick=post&&DiscoverHelper.isDiscoverSitePick(post)}if(siteId){site=SiteStore.get(siteId);if(!site){SiteStoreActions.fetch(siteId)}}if(isDiscoverPost&&!isDiscoverSitePick&&get(post,"discover_metadata.featured_post_wpcom_data.blog_id")){originalPost=FeedPostStore.get({blogId:post.discover_metadata.featured_post_wpcom_data.blog_id,postId:post.discover_metadata.featured_post_wpcom_data.post_id})}return{site:site,siteish:utils.siteishFromSiteAndPost(site,post),originalPost:originalPost,isDiscoverPost:isDiscoverPost,isDiscoverSitePick:isDiscoverSitePick}},componentDidMount:function componentDidMount(){this.checkSiteNameForOverflow();this._parseEmoji();SiteStore.on("change",this.updateState)},componentWillUnmount:function componentWillUnmount(){SiteStore.off("change",this.updateState)},componentWillReceiveProps:function componentWillReceiveProps(nextProps){if(nextProps.post!==this.props.post){this.updateState(nextProps)}},updateState:function updateState(props){var newState=this.getStateFromStores(props);if(newState.site!==this.state.site){this.smartSetState(newState)}},componentDidUpdate:function componentDidUpdate(){this.checkSiteNameForOverflow();this._parseEmoji()},featuredImageComponent:function featuredImageComponent(post){var featuredImage=post.canonical_image&&pick(post.canonical_image,["uri","width","height"]),featuredEmbed=head(filter(post.content_embeds,function(embed){return!startsWith(embed.type,"special-")})),useFeaturedEmbed;if(post.use_excerpt){featuredEmbed=null}if(!(featuredImage||featuredEmbed)){return null}useFeaturedEmbed=featuredEmbed&&(!featuredImage||featuredImage!==post.featured_image&&featuredImage!==get(post,"post_thumbnail.URL"));var featuredAssetProps={featuredImage:featuredImage,featuredEmbed:featuredEmbed,useFeaturedEmbed:useFeaturedEmbed};return React.createElement(FeaturedAsset,featuredAssetProps)},checkSiteNameForOverflow:function checkSiteNameForOverflow(){var headerNode=ReactDom.findDOMNode(this.refs.siteName);if(!headerNode){return}headerNode.classList.toggle("is-long",this.shouldApplyIsLong())},propagateCardClick:function propagateCardClick(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var postToOpen=this.props.post;if(this.state.originalPost){postToOpen=this.state.originalPost}this.props.handleClick(postToOpen,options)},handleCardClick:function handleCardClick(event){var rootNode=ReactDom.findDOMNode(this),selection=window.getSelection&&window.getSelection();if(event.button>0||event.metaKey||event.controlKey||event.shiftKey||event.altKey){if(closest(event.target,".reader__post-title-link",true,rootNode)){stats.recordPermalinkClick("card_title_with_modifier");stats.recordGaEvent("Clicked Post Permalink with Modifier")}return}if(closest(event.target,".should-scroll",true,rootNode)){setTimeout(function(){window.scrollTo(0,0)},100)}if(closest(event.target,".ignore-click, [rel~=external]",true,rootNode)){return}if(closest(event.target,"a",true,rootNode)&&closest(event.target,".reader__full-post-content",true,rootNode)){return}if(selection&&selection.toString()){return}if(!event.defaultPrevented){event.preventDefault();this.propagateCardClick()}},handleCommentButtonClick:function handleCommentButtonClick(){stats.recordAction("click_comments");stats.recordGaEvent("Clicked Post Comment Button");stats.recordTrackForPost("calypso_reader_post_comments_button_clicked",this.props.post);this.propagateCardClick({comments:true})},_parseEmoji:function _parseEmoji(){twemoji.parse(ReactDom.findDOMNode(this))},pickSite:function pickSite(event){if(utils.isSpecialClick(event)){return}var url=readerRoute.getStreamUrlFromPost(this.props.post);page.show(url)},handleSiteClick:function handleSiteClick(event){if(!utils.isSpecialClick(event)){event.preventDefault()}},maybeMarkPostSeen:function maybeMarkPostSeen(liked){if(liked){FeedPostStoreActions.markSeen(this.props.post)}},render:function render(){var _this=this;var post=this.props.post,site=this.state.siteish,featuredImage=this.featuredImageComponent(post),shouldShowComments=PostCommentHelper.shouldShowComments(post),shouldShowLikes=LikeHelper.shouldShowLikes(post),shouldShowShare=ShareHelper.shouldShowShare(post),hasFeaturedImage=featuredImage!==null,articleClasses=assign({reader__card:true,"has-featured-image":hasFeaturedImage,"hide-xpost":this.props.xPostedTo},this.additionalClasses),shouldShowExcerptOnly=!!post.use_excerpt,shouldUseFullExcerpt=!shouldShowExcerptOnly&&post.display_type&DISPLAY_TYPES.ONE_LINER,siteName=utils.siteNameFromSiteAndPost(this.state.site,post),isDiscoverPost=this.state.isDiscoverPost,isDiscoverSitePick=this.state.isDiscoverSitePick,discoverSiteUrl,originalPost=this.state.originalPost,likeSiteId=originalPost?originalPost.site_ID:post.site_ID,likePostId=originalPost?originalPost.ID:post.ID,commentCount=originalPost?originalPost.discussion.comment_count:post.discussion.comment_count,xPostedToContent=null;forOwn(DISPLAY_TYPES,function(value,key){if(post.display_type&&post.display_type&value){articleClasses["is-"+key.toLowerCase().replace("_","-")]=true}});if(shouldShowExcerptOnly){articleClasses["is-excerpt-only"]=true}if(this.props.isSelected){articleClasses["is-selected"]=true}if(post.site_ID){articleClasses["blog-"+post.site_ID]=true}if(post.feed_ID){articleClasses["feed-"+post.feed_ID]=true}if(!this.props.showPostHeader){articleClasses["is-headerless"]=true}forOwn(post.tags,function(_ref){var slug=_ref.slug;articleClasses["tag-"+slug]=true});articleClasses=classnames(articleClasses);if(isDiscoverPost){discoverSiteUrl=DiscoverHelper.getSiteUrl(post)}if(this.props.xPostedTo){xPostedToContent=this.props.xPostedTo.map(function(xPostedTo,index,array){return React.createElement("span",{className:"reader__x-post-site",key:xPostedTo.siteURL+"-"+index},React.createElement("a",{href:xPostedTo.siteURL},xPostedTo.siteName),index+2<array.length?React.createElement("span",null,", "):null,index+2===array.length?React.createElement("span",null," ",_this.translate("and",{comment:"last conjuction in a list of blognames: (blog1, blog2,) blog3 _and_ blog4"})," "):null)})}return React.createElement(Card,{tagName:"article",onClick:this.handleCardClick,className:articleClasses},React.createElement(PostErrors,{post:post}),this.props.showPostHeader?React.createElement(PostHeader,{site:site,siteUrl:post.site_URL,showFollow:this.props.showFollowInHeader,onSiteSelect:this.pickSite,onSiteClick:this.handleSiteClick}):null,featuredImage,post.title?React.createElement("h1",{className:"reader__post-title"},React.createElement("a",{className:"reader__post-title-link",href:post.URL,target:"_blank",rel:"noopener noreferrer"},post.title)):null,React.createElement(PostByline,{post:post,site:this.props.site,isDiscoverPost:isDiscoverPost}),shouldUseFullExcerpt?React.createElement(EmbedContainer,null,React.createElement("div",{key:"full-post-inline",className:"reader__full-post-content",dangerouslySetInnerHTML:{__html:post.content}})):React.createElement(PostExcerpt,{content:post.better_excerpt?post.better_excerpt:post.excerpt}),!shouldShowExcerptOnly?React.createElement(PostImages,{postImages:post.content_images||[]}):null,isDiscoverPost&&post.discover_metadata&&!isDiscoverSitePick?React.createElement(DiscoverPostAttribution,{attribution:post.discover_metadata.attribution,siteUrl:discoverSiteUrl,followUrl:DiscoverHelper.getSourceFollowUrl(post)}):null,isDiscoverSitePick?React.createElement(DiscoverSiteAttribution,{attribution:post.discover_metadata.attribution,siteUrl:discoverSiteUrl,followUrl:DiscoverHelper.getSourceFollowUrl(post)}):null,this.props.xPostedTo?React.createElement("div",{className:"reader__x-post-to"},React.createElement(Gridicon,{icon:"arrow-right",size:24}),React.createElement("span",{className:"reader__x-post-label"},this.translate("cross-posted to")," "),xPostedToContent):null,DailyPostHelper.isDailyPostChallengeOrPrompt(post)?React.createElement(DailyPostButton,{post:post,tagName:"span"}):null,React.createElement("ul",{className:"reader__post-footer"},React.createElement(PostPermalink,{siteName:siteName,postUrl:post.URL}),shouldShowShare?React.createElement(Share,{post:post}):null,shouldShowComments?React.createElement(CommentButton,{onClick:this.handleCommentButtonClick,commentCount:commentCount}):null,shouldShowLikes?React.createElement(LikeButton,{siteId:likeSiteId,postId:likePostId,onLikeToggle:this.maybeMarkPostSeen}):null,React.createElement("li",{className:"reader__post-options"},React.createElement(PostOptions,{post:post,site:this.state.site}))))}});module.exports=Post},3241:function(module,exports,__webpack_require__){"use strict";var ReactDom=__webpack_require__(44),React=__webpack_require__(1),PureRenderMixin=__webpack_require__(111),classnames=__webpack_require__(10),closest=__webpack_require__(729),url=__webpack_require__(70);var Card=__webpack_require__(89),SiteAndAuthorIcon=__webpack_require__(3225);var CrossPost=React.createClass({displayName:"CrossPost",mixins:[PureRenderMixin],propTypes:{post:React.PropTypes.object.isRequired,isSelected:React.PropTypes.bool.isRequired,xMetadata:React.PropTypes.object.isRequired,xPostedTo:React.PropTypes.array,handleClick:React.PropTypes.func.isRequired},handleTitleClick:function handleTitleClick(event){if(event.button>0||event.metaKey||event.controlKey||event.shiftKey||event.altKey){return}event.preventDefault();this.props.handleClick(this.props.xMetadata)},handleCardClick:function handleCardClick(event){var rootNode=ReactDom.findDOMNode(this);if(closest(event.target,".should-scroll",true,rootNode)){setTimeout(function(){window.scrollTo(0,0)},100)}if(closest(event.target,".ignore-click",true,rootNode)){return}if(closest(event.target,"a",true,rootNode)&&closest(event.target,".reader__x-post",true,rootNode)){return}if(event.metaKey||event.controlKey||event.shiftKey||event.altKey){return}if(!event.defaultPrevented){event.preventDefault();this.props.handleClick(this.props.xMetadata)}},getSiteNameFromURL:function getSiteNameFromURL(siteURL){return"+"+url.parse(siteURL).hostname.split(".")[0]},getDescription:function getDescription(authorFirstName){var label=void 0;var siteName=this.getSiteNameFromURL(this.props.xMetadata.siteURL);var isCrossComment=!!this.props.xMetadata.commentURL;if(isCrossComment){label=this.translate("{{author}}%(authorFirstName)s{{/author}} {{label}}left a comment on %(siteName)s, cross-posted to{{/label}} {{blogNames/}}",{args:{siteName:siteName,authorFirstName:authorFirstName},components:{author:React.createElement("span",{className:"reader__x-post-author"}),label:React.createElement("span",{className:"reader__x-post-label"}),blogNames:this.getXPostedToContent()}})}else{label=this.translate("{{author}}%(authorFirstName)s{{/author}} {{label}}cross-posted from %(siteName)s to{{/label}} {{blogNames/}}",{args:{siteName:siteName,authorFirstName:authorFirstName},components:{author:React.createElement("span",{className:"reader__x-post-author"}),label:React.createElement("span",{className:"reader__x-post-label"}),blogNames:this.getXPostedToContent()}})}return label},getXPostedToContent:function getXPostedToContent(){var _this=this;var xPostedToList=this.props.xPostedTo;if(!xPostedToList||xPostedToList.length===0){xPostedToList=[{siteURL:this.props.post.site_URL,siteName:this.getSiteNameFromURL(this.props.post.site_URL)}]}return xPostedToList.map(function(xPostedTo,index,array){return React.createElement("span",{className:"reader__x-post-site",key:xPostedTo.siteURL+"-"+index},xPostedTo.siteName,index+2<array.length?React.createElement("span",null,", "):null,index+2===array.length?React.createElement("span",null," ",_this.translate("and",{comment:"last conjuction in a list of blognames: (blog1, blog2,) blog3 _and_ blog4"})," "):null)})},render:function render(){var post=this.props.post,articleClasses=classnames({reader__card:true,"is-x-post":true,"is-selected":this.props.isSelected});var xpostTitle=post.title;xpostTitle=xpostTitle.replace(/x-post:/i,"");return React.createElement(Card,{tagName:"article",onClick:this.handleCardClick,className:articleClasses},React.createElement(SiteAndAuthorIcon,{siteId:this.props.post.site_ID,isExternal:this.props.post.is_external,user:post.author}),React.createElement("div",{className:"reader__x-post"},post.title?React.createElement("h4",{className:"reader__post-title"},React.createElement("a",{className:"reader__post-title-link",onClick:this.handleTitleClick,href:post.URL,target:"_blank",rel:"noopener noreferrer"},xpostTitle)):null,this.getDescription(post.author.first_name)))}});module.exports=CrossPost},3245:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _noop2=__webpack_require__(38);var _noop3=_interopRequireDefault(_noop2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactRedux=__webpack_require__(15);var _mixin=__webpack_require__(111);var _mixin2=_interopRequireDefault(_mixin);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _documentHead=__webpack_require__(721);var _documentHead2=_interopRequireDefault(_documentHead);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _selectors=__webpack_require__(774);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var UpdateNotice=_react2.default.createClass({displayName:"UpdateNotice",mixins:[_mixin2.default],propTypes:{count:_react2.default.PropTypes.number.isRequired,onClick:_react2.default.PropTypes.func,cappedUnreadCount:_react2.default.PropTypes.string},getDefaultProps:function getDefaultProps(){return{onClick:_noop3.default}},render:function render(){var counterClasses=(0,_classnames2.default)({"reader-update-notice":true,"is-active":this.props.count>0});return _react2.default.createElement("div",{className:counterClasses,onTouchTap:this.handleClick},_react2.default.createElement(_documentHead2.default,{unreadCount:this.props.count}),_react2.default.createElement(_gridicon2.default,{icon:"arrow-up",size:18}),this.translate("%s new post","%s new posts",{args:[this.props.cappedUnreadCount],count:this.props.count}))},handleClick:function handleClick(event){event.preventDefault();this.props.onClick()}});exports.default=(0,_reactRedux.connect)(function(state){return{cappedUnreadCount:(0,_selectors.getDocumentHeadCappedUnreadCount)(state)}})(UpdateNotice);module.exports=exports["default"]},3296:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.recordFollow=recordFollow;exports.recordUnfollow=recordUnfollow;var _debug=__webpack_require__(3);var _debug2=_interopRequireDefault(_debug);var _actionTypes=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var debug=(0,_debug2.default)("calypso:redux:reader-follows");function recordFollow(url){return function(dispatch){debug("User followed "+url);dispatch({type:_actionTypes.READER_FOLLOW,url:url})}}function recordUnfollow(url){return function(dispatch){debug("User unfollowed "+url);dispatch({type:_actionTypes.READER_UNFOLLOW,url:url})}}},3299:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.requestSite=requestSite;exports.updateSites=updateSites;var _get=__webpack_require__(24);var _get2=_interopRequireDefault(_get);var _isArray=__webpack_require__(25);var _isArray2=_interopRequireDefault(_isArray);var _wp=__webpack_require__(28);var _wp2=_interopRequireDefault(_wp);var _actionTypes=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function requestSite(siteId){return function(dispatch){dispatch({type:_actionTypes.READER_SITE_REQUEST,payload:{ID:siteId}});return _wp2.default.undocumented().readSite({site:siteId,meta:"feed"}).then(function success(data){dispatch({type:_actionTypes.READER_SITE_REQUEST_SUCCESS,payload:data});var feedInfo=(0,_get2.default)(data,"meta.data.feed");if(feedInfo){dispatch({type:_actionTypes.READER_FEED_UPDATE,payload:feedInfo})}return data},function failure(err){dispatch({type:_actionTypes.READER_SITE_REQUEST_FAILURE,payload:{ID:siteId},error:err});throw err})}}function updateSites(sites){if(!(0,_isArray2.default)(sites)){sites=[sites]}return{type:_actionTypes.READER_SITE_UPDATE,payload:sites}}},3311:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.toggleReaderSidebarLists=toggleReaderSidebarLists;exports.toggleReaderSidebarTags=toggleReaderSidebarTags;var _actionTypes=__webpack_require__(2);var stats=__webpack_require__(1643);function toggleReaderSidebarLists(){stats.recordAction("sidebar_toggle_lists_menu");stats.recordGaEvent("Toggle Lists Menu");stats.recordTrack("calypso_reader_sidebar_list_toggle");return{type:_actionTypes.READER_SIDEBAR_LISTS_TOGGLE}}function toggleReaderSidebarTags(){stats.recordAction("sidebar_toggle_tags_menu");stats.recordGaEvent("Toggle Tags Menu");stats.recordTrack("calypso_reader_sidebar_tags_toggle");return{type:_actionTypes.READER_SIDEBAR_TAGS_TOGGLE}}},3362:function(module,exports,__webpack_require__){var util=__webpack_require__(3363);function scrollIntoView(elem,container,config){config=config||{};if(container.nodeType===9){container=util.getWindow(container)}var allowHorizontalScroll=config.allowHorizontalScroll;var onlyScrollIfNeeded=config.onlyScrollIfNeeded;var alignWithTop=config.alignWithTop;var alignWithLeft=config.alignWithLeft;allowHorizontalScroll=allowHorizontalScroll===undefined?true:allowHorizontalScroll;var isWin=util.isWindow(container);var elemOffset=util.offset(elem);var eh=util.outerHeight(elem);var ew=util.outerWidth(elem);var containerOffset,ch,cw,containerScroll,diffTop,diffBottom,win,winScroll,ww,wh;if(isWin){win=container;wh=util.height(win);ww=util.width(win);winScroll={left:util.scrollLeft(win),top:util.scrollTop(win)};diffTop={left:elemOffset.left-winScroll.left,top:elemOffset.top-winScroll.top};diffBottom={left:elemOffset.left+ew-(winScroll.left+ww),top:elemOffset.top+eh-(winScroll.top+wh)};containerScroll=winScroll}else{containerOffset=util.offset(container);ch=container.clientHeight;cw=container.clientWidth;containerScroll={left:container.scrollLeft,top:container.scrollTop};diffTop={left:elemOffset.left-(containerOffset.left+(parseFloat(util.css(container,"borderLeftWidth"))||0)),top:elemOffset.top-(containerOffset.top+(parseFloat(util.css(container,"borderTopWidth"))||0))};diffBottom={left:elemOffset.left+ew-(containerOffset.left+cw+(parseFloat(util.css(container,"borderRightWidth"))||0)),top:elemOffset.top+eh-(containerOffset.top+ch+(parseFloat(util.css(container,"borderBottomWidth"))||0))}}if(diffTop.top<0||diffBottom.top>0){if(alignWithTop===true){util.scrollTop(container,containerScroll.top+diffTop.top)}else if(alignWithTop===false){util.scrollTop(container,containerScroll.top+diffBottom.top)}else{if(diffTop.top<0){util.scrollTop(container,containerScroll.top+diffTop.top)}else{util.scrollTop(container,containerScroll.top+diffBottom.top)}}}else{if(!onlyScrollIfNeeded){alignWithTop=alignWithTop===undefined?true:!!alignWithTop;if(alignWithTop){util.scrollTop(container,containerScroll.top+diffTop.top)}else{util.scrollTop(container,containerScroll.top+diffBottom.top)}}}if(allowHorizontalScroll){if(diffTop.left<0||diffBottom.left>0){if(alignWithLeft===true){util.scrollLeft(container,containerScroll.left+diffTop.left)}else if(alignWithLeft===false){util.scrollLeft(container,containerScroll.left+diffBottom.left)}else{if(diffTop.left<0){util.scrollLeft(container,containerScroll.left+diffTop.left)}else{util.scrollLeft(container,containerScroll.left+diffBottom.left)}}}else{if(!onlyScrollIfNeeded){alignWithLeft=alignWithLeft===undefined?true:!!alignWithLeft;if(alignWithLeft){util.scrollLeft(container,containerScroll.left+diffTop.left)}else{util.scrollLeft(container,containerScroll.left+diffBottom.left)}}}}}module.exports=scrollIntoView},3363:function(module,exports){var RE_NUM=/[\-+]?(?:\d*\.|)\d+(?:[eE][\-+]?\d+|)/.source;function getClientPosition(elem){var box,x,y;var doc=elem.ownerDocument;var body=doc.body;var docElem=doc&&doc.documentElement;box=elem.getBoundingClientRect();x=box.left;y=box.top;x-=docElem.clientLeft||body.clientLeft||0;y-=docElem.clientTop||body.clientTop||0;return{left:x,top:y}}function getScroll(w,top){var ret=w["page"+(top?"Y":"X")+"Offset"];var method="scroll"+(top?"Top":"Left");if(typeof ret!=="number"){var d=w.document;ret=d.documentElement[method];if(typeof ret!=="number"){ret=d.body[method]}}return ret}function getScrollLeft(w){return getScroll(w)}function getScrollTop(w){return getScroll(w,true)}function getOffset(el){var pos=getClientPosition(el);var doc=el.ownerDocument;var w=doc.defaultView||doc.parentWindow;pos.left+=getScrollLeft(w);pos.top+=getScrollTop(w);return pos}function _getComputedStyle(elem,name,computedStyle){var val="";var d=elem.ownerDocument;if(computedStyle=computedStyle||d.defaultView.getComputedStyle(elem,null)){val=computedStyle.getPropertyValue(name)||computedStyle[name]}return val}var _RE_NUM_NO_PX=new RegExp("^("+RE_NUM+")(?!px)[a-z%]+$","i");var RE_POS=/^(top|right|bottom|left)$/,CURRENT_STYLE="currentStyle",RUNTIME_STYLE="runtimeStyle",LEFT="left",PX="px";function _getComputedStyleIE(elem,name){var ret=elem[CURRENT_STYLE]&&elem[CURRENT_STYLE][name];if(_RE_NUM_NO_PX.test(ret)&&!RE_POS.test(name)){var style=elem.style,left=style[LEFT],rsLeft=elem[RUNTIME_STYLE][LEFT];elem[RUNTIME_STYLE][LEFT]=elem[CURRENT_STYLE][LEFT];style[LEFT]=name==="fontSize"?"1em":ret||0;ret=style.pixelLeft+PX;style[LEFT]=left;elem[RUNTIME_STYLE][LEFT]=rsLeft}return ret===""?"auto":ret}var getComputedStyleX;if(typeof window!=="undefined"){getComputedStyleX=window.getComputedStyle?_getComputedStyle:_getComputedStyleIE}function setOffset(elem,offset){if(css(elem,"position")==="static"){elem.style.position="relative"}var old=getOffset(elem),ret={},current,key;for(key in offset){current=parseFloat(css(elem,key))||0;ret[key]=current+offset[key]-old[key]}css(elem,ret)}function each(arr,fn){for(var i=0;i<arr.length;i++){fn(arr[i])}}function isBorderBoxFn(elem){return getComputedStyleX(elem,"boxSizing")==="border-box"}var BOX_MODELS=["margin","border","padding"],CONTENT_INDEX=-1,PADDING_INDEX=2,BORDER_INDEX=1,MARGIN_INDEX=0;function swap(elem,options,callback){var old={},style=elem.style,name;for(name in options){old[name]=style[name];style[name]=options[name]}callback.call(elem);for(name in options){style[name]=old[name]}}function getPBMWidth(elem,props,which){var value=0,prop,j,i;for(j=0;j<props.length;j++){prop=props[j];if(prop){for(i=0;i<which.length;i++){var cssProp;if(prop==="border"){cssProp=prop+which[i]+"Width"}else{cssProp=prop+which[i]}value+=parseFloat(getComputedStyleX(elem,cssProp))||0}}}return value}function isWindow(obj){return obj!=null&&obj==obj.window}var domUtils={};each(["Width","Height"],function(name){domUtils["doc"+name]=function(refWin){var d=refWin.document;return Math.max(d.documentElement["scroll"+name],d.body["scroll"+name],domUtils["viewport"+name](d))};domUtils["viewport"+name]=function(win){var prop="client"+name,doc=win.document,body=doc.body,documentElement=doc.documentElement,documentElementProp=documentElement[prop];return doc.compatMode==="CSS1Compat"&&documentElementProp||body&&body[prop]||documentElementProp}});function getWH(elem,name,extra){if(isWindow(elem)){return name==="width"?domUtils.viewportWidth(elem):domUtils.viewportHeight(elem)}else if(elem.nodeType===9){return name==="width"?domUtils.docWidth(elem):domUtils.docHeight(elem)}var which=name==="width"?["Left","Right"]:["Top","Bottom"],borderBoxValue=name==="width"?elem.offsetWidth:elem.offsetHeight;var computedStyle=getComputedStyleX(elem);var isBorderBox=isBorderBoxFn(elem,computedStyle);var cssBoxValue=0;if(borderBoxValue==null||borderBoxValue<=0){borderBoxValue=undefined;cssBoxValue=getComputedStyleX(elem,name);if(cssBoxValue==null||Number(cssBoxValue)<0){cssBoxValue=elem.style[name]||0}cssBoxValue=parseFloat(cssBoxValue)||0}if(extra===undefined){extra=isBorderBox?BORDER_INDEX:CONTENT_INDEX}var borderBoxValueOrIsBorderBox=borderBoxValue!==undefined||isBorderBox;var val=borderBoxValue||cssBoxValue;if(extra===CONTENT_INDEX){if(borderBoxValueOrIsBorderBox){return val-getPBMWidth(elem,["border","padding"],which,computedStyle)}else{return cssBoxValue}}else if(borderBoxValueOrIsBorderBox){return val+(extra===BORDER_INDEX?0:extra===PADDING_INDEX?-getPBMWidth(elem,["border"],which,computedStyle):getPBMWidth(elem,["margin"],which,computedStyle))}else{return cssBoxValue+getPBMWidth(elem,BOX_MODELS.slice(extra),which,computedStyle)}}var cssShow={position:"absolute",visibility:"hidden",display:"block"};function getWHIgnoreDisplay(elem){var val,args=arguments;if(elem.offsetWidth!==0){val=getWH.apply(undefined,args)}else{swap(elem,cssShow,function(){val=getWH.apply(undefined,args)})}return val}each(["width","height"],function(name){var first=name.charAt(0).toUpperCase()+name.slice(1);domUtils["outer"+first]=function(el,includeMargin){return el&&getWHIgnoreDisplay(el,name,includeMargin?MARGIN_INDEX:BORDER_INDEX)};var which=name==="width"?["Left","Right"]:["Top","Bottom"];domUtils[name]=function(elem,val){if(val!==undefined){if(elem){var computedStyle=getComputedStyleX(elem);var isBorderBox=isBorderBoxFn(elem);if(isBorderBox){val+=getPBMWidth(elem,["padding","border"],which,computedStyle)}return css(elem,name,val)}return}return elem&&getWHIgnoreDisplay(elem,name,CONTENT_INDEX)}});function css(el,name,value){if(typeof name==="object"){for(var i in name){css(el,i,name[i])}return}if(typeof value!=="undefined"){if(typeof value==="number"){value=value+"px"}el.style[name]=value}else{return getComputedStyleX(el,name)}}function mix(to,from){for(var i in from){to[i]=from[i]}return to}var utils=module.exports={getWindow:function(node){var doc=node.ownerDocument||node;return doc.defaultView||doc.parentWindow},offset:function(el,value){if(typeof value!=="undefined"){setOffset(el,value)}else{return getOffset(el)}},isWindow:isWindow,each:each,css:css,clone:function(obj){var ret={};for(var i in obj){ret[i]=obj[i]}var overflow=obj.overflow;if(overflow){for(i in obj){ret.overflow[i]=obj.overflow[i]}}return ret},mix:mix,scrollLeft:function(w,v){if(isWindow(w)){if(v===undefined){return getScrollLeft(w)}else{window.scrollTo(v,getScrollTop(w))}}else{if(v===undefined){return w.scrollLeft}else{w.scrollLeft=v}}},scrollTop:function(w,v){if(isWindow(w)){if(v===undefined){return getScrollTop(w)}else{window.scrollTo(getScrollLeft(w),v)}}else{if(v===undefined){return w.scrollTop}else{w.scrollTop=v}}},merge:function(){var ret={};for(var i=0;i<arguments.length;i++){utils.mix(ret,arguments[i])}return ret},viewportWidth:0,viewportHeight:0};mix(utils,domUtils)},3485:function(module,exports){function baseIndexOfWith(array,value,fromIndex,comparator){var index=fromIndex-1,length=array.length;while(++index<length){if(comparator(array[index],value)){return index}}return-1}module.exports=baseIndexOfWith},3489:function(module,exports,__webpack_require__){var arrayMap=__webpack_require__(72),baseIndexOf=__webpack_require__(228),baseIndexOfWith=__webpack_require__(3485),baseUnary=__webpack_require__(144),copyArray=__webpack_require__(124);var arrayProto=Array.prototype;var splice=arrayProto.splice;function basePullAll(array,values,iteratee,comparator){var indexOf=comparator?baseIndexOfWith:baseIndexOf,index=-1,length=values.length,seen=array;if(array===values){values=copyArray(values)}if(iteratee){seen=arrayMap(array,baseUnary(iteratee))}while(++index<length){var fromIndex=0,value=values[index],computed=iteratee?iteratee(value):value;while((fromIndex=indexOf(seen,computed,fromIndex,comparator))>-1){if(seen!==array){splice.call(seen,fromIndex,1)}splice.call(array,fromIndex,1)}}return array}module.exports=basePullAll},3504:function(module,exports,__webpack_require__){var baseFindIndex=__webpack_require__(440),baseIteratee=__webpack_require__(35),toInteger=__webpack_require__(65);var nativeMax=Math.max,nativeMin=Math.min;function findLastIndex(array,predicate,fromIndex){var length=array?array.length:0;if(!length){return-1}var index=length-1;if(fromIndex!==undefined){
index=toInteger(fromIndex);index=fromIndex<0?nativeMax(length+index,0):nativeMin(index,length-1)}return baseFindIndex(array,baseIteratee(predicate,3),index,true)}module.exports=findLastIndex},3516:function(module,exports,__webpack_require__){var baseRest=__webpack_require__(50),pullAll=__webpack_require__(3517);var pull=baseRest(pullAll);module.exports=pull},3517:function(module,exports,__webpack_require__){var basePullAll=__webpack_require__(3489);function pullAll(array,values){return array&&array.length&&values&&values.length?basePullAll(array,values):array}module.exports=pullAll},3527:function(module,exports,__webpack_require__){var identity=__webpack_require__(99),partial=__webpack_require__(286);function wrap(value,wrapper){wrapper=wrapper==null?identity:wrapper;return partial(wrapper,value)}module.exports=wrap},3533:function(module,exports){"use strict";module.exports=function(opts){opts=opts||{};var reg="(\\d+(\\.\\d+)?|\\.\\d+) ?%";return opts.exact?new RegExp("^"+reg+"$","i"):new RegExp(reg,"ig")}},3558:function(module,exports,__webpack_require__){"use strict";var numberIsNan=__webpack_require__(866);var arrayUniq=__webpack_require__(2428);var reInt=/^\d+$/;function deepUnique(arr){return arr.sort().filter(function(el,i){return JSON.stringify(el)!==JSON.stringify(arr[i-1])})}exports.parse=function(str){return deepUnique(str.split(",").map(function(el){var ret={};el.trim().split(/\s+/).forEach(function(el,i){if(i===0){return ret.url=el}var value=el.substring(0,el.length-1);var postfix=el[el.length-1];var intVal=parseInt(value,10);var floatVal=parseFloat(value);if(postfix==="w"&&reInt.test(value)){ret.width=intVal}else if(postfix==="h"&&reInt.test(value)){ret.height=intVal}else if(postfix==="x"&&!numberIsNan(floatVal)){ret.density=floatVal}else{throw new Error("Invalid srcset descriptor: "+el+".")}});return ret}))};exports.stringify=function(arr){return arrayUniq(arr.map(function(el){if(!el.url){throw new Error("URL is required.")}var ret=[el.url];if(el.width){ret.push(el.width+"w")}if(el.height){ret.push(el.height+"h")}if(el.density){ret.push(el.density+"x")}return ret.join(" ")})).join(", ")}}});