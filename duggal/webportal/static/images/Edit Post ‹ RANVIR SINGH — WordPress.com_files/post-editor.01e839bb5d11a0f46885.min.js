webpackJsonp([2],{435:function(module,exports,__webpack_require__){"use strict";var _config=__webpack_require__(12);var _config2=_interopRequireDefault(_config);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var page=__webpack_require__(33);var sitesController=__webpack_require__(720),controller=__webpack_require__(3099);module.exports=function(){page("/post",controller.pressThis,sitesController.siteSelection,sitesController.sites);page("/post/new",function(){return page.redirect("/post")});page("/post/:site?/:post?",sitesController.siteSelection,sitesController.fetchJetpackSettings,controller.post);page("/page",sitesController.siteSelection,sitesController.sites);page("/page/new",function(){return page.redirect("/page")});page("/page/:site?/:post?",sitesController.siteSelection,sitesController.fetchJetpackSettings,controller.post);if(_config2.default.isEnabled("manage/custom-post-types")){page("/edit/:type",sitesController.siteSelection,sitesController.sites);page("/edit/:type/new",function(context){return page.redirect("/edit/"+context.params.type)});page("/edit/:type/:site?/:post?",sitesController.siteSelection,sitesController.fetchJetpackSettings,controller.post)}}},1647:function(module,exports,__webpack_require__){"use strict";var _assign=__webpack_require__(5);var _assign2=_interopRequireDefault(_assign);var _url=__webpack_require__(70);var _url2=_interopRequireDefault(_url);var _path=__webpack_require__(1869);var _path2=_interopRequireDefault(_path);var _photon=__webpack_require__(750);var _photon2=_interopRequireDefault(_photon);var _includes=__webpack_require__(30);var _includes2=_interopRequireDefault(_includes);var _omitBy=__webpack_require__(102);var _omitBy2=_interopRequireDefault(_omitBy);var _validUrl=__webpack_require__(2024);var _resizeImageUrl=__webpack_require__(1769);var _resizeImageUrl2=_interopRequireDefault(_resizeImageUrl);var _constants=__webpack_require__(1716);var _shortcode=__webpack_require__(1719);var _shortcode2=_interopRequireDefault(_shortcode);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var REGEXP_VIDEOPRESS_GUID=/^[a-z\d]+$/i;var MediaUtils={url:function url(media,options){if(!media){return}if(media.transient){return media.URL}if(!media.URL){return}options=options||{};if(options.photon){if(options.maxWidth){return(0,_photon2.default)(media.URL,{width:options.maxWidth})}return(0,_photon2.default)(media.URL)}if(media.thumbnails&&options.size in media.thumbnails){return media.thumbnails[options.size]}if(options.maxWidth){return(0,_resizeImageUrl2.default)(media.URL,{w:options.maxWidth})}return media.URL},getFileExtension:function getFileExtension(media){var extension=void 0;if(!media){return}var isString="string"===typeof media;var isFileObject="File"in window&&media instanceof window.File;if(isString){var filePath=void 0;if((0,_validUrl.isUri)(media)){filePath=_url2.default.parse(media).pathname}else{filePath=media}extension=_path2.default.extname(filePath).slice(1)}else if(isFileObject){extension=_path2.default.extname(media.name).slice(1)}else if(media.extension){extension=media.extension}else{var pathname=_url2.default.parse(media.URL||media.file||media.guid||"").pathname||"";extension=_path2.default.extname(pathname).slice(1)}return extension},getMimePrefix:function getMimePrefix(media){var mimeType=MediaUtils.getMimeType(media),mimePrefixMatch;if(!mimeType){return}mimePrefixMatch=mimeType.match(/^([^\/]+)\//);if(mimePrefixMatch){return mimePrefixMatch[1]}},getMimeType:function getMimeType(media){if(!media){return}if(media.mime_type){return media.mime_type}else if("File"in window&&media instanceof window.File){return media.type}var extension=MediaUtils.getFileExtension(media);if(!extension){return}extension=extension.toLowerCase();if(_constants.MimeTypes.hasOwnProperty(extension)){return _constants.MimeTypes[extension]}},filterItemsByMimePrefix:function filterItemsByMimePrefix(items,mimePrefix){return items.filter(function(item){return MediaUtils.getMimePrefix(item)===mimePrefix})},sortItemsByDate:function sortItemsByDate(items){var copy=items.slice(0);copy.sort(function(a,b){var dateCompare;if(a.date&&b.date){dateCompare=Date.parse(b.date)-Date.parse(a.date);if(0!==dateCompare){return dateCompare}}return b.ID-a.ID});return copy},isSiteAllowedFileTypesToBeTrusted:function isSiteAllowedFileTypesToBeTrusted(site){return!site||!site.jetpack||site.versionCompare("3.8.1",">=")},getAllowedFileTypesForSite:function getAllowedFileTypesForSite(site){if(!site){return[]}return site.options.allowed_file_types},isSupportedFileTypeInPremium:function isSupportedFileTypeInPremium(item,site){if(!site||!item){return false}if(!MediaUtils.isSiteAllowedFileTypesToBeTrusted(site)){return true}return _constants.VideoPressFileTypes.some(function(allowed){return allowed.toLowerCase()===item.extension.toLowerCase()})},isSupportedFileTypeForSite:function isSupportedFileTypeForSite(item,site){if(!site||!item){return false}if(!MediaUtils.isSiteAllowedFileTypesToBeTrusted(site)){return true}return MediaUtils.getAllowedFileTypesForSite(site).some(function(allowed){return allowed.toLowerCase()===item.extension.toLowerCase()})},isExceedingSiteMaxUploadSize:function isExceedingSiteMaxUploadSize(bytes,site){if(!isFinite(bytes)||!site||!site.options||!site.options.max_upload_size){return null}return bytes>site.options.max_upload_size},isVideoPressItem:function isVideoPressItem(item){if(!item||!item.videopress_guid){return false}return REGEXP_VIDEOPRESS_GUID.test(item.videopress_guid)},playtime:function playtime(duration){if(isNaN(duration)){return}var hours=Math.floor(duration/3600),minutes=Math.floor(duration/60)%60,seconds=Math.floor(duration)%60;var playtime=[minutes,seconds].map(function(value){return("0"+value).slice(-2)}).join(":");if(hours){playtime=[hours,playtime].join(":")}playtime=playtime.replace(/^(00:)+/g,"");if(-1===playtime.indexOf(":")){playtime="0:"+playtime}return playtime.replace(/^0(\d)(.*)/,"$1$2")},getThumbnailSizeDimensions:function getThumbnailSizeDimensions(size,site){var width,height;if(site&&site.options){width=site.options["image_"+size+"_width"];height=site.options["image_"+size+"_height"]}if(size in _constants.ThumbnailSizeDimensions){width=width||_constants.ThumbnailSizeDimensions[size].width;height=height||_constants.ThumbnailSizeDimensions[size].height}return{width:width,height:height}},generateGalleryShortcode:function generateGalleryShortcode(settings){var attrs;if(!settings.items.length){return}attrs=(0,_assign2.default)({ids:settings.items.map(function(item){return item.ID}).join()},settings);delete attrs.items;if(!(0,_includes2.default)(_constants.GalleryColumnedTypes,attrs.type)){delete attrs.columns}if(!(0,_includes2.default)(_constants.GallerySizeableTypes,attrs.type)){delete attrs.size}attrs=(0,_omitBy2.default)(attrs,function(value,key){return _constants.GalleryDefaultAttrs[key]===value});if(attrs.orderBy){attrs.orderby=attrs.orderBy;delete attrs.orderBy}return _shortcode2.default.stringify({tag:"gallery",type:"single",attrs:attrs})},canUserDeleteItem:function canUserDeleteItem(item,user,site){if(user.ID===item.author_ID){return site.capabilities.delete_posts}return site.capabilities.delete_others_posts},canvasToBlob:function canvasToBlob(canvas,callback,type,quality){if(!HTMLCanvasElement.prototype.toBlob){Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function value(polyfillCallback,polyfillType,polyfillQuality){var binStr=atob(this.toDataURL(polyfillType,polyfillQuality).split(",")[1]),len=binStr.length,arr=new Uint8Array(len);for(var i=0;i<len;i++){arr[i]=binStr.charCodeAt(i)}polyfillCallback(new Blob([arr],{type:polyfillType||"image/png"}))}})}canvas.toBlob(callback,type,quality)},isItemBeingUploaded:function isItemBeingUploaded(item){if(!item){return null}return!!item.transient}};module.exports=MediaUtils},1648:function(module,exports,__webpack_require__){"use strict";var _keys=__webpack_require__(39);var _keys2=_interopRequireDefault(_keys);var _utils=__webpack_require__(294);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var debug=__webpack_require__(3)("calypso:posts"),defer=__webpack_require__(385),store=__webpack_require__(46),clone=__webpack_require__(212),fromPairs=__webpack_require__(402),assign=__webpack_require__(34);var wpcom=__webpack_require__(28),PostsStore=__webpack_require__(1727),PostEditStore=__webpack_require__(1687),postListStoreFactory=__webpack_require__(1726),PreferencesStore=__webpack_require__(747),sites=__webpack_require__(53)(),utils=__webpack_require__(1649),versionCompare=__webpack_require__(398),Dispatcher=__webpack_require__(42),stats=__webpack_require__(1651);var PostActions;function handleMetadataOperation(key,value,operation){var post=PostEditStore.get(),metadata;if("string"===typeof key||Array.isArray(key)){key=fromPairs([].concat(key).map(function(meta){return[meta,value]}))}metadata=(post.metadata||[]).filter(function(meta){return!key.hasOwnProperty(meta.key)});(0,_keys2.default)(key).forEach(function(objectKey){var meta={key:objectKey,operation:operation};if("delete"!==operation){meta.value=key[objectKey]}metadata.push(meta)});Dispatcher.handleViewAction({type:"EDIT_POST",post:{metadata:metadata}})}function normalizeApiAttributes(attributes){attributes=clone(attributes);attributes=(0,_utils.normalizeTermsForApi)(attributes);if(attributes.author){attributes.author=attributes.author.ID}return attributes}PostActions={startEditingNew:function startEditingNew(siteId,options){var args;options=options||{};args={type:"DRAFT_NEW_POST",siteId:siteId,postType:options.type||"post",title:options.title,content:options.content};Dispatcher.handleViewAction(args)},startEditingExisting:function startEditingExisting(siteId,postId){var currentPost=PostEditStore.get(),postHandle;if(!siteId){return}if(currentPost&&currentPost.site_ID===siteId&&currentPost.ID===postId){return}Dispatcher.handleViewAction({type:"START_EDITING_POST",siteId:siteId,postId:postId});postHandle=wpcom.site(siteId).post(postId);postHandle.get({context:"edit",meta:"autosave"},function(error,data){Dispatcher.handleServerAction({type:"RECEIVE_POST_TO_EDIT",error:error,post:data})})},stopEditing:function stopEditing(){Dispatcher.handleViewAction({type:"STOP_EDITING_POST"})},autosave:function autosave(callback){var post=PostEditStore.get(),savedPost=PostEditStore.getSavedPost(),siteHandle=wpcom.undocumented().site(post.site_ID),site;callback=callback||function(){};if(!PostEditStore.isDirty()){return callback(new Error("NOT_DIRTY"))}store.set("wpcom-autosave:"+post.site_ID+":"+post.ID,post);if(utils.isPublished(savedPost)||utils.isPublished(post)){site=sites.getSite(post.site_ID);if(!post.ID||!site||site.jetpack&&versionCompare(site.options.jetpack_version,"3.7.0-dev","<")){return callback(new Error("NO_AUTOSAVE"))}Dispatcher.handleViewAction({type:"POST_AUTOSAVE",post:post});siteHandle.postAutosave(post.ID,{content:post.content,title:post.title,excerpt:post.excerpt},function(error,data){Dispatcher.handleServerAction({type:"RECEIVE_POST_AUTOSAVE",error:error,autosave:data});callback(error,data)})}else{PostActions.saveEdited(null,callback,{recordSaveEvent:false})}},blockSave:function blockSave(key){Dispatcher.handleViewAction({type:"BLOCK_EDIT_POST_SAVE",key:key})},unblockSave:function unblockSave(key){Dispatcher.handleViewAction({type:"UNBLOCK_EDIT_POST_SAVE",key:key})},edit:function edit(attributes){Dispatcher.handleViewAction({type:"EDIT_POST",post:attributes})},editRawContent:function editRawContent(content){Dispatcher.handleViewAction({type:"EDIT_POST_RAW_CONTENT",content:content})},resetRawContent:function resetRawContent(){Dispatcher.handleViewAction({type:"RESET_POST_RAW_CONTENT"})},updateMetadata:function updateMetadata(key,value){handleMetadataOperation(key,value,"update")},deleteMetadata:function deleteMetadata(key){handleMetadataOperation(key,null,"delete")},saveEdited:function saveEdited(attributes,callback,options){var post,postHandle,query,changedAttributes,rawContent,mode,isNew;Dispatcher.handleViewAction({type:"EDIT_POST",post:attributes});post=PostEditStore.get();if(!PostEditStore.hasContent()){defer(callback,new Error("NO_CONTENT"),post);return}if(PostEditStore.isSaveBlocked()){defer(callback,new Error("SAVE_BLOCKED"),post);return}changedAttributes=PostEditStore.getChangedAttributes();if(!(0,_keys2.default)(changedAttributes).length){defer(callback,new Error("NO_CHANGE"),post);return}changedAttributes=normalizeApiAttributes(changedAttributes);rawContent=PostEditStore.getRawContent();mode=PreferencesStore.get("editor-mode");isNew=!post.ID;Dispatcher.handleViewAction({type:"EDIT_POST_SAVE"});postHandle=wpcom.site(post.site_ID).post(post.ID);query={context:"edit",apiVersion:"1.2"};if(!options||options.recordSaveEvent!==false){stats.recordSaveEvent()}if(changedAttributes&&changedAttributes.status==="future"&&utils.isFutureDated(post)||changedAttributes&&changedAttributes.status==="publish"&&utils.isBackDated(post)){changedAttributes=assign({},changedAttributes,{status:"publish",date:post.date})}postHandle[isNew?"add":"update"](query,changedAttributes,function(error,data){var original,currentMode;currentMode=PreferencesStore.get("editor-mode");if(!error){original=PostsStore.get(data.global_ID)}Dispatcher.handleServerAction({type:"RECEIVE_POST_BEING_EDITED",error:error,rawContent:mode===currentMode?rawContent:null,isNew:isNew,original:original,post:data});callback(error,data)})},update:function update(post,attributes,callback){var postHandle=wpcom.site(post.site_ID).post(post.ID);postHandle.update(attributes,PostActions.receiveUpdate.bind(null,callback))},trash:function trash(post,callback){var postHandle=wpcom.site(post.site_ID).post(post.ID);postHandle.delete(PostActions.receiveUpdate.bind(null,callback))},restore:function restore(post,callback){var postHandle=wpcom.site(post.site_ID).post(post.ID);postHandle.restore(PostActions.receiveUpdate.bind(null,callback))},queryPosts:function queryPosts(options){var postListStoreId=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"default";Dispatcher.handleViewAction({type:"QUERY_POSTS",options:options,postListStoreId:postListStoreId})},fetchNextPage:function fetchNextPage(){var postListStoreId=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"default";var params,id,siteID,postListStore;postListStore=postListStoreFactory(postListStoreId);if(postListStore.isLastPage()||postListStore.isFetchingNextPage()){return}Dispatcher.handleViewAction({type:"FETCH_NEXT_POSTS_PAGE",postListStoreId:postListStoreId});id=postListStore.getID();params=postListStore.getNextPageParams();siteID=postListStore.getSiteID();if(siteID){wpcom.site(siteID).postsList(params,PostActions.receivePage.bind(null,id,postListStoreId))}else{wpcom.me().postsList(params,PostActions.receivePage.bind(null,id,postListStoreId))}},receivePage:function receivePage(id,postListStoreId,error,data){Dispatcher.handleServerAction({type:"RECEIVE_POSTS_PAGE",id:id,postListStoreId:postListStoreId,error:error,data:data})},fetchUpdated:function fetchUpdated(){var postListStoreId=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"default";var id,params,siteID,postListStore;postListStore=postListStoreFactory(postListStoreId);if(postListStore.isFetchingNextPage()){return}Dispatcher.handleViewAction({type:"FETCH_UPDATED_POSTS",postListStoreId:postListStoreId});id=postListStore.getID();params=postListStore.getUpdatesParams();siteID=postListStore.getSiteID();if(siteID){debug("Fetching posts that have been updated for %s since %s %o",siteID,params.modified_after,params);wpcom.site(siteID).postsList(params,PostActions.receiveUpdated.bind(null,id,postListStoreId))}else{debug("Fetching posts that have been updated since %s %o",params.modified_after,params);wpcom.me().postsList(params,PostActions.receiveUpdated.bind(null,id,postListStoreId))}},receiveUpdated:function receiveUpdated(id,postListStoreId,error,data){Dispatcher.handleServerAction({type:"RECEIVE_UPDATED_POSTS",id:id,postListStoreId:postListStoreId,error:error,data:data})},receiveUpdate:function receiveUpdate(callback,error,data){var original;if(!error){original=PostsStore.get(data.global_ID)}Dispatcher.handleServerAction({type:"RECEIVE_UPDATED_POST",error:error,original:original,post:data});callback(error,data)},fetchCounts:function fetchCounts(siteId,options){Dispatcher.handleViewAction({type:"FETCH_POST_COUNTS",siteId:siteId});wpcom.undocumented().site(siteId).postCounts(options,function(error,data){Dispatcher.handleServerAction({type:"RECEIVE_POST_COUNTS",error:error,data:data,siteId:siteId})})}};module.exports=PostActions},1651:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.recordStat=recordStat;exports.recordEvent=recordEvent;exports.recordSaveEvent=recordSaveEvent;exports.recordTinyMCEButtonClick=recordTinyMCEButtonClick;exports.recordTinyMCEHTMLButtonClick=recordTinyMCEHTMLButtonClick;var _debug=__webpack_require__(3);var _debug2=_interopRequireDefault(_debug);var _noop=__webpack_require__(38);var _noop2=_interopRequireDefault(_noop);var _config=__webpack_require__(12);var _config2=_interopRequireDefault(_config);var _analytics=__webpack_require__(20);var _analytics2=_interopRequireDefault(_analytics);var _postEditStore=__webpack_require__(1687);var _postEditStore2=_interopRequireDefault(_postEditStore);var _utils=__webpack_require__(1649);var _utils2=_interopRequireDefault(_utils);var _sitesList=__webpack_require__(53);var _sitesList2=_interopRequireDefault(_sitesList);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var debug=(0,_debug2.default)("calypso:posts:stats");var sites=new _sitesList2.default;function recordUsageStats(action,postType){var source=void 0;var site=sites.getSelectedSite();_analytics2.default.mc.bumpStat("editor_usage",action);if(site){source=site.jetpack?"jetpack":"wpcom";_analytics2.default.mc.bumpStat("editor_usage_"+source,action);if(postType){_analytics2.default.mc.bumpStat("editor_cpt_usage_"+source,postType+"_"+action)}}}function recordStat(action){_analytics2.default.mc.bumpStat("editor_actions",action)}function recordEvent(action,label,value){_analytics2.default.ga.recordEvent("Editor",action,label,value)}function recordSaveEvent(){var post=_postEditStore2.default.get();var savedPost=_postEditStore2.default.getSavedPost();if(!post||!savedPost){return}var currentStatus=savedPost.status;var nextStatus=post.status;var tracksEventName="calypso_editor_"+post.type+"_";var statName=false;var statEvent=false;var usageAction=false;if(!post.ID&&!_utils2.default.isPublished(post)){tracksEventName+="savedraft"}else if("draft"===nextStatus){tracksEventName+="savedraft"}else if(currentStatus===nextStatus){usageAction="edit";tracksEventName+="update"}else if("publish"===nextStatus||"private"===nextStatus){tracksEventName+="publish";usageAction="new"}else if("pending"===nextStatus){tracksEventName+="pending"}else if("future"===nextStatus){tracksEventName+="schedule";statName="status-schedule";statEvent="Scheduled Post"}if(usageAction){recordUsageStats(usageAction,post.type)}if(statName){recordStat(statName)}if(statEvent){recordEvent(statEvent)}debug("recordSaveEvent %s currentStatus=%s nextStatus=%s",tracksEventName,currentStatus,nextStatus);_analytics2.default.tracks.recordEvent(tracksEventName,{post_id:post.ID,post_type:post.type,visibility:_utils2.default.getVisibility(post),current_status:currentStatus,next_status:nextStatus})}var shouldBumpStat=Math.random()<=.01||(0,_config2.default)("env")==="development";var maybeBumpStat=shouldBumpStat?_analytics2.default.mc.bumpStat:_noop2.default;function recordTinyMCEButtonClick(buttonName){maybeBumpStat("editor-button","calypso_"+buttonName);_analytics2.default.ga.recordEvent("Editor","Clicked TinyMCE Button",buttonName);debug("TinyMCE button click",buttonName,"mc=",shouldBumpStat)}function recordTinyMCEHTMLButtonClick(buttonName){maybeBumpStat("html-editor-button","calypso_"+buttonName);_analytics2.default.ga.recordEvent("Editor","Clicked TinyMCE HTML Button",buttonName);debug("TinyMCE HTML button click",buttonName,"mc=",shouldBumpStat)}},1658:function(module,exports,__webpack_require__){var moment=__webpack_require__(4);function ParsedResult(result){result=result||{};this.ref=result.ref;this.index=result.index;this.text=result.text;this.tags=result.tags||{};this.start=new ParsedComponents(result.start,result.ref);if(result.end){this.end=new ParsedComponents(result.end,result.ref)}}ParsedResult.prototype.clone=function(){var result=new ParsedResult(this);result.tags=JSON.parse(JSON.stringify(this.tags));result.start=this.start.clone();if(this.end){result.end=this.end.clone()}};ParsedResult.prototype.hasPossibleDates=function(){return this.start.isPossibleDate()&&(!this.end||this.end.isPossibleDate())};function ParsedComponents(components,ref){this.knownValues={};this.impliedValues={};if(components){for(key in components){this.knownValues[key]=components[key]}}if(ref){ref=moment(ref);this.imply("day",ref.date());this.imply("month",ref.month()+1);this.imply("year",ref.year())}this.imply("hour",12);this.imply("minute",0);this.imply("second",0);this.imply("millisecond",0)}ParsedComponents.prototype.clone=function(){var component=new ParsedComponents;component.knownValues=JSON.parse(JSON.stringify(this.knownValues));component.impliedValues=JSON.parse(JSON.stringify(this.impliedValues));return component};ParsedComponents.prototype.get=function(component,value){if(component in this.knownValues)return this.knownValues[component];if(component in this.impliedValues)return this.impliedValues[component]};ParsedComponents.prototype.assign=function(component,value){this.knownValues[component]=value;delete this.impliedValues[component]};ParsedComponents.prototype.imply=function(component,value){if(component in this.knownValues)return;this.impliedValues[component]=value};ParsedComponents.prototype.isCertain=function(component){return component in this.knownValues};ParsedComponents.prototype.isPossibleDate=function(){var dateMoment=this.moment();if(dateMoment.get("year")!=this.get("year"))return false;if(dateMoment.get("month")!=this.get("month")-1)return false;if(dateMoment.get("date")!=this.get("day"))return false;if(dateMoment.get("hour")!=this.get("hour"))return false;if(dateMoment.get("minute")!=this.get("minute"))return false;return true};ParsedComponents.prototype.date=function(){var dateMoment=this.moment();return dateMoment.toDate()};ParsedComponents.prototype.moment=function(){var dateMoment=moment();dateMoment.set("year",this.get("year"));dateMoment.set("month",this.get("month")-1);dateMoment.set("date",this.get("day"));dateMoment.set("hour",this.get("hour"));dateMoment.set("minute",this.get("minute"));dateMoment.set("second",this.get("second"));dateMoment.set("millisecond",this.get("millisecond"));var currentTimezoneOffset=dateMoment.utcOffset();var targetTimezoneOffset=this.isCertain("timezoneOffset")?this.get("timezoneOffset"):currentTimezoneOffset;var adjustTimezoneOffset=targetTimezoneOffset-currentTimezoneOffset;dateMoment.add(-adjustTimezoneOffset,"minutes");return dateMoment};exports.ParsedComponents=ParsedComponents;exports.ParsedResult=ParsedResult},1659:function(module,exports,__webpack_require__){"use strict";var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var React=__webpack_require__(1),classnames=__webpack_require__(10),omit=__webpack_require__(18);module.exports=React.createClass({displayName:"FormSectionHeading",render:function render(){return React.createElement("h3",(0,_extends3.default)({},omit(this.props,"className"),{className:classnames(this.props.className,"form-section-heading")}),this.props.children)}})},1662:function(module,exports,__webpack_require__){"use strict";var _assign=__webpack_require__(5);var _assign2=_interopRequireDefault(_assign);var _defineProperty2=__webpack_require__(7);var _defineProperty3=_interopRequireDefault(_defineProperty2);var _promise=__webpack_require__(49);var _promise2=_interopRequireDefault(_promise);var _toConsumableArray2=__webpack_require__(41);var _toConsumableArray3=_interopRequireDefault(_toConsumableArray2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var debug=__webpack_require__(3)("calypso:media"),assign=__webpack_require__(34),uniqueId=__webpack_require__(399),path=__webpack_require__(1869);var Dispatcher=__webpack_require__(42),wpcom=__webpack_require__(28),MediaUtils=__webpack_require__(1647),PostEditStore=__webpack_require__(1687),MediaStore=__webpack_require__(1717),MediaListStore=__webpack_require__(1899),MediaValidationStore=__webpack_require__(1785);var MediaActions={_fetching:{}};var ONE_YEAR_IN_MILLISECONDS=3154e7;MediaActions.setQuery=function(siteId,query){Dispatcher.handleViewAction({type:"SET_MEDIA_QUERY",siteId:siteId,query:query})};MediaActions.fetch=function(siteId,itemId){var fetchKey=[siteId,itemId].join();if(MediaActions._fetching[fetchKey]){return}MediaActions._fetching[fetchKey]=true;Dispatcher.handleViewAction({type:"FETCH_MEDIA_ITEM",siteId:siteId,id:itemId});debug("Fetching media for %d using ID %d",siteId,itemId);wpcom.site(siteId).media(itemId).get(function(error,data){Dispatcher.handleServerAction({type:"RECEIVE_MEDIA_ITEM",error:error,siteId:siteId,data:data});delete MediaActions._fetching[fetchKey]})};MediaActions.fetchNextPage=function(siteId){var query;if(MediaListStore.isFetchingNextPage(siteId)){return}Dispatcher.handleViewAction({type:"FETCH_MEDIA_ITEMS",siteId:siteId});query=MediaListStore.getNextPageQuery(siteId);debug("Fetching media for %d using query %o",siteId,query);wpcom.site(siteId).mediaList(query,function(error,data){Dispatcher.handleServerAction({type:"RECEIVE_MEDIA_ITEMS",error:error,siteId:siteId,data:data,query:query})})};MediaActions.add=function(siteId,files){if(files instanceof window.FileList){files=[].concat((0,_toConsumableArray3.default)(files))}if(!Array.isArray(files)){files=[files]}var baseTime=Date.now()+ONE_YEAR_IN_MILLISECONDS;return files.reduce(function(lastUpload,file,i){var id=uniqueId("media-");var transientMedia={ID:id,transient:true,date:new Date(baseTime-(files.length-i)).toISOString()};if("string"===typeof file){assign(transientMedia,{file:file,title:path.basename(file),extension:MediaUtils.getFileExtension(file),mime_type:MediaUtils.getMimeType(file)})}else{var fileContents=file.fileContents||file;var fileName=file.fileName||file.name;var fileUrl=window.URL.createObjectURL(fileContents);assign(transientMedia,{URL:fileUrl,guid:fileUrl,file:fileName,title:file.title||path.basename(fileName),extension:MediaUtils.getFileExtension(file.fileName||fileContents),mime_type:MediaUtils.getMimeType(file.fileName||fileContents),size:fileContents.size})}Dispatcher.handleViewAction({type:"CREATE_MEDIA_ITEM",siteId:siteId,data:transientMedia});if(MediaValidationStore.getErrors(siteId,id).length){return _promise2.default.resolve()}var isUrl="string"===typeof file;var addHandler=isUrl?"addMediaUrls":"addMediaFiles";var post=PostEditStore.get();var title=file.title;if(post&&post.ID){file=(0,_defineProperty3.default)({parent_id:post.ID},isUrl?"url":"file",file)}else if(file.fileContents){file={file:file}}if(title){file.title=title}debug("Uploading media to %d from %o",siteId,file);return lastUpload.then(function(){var action={type:"RECEIVE_MEDIA_ITEM",id:id,siteId:siteId};return wpcom.site(siteId)[addHandler]({},file).then(function(data){Dispatcher.handleServerAction((0,_assign2.default)(action,{data:data.media[0]}));Dispatcher.handleServerAction({type:"FETCH_MEDIA_LIMITS",siteId:siteId})}).catch(function(error){Dispatcher.handleServerAction((0,_assign2.default)(action,{error:error}))})})},_promise2.default.resolve())};MediaActions.edit=function(siteId,item){var newItem=assign({},MediaStore.get(siteId,item.ID),item);Dispatcher.handleViewAction({type:"RECEIVE_MEDIA_ITEM",siteId:siteId,data:newItem})};MediaActions.update=function(siteId,item){var newItem;if(Array.isArray(item)){item.forEach(MediaActions.update.bind(null,siteId));return}newItem=assign({},MediaStore.get(siteId,item.ID),item);Dispatcher.handleViewAction({type:"RECEIVE_MEDIA_ITEM",siteId:siteId,data:newItem});debug("Updating media for %d by ID %d to %o",siteId,item.ID,item);wpcom.site(siteId).media(item.ID).update(item,function(error,data){Dispatcher.handleServerAction({type:"RECEIVE_MEDIA_ITEM",error:error,siteId:siteId,data:data})})};MediaActions.delete=function(siteId,item){if(Array.isArray(item)){item.forEach(MediaActions.delete.bind(null,siteId));return}Dispatcher.handleViewAction({type:"REMOVE_MEDIA_ITEM",siteId:siteId,data:item});debug("Deleting media from %d by ID %d",siteId,item.ID);wpcom.site(siteId).media(item.ID).delete(function(error,data){Dispatcher.handleServerAction({type:"REMOVE_MEDIA_ITEM",error:error,siteId:siteId,data:data});Dispatcher.handleServerAction({type:"FETCH_MEDIA_LIMITS",siteId:siteId})})};MediaActions.setLibrarySelectedItems=function(siteId,items){debug("Setting selected items for %d as %o",siteId,items);Dispatcher.handleViewAction({type:"SET_MEDIA_LIBRARY_SELECTED_ITEMS",siteId:siteId,data:items})};MediaActions.clearValidationErrors=function(siteId,itemId){debug("Clearing validation errors for %d, with item ID %d",siteId,itemId);Dispatcher.handleViewAction({type:"CLEAR_MEDIA_VALIDATION_ERRORS",siteId:siteId,itemId:itemId})};MediaActions.clearValidationErrorsByType=function(siteId,type){debug("Clearing validation errors for %d, by type %s",siteId,type);Dispatcher.handleViewAction({type:"CLEAR_MEDIA_VALIDATION_ERRORS",siteId:siteId,errorType:type})};module.exports=MediaActions},1665:function(module,exports,__webpack_require__){"use strict";var _defineProperty2=__webpack_require__(7);var _defineProperty3=_interopRequireDefault(_defineProperty2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var React=__webpack_require__(1),classNames=__webpack_require__(10);var SegmentedControlItem=React.createClass({displayName:"SegmentedControlItem",propTypes:{children:React.PropTypes.node.isRequired,path:React.PropTypes.string,selected:React.PropTypes.bool,title:React.PropTypes.string,onClick:React.PropTypes.func},getDefaultProps:function getDefaultProps(){return{selected:false}},render:function render(){var itemClassName=classNames({"segmented-control__item":true,"is-selected":this.props.selected});var linkClassName=classNames("segmented-control__link",(0,_defineProperty3.default)({},"item-index-"+this.props.index,this.props.index!=null));return React.createElement("li",{className:itemClassName},React.createElement("a",{href:this.props.path,className:linkClassName,ref:"itemLink",onTouchTap:this.props.onClick,title:this.props.title,role:"radio",tabIndex:0,"aria-selected":this.props.selected},React.createElement("span",{className:"segmented-control__text"},this.props.children)))}});module.exports=SegmentedControlItem},1671:function(module,exports,__webpack_require__){function Parser(strictMode){this.isStrictMode=function(){return strictMode==true};this.pattern=function(){return/./i};this.extract=function(text,ref,match,opt){return null};this.execute=function(text,ref,opt){var results=[];var regex=this.pattern();var remainingText=text;var match=regex.exec(remainingText);while(match){match.index+=text.length-remainingText.length;var result=this.extract(text,ref,match,opt);if(result){remainingText=text.substring(result.index+result.text.length);if(!this.isStrictMode()||result.hasPossibleDates()){results.push(result)}}else{remainingText=text.substring(match.index+1)}match=regex.exec(remainingText)}if(this.refiners){this.refiners.forEach(function(){results=refiner.refine(results,text,options)})}return results}}exports.Parser=Parser;exports.ENISOFormatParser=__webpack_require__(3322).Parser;exports.ENDeadlineFormatParser=__webpack_require__(3321).Parser;
exports.ENMonthNameLittleEndianParser=__webpack_require__(3323).Parser;exports.ENMonthNameMiddleEndianParser=__webpack_require__(3324).Parser;exports.ENMonthNameParser=__webpack_require__(3325).Parser;exports.ENSlashDateFormatParser=__webpack_require__(3326).Parser;exports.ENSlashDateFormatStartWithYearParser=__webpack_require__(3327).Parser;exports.ENSlashMonthFormatParser=__webpack_require__(3328).Parser;exports.ENTimeAgoFormatParser=__webpack_require__(3329).Parser;exports.ENTimeExpressionParser=__webpack_require__(3330).Parser;exports.ENWeekdayParser=__webpack_require__(3331).Parser;exports.ENCasualDateParser=__webpack_require__(3320).Parser;exports.JPStandardParser=__webpack_require__(3340).Parser;exports.JPCasualDateParser=__webpack_require__(3339).Parser;exports.ESCasualDateParser=__webpack_require__(3332).Parser;exports.ESDeadlineFormatParser=__webpack_require__(3333).Parser;exports.ESTimeAgoFormatParser=__webpack_require__(3336).Parser;exports.ESTimeExpressionParser=__webpack_require__(3337).Parser;exports.ESWeekdayParser=__webpack_require__(3338).Parser;exports.ESMonthNameLittleEndianParser=__webpack_require__(3334).Parser;exports.ESSlashDateFormatParser=__webpack_require__(3335).Parser},1675:function(module,exports,__webpack_require__){(function(setImmediate){(function(){(function(exports,undefined){"use strict";var modules={};function require(ids,callback){var module,defs=[];for(var i=0;i<ids.length;++i){module=modules[ids[i]]||resolve(ids[i]);if(!module){throw"module definition dependecy not found: "+ids[i]}defs.push(module)}callback.apply(null,defs)}function define(id,dependencies,definition){if(typeof id!=="string"){throw"invalid module definition, module id must be defined and be a string"}if(dependencies===undefined){throw"invalid module definition, dependencies must be specified"}if(definition===undefined){throw"invalid module definition, definition function must be specified"}require(dependencies,function(){modules[id]=definition.apply(null,arguments)})}function defined(id){return!!modules[id]}function resolve(id){var target=exports;var fragments=id.split(/[.\/]/);for(var fi=0;fi<fragments.length;++fi){if(!target[fragments[fi]]){return}target=target[fragments[fi]]}return target}function expose(ids){var i,target,id,fragments,privateModules;for(i=0;i<ids.length;i++){target=exports;id=ids[i];fragments=id.split(/[.\/]/);for(var fi=0;fi<fragments.length-1;++fi){if(target[fragments[fi]]===undefined){target[fragments[fi]]={}}target=target[fragments[fi]]}target[fragments[fragments.length-1]]=modules[id]}if(exports.AMDLC_TESTS){privateModules=exports.privateModules||{};for(id in modules){privateModules[id]=modules[id]}for(i=0;i<ids.length;i++){delete privateModules[ids[i]]}exports.privateModules=privateModules}}define("tinymce/geom/Rect",[],function(){"use strict";var min=Math.min,max=Math.max,round=Math.round;function relativePosition(rect,targetRect,rel){var x,y,w,h,targetW,targetH;x=targetRect.x;y=targetRect.y;w=rect.w;h=rect.h;targetW=targetRect.w;targetH=targetRect.h;rel=(rel||"").split("");if(rel[0]==="b"){y+=targetH}if(rel[1]==="r"){x+=targetW}if(rel[0]==="c"){y+=round(targetH/2)}if(rel[1]==="c"){x+=round(targetW/2)}if(rel[3]==="b"){y-=h}if(rel[4]==="r"){x-=w}if(rel[3]==="c"){y-=round(h/2)}if(rel[4]==="c"){x-=round(w/2)}return create(x,y,w,h)}function findBestRelativePosition(rect,targetRect,constrainRect,rels){var pos,i;for(i=0;i<rels.length;i++){pos=relativePosition(rect,targetRect,rels[i]);if(pos.x>=constrainRect.x&&pos.x+pos.w<=constrainRect.w+constrainRect.x&&pos.y>=constrainRect.y&&pos.y+pos.h<=constrainRect.h+constrainRect.y){return rels[i]}}return null}function inflate(rect,w,h){return create(rect.x-w,rect.y-h,rect.w+w*2,rect.h+h*2)}function intersect(rect,cropRect){var x1,y1,x2,y2;x1=max(rect.x,cropRect.x);y1=max(rect.y,cropRect.y);x2=min(rect.x+rect.w,cropRect.x+cropRect.w);y2=min(rect.y+rect.h,cropRect.y+cropRect.h);if(x2-x1<0||y2-y1<0){return null}return create(x1,y1,x2-x1,y2-y1)}function clamp(rect,clampRect,fixedSize){var underflowX1,underflowY1,overflowX2,overflowY2,x1,y1,x2,y2,cx2,cy2;x1=rect.x;y1=rect.y;x2=rect.x+rect.w;y2=rect.y+rect.h;cx2=clampRect.x+clampRect.w;cy2=clampRect.y+clampRect.h;underflowX1=max(0,clampRect.x-x1);underflowY1=max(0,clampRect.y-y1);overflowX2=max(0,x2-cx2);overflowY2=max(0,y2-cy2);x1+=underflowX1;y1+=underflowY1;if(fixedSize){x2+=underflowX1;y2+=underflowY1;x1-=overflowX2;y1-=overflowY2}x2-=overflowX2;y2-=overflowY2;return create(x1,y1,x2-x1,y2-y1)}function create(x,y,w,h){return{x:x,y:y,w:w,h:h}}function fromClientRect(clientRect){return create(clientRect.left,clientRect.top,clientRect.width,clientRect.height)}return{inflate:inflate,relativePosition:relativePosition,findBestRelativePosition:findBestRelativePosition,intersect:intersect,clamp:clamp,create:create,fromClientRect:fromClientRect}});define("tinymce/util/Promise",[],function(){if(window.Promise){return window.Promise}var asap=Promise.immediateFn||typeof setImmediate==="function"&&setImmediate||function(fn){setTimeout(fn,1)};function bind(fn,thisArg){return function(){fn.apply(thisArg,arguments)}}var isArray=Array.isArray||function(value){return Object.prototype.toString.call(value)==="[object Array]"};function Promise(fn){if(typeof this!=="object")throw new TypeError("Promises must be constructed via new");if(typeof fn!=="function")throw new TypeError("not a function");this._state=null;this._value=null;this._deferreds=[];doResolve(fn,bind(resolve,this),bind(reject,this))}function handle(deferred){var me=this;if(this._state===null){this._deferreds.push(deferred);return}asap(function(){var cb=me._state?deferred.onFulfilled:deferred.onRejected;if(cb===null){(me._state?deferred.resolve:deferred.reject)(me._value);return}var ret;try{ret=cb(me._value)}catch(e){deferred.reject(e);return}deferred.resolve(ret)})}function resolve(newValue){try{if(newValue===this)throw new TypeError("A promise cannot be resolved with itself.");if(newValue&&(typeof newValue==="object"||typeof newValue==="function")){var then=newValue.then;if(typeof then==="function"){doResolve(bind(then,newValue),bind(resolve,this),bind(reject,this));return}}this._state=true;this._value=newValue;finale.call(this)}catch(e){reject.call(this,e)}}function reject(newValue){this._state=false;this._value=newValue;finale.call(this)}function finale(){for(var i=0,len=this._deferreds.length;i<len;i++){handle.call(this,this._deferreds[i])}this._deferreds=null}function Handler(onFulfilled,onRejected,resolve,reject){this.onFulfilled=typeof onFulfilled==="function"?onFulfilled:null;this.onRejected=typeof onRejected==="function"?onRejected:null;this.resolve=resolve;this.reject=reject}function doResolve(fn,onFulfilled,onRejected){var done=false;try{fn(function(value){if(done)return;done=true;onFulfilled(value)},function(reason){if(done)return;done=true;onRejected(reason)})}catch(ex){if(done)return;done=true;onRejected(ex)}}Promise.prototype["catch"]=function(onRejected){return this.then(null,onRejected)};Promise.prototype.then=function(onFulfilled,onRejected){var me=this;return new Promise(function(resolve,reject){handle.call(me,new Handler(onFulfilled,onRejected,resolve,reject))})};Promise.all=function(){var args=Array.prototype.slice.call(arguments.length===1&&isArray(arguments[0])?arguments[0]:arguments);return new Promise(function(resolve,reject){if(args.length===0)return resolve([]);var remaining=args.length;function res(i,val){try{if(val&&(typeof val==="object"||typeof val==="function")){var then=val.then;if(typeof then==="function"){then.call(val,function(val){res(i,val)},reject);return}}args[i]=val;if(--remaining===0){resolve(args)}}catch(ex){reject(ex)}}for(var i=0;i<args.length;i++){res(i,args[i])}})};Promise.resolve=function(value){if(value&&typeof value==="object"&&value.constructor===Promise){return value}return new Promise(function(resolve){resolve(value)})};Promise.reject=function(value){return new Promise(function(resolve,reject){reject(value)})};Promise.race=function(values){return new Promise(function(resolve,reject){for(var i=0,len=values.length;i<len;i++){values[i].then(resolve,reject)}})};return Promise});define("tinymce/util/Delay",["tinymce/util/Promise"],function(Promise){var requestAnimationFramePromise;function requestAnimationFrame(callback,element){var i,requestAnimationFrameFunc=window.requestAnimationFrame,vendors=["ms","moz","webkit"];function featurefill(callback){window.setTimeout(callback,0)}for(i=0;i<vendors.length&&!requestAnimationFrameFunc;i++){requestAnimationFrameFunc=window[vendors[i]+"RequestAnimationFrame"]}if(!requestAnimationFrameFunc){requestAnimationFrameFunc=featurefill}requestAnimationFrameFunc(callback,element)}function wrappedSetTimeout(callback,time){if(typeof time!="number"){time=0}return setTimeout(callback,time)}function wrappedSetInterval(callback,time){if(typeof time!="number"){time=0}return setInterval(callback,time)}function wrappedClearTimeout(id){return clearTimeout(id)}function wrappedClearInterval(id){return clearInterval(id)}return{requestAnimationFrame:function(callback,element){if(requestAnimationFramePromise){requestAnimationFramePromise.then(callback);return}requestAnimationFramePromise=new Promise(function(resolve){if(!element){element=document.body}requestAnimationFrame(resolve,element)}).then(callback)},setTimeout:wrappedSetTimeout,setInterval:wrappedSetInterval,setEditorTimeout:function(editor,callback,time){return wrappedSetTimeout(function(){if(!editor.removed){callback()}},time)},setEditorInterval:function(editor,callback,time){var timer;timer=wrappedSetInterval(function(){if(!editor.removed){callback()}else{clearInterval(timer)}},time);return timer},throttle:function(callback,time){var timer,func;func=function(){var args=arguments;clearTimeout(timer);timer=wrappedSetTimeout(function(){callback.apply(this,args)},time)};func.stop=function(){clearTimeout(timer)};return func},clearInterval:wrappedClearInterval,clearTimeout:wrappedClearTimeout}});define("tinymce/Env",[],function(){var nav=navigator,userAgent=nav.userAgent;var opera,webkit,ie,ie11,ie12,gecko,mac,iDevice,android,fileApi,phone,tablet,windowsPhone;function matchMediaQuery(query){return"matchMedia"in window?matchMedia(query).matches:false}opera=window.opera&&window.opera.buildNumber;android=/Android/.test(userAgent);webkit=/WebKit/.test(userAgent);ie=!webkit&&!opera&&/MSIE/gi.test(userAgent)&&/Explorer/gi.test(nav.appName);ie=ie&&/MSIE (\w+)\./.exec(userAgent)[1];ie11=userAgent.indexOf("Trident/")!=-1&&(userAgent.indexOf("rv:")!=-1||nav.appName.indexOf("Netscape")!=-1)?11:false;ie12=userAgent.indexOf("Edge/")!=-1&&!ie&&!ie11?12:false;ie=ie||ie11||ie12;gecko=!webkit&&!ie11&&/Gecko/.test(userAgent);mac=userAgent.indexOf("Mac")!=-1;iDevice=/(iPad|iPhone)/.test(userAgent);fileApi="FormData"in window&&"FileReader"in window&&"URL"in window&&!!URL.createObjectURL;phone=matchMediaQuery("only screen and (max-device-width: 480px)")&&(android||iDevice);tablet=matchMediaQuery("only screen and (min-width: 800px)")&&(android||iDevice);windowsPhone=userAgent.indexOf("Windows Phone")!=-1;if(ie12){webkit=false}var contentEditable=!iDevice||fileApi||userAgent.match(/AppleWebKit\/(\d*)/)[1]>=534;return{opera:opera,webkit:webkit,ie:ie,gecko:gecko,mac:mac,iOS:iDevice,android:android,contentEditable:contentEditable,transparentSrc:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",caretAfter:ie!=8,range:window.getSelection&&"Range"in window,documentMode:ie&&!ie12?document.documentMode||7:10,fileApi:fileApi,ceFalse:ie===false||ie>8,desktop:!phone&&!tablet,windowsPhone:windowsPhone}});define("tinymce/dom/EventUtils",["tinymce/util/Delay","tinymce/Env"],function(Delay,Env){"use strict";var eventExpandoPrefix="mce-data-";var mouseEventRe=/^(?:mouse|contextmenu)|click/;var deprecated={keyLocation:1,layerX:1,layerY:1,returnValue:1,webkitMovementX:1,webkitMovementY:1};function addEvent(target,name,callback,capture){if(target.addEventListener){target.addEventListener(name,callback,capture||false)}else if(target.attachEvent){target.attachEvent("on"+name,callback)}}function removeEvent(target,name,callback,capture){if(target.removeEventListener){target.removeEventListener(name,callback,capture||false)}else if(target.detachEvent){target.detachEvent("on"+name,callback)}}function getTargetFromShadowDom(event,defaultTarget){var path,target=defaultTarget;path=event.path;if(path&&path.length>0){target=path[0]}if(event.deepPath){path=event.deepPath();if(path&&path.length>0){target=path[0]}}return target}function fix(originalEvent,data){var name,event=data||{},undef;function returnFalse(){return false}function returnTrue(){return true}for(name in originalEvent){if(!deprecated[name]){event[name]=originalEvent[name]}}if(!event.target){event.target=event.srcElement||document}if(Env.experimentalShadowDom){event.target=getTargetFromShadowDom(originalEvent,event.target)}if(originalEvent&&mouseEventRe.test(originalEvent.type)&&originalEvent.pageX===undef&&originalEvent.clientX!==undef){var eventDoc=event.target.ownerDocument||document;var doc=eventDoc.documentElement;var body=eventDoc.body;event.pageX=originalEvent.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc&&doc.clientLeft||body&&body.clientLeft||0);event.pageY=originalEvent.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc&&doc.clientTop||body&&body.clientTop||0)}event.preventDefault=function(){event.isDefaultPrevented=returnTrue;if(originalEvent){if(originalEvent.preventDefault){originalEvent.preventDefault()}else{originalEvent.returnValue=false}}};event.stopPropagation=function(){event.isPropagationStopped=returnTrue;if(originalEvent){if(originalEvent.stopPropagation){originalEvent.stopPropagation()}else{originalEvent.cancelBubble=true}}};event.stopImmediatePropagation=function(){event.isImmediatePropagationStopped=returnTrue;event.stopPropagation()};if(!event.isDefaultPrevented){event.isDefaultPrevented=returnFalse;event.isPropagationStopped=returnFalse;event.isImmediatePropagationStopped=returnFalse}if(typeof event.metaKey=="undefined"){event.metaKey=false}return event}function bindOnReady(win,callback,eventUtils){var doc=win.document,event={type:"ready"};if(eventUtils.domLoaded){callback(event);return}function readyHandler(){if(!eventUtils.domLoaded){eventUtils.domLoaded=true;callback(event)}}function waitForDomLoaded(){if(doc.readyState==="complete"||doc.readyState==="interactive"&&doc.body){removeEvent(doc,"readystatechange",waitForDomLoaded);readyHandler()}}function tryScroll(){try{doc.documentElement.doScroll("left")}catch(ex){Delay.setTimeout(tryScroll);return}readyHandler()}if(doc.addEventListener){if(doc.readyState==="complete"){readyHandler()}else{addEvent(win,"DOMContentLoaded",readyHandler)}}else{addEvent(doc,"readystatechange",waitForDomLoaded);if(doc.documentElement.doScroll&&win.self===win.top){tryScroll()}}addEvent(win,"load",readyHandler)}function EventUtils(){var self=this,events={},count,expando,hasFocusIn,hasMouseEnterLeave,mouseEnterLeave;expando=eventExpandoPrefix+(+new Date).toString(32);hasMouseEnterLeave="onmouseenter"in document.documentElement;hasFocusIn="onfocusin"in document.documentElement;mouseEnterLeave={mouseenter:"mouseover",mouseleave:"mouseout"};count=1;self.domLoaded=false;self.events=events;function executeHandlers(evt,id){var callbackList,i,l,callback,container=events[id];callbackList=container&&container[evt.type];if(callbackList){for(i=0,l=callbackList.length;i<l;i++){callback=callbackList[i];if(callback&&callback.func.call(callback.scope,evt)===false){evt.preventDefault()}if(evt.isImmediatePropagationStopped()){return}}}}self.bind=function(target,names,callback,scope){var id,callbackList,i,name,fakeName,nativeHandler,capture,win=window;function defaultNativeHandler(evt){executeHandlers(fix(evt||win.event),id)}if(!target||target.nodeType===3||target.nodeType===8){return}if(!target[expando]){id=count++;target[expando]=id;events[id]={}}else{id=target[expando]}scope=scope||target;names=names.split(" ");i=names.length;while(i--){name=names[i];nativeHandler=defaultNativeHandler;fakeName=capture=false;if(name==="DOMContentLoaded"){name="ready"}if(self.domLoaded&&name==="ready"&&target.readyState=="complete"){callback.call(scope,fix({type:name}));continue}if(!hasMouseEnterLeave){fakeName=mouseEnterLeave[name];if(fakeName){nativeHandler=function(evt){var current,related;current=evt.currentTarget;related=evt.relatedTarget;if(related&&current.contains){related=current.contains(related)}else{while(related&&related!==current){related=related.parentNode}}if(!related){evt=fix(evt||win.event);evt.type=evt.type==="mouseout"?"mouseleave":"mouseenter";evt.target=current;executeHandlers(evt,id)}}}}if(!hasFocusIn&&(name==="focusin"||name==="focusout")){capture=true;fakeName=name==="focusin"?"focus":"blur";nativeHandler=function(evt){evt=fix(evt||win.event);evt.type=evt.type==="focus"?"focusin":"focusout";executeHandlers(evt,id)}}callbackList=events[id][name];if(!callbackList){events[id][name]=callbackList=[{func:callback,scope:scope}];callbackList.fakeName=fakeName;callbackList.capture=capture;callbackList.nativeHandler=nativeHandler;if(name==="ready"){bindOnReady(target,nativeHandler,self)}else{addEvent(target,fakeName||name,nativeHandler,capture)}}else{if(name==="ready"&&self.domLoaded){callback({type:name})}else{callbackList.push({func:callback,scope:scope})}}}target=callbackList=0;return callback};self.unbind=function(target,names,callback){var id,callbackList,i,ci,name,eventMap;if(!target||target.nodeType===3||target.nodeType===8){return self}id=target[expando];if(id){eventMap=events[id];if(names){names=names.split(" ");i=names.length;while(i--){name=names[i];callbackList=eventMap[name];if(callbackList){if(callback){ci=callbackList.length;while(ci--){if(callbackList[ci].func===callback){var nativeHandler=callbackList.nativeHandler;var fakeName=callbackList.fakeName,capture=callbackList.capture;callbackList=callbackList.slice(0,ci).concat(callbackList.slice(ci+1));callbackList.nativeHandler=nativeHandler;callbackList.fakeName=fakeName;callbackList.capture=capture;eventMap[name]=callbackList}}}if(!callback||callbackList.length===0){delete eventMap[name];removeEvent(target,callbackList.fakeName||name,callbackList.nativeHandler,callbackList.capture)}}}}else{for(name in eventMap){callbackList=eventMap[name];removeEvent(target,callbackList.fakeName||name,callbackList.nativeHandler,callbackList.capture)}eventMap={}}for(name in eventMap){return self}delete events[id];try{delete target[expando]}catch(ex){target[expando]=null}}return self};self.fire=function(target,name,args){var id;if(!target||target.nodeType===3||target.nodeType===8){return self}args=fix(null,args);args.type=name;args.target=target;do{id=target[expando];if(id){executeHandlers(args,id)}target=target.parentNode||target.ownerDocument||target.defaultView||target.parentWindow}while(target&&!args.isPropagationStopped());return self};self.clean=function(target){var i,children,unbind=self.unbind;if(!target||target.nodeType===3||target.nodeType===8){return self}if(target[expando]){unbind(target)}if(!target.getElementsByTagName){target=target.document}if(target&&target.getElementsByTagName){unbind(target);children=target.getElementsByTagName("*");i=children.length;while(i--){target=children[i];if(target[expando]){unbind(target)}}}return self};self.destroy=function(){events={}};self.cancel=function(e){if(e){e.preventDefault();e.stopImmediatePropagation()}return false}}EventUtils.Event=new EventUtils;EventUtils.Event.bind(window,"ready",function(){});return EventUtils});define("tinymce/dom/Sizzle",[],function(){var i,support,Expr,getText,isXML,tokenize,compile,select,outermostContext,sortInput,hasDuplicate,setDocument,document,docElem,documentIsHTML,rbuggyQSA,rbuggyMatches,matches,contains,expando="sizzle"+-new Date,preferredDoc=window.document,dirruns=0,done=0,classCache=createCache(),tokenCache=createCache(),compilerCache=createCache(),sortOrder=function(a,b){if(a===b){hasDuplicate=true}return 0},strundefined=typeof undefined,MAX_NEGATIVE=1<<31,hasOwn={}.hasOwnProperty,arr=[],pop=arr.pop,push_native=arr.push,push=arr.push,slice=arr.slice,indexOf=arr.indexOf||function(elem){var i=0,len=this.length;for(;i<len;i++){if(this[i]===elem){return i}}return-1},booleans="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",whitespace="[\\x20\\t\\r\\n\\f]",identifier="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",attributes="\\["+whitespace+"*("+identifier+")(?:"+whitespace+"*([*^$|!~]?=)"+whitespace+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+identifier+"))|)"+whitespace+"*\\]",pseudos=":("+identifier+")(?:\\(("+"('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|"+"((?:\\\\.|[^\\\\()[\\]]|"+attributes+")*)|"+".*"+")\\)|)",rtrim=new RegExp("^"+whitespace+"+|((?:^|[^\\\\])(?:\\\\.)*)"+whitespace+"+$","g"),rcomma=new RegExp("^"+whitespace+"*,"+whitespace+"*"),rcombinators=new RegExp("^"+whitespace+"*([>+~]|"+whitespace+")"+whitespace+"*"),rattributeQuotes=new RegExp("="+whitespace+"*([^\\]'\"]*?)"+whitespace+"*\\]","g"),rpseudo=new RegExp(pseudos),ridentifier=new RegExp("^"+identifier+"$"),matchExpr={ID:new RegExp("^#("+identifier+")"),CLASS:new RegExp("^\\.("+identifier+")"),TAG:new RegExp("^("+identifier+"|[*])"),ATTR:new RegExp("^"+attributes),PSEUDO:new RegExp("^"+pseudos),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+whitespace+"*(even|odd|(([+-]|)(\\d*)n|)"+whitespace+"*(?:([+-]|)"+whitespace+"*(\\d+)|))"+whitespace+"*\\)|)","i"),bool:new RegExp("^(?:"+booleans+")$","i"),needsContext:new RegExp("^"+whitespace+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+whitespace+"*((?:-\\d)?\\d*)"+whitespace+"*\\)|)(?=[^-]|$)","i")},rinputs=/^(?:input|select|textarea|button)$/i,rheader=/^h\d$/i,rnative=/^[^{]+\{\s*\[native \w/,rquickExpr=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,rsibling=/[+~]/,rescape=/'|\\/g,runescape=new RegExp("\\\\([\\da-f]{1,6}"+whitespace+"?|("+whitespace+")|.)","ig"),funescape=function(_,escaped,escapedWhitespace){var high="0x"+escaped-65536;return high!==high||escapedWhitespace?escaped:high<0?String.fromCharCode(high+65536):String.fromCharCode(high>>10|55296,high&1023|56320)};try{push.apply(arr=slice.call(preferredDoc.childNodes),preferredDoc.childNodes);arr[preferredDoc.childNodes.length].nodeType}catch(e){push={apply:arr.length?function(target,els){push_native.apply(target,slice.call(els))}:function(target,els){var j=target.length,i=0;while(target[j++]=els[i++]){}target.length=j-1}}}function Sizzle(selector,context,results,seed){var match,elem,m,nodeType,i,groups,old,nid,newContext,newSelector;if((context?context.ownerDocument||context:preferredDoc)!==document){setDocument(context)}context=context||document;results=results||[];if(!selector||typeof selector!=="string"){return results}if((nodeType=context.nodeType)!==1&&nodeType!==9){return[]}if(documentIsHTML&&!seed){if(match=rquickExpr.exec(selector)){if(m=match[1]){if(nodeType===9){elem=context.getElementById(m);if(elem&&elem.parentNode){if(elem.id===m){results.push(elem);return results}}else{return results}}else{if(context.ownerDocument&&(elem=context.ownerDocument.getElementById(m))&&contains(context,elem)&&elem.id===m){results.push(elem);return results}}}else if(match[2]){push.apply(results,context.getElementsByTagName(selector));return results}else if((m=match[3])&&support.getElementsByClassName){push.apply(results,context.getElementsByClassName(m));return results}}if(support.qsa&&(!rbuggyQSA||!rbuggyQSA.test(selector))){nid=old=expando;newContext=context;newSelector=nodeType===9&&selector;if(nodeType===1&&context.nodeName.toLowerCase()!=="object"){groups=tokenize(selector);if(old=context.getAttribute("id")){nid=old.replace(rescape,"\\$&")}else{context.setAttribute("id",nid)}nid="[id='"+nid+"'] ";i=groups.length;while(i--){groups[i]=nid+toSelector(groups[i])}newContext=rsibling.test(selector)&&testContext(context.parentNode)||context;newSelector=groups.join(",")}if(newSelector){try{push.apply(results,newContext.querySelectorAll(newSelector));return results}catch(qsaError){}finally{if(!old){context.removeAttribute("id")}}}}}return select(selector.replace(rtrim,"$1"),context,results,seed)}function createCache(){var keys=[];function cache(key,value){if(keys.push(key+" ")>Expr.cacheLength){delete cache[keys.shift()]}return cache[key+" "]=value}return cache}function markFunction(fn){fn[expando]=true;return fn}function assert(fn){var div=document.createElement("div");try{return!!fn(div)}catch(e){return false}finally{if(div.parentNode){div.parentNode.removeChild(div)}div=null}}function addHandle(attrs,handler){var arr=attrs.split("|"),i=attrs.length;while(i--){Expr.attrHandle[arr[i]]=handler}}function siblingCheck(a,b){var cur=b&&a,diff=cur&&a.nodeType===1&&b.nodeType===1&&(~b.sourceIndex||MAX_NEGATIVE)-(~a.sourceIndex||MAX_NEGATIVE);if(diff){return diff}if(cur){while(cur=cur.nextSibling){if(cur===b){return-1}}}return a?1:-1}function createInputPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return name==="input"&&elem.type===type}}function createButtonPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return(name==="input"||name==="button")&&elem.type===type}}function createPositionalPseudo(fn){return markFunction(function(argument){argument=+argument;return markFunction(function(seed,matches){var j,matchIndexes=fn([],seed.length,argument),i=matchIndexes.length;while(i--){if(seed[j=matchIndexes[i]]){seed[j]=!(matches[j]=seed[j])}}})})}function testContext(context){return context&&typeof context.getElementsByTagName!==strundefined&&context}support=Sizzle.support={};isXML=Sizzle.isXML=function(elem){var documentElement=elem&&(elem.ownerDocument||elem).documentElement;return documentElement?documentElement.nodeName!=="HTML":false};setDocument=Sizzle.setDocument=function(node){var hasCompare,doc=node?node.ownerDocument||node:preferredDoc,parent=doc.defaultView;function getTop(win){try{return win.top}catch(ex){}return null}if(doc===document||doc.nodeType!==9||!doc.documentElement){return document}document=doc;docElem=doc.documentElement;documentIsHTML=!isXML(doc);if(parent&&parent!==getTop(parent)){if(parent.addEventListener){parent.addEventListener("unload",function(){setDocument()},false)}else if(parent.attachEvent){parent.attachEvent("onunload",function(){setDocument()})}}support.attributes=assert(function(div){div.className="i";return!div.getAttribute("className")});support.getElementsByTagName=assert(function(div){div.appendChild(doc.createComment(""));return!div.getElementsByTagName("*").length});support.getElementsByClassName=rnative.test(doc.getElementsByClassName);support.getById=assert(function(div){docElem.appendChild(div).id=expando;return!doc.getElementsByName||!doc.getElementsByName(expando).length});if(support.getById){Expr.find["ID"]=function(id,context){if(typeof context.getElementById!==strundefined&&documentIsHTML){var m=context.getElementById(id);return m&&m.parentNode?[m]:[]}};Expr.filter["ID"]=function(id){var attrId=id.replace(runescape,funescape);return function(elem){return elem.getAttribute("id")===attrId}}}else{delete Expr.find["ID"];Expr.filter["ID"]=function(id){var attrId=id.replace(runescape,funescape);return function(elem){var node=typeof elem.getAttributeNode!==strundefined&&elem.getAttributeNode("id");return node&&node.value===attrId}}}Expr.find["TAG"]=support.getElementsByTagName?function(tag,context){if(typeof context.getElementsByTagName!==strundefined){return context.getElementsByTagName(tag)}}:function(tag,context){var elem,tmp=[],i=0,results=context.getElementsByTagName(tag);if(tag==="*"){while(elem=results[i++]){if(elem.nodeType===1){tmp.push(elem)}}return tmp}return results};Expr.find["CLASS"]=support.getElementsByClassName&&function(className,context){if(documentIsHTML){return context.getElementsByClassName(className)}};rbuggyMatches=[];rbuggyQSA=[];if(support.qsa=rnative.test(doc.querySelectorAll)){assert(function(div){div.innerHTML="<select msallowcapture=''><option selected=''></option></select>";if(div.querySelectorAll("[msallowcapture^='']").length){rbuggyQSA.push("[*^$]="+whitespace+"*(?:''|\"\")")}if(!div.querySelectorAll("[selected]").length){rbuggyQSA.push("\\["+whitespace+"*(?:value|"+booleans+")")}if(!div.querySelectorAll(":checked").length){rbuggyQSA.push(":checked")}});assert(function(div){var input=doc.createElement("input");input.setAttribute("type","hidden");div.appendChild(input).setAttribute("name","D");if(div.querySelectorAll("[name=d]").length){rbuggyQSA.push("name"+whitespace+"*[*^$|!~]?=")}if(!div.querySelectorAll(":enabled").length){rbuggyQSA.push(":enabled",":disabled")}div.querySelectorAll("*,:x");rbuggyQSA.push(",.*:")})}if(support.matchesSelector=rnative.test(matches=docElem.matches||docElem.webkitMatchesSelector||docElem.mozMatchesSelector||docElem.oMatchesSelector||docElem.msMatchesSelector)){assert(function(div){support.disconnectedMatch=matches.call(div,"div");matches.call(div,"[s!='']:x");rbuggyMatches.push("!=",pseudos)})}rbuggyQSA=rbuggyQSA.length&&new RegExp(rbuggyQSA.join("|"));rbuggyMatches=rbuggyMatches.length&&new RegExp(rbuggyMatches.join("|"));hasCompare=rnative.test(docElem.compareDocumentPosition);contains=hasCompare||rnative.test(docElem.contains)?function(a,b){var adown=a.nodeType===9?a.documentElement:a,bup=b&&b.parentNode;return a===bup||!!(bup&&bup.nodeType===1&&(adown.contains?adown.contains(bup):a.compareDocumentPosition&&a.compareDocumentPosition(bup)&16))}:function(a,b){if(b){while(b=b.parentNode){if(b===a){return true}}}return false};sortOrder=hasCompare?function(a,b){if(a===b){hasDuplicate=true;return 0}var compare=!a.compareDocumentPosition-!b.compareDocumentPosition;if(compare){return compare}compare=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1;if(compare&1||!support.sortDetached&&b.compareDocumentPosition(a)===compare){if(a===doc||a.ownerDocument===preferredDoc&&contains(preferredDoc,a)){return-1}if(b===doc||b.ownerDocument===preferredDoc&&contains(preferredDoc,b)){return 1}return sortInput?indexOf.call(sortInput,a)-indexOf.call(sortInput,b):0}return compare&4?-1:1}:function(a,b){if(a===b){hasDuplicate=true;return 0}var cur,i=0,aup=a.parentNode,bup=b.parentNode,ap=[a],bp=[b];if(!aup||!bup){return a===doc?-1:b===doc?1:aup?-1:bup?1:sortInput?indexOf.call(sortInput,a)-indexOf.call(sortInput,b):0}else if(aup===bup){return siblingCheck(a,b)}cur=a;while(cur=cur.parentNode){ap.unshift(cur)}cur=b;while(cur=cur.parentNode){bp.unshift(cur)}while(ap[i]===bp[i]){i++}return i?siblingCheck(ap[i],bp[i]):ap[i]===preferredDoc?-1:bp[i]===preferredDoc?1:0};return doc};Sizzle.matches=function(expr,elements){return Sizzle(expr,null,null,elements)};Sizzle.matchesSelector=function(elem,expr){if((elem.ownerDocument||elem)!==document){setDocument(elem)}expr=expr.replace(rattributeQuotes,"='$1']");if(support.matchesSelector&&documentIsHTML&&(!rbuggyMatches||!rbuggyMatches.test(expr))&&(!rbuggyQSA||!rbuggyQSA.test(expr))){try{var ret=matches.call(elem,expr);if(ret||support.disconnectedMatch||elem.document&&elem.document.nodeType!==11){return ret}}catch(e){}}return Sizzle(expr,document,null,[elem]).length>0};Sizzle.contains=function(context,elem){if((context.ownerDocument||context)!==document){setDocument(context)}return contains(context,elem)};Sizzle.attr=function(elem,name){if((elem.ownerDocument||elem)!==document){setDocument(elem)}var fn=Expr.attrHandle[name.toLowerCase()],val=fn&&hasOwn.call(Expr.attrHandle,name.toLowerCase())?fn(elem,name,!documentIsHTML):undefined;return val!==undefined?val:support.attributes||!documentIsHTML?elem.getAttribute(name):(val=elem.getAttributeNode(name))&&val.specified?val.value:null};Sizzle.error=function(msg){throw new Error("Syntax error, unrecognized expression: "+msg)};Sizzle.uniqueSort=function(results){var elem,duplicates=[],j=0,i=0;hasDuplicate=!support.detectDuplicates;sortInput=!support.sortStable&&results.slice(0);
results.sort(sortOrder);if(hasDuplicate){while(elem=results[i++]){if(elem===results[i]){j=duplicates.push(i)}}while(j--){results.splice(duplicates[j],1)}}sortInput=null;return results};getText=Sizzle.getText=function(elem){var node,ret="",i=0,nodeType=elem.nodeType;if(!nodeType){while(node=elem[i++]){ret+=getText(node)}}else if(nodeType===1||nodeType===9||nodeType===11){if(typeof elem.textContent==="string"){return elem.textContent}else{for(elem=elem.firstChild;elem;elem=elem.nextSibling){ret+=getText(elem)}}}else if(nodeType===3||nodeType===4){return elem.nodeValue}return ret};Expr=Sizzle.selectors={cacheLength:50,createPseudo:markFunction,match:matchExpr,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:true}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:true},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(match){match[1]=match[1].replace(runescape,funescape);match[3]=(match[3]||match[4]||match[5]||"").replace(runescape,funescape);if(match[2]==="~="){match[3]=" "+match[3]+" "}return match.slice(0,4)},CHILD:function(match){match[1]=match[1].toLowerCase();if(match[1].slice(0,3)==="nth"){if(!match[3]){Sizzle.error(match[0])}match[4]=+(match[4]?match[5]+(match[6]||1):2*(match[3]==="even"||match[3]==="odd"));match[5]=+(match[7]+match[8]||match[3]==="odd")}else if(match[3]){Sizzle.error(match[0])}return match},PSEUDO:function(match){var excess,unquoted=!match[6]&&match[2];if(matchExpr["CHILD"].test(match[0])){return null}if(match[3]){match[2]=match[4]||match[5]||""}else if(unquoted&&rpseudo.test(unquoted)&&(excess=tokenize(unquoted,true))&&(excess=unquoted.indexOf(")",unquoted.length-excess)-unquoted.length)){match[0]=match[0].slice(0,excess);match[2]=unquoted.slice(0,excess)}return match.slice(0,3)}},filter:{TAG:function(nodeNameSelector){var nodeName=nodeNameSelector.replace(runescape,funescape).toLowerCase();return nodeNameSelector==="*"?function(){return true}:function(elem){return elem.nodeName&&elem.nodeName.toLowerCase()===nodeName}},CLASS:function(className){var pattern=classCache[className+" "];return pattern||(pattern=new RegExp("(^|"+whitespace+")"+className+"("+whitespace+"|$)"))&&classCache(className,function(elem){return pattern.test(typeof elem.className==="string"&&elem.className||typeof elem.getAttribute!==strundefined&&elem.getAttribute("class")||"")})},ATTR:function(name,operator,check){return function(elem){var result=Sizzle.attr(elem,name);if(result==null){return operator==="!="}if(!operator){return true}result+="";return operator==="="?result===check:operator==="!="?result!==check:operator==="^="?check&&result.indexOf(check)===0:operator==="*="?check&&result.indexOf(check)>-1:operator==="$="?check&&result.slice(-check.length)===check:operator==="~="?(" "+result+" ").indexOf(check)>-1:operator==="|="?result===check||result.slice(0,check.length+1)===check+"-":false}},CHILD:function(type,what,argument,first,last){var simple=type.slice(0,3)!=="nth",forward=type.slice(-4)!=="last",ofType=what==="of-type";return first===1&&last===0?function(elem){return!!elem.parentNode}:function(elem,context,xml){var cache,outerCache,node,diff,nodeIndex,start,dir=simple!==forward?"nextSibling":"previousSibling",parent=elem.parentNode,name=ofType&&elem.nodeName.toLowerCase(),useCache=!xml&&!ofType;if(parent){if(simple){while(dir){node=elem;while(node=node[dir]){if(ofType?node.nodeName.toLowerCase()===name:node.nodeType===1){return false}}start=dir=type==="only"&&!start&&"nextSibling"}return true}start=[forward?parent.firstChild:parent.lastChild];if(forward&&useCache){outerCache=parent[expando]||(parent[expando]={});cache=outerCache[type]||[];nodeIndex=cache[0]===dirruns&&cache[1];diff=cache[0]===dirruns&&cache[2];node=nodeIndex&&parent.childNodes[nodeIndex];while(node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop()){if(node.nodeType===1&&++diff&&node===elem){outerCache[type]=[dirruns,nodeIndex,diff];break}}}else if(useCache&&(cache=(elem[expando]||(elem[expando]={}))[type])&&cache[0]===dirruns){diff=cache[1]}else{while(node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop()){if((ofType?node.nodeName.toLowerCase()===name:node.nodeType===1)&&++diff){if(useCache){(node[expando]||(node[expando]={}))[type]=[dirruns,diff]}if(node===elem){break}}}}diff-=last;return diff===first||diff%first===0&&diff/first>=0}}},PSEUDO:function(pseudo,argument){var args,fn=Expr.pseudos[pseudo]||Expr.setFilters[pseudo.toLowerCase()]||Sizzle.error("unsupported pseudo: "+pseudo);if(fn[expando]){return fn(argument)}if(fn.length>1){args=[pseudo,pseudo,"",argument];return Expr.setFilters.hasOwnProperty(pseudo.toLowerCase())?markFunction(function(seed,matches){var idx,matched=fn(seed,argument),i=matched.length;while(i--){idx=indexOf.call(seed,matched[i]);seed[idx]=!(matches[idx]=matched[i])}}):function(elem){return fn(elem,0,args)}}return fn}},pseudos:{not:markFunction(function(selector){var input=[],results=[],matcher=compile(selector.replace(rtrim,"$1"));return matcher[expando]?markFunction(function(seed,matches,context,xml){var elem,unmatched=matcher(seed,null,xml,[]),i=seed.length;while(i--){if(elem=unmatched[i]){seed[i]=!(matches[i]=elem)}}}):function(elem,context,xml){input[0]=elem;matcher(input,null,xml,results);return!results.pop()}}),has:markFunction(function(selector){return function(elem){return Sizzle(selector,elem).length>0}}),contains:markFunction(function(text){text=text.replace(runescape,funescape);return function(elem){return(elem.textContent||elem.innerText||getText(elem)).indexOf(text)>-1}}),lang:markFunction(function(lang){if(!ridentifier.test(lang||"")){Sizzle.error("unsupported lang: "+lang)}lang=lang.replace(runescape,funescape).toLowerCase();return function(elem){var elemLang;do{if(elemLang=documentIsHTML?elem.lang:elem.getAttribute("xml:lang")||elem.getAttribute("lang")){elemLang=elemLang.toLowerCase();return elemLang===lang||elemLang.indexOf(lang+"-")===0}}while((elem=elem.parentNode)&&elem.nodeType===1);return false}}),target:function(elem){var hash=window.location&&window.location.hash;return hash&&hash.slice(1)===elem.id},root:function(elem){return elem===docElem},focus:function(elem){return elem===document.activeElement&&(!document.hasFocus||document.hasFocus())&&!!(elem.type||elem.href||~elem.tabIndex)},enabled:function(elem){return elem.disabled===false},disabled:function(elem){return elem.disabled===true},checked:function(elem){var nodeName=elem.nodeName.toLowerCase();return nodeName==="input"&&!!elem.checked||nodeName==="option"&&!!elem.selected},selected:function(elem){if(elem.parentNode){elem.parentNode.selectedIndex}return elem.selected===true},empty:function(elem){for(elem=elem.firstChild;elem;elem=elem.nextSibling){if(elem.nodeType<6){return false}}return true},parent:function(elem){return!Expr.pseudos["empty"](elem)},header:function(elem){return rheader.test(elem.nodeName)},input:function(elem){return rinputs.test(elem.nodeName)},button:function(elem){var name=elem.nodeName.toLowerCase();return name==="input"&&elem.type==="button"||name==="button"},text:function(elem){var attr;return elem.nodeName.toLowerCase()==="input"&&elem.type==="text"&&((attr=elem.getAttribute("type"))==null||attr.toLowerCase()==="text")},first:createPositionalPseudo(function(){return[0]}),last:createPositionalPseudo(function(matchIndexes,length){return[length-1]}),eq:createPositionalPseudo(function(matchIndexes,length,argument){return[argument<0?argument+length:argument]}),even:createPositionalPseudo(function(matchIndexes,length){var i=0;for(;i<length;i+=2){matchIndexes.push(i)}return matchIndexes}),odd:createPositionalPseudo(function(matchIndexes,length){var i=1;for(;i<length;i+=2){matchIndexes.push(i)}return matchIndexes}),lt:createPositionalPseudo(function(matchIndexes,length,argument){var i=argument<0?argument+length:argument;for(;--i>=0;){matchIndexes.push(i)}return matchIndexes}),gt:createPositionalPseudo(function(matchIndexes,length,argument){var i=argument<0?argument+length:argument;for(;++i<length;){matchIndexes.push(i)}return matchIndexes})}};Expr.pseudos["nth"]=Expr.pseudos["eq"];for(i in{radio:true,checkbox:true,file:true,password:true,image:true}){Expr.pseudos[i]=createInputPseudo(i)}for(i in{submit:true,reset:true}){Expr.pseudos[i]=createButtonPseudo(i)}function setFilters(){}setFilters.prototype=Expr.filters=Expr.pseudos;Expr.setFilters=new setFilters;tokenize=Sizzle.tokenize=function(selector,parseOnly){var matched,match,tokens,type,soFar,groups,preFilters,cached=tokenCache[selector+" "];if(cached){return parseOnly?0:cached.slice(0)}soFar=selector;groups=[];preFilters=Expr.preFilter;while(soFar){if(!matched||(match=rcomma.exec(soFar))){if(match){soFar=soFar.slice(match[0].length)||soFar}groups.push(tokens=[])}matched=false;if(match=rcombinators.exec(soFar)){matched=match.shift();tokens.push({value:matched,type:match[0].replace(rtrim," ")});soFar=soFar.slice(matched.length)}for(type in Expr.filter){if((match=matchExpr[type].exec(soFar))&&(!preFilters[type]||(match=preFilters[type](match)))){matched=match.shift();tokens.push({value:matched,type:type,matches:match});soFar=soFar.slice(matched.length)}}if(!matched){break}}return parseOnly?soFar.length:soFar?Sizzle.error(selector):tokenCache(selector,groups).slice(0)};function toSelector(tokens){var i=0,len=tokens.length,selector="";for(;i<len;i++){selector+=tokens[i].value}return selector}function addCombinator(matcher,combinator,base){var dir=combinator.dir,checkNonElements=base&&dir==="parentNode",doneName=done++;return combinator.first?function(elem,context,xml){while(elem=elem[dir]){if(elem.nodeType===1||checkNonElements){return matcher(elem,context,xml)}}}:function(elem,context,xml){var oldCache,outerCache,newCache=[dirruns,doneName];if(xml){while(elem=elem[dir]){if(elem.nodeType===1||checkNonElements){if(matcher(elem,context,xml)){return true}}}}else{while(elem=elem[dir]){if(elem.nodeType===1||checkNonElements){outerCache=elem[expando]||(elem[expando]={});if((oldCache=outerCache[dir])&&oldCache[0]===dirruns&&oldCache[1]===doneName){return newCache[2]=oldCache[2]}else{outerCache[dir]=newCache;if(newCache[2]=matcher(elem,context,xml)){return true}}}}}}}function elementMatcher(matchers){return matchers.length>1?function(elem,context,xml){var i=matchers.length;while(i--){if(!matchers[i](elem,context,xml)){return false}}return true}:matchers[0]}function multipleContexts(selector,contexts,results){var i=0,len=contexts.length;for(;i<len;i++){Sizzle(selector,contexts[i],results)}return results}function condense(unmatched,map,filter,context,xml){var elem,newUnmatched=[],i=0,len=unmatched.length,mapped=map!=null;for(;i<len;i++){if(elem=unmatched[i]){if(!filter||filter(elem,context,xml)){newUnmatched.push(elem);if(mapped){map.push(i)}}}}return newUnmatched}function setMatcher(preFilter,selector,matcher,postFilter,postFinder,postSelector){if(postFilter&&!postFilter[expando]){postFilter=setMatcher(postFilter)}if(postFinder&&!postFinder[expando]){postFinder=setMatcher(postFinder,postSelector)}return markFunction(function(seed,results,context,xml){var temp,i,elem,preMap=[],postMap=[],preexisting=results.length,elems=seed||multipleContexts(selector||"*",context.nodeType?[context]:context,[]),matcherIn=preFilter&&(seed||!selector)?condense(elems,preMap,preFilter,context,xml):elems,matcherOut=matcher?postFinder||(seed?preFilter:preexisting||postFilter)?[]:results:matcherIn;if(matcher){matcher(matcherIn,matcherOut,context,xml)}if(postFilter){temp=condense(matcherOut,postMap);postFilter(temp,[],context,xml);i=temp.length;while(i--){if(elem=temp[i]){matcherOut[postMap[i]]=!(matcherIn[postMap[i]]=elem)}}}if(seed){if(postFinder||preFilter){if(postFinder){temp=[];i=matcherOut.length;while(i--){if(elem=matcherOut[i]){temp.push(matcherIn[i]=elem)}}postFinder(null,matcherOut=[],temp,xml)}i=matcherOut.length;while(i--){if((elem=matcherOut[i])&&(temp=postFinder?indexOf.call(seed,elem):preMap[i])>-1){seed[temp]=!(results[temp]=elem)}}}}else{matcherOut=condense(matcherOut===results?matcherOut.splice(preexisting,matcherOut.length):matcherOut);if(postFinder){postFinder(null,results,matcherOut,xml)}else{push.apply(results,matcherOut)}}})}function matcherFromTokens(tokens){var checkContext,matcher,j,len=tokens.length,leadingRelative=Expr.relative[tokens[0].type],implicitRelative=leadingRelative||Expr.relative[" "],i=leadingRelative?1:0,matchContext=addCombinator(function(elem){return elem===checkContext},implicitRelative,true),matchAnyContext=addCombinator(function(elem){return indexOf.call(checkContext,elem)>-1},implicitRelative,true),matchers=[function(elem,context,xml){return!leadingRelative&&(xml||context!==outermostContext)||((checkContext=context).nodeType?matchContext(elem,context,xml):matchAnyContext(elem,context,xml))}];for(;i<len;i++){if(matcher=Expr.relative[tokens[i].type]){matchers=[addCombinator(elementMatcher(matchers),matcher)]}else{matcher=Expr.filter[tokens[i].type].apply(null,tokens[i].matches);if(matcher[expando]){j=++i;for(;j<len;j++){if(Expr.relative[tokens[j].type]){break}}return setMatcher(i>1&&elementMatcher(matchers),i>1&&toSelector(tokens.slice(0,i-1).concat({value:tokens[i-2].type===" "?"*":""})).replace(rtrim,"$1"),matcher,i<j&&matcherFromTokens(tokens.slice(i,j)),j<len&&matcherFromTokens(tokens=tokens.slice(j)),j<len&&toSelector(tokens))}matchers.push(matcher)}}return elementMatcher(matchers)}function matcherFromGroupMatchers(elementMatchers,setMatchers){var bySet=setMatchers.length>0,byElement=elementMatchers.length>0,superMatcher=function(seed,context,xml,results,outermost){var elem,j,matcher,matchedCount=0,i="0",unmatched=seed&&[],setMatched=[],contextBackup=outermostContext,elems=seed||byElement&&Expr.find["TAG"]("*",outermost),dirrunsUnique=dirruns+=contextBackup==null?1:Math.random()||.1,len=elems.length;if(outermost){outermostContext=context!==document&&context}for(;i!==len&&(elem=elems[i])!=null;i++){if(byElement&&elem){j=0;while(matcher=elementMatchers[j++]){if(matcher(elem,context,xml)){results.push(elem);break}}if(outermost){dirruns=dirrunsUnique}}if(bySet){if(elem=!matcher&&elem){matchedCount--}if(seed){unmatched.push(elem)}}}matchedCount+=i;if(bySet&&i!==matchedCount){j=0;while(matcher=setMatchers[j++]){matcher(unmatched,setMatched,context,xml)}if(seed){if(matchedCount>0){while(i--){if(!(unmatched[i]||setMatched[i])){setMatched[i]=pop.call(results)}}}setMatched=condense(setMatched)}push.apply(results,setMatched);if(outermost&&!seed&&setMatched.length>0&&matchedCount+setMatchers.length>1){Sizzle.uniqueSort(results)}}if(outermost){dirruns=dirrunsUnique;outermostContext=contextBackup}return unmatched};return bySet?markFunction(superMatcher):superMatcher}compile=Sizzle.compile=function(selector,match){var i,setMatchers=[],elementMatchers=[],cached=compilerCache[selector+" "];if(!cached){if(!match){match=tokenize(selector)}i=match.length;while(i--){cached=matcherFromTokens(match[i]);if(cached[expando]){setMatchers.push(cached)}else{elementMatchers.push(cached)}}cached=compilerCache(selector,matcherFromGroupMatchers(elementMatchers,setMatchers));cached.selector=selector}return cached};select=Sizzle.select=function(selector,context,results,seed){var i,tokens,token,type,find,compiled=typeof selector==="function"&&selector,match=!seed&&tokenize(selector=compiled.selector||selector);results=results||[];if(match.length===1){tokens=match[0]=match[0].slice(0);if(tokens.length>2&&(token=tokens[0]).type==="ID"&&support.getById&&context.nodeType===9&&documentIsHTML&&Expr.relative[tokens[1].type]){context=(Expr.find["ID"](token.matches[0].replace(runescape,funescape),context)||[])[0];if(!context){return results}else if(compiled){context=context.parentNode}selector=selector.slice(tokens.shift().value.length)}i=matchExpr["needsContext"].test(selector)?0:tokens.length;while(i--){token=tokens[i];if(Expr.relative[type=token.type]){break}if(find=Expr.find[type]){if(seed=find(token.matches[0].replace(runescape,funescape),rsibling.test(tokens[0].type)&&testContext(context.parentNode)||context)){tokens.splice(i,1);selector=seed.length&&toSelector(tokens);if(!selector){push.apply(results,seed);return results}break}}}}(compiled||compile(selector,match))(seed,context,!documentIsHTML,results,rsibling.test(selector)&&testContext(context.parentNode)||context);return results};support.sortStable=expando.split("").sort(sortOrder).join("")===expando;support.detectDuplicates=!!hasDuplicate;setDocument();support.sortDetached=assert(function(div1){return div1.compareDocumentPosition(document.createElement("div"))&1});if(!assert(function(div){div.innerHTML="<a href='#'></a>";return div.firstChild.getAttribute("href")==="#"})){addHandle("type|href|height|width",function(elem,name,isXML){if(!isXML){return elem.getAttribute(name,name.toLowerCase()==="type"?1:2)}})}if(!support.attributes||!assert(function(div){div.innerHTML="<input/>";div.firstChild.setAttribute("value","");return div.firstChild.getAttribute("value")===""})){addHandle("value",function(elem,name,isXML){if(!isXML&&elem.nodeName.toLowerCase()==="input"){return elem.defaultValue}})}if(!assert(function(div){return div.getAttribute("disabled")==null})){addHandle(booleans,function(elem,name,isXML){var val;if(!isXML){return elem[name]===true?name.toLowerCase():(val=elem.getAttributeNode(name))&&val.specified?val.value:null}})}return Sizzle});define("tinymce/util/Arr",[],function(){var isArray=Array.isArray||function(obj){return Object.prototype.toString.call(obj)==="[object Array]"};function toArray(obj){var array=obj,i,l;if(!isArray(obj)){array=[];for(i=0,l=obj.length;i<l;i++){array[i]=obj[i]}}return array}function each(o,cb,s){var n,l;if(!o){return 0}s=s||o;if(o.length!==undefined){for(n=0,l=o.length;n<l;n++){if(cb.call(s,o[n],n,o)===false){return 0}}}else{for(n in o){if(o.hasOwnProperty(n)){if(cb.call(s,o[n],n,o)===false){return 0}}}}return 1}function map(array,callback){var out=[];each(array,function(item,index){out.push(callback(item,index,array))});return out}function filter(a,f){var o=[];each(a,function(v,index){if(!f||f(v,index,a)){o.push(v)}});return o}function indexOf(a,v){var i,l;if(a){for(i=0,l=a.length;i<l;i++){if(a[i]===v){return i}}}return-1}function reduce(collection,iteratee,accumulator,thisArg){var i=0;if(arguments.length<3){accumulator=collection[0]}for(;i<collection.length;i++){accumulator=iteratee.call(thisArg,accumulator,collection[i],i)}return accumulator}function findIndex(array,predicate,thisArg){var i,l;for(i=0,l=array.length;i<l;i++){if(predicate.call(thisArg,array[i],i,array)){return i}}return-1}function find(array,predicate,thisArg){var idx=findIndex(array,predicate,thisArg);if(idx!==-1){return array[idx]}return undefined}function last(collection){return collection[collection.length-1]}return{isArray:isArray,toArray:toArray,each:each,map:map,filter:filter,indexOf:indexOf,reduce:reduce,findIndex:findIndex,find:find,last:last}});define("tinymce/util/Tools",["tinymce/Env","tinymce/util/Arr"],function(Env,Arr){var whiteSpaceRegExp=/^\s*|\s*$/g;function trim(str){return str===null||str===undefined?"":(""+str).replace(whiteSpaceRegExp,"")}function is(obj,type){if(!type){return obj!==undefined}if(type=="array"&&Arr.isArray(obj)){return true}return typeof obj==type}function makeMap(items,delim,map){var i;items=items||[];delim=delim||",";if(typeof items=="string"){items=items.split(delim)}map=map||{};i=items.length;while(i--){map[items[i]]={}}return map}function create(s,p,root){var self=this,sp,ns,cn,scn,c,de=0;s=/^((static) )?([\w.]+)(:([\w.]+))?/.exec(s);cn=s[3].match(/(^|\.)(\w+)$/i)[2];ns=self.createNS(s[3].replace(/\.\w+$/,""),root);if(ns[cn]){return}if(s[2]=="static"){ns[cn]=p;if(this.onCreate){this.onCreate(s[2],s[3],ns[cn])}return}if(!p[cn]){p[cn]=function(){};de=1}ns[cn]=p[cn];self.extend(ns[cn].prototype,p);if(s[5]){sp=self.resolve(s[5]).prototype;scn=s[5].match(/\.(\w+)$/i)[1];c=ns[cn];if(de){ns[cn]=function(){return sp[scn].apply(this,arguments)}}else{ns[cn]=function(){this.parent=sp[scn];return c.apply(this,arguments)}}ns[cn].prototype[cn]=ns[cn];self.each(sp,function(f,n){ns[cn].prototype[n]=sp[n]});self.each(p,function(f,n){if(sp[n]){ns[cn].prototype[n]=function(){this.parent=sp[n];return f.apply(this,arguments)}}else{if(n!=cn){ns[cn].prototype[n]=f}}})}self.each(p["static"],function(f,n){ns[cn][n]=f})}function extend(obj,ext){var i,l,name,args=arguments,value;for(i=1,l=args.length;i<l;i++){ext=args[i];for(name in ext){if(ext.hasOwnProperty(name)){value=ext[name];if(value!==undefined){obj[name]=value}}}}return obj}function walk(o,f,n,s){s=s||this;if(o){if(n){o=o[n]}Arr.each(o,function(o,i){if(f.call(s,o,i,n)===false){return false}walk(o,f,n,s)})}}function createNS(n,o){var i,v;o=o||window;n=n.split(".");for(i=0;i<n.length;i++){v=n[i];if(!o[v]){o[v]={}}o=o[v]}return o}function resolve(n,o){var i,l;o=o||window;n=n.split(".");for(i=0,l=n.length;i<l;i++){o=o[n[i]];if(!o){break}}return o}function explode(s,d){if(!s||is(s,"array")){return s}return Arr.map(s.split(d||","),trim)}function _addCacheSuffix(url){var cacheSuffix=Env.cacheSuffix;if(cacheSuffix){url+=(url.indexOf("?")===-1?"?":"&")+cacheSuffix}return url}return{trim:trim,isArray:Arr.isArray,is:is,toArray:Arr.toArray,makeMap:makeMap,each:Arr.each,map:Arr.map,grep:Arr.filter,inArray:Arr.indexOf,extend:extend,create:create,walk:walk,createNS:createNS,resolve:resolve,explode:explode,_addCacheSuffix:_addCacheSuffix}});define("tinymce/dom/DomQuery",["tinymce/dom/EventUtils","tinymce/dom/Sizzle","tinymce/util/Tools","tinymce/Env"],function(EventUtils,Sizzle,Tools,Env){var doc=document,push=Array.prototype.push,slice=Array.prototype.slice;var rquickExpr=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/;var Event=EventUtils.Event,undef;var skipUniques=Tools.makeMap("children,contents,next,prev");function isDefined(obj){return typeof obj!=="undefined"}function isString(obj){return typeof obj==="string"}function isWindow(obj){return obj&&obj==obj.window}function createFragment(html,fragDoc){var frag,node,container;fragDoc=fragDoc||doc;container=fragDoc.createElement("div");frag=fragDoc.createDocumentFragment();container.innerHTML=html;while(node=container.firstChild){frag.appendChild(node)}return frag}function domManipulate(targetNodes,sourceItem,callback,reverse){var i;if(isString(sourceItem)){sourceItem=createFragment(sourceItem,getElementDocument(targetNodes[0]))}else if(sourceItem.length&&!sourceItem.nodeType){sourceItem=DomQuery.makeArray(sourceItem);if(reverse){for(i=sourceItem.length-1;i>=0;i--){domManipulate(targetNodes,sourceItem[i],callback,reverse)}}else{for(i=0;i<sourceItem.length;i++){domManipulate(targetNodes,sourceItem[i],callback,reverse)}}return targetNodes}if(sourceItem.nodeType){i=targetNodes.length;while(i--){callback.call(targetNodes[i],sourceItem)}}return targetNodes}function hasClass(node,className){return node&&className&&(" "+node.className+" ").indexOf(" "+className+" ")!==-1}function wrap(elements,wrapper,all){var lastParent,newWrapper;wrapper=DomQuery(wrapper)[0];elements.each(function(){var self=this;if(!all||lastParent!=self.parentNode){lastParent=self.parentNode;newWrapper=wrapper.cloneNode(false);self.parentNode.insertBefore(newWrapper,self);newWrapper.appendChild(self)}else{newWrapper.appendChild(self)}});return elements}var numericCssMap=Tools.makeMap("fillOpacity fontWeight lineHeight opacity orphans widows zIndex zoom"," ");var booleanMap=Tools.makeMap("checked compact declare defer disabled ismap multiple nohref noshade nowrap readonly selected"," ");var propFix={for:"htmlFor",class:"className",readonly:"readOnly"};var cssFix={float:"cssFloat"};var attrHooks={},cssHooks={};function DomQuery(selector,context){return new DomQuery.fn.init(selector,context)}function inArray(item,array){var i;if(array.indexOf){return array.indexOf(item)}i=array.length;while(i--){if(array[i]===item){return i}}return-1}var whiteSpaceRegExp=/^\s*|\s*$/g;function trim(str){return str===null||str===undef?"":(""+str).replace(whiteSpaceRegExp,"")}function each(obj,callback){var length,key,i,undef,value;if(obj){length=obj.length;if(length===undef){for(key in obj){if(obj.hasOwnProperty(key)){value=obj[key];if(callback.call(value,key,value)===false){break}}}}else{for(i=0;i<length;i++){value=obj[i];if(callback.call(value,i,value)===false){break}}}}return obj}function grep(array,callback){var out=[];each(array,function(i,item){if(callback(item,i)){out.push(item)}});return out}function getElementDocument(element){if(!element){return doc}if(element.nodeType==9){return element}return element.ownerDocument}DomQuery.fn=DomQuery.prototype={constructor:DomQuery,selector:"",context:null,length:0,init:function(selector,context){var self=this,match,node;if(!selector){return self}if(selector.nodeType){self.context=self[0]=selector;self.length=1;return self}if(context&&context.nodeType){self.context=context}else{if(context){return DomQuery(selector).attr(context)}self.context=context=document}if(isString(selector)){self.selector=selector;if(selector.charAt(0)==="<"&&selector.charAt(selector.length-1)===">"&&selector.length>=3){match=[null,selector,null]}else{match=rquickExpr.exec(selector)}if(match){if(match[1]){node=createFragment(selector,getElementDocument(context)).firstChild;while(node){push.call(self,node);node=node.nextSibling}}else{node=getElementDocument(context).getElementById(match[2]);if(!node){return self}if(node.id!==match[2]){return self.find(selector)}self.length=1;self[0]=node}}else{return DomQuery(context).find(selector)}}else{this.add(selector,false)}return self},toArray:function(){return Tools.toArray(this)},add:function(items,sort){var self=this,nodes,i;if(isString(items)){return self.add(DomQuery(items))}if(sort!==false){nodes=DomQuery.unique(self.toArray().concat(DomQuery.makeArray(items)));self.length=nodes.length;for(i=0;i<nodes.length;i++){self[i]=nodes[i]}}else{push.apply(self,DomQuery.makeArray(items))}return self},attr:function(name,value){var self=this,hook;if(typeof name==="object"){each(name,function(name,value){self.attr(name,value)})}else if(isDefined(value)){this.each(function(){var hook;if(this.nodeType===1){hook=attrHooks[name];if(hook&&hook.set){hook.set(this,value);return}if(value===null){this.removeAttribute(name,2)}else{this.setAttribute(name,value,2)}}})}else{if(self[0]&&self[0].nodeType===1){hook=attrHooks[name];if(hook&&hook.get){return hook.get(self[0],name)}if(booleanMap[name]){return self.prop(name)?name:undef}value=self[0].getAttribute(name,2);if(value===null){value=undef}}return value}return self},removeAttr:function(name){return this.attr(name,null)},prop:function(name,value){var self=this;name=propFix[name]||name;if(typeof name==="object"){each(name,function(name,value){self.prop(name,value)})}else if(isDefined(value)){this.each(function(){if(this.nodeType==1){this[name]=value}})}else{if(self[0]&&self[0].nodeType&&name in self[0]){return self[0][name]}return value}return self},css:function(name,value){var self=this,elm,hook;function camel(name){return name.replace(/-(\D)/g,function(a,b){return b.toUpperCase()})}function dashed(name){return name.replace(/[A-Z]/g,function(a){return"-"+a})}if(typeof name==="object"){each(name,function(name,value){self.css(name,value)})}else{if(isDefined(value)){name=camel(name);if(typeof value==="number"&&!numericCssMap[name]){value+="px"}self.each(function(){var style=this.style;hook=cssHooks[name];if(hook&&hook.set){hook.set(this,value);return}try{this.style[cssFix[name]||name]=value}catch(ex){}if(value===null||value===""){if(style.removeProperty){style.removeProperty(dashed(name))}else{style.removeAttribute(name)}}})}else{elm=self[0];hook=cssHooks[name];if(hook&&hook.get){return hook.get(elm)}if(elm.ownerDocument.defaultView){try{return elm.ownerDocument.defaultView.getComputedStyle(elm,null).getPropertyValue(dashed(name))}catch(ex){return undef}}else if(elm.currentStyle){return elm.currentStyle[camel(name)]}}}return self},remove:function(){var self=this,node,i=this.length;while(i--){node=self[i];Event.clean(node);if(node.parentNode){node.parentNode.removeChild(node)}}return this},empty:function(){var self=this,node,i=this.length;while(i--){node=self[i];while(node.firstChild){node.removeChild(node.firstChild)}}return this},html:function(value){var self=this,i;if(isDefined(value)){i=self.length;try{while(i--){self[i].innerHTML=value}}catch(ex){DomQuery(self[i]).empty().append(value)}return self}return self[0]?self[0].innerHTML:""},text:function(value){var self=this,i;if(isDefined(value)){i=self.length;while(i--){if("innerText"in self[i]){self[i].innerText=value}else{self[0].textContent=value}}return self}return self[0]?self[0].innerText||self[0].textContent:""},append:function(){return domManipulate(this,arguments,function(node){if(this.nodeType===1||this.host&&this.host.nodeType===1){this.appendChild(node)}})},prepend:function(){return domManipulate(this,arguments,function(node){if(this.nodeType===1||this.host&&this.host.nodeType===1){this.insertBefore(node,this.firstChild)}},true)},before:function(){var self=this;if(self[0]&&self[0].parentNode){return domManipulate(self,arguments,function(node){this.parentNode.insertBefore(node,this)})}return self},after:function(){var self=this;if(self[0]&&self[0].parentNode){return domManipulate(self,arguments,function(node){this.parentNode.insertBefore(node,this.nextSibling)},true)}return self},appendTo:function(val){DomQuery(val).append(this);return this},prependTo:function(val){DomQuery(val).prepend(this);return this},replaceWith:function(content){return this.before(content).remove()},wrap:function(content){return wrap(this,content)},wrapAll:function(content){return wrap(this,content,true)},wrapInner:function(content){this.each(function(){DomQuery(this).contents().wrapAll(content)});return this},unwrap:function(){return this.parent().each(function(){DomQuery(this).replaceWith(this.childNodes)})},clone:function(){var result=[];this.each(function(){result.push(this.cloneNode(true))});return DomQuery(result)},addClass:function(className){return this.toggleClass(className,true)},removeClass:function(className){return this.toggleClass(className,false)},toggleClass:function(className,state){var self=this;if(typeof className!="string"){return self}if(className.indexOf(" ")!==-1){each(className.split(" "),function(){self.toggleClass(this,state)})}else{self.each(function(index,node){var existingClassName,classState;classState=hasClass(node,className);if(classState!==state){existingClassName=node.className;if(classState){node.className=trim((" "+existingClassName+" ").replace(" "+className+" "," "))}else{node.className+=existingClassName?" "+className:className}}})}return self},hasClass:function(className){return hasClass(this[0],className)},each:function(callback){return each(this,callback)},on:function(name,callback){return this.each(function(){Event.bind(this,name,callback)})},off:function(name,callback){return this.each(function(){Event.unbind(this,name,callback)})},trigger:function(name){return this.each(function(){if(typeof name=="object"){Event.fire(this,name.type,name)}else{Event.fire(this,name)}})},show:function(){return this.css("display","")},hide:function(){return this.css("display","none")},slice:function(){return new DomQuery(slice.apply(this,arguments))},eq:function(index){return index===-1?this.slice(index):this.slice(index,+index+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},find:function(selector){var i,l,ret=[];for(i=0,l=this.length;i<l;i++){DomQuery.find(selector,this[i],ret)}return DomQuery(ret)},filter:function(selector){if(typeof selector=="function"){return DomQuery(grep(this.toArray(),function(item,i){return selector(i,item)}))}return DomQuery(DomQuery.filter(selector,this.toArray()))},closest:function(selector){var result=[];if(selector instanceof DomQuery){selector=selector[0]}this.each(function(i,node){while(node){if(typeof selector=="string"&&DomQuery(node).is(selector)){result.push(node);break}else if(node==selector){result.push(node);break}node=node.parentNode}});return DomQuery(result)},offset:function(offset){var elm,doc,docElm;
var x=0,y=0,pos;if(!offset){elm=this[0];if(elm){doc=elm.ownerDocument;docElm=doc.documentElement;if(elm.getBoundingClientRect){pos=elm.getBoundingClientRect();x=pos.left+(docElm.scrollLeft||doc.body.scrollLeft)-docElm.clientLeft;y=pos.top+(docElm.scrollTop||doc.body.scrollTop)-docElm.clientTop}}return{left:x,top:y}}return this.css(offset)},push:push,sort:[].sort,splice:[].splice};Tools.extend(DomQuery,{extend:Tools.extend,makeArray:function(object){if(isWindow(object)||object.nodeType){return[object]}return Tools.toArray(object)},inArray:inArray,isArray:Tools.isArray,each:each,trim:trim,grep:grep,find:Sizzle,expr:Sizzle.selectors,unique:Sizzle.uniqueSort,text:Sizzle.getText,contains:Sizzle.contains,filter:function(expr,elems,not){var i=elems.length;if(not){expr=":not("+expr+")"}while(i--){if(elems[i].nodeType!=1){elems.splice(i,1)}}if(elems.length===1){elems=DomQuery.find.matchesSelector(elems[0],expr)?[elems[0]]:[]}else{elems=DomQuery.find.matches(expr,elems)}return elems}});function dir(el,prop,until){var matched=[],cur=el[prop];if(typeof until!="string"&&until instanceof DomQuery){until=until[0]}while(cur&&cur.nodeType!==9){if(until!==undefined){if(cur===until){break}if(typeof until=="string"&&DomQuery(cur).is(until)){break}}if(cur.nodeType===1){matched.push(cur)}cur=cur[prop]}return matched}function sibling(node,siblingName,nodeType,until){var result=[];if(until instanceof DomQuery){until=until[0]}for(;node;node=node[siblingName]){if(nodeType&&node.nodeType!==nodeType){continue}if(until!==undefined){if(node===until){break}if(typeof until=="string"&&DomQuery(node).is(until)){break}}result.push(node)}return result}function firstSibling(node,siblingName,nodeType){for(node=node[siblingName];node;node=node[siblingName]){if(node.nodeType==nodeType){return node}}return null}each({parent:function(node){var parent=node.parentNode;return parent&&parent.nodeType!==11?parent:null},parents:function(node){return dir(node,"parentNode")},next:function(node){return firstSibling(node,"nextSibling",1)},prev:function(node){return firstSibling(node,"previousSibling",1)},children:function(node){return sibling(node.firstChild,"nextSibling",1)},contents:function(node){return Tools.toArray((node.nodeName==="iframe"?node.contentDocument||node.contentWindow.document:node).childNodes)}},function(name,fn){DomQuery.fn[name]=function(selector){var self=this,result=[];self.each(function(){var nodes=fn.call(result,this,selector,result);if(nodes){if(DomQuery.isArray(nodes)){result.push.apply(result,nodes)}else{result.push(nodes)}}});if(this.length>1){if(!skipUniques[name]){result=DomQuery.unique(result)}if(name.indexOf("parents")===0){result=result.reverse()}}result=DomQuery(result);if(selector){return result.filter(selector)}return result}});each({parentsUntil:function(node,until){return dir(node,"parentNode",until)},nextUntil:function(node,until){return sibling(node,"nextSibling",1,until).slice(1)},prevUntil:function(node,until){return sibling(node,"previousSibling",1,until).slice(1)}},function(name,fn){DomQuery.fn[name]=function(selector,filter){var self=this,result=[];self.each(function(){var nodes=fn.call(result,this,selector,result);if(nodes){if(DomQuery.isArray(nodes)){result.push.apply(result,nodes)}else{result.push(nodes)}}});if(this.length>1){result=DomQuery.unique(result);if(name.indexOf("parents")===0||name==="prevUntil"){result=result.reverse()}}result=DomQuery(result);if(filter){return result.filter(filter)}return result}});DomQuery.fn.is=function(selector){return!!selector&&this.filter(selector).length>0};DomQuery.fn.init.prototype=DomQuery.fn;DomQuery.overrideDefaults=function(callback){var defaults;function sub(selector,context){defaults=defaults||callback();if(arguments.length===0){selector=defaults.element}if(!context){context=defaults.context}return new sub.fn.init(selector,context)}DomQuery.extend(sub,this);return sub};function appendHooks(targetHooks,prop,hooks){each(hooks,function(name,func){targetHooks[name]=targetHooks[name]||{};targetHooks[name][prop]=func})}if(Env.ie&&Env.ie<8){appendHooks(attrHooks,"get",{maxlength:function(elm){var value=elm.maxLength;if(value===2147483647){return undef}return value},size:function(elm){var value=elm.size;if(value===20){return undef}return value},class:function(elm){return elm.className},style:function(elm){var value=elm.style.cssText;if(value.length===0){return undef}return value}});appendHooks(attrHooks,"set",{class:function(elm,value){elm.className=value},style:function(elm,value){elm.style.cssText=value}})}if(Env.ie&&Env.ie<9){cssFix["float"]="styleFloat";appendHooks(cssHooks,"set",{opacity:function(elm,value){var style=elm.style;if(value===null||value===""){style.removeAttribute("filter")}else{style.zoom=1;style.filter="alpha(opacity="+value*100+")"}}})}DomQuery.attrHooks=attrHooks;DomQuery.cssHooks=cssHooks;return DomQuery});define("tinymce/html/Styles",[],function(){return function(settings,schema){var rgbRegExp=/rgb\s*\(\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\s*\)/gi,urlOrStrRegExp=/(?:url(?:(?:\(\s*\"([^\"]+)\"\s*\))|(?:\(\s*\'([^\']+)\'\s*\))|(?:\(\s*([^)\s]+)\s*\))))|(?:\'([^\']+)\')|(?:\"([^\"]+)\")/gi,styleRegExp=/\s*([^:]+):\s*([^;]+);?/g,trimRightRegExp=/\s+$/,undef,i,encodingLookup={},encodingItems,validStyles,invalidStyles,invisibleChar="\ufeff";settings=settings||{};if(schema){validStyles=schema.getValidStyles();invalidStyles=schema.getInvalidStyles()}encodingItems=("\\\" \\' \\; \\: ; : "+invisibleChar).split(" ");for(i=0;i<encodingItems.length;i++){encodingLookup[encodingItems[i]]=invisibleChar+i;encodingLookup[invisibleChar+i]=encodingItems[i]}function toHex(match,r,g,b){function hex(val){val=parseInt(val,10).toString(16);return val.length>1?val:"0"+val}return"#"+hex(r)+hex(g)+hex(b)}return{toHex:function(color){return color.replace(rgbRegExp,toHex)},parse:function(css){var styles={},matches,name,value,isEncoded,urlConverter=settings.url_converter;var urlConverterScope=settings.url_converter_scope||this;function compress(prefix,suffix,noJoin){var top,right,bottom,left;top=styles[prefix+"-top"+suffix];if(!top){return}right=styles[prefix+"-right"+suffix];if(!right){return}bottom=styles[prefix+"-bottom"+suffix];if(!bottom){return}left=styles[prefix+"-left"+suffix];if(!left){return}var box=[top,right,bottom,left];i=box.length-1;while(i--){if(box[i]!==box[i+1]){break}}if(i>-1&&noJoin){return}styles[prefix+suffix]=i==-1?box[0]:box.join(" ");delete styles[prefix+"-top"+suffix];delete styles[prefix+"-right"+suffix];delete styles[prefix+"-bottom"+suffix];delete styles[prefix+"-left"+suffix]}function canCompress(key){var value=styles[key],i;if(!value){return}value=value.split(" ");i=value.length;while(i--){if(value[i]!==value[0]){return false}}styles[key]=value[0];return true}function compress2(target,a,b,c){if(!canCompress(a)){return}if(!canCompress(b)){return}if(!canCompress(c)){return}styles[target]=styles[a]+" "+styles[b]+" "+styles[c];delete styles[a];delete styles[b];delete styles[c]}function encode(str){isEncoded=true;return encodingLookup[str]}function decode(str,keep_slashes){if(isEncoded){str=str.replace(/\uFEFF[0-9]/g,function(str){return encodingLookup[str]})}if(!keep_slashes){str=str.replace(/\\([\'\";:])/g,"$1")}return str}function processUrl(match,url,url2,url3,str,str2){str=str||str2;if(str){str=decode(str);return"'"+str.replace(/\'/g,"\\'")+"'"}url=decode(url||url2||url3);if(!settings.allow_script_urls){var scriptUrl=url.replace(/[\s\r\n]+/,"");if(/(java|vb)script:/i.test(scriptUrl)){return""}if(!settings.allow_svg_data_urls&&/^data:image\/svg/i.test(scriptUrl)){return""}}if(urlConverter){url=urlConverter.call(urlConverterScope,url,"style")}return"url('"+url.replace(/\'/g,"\\'")+"')"}if(css){css=css.replace(/[\u0000-\u001F]/g,"");css=css.replace(/\\[\"\';:\uFEFF]/g,encode).replace(/\"[^\"]+\"|\'[^\']+\'/g,function(str){return str.replace(/[;:]/g,encode)});while(matches=styleRegExp.exec(css)){name=matches[1].replace(trimRightRegExp,"").toLowerCase();value=matches[2].replace(trimRightRegExp,"");value=value.replace(/\\[0-9a-f]+/g,function(e){return String.fromCharCode(parseInt(e.substr(1),16))});if(name&&value.length>0){if(!settings.allow_script_urls&&(name=="behavior"||/expression\s*\(|\/\*|\*\//.test(value))){continue}if(name==="font-weight"&&value==="700"){value="bold"}else if(name==="color"||name==="background-color"){value=value.toLowerCase()}value=value.replace(rgbRegExp,toHex);value=value.replace(urlOrStrRegExp,processUrl);styles[name]=isEncoded?decode(value,true):value}styleRegExp.lastIndex=matches.index+matches[0].length}compress("border","",true);compress("border","-width");compress("border","-color");compress("border","-style");compress("padding","");compress("margin","");compress2("border","border-width","border-style","border-color");if(styles.border==="medium none"){delete styles.border}if(styles["border-image"]==="none"){delete styles["border-image"]}}return styles},serialize:function(styles,elementName){var css="",name,value;function serializeStyles(name){var styleList,i,l,value;styleList=validStyles[name];if(styleList){for(i=0,l=styleList.length;i<l;i++){name=styleList[i];value=styles[name];if(value!==undef&&value.length>0){css+=(css.length>0?" ":"")+name+": "+value+";"}}}}function isValid(name,elementName){var styleMap;styleMap=invalidStyles["*"];if(styleMap&&styleMap[name]){return false}styleMap=invalidStyles[elementName];if(styleMap&&styleMap[name]){return false}return true}if(elementName&&validStyles){serializeStyles("*");serializeStyles(elementName)}else{for(name in styles){value=styles[name];if(value!==undef&&value.length>0){if(!invalidStyles||isValid(name,elementName)){css+=(css.length>0?" ":"")+name+": "+value+";"}}}}return css}}}});define("tinymce/dom/TreeWalker",[],function(){return function(startNode,rootNode){var node=startNode;function findSibling(node,startName,siblingName,shallow){var sibling,parent;if(node){if(!shallow&&node[startName]){return node[startName]}if(node!=rootNode){sibling=node[siblingName];if(sibling){return sibling}for(parent=node.parentNode;parent&&parent!=rootNode;parent=parent.parentNode){sibling=parent[siblingName];if(sibling){return sibling}}}}}function findPreviousNode(node,startName,siblingName,shallow){var sibling,parent,child;if(node){sibling=node[siblingName];if(rootNode&&sibling===rootNode){return}if(sibling){if(!shallow){for(child=sibling[startName];child;child=child[startName]){if(!child[startName]){return child}}}return sibling}parent=node.parentNode;if(parent&&parent!==rootNode){return parent}}}this.current=function(){return node};this.next=function(shallow){node=findSibling(node,"firstChild","nextSibling",shallow);return node};this.prev=function(shallow){node=findSibling(node,"lastChild","previousSibling",shallow);return node};this.prev2=function(shallow){node=findPreviousNode(node,"lastChild","previousSibling",shallow);return node}}});define("tinymce/dom/Range",["tinymce/util/Tools"],function(Tools){function Range(dom){var self=this,doc=dom.doc,EXTRACT=0,CLONE=1,DELETE=2,TRUE=true,FALSE=false,START_OFFSET="startOffset",START_CONTAINER="startContainer",END_CONTAINER="endContainer",END_OFFSET="endOffset",extend=Tools.extend,nodeIndex=dom.nodeIndex;function createDocumentFragment(){return doc.createDocumentFragment()}function setStart(n,o){_setEndPoint(TRUE,n,o)}function setEnd(n,o){_setEndPoint(FALSE,n,o)}function setStartBefore(n){setStart(n.parentNode,nodeIndex(n))}function setStartAfter(n){setStart(n.parentNode,nodeIndex(n)+1)}function setEndBefore(n){setEnd(n.parentNode,nodeIndex(n))}function setEndAfter(n){setEnd(n.parentNode,nodeIndex(n)+1)}function collapse(ts){if(ts){self[END_CONTAINER]=self[START_CONTAINER];self[END_OFFSET]=self[START_OFFSET]}else{self[START_CONTAINER]=self[END_CONTAINER];self[START_OFFSET]=self[END_OFFSET]}self.collapsed=TRUE}function selectNode(n){setStartBefore(n);setEndAfter(n)}function selectNodeContents(n){setStart(n,0);setEnd(n,n.nodeType===1?n.childNodes.length:n.nodeValue.length)}function compareBoundaryPoints(h,r){var sc=self[START_CONTAINER],so=self[START_OFFSET],ec=self[END_CONTAINER],eo=self[END_OFFSET],rsc=r.startContainer,rso=r.startOffset,rec=r.endContainer,reo=r.endOffset;if(h===0){return _compareBoundaryPoints(sc,so,rsc,rso)}if(h===1){return _compareBoundaryPoints(ec,eo,rsc,rso)}if(h===2){return _compareBoundaryPoints(ec,eo,rec,reo)}if(h===3){return _compareBoundaryPoints(sc,so,rec,reo)}}function deleteContents(){_traverse(DELETE)}function extractContents(){return _traverse(EXTRACT)}function cloneContents(){return _traverse(CLONE)}function insertNode(n){var startContainer=this[START_CONTAINER],startOffset=this[START_OFFSET],nn,o;if((startContainer.nodeType===3||startContainer.nodeType===4)&&startContainer.nodeValue){if(!startOffset){startContainer.parentNode.insertBefore(n,startContainer)}else if(startOffset>=startContainer.nodeValue.length){dom.insertAfter(n,startContainer)}else{nn=startContainer.splitText(startOffset);startContainer.parentNode.insertBefore(n,nn)}}else{if(startContainer.childNodes.length>0){o=startContainer.childNodes[startOffset]}if(o){startContainer.insertBefore(n,o)}else{if(startContainer.nodeType==3){dom.insertAfter(n,startContainer)}else{startContainer.appendChild(n)}}}}function surroundContents(n){var f=self.extractContents();self.insertNode(n);n.appendChild(f);self.selectNode(n)}function cloneRange(){return extend(new Range(dom),{startContainer:self[START_CONTAINER],startOffset:self[START_OFFSET],endContainer:self[END_CONTAINER],endOffset:self[END_OFFSET],collapsed:self.collapsed,commonAncestorContainer:self.commonAncestorContainer})}function _getSelectedNode(container,offset){var child;if(container.nodeType==3){return container}if(offset<0){return container}child=container.firstChild;while(child&&offset>0){--offset;child=child.nextSibling}if(child){return child}return container}function _isCollapsed(){return self[START_CONTAINER]==self[END_CONTAINER]&&self[START_OFFSET]==self[END_OFFSET]}function _compareBoundaryPoints(containerA,offsetA,containerB,offsetB){var c,offsetC,n,cmnRoot,childA,childB;if(containerA==containerB){if(offsetA==offsetB){return 0}if(offsetA<offsetB){return-1}return 1}c=containerB;while(c&&c.parentNode!=containerA){c=c.parentNode}if(c){offsetC=0;n=containerA.firstChild;while(n!=c&&offsetC<offsetA){offsetC++;n=n.nextSibling}if(offsetA<=offsetC){return-1}return 1}c=containerA;while(c&&c.parentNode!=containerB){c=c.parentNode}if(c){offsetC=0;n=containerB.firstChild;while(n!=c&&offsetC<offsetB){offsetC++;n=n.nextSibling}if(offsetC<offsetB){return-1}return 1}cmnRoot=dom.findCommonAncestor(containerA,containerB);childA=containerA;while(childA&&childA.parentNode!=cmnRoot){childA=childA.parentNode}if(!childA){childA=cmnRoot}childB=containerB;while(childB&&childB.parentNode!=cmnRoot){childB=childB.parentNode}if(!childB){childB=cmnRoot}if(childA==childB){return 0}n=cmnRoot.firstChild;while(n){if(n==childA){return-1}if(n==childB){return 1}n=n.nextSibling}}function _setEndPoint(st,n,o){var ec,sc;if(st){self[START_CONTAINER]=n;self[START_OFFSET]=o}else{self[END_CONTAINER]=n;self[END_OFFSET]=o}ec=self[END_CONTAINER];while(ec.parentNode){ec=ec.parentNode}sc=self[START_CONTAINER];while(sc.parentNode){sc=sc.parentNode}if(sc==ec){if(_compareBoundaryPoints(self[START_CONTAINER],self[START_OFFSET],self[END_CONTAINER],self[END_OFFSET])>0){self.collapse(st)}}else{self.collapse(st)}self.collapsed=_isCollapsed();self.commonAncestorContainer=dom.findCommonAncestor(self[START_CONTAINER],self[END_CONTAINER])}function _traverse(how){var c,endContainerDepth=0,startContainerDepth=0,p,depthDiff,startNode,endNode,sp,ep;if(self[START_CONTAINER]==self[END_CONTAINER]){return _traverseSameContainer(how)}for(c=self[END_CONTAINER],p=c.parentNode;p;c=p,p=p.parentNode){if(p==self[START_CONTAINER]){return _traverseCommonStartContainer(c,how)}++endContainerDepth}for(c=self[START_CONTAINER],p=c.parentNode;p;c=p,p=p.parentNode){if(p==self[END_CONTAINER]){return _traverseCommonEndContainer(c,how)}++startContainerDepth}depthDiff=startContainerDepth-endContainerDepth;startNode=self[START_CONTAINER];while(depthDiff>0){startNode=startNode.parentNode;depthDiff--}endNode=self[END_CONTAINER];while(depthDiff<0){endNode=endNode.parentNode;depthDiff++}for(sp=startNode.parentNode,ep=endNode.parentNode;sp!=ep;sp=sp.parentNode,ep=ep.parentNode){startNode=sp;endNode=ep}return _traverseCommonAncestors(startNode,endNode,how)}function _traverseSameContainer(how){var frag,s,sub,n,cnt,sibling,xferNode,start,len;if(how!=DELETE){frag=createDocumentFragment()}if(self[START_OFFSET]==self[END_OFFSET]){return frag}if(self[START_CONTAINER].nodeType==3){s=self[START_CONTAINER].nodeValue;sub=s.substring(self[START_OFFSET],self[END_OFFSET]);if(how!=CLONE){n=self[START_CONTAINER];start=self[START_OFFSET];len=self[END_OFFSET]-self[START_OFFSET];if(start===0&&len>=n.nodeValue.length-1){n.parentNode.removeChild(n)}else{n.deleteData(start,len)}self.collapse(TRUE)}if(how==DELETE){return}if(sub.length>0){frag.appendChild(doc.createTextNode(sub))}return frag}n=_getSelectedNode(self[START_CONTAINER],self[START_OFFSET]);cnt=self[END_OFFSET]-self[START_OFFSET];while(n&&cnt>0){sibling=n.nextSibling;xferNode=_traverseFullySelected(n,how);if(frag){frag.appendChild(xferNode)}--cnt;n=sibling}if(how!=CLONE){self.collapse(TRUE)}return frag}function _traverseCommonStartContainer(endAncestor,how){var frag,n,endIdx,cnt,sibling,xferNode;if(how!=DELETE){frag=createDocumentFragment()}n=_traverseRightBoundary(endAncestor,how);if(frag){frag.appendChild(n)}endIdx=nodeIndex(endAncestor);cnt=endIdx-self[START_OFFSET];if(cnt<=0){if(how!=CLONE){self.setEndBefore(endAncestor);self.collapse(FALSE)}return frag}n=endAncestor.previousSibling;while(cnt>0){sibling=n.previousSibling;xferNode=_traverseFullySelected(n,how);if(frag){frag.insertBefore(xferNode,frag.firstChild)}--cnt;n=sibling}if(how!=CLONE){self.setEndBefore(endAncestor);self.collapse(FALSE)}return frag}function _traverseCommonEndContainer(startAncestor,how){var frag,startIdx,n,cnt,sibling,xferNode;if(how!=DELETE){frag=createDocumentFragment()}n=_traverseLeftBoundary(startAncestor,how);if(frag){frag.appendChild(n)}startIdx=nodeIndex(startAncestor);++startIdx;cnt=self[END_OFFSET]-startIdx;n=startAncestor.nextSibling;while(n&&cnt>0){sibling=n.nextSibling;xferNode=_traverseFullySelected(n,how);if(frag){frag.appendChild(xferNode)}--cnt;n=sibling}if(how!=CLONE){self.setStartAfter(startAncestor);self.collapse(TRUE)}return frag}function _traverseCommonAncestors(startAncestor,endAncestor,how){var n,frag,startOffset,endOffset,cnt,sibling,nextSibling;if(how!=DELETE){frag=createDocumentFragment()}n=_traverseLeftBoundary(startAncestor,how);if(frag){frag.appendChild(n)}startOffset=nodeIndex(startAncestor);endOffset=nodeIndex(endAncestor);++startOffset;cnt=endOffset-startOffset;sibling=startAncestor.nextSibling;while(cnt>0){nextSibling=sibling.nextSibling;n=_traverseFullySelected(sibling,how);if(frag){frag.appendChild(n)}sibling=nextSibling;--cnt}n=_traverseRightBoundary(endAncestor,how);if(frag){frag.appendChild(n)}if(how!=CLONE){self.setStartAfter(startAncestor);self.collapse(TRUE)}return frag}function _traverseRightBoundary(root,how){var next=_getSelectedNode(self[END_CONTAINER],self[END_OFFSET]-1),parent,clonedParent;var prevSibling,clonedChild,clonedGrandParent,isFullySelected=next!=self[END_CONTAINER];if(next==root){return _traverseNode(next,isFullySelected,FALSE,how)}parent=next.parentNode;clonedParent=_traverseNode(parent,FALSE,FALSE,how);while(parent){while(next){prevSibling=next.previousSibling;clonedChild=_traverseNode(next,isFullySelected,FALSE,how);if(how!=DELETE){clonedParent.insertBefore(clonedChild,clonedParent.firstChild)}isFullySelected=TRUE;next=prevSibling}if(parent==root){return clonedParent}next=parent.previousSibling;parent=parent.parentNode;clonedGrandParent=_traverseNode(parent,FALSE,FALSE,how);if(how!=DELETE){clonedGrandParent.appendChild(clonedParent)}clonedParent=clonedGrandParent}}function _traverseLeftBoundary(root,how){var next=_getSelectedNode(self[START_CONTAINER],self[START_OFFSET]),isFullySelected=next!=self[START_CONTAINER];var parent,clonedParent,nextSibling,clonedChild,clonedGrandParent;if(next==root){return _traverseNode(next,isFullySelected,TRUE,how)}parent=next.parentNode;clonedParent=_traverseNode(parent,FALSE,TRUE,how);while(parent){while(next){nextSibling=next.nextSibling;clonedChild=_traverseNode(next,isFullySelected,TRUE,how);if(how!=DELETE){clonedParent.appendChild(clonedChild)}isFullySelected=TRUE;next=nextSibling}if(parent==root){return clonedParent}next=parent.nextSibling;parent=parent.parentNode;clonedGrandParent=_traverseNode(parent,FALSE,TRUE,how);if(how!=DELETE){clonedGrandParent.appendChild(clonedParent)}clonedParent=clonedGrandParent}}function _traverseNode(n,isFullySelected,isLeft,how){var txtValue,newNodeValue,oldNodeValue,offset,newNode;if(isFullySelected){return _traverseFullySelected(n,how)}if(n.nodeType==3){txtValue=n.nodeValue;if(isLeft){offset=self[START_OFFSET];newNodeValue=txtValue.substring(offset);oldNodeValue=txtValue.substring(0,offset)}else{offset=self[END_OFFSET];newNodeValue=txtValue.substring(0,offset);oldNodeValue=txtValue.substring(offset)}if(how!=CLONE){n.nodeValue=oldNodeValue}if(how==DELETE){return}newNode=dom.clone(n,FALSE);newNode.nodeValue=newNodeValue;return newNode}if(how==DELETE){return}return dom.clone(n,FALSE)}function _traverseFullySelected(n,how){if(how!=DELETE){return how==CLONE?dom.clone(n,TRUE):n}n.parentNode.removeChild(n)}function toStringIE(){return dom.create("body",null,cloneContents()).outerText}extend(self,{startContainer:doc,startOffset:0,endContainer:doc,endOffset:0,collapsed:TRUE,commonAncestorContainer:doc,START_TO_START:0,START_TO_END:1,END_TO_END:2,END_TO_START:3,setStart:setStart,setEnd:setEnd,setStartBefore:setStartBefore,setStartAfter:setStartAfter,setEndBefore:setEndBefore,setEndAfter:setEndAfter,collapse:collapse,selectNode:selectNode,selectNodeContents:selectNodeContents,compareBoundaryPoints:compareBoundaryPoints,deleteContents:deleteContents,extractContents:extractContents,cloneContents:cloneContents,insertNode:insertNode,surroundContents:surroundContents,cloneRange:cloneRange,toStringIE:toStringIE});return self}Range.prototype.toString=function(){return this.toStringIE()};return Range});define("tinymce/html/Entities",["tinymce/util/Tools"],function(Tools){var makeMap=Tools.makeMap;var namedEntities,baseEntities,reverseEntities,attrsCharsRegExp=/[&<>\"\u0060\u007E-\uD7FF\uE000-\uFFEF]|[\uD800-\uDBFF][\uDC00-\uDFFF]/g,textCharsRegExp=/[<>&\u007E-\uD7FF\uE000-\uFFEF]|[\uD800-\uDBFF][\uDC00-\uDFFF]/g,rawCharsRegExp=/[<>&\"\']/g,entityRegExp=/&#([a-z0-9]+);?|&([a-z0-9]+);/gi,asciiMap={128:"",130:"",131:"",132:"",133:"",134:"",135:"",136:"",137:"",138:"",139:"",140:"",142:"",145:"",146:"",147:"",148:"",149:"",150:"",151:"",152:"",153:"",154:"",155:"",156:"",158:"",159:""};baseEntities={'"':"&quot;","'":"&#39;","<":"&lt;",">":"&gt;","&":"&amp;","`":"&#96;"};reverseEntities={"&lt;":"<","&gt;":">","&amp;":"&","&quot;":'"',"&apos;":"'"};function nativeDecode(text){var elm;elm=document.createElement("div");elm.innerHTML=text;return elm.textContent||elm.innerText||text}function buildEntitiesLookup(items,radix){var i,chr,entity,lookup={};if(items){items=items.split(",");radix=radix||10;for(i=0;i<items.length;i+=2){chr=String.fromCharCode(parseInt(items[i],radix));if(!baseEntities[chr]){entity="&"+items[i+1]+";";lookup[chr]=entity;lookup[entity]=chr}}return lookup}}namedEntities=buildEntitiesLookup("50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,"+"5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,"+"5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,"+"5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,"+"68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,"+"6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,"+"6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,"+"75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,"+"7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,"+"7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,"+"sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,"+"st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,"+"t9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,"+"tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,"+"u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,"+"81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,"+"8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,"+"8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,"+"8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,"+"8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,"+"nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,"+"rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,"+"Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,"+"80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,"+"811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro",32);var Entities={encodeRaw:function(text,attr){return text.replace(attr?attrsCharsRegExp:textCharsRegExp,function(chr){return baseEntities[chr]||chr})},encodeAllRaw:function(text){return(""+text).replace(rawCharsRegExp,function(chr){return baseEntities[chr]||chr})},encodeNumeric:function(text,attr){return text.replace(attr?attrsCharsRegExp:textCharsRegExp,function(chr){if(chr.length>1){return"&#"+((chr.charCodeAt(0)-55296)*1024+(chr.charCodeAt(1)-56320)+65536)+";"}return baseEntities[chr]||"&#"+chr.charCodeAt(0)+";"})},encodeNamed:function(text,attr,entities){entities=entities||namedEntities;return text.replace(attr?attrsCharsRegExp:textCharsRegExp,function(chr){return baseEntities[chr]||entities[chr]||chr})},getEncodeFunc:function(name,entities){entities=buildEntitiesLookup(entities)||namedEntities;function encodeNamedAndNumeric(text,attr){return text.replace(attr?attrsCharsRegExp:textCharsRegExp,function(chr){return baseEntities[chr]||entities[chr]||"&#"+chr.charCodeAt(0)+";"||chr})}function encodeCustomNamed(text,attr){return Entities.encodeNamed(text,attr,entities)}name=makeMap(name.replace(/\+/g,","));if(name.named&&name.numeric){return encodeNamedAndNumeric}if(name.named){if(entities){return encodeCustomNamed}return Entities.encodeNamed}if(name.numeric){return Entities.encodeNumeric}return Entities.encodeRaw},decode:function(text){return text.replace(entityRegExp,function(all,numeric){if(numeric){if(numeric.charAt(0).toLowerCase()==="x"){numeric=parseInt(numeric.substr(1),16)}else{numeric=parseInt(numeric,10)}if(numeric>65535){numeric-=65536;return String.fromCharCode(55296+(numeric>>10),56320+(numeric&1023))}return asciiMap[numeric]||String.fromCharCode(numeric)}return reverseEntities[all]||namedEntities[all]||nativeDecode(all)})}};return Entities});define("tinymce/dom/StyleSheetLoader",["tinymce/util/Tools","tinymce/util/Delay"],function(Tools,Delay){"use strict";return function(document,settings){var idCount=0,loadedStates={},maxLoadTime;settings=settings||{};maxLoadTime=settings.maxLoadTime||5e3;function appendToHead(node){document.getElementsByTagName("head")[0].appendChild(node)}function load(url,loadedCallback,errorCallback){var link,style,startTime,state;function passed(){var callbacks=state.passed,i=callbacks.length;while(i--){callbacks[i]()}state.status=2;state.passed=[];state.failed=[]}function failed(){var callbacks=state.failed,i=callbacks.length;while(i--){callbacks[i]()}state.status=3;state.passed=[];state.failed=[]}function isOldWebKit(){var webKitChunks=navigator.userAgent.match(/WebKit\/(\d*)/);return!!(webKitChunks&&webKitChunks[1]<536)}function wait(testCallback,waitCallback){if(!testCallback()){if((new Date).getTime()-startTime<maxLoadTime){Delay.setTimeout(waitCallback)}else{failed()}}}function waitForWebKitLinkLoaded(){wait(function(){var styleSheets=document.styleSheets,styleSheet,i=styleSheets.length,owner;while(i--){styleSheet=styleSheets[i];owner=styleSheet.ownerNode?styleSheet.ownerNode:styleSheet.owningElement;if(owner&&owner.id===link.id){passed();return true}}},waitForWebKitLinkLoaded)}function waitForGeckoLinkLoaded(){wait(function(){try{var cssRules=style.sheet.cssRules;passed();return!!cssRules}catch(ex){}},waitForGeckoLinkLoaded)}url=Tools._addCacheSuffix(url);if(!loadedStates[url]){state={passed:[],failed:[]};loadedStates[url]=state}else{state=loadedStates[url]}if(loadedCallback){state.passed.push(loadedCallback)}if(errorCallback){state.failed.push(errorCallback)}if(state.status==1){return}if(state.status==2){passed();return}if(state.status==3){failed();return}state.status=1;link=document.createElement("link");link.rel="stylesheet";link.type="text/css";link.id="u"+idCount++;link.async=false;link.defer=false;startTime=(new Date).getTime();if("onload"in link&&!isOldWebKit()){link.onload=waitForWebKitLinkLoaded;link.onerror=failed}else{if(navigator.userAgent.indexOf("Firefox")>0){style=document.createElement("style");style.textContent='@import "'+url+'"';waitForGeckoLinkLoaded();appendToHead(style);return}waitForWebKitLinkLoaded()}appendToHead(link);link.href=url}this.load=load}});define("tinymce/dom/DOMUtils",["tinymce/dom/Sizzle","tinymce/dom/DomQuery","tinymce/html/Styles","tinymce/dom/EventUtils","tinymce/dom/TreeWalker","tinymce/dom/Range","tinymce/html/Entities","tinymce/Env","tinymce/util/Tools","tinymce/dom/StyleSheetLoader"],function(Sizzle,$,Styles,EventUtils,TreeWalker,Range,Entities,Env,Tools,StyleSheetLoader){var each=Tools.each,is=Tools.is,grep=Tools.grep,trim=Tools.trim;var isIE=Env.ie;var simpleSelectorRe=/^([a-z0-9],?)+$/i;var whiteSpaceRegExp=/^[ \t\r\n]*$/;function setupAttrHooks(domUtils,settings){var attrHooks={},keepValues=settings.keep_values,keepUrlHook;keepUrlHook={set:function($elm,value,name){if(settings.url_converter){value=settings.url_converter.call(settings.url_converter_scope||domUtils,value,name,$elm[0])}$elm.attr("data-mce-"+name,value).attr(name,value)},get:function($elm,name){return $elm.attr("data-mce-"+name)||$elm.attr(name)}};attrHooks={style:{set:function($elm,value){if(value!==null&&typeof value==="object"){$elm.css(value);return}if(keepValues){$elm.attr("data-mce-style",value)}$elm.attr("style",value)},get:function($elm){var value=$elm.attr("data-mce-style")||$elm.attr("style");value=domUtils.serializeStyle(domUtils.parseStyle(value),$elm[0].nodeName);return value}}};if(keepValues){attrHooks.href=attrHooks.src=keepUrlHook}return attrHooks}function updateInternalStyleAttr(domUtils,$elm){var value=$elm.attr("style");value=domUtils.serializeStyle(domUtils.parseStyle(value),$elm[0].nodeName);if(!value){value=null}$elm.attr("data-mce-style",value)}function nodeIndex(node,normalized){var idx=0,lastNodeType,nodeType;if(node){for(lastNodeType=node.nodeType,node=node.previousSibling;node;node=node.previousSibling){nodeType=node.nodeType;if(normalized&&nodeType==3){if(nodeType==lastNodeType||!node.nodeValue.length){continue}}idx++;lastNodeType=nodeType}}return idx}function DOMUtils(doc,settings){var self=this,blockElementsMap;self.doc=doc;self.win=window;self.files={};self.counter=0;self.stdMode=!isIE||doc.documentMode>=8;self.boxModel=!isIE||doc.compatMode=="CSS1Compat"||self.stdMode;
self.styleSheetLoader=new StyleSheetLoader(doc);self.boundEvents=[];self.settings=settings=settings||{};self.schema=settings.schema;self.styles=new Styles({url_converter:settings.url_converter,url_converter_scope:settings.url_converter_scope},settings.schema);self.fixDoc(doc);self.events=settings.ownEvents?new EventUtils(settings.proxy):EventUtils.Event;self.attrHooks=setupAttrHooks(self,settings);blockElementsMap=settings.schema?settings.schema.getBlockElements():{};self.$=$.overrideDefaults(function(){return{context:doc,element:self.getRoot()}});self.isBlock=function(node){if(!node){return false}var type=node.nodeType;if(type){return!!(type===1&&blockElementsMap[node.nodeName])}return!!blockElementsMap[node]}}DOMUtils.prototype={$$:function(elm){if(typeof elm=="string"){elm=this.get(elm)}return this.$(elm)},root:null,fixDoc:function(doc){var settings=this.settings,name;if(isIE&&settings.schema){("abbr article aside audio canvas "+"details figcaption figure footer "+"header hgroup mark menu meter nav "+"output progress section summary "+"time video").replace(/\w+/g,function(name){doc.createElement(name)});for(name in settings.schema.getCustomElements()){doc.createElement(name)}}},clone:function(node,deep){var self=this,clone,doc;if(!isIE||node.nodeType!==1||deep){return node.cloneNode(deep)}doc=self.doc;if(!deep){clone=doc.createElement(node.nodeName);each(self.getAttribs(node),function(attr){self.setAttrib(clone,attr.nodeName,self.getAttrib(node,attr.nodeName))});return clone}return clone.firstChild},getRoot:function(){var self=this;return self.settings.root_element||self.doc.body},getViewPort:function(win){var doc,rootElm;win=!win?this.win:win;doc=win.document;rootElm=this.boxModel?doc.documentElement:doc.body;return{x:win.pageXOffset||rootElm.scrollLeft,y:win.pageYOffset||rootElm.scrollTop,w:win.innerWidth||rootElm.clientWidth,h:win.innerHeight||rootElm.clientHeight}},getRect:function(elm){var self=this,pos,size;elm=self.get(elm);pos=self.getPos(elm);size=self.getSize(elm);return{x:pos.x,y:pos.y,w:size.w,h:size.h}},getSize:function(elm){var self=this,w,h;elm=self.get(elm);w=self.getStyle(elm,"width");h=self.getStyle(elm,"height");if(w.indexOf("px")===-1){w=0}if(h.indexOf("px")===-1){h=0}return{w:parseInt(w,10)||elm.offsetWidth||elm.clientWidth,h:parseInt(h,10)||elm.offsetHeight||elm.clientHeight}},getParent:function(node,selector,root){return this.getParents(node,selector,root,false)},getParents:function(node,selector,root,collect){var self=this,selectorVal,result=[];node=self.get(node);collect=collect===undefined;root=root||(self.getRoot().nodeName!="BODY"?self.getRoot().parentNode:null);if(is(selector,"string")){selectorVal=selector;if(selector==="*"){selector=function(node){return node.nodeType==1}}else{selector=function(node){return self.is(node,selectorVal)}}}while(node){if(node==root||!node.nodeType||node.nodeType===9){break}if(!selector||selector(node)){if(collect){result.push(node)}else{return node}}node=node.parentNode}return collect?result:null},get:function(elm){var name;if(elm&&this.doc&&typeof elm=="string"){name=elm;elm=this.doc.getElementById(elm);if(elm&&elm.id!==name){return this.doc.getElementsByName(name)[1]}}return elm},getNext:function(node,selector){return this._findSib(node,selector,"nextSibling")},getPrev:function(node,selector){return this._findSib(node,selector,"previousSibling")},select:function(selector,scope){var self=this;return Sizzle(selector,self.get(scope)||self.settings.root_element||self.doc,[])},is:function(elm,selector){var i;if(elm.length===undefined){if(selector==="*"){return elm.nodeType==1}if(simpleSelectorRe.test(selector)){selector=selector.toLowerCase().split(/,/);elm=elm.nodeName.toLowerCase();for(i=selector.length-1;i>=0;i--){if(selector[i]==elm){return true}}return false}}if(elm.nodeType&&elm.nodeType!=1){return false}var elms=elm.nodeType?[elm]:elm;return Sizzle(selector,elms[0].ownerDocument||elms[0],null,elms).length>0},add:function(parentElm,name,attrs,html,create){var self=this;return this.run(parentElm,function(parentElm){var newElm;newElm=is(name,"string")?self.doc.createElement(name):name;self.setAttribs(newElm,attrs);if(html){if(html.nodeType){newElm.appendChild(html)}else{self.setHTML(newElm,html)}}return!create?parentElm.appendChild(newElm):newElm})},create:function(name,attrs,html){return this.add(this.doc.createElement(name),name,attrs,html,1)},createHTML:function(name,attrs,html){var outHtml="",key;outHtml+="<"+name;for(key in attrs){if(attrs.hasOwnProperty(key)&&attrs[key]!==null&&typeof attrs[key]!="undefined"){outHtml+=" "+key+'="'+this.encode(attrs[key])+'"'}}if(typeof html!="undefined"){return outHtml+">"+html+"</"+name+">"}return outHtml+" />"},createFragment:function(html){var frag,node,doc=this.doc,container;container=doc.createElement("div");frag=doc.createDocumentFragment();if(html){container.innerHTML=html}while(node=container.firstChild){frag.appendChild(node)}return frag},remove:function(node,keepChildren){node=this.$$(node);if(keepChildren){node.each(function(){var child;while(child=this.firstChild){if(child.nodeType==3&&child.data.length===0){this.removeChild(child)}else{this.parentNode.insertBefore(child,this)}}}).remove()}else{node.remove()}return node.length>1?node.toArray():node[0]},setStyle:function(elm,name,value){elm=this.$$(elm).css(name,value);if(this.settings.update_styles){updateInternalStyleAttr(this,elm)}},getStyle:function(elm,name,computed){elm=this.$$(elm);if(computed){return elm.css(name)}name=name.replace(/-(\D)/g,function(a,b){return b.toUpperCase()});if(name=="float"){name=Env.ie&&Env.ie<12?"styleFloat":"cssFloat"}return elm[0]&&elm[0].style?elm[0].style[name]:undefined},setStyles:function(elm,styles){elm=this.$$(elm).css(styles);if(this.settings.update_styles){updateInternalStyleAttr(this,elm)}},removeAllAttribs:function(e){return this.run(e,function(e){var i,attrs=e.attributes;for(i=attrs.length-1;i>=0;i--){e.removeAttributeNode(attrs.item(i))}})},setAttrib:function(elm,name,value){var self=this,originalValue,hook,settings=self.settings;if(value===""){value=null}elm=self.$$(elm);originalValue=elm.attr(name);if(!elm.length){return}hook=self.attrHooks[name];if(hook&&hook.set){hook.set(elm,value,name)}else{elm.attr(name,value)}if(originalValue!=value&&settings.onSetAttrib){settings.onSetAttrib({attrElm:elm,attrName:name,attrValue:value})}},setAttribs:function(elm,attrs){var self=this;self.$$(elm).each(function(i,node){each(attrs,function(value,name){self.setAttrib(node,name,value)})})},getAttrib:function(elm,name,defaultVal){var self=this,hook,value;elm=self.$$(elm);if(elm.length){hook=self.attrHooks[name];if(hook&&hook.get){value=hook.get(elm,name)}else{value=elm.attr(name)}}if(typeof value=="undefined"){value=defaultVal||""}return value},getPos:function(elm,rootElm){var self=this,x=0,y=0,offsetParent,doc=self.doc,body=doc.body,pos;elm=self.get(elm);rootElm=rootElm||body;if(elm){if(rootElm===body&&elm.getBoundingClientRect&&$(body).css("position")==="static"){pos=elm.getBoundingClientRect();rootElm=self.boxModel?doc.documentElement:body;x=pos.left+(doc.documentElement.scrollLeft||body.scrollLeft)-rootElm.clientLeft;y=pos.top+(doc.documentElement.scrollTop||body.scrollTop)-rootElm.clientTop;return{x:x,y:y}}offsetParent=elm;while(offsetParent&&offsetParent!=rootElm&&offsetParent.nodeType){x+=offsetParent.offsetLeft||0;y+=offsetParent.offsetTop||0;offsetParent=offsetParent.offsetParent}offsetParent=elm.parentNode;while(offsetParent&&offsetParent!=rootElm&&offsetParent.nodeType){x-=offsetParent.scrollLeft||0;y-=offsetParent.scrollTop||0;offsetParent=offsetParent.parentNode}}return{x:x,y:y}},parseStyle:function(cssText){return this.styles.parse(cssText)},serializeStyle:function(styles,name){return this.styles.serialize(styles,name)},addStyle:function(cssText){var self=this,doc=self.doc,head,styleElm;if(self!==DOMUtils.DOM&&doc===document){var addedStyles=DOMUtils.DOM.addedStyles;addedStyles=addedStyles||[];if(addedStyles[cssText]){return}addedStyles[cssText]=true;DOMUtils.DOM.addedStyles=addedStyles}styleElm=doc.getElementById("mceDefaultStyles");if(!styleElm){styleElm=doc.createElement("style");styleElm.id="mceDefaultStyles";styleElm.type="text/css";head=doc.getElementsByTagName("head")[0];if(head.firstChild){head.insertBefore(styleElm,head.firstChild)}else{head.appendChild(styleElm)}}if(styleElm.styleSheet){styleElm.styleSheet.cssText+=cssText}else{styleElm.appendChild(doc.createTextNode(cssText))}},loadCSS:function(url){var self=this,doc=self.doc,head;if(self!==DOMUtils.DOM&&doc===document){DOMUtils.DOM.loadCSS(url);return}if(!url){url=""}head=doc.getElementsByTagName("head")[0];each(url.split(","),function(url){var link;url=Tools._addCacheSuffix(url);if(self.files[url]){return}self.files[url]=true;link=self.create("link",{rel:"stylesheet",href:url});if(isIE&&doc.documentMode&&doc.recalc){link.onload=function(){if(doc.recalc){doc.recalc()}link.onload=null}}head.appendChild(link)})},addClass:function(elm,cls){this.$$(elm).addClass(cls)},removeClass:function(elm,cls){this.toggleClass(elm,cls,false)},hasClass:function(elm,cls){return this.$$(elm).hasClass(cls)},toggleClass:function(elm,cls,state){this.$$(elm).toggleClass(cls,state).each(function(){if(this.className===""){$(this).attr("class",null)}})},show:function(elm){this.$$(elm).show()},hide:function(elm){this.$$(elm).hide()},isHidden:function(elm){return this.$$(elm).css("display")=="none"},uniqueId:function(prefix){return(!prefix?"mce_":prefix)+this.counter++},setHTML:function(elm,html){elm=this.$$(elm);if(isIE){elm.each(function(i,target){if(target.canHaveHTML===false){return}while(target.firstChild){target.removeChild(target.firstChild)}try{target.innerHTML="<br>"+html;target.removeChild(target.firstChild)}catch(ex){$("<div>").html("<br>"+html).contents().slice(1).appendTo(target)}return html})}else{elm.html(html)}},getOuterHTML:function(elm){elm=this.get(elm);return elm.nodeType==1&&"outerHTML"in elm?elm.outerHTML:$("<div>").append($(elm).clone()).html()},setOuterHTML:function(elm,html){var self=this;self.$$(elm).each(function(){try{if("outerHTML"in this){this.outerHTML=html;return}}catch(ex){}self.remove($(this).html(html),true)})},decode:Entities.decode,encode:Entities.encodeAllRaw,insertAfter:function(node,referenceNode){referenceNode=this.get(referenceNode);return this.run(node,function(node){var parent,nextSibling;parent=referenceNode.parentNode;nextSibling=referenceNode.nextSibling;if(nextSibling){parent.insertBefore(node,nextSibling)}else{parent.appendChild(node)}return node})},replace:function(newElm,oldElm,keepChildren){var self=this;return self.run(oldElm,function(oldElm){if(is(oldElm,"array")){newElm=newElm.cloneNode(true)}if(keepChildren){each(grep(oldElm.childNodes),function(node){newElm.appendChild(node)})}return oldElm.parentNode.replaceChild(newElm,oldElm)})},rename:function(elm,name){var self=this,newElm;if(elm.nodeName!=name.toUpperCase()){newElm=self.create(name);each(self.getAttribs(elm),function(attrNode){self.setAttrib(newElm,attrNode.nodeName,self.getAttrib(elm,attrNode.nodeName))});self.replace(newElm,elm,1)}return newElm||elm},findCommonAncestor:function(a,b){var ps=a,pe;while(ps){pe=b;while(pe&&ps!=pe){pe=pe.parentNode}if(ps==pe){break}ps=ps.parentNode}if(!ps&&a.ownerDocument){return a.ownerDocument.documentElement}return ps},toHex:function(rgbVal){return this.styles.toHex(Tools.trim(rgbVal))},run:function(elm,func,scope){var self=this,result;if(typeof elm==="string"){elm=self.get(elm)}if(!elm){return false}scope=scope||this;if(!elm.nodeType&&(elm.length||elm.length===0)){result=[];each(elm,function(elm,i){if(elm){if(typeof elm=="string"){elm=self.get(elm)}result.push(func.call(scope,elm,i))}});return result}return func.call(scope,elm)},getAttribs:function(elm){var attrs;elm=this.get(elm);if(!elm){return[]}if(isIE){attrs=[];if(elm.nodeName=="OBJECT"){return elm.attributes}if(elm.nodeName==="OPTION"&&this.getAttrib(elm,"selected")){attrs.push({specified:1,nodeName:"selected"})}var attrRegExp=/<\/?[\w:\-]+ ?|=[\"][^\"]+\"|=\'[^\']+\'|=[\w\-]+|>/gi;elm.cloneNode(false).outerHTML.replace(attrRegExp,"").replace(/[\w:\-]+/gi,function(a){attrs.push({specified:1,nodeName:a})});return attrs}return elm.attributes},isEmpty:function(node,elements){var self=this,i,attributes,type,walker,name,brCount=0;node=node.firstChild;if(node){walker=new TreeWalker(node,node.parentNode);elements=elements||(self.schema?self.schema.getNonEmptyElements():null);do{type=node.nodeType;if(type===1){if(node.getAttribute("data-mce-bogus")){continue}name=node.nodeName.toLowerCase();if(elements&&elements[name]){if(name==="br"){brCount++;continue}return false}attributes=self.getAttribs(node);i=attributes.length;while(i--){name=attributes[i].nodeName;if(name==="name"||name==="data-mce-bookmark"){return false}}}if(type==8){return false}if(type===3&&!whiteSpaceRegExp.test(node.nodeValue)){return false}}while(node=walker.next())}return brCount<=1},createRng:function(){var doc=this.doc;return doc.createRange?doc.createRange():new Range(this)},nodeIndex:nodeIndex,split:function(parentElm,splitElm,replacementElm){var self=this,r=self.createRng(),bef,aft,pa;function trimNode(node){var i,children=node.childNodes,type=node.nodeType;function surroundedBySpans(node){var previousIsSpan=node.previousSibling&&node.previousSibling.nodeName=="SPAN";var nextIsSpan=node.nextSibling&&node.nextSibling.nodeName=="SPAN";return previousIsSpan&&nextIsSpan}if(type==1&&node.getAttribute("data-mce-type")=="bookmark"){return}for(i=children.length-1;i>=0;i--){trimNode(children[i])}if(type!=9){if(type==3&&node.nodeValue.length>0){var trimmedLength=trim(node.nodeValue).length;if(!self.isBlock(node.parentNode)||trimmedLength>0||trimmedLength===0&&surroundedBySpans(node)){return}}else if(type==1){children=node.childNodes;if(children.length==1&&children[0]&&children[0].nodeType==1&&children[0].getAttribute("data-mce-type")=="bookmark"){node.parentNode.insertBefore(children[0],node)}if(children.length||/^(br|hr|input|img)$/i.test(node.nodeName)){return}}self.remove(node)}return node}if(parentElm&&splitElm){r.setStart(parentElm.parentNode,self.nodeIndex(parentElm));r.setEnd(splitElm.parentNode,self.nodeIndex(splitElm));bef=r.extractContents();r=self.createRng();r.setStart(splitElm.parentNode,self.nodeIndex(splitElm)+1);r.setEnd(parentElm.parentNode,self.nodeIndex(parentElm)+1);aft=r.extractContents();pa=parentElm.parentNode;pa.insertBefore(trimNode(bef),parentElm);if(replacementElm){pa.insertBefore(replacementElm,parentElm)}else{pa.insertBefore(splitElm,parentElm)}pa.insertBefore(trimNode(aft),parentElm);self.remove(parentElm);return replacementElm||splitElm}},bind:function(target,name,func,scope){var self=this;if(Tools.isArray(target)){var i=target.length;while(i--){target[i]=self.bind(target[i],name,func,scope)}return target}if(self.settings.collect&&(target===self.doc||target===self.win)){self.boundEvents.push([target,name,func,scope])}return self.events.bind(target,name,func,scope||self)},unbind:function(target,name,func){var self=this,i;if(Tools.isArray(target)){i=target.length;while(i--){target[i]=self.unbind(target[i],name,func)}return target}if(self.boundEvents&&(target===self.doc||target===self.win)){i=self.boundEvents.length;while(i--){var item=self.boundEvents[i];if(target==item[0]&&(!name||name==item[1])&&(!func||func==item[2])){this.events.unbind(item[0],item[1],item[2])}}}return this.events.unbind(target,name,func)},fire:function(target,name,evt){return this.events.fire(target,name,evt)},getContentEditable:function(node){var contentEditable;if(!node||node.nodeType!=1){return null}contentEditable=node.getAttribute("data-mce-contenteditable");if(contentEditable&&contentEditable!=="inherit"){return contentEditable}return node.contentEditable!=="inherit"?node.contentEditable:null},getContentEditableParent:function(node){var root=this.getRoot(),state=null;for(;node&&node!==root;node=node.parentNode){state=this.getContentEditable(node);if(state!==null){break}}return state},destroy:function(){var self=this;if(self.boundEvents){var i=self.boundEvents.length;while(i--){var item=self.boundEvents[i];this.events.unbind(item[0],item[1],item[2])}self.boundEvents=null}if(Sizzle.setDocument){Sizzle.setDocument()}self.win=self.doc=self.root=self.events=self.frag=null},isChildOf:function(node,parent){while(node){if(parent===node){return true}node=node.parentNode}return false},dumpRng:function(r){return"startContainer: "+r.startContainer.nodeName+", startOffset: "+r.startOffset+", endContainer: "+r.endContainer.nodeName+", endOffset: "+r.endOffset},_findSib:function(node,selector,name){var self=this,func=selector;if(node){if(typeof func=="string"){func=function(node){return self.is(node,selector)}}for(node=node[name];node;node=node[name]){if(func(node)){return node}}}return null}};DOMUtils.DOM=new DOMUtils(document);DOMUtils.nodeIndex=nodeIndex;return DOMUtils});define("tinymce/dom/ScriptLoader",["tinymce/dom/DOMUtils","tinymce/util/Tools"],function(DOMUtils,Tools){var DOM=DOMUtils.DOM;var each=Tools.each,grep=Tools.grep;function ScriptLoader(){var QUEUED=0,LOADING=1,LOADED=2,states={},queue=[],scriptLoadedCallbacks={},queueLoadedCallbacks=[],loading=0,undef;function loadScript(url,callback){var dom=DOM,elm,id;function done(){dom.remove(id);if(elm){elm.onreadystatechange=elm.onload=elm=null}callback()}function error(){if(typeof console!=="undefined"&&console.log){console.log("Failed to load: "+url)}}id=dom.uniqueId();elm=document.createElement("script");elm.id=id;elm.type="text/javascript";elm.src=Tools._addCacheSuffix(url);if("onreadystatechange"in elm){elm.onreadystatechange=function(){if(/loaded|complete/.test(elm.readyState)){done()}}}else{elm.onload=done}elm.onerror=error;(document.getElementsByTagName("head")[0]||document.body).appendChild(elm)}this.isDone=function(url){return states[url]==LOADED};this.markDone=function(url){states[url]=LOADED};this.add=this.load=function(url,callback,scope){var state=states[url];if(state==undef){queue.push(url);states[url]=QUEUED}if(callback){if(!scriptLoadedCallbacks[url]){scriptLoadedCallbacks[url]=[]}scriptLoadedCallbacks[url].push({func:callback,scope:scope||this})}};this.loadQueue=function(callback,scope){this.loadScripts(queue,callback,scope)};this.loadScripts=function(scripts,callback,scope){var loadScripts;function execScriptLoadedCallbacks(url){each(scriptLoadedCallbacks[url],function(callback){callback.func.call(callback.scope)});scriptLoadedCallbacks[url]=undef}queueLoadedCallbacks.push({func:callback,scope:scope||this});loadScripts=function(){var loadingScripts=grep(scripts);scripts.length=0;each(loadingScripts,function(url){if(states[url]==LOADED){execScriptLoadedCallbacks(url);return}if(states[url]!=LOADING){states[url]=LOADING;loading++;loadScript(url,function(){states[url]=LOADED;loading--;execScriptLoadedCallbacks(url);loadScripts()})}});if(!loading){each(queueLoadedCallbacks,function(callback){callback.func.call(callback.scope)});queueLoadedCallbacks.length=0}};loadScripts()}}ScriptLoader.ScriptLoader=new ScriptLoader;return ScriptLoader});define("tinymce/AddOnManager",["tinymce/dom/ScriptLoader","tinymce/util/Tools"],function(ScriptLoader,Tools){var each=Tools.each;function AddOnManager(){var self=this;self.items=[];self.urls={};self.lookup={}}AddOnManager.prototype={get:function(name){if(this.lookup[name]){return this.lookup[name].instance}return undefined},dependencies:function(name){var result;if(this.lookup[name]){result=this.lookup[name].dependencies}return result||[]},requireLangPack:function(name,languages){var language=AddOnManager.language;if(language&&AddOnManager.languageLoad!==false){if(languages){languages=","+languages+",";if(languages.indexOf(","+language.substr(0,2)+",")!=-1){language=language.substr(0,2)}else if(languages.indexOf(","+language+",")==-1){return}}ScriptLoader.ScriptLoader.add(this.urls[name]+"/langs/"+language+".js")}},add:function(id,addOn,dependencies){this.items.push(addOn);this.lookup[id]={instance:addOn,dependencies:dependencies};return addOn},createUrl:function(baseUrl,dep){if(typeof dep==="object"){return dep}return{prefix:baseUrl.prefix,resource:dep,suffix:baseUrl.suffix}},addComponents:function(pluginName,scripts){var pluginUrl=this.urls[pluginName];each(scripts,function(script){ScriptLoader.ScriptLoader.add(pluginUrl+"/"+script)})},load:function(name,addOnUrl,callback,scope){var self=this,url=addOnUrl;function loadDependencies(){var dependencies=self.dependencies(name);each(dependencies,function(dep){var newUrl=self.createUrl(addOnUrl,dep);self.load(newUrl.resource,newUrl,undefined,undefined)});if(callback){if(scope){callback.call(scope)}else{callback.call(ScriptLoader)}}}if(self.urls[name]){return}if(typeof addOnUrl==="object"){url=addOnUrl.prefix+addOnUrl.resource+addOnUrl.suffix}if(url.indexOf("/")!==0&&url.indexOf("://")==-1){url=AddOnManager.baseURL+"/"+url}self.urls[name]=url.substring(0,url.lastIndexOf("/"));if(self.lookup[name]){loadDependencies()}else{ScriptLoader.ScriptLoader.add(url,loadDependencies,scope)}}};AddOnManager.PluginManager=new AddOnManager;AddOnManager.ThemeManager=new AddOnManager;return AddOnManager});define("tinymce/dom/NodeType",[],function(){function isNodeType(type){return function(node){return!!node&&node.nodeType==type}}var isElement=isNodeType(1);function matchNodeNames(names){names=names.toLowerCase().split(" ");return function(node){var i,name;if(node&&node.nodeType){name=node.nodeName.toLowerCase();for(i=0;i<names.length;i++){if(name===names[i]){return true}}}return false}}function matchStyleValues(name,values){values=values.toLowerCase().split(" ");return function(node){var i,cssValue;if(isElement(node)){for(i=0;i<values.length;i++){cssValue=getComputedStyle(node,null).getPropertyValue(name);if(cssValue===values[i]){return true}}}return false}}function hasPropValue(propName,propValue){return function(node){return isElement(node)&&node[propName]===propValue}}function hasAttributeValue(attrName,attrValue){return function(node){return isElement(node)&&node.getAttribute(attrName)===attrValue}}function isBogus(node){return isElement(node)&&node.hasAttribute("data-mce-bogus")}function hasContentEditableState(value){return function(node){if(isElement(node)){if(node.contentEditable===value){return true}if(node.getAttribute("data-mce-contenteditable")===value){return true}}return false}}return{isText:isNodeType(3),isElement:isElement,isComment:isNodeType(8),isBr:matchNodeNames("br"),isContentEditableTrue:hasContentEditableState("true"),isContentEditableFalse:hasContentEditableState("false"),matchNodeNames:matchNodeNames,hasPropValue:hasPropValue,hasAttributeValue:hasAttributeValue,matchStyleValues:matchStyleValues,isBogus:isBogus}});define("tinymce/text/Zwsp",[],function(){var ZWSP="";function isZwsp(chr){return chr==ZWSP}function trim(str){return str.replace(new RegExp(ZWSP,"g"),"")}return{isZwsp:isZwsp,ZWSP:ZWSP,trim:trim}});define("tinymce/caret/CaretContainer",["tinymce/dom/NodeType","tinymce/text/Zwsp"],function(NodeType,Zwsp){var isElement=NodeType.isElement,isText=NodeType.isText;function isCaretContainerBlock(node){if(isText(node)){node=node.parentNode}return isElement(node)&&node.hasAttribute("data-mce-caret")}function isCaretContainerInline(node){return isText(node)&&Zwsp.isZwsp(node.data)}function isCaretContainer(node){return isCaretContainerBlock(node)||isCaretContainerInline(node)}function insertInline(node,before){var doc,sibling,textNode,parentNode;doc=node.ownerDocument;textNode=doc.createTextNode(Zwsp.ZWSP);parentNode=node.parentNode;if(!before){sibling=node.nextSibling;if(isText(sibling)){if(isCaretContainer(sibling)){return sibling}if(startsWithCaretContainer(sibling)){sibling.splitText(1);return sibling}}if(node.nextSibling){parentNode.insertBefore(textNode,node.nextSibling)}else{parentNode.appendChild(textNode)}}else{sibling=node.previousSibling;if(isText(sibling)){if(isCaretContainer(sibling)){return sibling}if(endsWithCaretContainer(sibling)){return sibling.splitText(sibling.data.length-1)}}parentNode.insertBefore(textNode,node)}return textNode}function insertBlock(blockName,node,before){var doc,blockNode,parentNode;doc=node.ownerDocument;blockNode=doc.createElement(blockName);blockNode.setAttribute("data-mce-caret",before?"before":"after");blockNode.setAttribute("data-mce-bogus","all");blockNode.appendChild(doc.createTextNode(""));parentNode=node.parentNode;if(!before){if(node.nextSibling){parentNode.insertBefore(blockNode,node.nextSibling)}else{parentNode.appendChild(blockNode)}}else{parentNode.insertBefore(blockNode,node)}return blockNode}function remove(caretContainerNode){var text;if(isElement(caretContainerNode)&&isCaretContainer(caretContainerNode)){if(caretContainerNode.innerHTML!="&nbsp;"){caretContainerNode.removeAttribute("data-mce-caret")}else{if(caretContainerNode.parentNode){caretContainerNode.parentNode.removeChild(caretContainerNode)}}}if(isText(caretContainerNode)){text=Zwsp.trim(caretContainerNode.data);if(text.length===0){if(caretContainerNode.parentNode){caretContainerNode.parentNode.removeChild(caretContainerNode)}}caretContainerNode.nodeValue=text}}function startsWithCaretContainer(node){return isText(node)&&node.data[0]==Zwsp.ZWSP}function endsWithCaretContainer(node){return isText(node)&&node.data[node.data.length-1]==Zwsp.ZWSP}return{isCaretContainer:isCaretContainer,isCaretContainerBlock:isCaretContainerBlock,isCaretContainerInline:isCaretContainerInline,insertInline:insertInline,insertBlock:insertBlock,remove:remove,startsWithCaretContainer:startsWithCaretContainer,endsWithCaretContainer:endsWithCaretContainer}});define("tinymce/dom/RangeUtils",["tinymce/util/Tools","tinymce/dom/TreeWalker","tinymce/dom/NodeType","tinymce/caret/CaretContainer"],function(Tools,TreeWalker,NodeType,CaretContainer){var each=Tools.each,isContentEditableFalse=NodeType.isContentEditableFalse,isCaretContainer=CaretContainer.isCaretContainer;function getEndChild(container,index){var childNodes=container.childNodes;index--;if(index>childNodes.length-1){index=childNodes.length-1}else if(index<0){index=0}return childNodes[index]||container}function RangeUtils(dom){this.walk=function(rng,callback){var startContainer=rng.startContainer,startOffset=rng.startOffset,endContainer=rng.endContainer,endOffset=rng.endOffset,ancestor,startPoint,endPoint,node,parent,siblings,nodes;nodes=dom.select("td[data-mce-selected],th[data-mce-selected]");if(nodes.length>0){each(nodes,function(node){callback([node])});return}function exclude(nodes){var node;node=nodes[0];if(node.nodeType===3&&node===startContainer&&startOffset>=node.nodeValue.length){nodes.splice(0,1)}node=nodes[nodes.length-1];if(endOffset===0&&nodes.length>0&&node===endContainer&&node.nodeType===3){nodes.splice(nodes.length-1,1)}return nodes}function collectSiblings(node,name,end_node){var siblings=[];for(;node&&node!=end_node;node=node[name]){siblings.push(node)}return siblings}function findEndPoint(node,root){do{if(node.parentNode==root){return node}node=node.parentNode}while(node)}function walkBoundary(start_node,end_node,next){var siblingName=next?"nextSibling":"previousSibling";for(node=start_node,parent=node.parentNode;node&&node!=end_node;node=parent){parent=node.parentNode;siblings=collectSiblings(node==start_node?node:node[siblingName],siblingName);if(siblings.length){if(!next){siblings.reverse()}callback(exclude(siblings))}}}if(startContainer.nodeType==1&&startContainer.hasChildNodes()){startContainer=startContainer.childNodes[startOffset]}if(endContainer.nodeType==1&&endContainer.hasChildNodes()){endContainer=getEndChild(endContainer,endOffset)}if(startContainer==endContainer){return callback(exclude([startContainer]))}ancestor=dom.findCommonAncestor(startContainer,endContainer);for(node=startContainer;node;node=node.parentNode){if(node===endContainer){return walkBoundary(startContainer,ancestor,true)}if(node===ancestor){break}}for(node=endContainer;node;node=node.parentNode){if(node===startContainer){return walkBoundary(endContainer,ancestor)}if(node===ancestor){break}}startPoint=findEndPoint(startContainer,ancestor)||startContainer;endPoint=findEndPoint(endContainer,ancestor)||endContainer;walkBoundary(startContainer,startPoint,true);siblings=collectSiblings(startPoint==startContainer?startPoint:startPoint.nextSibling,"nextSibling",endPoint==endContainer?endPoint.nextSibling:endPoint);if(siblings.length){callback(exclude(siblings))}walkBoundary(endContainer,endPoint)};this.split=function(rng){var startContainer=rng.startContainer,startOffset=rng.startOffset,endContainer=rng.endContainer,endOffset=rng.endOffset;function splitText(node,offset){return node.splitText(offset)}if(startContainer==endContainer&&startContainer.nodeType==3){if(startOffset>0&&startOffset<startContainer.nodeValue.length){endContainer=splitText(startContainer,startOffset);startContainer=endContainer.previousSibling;if(endOffset>startOffset){endOffset=endOffset-startOffset;startContainer=endContainer=splitText(endContainer,endOffset).previousSibling;endOffset=endContainer.nodeValue.length;startOffset=0}else{endOffset=0}}}else{if(startContainer.nodeType==3&&startOffset>0&&startOffset<startContainer.nodeValue.length){startContainer=splitText(startContainer,startOffset);startOffset=0}if(endContainer.nodeType==3&&endOffset>0&&endOffset<endContainer.nodeValue.length){endContainer=splitText(endContainer,endOffset).previousSibling;endOffset=endContainer.nodeValue.length}}return{startContainer:startContainer,startOffset:startOffset,endContainer:endContainer,endOffset:endOffset}};this.normalize=function(rng){var normalized,collapsed;function normalizeEndPoint(start){var container,offset,walker,body=dom.getRoot(),node,nonEmptyElementsMap;var directionLeft,isAfterNode;function isTableCell(node){return node&&/^(TD|TH|CAPTION)$/.test(node.nodeName)}function hasBrBeforeAfter(node,left){var walker=new TreeWalker(node,dom.getParent(node.parentNode,dom.isBlock)||body);while(node=walker[left?"prev":"next"]()){if(node.nodeName==="BR"){return true}}}function hasContentEditableFalseParent(node){while(node&&node!=body){if(isContentEditableFalse(node)){return true}node=node.parentNode}return false}function isPrevNode(node,name){return node.previousSibling&&node.previousSibling.nodeName==name}function findTextNodeRelative(left,startNode){var walker,lastInlineElement,parentBlockContainer;startNode=startNode||container;parentBlockContainer=dom.getParent(startNode.parentNode,dom.isBlock)||body;if(left&&startNode.nodeName=="BR"&&isAfterNode&&dom.isEmpty(parentBlockContainer)){container=startNode.parentNode;offset=dom.nodeIndex(startNode);normalized=true;return}walker=new TreeWalker(startNode,parentBlockContainer);while(node=walker[left?"prev":"next"]()){if(dom.getContentEditableParent(node)==="false"||isCaretContainer(node)){return}if(node.nodeType===3&&node.nodeValue.length>0){container=node;offset=left?node.nodeValue.length:0;normalized=true;return}if(dom.isBlock(node)||nonEmptyElementsMap[node.nodeName.toLowerCase()]){return}lastInlineElement=node}if(collapsed&&lastInlineElement){container=lastInlineElement;normalized=true;offset=0}}container=rng[(start?"start":"end")+"Container"];offset=rng[(start?"start":"end")+"Offset"];isAfterNode=container.nodeType==1&&offset===container.childNodes.length;nonEmptyElementsMap=dom.schema.getNonEmptyElements();directionLeft=start;if(isCaretContainer(container)){return}if(container.nodeType==1&&offset>container.childNodes.length-1){directionLeft=false}if(container.nodeType===9){container=dom.getRoot();offset=0}if(container===body){if(directionLeft){node=container.childNodes[offset>0?offset-1:0];if(node){if(isCaretContainer(node)){return}if(nonEmptyElementsMap[node.nodeName]||node.nodeName=="TABLE"){return}}}if(container.hasChildNodes()){offset=Math.min(!directionLeft&&offset>0?offset-1:offset,container.childNodes.length-1);container=container.childNodes[offset];offset=0;if(hasContentEditableFalseParent(container)||isCaretContainer(container)){return}if(container.hasChildNodes()&&!/TABLE/.test(container.nodeName)){
node=container;walker=new TreeWalker(container,body);do{if(isContentEditableFalse(node)||isCaretContainer(node)){normalized=false;break}if(node.nodeType===3&&node.nodeValue.length>0){offset=directionLeft?0:node.nodeValue.length;container=node;normalized=true;break}if(nonEmptyElementsMap[node.nodeName.toLowerCase()]&&!isTableCell(node)){offset=dom.nodeIndex(node);container=node.parentNode;if(node.nodeName=="IMG"&&!directionLeft){offset++}normalized=true;break}}while(node=directionLeft?walker.next():walker.prev())}}}if(collapsed){if(container.nodeType===3&&offset===0){findTextNodeRelative(true)}if(container.nodeType===1){node=container.childNodes[offset];if(!node){node=container.childNodes[offset-1]}if(node&&node.nodeName==="BR"&&!isPrevNode(node,"A")&&!hasBrBeforeAfter(node)&&!hasBrBeforeAfter(node,true)){findTextNodeRelative(true,node)}}}if(directionLeft&&!collapsed&&container.nodeType===3&&offset===container.nodeValue.length){findTextNodeRelative(false)}if(normalized){rng["set"+(start?"Start":"End")](container,offset)}}collapsed=rng.collapsed;normalizeEndPoint(true);if(!collapsed){normalizeEndPoint()}if(normalized&&collapsed){rng.collapse(true)}return normalized}}RangeUtils.compareRanges=function(rng1,rng2){if(rng1&&rng2){if(rng1.item||rng1.duplicate){if(rng1.item&&rng2.item&&rng1.item(0)===rng2.item(0)){return true}if(rng1.isEqual&&rng2.isEqual&&rng2.isEqual(rng1)){return true}}else{return rng1.startContainer==rng2.startContainer&&rng1.startOffset==rng2.startOffset}}return false};function findClosestIeRange(clientX,clientY,doc){var element,rng,rects;element=doc.elementFromPoint(clientX,clientY);rng=doc.body.createTextRange();if(element.tagName=="HTML"){element=doc.body}rng.moveToElementText(element);rects=Tools.toArray(rng.getClientRects());rects=rects.sort(function(a,b){a=Math.abs(Math.max(a.top-clientY,a.bottom-clientY));b=Math.abs(Math.max(b.top-clientY,b.bottom-clientY));return a-b});if(rects.length>0){clientY=(rects[0].bottom+rects[0].top)/2;try{rng.moveToPoint(clientX,clientY);rng.collapse(true);return rng}catch(ex){}}return null}RangeUtils.getCaretRangeFromPoint=function(clientX,clientY,doc){var rng,point;if(doc.caretPositionFromPoint){point=doc.caretPositionFromPoint(clientX,clientY);rng=doc.createRange();rng.setStart(point.offsetNode,point.offset);rng.collapse(true)}else if(doc.caretRangeFromPoint){rng=doc.caretRangeFromPoint(clientX,clientY)}else if(doc.body.createTextRange){rng=doc.body.createTextRange();try{rng.moveToPoint(clientX,clientY);rng.collapse(true)}catch(ex){rng=findClosestIeRange(clientX,clientY,doc)}}return rng};RangeUtils.getSelectedNode=function(range){var startContainer=range.startContainer,startOffset=range.startOffset;if(startContainer.hasChildNodes()&&range.endOffset==startOffset+1){return startContainer.childNodes[startOffset]}return null};RangeUtils.getNode=function(container,offset){if(container.nodeType==1&&container.hasChildNodes()){if(offset>=container.childNodes.length){offset=container.childNodes.length-1}container=container.childNodes[offset]}return container};return RangeUtils});define("tinymce/NodeChange",["tinymce/dom/RangeUtils","tinymce/Env","tinymce/util/Delay"],function(RangeUtils,Env,Delay){return function(editor){var lastRng,lastPath=[];function isSameElementPath(startElm){var i,currentPath;currentPath=editor.$(startElm).parentsUntil(editor.getBody()).add(startElm);if(currentPath.length===lastPath.length){for(i=currentPath.length;i>=0;i--){if(currentPath[i]!==lastPath[i]){break}}if(i===-1){lastPath=currentPath;return true}}lastPath=currentPath;return false}if(!("onselectionchange"in editor.getDoc())){editor.on("NodeChange Click MouseUp KeyUp Focus",function(e){var nativeRng,fakeRng;nativeRng=editor.selection.getRng();fakeRng={startContainer:nativeRng.startContainer,startOffset:nativeRng.startOffset,endContainer:nativeRng.endContainer,endOffset:nativeRng.endOffset};if(e.type=="nodechange"||!RangeUtils.compareRanges(fakeRng,lastRng)){editor.fire("SelectionChange")}lastRng=fakeRng})}editor.on("contextmenu",function(){editor.fire("SelectionChange")});editor.on("SelectionChange",function(){var startElm=editor.selection.getStart(true);if(!Env.range&&editor.selection.isCollapsed()){return}if(!isSameElementPath(startElm)&&editor.dom.isChildOf(startElm,editor.getBody())){editor.nodeChanged({selectionChange:true})}});editor.on("MouseUp",function(e){if(!e.isDefaultPrevented()){if(editor.selection.getNode().nodeName=="IMG"){Delay.setEditorTimeout(editor,function(){editor.nodeChanged()})}else{editor.nodeChanged()}}});this.nodeChanged=function(args){var selection=editor.selection,node,parents,root;if(editor.initialized&&selection&&!editor.settings.disable_nodechange&&!editor.readonly){root=editor.getBody();node=selection.getStart()||root;if(node.ownerDocument!=editor.getDoc()||!editor.dom.isChildOf(node,root)){node=root}if(node.nodeName=="IMG"&&selection.isCollapsed()){node=node.parentNode}parents=[];editor.dom.getParent(node,function(node){if(node===root){return true}parents.push(node)});args=args||{};args.element=node;args.parents=parents;editor.fire("NodeChange",args)}}}});define("tinymce/html/Node",[],function(){var whiteSpaceRegExp=/^[ \t\r\n]*$/,typeLookup={"#text":3,"#comment":8,"#cdata":4,"#pi":7,"#doctype":10,"#document-fragment":11};function walk(node,root_node,prev){var sibling,parent,startName=prev?"lastChild":"firstChild",siblingName=prev?"prev":"next";if(node[startName]){return node[startName]}if(node!==root_node){sibling=node[siblingName];if(sibling){return sibling}for(parent=node.parent;parent&&parent!==root_node;parent=parent.parent){sibling=parent[siblingName];if(sibling){return sibling}}}}function Node(name,type){this.name=name;this.type=type;if(type===1){this.attributes=[];this.attributes.map={}}}Node.prototype={replace:function(node){var self=this;if(node.parent){node.remove()}self.insert(node,self);self.remove();return self},attr:function(name,value){var self=this,attrs,i,undef;if(typeof name!=="string"){for(i in name){self.attr(i,name[i])}return self}if(attrs=self.attributes){if(value!==undef){if(value===null){if(name in attrs.map){delete attrs.map[name];i=attrs.length;while(i--){if(attrs[i].name===name){attrs=attrs.splice(i,1);return self}}}return self}if(name in attrs.map){i=attrs.length;while(i--){if(attrs[i].name===name){attrs[i].value=value;break}}}else{attrs.push({name:name,value:value})}attrs.map[name]=value;return self}return attrs.map[name]}},clone:function(){var self=this,clone=new Node(self.name,self.type),i,l,selfAttrs,selfAttr,cloneAttrs;if(selfAttrs=self.attributes){cloneAttrs=[];cloneAttrs.map={};for(i=0,l=selfAttrs.length;i<l;i++){selfAttr=selfAttrs[i];if(selfAttr.name!=="id"){cloneAttrs[cloneAttrs.length]={name:selfAttr.name,value:selfAttr.value};cloneAttrs.map[selfAttr.name]=selfAttr.value}}clone.attributes=cloneAttrs}clone.value=self.value;clone.shortEnded=self.shortEnded;return clone},wrap:function(wrapper){var self=this;self.parent.insert(wrapper,self);wrapper.append(self);return self},unwrap:function(){var self=this,node,next;for(node=self.firstChild;node;){next=node.next;self.insert(node,self,true);node=next}self.remove()},remove:function(){var self=this,parent=self.parent,next=self.next,prev=self.prev;if(parent){if(parent.firstChild===self){parent.firstChild=next;if(next){next.prev=null}}else{prev.next=next}if(parent.lastChild===self){parent.lastChild=prev;if(prev){prev.next=null}}else{next.prev=prev}self.parent=self.next=self.prev=null}return self},append:function(node){var self=this,last;if(node.parent){node.remove()}last=self.lastChild;if(last){last.next=node;node.prev=last;self.lastChild=node}else{self.lastChild=self.firstChild=node}node.parent=self;return node},insert:function(node,ref_node,before){var parent;if(node.parent){node.remove()}parent=ref_node.parent||this;if(before){if(ref_node===parent.firstChild){parent.firstChild=node}else{ref_node.prev.next=node}node.prev=ref_node.prev;node.next=ref_node;ref_node.prev=node}else{if(ref_node===parent.lastChild){parent.lastChild=node}else{ref_node.next.prev=node}node.next=ref_node.next;node.prev=ref_node;ref_node.next=node}node.parent=parent;return node},getAll:function(name){var self=this,node,collection=[];for(node=self.firstChild;node;node=walk(node,self)){if(node.name===name){collection.push(node)}}return collection},empty:function(){var self=this,nodes,i,node;if(self.firstChild){nodes=[];for(node=self.firstChild;node;node=walk(node,self)){nodes.push(node)}i=nodes.length;while(i--){node=nodes[i];node.parent=node.firstChild=node.lastChild=node.next=node.prev=null}}self.firstChild=self.lastChild=null;return self},isEmpty:function(elements){var self=this,node=self.firstChild,i,name;if(node){do{if(node.type===1){if(node.attributes.map["data-mce-bogus"]){continue}if(elements[node.name]){return false}i=node.attributes.length;while(i--){name=node.attributes[i].name;if(name==="name"||name.indexOf("data-mce-bookmark")===0){return false}}}if(node.type===8){return false}if(node.type===3&&!whiteSpaceRegExp.test(node.value)){return false}}while(node=walk(node,self))}return true},walk:function(prev){return walk(this,null,prev)}};Node.create=function(name,attrs){var node,attrName;node=new Node(name,typeLookup[name]||1);if(attrs){for(attrName in attrs){node.attr(attrName,attrs[attrName])}}return node};return Node});define("tinymce/html/Schema",["tinymce/util/Tools"],function(Tools){var mapCache={},dummyObj={};var makeMap=Tools.makeMap,each=Tools.each,extend=Tools.extend,explode=Tools.explode,inArray=Tools.inArray;function split(items,delim){return items?items.split(delim||" "):[]}function compileSchema(type){var schema={},globalAttributes,blockContent;var phrasingContent,flowContent,html4BlockContent,html4PhrasingContent;function add(name,attributes,children){var ni,i,attributesOrder,args=arguments;function arrayToMap(array,obj){var map={},i,l;for(i=0,l=array.length;i<l;i++){map[array[i]]=obj||{}}return map}children=children||[];attributes=attributes||"";if(typeof children==="string"){children=split(children)}for(i=3;i<args.length;i++){if(typeof args[i]==="string"){args[i]=split(args[i])}children.push.apply(children,args[i])}name=split(name);ni=name.length;while(ni--){attributesOrder=[].concat(globalAttributes,split(attributes));schema[name[ni]]={attributes:arrayToMap(attributesOrder),attributesOrder:attributesOrder,children:arrayToMap(children,dummyObj)}}}function addAttrs(name,attributes){var ni,schemaItem,i,l;name=split(name);ni=name.length;attributes=split(attributes);while(ni--){schemaItem=schema[name[ni]];for(i=0,l=attributes.length;i<l;i++){schemaItem.attributes[attributes[i]]={};schemaItem.attributesOrder.push(attributes[i])}}}if(mapCache[type]){return mapCache[type]}globalAttributes=split("id accesskey class dir lang style tabindex title");blockContent=split("address blockquote div dl fieldset form h1 h2 h3 h4 h5 h6 hr menu ol p pre table ul");phrasingContent=split("a abbr b bdo br button cite code del dfn em embed i iframe img input ins kbd "+"label map noscript object q s samp script select small span strong sub sup "+"textarea u var #text #comment");if(type!="html4"){globalAttributes.push.apply(globalAttributes,split("contenteditable contextmenu draggable dropzone "+"hidden spellcheck translate"));blockContent.push.apply(blockContent,split("article aside details dialog figure header footer hgroup section nav"));phrasingContent.push.apply(phrasingContent,split("audio canvas command datalist mark meter output picture "+"progress time wbr video ruby bdi keygen"))}if(type!="html5-strict"){globalAttributes.push("xml:lang");html4PhrasingContent=split("acronym applet basefont big font strike tt");phrasingContent.push.apply(phrasingContent,html4PhrasingContent);each(html4PhrasingContent,function(name){add(name,"",phrasingContent)});html4BlockContent=split("center dir isindex noframes");blockContent.push.apply(blockContent,html4BlockContent);flowContent=[].concat(blockContent,phrasingContent);each(html4BlockContent,function(name){add(name,"",flowContent)})}flowContent=flowContent||[].concat(blockContent,phrasingContent);add("html","manifest","head body");add("head","","base command link meta noscript script style title");add("title hr noscript br");add("base","href target");add("link","href rel media hreflang type sizes hreflang");add("meta","name http-equiv content charset");add("style","media type scoped");add("script","src async defer type charset");add("body","onafterprint onbeforeprint onbeforeunload onblur onerror onfocus "+"onhashchange onload onmessage onoffline ononline onpagehide onpageshow "+"onpopstate onresize onscroll onstorage onunload",flowContent);add("address dt dd div caption","",flowContent);add("h1 h2 h3 h4 h5 h6 pre p abbr code var samp kbd sub sup i b u bdo span legend em strong small s cite dfn","",phrasingContent);add("blockquote","cite",flowContent);add("ol","reversed start type","li");add("ul","","li");add("li","value",flowContent);add("dl","","dt dd");add("a","href target rel media hreflang type",phrasingContent);add("q","cite",phrasingContent);add("ins del","cite datetime",flowContent);add("img","src sizes srcset alt usemap ismap width height");add("iframe","src name width height",flowContent);add("embed","src type width height");add("object","data type typemustmatch name usemap form width height",flowContent,"param");add("param","name value");add("map","name",flowContent,"area");add("area","alt coords shape href target rel media hreflang type");add("table","border","caption colgroup thead tfoot tbody tr"+(type=="html4"?" col":""));add("colgroup","span","col");add("col","span");add("tbody thead tfoot","","tr");add("tr","","td th");add("td","colspan rowspan headers",flowContent);add("th","colspan rowspan headers scope abbr",flowContent);add("form","accept-charset action autocomplete enctype method name novalidate target",flowContent);add("fieldset","disabled form name",flowContent,"legend");add("label","form for",phrasingContent);add("input","accept alt autocomplete checked dirname disabled form formaction formenctype formmethod formnovalidate "+"formtarget height list max maxlength min multiple name pattern readonly required size src step type value width");add("button","disabled form formaction formenctype formmethod formnovalidate formtarget name type value",type=="html4"?flowContent:phrasingContent);add("select","disabled form multiple name required size","option optgroup");add("optgroup","disabled label","option");add("option","disabled label selected value");add("textarea","cols dirname disabled form maxlength name readonly required rows wrap");add("menu","type label",flowContent,"li");add("noscript","",flowContent);if(type!="html4"){add("wbr");add("ruby","",phrasingContent,"rt rp");add("figcaption","",flowContent);add("mark rt rp summary bdi","",phrasingContent);add("canvas","width height",flowContent);add("video","src crossorigin poster preload autoplay mediagroup loop "+"muted controls width height buffered",flowContent,"track source");add("audio","src crossorigin preload autoplay mediagroup loop muted controls buffered volume",flowContent,"track source");add("picture","","img source");add("source","src srcset type media sizes");add("track","kind src srclang label default");add("datalist","",phrasingContent,"option");add("article section nav aside header footer","",flowContent);add("hgroup","","h1 h2 h3 h4 h5 h6");add("figure","",flowContent,"figcaption");add("time","datetime",phrasingContent);add("dialog","open",flowContent);add("command","type label icon disabled checked radiogroup command");add("output","for form name",phrasingContent);add("progress","value max",phrasingContent);add("meter","value min max low high optimum",phrasingContent);add("details","open",flowContent,"summary");add("keygen","autofocus challenge disabled form keytype name")}if(type!="html5-strict"){addAttrs("script","language xml:space");addAttrs("style","xml:space");addAttrs("object","declare classid code codebase codetype archive standby align border hspace vspace");addAttrs("embed","align name hspace vspace");addAttrs("param","valuetype type");addAttrs("a","charset name rev shape coords");addAttrs("br","clear");addAttrs("applet","codebase archive code object alt name width height align hspace vspace");addAttrs("img","name longdesc align border hspace vspace");addAttrs("iframe","longdesc frameborder marginwidth marginheight scrolling align");addAttrs("font basefont","size color face");addAttrs("input","usemap align");addAttrs("select","onchange");addAttrs("textarea");addAttrs("h1 h2 h3 h4 h5 h6 div p legend caption","align");addAttrs("ul","type compact");addAttrs("li","type");addAttrs("ol dl menu dir","compact");addAttrs("pre","width xml:space");addAttrs("hr","align noshade size width");addAttrs("isindex","prompt");addAttrs("table","summary width frame rules cellspacing cellpadding align bgcolor");addAttrs("col","width align char charoff valign");addAttrs("colgroup","width align char charoff valign");addAttrs("thead","align char charoff valign");addAttrs("tr","align char charoff valign bgcolor");addAttrs("th","axis align char charoff valign nowrap bgcolor width height");addAttrs("form","accept");addAttrs("td","abbr axis scope align char charoff valign nowrap bgcolor width height");addAttrs("tfoot","align char charoff valign");addAttrs("tbody","align char charoff valign");addAttrs("area","nohref");addAttrs("body","background bgcolor text link vlink alink")}if(type!="html4"){addAttrs("input button select textarea","autofocus");addAttrs("input textarea","placeholder");addAttrs("a","download");addAttrs("link script img","crossorigin");addAttrs("iframe","sandbox seamless allowfullscreen")}each(split("a form meter progress dfn"),function(name){if(schema[name]){delete schema[name].children[name]}});delete schema.caption.children.table;delete schema.script;mapCache[type]=schema;return schema}function compileElementMap(value,mode){var styles;if(value){styles={};if(typeof value=="string"){value={"*":value}}each(value,function(value,key){styles[key]=styles[key.toUpperCase()]=mode=="map"?makeMap(value,/[, ]/):explode(value,/[, ]/)})}return styles}return function(settings){var self=this,elements={},children={},patternElements=[],validStyles,invalidStyles,schemaItems;var whiteSpaceElementsMap,selfClosingElementsMap,shortEndedElementsMap,boolAttrMap,validClasses;var blockElementsMap,nonEmptyElementsMap,moveCaretBeforeOnEnterElementsMap,textBlockElementsMap,textInlineElementsMap;var customElementsMap={},specialElements={};function createLookupTable(option,default_value,extendWith){var value=settings[option];if(!value){value=mapCache[option];if(!value){value=makeMap(default_value," ",makeMap(default_value.toUpperCase()," "));value=extend(value,extendWith);mapCache[option]=value}}else{value=makeMap(value,/[, ]/,makeMap(value.toUpperCase(),/[, ]/))}return value}settings=settings||{};schemaItems=compileSchema(settings.schema);if(settings.verify_html===false){settings.valid_elements="*[*]"}validStyles=compileElementMap(settings.valid_styles);invalidStyles=compileElementMap(settings.invalid_styles,"map");validClasses=compileElementMap(settings.valid_classes,"map");whiteSpaceElementsMap=createLookupTable("whitespace_elements","pre script noscript style textarea video audio iframe object");selfClosingElementsMap=createLookupTable("self_closing_elements","colgroup dd dt li option p td tfoot th thead tr");shortEndedElementsMap=createLookupTable("short_ended_elements","area base basefont br col frame hr img input isindex link "+"meta param embed source wbr track");boolAttrMap=createLookupTable("boolean_attributes","checked compact declare defer disabled ismap multiple nohref noresize "+"noshade nowrap readonly selected autoplay loop controls");nonEmptyElementsMap=createLookupTable("non_empty_elements","td th iframe video audio object script",shortEndedElementsMap);moveCaretBeforeOnEnterElementsMap=createLookupTable("move_caret_before_on_enter_elements","table",nonEmptyElementsMap);textBlockElementsMap=createLookupTable("text_block_elements","h1 h2 h3 h4 h5 h6 p div address pre form "+"blockquote center dir fieldset header footer article section hgroup aside nav figure");blockElementsMap=createLookupTable("block_elements","hr table tbody thead tfoot "+"th tr td li ol ul caption dl dt dd noscript menu isindex option "+"datalist select optgroup figcaption",textBlockElementsMap);textInlineElementsMap=createLookupTable("text_inline_elements","span strong b em i font strike u var cite "+"dfn code mark q sup sub samp");each((settings.special||"script noscript style textarea").split(" "),function(name){specialElements[name]=new RegExp("</"+name+"[^>]*>","gi")});function patternToRegExp(str){return new RegExp("^"+str.replace(/([?+*])/g,".$1")+"$")}function addValidElements(validElements){var ei,el,ai,al,matches,element,attr,attrData,elementName,attrName,attrType,attributes,attributesOrder,prefix,outputName,globalAttributes,globalAttributesOrder,key,value,elementRuleRegExp=/^([#+\-])?([^\[!\/]+)(?:\/([^\[!]+))?(?:(!?)\[([^\]]+)\])?$/,attrRuleRegExp=/^([!\-])?(\w+::\w+|[^=:<]+)?(?:([=:<])(.*))?$/,hasPatternsRegExp=/[*?+]/;if(validElements){validElements=split(validElements,",");if(elements["@"]){globalAttributes=elements["@"].attributes;globalAttributesOrder=elements["@"].attributesOrder}for(ei=0,el=validElements.length;ei<el;ei++){matches=elementRuleRegExp.exec(validElements[ei]);if(matches){prefix=matches[1];elementName=matches[2];outputName=matches[3];attrData=matches[5];attributes={};attributesOrder=[];element={attributes:attributes,attributesOrder:attributesOrder};if(prefix==="#"){element.paddEmpty=true}if(prefix==="-"){element.removeEmpty=true}if(matches[4]==="!"){element.removeEmptyAttrs=true}if(globalAttributes){for(key in globalAttributes){attributes[key]=globalAttributes[key]}attributesOrder.push.apply(attributesOrder,globalAttributesOrder)}if(attrData){attrData=split(attrData,"|");for(ai=0,al=attrData.length;ai<al;ai++){matches=attrRuleRegExp.exec(attrData[ai]);if(matches){attr={};attrType=matches[1];attrName=matches[2].replace(/::/g,":");prefix=matches[3];value=matches[4];if(attrType==="!"){element.attributesRequired=element.attributesRequired||[];element.attributesRequired.push(attrName);attr.required=true}if(attrType==="-"){delete attributes[attrName];attributesOrder.splice(inArray(attributesOrder,attrName),1);continue}if(prefix){if(prefix==="="){element.attributesDefault=element.attributesDefault||[];element.attributesDefault.push({name:attrName,value:value});attr.defaultValue=value}if(prefix===":"){element.attributesForced=element.attributesForced||[];element.attributesForced.push({name:attrName,value:value});attr.forcedValue=value}if(prefix==="<"){attr.validValues=makeMap(value,"?")}}if(hasPatternsRegExp.test(attrName)){element.attributePatterns=element.attributePatterns||[];attr.pattern=patternToRegExp(attrName);element.attributePatterns.push(attr)}else{if(!attributes[attrName]){attributesOrder.push(attrName)}attributes[attrName]=attr}}}}if(!globalAttributes&&elementName=="@"){globalAttributes=attributes;globalAttributesOrder=attributesOrder}if(outputName){element.outputName=elementName;elements[outputName]=element}if(hasPatternsRegExp.test(elementName)){element.pattern=patternToRegExp(elementName);patternElements.push(element)}else{elements[elementName]=element}}}}}function setValidElements(validElements){elements={};patternElements=[];addValidElements(validElements);each(schemaItems,function(element,name){children[name]=element.children})}function addCustomElements(customElements){var customElementRegExp=/^(~)?(.+)$/;if(customElements){mapCache.text_block_elements=mapCache.block_elements=null;each(split(customElements,","),function(rule){var matches=customElementRegExp.exec(rule),inline=matches[1]==="~",cloneName=inline?"span":"div",name=matches[2];children[name]=children[cloneName];customElementsMap[name]=cloneName;if(!inline){blockElementsMap[name.toUpperCase()]={};blockElementsMap[name]={}}if(!elements[name]){var customRule=elements[cloneName];customRule=extend({},customRule);delete customRule.removeEmptyAttrs;delete customRule.removeEmpty;elements[name]=customRule}each(children,function(element,elmName){if(element[cloneName]){children[elmName]=element=extend({},children[elmName]);element[name]=element[cloneName]}})})}}function addValidChildren(validChildren){var childRuleRegExp=/^([+\-]?)(\w+)\[([^\]]+)\]$/;mapCache[settings.schema]=null;if(validChildren){each(split(validChildren,","),function(rule){var matches=childRuleRegExp.exec(rule),parent,prefix;if(matches){prefix=matches[1];if(prefix){parent=children[matches[2]]}else{parent=children[matches[2]]={"#comment":{}}}parent=children[matches[2]];each(split(matches[3],"|"),function(child){if(prefix==="-"){delete parent[child]}else{parent[child]={}}})}})}}function getElementRule(name){var element=elements[name],i;if(element){return element}i=patternElements.length;while(i--){element=patternElements[i];if(element.pattern.test(name)){return element}}}if(!settings.valid_elements){each(schemaItems,function(element,name){elements[name]={attributes:element.attributes,attributesOrder:element.attributesOrder};children[name]=element.children});if(settings.schema!="html5"){each(split("strong/b em/i"),function(item){item=split(item,"/");elements[item[1]].outputName=item[0]})}each(split("ol ul sub sup blockquote span font a table tbody tr strong em b i"),function(name){if(elements[name]){elements[name].removeEmpty=true}});each(split("p h1 h2 h3 h4 h5 h6 th td pre div address caption"),function(name){elements[name].paddEmpty=true});each(split("span"),function(name){elements[name].removeEmptyAttrs=true})}else{setValidElements(settings.valid_elements)}addCustomElements(settings.custom_elements);addValidChildren(settings.valid_children);addValidElements(settings.extended_valid_elements);addValidChildren("+ol[ul|ol],+ul[ul|ol]");if(settings.invalid_elements){each(explode(settings.invalid_elements),function(item){if(elements[item]){delete elements[item]}})}if(!getElementRule("span")){addValidElements("span[!data-mce-type|*]")}self.children=children;self.getValidStyles=function(){return validStyles};self.getInvalidStyles=function(){return invalidStyles};self.getValidClasses=function(){return validClasses};self.getBoolAttrs=function(){return boolAttrMap};self.getBlockElements=function(){return blockElementsMap};self.getTextBlockElements=function(){return textBlockElementsMap};self.getTextInlineElements=function(){return textInlineElementsMap};self.getShortEndedElements=function(){return shortEndedElementsMap};self.getSelfClosingElements=function(){return selfClosingElementsMap};self.getNonEmptyElements=function(){return nonEmptyElementsMap};self.getMoveCaretBeforeOnEnterElements=function(){return moveCaretBeforeOnEnterElementsMap};self.getWhiteSpaceElements=function(){return whiteSpaceElementsMap};self.getSpecialElements=function(){return specialElements};self.isValidChild=function(name,child){var parent=children[name];return!!(parent&&parent[child])};self.isValid=function(name,attr){var attrPatterns,i,rule=getElementRule(name);if(rule){if(attr){if(rule.attributes[attr]){return true}attrPatterns=rule.attributePatterns;if(attrPatterns){i=attrPatterns.length;while(i--){if(attrPatterns[i].pattern.test(name)){return true}}}}else{return true}}return false};self.getElementRule=getElementRule;self.getCustomElements=function(){return customElementsMap};self.addValidElements=addValidElements;self.setValidElements=setValidElements;self.addCustomElements=addCustomElements;self.addValidChildren=addValidChildren;self.elements=elements}});define("tinymce/html/SaxParser",["tinymce/html/Schema","tinymce/html/Entities","tinymce/util/Tools"],function(Schema,Entities,Tools){var each=Tools.each;function findEndTag(schema,html,startIndex){var count=1,index,matches,tokenRegExp,shortEndedElements;shortEndedElements=schema.getShortEndedElements();tokenRegExp=/<([!?\/])?([A-Za-z0-9\-_\:\.]+)((?:\s+[^"\'>]+(?:(?:"[^"]*")|(?:\'[^\']*\')|[^>]*))*|\/|\s+)>/g;tokenRegExp.lastIndex=index=startIndex;while(matches=tokenRegExp.exec(html)){index=tokenRegExp.lastIndex;if(matches[1]==="/"){count--}else if(!matches[1]){if(matches[2]in shortEndedElements){continue}count++}if(count===0){break}}return index}function SaxParser(settings,schema){var self=this;function noop(){}settings=settings||{};self.schema=schema=schema||new Schema;if(settings.fix_self_closing!==false){settings.fix_self_closing=true}each("comment cdata text start end pi doctype".split(" "),function(name){if(name){self[name]=settings[name]||noop}});self.parse=function(html){var self=this,matches,index=0,value,endRegExp,stack=[],attrList,i,text,name;var isInternalElement,removeInternalElements,shortEndedElements,fillAttrsMap,isShortEnded;var validate,elementRule,isValidElement,attr,attribsValue,validAttributesMap,validAttributePatterns;var attributesRequired,attributesDefault,attributesForced;var anyAttributesRequired,selfClosing,tokenRegExp,attrRegExp,specialElements,attrValue,idCount=0;var decode=Entities.decode,fixSelfClosing,filteredUrlAttrs=Tools.makeMap("src,href,data,background,formaction,poster");var scriptUriRegExp=/((java|vb)script|mhtml):/i,dataUriRegExp=/^data:/i;function processEndTag(name){var pos,i;pos=stack.length;while(pos--){if(stack[pos].name===name){break}}if(pos>=0){for(i=stack.length-1;i>=pos;i--){name=stack[i];if(name.valid){self.end(name.name)}}stack.length=pos}}function parseAttribute(match,name,value,val2,val3){var attrRule,i,trimRegExp=/[\s\u0000-\u001F]+/g;name=name.toLowerCase();value=name in fillAttrsMap?name:decode(value||val2||val3||"");if(validate&&!isInternalElement&&name.indexOf("data-")!==0){attrRule=validAttributesMap[name];if(!attrRule&&validAttributePatterns){i=validAttributePatterns.length;while(i--){attrRule=validAttributePatterns[i];if(attrRule.pattern.test(name)){break}}if(i===-1){attrRule=null}}if(!attrRule){return}if(attrRule.validValues&&!(value in attrRule.validValues)){return}}if(filteredUrlAttrs[name]&&!settings.allow_script_urls){var uri=value.replace(trimRegExp,"");try{uri=decodeURIComponent(uri)}catch(ex){uri=unescape(uri)}if(scriptUriRegExp.test(uri)){return}if(!settings.allow_html_data_urls&&dataUriRegExp.test(uri)&&!/^data:image\//i.test(uri)){return}}attrList.map[name]=value;attrList.push({name:name,value:value})}tokenRegExp=new RegExp("<(?:"+"(?:!--([\\w\\W]*?)-->)|"+"(?:!\\[CDATA\\[([\\w\\W]*?)\\]\\]>)|"+"(?:!DOCTYPE([\\w\\W]*?)>)|"+"(?:\\?([^\\s\\/<>]+) ?([\\w\\W]*?)[?/]>)|"+"(?:\\/([^>]+)>)|"+"(?:([A-Za-z0-9\\-_\\:\\.]+)((?:\\s+[^\"'>]+(?:(?:\"[^\"]*\")|(?:'[^']*')|[^>]*))*|\\/|\\s+)>)"+")","g");attrRegExp=/([\w:\-]+)(?:\s*=\s*(?:(?:\"((?:[^\"])*)\")|(?:\'((?:[^\'])*)\')|([^>\s]+)))?/g;shortEndedElements=schema.getShortEndedElements();selfClosing=settings.self_closing_elements||schema.getSelfClosingElements();fillAttrsMap=schema.getBoolAttrs();validate=settings.validate;removeInternalElements=settings.remove_internals;fixSelfClosing=settings.fix_self_closing;specialElements=schema.getSpecialElements();while(matches=tokenRegExp.exec(html)){if(index<matches.index){self.text(decode(html.substr(index,matches.index-index)))}if(value=matches[6]){value=value.toLowerCase();if(value.charAt(0)===":"){value=value.substr(1)}processEndTag(value)}else if(value=matches[7]){value=value.toLowerCase();if(value.charAt(0)===":"){value=value.substr(1)}isShortEnded=value in shortEndedElements;if(fixSelfClosing&&selfClosing[value]&&stack.length>0&&stack[stack.length-1].name===value){processEndTag(value)}if(!validate||(elementRule=schema.getElementRule(value))){isValidElement=true;if(validate){validAttributesMap=elementRule.attributes;validAttributePatterns=elementRule.attributePatterns}if(attribsValue=matches[8]){isInternalElement=attribsValue.indexOf("data-mce-type")!==-1;if(isInternalElement&&removeInternalElements){isValidElement=false}attrList=[];attrList.map={};attribsValue.replace(attrRegExp,parseAttribute)}else{attrList=[];attrList.map={}}if(validate&&!isInternalElement){
attributesRequired=elementRule.attributesRequired;attributesDefault=elementRule.attributesDefault;attributesForced=elementRule.attributesForced;anyAttributesRequired=elementRule.removeEmptyAttrs;if(anyAttributesRequired&&!attrList.length){isValidElement=false}if(attributesForced){i=attributesForced.length;while(i--){attr=attributesForced[i];name=attr.name;attrValue=attr.value;if(attrValue==="{$uid}"){attrValue="mce_"+idCount++}attrList.map[name]=attrValue;attrList.push({name:name,value:attrValue})}}if(attributesDefault){i=attributesDefault.length;while(i--){attr=attributesDefault[i];name=attr.name;if(!(name in attrList.map)){attrValue=attr.value;if(attrValue==="{$uid}"){attrValue="mce_"+idCount++}attrList.map[name]=attrValue;attrList.push({name:name,value:attrValue})}}}if(attributesRequired){i=attributesRequired.length;while(i--){if(attributesRequired[i]in attrList.map){break}}if(i===-1){isValidElement=false}}if(attr=attrList.map["data-mce-bogus"]){if(attr==="all"){index=findEndTag(schema,html,tokenRegExp.lastIndex);tokenRegExp.lastIndex=index;continue}isValidElement=false}}if(isValidElement){self.start(value,attrList,isShortEnded)}}else{isValidElement=false}if(endRegExp=specialElements[value]){endRegExp.lastIndex=index=matches.index+matches[0].length;if(matches=endRegExp.exec(html)){if(isValidElement){text=html.substr(index,matches.index-index)}index=matches.index+matches[0].length}else{text=html.substr(index);index=html.length}if(isValidElement){if(text.length>0){self.text(text,true)}self.end(value)}tokenRegExp.lastIndex=index;continue}if(!isShortEnded){if(!attribsValue||attribsValue.indexOf("/")!=attribsValue.length-1){stack.push({name:value,valid:isValidElement})}else if(isValidElement){self.end(value)}}}else if(value=matches[1]){if(value.charAt(0)===">"){value=" "+value}if(!settings.allow_conditional_comments&&value.substr(0,3)==="[if"){value=" "+value}self.comment(value)}else if(value=matches[2]){self.cdata(value)}else if(value=matches[3]){self.doctype(value)}else if(value=matches[4]){self.pi(value,matches[5])}index=matches.index+matches[0].length}if(index<html.length){self.text(decode(html.substr(index)))}for(i=stack.length-1;i>=0;i--){value=stack[i];if(value.valid){self.end(value.name)}}}}SaxParser.findEndTag=findEndTag;return SaxParser});define("tinymce/html/DomParser",["tinymce/html/Node","tinymce/html/Schema","tinymce/html/SaxParser","tinymce/util/Tools"],function(Node,Schema,SaxParser,Tools){var makeMap=Tools.makeMap,each=Tools.each,explode=Tools.explode,extend=Tools.extend;return function(settings,schema){var self=this,nodeFilters={},attributeFilters=[],matchedNodes={},matchedAttributes={};settings=settings||{};settings.validate="validate"in settings?settings.validate:true;settings.root_name=settings.root_name||"body";self.schema=schema=schema||new Schema;function fixInvalidChildren(nodes){var ni,node,parent,parents,newParent,currentNode,tempNode,childNode,i;var nonEmptyElements,nonSplitableElements,textBlockElements,specialElements,sibling,nextNode;nonSplitableElements=makeMap("tr,td,th,tbody,thead,tfoot,table");nonEmptyElements=schema.getNonEmptyElements();textBlockElements=schema.getTextBlockElements();specialElements=schema.getSpecialElements();for(ni=0;ni<nodes.length;ni++){node=nodes[ni];if(!node.parent||node.fixed){continue}if(textBlockElements[node.name]&&node.parent.name=="li"){sibling=node.next;while(sibling){if(textBlockElements[sibling.name]){sibling.name="li";sibling.fixed=true;node.parent.insert(sibling,node.parent)}else{break}sibling=sibling.next}node.unwrap(node);continue}parents=[node];for(parent=node.parent;parent&&!schema.isValidChild(parent.name,node.name)&&!nonSplitableElements[parent.name];parent=parent.parent){parents.push(parent)}if(parent&&parents.length>1){parents.reverse();newParent=currentNode=self.filterNode(parents[0].clone());for(i=0;i<parents.length-1;i++){if(schema.isValidChild(currentNode.name,parents[i].name)){tempNode=self.filterNode(parents[i].clone());currentNode.append(tempNode)}else{tempNode=currentNode}for(childNode=parents[i].firstChild;childNode&&childNode!=parents[i+1];){nextNode=childNode.next;tempNode.append(childNode);childNode=nextNode}currentNode=tempNode}if(!newParent.isEmpty(nonEmptyElements)){parent.insert(newParent,parents[0],true);parent.insert(node,newParent)}else{parent.insert(node,parents[0],true)}parent=parents[0];if(parent.isEmpty(nonEmptyElements)||parent.firstChild===parent.lastChild&&parent.firstChild.name==="br"){parent.empty().remove()}}else if(node.parent){if(node.name==="li"){sibling=node.prev;if(sibling&&(sibling.name==="ul"||sibling.name==="ul")){sibling.append(node);continue}sibling=node.next;if(sibling&&(sibling.name==="ul"||sibling.name==="ul")){sibling.insert(node,sibling.firstChild,true);continue}node.wrap(self.filterNode(new Node("ul",1)));continue}if(schema.isValidChild(node.parent.name,"div")&&schema.isValidChild("div",node.name)){node.wrap(self.filterNode(new Node("div",1)))}else{if(specialElements[node.name]){node.empty().remove()}else{node.unwrap()}}}}}self.filterNode=function(node){var i,name,list;if(name in nodeFilters){list=matchedNodes[name];if(list){list.push(node)}else{matchedNodes[name]=[node]}}i=attributeFilters.length;while(i--){name=attributeFilters[i].name;if(name in node.attributes.map){list=matchedAttributes[name];if(list){list.push(node)}else{matchedAttributes[name]=[node]}}}return node};self.addNodeFilter=function(name,callback){each(explode(name),function(name){var list=nodeFilters[name];if(!list){nodeFilters[name]=list=[]}list.push(callback)})};self.addAttributeFilter=function(name,callback){each(explode(name),function(name){var i;for(i=0;i<attributeFilters.length;i++){if(attributeFilters[i].name===name){attributeFilters[i].callbacks.push(callback);return}}attributeFilters.push({name:name,callbacks:[callback]})})};self.parse=function(html,args){var parser,rootNode,node,nodes,i,l,fi,fl,list,name,validate;var blockElements,startWhiteSpaceRegExp,invalidChildren=[],isInWhiteSpacePreservedElement;var endWhiteSpaceRegExp,allWhiteSpaceRegExp,isAllWhiteSpaceRegExp,whiteSpaceElements;var children,nonEmptyElements,rootBlockName;args=args||{};matchedNodes={};matchedAttributes={};blockElements=extend(makeMap("script,style,head,html,body,title,meta,param"),schema.getBlockElements());nonEmptyElements=schema.getNonEmptyElements();children=schema.children;validate=settings.validate;rootBlockName="forced_root_block"in args?args.forced_root_block:settings.forced_root_block;whiteSpaceElements=schema.getWhiteSpaceElements();startWhiteSpaceRegExp=/^[ \t\r\n]+/;endWhiteSpaceRegExp=/[ \t\r\n]+$/;allWhiteSpaceRegExp=/[ \t\r\n]+/g;isAllWhiteSpaceRegExp=/^[ \t\r\n]+$/;function addRootBlocks(){var node=rootNode.firstChild,next,rootBlockNode;function trim(rootBlockNode){if(rootBlockNode){node=rootBlockNode.firstChild;if(node&&node.type==3){node.value=node.value.replace(startWhiteSpaceRegExp,"")}node=rootBlockNode.lastChild;if(node&&node.type==3){node.value=node.value.replace(endWhiteSpaceRegExp,"")}}}if(!schema.isValidChild(rootNode.name,rootBlockName.toLowerCase())){return}while(node){next=node.next;if(node.type==3||node.type==1&&node.name!=="p"&&!blockElements[node.name]&&!node.attr("data-mce-type")){if(!rootBlockNode){rootBlockNode=createNode(rootBlockName,1);rootBlockNode.attr(settings.forced_root_block_attrs);rootNode.insert(rootBlockNode,node);rootBlockNode.append(node)}else{rootBlockNode.append(node)}}else{trim(rootBlockNode);rootBlockNode=null}node=next}trim(rootBlockNode)}function createNode(name,type){var node=new Node(name,type),list;if(name in nodeFilters){list=matchedNodes[name];if(list){list.push(node)}else{matchedNodes[name]=[node]}}return node}function removeWhitespaceBefore(node){var textNode,textNodeNext,textVal,sibling,blockElements=schema.getBlockElements();for(textNode=node.prev;textNode&&textNode.type===3;){textVal=textNode.value.replace(endWhiteSpaceRegExp,"");if(textVal.length>0){textNode.value=textVal;return}textNodeNext=textNode.next;if(textNodeNext){if(textNodeNext.type==3&&textNodeNext.value.length){textNode=textNode.prev;continue}if(!blockElements[textNodeNext.name]&&textNodeNext.name!="script"&&textNodeNext.name!="style"){textNode=textNode.prev;continue}}sibling=textNode.prev;textNode.remove();textNode=sibling}}function cloneAndExcludeBlocks(input){var name,output={};for(name in input){if(name!=="li"&&name!="p"){output[name]=input[name]}}return output}parser=new SaxParser({validate:validate,allow_script_urls:settings.allow_script_urls,allow_conditional_comments:settings.allow_conditional_comments,self_closing_elements:cloneAndExcludeBlocks(schema.getSelfClosingElements()),cdata:function(text){node.append(createNode("#cdata",4)).value=text},text:function(text,raw){var textNode;if(!isInWhiteSpacePreservedElement){text=text.replace(allWhiteSpaceRegExp," ");if(node.lastChild&&blockElements[node.lastChild.name]){text=text.replace(startWhiteSpaceRegExp,"")}}if(text.length!==0){textNode=createNode("#text",3);textNode.raw=!!raw;node.append(textNode).value=text}},comment:function(text){node.append(createNode("#comment",8)).value=text},pi:function(name,text){node.append(createNode(name,7)).value=text;removeWhitespaceBefore(node)},doctype:function(text){var newNode;newNode=node.append(createNode("#doctype",10));newNode.value=text;removeWhitespaceBefore(node)},start:function(name,attrs,empty){var newNode,attrFiltersLen,elementRule,attrName,parent;elementRule=validate?schema.getElementRule(name):{};if(elementRule){newNode=createNode(elementRule.outputName||name,1);newNode.attributes=attrs;newNode.shortEnded=empty;node.append(newNode);parent=children[node.name];if(parent&&children[newNode.name]&&!parent[newNode.name]){invalidChildren.push(newNode)}attrFiltersLen=attributeFilters.length;while(attrFiltersLen--){attrName=attributeFilters[attrFiltersLen].name;if(attrName in attrs.map){list=matchedAttributes[attrName];if(list){list.push(newNode)}else{matchedAttributes[attrName]=[newNode]}}}if(blockElements[name]){removeWhitespaceBefore(newNode)}if(!empty){node=newNode}if(!isInWhiteSpacePreservedElement&&whiteSpaceElements[name]){isInWhiteSpacePreservedElement=true}}},end:function(name){var textNode,elementRule,text,sibling,tempNode;elementRule=validate?schema.getElementRule(name):{};if(elementRule){if(blockElements[name]){if(!isInWhiteSpacePreservedElement){textNode=node.firstChild;if(textNode&&textNode.type===3){text=textNode.value.replace(startWhiteSpaceRegExp,"");if(text.length>0){textNode.value=text;textNode=textNode.next}else{sibling=textNode.next;textNode.remove();textNode=sibling;while(textNode&&textNode.type===3){text=textNode.value;sibling=textNode.next;if(text.length===0||isAllWhiteSpaceRegExp.test(text)){textNode.remove();textNode=sibling}textNode=sibling}}}textNode=node.lastChild;if(textNode&&textNode.type===3){text=textNode.value.replace(endWhiteSpaceRegExp,"");if(text.length>0){textNode.value=text;textNode=textNode.prev}else{sibling=textNode.prev;textNode.remove();textNode=sibling;while(textNode&&textNode.type===3){text=textNode.value;sibling=textNode.prev;if(text.length===0||isAllWhiteSpaceRegExp.test(text)){textNode.remove();textNode=sibling}textNode=sibling}}}}}if(isInWhiteSpacePreservedElement&&whiteSpaceElements[name]){isInWhiteSpacePreservedElement=false}if(elementRule.removeEmpty||elementRule.paddEmpty){if(node.isEmpty(nonEmptyElements)){if(elementRule.paddEmpty){node.empty().append(new Node("#text","3")).value=""}else{if(!node.attributes.map.name&&!node.attributes.map.id){tempNode=node.parent;if(blockElements[node.name]){node.empty().remove()}else{node.unwrap()}node=tempNode;return}}}}node=node.parent}}},schema);rootNode=node=new Node(args.context||settings.root_name,11);parser.parse(html);if(validate&&invalidChildren.length){if(!args.context){fixInvalidChildren(invalidChildren)}else{args.invalid=true}}if(rootBlockName&&(rootNode.name=="body"||args.isRootContent)){addRootBlocks()}if(!args.invalid){for(name in matchedNodes){list=nodeFilters[name];nodes=matchedNodes[name];fi=nodes.length;while(fi--){if(!nodes[fi].parent){nodes.splice(fi,1)}}for(i=0,l=list.length;i<l;i++){list[i](nodes,name,args)}}for(i=0,l=attributeFilters.length;i<l;i++){list=attributeFilters[i];if(list.name in matchedAttributes){nodes=matchedAttributes[list.name];fi=nodes.length;while(fi--){if(!nodes[fi].parent){nodes.splice(fi,1)}}for(fi=0,fl=list.callbacks.length;fi<fl;fi++){list.callbacks[fi](nodes,list.name,args)}}}}return rootNode};if(settings.remove_trailing_brs){self.addNodeFilter("br",function(nodes){var i,l=nodes.length,node,blockElements=extend({},schema.getBlockElements());var nonEmptyElements=schema.getNonEmptyElements(),parent,lastParent,prev,prevName;var elementRule,textNode;blockElements.body=1;for(i=0;i<l;i++){node=nodes[i];parent=node.parent;if(blockElements[node.parent.name]&&node===parent.lastChild){prev=node.prev;while(prev){prevName=prev.name;if(prevName!=="span"||prev.attr("data-mce-type")!=="bookmark"){if(prevName!=="br"){break}if(prevName==="br"){node=null;break}}prev=prev.prev}if(node){node.remove();if(parent.isEmpty(nonEmptyElements)){elementRule=schema.getElementRule(parent.name);if(elementRule){if(elementRule.removeEmpty){parent.remove()}else if(elementRule.paddEmpty){parent.empty().append(new Node("#text",3)).value=""}}}}}else{lastParent=node;while(parent&&parent.firstChild===lastParent&&parent.lastChild===lastParent){lastParent=parent;if(blockElements[parent.name]){break}parent=parent.parent}if(lastParent===parent){textNode=new Node("#text",3);textNode.value="";node.replace(textNode)}}}})}if(!settings.allow_html_in_named_anchor){self.addAttributeFilter("id,name",function(nodes){var i=nodes.length,sibling,prevSibling,parent,node;while(i--){node=nodes[i];if(node.name==="a"&&node.firstChild&&!node.attr("href")){parent=node.parent;sibling=node.lastChild;do{prevSibling=sibling.prev;parent.insert(sibling,node);sibling=prevSibling}while(sibling)}}})}if(settings.validate&&schema.getValidClasses()){self.addAttributeFilter("class",function(nodes){var i=nodes.length,node,classList,ci,className,classValue;var validClasses=schema.getValidClasses(),validClassesMap,valid;while(i--){node=nodes[i];classList=node.attr("class").split(" ");classValue="";for(ci=0;ci<classList.length;ci++){className=classList[ci];valid=false;validClassesMap=validClasses["*"];if(validClassesMap&&validClassesMap[className]){valid=true}validClassesMap=validClasses[node.name];if(!valid&&validClassesMap&&validClassesMap[className]){valid=true}if(valid){if(classValue){classValue+=" "}classValue+=className}}if(!classValue.length){classValue=null}node.attr("class",classValue)}})}}});define("tinymce/html/Writer",["tinymce/html/Entities","tinymce/util/Tools"],function(Entities,Tools){var makeMap=Tools.makeMap;return function(settings){var html=[],indent,indentBefore,indentAfter,encode,htmlOutput;settings=settings||{};indent=settings.indent;indentBefore=makeMap(settings.indent_before||"");indentAfter=makeMap(settings.indent_after||"");encode=Entities.getEncodeFunc(settings.entity_encoding||"raw",settings.entities);htmlOutput=settings.element_format=="html";return{start:function(name,attrs,empty){var i,l,attr,value;if(indent&&indentBefore[name]&&html.length>0){value=html[html.length-1];if(value.length>0&&value!=="\n"){html.push("\n")}}html.push("<",name);if(attrs){for(i=0,l=attrs.length;i<l;i++){attr=attrs[i];html.push(" ",attr.name,'="',encode(attr.value,true),'"')}}if(!empty||htmlOutput){html[html.length]=">"}else{html[html.length]=" />"}if(empty&&indent&&indentAfter[name]&&html.length>0){value=html[html.length-1];if(value.length>0&&value!=="\n"){html.push("\n")}}},end:function(name){var value;html.push("</",name,">");if(indent&&indentAfter[name]&&html.length>0){value=html[html.length-1];if(value.length>0&&value!=="\n"){html.push("\n")}}},text:function(text,raw){if(text.length>0){html[html.length]=raw?text:encode(text)}},cdata:function(text){html.push("<![CDATA[",text,"]]>")},comment:function(text){html.push("<!--",text,"-->")},pi:function(name,text){if(text){html.push("<?",name," ",encode(text),"?>")}else{html.push("<?",name,"?>")}if(indent){html.push("\n")}},doctype:function(text){html.push("<!DOCTYPE",text,">",indent?"\n":"")},reset:function(){html.length=0},getContent:function(){return html.join("").replace(/\n$/,"")}}}});define("tinymce/html/Serializer",["tinymce/html/Writer","tinymce/html/Schema"],function(Writer,Schema){return function(settings,schema){var self=this,writer=new Writer(settings);settings=settings||{};settings.validate="validate"in settings?settings.validate:true;self.schema=schema=schema||new Schema;self.writer=writer;self.serialize=function(node){var handlers,validate;validate=settings.validate;handlers={3:function(node){writer.text(node.value,node.raw)},8:function(node){writer.comment(node.value)},7:function(node){writer.pi(node.name,node.value)},10:function(node){writer.doctype(node.value)},4:function(node){writer.cdata(node.value)},11:function(node){if(node=node.firstChild){do{walk(node)}while(node=node.next)}}};writer.reset();function walk(node){var handler=handlers[node.type],name,isEmpty,attrs,attrName,attrValue,sortedAttrs,i,l,elementRule;if(!handler){name=node.name;isEmpty=node.shortEnded;attrs=node.attributes;if(validate&&attrs&&attrs.length>1){sortedAttrs=[];sortedAttrs.map={};elementRule=schema.getElementRule(node.name);if(elementRule){for(i=0,l=elementRule.attributesOrder.length;i<l;i++){attrName=elementRule.attributesOrder[i];if(attrName in attrs.map){attrValue=attrs.map[attrName];sortedAttrs.map[attrName]=attrValue;sortedAttrs.push({name:attrName,value:attrValue})}}for(i=0,l=attrs.length;i<l;i++){attrName=attrs[i].name;if(!(attrName in sortedAttrs.map)){attrValue=attrs.map[attrName];sortedAttrs.map[attrName]=attrValue;sortedAttrs.push({name:attrName,value:attrValue})}}attrs=sortedAttrs}}writer.start(node.name,attrs,isEmpty);if(!isEmpty){if(node=node.firstChild){do{walk(node)}while(node=node.next)}writer.end(name)}}else{handler(node)}}if(node.type==1&&!settings.inner){walk(node)}else{handlers[11](node)}return writer.getContent()}}});define("tinymce/dom/Serializer",["tinymce/dom/DOMUtils","tinymce/html/DomParser","tinymce/html/SaxParser","tinymce/html/Entities","tinymce/html/Serializer","tinymce/html/Node","tinymce/html/Schema","tinymce/Env","tinymce/util/Tools","tinymce/text/Zwsp"],function(DOMUtils,DomParser,SaxParser,Entities,Serializer,Node,Schema,Env,Tools,Zwsp){var each=Tools.each,trim=Tools.trim;var DOM=DOMUtils.DOM,tempAttrs=["data-mce-selected"];function trimTrailingBr(rootNode){var brNode1,brNode2;function isBr(node){return node&&node.name==="br"}brNode1=rootNode.lastChild;if(isBr(brNode1)){brNode2=brNode1.prev;if(isBr(brNode2)){brNode1.remove();brNode2.remove()}}}return function(settings,editor){var dom,schema,htmlParser;if(editor){dom=editor.dom;schema=editor.schema}function trimHtml(html){var trimContentRegExp=new RegExp(["<span[^>]+data-mce-bogus[^>]+>[\ufeff]+<\\/span>","\\s?("+tempAttrs.join("|")+')="[^"]+"'].join("|"),"gi");html=Zwsp.trim(html.replace(trimContentRegExp,""));return html}function getTrimmedContent(){var content=editor.getBody().innerHTML;var bogusAllRegExp=/<(\w+) [^>]*data-mce-bogus="all"[^>]*>/g;var endTagIndex,index,matchLength,matches,shortEndedElements,schema=editor.schema;content=trimHtml(content);shortEndedElements=schema.getShortEndedElements();while(matches=bogusAllRegExp.exec(content)){index=bogusAllRegExp.lastIndex;matchLength=matches[0].length;if(shortEndedElements[matches[1]]){endTagIndex=index}else{endTagIndex=SaxParser.findEndTag(schema,content,index)}content=content.substring(0,index-matchLength)+content.substring(endTagIndex);bogusAllRegExp.lastIndex=index-matchLength}return trim(content)}function addTempAttr(name){if(Tools.inArray(tempAttrs,name)===-1){htmlParser.addAttributeFilter(name,function(nodes,name){var i=nodes.length;while(i--){nodes[i].attr(name,null)}});tempAttrs.push(name)}}dom=dom||DOM;schema=schema||new Schema(settings);settings.entity_encoding=settings.entity_encoding||"named";settings.remove_trailing_brs="remove_trailing_brs"in settings?settings.remove_trailing_brs:true;htmlParser=new DomParser(settings,schema);htmlParser.addAttributeFilter("data-mce-tabindex",function(nodes,name){var i=nodes.length,node;while(i--){node=nodes[i];node.attr("tabindex",node.attributes.map["data-mce-tabindex"]);node.attr(name,null)}});htmlParser.addAttributeFilter("src,href,style",function(nodes,name){var i=nodes.length,node,value,internalName="data-mce-"+name;var urlConverter=settings.url_converter,urlConverterScope=settings.url_converter_scope,undef;while(i--){node=nodes[i];value=node.attributes.map[internalName];if(value!==undef){node.attr(name,value.length>0?value:null);node.attr(internalName,null)}else{value=node.attributes.map[name];if(name==="style"){value=dom.serializeStyle(dom.parseStyle(value),node.name)}else if(urlConverter){value=urlConverter.call(urlConverterScope,value,name,node.name)}node.attr(name,value.length>0?value:null)}}});htmlParser.addAttributeFilter("class",function(nodes){var i=nodes.length,node,value;while(i--){node=nodes[i];value=node.attr("class");if(value){value=node.attr("class").replace(/(?:^|\s)mce-item-\w+(?!\S)/g,"");node.attr("class",value.length>0?value:null)}}});htmlParser.addAttributeFilter("data-mce-type",function(nodes,name,args){var i=nodes.length,node;while(i--){node=nodes[i];if(node.attributes.map["data-mce-type"]==="bookmark"&&!args.cleanup){node.remove()}}});htmlParser.addNodeFilter("noscript",function(nodes){var i=nodes.length,node;while(i--){node=nodes[i].firstChild;if(node){node.value=Entities.decode(node.value)}}});htmlParser.addNodeFilter("script,style",function(nodes,name){var i=nodes.length,node,value,type;function trim(value){return value.replace(/(<!--\[CDATA\[|\]\]-->)/g,"\n").replace(/^[\r\n]*|[\r\n]*$/g,"").replace(/^\s*((<!--)?(\s*\/\/)?\s*<!\[CDATA\[|(<!--\s*)?\/\*\s*<!\[CDATA\[\s*\*\/|(\/\/)?\s*<!--|\/\*\s*<!--\s*\*\/)\s*[\r\n]*/gi,"").replace(/\s*(\/\*\s*\]\]>\s*\*\/(-->)?|\s*\/\/\s*\]\]>(-->)?|\/\/\s*(-->)?|\]\]>|\/\*\s*-->\s*\*\/|\s*-->\s*)\s*$/g,"")}while(i--){node=nodes[i];value=node.firstChild?node.firstChild.value:"";if(name==="script"){type=node.attr("type");if(type){node.attr("type",type=="mce-no/type"?null:type.replace(/^mce\-/,""))}if(value.length>0){node.firstChild.value="// <![CDATA[\n"+trim(value)+"\n// ]]>"}}else{if(value.length>0){node.firstChild.value="<!--\n"+trim(value)+"\n-->"}}}});htmlParser.addNodeFilter("#comment",function(nodes){var i=nodes.length,node;while(i--){node=nodes[i];if(node.value.indexOf("[CDATA[")===0){node.name="#cdata";node.type=4;node.value=node.value.replace(/^\[CDATA\[|\]\]$/g,"")}else if(node.value.indexOf("mce:protected ")===0){node.name="#text";node.type=3;node.raw=true;node.value=unescape(node.value).substr(14)}}});htmlParser.addNodeFilter("xml:namespace,input",function(nodes,name){var i=nodes.length,node;while(i--){node=nodes[i];if(node.type===7){node.remove()}else if(node.type===1){if(name==="input"&&!("type"in node.attributes.map)){node.attr("type","text")}}}});if(settings.fix_list_elements){htmlParser.addNodeFilter("ul,ol",function(nodes){var i=nodes.length,node,parentNode;while(i--){node=nodes[i];parentNode=node.parent;if(parentNode.name==="ul"||parentNode.name==="ol"){if(node.prev&&node.prev.name==="li"){node.prev.append(node)}}}})}htmlParser.addAttributeFilter("data-mce-src,data-mce-href,data-mce-style,"+"data-mce-selected,data-mce-expando,"+"data-mce-type,data-mce-resize",function(nodes,name){var i=nodes.length;while(i--){nodes[i].attr(name,null)}});return{schema:schema,addNodeFilter:htmlParser.addNodeFilter,addAttributeFilter:htmlParser.addAttributeFilter,serialize:function(node,args){var self=this,impl,doc,oldDoc,htmlSerializer,content,rootNode;if(Env.ie&&dom.select("script,style,select,map").length>0){content=node.innerHTML;node=node.cloneNode(false);dom.setHTML(node,content)}else{node=node.cloneNode(true)}impl=node.ownerDocument.implementation;if(impl.createHTMLDocument){doc=impl.createHTMLDocument("");each(node.nodeName=="BODY"?node.childNodes:[node],function(node){doc.body.appendChild(doc.importNode(node,true))});if(node.nodeName!="BODY"){node=doc.body.firstChild}else{node=doc.body}oldDoc=dom.doc;dom.doc=doc}args=args||{};args.format=args.format||"html";if(args.selection){args.forced_root_block=""}if(!args.no_events){args.node=node;self.onPreProcess(args)}rootNode=htmlParser.parse(trim(args.getInner?node.innerHTML:dom.getOuterHTML(node)),args);trimTrailingBr(rootNode);htmlSerializer=new Serializer(settings,schema);args.content=htmlSerializer.serialize(rootNode);if(!args.cleanup){args.content=Zwsp.trim(args.content);args.content=args.content.replace(/\uFEFF/g,"")}if(!args.no_events){self.onPostProcess(args)}if(oldDoc){dom.doc=oldDoc}args.node=null;return args.content},addRules:function(rules){schema.addValidElements(rules)},setRules:function(rules){schema.setValidElements(rules)},onPreProcess:function(args){if(editor){editor.fire("PreProcess",args)}},onPostProcess:function(args){if(editor){editor.fire("PostProcess",args)}},addTempAttr:addTempAttr,trimHtml:trimHtml,getTrimmedContent:getTrimmedContent}}});define("tinymce/dom/TridentSelection",[],function(){function Selection(selection){var self=this,dom=selection.dom,FALSE=false;function getPosition(rng,start){var checkRng,startIndex=0,endIndex,inside,children,child,offset,index,position=-1,parent;checkRng=rng.duplicate();checkRng.collapse(start);parent=checkRng.parentElement();if(parent.ownerDocument!==selection.dom.doc){return}while(parent.contentEditable==="false"){parent=parent.parentNode}if(!parent.hasChildNodes()){return{node:parent,inside:1}}children=parent.children;endIndex=children.length-1;while(startIndex<=endIndex){index=Math.floor((startIndex+endIndex)/2);child=children[index];checkRng.moveToElementText(child);position=checkRng.compareEndPoints(start?"StartToStart":"EndToEnd",rng);if(position>0){endIndex=index-1}else if(position<0){startIndex=index+1}else{return{node:child}}}if(position<0){if(!child){checkRng.moveToElementText(parent);checkRng.collapse(true);child=parent;inside=true}else{checkRng.collapse(false)}offset=0;while(checkRng.compareEndPoints(start?"StartToStart":"StartToEnd",rng)!==0){if(checkRng.move("character",1)===0||parent!=checkRng.parentElement()){break}offset++}}else{checkRng.collapse(true);offset=0;while(checkRng.compareEndPoints(start?"StartToStart":"StartToEnd",rng)!==0){if(checkRng.move("character",-1)===0||parent!=checkRng.parentElement()){break}offset++}}return{node:child,position:position,offset:offset,inside:inside}}function getRange(){var ieRange=selection.getRng(),domRange=dom.createRng(),element,collapsed,tmpRange,element2,bookmark;element=ieRange.item?ieRange.item(0):ieRange.parentElement();if(element.ownerDocument!=dom.doc){return domRange}collapsed=selection.isCollapsed();if(ieRange.item){domRange.setStart(element.parentNode,dom.nodeIndex(element));domRange.setEnd(domRange.startContainer,domRange.startOffset+1);return domRange}function findEndPoint(start){var endPoint=getPosition(ieRange,start),container,offset,textNodeOffset=0,sibling,undef,nodeValue;container=endPoint.node;offset=endPoint.offset;if(endPoint.inside&&!container.hasChildNodes()){domRange[start?"setStart":"setEnd"](container,0);return}if(offset===undef){domRange[start?"setStartBefore":"setEndAfter"](container);return}if(endPoint.position<0){sibling=endPoint.inside?container.firstChild:container.nextSibling;if(!sibling){domRange[start?"setStartAfter":"setEndAfter"](container);return}if(!offset){if(sibling.nodeType==3){domRange[start?"setStart":"setEnd"](sibling,0)}else{domRange[start?"setStartBefore":"setEndBefore"](sibling)}return}while(sibling){if(sibling.nodeType==3){nodeValue=sibling.nodeValue;textNodeOffset+=nodeValue.length;if(textNodeOffset>=offset){container=sibling;textNodeOffset-=offset;textNodeOffset=nodeValue.length-textNodeOffset;break}}sibling=sibling.nextSibling}}else{sibling=container.previousSibling;if(!sibling){return domRange[start?"setStartBefore":"setEndBefore"](container)}if(!offset){if(container.nodeType==3){domRange[start?"setStart":"setEnd"](sibling,container.nodeValue.length)}else{domRange[start?"setStartAfter":"setEndAfter"](sibling)}return}while(sibling){if(sibling.nodeType==3){textNodeOffset+=sibling.nodeValue.length;if(textNodeOffset>=offset){container=sibling;textNodeOffset-=offset;break}}sibling=sibling.previousSibling}}domRange[start?"setStart":"setEnd"](container,textNodeOffset)}try{findEndPoint(true);if(!collapsed){findEndPoint()}}catch(ex){if(ex.number==-2147024809){bookmark=self.getBookmark(2);tmpRange=ieRange.duplicate();tmpRange.collapse(true);element=tmpRange.parentElement();if(!collapsed){tmpRange=ieRange.duplicate();tmpRange.collapse(false);element2=tmpRange.parentElement();element2.innerHTML=element2.innerHTML}element.innerHTML=element.innerHTML;self.moveToBookmark(bookmark);ieRange=selection.getRng();findEndPoint(true);if(!collapsed){findEndPoint()}}else{throw ex}}return domRange}this.getBookmark=function(type){var rng=selection.getRng(),bookmark={};function getIndexes(node){var parent,root,children,i,indexes=[];parent=node.parentNode;root=dom.getRoot().parentNode;while(parent!=root&&parent.nodeType!==9){children=parent.children;i=children.length;while(i--){if(node===children[i]){indexes.push(i);break}}node=parent;parent=parent.parentNode}return indexes}function getBookmarkEndPoint(start){var position;position=getPosition(rng,start);if(position){return{position:position.position,offset:position.offset,indexes:getIndexes(position.node),inside:position.inside}}}if(type===2){if(!rng.item){bookmark.start=getBookmarkEndPoint(true);if(!selection.isCollapsed()){bookmark.end=getBookmarkEndPoint()}}else{bookmark.start={ctrl:true,indexes:getIndexes(rng.item(0))}}}return bookmark};this.moveToBookmark=function(bookmark){var rng,body=dom.doc.body;function resolveIndexes(indexes){var node,i,idx,children;node=dom.getRoot();for(i=indexes.length-1;i>=0;i--){children=node.children;idx=indexes[i];if(idx<=children.length-1){node=children[idx]}}return node}function setBookmarkEndPoint(start){var endPoint=bookmark[start?"start":"end"],moveLeft,moveRng,undef,offset;if(endPoint){moveLeft=endPoint.position>0;moveRng=body.createTextRange();moveRng.moveToElementText(resolveIndexes(endPoint.indexes));offset=endPoint.offset;if(offset!==undef){moveRng.collapse(endPoint.inside||moveLeft);moveRng.moveStart("character",moveLeft?-offset:offset)}else{moveRng.collapse(start)}rng.setEndPoint(start?"StartToStart":"EndToStart",moveRng);if(start){rng.collapse(true)}}}if(bookmark.start){if(bookmark.start.ctrl){rng=body.createControlRange();rng.addElement(resolveIndexes(bookmark.start.indexes));rng.select()}else{rng=body.createTextRange();setBookmarkEndPoint(true);setBookmarkEndPoint();rng.select()}}};this.addRange=function(rng){var ieRng,ctrlRng,startContainer,startOffset,endContainer,endOffset,sibling,doc=selection.dom.doc,body=doc.body,nativeRng,ctrlElm;function setEndPoint(start){var container,offset,marker,tmpRng,nodes;marker=dom.create("a");container=start?startContainer:endContainer;offset=start?startOffset:endOffset;tmpRng=ieRng.duplicate();if(container==doc||container==doc.documentElement){container=body;offset=0}if(container.nodeType==3){container.parentNode.insertBefore(marker,container);tmpRng.moveToElementText(marker);tmpRng.moveStart("character",offset);dom.remove(marker);ieRng.setEndPoint(start?"StartToStart":"EndToEnd",tmpRng)}else{nodes=container.childNodes;if(nodes.length){if(offset>=nodes.length){dom.insertAfter(marker,nodes[nodes.length-1])}else{container.insertBefore(marker,nodes[offset])}tmpRng.moveToElementText(marker)}else if(container.canHaveHTML){container.innerHTML="<span>&#xFEFF;</span>";marker=container.firstChild;tmpRng.moveToElementText(marker);tmpRng.collapse(FALSE)}ieRng.setEndPoint(start?"StartToStart":"EndToEnd",tmpRng);dom.remove(marker)}}startContainer=rng.startContainer;startOffset=rng.startOffset;endContainer=rng.endContainer;
endOffset=rng.endOffset;ieRng=body.createTextRange();if(startContainer==endContainer&&startContainer.nodeType==1){if(startOffset==endOffset&&!startContainer.hasChildNodes()){if(startContainer.canHaveHTML){sibling=startContainer.previousSibling;if(sibling&&!sibling.hasChildNodes()&&dom.isBlock(sibling)){sibling.innerHTML="&#xFEFF;"}else{sibling=null}startContainer.innerHTML="<span>&#xFEFF;</span><span>&#xFEFF;</span>";ieRng.moveToElementText(startContainer.lastChild);ieRng.select();dom.doc.selection.clear();startContainer.innerHTML="";if(sibling){sibling.innerHTML=""}return}startOffset=dom.nodeIndex(startContainer);startContainer=startContainer.parentNode}if(startOffset==endOffset-1){try{ctrlElm=startContainer.childNodes[startOffset];ctrlRng=body.createControlRange();ctrlRng.addElement(ctrlElm);ctrlRng.select();nativeRng=selection.getRng();if(nativeRng.item&&ctrlElm===nativeRng.item(0)){return}}catch(ex){}}}setEndPoint(true);setEndPoint();ieRng.select()};this.getRangeAt=getRange}return Selection});define("tinymce/util/VK",["tinymce/Env"],function(Env){return{BACKSPACE:8,DELETE:46,DOWN:40,ENTER:13,LEFT:37,RIGHT:39,SPACEBAR:32,TAB:9,UP:38,modifierPressed:function(e){return e.shiftKey||e.ctrlKey||e.altKey||this.metaKeyPressed(e)},metaKeyPressed:function(e){return Env.mac?e.metaKey:e.ctrlKey&&!e.altKey}}});define("tinymce/dom/ControlSelection",["tinymce/util/VK","tinymce/util/Tools","tinymce/util/Delay","tinymce/Env","tinymce/dom/NodeType"],function(VK,Tools,Delay,Env,NodeType){var isContentEditableFalse=NodeType.isContentEditableFalse;return function(selection,editor){var dom=editor.dom,each=Tools.each;var selectedElm,selectedElmGhost,resizeHelper,resizeHandles,selectedHandle,lastMouseDownEvent;var startX,startY,selectedElmX,selectedElmY,startW,startH,ratio,resizeStarted;var width,height,editableDoc=editor.getDoc(),rootDocument=document,isIE=Env.ie&&Env.ie<11;var abs=Math.abs,round=Math.round,rootElement=editor.getBody(),startScrollWidth,startScrollHeight;resizeHandles={nw:[0,0,-1,-1],ne:[1,0,1,-1],se:[1,1,1,1],sw:[0,1,-1,1]};var rootClass=".mce-content-body";editor.contentStyles.push(rootClass+" div.mce-resizehandle {"+"position: absolute;"+"border: 1px solid black;"+"box-sizing: box-sizing;"+"background: #FFF;"+"width: 7px;"+"height: 7px;"+"z-index: 10000"+"}"+rootClass+" .mce-resizehandle:hover {"+"background: #000"+"}"+rootClass+" img[data-mce-selected],"+rootClass+" hr[data-mce-selected] {"+"outline: 1px solid black;"+"resize: none"+"}"+rootClass+" .mce-clonedresizable {"+"position: absolute;"+(Env.gecko?"":"outline: 1px dashed black;")+"opacity: .5;"+"filter: alpha(opacity=50);"+"z-index: 10000"+"}"+rootClass+" .mce-resize-helper {"+"background: #555;"+"background: rgba(0,0,0,0.75);"+"border-radius: 3px;"+"border: 1px;"+"color: white;"+"display: none;"+"font-family: sans-serif;"+"font-size: 12px;"+"white-space: nowrap;"+"line-height: 14px;"+"margin: 5px 10px;"+"padding: 5px;"+"position: absolute;"+"z-index: 10001"+"}");function isResizable(elm){var selector=editor.settings.object_resizing;if(selector===false||Env.iOS){return false}if(typeof selector!="string"){selector="table,img,div"}if(elm.getAttribute("data-mce-resize")==="false"){return false}if(elm==editor.getBody()){return false}return editor.dom.is(elm,selector)}function resizeGhostElement(e){var deltaX,deltaY,proportional;var resizeHelperX,resizeHelperY;deltaX=e.screenX-startX;deltaY=e.screenY-startY;width=deltaX*selectedHandle[2]+startW;height=deltaY*selectedHandle[3]+startH;width=width<5?5:width;height=height<5?5:height;if(selectedElm.nodeName=="IMG"&&editor.settings.resize_img_proportional!==false){proportional=!VK.modifierPressed(e)}else{proportional=VK.modifierPressed(e)||selectedElm.nodeName=="IMG"&&selectedHandle[2]*selectedHandle[3]!==0}if(proportional){if(abs(deltaX)>abs(deltaY)){height=round(width*ratio);width=round(height/ratio)}else{width=round(height/ratio);height=round(width*ratio)}}dom.setStyles(selectedElmGhost,{width:width,height:height});resizeHelperX=selectedHandle.startPos.x+deltaX;resizeHelperY=selectedHandle.startPos.y+deltaY;resizeHelperX=resizeHelperX>0?resizeHelperX:0;resizeHelperY=resizeHelperY>0?resizeHelperY:0;dom.setStyles(resizeHelper,{left:resizeHelperX,top:resizeHelperY,display:"block"});resizeHelper.innerHTML=width+" &times; "+height;if(selectedHandle[2]<0&&selectedElmGhost.clientWidth<=width){dom.setStyle(selectedElmGhost,"left",selectedElmX+(startW-width))}if(selectedHandle[3]<0&&selectedElmGhost.clientHeight<=height){dom.setStyle(selectedElmGhost,"top",selectedElmY+(startH-height))}deltaX=rootElement.scrollWidth-startScrollWidth;deltaY=rootElement.scrollHeight-startScrollHeight;if(deltaX+deltaY!==0){dom.setStyles(resizeHelper,{left:resizeHelperX-deltaX,top:resizeHelperY-deltaY})}if(!resizeStarted){editor.fire("ObjectResizeStart",{target:selectedElm,width:startW,height:startH});resizeStarted=true}}function endGhostResize(){resizeStarted=false;function setSizeProp(name,value){if(value){if(selectedElm.style[name]||!editor.schema.isValid(selectedElm.nodeName.toLowerCase(),name)){dom.setStyle(selectedElm,name,value)}else{dom.setAttrib(selectedElm,name,value)}}}setSizeProp("width",width);setSizeProp("height",height);dom.unbind(editableDoc,"mousemove",resizeGhostElement);dom.unbind(editableDoc,"mouseup",endGhostResize);if(rootDocument!=editableDoc){dom.unbind(rootDocument,"mousemove",resizeGhostElement);dom.unbind(rootDocument,"mouseup",endGhostResize)}dom.remove(selectedElmGhost);dom.remove(resizeHelper);if(!isIE||selectedElm.nodeName=="TABLE"){showResizeRect(selectedElm)}editor.fire("ObjectResized",{target:selectedElm,width:width,height:height});dom.setAttrib(selectedElm,"style",dom.getAttrib(selectedElm,"style"));editor.nodeChanged()}function showResizeRect(targetElm,mouseDownHandleName,mouseDownEvent){var position,targetWidth,targetHeight,e,rect;hideResizeRect();unbindResizeHandleEvents();position=dom.getPos(targetElm,rootElement);selectedElmX=position.x;selectedElmY=position.y;rect=targetElm.getBoundingClientRect();targetWidth=rect.width||rect.right-rect.left;targetHeight=rect.height||rect.bottom-rect.top;if(selectedElm!=targetElm){detachResizeStartListener();selectedElm=targetElm;width=height=0}e=editor.fire("ObjectSelected",{target:targetElm});if(isResizable(targetElm)&&!e.isDefaultPrevented()){each(resizeHandles,function(handle,name){var handleElm;function startDrag(e){startX=e.screenX;startY=e.screenY;startW=selectedElm.clientWidth;startH=selectedElm.clientHeight;ratio=startH/startW;selectedHandle=handle;handle.startPos={x:targetWidth*handle[0]+selectedElmX,y:targetHeight*handle[1]+selectedElmY};startScrollWidth=rootElement.scrollWidth;startScrollHeight=rootElement.scrollHeight;selectedElmGhost=selectedElm.cloneNode(true);dom.addClass(selectedElmGhost,"mce-clonedresizable");dom.setAttrib(selectedElmGhost,"data-mce-bogus","all");selectedElmGhost.contentEditable=false;selectedElmGhost.unSelectabe=true;dom.setStyles(selectedElmGhost,{left:selectedElmX,top:selectedElmY,margin:0});selectedElmGhost.removeAttribute("data-mce-selected");rootElement.appendChild(selectedElmGhost);dom.bind(editableDoc,"mousemove",resizeGhostElement);dom.bind(editableDoc,"mouseup",endGhostResize);if(rootDocument!=editableDoc){dom.bind(rootDocument,"mousemove",resizeGhostElement);dom.bind(rootDocument,"mouseup",endGhostResize)}resizeHelper=dom.add(rootElement,"div",{class:"mce-resize-helper","data-mce-bogus":"all"},startW+" &times; "+startH)}if(mouseDownHandleName){if(name==mouseDownHandleName){startDrag(mouseDownEvent)}return}handleElm=dom.get("mceResizeHandle"+name);if(handleElm){dom.remove(handleElm)}handleElm=dom.add(rootElement,"div",{id:"mceResizeHandle"+name,"data-mce-bogus":"all",class:"mce-resizehandle",unselectable:true,style:"cursor:"+name+"-resize; margin:0; padding:0"});if(Env.ie){handleElm.contentEditable=false}dom.bind(handleElm,"mousedown",function(e){e.stopImmediatePropagation();e.preventDefault();startDrag(e)});handle.elm=handleElm;dom.setStyles(handleElm,{left:targetWidth*handle[0]+selectedElmX-handleElm.offsetWidth/2,top:targetHeight*handle[1]+selectedElmY-handleElm.offsetHeight/2})})}else{hideResizeRect()}selectedElm.setAttribute("data-mce-selected","1")}function hideResizeRect(){var name,handleElm;unbindResizeHandleEvents();if(selectedElm){selectedElm.removeAttribute("data-mce-selected")}for(name in resizeHandles){handleElm=dom.get("mceResizeHandle"+name);if(handleElm){dom.unbind(handleElm);dom.remove(handleElm)}}}function updateResizeRect(e){var startElm,controlElm;function isChildOrEqual(node,parent){if(node){do{if(node===parent){return true}}while(node=node.parentNode)}}if(resizeStarted||editor.removed){return}each(dom.select("img[data-mce-selected],hr[data-mce-selected]"),function(img){img.removeAttribute("data-mce-selected")});controlElm=e.type=="mousedown"?e.target:selection.getNode();controlElm=dom.$(controlElm).closest(isIE?"table":"table,img,hr")[0];if(isChildOrEqual(controlElm,rootElement)){disableGeckoResize();startElm=selection.getStart(true);if(isChildOrEqual(startElm,controlElm)&&isChildOrEqual(selection.getEnd(true),controlElm)){if(!isIE||controlElm!=startElm&&startElm.nodeName!=="IMG"){showResizeRect(controlElm);return}}}hideResizeRect()}function attachEvent(elm,name,func){if(elm&&elm.attachEvent){elm.attachEvent("on"+name,func)}}function detachEvent(elm,name,func){if(elm&&elm.detachEvent){elm.detachEvent("on"+name,func)}}function resizeNativeStart(e){var target=e.srcElement,pos,name,corner,cornerX,cornerY,relativeX,relativeY;pos=target.getBoundingClientRect();relativeX=lastMouseDownEvent.clientX-pos.left;relativeY=lastMouseDownEvent.clientY-pos.top;for(name in resizeHandles){corner=resizeHandles[name];cornerX=target.offsetWidth*corner[0];cornerY=target.offsetHeight*corner[1];if(abs(cornerX-relativeX)<8&&abs(cornerY-relativeY)<8){selectedHandle=corner;break}}resizeStarted=true;editor.fire("ObjectResizeStart",{target:selectedElm,width:selectedElm.clientWidth,height:selectedElm.clientHeight});editor.getDoc().selection.empty();showResizeRect(target,name,lastMouseDownEvent)}function preventDefault(e){if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}}function nativeControlSelect(e){var target=e.srcElement;if(isContentEditableFalse(target)){preventDefault(e);return}if(target!=selectedElm){editor.fire("ObjectSelected",{target:target});detachResizeStartListener();if(target.id.indexOf("mceResizeHandle")===0){e.returnValue=false;return}if(target.nodeName=="IMG"||target.nodeName=="TABLE"){hideResizeRect();selectedElm=target;attachEvent(target,"resizestart",resizeNativeStart)}}}function detachResizeStartListener(){detachEvent(selectedElm,"resizestart",resizeNativeStart)}function unbindResizeHandleEvents(){for(var name in resizeHandles){var handle=resizeHandles[name];if(handle.elm){dom.unbind(handle.elm);delete handle.elm}}}function disableGeckoResize(){try{editor.getDoc().execCommand("enableObjectResizing",false,false)}catch(ex){}}function controlSelect(elm){var ctrlRng;if(!isIE){return}ctrlRng=editableDoc.body.createControlRange();try{ctrlRng.addElement(elm);ctrlRng.select();return true}catch(ex){}}editor.on("init",function(){if(isIE){editor.on("ObjectResized",function(e){if(e.target.nodeName!="TABLE"){hideResizeRect();controlSelect(e.target)}});attachEvent(rootElement,"controlselect",nativeControlSelect);editor.on("mousedown",function(e){lastMouseDownEvent=e})}else{disableGeckoResize();if(Env.ie>=11){editor.on("mousedown click",function(e){var nodeName=e.target.nodeName;if(!resizeStarted&&/^(TABLE|IMG|HR)$/.test(nodeName)){editor.selection.select(e.target,nodeName=="TABLE");if(e.type=="mousedown"){editor.nodeChanged()}}});editor.dom.bind(rootElement,"mscontrolselect",function(e){function delayedSelect(node){Delay.setEditorTimeout(editor,function(){editor.selection.select(node)})}if(isContentEditableFalse(e.target)){e.preventDefault();delayedSelect(e.target);return}if(/^(TABLE|IMG|HR)$/.test(e.target.nodeName)){e.preventDefault();if(e.target.tagName=="IMG"){delayedSelect(e.target)}}})}}var throttledUpdateResizeRect=Delay.throttle(function(e){if(!editor.composing){updateResizeRect(e)}});editor.on("nodechange ResizeEditor ResizeWindow drop",throttledUpdateResizeRect);editor.on("keyup compositionend",function(e){if(selectedElm&&selectedElm.nodeName=="TABLE"){throttledUpdateResizeRect(e)}});editor.on("hide blur",hideResizeRect)});editor.on("remove",unbindResizeHandleEvents);function destroy(){selectedElm=selectedElmGhost=null;if(isIE){detachResizeStartListener();detachEvent(rootElement,"controlselect",nativeControlSelect)}}return{isResizable:isResizable,showResizeRect:showResizeRect,hideResizeRect:hideResizeRect,updateResizeRect:updateResizeRect,controlSelect:controlSelect,destroy:destroy}}});define("tinymce/util/Fun",[],function(){var slice=[].slice;function constant(value){return function(){return value}}function negate(predicate){return function(x){return!predicate(x)}}function compose(f,g){return function(x){return f(g(x))}}function or(){var args=slice.call(arguments);return function(x){for(var i=0;i<args.length;i++){if(args[i](x)){return true}}return false}}function and(){var args=slice.call(arguments);return function(x){for(var i=0;i<args.length;i++){if(!args[i](x)){return false}}return true}}function curry(fn){var args=slice.call(arguments);if(args.length-1>=fn.length){return fn.apply(this,args.slice(1))}return function(){var tempArgs=args.concat([].slice.call(arguments));return curry.apply(this,tempArgs)}}return{constant:constant,negate:negate,and:and,or:or,curry:curry,compose:compose}});define("tinymce/caret/CaretCandidate",["tinymce/dom/NodeType","tinymce/util/Arr","tinymce/caret/CaretContainer"],function(NodeType,Arr,CaretContainer){var isContentEditableTrue=NodeType.isContentEditableTrue,isContentEditableFalse=NodeType.isContentEditableFalse,isBr=NodeType.isBr,isText=NodeType.isText,isInvalidTextElement=NodeType.matchNodeNames("script style textarea"),isAtomicInline=NodeType.matchNodeNames("img input textarea hr iframe video audio object"),isTable=NodeType.matchNodeNames("table"),isCaretContainer=CaretContainer.isCaretContainer;function isCaretCandidate(node){if(isCaretContainer(node)){return false}if(isText(node)){if(isInvalidTextElement(node.parentNode)){return false}return true}return isAtomicInline(node)||isBr(node)||isTable(node)||isContentEditableFalse(node)}function isInEditable(node,rootNode){for(node=node.parentNode;node&&node!=rootNode;node=node.parentNode){if(isContentEditableFalse(node)){return false}if(isContentEditableTrue(node)){return true}}return true}function isAtomicContentEditableFalse(node){if(!isContentEditableFalse(node)){return false}return Arr.reduce(node.getElementsByTagName("*"),function(result,elm){return result||isContentEditableTrue(elm)},false)!==true}function isAtomic(node){return isAtomicInline(node)||isAtomicContentEditableFalse(node)}function isEditableCaretCandidate(node,rootNode){return isCaretCandidate(node)&&isInEditable(node,rootNode)}return{isCaretCandidate:isCaretCandidate,isInEditable:isInEditable,isAtomic:isAtomic,isEditableCaretCandidate:isEditableCaretCandidate}});define("tinymce/geom/ClientRect",[],function(){var round=Math.round;function clone(rect){if(!rect){return{left:0,top:0,bottom:0,right:0,width:0,height:0}}return{left:round(rect.left),top:round(rect.top),bottom:round(rect.bottom),right:round(rect.right),width:round(rect.width),height:round(rect.height)}}function collapse(clientRect,toStart){clientRect=clone(clientRect);if(toStart){clientRect.right=clientRect.left}else{clientRect.left=clientRect.left+clientRect.width;clientRect.right=clientRect.left}clientRect.width=0;return clientRect}function isEqual(rect1,rect2){return rect1.left===rect2.left&&rect1.top===rect2.top&&rect1.bottom===rect2.bottom&&rect1.right===rect2.right}function isValidOverflow(overflowY,clientRect1,clientRect2){return overflowY>=0&&overflowY<=Math.min(clientRect1.height,clientRect2.height)/2}function isAbove(clientRect1,clientRect2){if(clientRect1.bottom<clientRect2.top){return true}if(clientRect1.top>clientRect2.bottom){return false}return isValidOverflow(clientRect2.top-clientRect1.bottom,clientRect1,clientRect2)}function isBelow(clientRect1,clientRect2){if(clientRect1.top>clientRect2.bottom){return true}if(clientRect1.bottom<clientRect2.top){return false}return isValidOverflow(clientRect2.bottom-clientRect1.top,clientRect1,clientRect2)}function isLeft(clientRect1,clientRect2){return clientRect1.left<clientRect2.left}function isRight(clientRect1,clientRect2){return clientRect1.right>clientRect2.right}function compare(clientRect1,clientRect2){if(isAbove(clientRect1,clientRect2)){return-1}if(isBelow(clientRect1,clientRect2)){return 1}if(isLeft(clientRect1,clientRect2)){return-1}if(isRight(clientRect1,clientRect2)){return 1}return 0}function containsXY(clientRect,clientX,clientY){return clientX>=clientRect.left&&clientX<=clientRect.right&&clientY>=clientRect.top&&clientY<=clientRect.bottom}return{clone:clone,collapse:collapse,isEqual:isEqual,isAbove:isAbove,isBelow:isBelow,isLeft:isLeft,isRight:isRight,compare:compare,containsXY:containsXY}});define("tinymce/text/ExtendingChar",[],function(){var extendingChars=new RegExp("[-------"+"-------"+"-------"+"-----"+"------"+"----"+"-----"+"-----"+"-----"+"-------"+"--------"+"-------"+"-------"+"-----"+"-------"+"-------"+"--------"+"--------"+"------"+"------"+"----]");function isExtendingChar(ch){return typeof ch=="string"&&ch.charCodeAt(0)>=768&&extendingChars.test(ch)}return{isExtendingChar:isExtendingChar}});define("tinymce/caret/CaretPosition",["tinymce/util/Fun","tinymce/dom/NodeType","tinymce/dom/DOMUtils","tinymce/dom/RangeUtils","tinymce/caret/CaretCandidate","tinymce/geom/ClientRect","tinymce/text/ExtendingChar"],function(Fun,NodeType,DOMUtils,RangeUtils,CaretCandidate,ClientRect,ExtendingChar){var isElement=NodeType.isElement,isCaretCandidate=CaretCandidate.isCaretCandidate,isBlock=NodeType.matchStyleValues("display","block table"),isFloated=NodeType.matchStyleValues("float","left right"),isValidElementCaretCandidate=Fun.and(isElement,isCaretCandidate,Fun.negate(isFloated)),isNotPre=Fun.negate(NodeType.matchStyleValues("white-space","pre pre-line pre-wrap")),isText=NodeType.isText,isBr=NodeType.isBr,nodeIndex=DOMUtils.nodeIndex,resolveIndex=RangeUtils.getNode;function isWhiteSpace(chr){return chr&&/[\r\n\t ]/.test(chr)}function isHiddenWhiteSpaceRange(range){var container=range.startContainer,offset=range.startOffset,text;if(isWhiteSpace(range.toString())&&isNotPre(container.parentNode)){text=container.data;if(isWhiteSpace(text[offset-1])||isWhiteSpace(text[offset+1])){return true}}return false}function getCaretPositionClientRects(caretPosition){var clientRects=[],beforeNode,node;function getBrClientRect(brNode){var doc=brNode.ownerDocument,rng=doc.createRange(),nbsp=doc.createTextNode(""),parentNode=brNode.parentNode,clientRect;parentNode.insertBefore(nbsp,brNode);rng.setStart(nbsp,0);rng.setEnd(nbsp,1);clientRect=ClientRect.clone(rng.getBoundingClientRect());parentNode.removeChild(nbsp);return clientRect}function getBoundingClientRect(item){var clientRect,clientRects;clientRects=item.getClientRects();if(clientRects.length>0){clientRect=ClientRect.clone(clientRects[0])}else{clientRect=ClientRect.clone(item.getBoundingClientRect())}if(isBr(item)&&clientRect.left===0){return getBrClientRect(item)}return clientRect}function collapseAndInflateWidth(clientRect,toStart){clientRect=ClientRect.collapse(clientRect,toStart);clientRect.width=1;clientRect.right=clientRect.left+1;return clientRect}function addUniqueAndValidRect(clientRect){if(clientRect.height===0){return}if(clientRects.length>0){if(ClientRect.isEqual(clientRect,clientRects[clientRects.length-1])){return}}clientRects.push(clientRect)}function addCharacterOffset(container,offset){var range=container.ownerDocument.createRange();if(offset<container.data.length){if(ExtendingChar.isExtendingChar(container.data[offset])){return clientRects}if(ExtendingChar.isExtendingChar(container.data[offset-1])){range.setStart(container,offset);range.setEnd(container,offset+1);if(!isHiddenWhiteSpaceRange(range)){addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(range),false));return clientRects}}}if(offset>0){range.setStart(container,offset-1);range.setEnd(container,offset);if(!isHiddenWhiteSpaceRange(range)){addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(range),false))}}if(offset<container.data.length){range.setStart(container,offset);range.setEnd(container,offset+1);if(!isHiddenWhiteSpaceRange(range)){addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(range),true))}}}if(isText(caretPosition.container())){addCharacterOffset(caretPosition.container(),caretPosition.offset());return clientRects}if(isElement(caretPosition.container())){if(caretPosition.isAtEnd()){node=resolveIndex(caretPosition.container(),caretPosition.offset());if(isText(node)){addCharacterOffset(node,node.data.length)}if(isValidElementCaretCandidate(node)&&!isBr(node)){addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(node),false))}}else{node=resolveIndex(caretPosition.container(),caretPosition.offset());if(isText(node)){addCharacterOffset(node,0)}if(isValidElementCaretCandidate(node)&&caretPosition.isAtEnd()){addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(node),false));return clientRects}beforeNode=resolveIndex(caretPosition.container(),caretPosition.offset()-1);if(isValidElementCaretCandidate(beforeNode)&&!isBr(beforeNode)){if(isBlock(beforeNode)||isBlock(node)||!isValidElementCaretCandidate(node)){addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(beforeNode),false))}}if(isValidElementCaretCandidate(node)){addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(node),true))}}}return clientRects}function CaretPosition(container,offset,clientRects){function isAtStart(){if(isText(container)){return offset===0}return offset===0}function isAtEnd(){if(isText(container)){return offset>=container.data.length}return offset>=container.childNodes.length}function toRange(){var range;range=container.ownerDocument.createRange();range.setStart(container,offset);range.setEnd(container,offset);return range}function getClientRects(){if(!clientRects){clientRects=getCaretPositionClientRects(new CaretPosition(container,offset))}return clientRects}function isVisible(){return getClientRects().length>0}function isEqual(caretPosition){return caretPosition&&container===caretPosition.container()&&offset===caretPosition.offset()}function getNode(before){return resolveIndex(container,before?offset-1:offset)}return{container:Fun.constant(container),offset:Fun.constant(offset),toRange:toRange,getClientRects:getClientRects,isVisible:isVisible,isAtStart:isAtStart,isAtEnd:isAtEnd,isEqual:isEqual,getNode:getNode}}CaretPosition.fromRangeStart=function(range){return new CaretPosition(range.startContainer,range.startOffset)};CaretPosition.fromRangeEnd=function(range){return new CaretPosition(range.endContainer,range.endOffset)};CaretPosition.after=function(node){return new CaretPosition(node.parentNode,nodeIndex(node)+1)};CaretPosition.before=function(node){return new CaretPosition(node.parentNode,nodeIndex(node))};return CaretPosition});define("tinymce/caret/CaretBookmark",["tinymce/dom/NodeType","tinymce/dom/DOMUtils","tinymce/util/Fun","tinymce/util/Arr","tinymce/caret/CaretPosition"],function(NodeType,DomUtils,Fun,Arr,CaretPosition){var isText=NodeType.isText,isBogus=NodeType.isBogus,nodeIndex=DomUtils.nodeIndex;function normalizedParent(node){var parentNode=node.parentNode;if(isBogus(parentNode)){return normalizedParent(parentNode)}return parentNode}function getChildNodes(node){if(!node){return[]}return Arr.reduce(node.childNodes,function(result,node){if(isBogus(node)&&node.nodeName!="BR"){result=result.concat(getChildNodes(node))}else{result.push(node)}return result},[])}function normalizedTextOffset(textNode,offset){while(textNode=textNode.previousSibling){if(!isText(textNode)){break}offset+=textNode.data.length}return offset}function equal(targetValue){return function(value){return targetValue===value}}function normalizedNodeIndex(node){var nodes,index,numTextFragments;nodes=getChildNodes(normalizedParent(node));index=Arr.findIndex(nodes,equal(node),node);nodes=nodes.slice(0,index+1);numTextFragments=Arr.reduce(nodes,function(result,node,i){if(isText(node)&&isText(nodes[i-1])){result++}return result},0);nodes=Arr.filter(nodes,NodeType.matchNodeNames(node.nodeName));index=Arr.findIndex(nodes,equal(node),node);return index-numTextFragments}function createPathItem(node){var name;if(isText(node)){name="text()"}else{name=node.nodeName.toLowerCase()}return name+"["+normalizedNodeIndex(node)+"]"}function parentsUntil(rootNode,node,predicate){var parents=[];for(node=node.parentNode;node!=rootNode;node=node.parentNode){if(predicate&&predicate(node)){break}parents.push(node)}return parents}function create(rootNode,caretPosition){var container,offset,path=[],outputOffset,childNodes,parents;container=caretPosition.container();offset=caretPosition.offset();if(isText(container)){outputOffset=normalizedTextOffset(container,offset)}else{childNodes=container.childNodes;if(offset>=childNodes.length){outputOffset="after";offset=childNodes.length-1}else{outputOffset="before"}container=childNodes[offset]}path.push(createPathItem(container));parents=parentsUntil(rootNode,container);parents=Arr.filter(parents,Fun.negate(NodeType.isBogus));path=path.concat(Arr.map(parents,function(node){return createPathItem(node)}));return path.reverse().join("/")+","+outputOffset}function resolvePathItem(node,name,index){var nodes=getChildNodes(node);nodes=Arr.filter(nodes,function(node,index){return!isText(node)||!isText(nodes[index-1])});nodes=Arr.filter(nodes,NodeType.matchNodeNames(name));return nodes[index]}function findTextPosition(container,offset){var node=container,targetOffset=0,dataLen;while(isText(node)){dataLen=node.data.length;if(offset>=targetOffset&&offset<=targetOffset+dataLen){container=node;offset=offset-targetOffset;break}if(!isText(node.nextSibling)){container=node;offset=dataLen;break}targetOffset+=dataLen;node=node.nextSibling}if(offset>container.data.length){offset=container.data.length}return new CaretPosition(container,offset)}function resolve(rootNode,path){var parts,container,offset;if(!path){return null}parts=path.split(",");path=parts[0].split("/");offset=parts.length>1?parts[1]:"before";container=Arr.reduce(path,function(result,value){value=/([\w\-\(\)]+)\[([0-9]+)\]/.exec(value);if(!value){return null}if(value[1]==="text()"){value[1]="#text"}return resolvePathItem(result,value[1],parseInt(value[2],10))},rootNode);if(!container){return null}if(!isText(container)){if(offset==="after"){offset=nodeIndex(container)+1}else{offset=nodeIndex(container)}return new CaretPosition(container.parentNode,offset)}return findTextPosition(container,parseInt(offset,10))}return{create:create,resolve:resolve}});define("tinymce/dom/BookmarkManager",["tinymce/Env","tinymce/util/Tools","tinymce/caret/CaretContainer","tinymce/caret/CaretBookmark","tinymce/caret/CaretPosition","tinymce/dom/NodeType"],function(Env,Tools,CaretContainer,CaretBookmark,CaretPosition,NodeType){var isContentEditableFalse=NodeType.isContentEditableFalse;function BookmarkManager(selection){var dom=selection.dom;this.getBookmark=function(type,normalized){var rng,rng2,id,collapsed,name,element,chr="&#xFEFF;",styles;function findIndex(name,element){var count=0;Tools.each(dom.select(name),function(node){if(node.getAttribute("data-mce-bogus")==="all"){return}if(node==element){return false}count++});return count}function normalizeTableCellSelection(rng){function moveEndPoint(start){var container,offset,childNodes,prefix=start?"start":"end";container=rng[prefix+"Container"];offset=rng[prefix+"Offset"];if(container.nodeType==1&&container.nodeName=="TR"){childNodes=container.childNodes;container=childNodes[Math.min(start?offset:offset-1,childNodes.length-1)];if(container){offset=start?0:container.childNodes.length;rng["set"+(start?"Start":"End")](container,offset)}}}moveEndPoint(true);moveEndPoint();return rng}function getLocation(rng){var root=dom.getRoot(),bookmark={};function getPoint(rng,start){var container=rng[start?"startContainer":"endContainer"],offset=rng[start?"startOffset":"endOffset"],point=[],node,childNodes,after=0;if(container.nodeType==3){if(normalized){for(node=container.previousSibling;node&&node.nodeType==3;node=node.previousSibling){offset+=node.nodeValue.length}}point.push(offset)}else{childNodes=container.childNodes;if(offset>=childNodes.length&&childNodes.length){after=1;offset=Math.max(0,childNodes.length-1)}point.push(dom.nodeIndex(childNodes[offset],normalized)+after)}for(;container&&container!=root;container=container.parentNode){point.push(dom.nodeIndex(container,normalized))}return point}bookmark.start=getPoint(rng,true);if(!selection.isCollapsed()){bookmark.end=getPoint(rng)}return bookmark}function findAdjacentContentEditableFalseElm(rng){function findSibling(node){var sibling;if(CaretContainer.isCaretContainer(node)){if(NodeType.isText(node)&&CaretContainer.isCaretContainerBlock(node)){node=node.parentNode}sibling=node.previousSibling;if(isContentEditableFalse(sibling)){return sibling}sibling=node.nextSibling;if(isContentEditableFalse(sibling)){return sibling}}}return findSibling(rng.startContainer)||findSibling(rng.endContainer)}if(type==2){element=selection.getNode();name=element?element.nodeName:null;rng=selection.getRng();if(isContentEditableFalse(element)||name=="IMG"){return{name:name,index:findIndex(name,element)}}if(selection.tridentSel){return selection.tridentSel.getBookmark(type)}element=findAdjacentContentEditableFalseElm(rng);if(element){name=element.tagName;return{name:name,index:findIndex(name,element)}}return getLocation(rng)}if(type==3){rng=selection.getRng();return{start:CaretBookmark.create(dom.getRoot(),CaretPosition.fromRangeStart(rng)),end:CaretBookmark.create(dom.getRoot(),CaretPosition.fromRangeEnd(rng))}}if(type){return{rng:selection.getRng()}}rng=selection.getRng();id=dom.uniqueId();collapsed=selection.isCollapsed();styles="overflow:hidden;line-height:0px";if(rng.duplicate||rng.item){if(!rng.item){rng2=rng.duplicate();try{rng.collapse();rng.pasteHTML('<span data-mce-type="bookmark" id="'+id+'_start" style="'+styles+'">'+chr+"</span>");if(!collapsed){rng2.collapse(false);rng.moveToElementText(rng2.parentElement());if(rng.compareEndPoints("StartToEnd",rng2)===0){rng2.move("character",-1)}rng2.pasteHTML('<span data-mce-type="bookmark" id="'+id+'_end" style="'+styles+'">'+chr+"</span>")}}catch(ex){return null}}else{element=rng.item(0);name=element.nodeName;return{name:name,index:findIndex(name,element)}}}else{element=selection.getNode();name=element.nodeName;if(name=="IMG"){return{name:name,index:findIndex(name,element)}}rng2=normalizeTableCellSelection(rng.cloneRange());if(!collapsed){rng2.collapse(false);rng2.insertNode(dom.create("span",{"data-mce-type":"bookmark",id:id+"_end",style:styles},chr))}rng=normalizeTableCellSelection(rng);rng.collapse(true);rng.insertNode(dom.create("span",{"data-mce-type":"bookmark",id:id+"_start",style:styles},chr))}selection.moveToBookmark({id:id,keep:1});return{id:id}};this.moveToBookmark=function(bookmark){var rng,root,startContainer,endContainer,startOffset,endOffset;function setEndPoint(start){var point=bookmark[start?"start":"end"],i,node,offset,children;if(point){offset=point[0];for(node=root,i=point.length-1;i>=1;i--){children=node.childNodes;if(point[i]>children.length-1){return}node=children[point[i]]}if(node.nodeType===3){
offset=Math.min(point[0],node.nodeValue.length)}if(node.nodeType===1){offset=Math.min(point[0],node.childNodes.length)}if(start){rng.setStart(node,offset)}else{rng.setEnd(node,offset)}}return true}function restoreEndPoint(suffix){var marker=dom.get(bookmark.id+"_"+suffix),node,idx,next,prev,keep=bookmark.keep;if(marker){node=marker.parentNode;if(suffix=="start"){if(!keep){idx=dom.nodeIndex(marker)}else{node=marker.firstChild;idx=1}startContainer=endContainer=node;startOffset=endOffset=idx}else{if(!keep){idx=dom.nodeIndex(marker)}else{node=marker.firstChild;idx=1}endContainer=node;endOffset=idx}if(!keep){prev=marker.previousSibling;next=marker.nextSibling;Tools.each(Tools.grep(marker.childNodes),function(node){if(node.nodeType==3){node.nodeValue=node.nodeValue.replace(/\uFEFF/g,"")}});while(marker=dom.get(bookmark.id+"_"+suffix)){dom.remove(marker,1)}if(prev&&next&&prev.nodeType==next.nodeType&&prev.nodeType==3&&!Env.opera){idx=prev.nodeValue.length;prev.appendData(next.nodeValue);dom.remove(next);if(suffix=="start"){startContainer=endContainer=prev;startOffset=endOffset=idx}else{endContainer=prev;endOffset=idx}}}}}function addBogus(node){if(dom.isBlock(node)&&!node.innerHTML&&!Env.ie){node.innerHTML='<br data-mce-bogus="1" />'}return node}function resolveCaretPositionBookmark(){var rng,pos;rng=dom.createRng();pos=CaretBookmark.resolve(dom.getRoot(),bookmark.start);rng.setStart(pos.container(),pos.offset());pos=CaretBookmark.resolve(dom.getRoot(),bookmark.end);rng.setEnd(pos.container(),pos.offset());return rng}if(bookmark){if(Tools.isArray(bookmark.start)){rng=dom.createRng();root=dom.getRoot();if(selection.tridentSel){return selection.tridentSel.moveToBookmark(bookmark)}if(setEndPoint(true)&&setEndPoint()){selection.setRng(rng)}}else if(typeof bookmark.start=="string"){selection.setRng(resolveCaretPositionBookmark(bookmark))}else if(bookmark.id){restoreEndPoint("start");restoreEndPoint("end");if(startContainer){rng=dom.createRng();rng.setStart(addBogus(startContainer),startOffset);rng.setEnd(addBogus(endContainer),endOffset);selection.setRng(rng)}}else if(bookmark.name){selection.select(dom.select(bookmark.name)[bookmark.index])}else if(bookmark.rng){selection.setRng(bookmark.rng)}}}}BookmarkManager.isBookmarkNode=function(node){return node&&node.tagName==="SPAN"&&node.getAttribute("data-mce-type")==="bookmark"};return BookmarkManager});define("tinymce/dom/Selection",["tinymce/dom/TreeWalker","tinymce/dom/TridentSelection","tinymce/dom/ControlSelection","tinymce/dom/RangeUtils","tinymce/dom/BookmarkManager","tinymce/dom/NodeType","tinymce/Env","tinymce/util/Tools"],function(TreeWalker,TridentSelection,ControlSelection,RangeUtils,BookmarkManager,NodeType,Env,Tools){var each=Tools.each,trim=Tools.trim;var isIE=Env.ie;function Selection(dom,win,serializer,editor){var self=this;self.dom=dom;self.win=win;self.serializer=serializer;self.editor=editor;self.bookmarkManager=new BookmarkManager(self);self.controlSelection=new ControlSelection(self,editor);if(!self.win.getSelection){self.tridentSel=new TridentSelection(self)}}Selection.prototype={setCursorLocation:function(node,offset){var self=this,rng=self.dom.createRng();if(!node){self._moveEndPoint(rng,self.editor.getBody(),true);self.setRng(rng)}else{rng.setStart(node,offset);rng.setEnd(node,offset);self.setRng(rng);self.collapse(false)}},getContent:function(args){var self=this,rng=self.getRng(),tmpElm=self.dom.create("body");var se=self.getSel(),whiteSpaceBefore,whiteSpaceAfter,fragment;args=args||{};whiteSpaceBefore=whiteSpaceAfter="";args.get=true;args.format=args.format||"html";args.selection=true;self.editor.fire("BeforeGetContent",args);if(args.format=="text"){return self.isCollapsed()?"":rng.text||(se.toString?se.toString():"")}if(rng.cloneContents){fragment=rng.cloneContents();if(fragment){tmpElm.appendChild(fragment)}}else if(rng.item!==undefined||rng.htmlText!==undefined){tmpElm.innerHTML="<br>"+(rng.item?rng.item(0).outerHTML:rng.htmlText);tmpElm.removeChild(tmpElm.firstChild)}else{tmpElm.innerHTML=rng.toString()}if(/^\s/.test(tmpElm.innerHTML)){whiteSpaceBefore=" "}if(/\s+$/.test(tmpElm.innerHTML)){whiteSpaceAfter=" "}args.getInner=true;args.content=self.isCollapsed()?"":whiteSpaceBefore+self.serializer.serialize(tmpElm,args)+whiteSpaceAfter;self.editor.fire("GetContent",args);return args.content},setContent:function(content,args){var self=this,rng=self.getRng(),caretNode,doc=self.win.document,frag,temp;args=args||{format:"html"};args.set=true;args.selection=true;args.content=content;if(!args.no_events){self.editor.fire("BeforeSetContent",args)}content=args.content;if(rng.insertNode){content+='<span id="__caret">_</span>';if(rng.startContainer==doc&&rng.endContainer==doc){doc.body.innerHTML=content}else{rng.deleteContents();if(doc.body.childNodes.length===0){doc.body.innerHTML=content}else{if(rng.createContextualFragment){rng.insertNode(rng.createContextualFragment(content))}else{frag=doc.createDocumentFragment();temp=doc.createElement("div");frag.appendChild(temp);temp.outerHTML=content;rng.insertNode(frag)}}}caretNode=self.dom.get("__caret");rng=doc.createRange();rng.setStartBefore(caretNode);rng.setEndBefore(caretNode);self.setRng(rng);self.dom.remove("__caret");try{self.setRng(rng)}catch(ex){}}else{if(rng.item){doc.execCommand("Delete",false,null);rng=self.getRng()}if(/^\s+/.test(content)){rng.pasteHTML('<span id="__mce_tmp">_</span>'+content);self.dom.remove("__mce_tmp")}else{rng.pasteHTML(content)}}if(!args.no_events){self.editor.fire("SetContent",args)}},getStart:function(real){var self=this,rng=self.getRng(),startElement,parentElement,checkRng,node;if(rng.duplicate||rng.item){if(rng.item){return rng.item(0)}checkRng=rng.duplicate();checkRng.collapse(1);startElement=checkRng.parentElement();if(startElement.ownerDocument!==self.dom.doc){startElement=self.dom.getRoot()}parentElement=node=rng.parentElement();while(node=node.parentNode){if(node==startElement){startElement=parentElement;break}}return startElement}startElement=rng.startContainer;if(startElement.nodeType==1&&startElement.hasChildNodes()){if(!real||!rng.collapsed){startElement=startElement.childNodes[Math.min(startElement.childNodes.length-1,rng.startOffset)]}}if(startElement&&startElement.nodeType==3){return startElement.parentNode}return startElement},getEnd:function(real){var self=this,rng=self.getRng(),endElement,endOffset;if(rng.duplicate||rng.item){if(rng.item){return rng.item(0)}rng=rng.duplicate();rng.collapse(0);endElement=rng.parentElement();if(endElement.ownerDocument!==self.dom.doc){endElement=self.dom.getRoot()}if(endElement&&endElement.nodeName=="BODY"){return endElement.lastChild||endElement}return endElement}endElement=rng.endContainer;endOffset=rng.endOffset;if(endElement.nodeType==1&&endElement.hasChildNodes()){if(!real||!rng.collapsed){endElement=endElement.childNodes[endOffset>0?endOffset-1:endOffset]}}if(endElement&&endElement.nodeType==3){return endElement.parentNode}return endElement},getBookmark:function(type,normalized){return this.bookmarkManager.getBookmark(type,normalized)},moveToBookmark:function(bookmark){return this.bookmarkManager.moveToBookmark(bookmark)},select:function(node,content){var self=this,dom=self.dom,rng=dom.createRng(),idx;self.lastFocusBookmark=null;if(node){if(!content&&self.controlSelection.controlSelect(node)){return}idx=dom.nodeIndex(node);rng.setStart(node.parentNode,idx);rng.setEnd(node.parentNode,idx+1);if(content){self._moveEndPoint(rng,node,true);self._moveEndPoint(rng,node)}self.setRng(rng)}return node},isCollapsed:function(){var self=this,rng=self.getRng(),sel=self.getSel();if(!rng||rng.item){return false}if(rng.compareEndPoints){return rng.compareEndPoints("StartToEnd",rng)===0}return!sel||rng.collapsed},collapse:function(toStart){var self=this,rng=self.getRng(),node;if(rng.item){node=rng.item(0);rng=self.win.document.body.createTextRange();rng.moveToElementText(node)}rng.collapse(!!toStart);self.setRng(rng)},getSel:function(){var win=this.win;return win.getSelection?win.getSelection():win.document.selection},getRng:function(w3c){var self=this,selection,rng,elm,doc,ieRng,evt;function tryCompareBoundaryPoints(how,sourceRange,destinationRange){try{return sourceRange.compareBoundaryPoints(how,destinationRange)}catch(ex){return-1}}if(!self.win){return null}doc=self.win.document;if(!w3c&&self.lastFocusBookmark){var bookmark=self.lastFocusBookmark;if(bookmark.startContainer){rng=doc.createRange();rng.setStart(bookmark.startContainer,bookmark.startOffset);rng.setEnd(bookmark.endContainer,bookmark.endOffset)}else{rng=bookmark}return rng}if(w3c&&self.tridentSel){return self.tridentSel.getRangeAt(0)}try{if(selection=self.getSel()){if(selection.rangeCount>0){rng=selection.getRangeAt(0)}else{rng=selection.createRange?selection.createRange():doc.createRange()}}}catch(ex){}evt=self.editor.fire("GetSelectionRange",{range:rng});if(evt.range!==rng){return evt.range}if(isIE&&rng&&rng.setStart&&doc.selection){try{ieRng=doc.selection.createRange()}catch(ex){}if(ieRng&&ieRng.item){elm=ieRng.item(0);rng=doc.createRange();rng.setStartBefore(elm);rng.setEndAfter(elm)}}if(!rng){rng=doc.createRange?doc.createRange():doc.body.createTextRange()}if(rng.setStart&&rng.startContainer.nodeType===9&&rng.collapsed){elm=self.dom.getRoot();rng.setStart(elm,0);rng.setEnd(elm,0)}if(self.selectedRange&&self.explicitRange){if(tryCompareBoundaryPoints(rng.START_TO_START,rng,self.selectedRange)===0&&tryCompareBoundaryPoints(rng.END_TO_END,rng,self.selectedRange)===0){rng=self.explicitRange}else{self.selectedRange=null;self.explicitRange=null}}return rng},setRng:function(rng,forward){var self=this,sel,node,evt;if(!rng){return}if(rng.select){self.explicitRange=null;try{rng.select()}catch(ex){}return}if(!self.tridentSel){sel=self.getSel();evt=self.editor.fire("SetSelectionRange",{range:rng});rng=evt.range;if(sel){self.explicitRange=rng;try{sel.removeAllRanges();sel.addRange(rng)}catch(ex){}if(forward===false&&sel.extend){sel.collapse(rng.endContainer,rng.endOffset);sel.extend(rng.startContainer,rng.startOffset)}self.selectedRange=sel.rangeCount>0?sel.getRangeAt(0):null}if(!rng.collapsed&&rng.startContainer==rng.endContainer&&sel.setBaseAndExtent&&!Env.ie){if(rng.endOffset-rng.startOffset<2){if(rng.startContainer.hasChildNodes()){node=rng.startContainer.childNodes[rng.startOffset];if(node&&node.tagName=="IMG"){self.getSel().setBaseAndExtent(node,0,node,1)}}}}}else{if(rng.cloneRange){try{self.tridentSel.addRange(rng)}catch(ex){}}}},setNode:function(elm){var self=this;self.setContent(self.dom.getOuterHTML(elm));return elm},getNode:function(){var self=this,rng=self.getRng(),elm;var startContainer,endContainer,startOffset,endOffset,root=self.dom.getRoot();function skipEmptyTextNodes(node,forwards){var orig=node;while(node&&node.nodeType===3&&node.length===0){node=forwards?node.nextSibling:node.previousSibling}return node||orig}if(!rng){return root}startContainer=rng.startContainer;endContainer=rng.endContainer;startOffset=rng.startOffset;endOffset=rng.endOffset;if(rng.setStart){elm=rng.commonAncestorContainer;if(!rng.collapsed){if(startContainer==endContainer){if(endOffset-startOffset<2){if(startContainer.hasChildNodes()){elm=startContainer.childNodes[startOffset]}}}if(startContainer.nodeType===3&&endContainer.nodeType===3){if(startContainer.length===startOffset){startContainer=skipEmptyTextNodes(startContainer.nextSibling,true)}else{startContainer=startContainer.parentNode}if(endOffset===0){endContainer=skipEmptyTextNodes(endContainer.previousSibling,false)}else{endContainer=endContainer.parentNode}if(startContainer&&startContainer===endContainer){return startContainer}}}if(elm&&elm.nodeType==3){return elm.parentNode}return elm}elm=rng.item?rng.item(0):rng.parentElement();if(elm.ownerDocument!==self.win.document){elm=root}return elm},getSelectedBlocks:function(startElm,endElm){var self=this,dom=self.dom,node,root,selectedBlocks=[];root=dom.getRoot();startElm=dom.getParent(startElm||self.getStart(),dom.isBlock);endElm=dom.getParent(endElm||self.getEnd(),dom.isBlock);if(startElm&&startElm!=root){selectedBlocks.push(startElm)}if(startElm&&endElm&&startElm!=endElm){node=startElm;var walker=new TreeWalker(startElm,root);while((node=walker.next())&&node!=endElm){if(dom.isBlock(node)){selectedBlocks.push(node)}}}if(endElm&&startElm!=endElm&&endElm!=root){selectedBlocks.push(endElm)}return selectedBlocks},isForward:function(){var dom=this.dom,sel=this.getSel(),anchorRange,focusRange;if(!sel||!sel.anchorNode||!sel.focusNode){return true}anchorRange=dom.createRng();anchorRange.setStart(sel.anchorNode,sel.anchorOffset);anchorRange.collapse(true);focusRange=dom.createRng();focusRange.setStart(sel.focusNode,sel.focusOffset);focusRange.collapse(true);return anchorRange.compareBoundaryPoints(anchorRange.START_TO_START,focusRange)<=0},normalize:function(){var self=this,rng=self.getRng();if(Env.range&&new RangeUtils(self.dom).normalize(rng)){self.setRng(rng,self.isForward())}return rng},selectorChanged:function(selector,callback){var self=this,currentSelectors;if(!self.selectorChangedData){self.selectorChangedData={};currentSelectors={};self.editor.on("NodeChange",function(e){var node=e.element,dom=self.dom,parents=dom.getParents(node,null,dom.getRoot()),matchedSelectors={};each(self.selectorChangedData,function(callbacks,selector){each(parents,function(node){if(dom.is(node,selector)){if(!currentSelectors[selector]){each(callbacks,function(callback){callback(true,{node:node,selector:selector,parents:parents})});currentSelectors[selector]=callbacks}matchedSelectors[selector]=callbacks;return false}})});each(currentSelectors,function(callbacks,selector){if(!matchedSelectors[selector]){delete currentSelectors[selector];each(callbacks,function(callback){callback(false,{node:node,selector:selector,parents:parents})})}})})}if(!self.selectorChangedData[selector]){self.selectorChangedData[selector]=[]}self.selectorChangedData[selector].push(callback);return self},getScrollContainer:function(){var scrollContainer,node=this.dom.getRoot();while(node&&node.nodeName!="BODY"){if(node.scrollHeight>node.clientHeight){scrollContainer=node;break}node=node.parentNode}return scrollContainer},scrollIntoView:function(elm,alignToTop){var y,viewPort,self=this,dom=self.dom,root=dom.getRoot(),viewPortY,viewPortH,offsetY=0;function getPos(elm){var x=0,y=0;var offsetParent=elm;while(offsetParent&&offsetParent.nodeType){x+=offsetParent.offsetLeft||0;y+=offsetParent.offsetTop||0;offsetParent=offsetParent.offsetParent}return{x:x,y:y}}if(!NodeType.isElement(elm)){return}if(alignToTop===false){offsetY=elm.offsetHeight}if(root.nodeName!="BODY"){var scrollContainer=self.getScrollContainer();if(scrollContainer){y=getPos(elm).y-getPos(scrollContainer).y+offsetY;viewPortH=scrollContainer.clientHeight;viewPortY=scrollContainer.scrollTop;if(y<viewPortY||y+25>viewPortY+viewPortH){scrollContainer.scrollTop=y<viewPortY?y:y-viewPortH+25}return}}viewPort=dom.getViewPort(self.editor.getWin());y=dom.getPos(elm).y+offsetY;viewPortY=viewPort.y;viewPortH=viewPort.h;if(y<viewPort.y||y+25>viewPortY+viewPortH){self.editor.getWin().scrollTo(0,y<viewPortY?y:y-viewPortH+25)}},placeCaretAt:function(clientX,clientY){this.setRng(RangeUtils.getCaretRangeFromPoint(clientX,clientY,this.editor.getDoc()))},_moveEndPoint:function(rng,node,start){var root=node,walker=new TreeWalker(node,root);var nonEmptyElementsMap=this.dom.schema.getNonEmptyElements();do{if(node.nodeType==3&&trim(node.nodeValue).length!==0){if(start){rng.setStart(node,0)}else{rng.setEnd(node,node.nodeValue.length)}return}if(nonEmptyElementsMap[node.nodeName]&&!/^(TD|TH)$/.test(node.nodeName)){if(start){rng.setStartBefore(node)}else{if(node.nodeName=="BR"){rng.setEndBefore(node)}else{rng.setEndAfter(node)}}return}if(Env.ie&&Env.ie<11&&this.dom.isBlock(node)&&this.dom.isEmpty(node)){if(start){rng.setStart(node,0)}else{rng.setEnd(node,0)}return}}while(node=start?walker.next():walker.prev());if(root.nodeName=="BODY"){if(start){rng.setStart(root,0)}else{rng.setEnd(root,root.childNodes.length)}}},destroy:function(){this.win=null;this.controlSelection.destroy()}};return Selection});define("tinymce/dom/ElementUtils",["tinymce/dom/BookmarkManager","tinymce/util/Tools"],function(BookmarkManager,Tools){var each=Tools.each;function ElementUtils(dom){this.compare=function(node1,node2){if(node1.nodeName!=node2.nodeName){return false}function getAttribs(node){var attribs={};each(dom.getAttribs(node),function(attr){var name=attr.nodeName.toLowerCase();if(name.indexOf("_")!==0&&name!=="style"&&name!=="data-mce-style"&&name!="data-mce-fragment"){attribs[name]=dom.getAttrib(node,name)}});return attribs}function compareObjects(obj1,obj2){var value,name;for(name in obj1){if(obj1.hasOwnProperty(name)){value=obj2[name];if(typeof value=="undefined"){return false}if(obj1[name]!=value){return false}delete obj2[name]}}for(name in obj2){if(obj2.hasOwnProperty(name)){return false}}return true}if(!compareObjects(getAttribs(node1),getAttribs(node2))){return false}if(!compareObjects(dom.parseStyle(dom.getAttrib(node1,"style")),dom.parseStyle(dom.getAttrib(node2,"style")))){return false}return!BookmarkManager.isBookmarkNode(node1)&&!BookmarkManager.isBookmarkNode(node2)}}return ElementUtils});define("tinymce/fmt/Preview",["tinymce/util/Tools"],function(Tools){var each=Tools.each;function getCssText(editor,format){var name,previewElm,dom=editor.dom;var previewCss="",parentFontSize,previewStyles;previewStyles=editor.settings.preview_styles;if(previewStyles===false){return""}if(!previewStyles){previewStyles="font-family font-size font-weight font-style text-decoration "+"text-transform color background-color border border-radius outline text-shadow"}function removeVars(val){return val.replace(/%(\w+)/g,"")}if(typeof format=="string"){format=editor.formatter.get(format);if(!format){return}format=format[0]}name=format.block||format.inline||"span";previewElm=dom.create(name);each(format.styles,function(value,name){value=removeVars(value);if(value){dom.setStyle(previewElm,name,value)}});each(format.attributes,function(value,name){value=removeVars(value);if(value){dom.setAttrib(previewElm,name,value)}});each(format.classes,function(value){value=removeVars(value);if(!dom.hasClass(previewElm,value)){dom.addClass(previewElm,value)}});editor.fire("PreviewFormats");dom.setStyles(previewElm,{position:"absolute",left:-65535});editor.getBody().appendChild(previewElm);parentFontSize=dom.getStyle(editor.getBody(),"fontSize",true);parentFontSize=/px$/.test(parentFontSize)?parseInt(parentFontSize,10):0;each(previewStyles.split(" "),function(name){var value=dom.getStyle(previewElm,name,true);if(name=="background-color"&&/transparent|rgba\s*\([^)]+,\s*0\)/.test(value)){value=dom.getStyle(editor.getBody(),name,true);if(dom.toHex(value).toLowerCase()=="#ffffff"){return}}if(name=="color"){if(dom.toHex(value).toLowerCase()=="#000000"){return}}if(name=="font-size"){if(/em|%$/.test(value)){if(parentFontSize===0){return}value=parseFloat(value,10)/(/%$/.test(value)?100:1);value=value*parentFontSize+"px"}}if(name=="border"&&value){previewCss+="padding:0 2px;"}previewCss+=name+":"+value+";"});editor.fire("AfterPreviewFormats");dom.remove(previewElm);return previewCss}return{getCssText:getCssText}});define("tinymce/fmt/Hooks",["tinymce/util/Arr","tinymce/dom/NodeType","tinymce/dom/DomQuery"],function(Arr,NodeType,$){var postProcessHooks=[],filter=Arr.filter,each=Arr.each;function addPostProcessHook(name,hook){var hooks=postProcessHooks[name];if(!hooks){postProcessHooks[name]=hooks=[]}postProcessHooks[name].push(hook)}function postProcess(name,editor){each(postProcessHooks[name],function(hook){hook(editor)})}addPostProcessHook("pre",function(editor){var rng=editor.selection.getRng(),isPre,blocks;function hasPreSibling(pre){return isPre(pre.previousSibling)&&Arr.indexOf(blocks,pre.previousSibling)!=-1}function joinPre(pre1,pre2){$(pre2).remove();$(pre1).append("<br><br>").append(pre2.childNodes)}isPre=NodeType.matchNodeNames("pre");if(!rng.collapsed){blocks=editor.selection.getSelectedBlocks();each(filter(filter(blocks,isPre),hasPreSibling),function(pre){joinPre(pre.previousSibling,pre)})}});return{postProcess:postProcess}});define("tinymce/Formatter",["tinymce/dom/TreeWalker","tinymce/dom/RangeUtils","tinymce/dom/BookmarkManager","tinymce/dom/ElementUtils","tinymce/util/Tools","tinymce/fmt/Preview","tinymce/fmt/Hooks"],function(TreeWalker,RangeUtils,BookmarkManager,ElementUtils,Tools,Preview,Hooks){return function(ed){var formats={},dom=ed.dom,selection=ed.selection,rangeUtils=new RangeUtils(dom),isValid=ed.schema.isValidChild,isBlock=dom.isBlock,forcedRootBlock=ed.settings.forced_root_block,nodeIndex=dom.nodeIndex,INVISIBLE_CHAR="\ufeff",MCE_ATTR_RE=/^(src|href|style)$/,FALSE=false,TRUE=true,formatChangeData,undef,getContentEditable=dom.getContentEditable,disableCaretContainer,markCaretContainersBogus,isBookmarkNode=BookmarkManager.isBookmarkNode;var each=Tools.each,grep=Tools.grep,walk=Tools.walk,extend=Tools.extend;function isTextBlock(name){if(name.nodeType){name=name.nodeName}return!!ed.schema.getTextBlockElements()[name.toLowerCase()]}function isTableCell(node){return/^(TH|TD)$/.test(node.nodeName)}function isInlineBlock(node){return node&&/^(IMG)$/.test(node.nodeName)}function getParents(node,selector){return dom.getParents(node,selector,dom.getRoot())}function isCaretNode(node){return node.nodeType===1&&node.id==="_mce_caret"}function defaultFormats(){register({valigntop:[{selector:"td,th",styles:{verticalAlign:"top"}}],valignmiddle:[{selector:"td,th",styles:{verticalAlign:"middle"}}],valignbottom:[{selector:"td,th",styles:{verticalAlign:"bottom"}}],alignleft:[{selector:"figure.image",collapsed:false,classes:"align-left",ceFalseOverride:true},{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"left"},inherit:false,defaultBlock:"div"},{selector:"img,table",collapsed:false,styles:{float:"left"}}],aligncenter:[{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"center"},inherit:false,defaultBlock:"div"},{selector:"figure.image",collapsed:false,classes:"align-center",ceFalseOverride:true},{selector:"img",collapsed:false,styles:{display:"block",marginLeft:"auto",marginRight:"auto"}},{selector:"table",collapsed:false,styles:{marginLeft:"auto",marginRight:"auto"}}],alignright:[{selector:"figure.image",collapsed:false,classes:"align-right",ceFalseOverride:true},{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"right"},inherit:false,defaultBlock:"div"},{selector:"img,table",collapsed:false,styles:{float:"right"}}],alignjustify:[{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"justify"},inherit:false,defaultBlock:"div"}],bold:[{inline:"strong",remove:"all"},{inline:"span",styles:{fontWeight:"bold"}},{inline:"b",remove:"all"}],italic:[{inline:"em",remove:"all"},{inline:"span",styles:{fontStyle:"italic"}},{inline:"i",remove:"all"}],underline:[{inline:"span",styles:{textDecoration:"underline"},exact:true},{inline:"u",remove:"all"}],strikethrough:[{inline:"span",styles:{textDecoration:"line-through"},exact:true},{inline:"strike",remove:"all"}],forecolor:{inline:"span",styles:{color:"%value"},links:true,remove_similar:true},hilitecolor:{inline:"span",styles:{backgroundColor:"%value"},links:true,remove_similar:true},fontname:{inline:"span",styles:{fontFamily:"%value"}},fontsize:{inline:"span",styles:{fontSize:"%value"}},fontsize_class:{inline:"span",attributes:{class:"%value"}},blockquote:{block:"blockquote",wrapper:1,remove:"all"},subscript:{inline:"sub"},superscript:{inline:"sup"},code:{inline:"code"},link:{inline:"a",selector:"a",remove:"all",split:true,deep:true,onmatch:function(){return true},onformat:function(elm,fmt,vars){each(vars,function(value,key){dom.setAttrib(elm,key,value)})}},removeformat:[{selector:"b,strong,em,i,font,u,strike,sub,sup,dfn,code,samp,kbd,var,cite,mark,q,del,ins",remove:"all",split:true,expand:false,block_expand:true,deep:true},{selector:"span",attributes:["style","class"],remove:"empty",split:true,expand:false,deep:true},{selector:"*",attributes:["style","class"],split:false,expand:false,deep:true}]});each("p h1 h2 h3 h4 h5 h6 div address pre div dt dd samp".split(/\s/),function(name){register(name,{block:name,remove:"all"})});register(ed.settings.formats)}function addKeyboardShortcuts(){ed.addShortcut("meta+b","bold_desc","Bold");ed.addShortcut("meta+i","italic_desc","Italic");ed.addShortcut("meta+u","underline_desc","Underline");for(var i=1;i<=6;i++){ed.addShortcut("access+"+i,"",["FormatBlock",false,"h"+i])}ed.addShortcut("access+7","",["FormatBlock",false,"p"]);ed.addShortcut("access+8","",["FormatBlock",false,"div"]);ed.addShortcut("access+9","",["FormatBlock",false,"address"])}function get(name){return name?formats[name]:formats}function register(name,format){if(name){if(typeof name!=="string"){each(name,function(format,name){register(name,format)})}else{format=format.length?format:[format];each(format,function(format){if(format.deep===undef){format.deep=!format.selector}if(format.split===undef){format.split=!format.selector||format.inline}if(format.remove===undef&&format.selector&&!format.inline){format.remove="none"}if(format.selector&&format.inline){format.mixed=true;format.block_expand=true}if(typeof format.classes==="string"){format.classes=format.classes.split(/\s+/)}});formats[name]=format}}}function unregister(name){if(name&&formats[name]){delete formats[name]}return formats}function matchesUnInheritedFormatSelector(node,name){var formatList=get(name);if(formatList){for(var i=0;i<formatList.length;i++){if(formatList[i].inherit===false&&dom.is(node,formatList[i].selector)){return true}}}return false}function getTextDecoration(node){var decoration;ed.dom.getParent(node,function(n){decoration=ed.dom.getStyle(n,"text-decoration");return decoration&&decoration!=="none"});return decoration}function processUnderlineAndColor(node){var textDecoration;if(node.nodeType===1&&node.parentNode&&node.parentNode.nodeType===1){textDecoration=getTextDecoration(node.parentNode);if(ed.dom.getStyle(node,"color")&&textDecoration){ed.dom.setStyle(node,"text-decoration",textDecoration)}else if(ed.dom.getStyle(node,"text-decoration")===textDecoration){ed.dom.setStyle(node,"text-decoration",null)}}}function apply(name,vars,node){var formatList=get(name),format=formatList[0],bookmark,rng,isCollapsed=!node&&selection.isCollapsed();function setElementFormat(elm,fmt){fmt=fmt||format;if(elm){if(fmt.onformat){fmt.onformat(elm,fmt,vars,node)}each(fmt.styles,function(value,name){dom.setStyle(elm,name,replaceVars(value,vars))});if(fmt.styles){var styleVal=dom.getAttrib(elm,"style");if(styleVal){elm.setAttribute("data-mce-style",styleVal)}}each(fmt.attributes,function(value,name){dom.setAttrib(elm,name,replaceVars(value,vars))});each(fmt.classes,function(value){value=replaceVars(value,vars);if(!dom.hasClass(elm,value)){dom.addClass(elm,value)}})}}function adjustSelectionToVisibleSelection(){function findSelectionEnd(start,end){var walker=new TreeWalker(end);for(node=walker.prev2();node;node=walker.prev2()){if(node.nodeType==3&&node.data.length>0){return node}if(node.childNodes.length>1||node==start||node.tagName=="BR"){return node}}}var rng=ed.selection.getRng();var start=rng.startContainer;var end=rng.endContainer;if(start!=end&&rng.endOffset===0){var newEnd=findSelectionEnd(start,end);var endOffset=newEnd.nodeType==3?newEnd.data.length:newEnd.childNodes.length;rng.setEnd(newEnd,endOffset)}return rng}function applyRngStyle(rng,bookmark,node_specific){var newWrappers=[],wrapName,wrapElm,contentEditable=true;wrapName=format.inline||format.block;wrapElm=dom.create(wrapName);setElementFormat(wrapElm);rangeUtils.walk(rng,function(nodes){var currentWrapElm;function process(node){var nodeName,parentName,found,hasContentEditableState,lastContentEditable;lastContentEditable=contentEditable;nodeName=node.nodeName.toLowerCase();parentName=node.parentNode.nodeName.toLowerCase();if(node.nodeType===1&&getContentEditable(node)){lastContentEditable=contentEditable;contentEditable=getContentEditable(node)==="true";hasContentEditableState=true}if(isEq(nodeName,"br")){currentWrapElm=0;if(format.block){dom.remove(node)}return}if(format.wrapper&&matchNode(node,name,vars)){currentWrapElm=0;return}if(contentEditable&&!hasContentEditableState&&format.block&&!format.wrapper&&isTextBlock(nodeName)&&isValid(parentName,wrapName)){node=dom.rename(node,wrapName);setElementFormat(node);newWrappers.push(node);currentWrapElm=0;return}if(format.selector){each(formatList,function(format){if("collapsed"in format&&format.collapsed!==isCollapsed){return}if(dom.is(node,format.selector)&&!isCaretNode(node)){setElementFormat(node,format);found=true;return false}});if(!format.inline||found){currentWrapElm=0;return}}if(contentEditable&&!hasContentEditableState&&isValid(wrapName,nodeName)&&isValid(parentName,wrapName)&&!(!node_specific&&node.nodeType===3&&node.nodeValue.length===1&&node.nodeValue.charCodeAt(0)===65279)&&!isCaretNode(node)&&(!format.inline||!isBlock(node))){if(!currentWrapElm){currentWrapElm=dom.clone(wrapElm,FALSE);node.parentNode.insertBefore(currentWrapElm,node);newWrappers.push(currentWrapElm)}currentWrapElm.appendChild(node)}else{currentWrapElm=0;each(grep(node.childNodes),process);if(hasContentEditableState){contentEditable=lastContentEditable}currentWrapElm=0}}each(nodes,process)});if(format.links===true){each(newWrappers,function(node){function process(node){if(node.nodeName==="A"){setElementFormat(node,format)}each(grep(node.childNodes),process)}process(node)})}each(newWrappers,function(node){var childCount;function getChildCount(node){var count=0;each(node.childNodes,function(node){if(!isWhiteSpaceNode(node)&&!isBookmarkNode(node)){count++}});return count}function mergeStyles(node){var child,clone;each(node.childNodes,function(node){if(node.nodeType==1&&!isBookmarkNode(node)&&!isCaretNode(node)){child=node;return FALSE}});if(child&&!isBookmarkNode(child)&&matchName(child,format)){clone=dom.clone(child,FALSE);setElementFormat(clone);dom.replace(clone,node,TRUE);dom.remove(child,1)}return clone||node}childCount=getChildCount(node);if((newWrappers.length>1||!isBlock(node))&&childCount===0){dom.remove(node,1);return}if(format.inline||format.wrapper){if(!format.exact&&childCount===1){node=mergeStyles(node)}each(formatList,function(format){each(dom.select(format.inline,node),function(child){if(isBookmarkNode(child)){return}removeFormat(format,vars,child,format.exact?child:null)})});if(matchNode(node.parentNode,name,vars)){dom.remove(node,1);node=0;return TRUE}if(format.merge_with_parents){dom.getParent(node.parentNode,function(parent){if(matchNode(parent,name,vars)){dom.remove(node,1);node=0;return TRUE}})}if(node&&format.merge_siblings!==false){node=mergeSiblings(getNonWhiteSpaceSibling(node),node);node=mergeSiblings(node,getNonWhiteSpaceSibling(node,TRUE))}}})}if(getContentEditable(selection.getNode())==="false"){node=selection.getNode();for(var i=0,l=formatList.length;i<l;i++){if(formatList[i].ceFalseOverride&&dom.is(node,formatList[i].selector)){setElementFormat(node,formatList[i]);return}}return}if(format){if(node){if(node.nodeType){rng=dom.createRng();rng.setStartBefore(node);rng.setEndAfter(node);applyRngStyle(expandRng(rng,formatList),null,true)}else{applyRngStyle(node,null,true)}}else{if(!isCollapsed||!format.inline||dom.select("td[data-mce-selected],th[data-mce-selected]").length){var curSelNode=ed.selection.getNode();if(!forcedRootBlock&&formatList[0].defaultBlock&&!dom.getParent(curSelNode,dom.isBlock)){apply(formatList[0].defaultBlock)}ed.selection.setRng(adjustSelectionToVisibleSelection());bookmark=selection.getBookmark();applyRngStyle(expandRng(selection.getRng(TRUE),formatList),bookmark);if(format.styles&&(format.styles.color||format.styles.textDecoration)){walk(curSelNode,processUnderlineAndColor,"childNodes");processUnderlineAndColor(curSelNode)}selection.moveToBookmark(bookmark);moveStart(selection.getRng(TRUE));ed.nodeChanged();
}else{performCaretAction("apply",name,vars)}}Hooks.postProcess(name,ed)}}function remove(name,vars,node,similar){var formatList=get(name),format=formatList[0],bookmark,rng,contentEditable=true;function process(node){var children,i,l,lastContentEditable,hasContentEditableState;if(node.nodeType===1&&getContentEditable(node)){lastContentEditable=contentEditable;contentEditable=getContentEditable(node)==="true";hasContentEditableState=true}children=grep(node.childNodes);if(contentEditable&&!hasContentEditableState){for(i=0,l=formatList.length;i<l;i++){if(removeFormat(formatList[i],vars,node,node)){break}}}if(format.deep){if(children.length){for(i=0,l=children.length;i<l;i++){process(children[i])}if(hasContentEditableState){contentEditable=lastContentEditable}}}}function findFormatRoot(container){var formatRoot;each(getParents(container.parentNode).reverse(),function(parent){var format;if(!formatRoot&&parent.id!="_start"&&parent.id!="_end"){format=matchNode(parent,name,vars,similar);if(format&&format.split!==false){formatRoot=parent}}});return formatRoot}function wrapAndSplit(formatRoot,container,target,split){var parent,clone,lastClone,firstClone,i,formatRootParent;if(formatRoot){formatRootParent=formatRoot.parentNode;for(parent=container.parentNode;parent&&parent!=formatRootParent;parent=parent.parentNode){clone=dom.clone(parent,FALSE);for(i=0;i<formatList.length;i++){if(removeFormat(formatList[i],vars,clone,clone)){clone=0;break}}if(clone){if(lastClone){clone.appendChild(lastClone)}if(!firstClone){firstClone=clone}lastClone=clone}}if(split&&(!format.mixed||!isBlock(formatRoot))){container=dom.split(formatRoot,container)}if(lastClone){target.parentNode.insertBefore(lastClone,target);firstClone.appendChild(target)}}return container}function splitToFormatRoot(container){return wrapAndSplit(findFormatRoot(container),container,container,true)}function unwrap(start){var node=dom.get(start?"_start":"_end"),out=node[start?"firstChild":"lastChild"];if(isBookmarkNode(out)){out=out[start?"firstChild":"lastChild"]}if(out.nodeType==3&&out.data.length===0){out=start?node.previousSibling||node.nextSibling:node.nextSibling||node.previousSibling}dom.remove(node,true);return out}function removeRngStyle(rng){var startContainer,endContainer;var commonAncestorContainer=rng.commonAncestorContainer;rng=expandRng(rng,formatList,TRUE);if(format.split){startContainer=getContainer(rng,TRUE);endContainer=getContainer(rng);if(startContainer!=endContainer){if(/^(TR|TH|TD)$/.test(startContainer.nodeName)&&startContainer.firstChild){if(startContainer.nodeName=="TR"){startContainer=startContainer.firstChild.firstChild||startContainer}else{startContainer=startContainer.firstChild||startContainer}}if(commonAncestorContainer&&/^T(HEAD|BODY|FOOT|R)$/.test(commonAncestorContainer.nodeName)&&isTableCell(endContainer)&&endContainer.firstChild){endContainer=endContainer.firstChild||endContainer}if(dom.isChildOf(startContainer,endContainer)&&!isBlock(endContainer)&&!isTableCell(startContainer)&&!isTableCell(endContainer)){startContainer=wrap(startContainer,"span",{id:"_start","data-mce-type":"bookmark"});splitToFormatRoot(startContainer);startContainer=unwrap(TRUE);return}startContainer=wrap(startContainer,"span",{id:"_start","data-mce-type":"bookmark"});endContainer=wrap(endContainer,"span",{id:"_end","data-mce-type":"bookmark"});splitToFormatRoot(startContainer);splitToFormatRoot(endContainer);startContainer=unwrap(TRUE);endContainer=unwrap()}else{startContainer=endContainer=splitToFormatRoot(startContainer)}rng.startContainer=startContainer.parentNode?startContainer.parentNode:startContainer;rng.startOffset=nodeIndex(startContainer);rng.endContainer=endContainer.parentNode?endContainer.parentNode:endContainer;rng.endOffset=nodeIndex(endContainer)+1}rangeUtils.walk(rng,function(nodes){each(nodes,function(node){process(node);if(node.nodeType===1&&ed.dom.getStyle(node,"text-decoration")==="underline"&&node.parentNode&&getTextDecoration(node.parentNode)==="underline"){removeFormat({deep:false,exact:true,inline:"span",styles:{textDecoration:"underline"}},null,node)}})})}if(node){if(node.nodeType){rng=dom.createRng();rng.setStartBefore(node);rng.setEndAfter(node);removeRngStyle(rng)}else{removeRngStyle(node)}return}if(getContentEditable(selection.getNode())==="false"){node=selection.getNode();for(var i=0,l=formatList.length;i<l;i++){if(formatList[i].ceFalseOverride){if(removeFormat(formatList[i],vars,node,node)){break}}}return}if(!selection.isCollapsed()||!format.inline||dom.select("td[data-mce-selected],th[data-mce-selected]").length){bookmark=selection.getBookmark();removeRngStyle(selection.getRng(TRUE));selection.moveToBookmark(bookmark);if(format.inline&&match(name,vars,selection.getStart())){moveStart(selection.getRng(true))}ed.nodeChanged()}else{performCaretAction("remove",name,vars,similar)}}function toggle(name,vars,node){var fmt=get(name);if(match(name,vars,node)&&(!("toggle"in fmt[0])||fmt[0].toggle)){remove(name,vars,node)}else{apply(name,vars,node)}}function matchNode(node,name,vars,similar){var formatList=get(name),format,i,classes;function matchItems(node,format,item_name){var key,value,items=format[item_name],i;if(format.onmatch){return format.onmatch(node,format,item_name)}if(items){if(items.length===undef){for(key in items){if(items.hasOwnProperty(key)){if(item_name==="attributes"){value=dom.getAttrib(node,key)}else{value=getStyle(node,key)}if(similar&&!value&&!format.exact){return}if((!similar||format.exact)&&!isEq(value,normalizeStyleValue(replaceVars(items[key],vars),key))){return}}}}else{for(i=0;i<items.length;i++){if(item_name==="attributes"?dom.getAttrib(node,items[i]):getStyle(node,items[i])){return format}}}}return format}if(formatList&&node){for(i=0;i<formatList.length;i++){format=formatList[i];if(matchName(node,format)&&matchItems(node,format,"attributes")&&matchItems(node,format,"styles")){if(classes=format.classes){for(i=0;i<classes.length;i++){if(!dom.hasClass(node,classes[i])){return}}}return format}}}}function match(name,vars,node){var startNode;function matchParents(node){var root=dom.getRoot();if(node===root){return false}node=dom.getParent(node,function(node){if(matchesUnInheritedFormatSelector(node,name)){return true}return node.parentNode===root||!!matchNode(node,name,vars,true)});return matchNode(node,name,vars)}if(node){return matchParents(node)}node=selection.getNode();if(matchParents(node)){return TRUE}startNode=selection.getStart();if(startNode!=node){if(matchParents(startNode)){return TRUE}}return FALSE}function matchAll(names,vars){var startElement,matchedFormatNames=[],checkedMap={};startElement=selection.getStart();dom.getParent(startElement,function(node){var i,name;for(i=0;i<names.length;i++){name=names[i];if(!checkedMap[name]&&matchNode(node,name,vars)){checkedMap[name]=true;matchedFormatNames.push(name)}}},dom.getRoot());return matchedFormatNames}function canApply(name){var formatList=get(name),startNode,parents,i,x,selector;if(formatList){startNode=selection.getStart();parents=getParents(startNode);for(x=formatList.length-1;x>=0;x--){selector=formatList[x].selector;if(!selector||formatList[x].defaultBlock){return TRUE}for(i=parents.length-1;i>=0;i--){if(dom.is(parents[i],selector)){return TRUE}}}}return FALSE}function formatChanged(formats,callback,similar){var currentFormats;if(!formatChangeData){formatChangeData={};currentFormats={};ed.on("NodeChange",function(e){var parents=getParents(e.element),matchedFormats={};parents=Tools.grep(parents,function(node){return node.nodeType==1&&!node.getAttribute("data-mce-bogus")});each(formatChangeData,function(callbacks,format){each(parents,function(node){if(matchNode(node,format,{},callbacks.similar)){if(!currentFormats[format]){each(callbacks,function(callback){callback(true,{node:node,format:format,parents:parents})});currentFormats[format]=callbacks}matchedFormats[format]=callbacks;return false}if(matchesUnInheritedFormatSelector(node,format)){return false}})});each(currentFormats,function(callbacks,format){if(!matchedFormats[format]){delete currentFormats[format];each(callbacks,function(callback){callback(false,{node:e.element,format:format,parents:parents})})}})})}each(formats.split(","),function(format){if(!formatChangeData[format]){formatChangeData[format]=[];formatChangeData[format].similar=similar}formatChangeData[format].push(callback)});return this}function getCssText(format){return Preview.getCssText(ed,format)}extend(this,{get:get,register:register,unregister:unregister,apply:apply,remove:remove,toggle:toggle,match:match,matchAll:matchAll,matchNode:matchNode,canApply:canApply,formatChanged:formatChanged,getCssText:getCssText});defaultFormats();addKeyboardShortcuts();ed.on("BeforeGetContent",function(e){if(markCaretContainersBogus&&e.format!="raw"){markCaretContainersBogus()}});ed.on("mouseup keydown",function(e){if(disableCaretContainer){disableCaretContainer(e)}});function matchName(node,format){if(isEq(node,format.inline)){return TRUE}if(isEq(node,format.block)){return TRUE}if(format.selector){return node.nodeType==1&&dom.is(node,format.selector)}}function isEq(str1,str2){str1=str1||"";str2=str2||"";str1=""+(str1.nodeName||str1);str2=""+(str2.nodeName||str2);return str1.toLowerCase()==str2.toLowerCase()}function getStyle(node,name){return normalizeStyleValue(dom.getStyle(node,name),name)}function normalizeStyleValue(value,name){if(name=="color"||name=="backgroundColor"){value=dom.toHex(value)}if(name=="fontWeight"&&value==700){value="bold"}if(name=="fontFamily"){value=value.replace(/[\'\"]/g,"").replace(/,\s+/g,",")}return""+value}function replaceVars(value,vars){if(typeof value!="string"){value=value(vars)}else if(vars){value=value.replace(/%(\w+)/g,function(str,name){return vars[name]||str})}return value}function isWhiteSpaceNode(node){return node&&node.nodeType===3&&/^([\t \r\n]+|)$/.test(node.nodeValue)}function wrap(node,name,attrs){var wrapper=dom.create(name,attrs);node.parentNode.insertBefore(wrapper,node);wrapper.appendChild(node);return wrapper}function expandRng(rng,format,remove){var lastIdx,leaf,endPoint,startContainer=rng.startContainer,startOffset=rng.startOffset,endContainer=rng.endContainer,endOffset=rng.endOffset;function findParentContainer(start){var container,parent,sibling,siblingName,root;container=parent=start?startContainer:endContainer;siblingName=start?"previousSibling":"nextSibling";root=dom.getRoot();function isBogusBr(node){return node.nodeName=="BR"&&node.getAttribute("data-mce-bogus")&&!node.nextSibling}if(container.nodeType==3&&!isWhiteSpaceNode(container)){if(start?startOffset>0:endOffset<container.nodeValue.length){return container}}while(true){if(!format[0].block_expand&&isBlock(parent)){return parent}for(sibling=parent[siblingName];sibling;sibling=sibling[siblingName]){if(!isBookmarkNode(sibling)&&!isWhiteSpaceNode(sibling)&&!isBogusBr(sibling)){return parent}}if(parent==root||parent.parentNode==root){container=parent;break}parent=parent.parentNode}return container}function findLeaf(node,offset){if(offset===undef){offset=node.nodeType===3?node.length:node.childNodes.length}while(node&&node.hasChildNodes()){node=node.childNodes[offset];if(node){offset=node.nodeType===3?node.length:node.childNodes.length}}return{node:node,offset:offset}}if(startContainer.nodeType==1&&startContainer.hasChildNodes()){lastIdx=startContainer.childNodes.length-1;startContainer=startContainer.childNodes[startOffset>lastIdx?lastIdx:startOffset];if(startContainer.nodeType==3){startOffset=0}}if(endContainer.nodeType==1&&endContainer.hasChildNodes()){lastIdx=endContainer.childNodes.length-1;endContainer=endContainer.childNodes[endOffset>lastIdx?lastIdx:endOffset-1];if(endContainer.nodeType==3){endOffset=endContainer.nodeValue.length}}function findParentContentEditable(node){var parent=node;while(parent){if(parent.nodeType===1&&getContentEditable(parent)){return getContentEditable(parent)==="false"?parent:node}parent=parent.parentNode}return node}function findWordEndPoint(container,offset,start){var walker,node,pos,lastTextNode;function findSpace(node,offset){var pos,pos2,str=node.nodeValue;if(typeof offset=="undefined"){offset=start?str.length:0}if(start){pos=str.lastIndexOf(" ",offset);pos2=str.lastIndexOf("",offset);pos=pos>pos2?pos:pos2;if(pos!==-1&&!remove){pos++}}else{pos=str.indexOf(" ",offset);pos2=str.indexOf("",offset);pos=pos!==-1&&(pos2===-1||pos<pos2)?pos:pos2}return pos}if(container.nodeType===3){pos=findSpace(container,offset);if(pos!==-1){return{container:container,offset:pos}}lastTextNode=container}walker=new TreeWalker(container,dom.getParent(container,isBlock)||ed.getBody());while(node=walker[start?"prev":"next"]()){if(node.nodeType===3){lastTextNode=node;pos=findSpace(node);if(pos!==-1){return{container:node,offset:pos}}}else if(isBlock(node)){break}}if(lastTextNode){if(start){offset=0}else{offset=lastTextNode.length}return{container:lastTextNode,offset:offset}}}function findSelectorEndPoint(container,sibling_name){var parents,i,y,curFormat;if(container.nodeType==3&&container.nodeValue.length===0&&container[sibling_name]){container=container[sibling_name]}parents=getParents(container);for(i=0;i<parents.length;i++){for(y=0;y<format.length;y++){curFormat=format[y];if("collapsed"in curFormat&&curFormat.collapsed!==rng.collapsed){continue}if(dom.is(parents[i],curFormat.selector)){return parents[i]}}}return container}function findBlockEndPoint(container,sibling_name){var node,root=dom.getRoot();if(!format[0].wrapper){node=dom.getParent(container,format[0].block,root)}if(!node){node=dom.getParent(container.nodeType==3?container.parentNode:container,function(node){return node!=root&&isTextBlock(node)})}if(node&&format[0].wrapper){node=getParents(node,"ul,ol").reverse()[0]||node}if(!node){node=container;while(node[sibling_name]&&!isBlock(node[sibling_name])){node=node[sibling_name];if(isEq(node,"br")){break}}}return node||container}startContainer=findParentContentEditable(startContainer);endContainer=findParentContentEditable(endContainer);if(isBookmarkNode(startContainer.parentNode)||isBookmarkNode(startContainer)){startContainer=isBookmarkNode(startContainer)?startContainer:startContainer.parentNode;startContainer=startContainer.nextSibling||startContainer;if(startContainer.nodeType==3){startOffset=0}}if(isBookmarkNode(endContainer.parentNode)||isBookmarkNode(endContainer)){endContainer=isBookmarkNode(endContainer)?endContainer:endContainer.parentNode;endContainer=endContainer.previousSibling||endContainer;if(endContainer.nodeType==3){endOffset=endContainer.length}}if(format[0].inline){if(rng.collapsed){endPoint=findWordEndPoint(startContainer,startOffset,true);if(endPoint){startContainer=endPoint.container;startOffset=endPoint.offset}endPoint=findWordEndPoint(endContainer,endOffset);if(endPoint){endContainer=endPoint.container;endOffset=endPoint.offset}}leaf=findLeaf(endContainer,endOffset);if(leaf.node){while(leaf.node&&leaf.offset===0&&leaf.node.previousSibling){leaf=findLeaf(leaf.node.previousSibling)}if(leaf.node&&leaf.offset>0&&leaf.node.nodeType===3&&leaf.node.nodeValue.charAt(leaf.offset-1)===" "){if(leaf.offset>1){endContainer=leaf.node;endContainer.splitText(leaf.offset-1)}}}}if(format[0].inline||format[0].block_expand){if(!format[0].inline||(startContainer.nodeType!=3||startOffset===0)){startContainer=findParentContainer(true)}if(!format[0].inline||(endContainer.nodeType!=3||endOffset===endContainer.nodeValue.length)){endContainer=findParentContainer()}}if(format[0].selector&&format[0].expand!==FALSE&&!format[0].inline){startContainer=findSelectorEndPoint(startContainer,"previousSibling");endContainer=findSelectorEndPoint(endContainer,"nextSibling")}if(format[0].block||format[0].selector){startContainer=findBlockEndPoint(startContainer,"previousSibling");endContainer=findBlockEndPoint(endContainer,"nextSibling");if(format[0].block){if(!isBlock(startContainer)){startContainer=findParentContainer(true)}if(!isBlock(endContainer)){endContainer=findParentContainer()}}}if(startContainer.nodeType==1){startOffset=nodeIndex(startContainer);startContainer=startContainer.parentNode}if(endContainer.nodeType==1){endOffset=nodeIndex(endContainer)+1;endContainer=endContainer.parentNode}return{startContainer:startContainer,startOffset:startOffset,endContainer:endContainer,endOffset:endOffset}}function isColorFormatAndAnchor(node,format){return format.links&&node.tagName=="A"}function removeFormat(format,vars,node,compare_node){var i,attrs,stylesModified;if(!matchName(node,format)&&!isColorFormatAndAnchor(node,format)){return FALSE}if(format.remove!="all"){each(format.styles,function(value,name){value=normalizeStyleValue(replaceVars(value,vars),name);if(typeof name==="number"){name=value;compare_node=0}if(format.remove_similar||(!compare_node||isEq(getStyle(compare_node,name),value))){dom.setStyle(node,name,"")}stylesModified=1});if(stylesModified&&dom.getAttrib(node,"style")===""){node.removeAttribute("style");node.removeAttribute("data-mce-style")}each(format.attributes,function(value,name){var valueOut;value=replaceVars(value,vars);if(typeof name==="number"){name=value;compare_node=0}if(!compare_node||isEq(dom.getAttrib(compare_node,name),value)){if(name=="class"){value=dom.getAttrib(node,name);if(value){valueOut="";each(value.split(/\s+/),function(cls){if(/mce\-\w+/.test(cls)){valueOut+=(valueOut?" ":"")+cls}});if(valueOut){dom.setAttrib(node,name,valueOut);return}}}if(name=="class"){node.removeAttribute("className")}if(MCE_ATTR_RE.test(name)){node.removeAttribute("data-mce-"+name)}node.removeAttribute(name)}});each(format.classes,function(value){value=replaceVars(value,vars);if(!compare_node||dom.hasClass(compare_node,value)){dom.removeClass(node,value)}});attrs=dom.getAttribs(node);for(i=0;i<attrs.length;i++){if(attrs[i].nodeName.indexOf("_")!==0){return FALSE}}}if(format.remove!="none"){removeNode(node,format);return TRUE}}function removeNode(node,format){var parentNode=node.parentNode,rootBlockElm;function find(node,next,inc){node=getNonWhiteSpaceSibling(node,next,inc);return!node||(node.nodeName=="BR"||isBlock(node))}if(format.block){if(!forcedRootBlock){if(isBlock(node)&&!isBlock(parentNode)){if(!find(node,FALSE)&&!find(node.firstChild,TRUE,1)){node.insertBefore(dom.create("br"),node.firstChild)}if(!find(node,TRUE)&&!find(node.lastChild,FALSE,1)){node.appendChild(dom.create("br"))}}}else{if(parentNode==dom.getRoot()){if(!format.list_block||!isEq(node,format.list_block)){each(grep(node.childNodes),function(node){if(isValid(forcedRootBlock,node.nodeName.toLowerCase())){if(!rootBlockElm){rootBlockElm=wrap(node,forcedRootBlock);dom.setAttribs(rootBlockElm,ed.settings.forced_root_block_attrs)}else{rootBlockElm.appendChild(node)}}else{rootBlockElm=0}})}}}}if(format.selector&&format.inline&&!isEq(format.inline,node)){return}dom.remove(node,1)}function getNonWhiteSpaceSibling(node,next,inc){if(node){next=next?"nextSibling":"previousSibling";for(node=inc?node:node[next];node;node=node[next]){if(node.nodeType==1||!isWhiteSpaceNode(node)){return node}}}}function mergeSiblings(prev,next){var sibling,tmpSibling,elementUtils=new ElementUtils(dom);function findElementSibling(node,sibling_name){for(sibling=node;sibling;sibling=sibling[sibling_name]){if(sibling.nodeType==3&&sibling.nodeValue.length!==0){return node}if(sibling.nodeType==1&&!isBookmarkNode(sibling)){return sibling}}return node}if(prev&&next){prev=findElementSibling(prev,"previousSibling");next=findElementSibling(next,"nextSibling");if(elementUtils.compare(prev,next)){for(sibling=prev.nextSibling;sibling&&sibling!=next;){tmpSibling=sibling;sibling=sibling.nextSibling;prev.appendChild(tmpSibling)}dom.remove(next);each(grep(next.childNodes),function(node){prev.appendChild(node)});return prev}}return next}function getContainer(rng,start){var container,offset,lastIdx;container=rng[start?"startContainer":"endContainer"];offset=rng[start?"startOffset":"endOffset"];if(container.nodeType==1){lastIdx=container.childNodes.length-1;if(!start&&offset){offset--}container=container.childNodes[offset>lastIdx?lastIdx:offset]}if(container.nodeType===3&&start&&offset>=container.nodeValue.length){container=new TreeWalker(container,ed.getBody()).next()||container}if(container.nodeType===3&&!start&&offset===0){container=new TreeWalker(container,ed.getBody()).prev()||container}return container}function performCaretAction(type,name,vars,similar){var caretContainerId="_mce_caret",debug=ed.settings.caret_debug;function createCaretContainer(fill){var caretContainer=dom.create("span",{id:caretContainerId,"data-mce-bogus":true,style:debug?"color:red":""});if(fill){caretContainer.appendChild(ed.getDoc().createTextNode(INVISIBLE_CHAR))}return caretContainer}function isCaretContainerEmpty(node,nodes){while(node){if(node.nodeType===3&&node.nodeValue!==INVISIBLE_CHAR||node.childNodes.length>1){return false}if(nodes&&node.nodeType===1){nodes.push(node)}node=node.firstChild}return true}function getParentCaretContainer(node){while(node){if(node.id===caretContainerId){return node}node=node.parentNode}}function findFirstTextNode(node){var walker;if(node){walker=new TreeWalker(node,node);for(node=walker.current();node;node=walker.next()){if(node.nodeType===3){return node}}}}function removeCaretContainer(node,move_caret){var child,rng;if(!node){node=getParentCaretContainer(selection.getStart());if(!node){while(node=dom.get(caretContainerId)){removeCaretContainer(node,false)}}}else{rng=selection.getRng(true);if(isCaretContainerEmpty(node)){if(move_caret!==false){rng.setStartBefore(node);rng.setEndBefore(node)}dom.remove(node)}else{child=findFirstTextNode(node);if(child.nodeValue.charAt(0)===INVISIBLE_CHAR){child.deleteData(0,1);if(rng.startContainer==child&&rng.startOffset>0){rng.setStart(child,rng.startOffset-1)}if(rng.endContainer==child&&rng.endOffset>0){rng.setEnd(child,rng.endOffset-1)}}dom.remove(node,1)}selection.setRng(rng)}}function applyCaretFormat(){var rng,caretContainer,textNode,offset,bookmark,container,text;rng=selection.getRng(true);offset=rng.startOffset;container=rng.startContainer;text=container.nodeValue;caretContainer=getParentCaretContainer(selection.getStart());if(caretContainer){textNode=findFirstTextNode(caretContainer)}if(text&&offset>0&&offset<text.length&&/\w/.test(text.charAt(offset))&&/\w/.test(text.charAt(offset-1))){bookmark=selection.getBookmark();rng.collapse(true);rng=expandRng(rng,get(name));rng=rangeUtils.split(rng);apply(name,vars,rng);selection.moveToBookmark(bookmark)}else{if(!caretContainer||textNode.nodeValue!==INVISIBLE_CHAR){caretContainer=createCaretContainer(true);textNode=caretContainer.firstChild;rng.insertNode(caretContainer);offset=1;apply(name,vars,caretContainer)}else{apply(name,vars,caretContainer)}selection.setCursorLocation(textNode,offset)}}function removeCaretFormat(){var rng=selection.getRng(true),container,offset,bookmark,hasContentAfter,node,formatNode,parents=[],i,caretContainer;container=rng.startContainer;offset=rng.startOffset;node=container;if(container.nodeType==3){if(offset!=container.nodeValue.length){hasContentAfter=true}node=node.parentNode}while(node){if(matchNode(node,name,vars,similar)){formatNode=node;break}if(node.nextSibling){hasContentAfter=true}parents.push(node);node=node.parentNode}if(!formatNode){return}if(hasContentAfter){bookmark=selection.getBookmark();rng.collapse(true);rng=expandRng(rng,get(name),true);rng=rangeUtils.split(rng);remove(name,vars,rng);selection.moveToBookmark(bookmark)}else{caretContainer=createCaretContainer();node=caretContainer;for(i=parents.length-1;i>=0;i--){node.appendChild(dom.clone(parents[i],false));node=node.firstChild}node.appendChild(dom.doc.createTextNode(INVISIBLE_CHAR));node=node.firstChild;var block=dom.getParent(formatNode,isTextBlock);if(block&&dom.isEmpty(block)){formatNode.parentNode.replaceChild(caretContainer,formatNode)}else{dom.insertAfter(caretContainer,formatNode)}selection.setCursorLocation(node,1);if(dom.isEmpty(formatNode)){dom.remove(formatNode)}}}function unmarkBogusCaretParents(){var caretContainer;caretContainer=getParentCaretContainer(selection.getStart());if(caretContainer&&!dom.isEmpty(caretContainer)){walk(caretContainer,function(node){if(node.nodeType==1&&node.id!==caretContainerId&&!dom.isEmpty(node)){dom.setAttrib(node,"data-mce-bogus",null)}},"childNodes")}}if(!ed._hasCaretEvents){markCaretContainersBogus=function(){var nodes=[],i;if(isCaretContainerEmpty(getParentCaretContainer(selection.getStart()),nodes)){i=nodes.length;while(i--){dom.setAttrib(nodes[i],"data-mce-bogus","1")}}};disableCaretContainer=function(e){var keyCode=e.keyCode;removeCaretContainer();if(keyCode==8&&selection.isCollapsed()&&selection.getStart().innerHTML==INVISIBLE_CHAR){removeCaretContainer(getParentCaretContainer(selection.getStart()))}if(keyCode==37||keyCode==39){removeCaretContainer(getParentCaretContainer(selection.getStart()))}unmarkBogusCaretParents()};ed.on("SetContent",function(e){if(e.selection){unmarkBogusCaretParents()}});ed._hasCaretEvents=true}if(type=="apply"){applyCaretFormat()}else{removeCaretFormat()}}function moveStart(rng){var container=rng.startContainer,offset=rng.startOffset,isAtEndOfText,walker,node,nodes,tmpNode;if(rng.startContainer==rng.endContainer){if(isInlineBlock(rng.startContainer.childNodes[rng.startOffset])){return}}if(container.nodeType==3&&offset>=container.nodeValue.length){offset=nodeIndex(container);container=container.parentNode;isAtEndOfText=true}if(container.nodeType==1){nodes=container.childNodes;container=nodes[Math.min(offset,nodes.length-1)];walker=new TreeWalker(container,dom.getParent(container,dom.isBlock));if(offset>nodes.length-1||isAtEndOfText){walker.next()}for(node=walker.current();node;node=walker.next()){if(node.nodeType==3&&!isWhiteSpaceNode(node)){tmpNode=dom.create("a",{"data-mce-bogus":"all"},INVISIBLE_CHAR);node.parentNode.insertBefore(tmpNode,node);rng.setStart(node,0);selection.setRng(rng);dom.remove(tmpNode);return}}}}}});define("tinymce/UndoManager",["tinymce/util/VK","tinymce/Env"],function(VK,Env){return function(editor){var self=this,index=0,data=[],beforeBookmark,isFirstTypedCharacter,locks=0;function getContent(){return editor.serializer.getTrimmedContent()}function setDirty(state){editor.setDirty(state)}function addNonTypingUndoLevel(e){self.typing=false;self.add({},e)}editor.on("init",function(){self.add()});editor.on("BeforeExecCommand",function(e){var cmd=e.command;if(cmd!="Undo"&&cmd!="Redo"&&cmd!="mceRepaint"){self.beforeChange()}});editor.on("ExecCommand",function(e){var cmd=e.command;if(cmd!="Undo"&&cmd!="Redo"&&cmd!="mceRepaint"){addNonTypingUndoLevel(e)}});editor.on("ObjectResizeStart Cut",function(){self.beforeChange()});editor.on("SaveContent ObjectResized blur",addNonTypingUndoLevel);editor.on("DragEnd",addNonTypingUndoLevel);editor.on("KeyUp",function(e){var keyCode=e.keyCode;if(e.isDefaultPrevented()){return}if(keyCode>=33&&keyCode<=36||keyCode>=37&&keyCode<=40||keyCode==45||keyCode==13||e.ctrlKey){addNonTypingUndoLevel();editor.nodeChanged()}if(keyCode==46||keyCode==8||Env.mac&&(keyCode==91||keyCode==93)){editor.nodeChanged()}if(isFirstTypedCharacter&&self.typing){if(!editor.isDirty()){setDirty(data[0]&&getContent()!=data[0].content);if(editor.isDirty()){editor.fire("change",{level:data[0],lastLevel:null})}}editor.fire("TypingUndo");isFirstTypedCharacter=false;editor.nodeChanged()}});editor.on("KeyDown",function(e){var keyCode=e.keyCode;if(e.isDefaultPrevented()){return}if(keyCode>=33&&keyCode<=36||keyCode>=37&&keyCode<=40||keyCode==45){if(self.typing){addNonTypingUndoLevel(e)}return}var modKey=e.ctrlKey&&!e.altKey||e.metaKey;if((keyCode<16||keyCode>20)&&keyCode!=224&&keyCode!=91&&!self.typing&&!modKey){self.beforeChange();self.typing=true;self.add({},e);isFirstTypedCharacter=true}});editor.on("MouseDown",function(e){if(self.typing){addNonTypingUndoLevel(e)}});editor.addShortcut("meta+z","","Undo");editor.addShortcut("meta+y,meta+shift+z","","Redo");editor.on("AddUndo Undo Redo ClearUndos",function(e){if(!e.isDefaultPrevented()){editor.nodeChanged()}});self={data:data,typing:false,beforeChange:function(){if(!locks){beforeBookmark=editor.selection.getBookmark(2,true)}},add:function(level,event){var i,settings=editor.settings,lastLevel;level=level||{};level.content=getContent();if(locks||editor.removed){return null}lastLevel=data[index];if(editor.fire("BeforeAddUndo",{level:level,lastLevel:lastLevel,originalEvent:event}).isDefaultPrevented()){return null}if(lastLevel&&lastLevel.content==level.content){return null}if(data[index]){data[index].beforeBookmark=beforeBookmark}if(settings.custom_undo_redo_levels){if(data.length>settings.custom_undo_redo_levels){for(i=0;i<data.length-1;i++){data[i]=data[i+1]}data.length--;index=data.length}}level.bookmark=editor.selection.getBookmark(2,true);if(index<data.length-1){data.length=index+1}data.push(level);index=data.length-1;var args={level:level,lastLevel:lastLevel,originalEvent:event};editor.fire("AddUndo",args);if(index>0){setDirty(true);editor.fire("change",args)}return level},undo:function(){var level;if(self.typing){self.add();self.typing=false}if(index>0){level=data[--index];editor.setContent(level.content,{format:"raw"});editor.selection.moveToBookmark(level.beforeBookmark);setDirty(true);editor.fire("undo",{level:level})}return level},redo:function(){var level;if(index<data.length-1){level=data[++index];editor.setContent(level.content,{format:"raw"});editor.selection.moveToBookmark(level.bookmark);setDirty(true);editor.fire("redo",{level:level})}return level},clear:function(){data=[];index=0;self.typing=false;editor.fire("ClearUndos")},hasUndo:function(){return index>0||self.typing&&data[0]&&getContent()!=data[0].content},hasRedo:function(){return index<data.length-1&&!this.typing},transact:function(callback){self.beforeChange();try{locks++;callback()}finally{locks--}self.add()}};return self}});define("tinymce/EnterKey",["tinymce/dom/TreeWalker","tinymce/dom/RangeUtils","tinymce/Env"],function(TreeWalker,RangeUtils,Env){var isIE=Env.ie&&Env.ie<11;return function(editor){var dom=editor.dom,selection=editor.selection,settings=editor.settings;var undoManager=editor.undoManager,schema=editor.schema,nonEmptyElementsMap=schema.getNonEmptyElements(),moveCaretBeforeOnEnterElementsMap=schema.getMoveCaretBeforeOnEnterElements();function handleEnterKey(evt){var rng,tmpRng,editableRoot,container,offset,parentBlock,documentMode,shiftKey,newBlock,fragment,containerBlock,parentBlockName,containerBlockName,newBlockName,isAfterLastNodeInContainer;function canSplitBlock(node){return node&&dom.isBlock(node)&&!/^(TD|TH|CAPTION|FORM)$/.test(node.nodeName)&&!/^(fixed|absolute)/i.test(node.style.position)&&dom.getContentEditable(node)!=="true"}function isTableCell(node){return node&&/^(TD|TH|CAPTION)$/.test(node.nodeName)}function renderBlockOnIE(block){var oldRng;if(dom.isBlock(block)){oldRng=selection.getRng();block.appendChild(dom.create("span",null,""));selection.select(block);block.lastChild.outerHTML="";selection.setRng(oldRng)}}function trimInlineElementsOnLeftSideOfBlock(block){var node=block,firstChilds=[],i;if(!node){return}while(node=node.firstChild){if(dom.isBlock(node)){return}if(node.nodeType==1&&!nonEmptyElementsMap[node.nodeName.toLowerCase()]){firstChilds.push(node)}}i=firstChilds.length;while(i--){node=firstChilds[i];if(!node.hasChildNodes()||node.firstChild==node.lastChild&&node.firstChild.nodeValue===""){dom.remove(node)}else{if(node.nodeName=="A"&&(node.innerText||node.textContent)===" "){dom.remove(node)}}}}function moveToCaretPosition(root){var walker,node,rng,lastNode=root,tempElm;function firstNonWhiteSpaceNodeSibling(node){while(node){if(node.nodeType==1||node.nodeType==3&&node.data&&/[\r\n\s]/.test(node.data)){return node}node=node.nextSibling}}if(!root){return}if(Env.ie&&Env.ie<9&&parentBlock&&parentBlock.firstChild){if(parentBlock.firstChild==parentBlock.lastChild&&parentBlock.firstChild.tagName=="BR"){dom.remove(parentBlock.firstChild)}}if(/^(LI|DT|DD)$/.test(root.nodeName)){var firstChild=firstNonWhiteSpaceNodeSibling(root.firstChild);
if(firstChild&&/^(UL|OL|DL)$/.test(firstChild.nodeName)){root.insertBefore(dom.doc.createTextNode(""),root.firstChild)}}rng=dom.createRng();if(!Env.ie){root.normalize()}if(root.hasChildNodes()){walker=new TreeWalker(root,root);while(node=walker.current()){if(node.nodeType==3){rng.setStart(node,0);rng.setEnd(node,0);break}if(moveCaretBeforeOnEnterElementsMap[node.nodeName.toLowerCase()]){rng.setStartBefore(node);rng.setEndBefore(node);break}lastNode=node;node=walker.next()}if(!node){rng.setStart(lastNode,0);rng.setEnd(lastNode,0)}}else{if(root.nodeName=="BR"){if(root.nextSibling&&dom.isBlock(root.nextSibling)){if(!documentMode||documentMode<9){tempElm=dom.create("br");root.parentNode.insertBefore(tempElm,root)}rng.setStartBefore(root);rng.setEndBefore(root)}else{rng.setStartAfter(root);rng.setEndAfter(root)}}else{rng.setStart(root,0);rng.setEnd(root,0)}}selection.setRng(rng);dom.remove(tempElm);selection.scrollIntoView(root)}function setForcedBlockAttrs(node){var forcedRootBlockName=settings.forced_root_block;if(forcedRootBlockName&&forcedRootBlockName.toLowerCase()===node.tagName.toLowerCase()){dom.setAttribs(node,settings.forced_root_block_attrs)}}function emptyBlock(elm){elm.innerHTML=!isIE?'<br data-mce-bogus="1">':""}function createNewBlock(name){var node=container,block,clonedNode,caretNode,textInlineElements=schema.getTextInlineElements();if(name||parentBlockName=="TABLE"){block=dom.create(name||newBlockName);setForcedBlockAttrs(block)}else{block=parentBlock.cloneNode(false)}caretNode=block;if(settings.keep_styles!==false){do{if(textInlineElements[node.nodeName]){if(node.id=="_mce_caret"){continue}clonedNode=node.cloneNode(false);dom.setAttrib(clonedNode,"id","");if(block.hasChildNodes()){clonedNode.appendChild(block.firstChild);block.appendChild(clonedNode)}else{caretNode=clonedNode;block.appendChild(clonedNode)}}}while((node=node.parentNode)&&node!=editableRoot)}if(!isIE){caretNode.innerHTML='<br data-mce-bogus="1">'}return block}function isCaretAtStartOrEndOfBlock(start){var walker,node,name;if(container.nodeType==3&&(start?offset>0:offset<container.nodeValue.length)){return false}if(container.parentNode==parentBlock&&isAfterLastNodeInContainer&&!start){return true}if(start&&container.nodeType==1&&container==parentBlock.firstChild){return true}if(container.nodeName==="TABLE"||container.previousSibling&&container.previousSibling.nodeName=="TABLE"){return isAfterLastNodeInContainer&&!start||!isAfterLastNodeInContainer&&start}walker=new TreeWalker(container,parentBlock);if(container.nodeType==3){if(start&&offset===0){walker.prev()}else if(!start&&offset==container.nodeValue.length){walker.next()}}while(node=walker.current()){if(node.nodeType===1){if(!node.getAttribute("data-mce-bogus")){name=node.nodeName.toLowerCase();if(nonEmptyElementsMap[name]&&name!=="br"){return false}}}else if(node.nodeType===3&&!/^[ \t\r\n]*$/.test(node.nodeValue)){return false}if(start){walker.prev()}else{walker.next()}}return true}function wrapSelfAndSiblingsInDefaultBlock(container,offset){var newBlock,parentBlock,startNode,node,next,rootBlockName,blockName=newBlockName||"P";parentBlock=dom.getParent(container,dom.isBlock);if(!parentBlock||!canSplitBlock(parentBlock)){parentBlock=parentBlock||editableRoot;if(parentBlock==editor.getBody()||isTableCell(parentBlock)){rootBlockName=parentBlock.nodeName.toLowerCase()}else{rootBlockName=parentBlock.parentNode.nodeName.toLowerCase()}if(!parentBlock.hasChildNodes()){newBlock=dom.create(blockName);setForcedBlockAttrs(newBlock);parentBlock.appendChild(newBlock);rng.setStart(newBlock,0);rng.setEnd(newBlock,0);return newBlock}node=container;while(node.parentNode!=parentBlock){node=node.parentNode}while(node&&!dom.isBlock(node)){startNode=node;node=node.previousSibling}if(startNode&&schema.isValidChild(rootBlockName,blockName.toLowerCase())){newBlock=dom.create(blockName);setForcedBlockAttrs(newBlock);startNode.parentNode.insertBefore(newBlock,startNode);node=startNode;while(node&&!dom.isBlock(node)){next=node.nextSibling;newBlock.appendChild(node);node=next}rng.setStart(container,offset);rng.setEnd(container,offset)}}return container}function handleEmptyListItem(){function isFirstOrLastLi(first){var node=containerBlock[first?"firstChild":"lastChild"];while(node){if(node.nodeType==1){break}node=node[first?"nextSibling":"previousSibling"]}return node===parentBlock}function getContainerBlock(){var containerBlockParent=containerBlock.parentNode;if(/^(LI|DT|DD)$/.test(containerBlockParent.nodeName)){return containerBlockParent}return containerBlock}if(containerBlock==editor.getBody()){return}var containerBlockParentName=containerBlock.parentNode.nodeName;if(/^(OL|UL|LI)$/.test(containerBlockParentName)){newBlockName="LI"}newBlock=newBlockName?createNewBlock(newBlockName):dom.create("BR");if(isFirstOrLastLi(true)&&isFirstOrLastLi()){if(containerBlockParentName=="LI"){dom.insertAfter(newBlock,getContainerBlock())}else{dom.replace(newBlock,containerBlock)}}else if(isFirstOrLastLi(true)){if(containerBlockParentName=="LI"){dom.insertAfter(newBlock,getContainerBlock());newBlock.appendChild(dom.doc.createTextNode(" "));newBlock.appendChild(containerBlock)}else{containerBlock.parentNode.insertBefore(newBlock,containerBlock)}}else if(isFirstOrLastLi()){dom.insertAfter(newBlock,getContainerBlock());renderBlockOnIE(newBlock)}else{containerBlock=getContainerBlock();tmpRng=rng.cloneRange();tmpRng.setStartAfter(parentBlock);tmpRng.setEndAfter(containerBlock);fragment=tmpRng.extractContents();if(newBlockName=="LI"&&fragment.firstChild.nodeName=="LI"){newBlock=fragment.firstChild;dom.insertAfter(fragment,containerBlock)}else{dom.insertAfter(fragment,containerBlock);dom.insertAfter(newBlock,containerBlock)}}dom.remove(parentBlock);moveToCaretPosition(newBlock);undoManager.add()}function insertBr(){editor.execCommand("InsertLineBreak",false,evt)}function trimLeadingLineBreaks(node){do{if(node.nodeType===3){node.nodeValue=node.nodeValue.replace(/^[\r\n]+/,"")}node=node.firstChild}while(node)}function getEditableRoot(node){var root=dom.getRoot(),parent,editableRoot;parent=node;while(parent!==root&&dom.getContentEditable(parent)!=="false"){if(dom.getContentEditable(parent)==="true"){editableRoot=parent}parent=parent.parentNode}return parent!==root?editableRoot:root}function addBrToBlockIfNeeded(block){var lastChild;if(!isIE){block.normalize();lastChild=block.lastChild;if(!lastChild||/^(left|right)$/gi.test(dom.getStyle(lastChild,"float",true))){dom.add(block,"br")}}}function insertNewBlockAfter(){if(/^(H[1-6]|PRE|FIGURE)$/.test(parentBlockName)&&containerBlockName!="HGROUP"){newBlock=createNewBlock(newBlockName)}else{newBlock=createNewBlock()}if(settings.end_container_on_empty_block&&canSplitBlock(containerBlock)&&dom.isEmpty(parentBlock)){newBlock=dom.split(containerBlock,parentBlock)}else{dom.insertAfter(newBlock,parentBlock)}moveToCaretPosition(newBlock)}rng=selection.getRng(true);if(evt.isDefaultPrevented()){return}if(!rng.collapsed){editor.execCommand("Delete");return}new RangeUtils(dom).normalize(rng);container=rng.startContainer;offset=rng.startOffset;newBlockName=(settings.force_p_newlines?"p":"")||settings.forced_root_block;newBlockName=newBlockName?newBlockName.toUpperCase():"";documentMode=dom.doc.documentMode;shiftKey=evt.shiftKey;if(container.nodeType==1&&container.hasChildNodes()){isAfterLastNodeInContainer=offset>container.childNodes.length-1;container=container.childNodes[Math.min(offset,container.childNodes.length-1)]||container;if(isAfterLastNodeInContainer&&container.nodeType==3){offset=container.nodeValue.length}else{offset=0}}editableRoot=getEditableRoot(container);if(!editableRoot){return}undoManager.beforeChange();if(!dom.isBlock(editableRoot)&&editableRoot!=dom.getRoot()){if(!newBlockName||shiftKey){insertBr()}return}if(newBlockName&&!shiftKey||!newBlockName&&shiftKey){container=wrapSelfAndSiblingsInDefaultBlock(container,offset)}parentBlock=dom.getParent(container,dom.isBlock);containerBlock=parentBlock?dom.getParent(parentBlock.parentNode,dom.isBlock):null;parentBlockName=parentBlock?parentBlock.nodeName.toUpperCase():"";containerBlockName=containerBlock?containerBlock.nodeName.toUpperCase():"";if(containerBlockName=="LI"&&!evt.ctrlKey){parentBlock=containerBlock;parentBlockName=containerBlockName}if(/^(LI|DT|DD)$/.test(parentBlockName)){if(!newBlockName&&shiftKey){insertBr();return}if(dom.isEmpty(parentBlock)){handleEmptyListItem();return}}if(parentBlockName=="PRE"&&settings.br_in_pre!==false){if(!shiftKey){insertBr();return}}else{if(!newBlockName&&!shiftKey&&parentBlockName!="LI"||newBlockName&&shiftKey){insertBr();return}}if(newBlockName&&parentBlock===editor.getBody()){return}newBlockName=newBlockName||"P";if(isCaretAtStartOrEndOfBlock()){insertNewBlockAfter()}else if(isCaretAtStartOrEndOfBlock(true)){newBlock=parentBlock.parentNode.insertBefore(createNewBlock(),parentBlock);renderBlockOnIE(newBlock);moveToCaretPosition(parentBlock)}else{tmpRng=rng.cloneRange();tmpRng.setEndAfter(parentBlock);fragment=tmpRng.extractContents();trimLeadingLineBreaks(fragment);newBlock=fragment.firstChild;dom.insertAfter(fragment,parentBlock);trimInlineElementsOnLeftSideOfBlock(newBlock);addBrToBlockIfNeeded(parentBlock);if(dom.isEmpty(parentBlock)){emptyBlock(parentBlock)}newBlock.normalize();if(dom.isEmpty(newBlock)){dom.remove(newBlock);insertNewBlockAfter()}else{moveToCaretPosition(newBlock)}}dom.setAttrib(newBlock,"id","");editor.fire("NewBlock",{newBlock:newBlock});undoManager.add()}editor.on("keydown",function(evt){if(evt.keyCode==13){if(handleEnterKey(evt)!==false){evt.preventDefault()}}})}});define("tinymce/ForceBlocks",[],function(){return function(editor){var settings=editor.settings,dom=editor.dom,selection=editor.selection;var schema=editor.schema,blockElements=schema.getBlockElements();function addRootBlocks(){var node=selection.getStart(),rootNode=editor.getBody(),rng;var startContainer,startOffset,endContainer,endOffset,rootBlockNode;var tempNode,offset=-16777215,wrapped,restoreSelection;var tmpRng,rootNodeName,forcedRootBlock;forcedRootBlock=settings.forced_root_block;if(!node||node.nodeType!==1||!forcedRootBlock){return}while(node&&node!=rootNode){if(blockElements[node.nodeName]){return}node=node.parentNode}rng=selection.getRng();if(rng.setStart){startContainer=rng.startContainer;startOffset=rng.startOffset;endContainer=rng.endContainer;endOffset=rng.endOffset;try{restoreSelection=editor.getDoc().activeElement===rootNode}catch(ex){}}else{if(rng.item){node=rng.item(0);rng=editor.getDoc().body.createTextRange();rng.moveToElementText(node)}restoreSelection=rng.parentElement().ownerDocument===editor.getDoc();tmpRng=rng.duplicate();tmpRng.collapse(true);startOffset=tmpRng.move("character",offset)*-1;if(!tmpRng.collapsed){tmpRng=rng.duplicate();tmpRng.collapse(false);endOffset=tmpRng.move("character",offset)*-1-startOffset}}node=rootNode.firstChild;rootNodeName=rootNode.nodeName.toLowerCase();while(node){if((node.nodeType===3||node.nodeType==1&&!blockElements[node.nodeName])&&schema.isValidChild(rootNodeName,forcedRootBlock.toLowerCase())){if(node.nodeType===3&&node.nodeValue.length===0){tempNode=node;node=node.nextSibling;dom.remove(tempNode);continue}if(!rootBlockNode){rootBlockNode=dom.create(forcedRootBlock,editor.settings.forced_root_block_attrs);node.parentNode.insertBefore(rootBlockNode,node);wrapped=true}tempNode=node;node=node.nextSibling;rootBlockNode.appendChild(tempNode)}else{rootBlockNode=null;node=node.nextSibling}}if(wrapped&&restoreSelection){if(rng.setStart){rng.setStart(startContainer,startOffset);rng.setEnd(endContainer,endOffset);selection.setRng(rng)}else{try{rng=editor.getDoc().body.createTextRange();rng.moveToElementText(rootNode);rng.collapse(true);rng.moveStart("character",startOffset);if(endOffset>0){rng.moveEnd("character",endOffset)}rng.select()}catch(ex){}}editor.nodeChanged()}}if(settings.forced_root_block){editor.on("NodeChange",addRootBlocks)}}});define("tinymce/caret/CaretUtils",["tinymce/util/Fun","tinymce/dom/TreeWalker","tinymce/dom/NodeType","tinymce/caret/CaretPosition","tinymce/caret/CaretContainer","tinymce/caret/CaretCandidate"],function(Fun,TreeWalker,NodeType,CaretPosition,CaretContainer,CaretCandidate){var isContentEditableTrue=NodeType.isContentEditableTrue,isContentEditableFalse=NodeType.isContentEditableFalse,isBlockLike=NodeType.matchStyleValues("display","block table table-cell table-caption"),isCaretContainer=CaretContainer.isCaretContainer,curry=Fun.curry,isElement=NodeType.isElement,isCaretCandidate=CaretCandidate.isCaretCandidate;function isForwards(direction){return direction>0}function isBackwards(direction){return direction<0}function findNode(node,direction,predicateFn,rootNode,shallow){var walker=new TreeWalker(node,rootNode);if(isBackwards(direction)){if(isContentEditableFalse(node)){node=walker.prev(true);if(predicateFn(node)){return node}}while(node=walker.prev(shallow)){if(predicateFn(node)){return node}}}if(isForwards(direction)){if(isContentEditableFalse(node)){node=walker.next(true);if(predicateFn(node)){return node}}while(node=walker.next(shallow)){if(predicateFn(node)){return node}}}return null}function getEditingHost(node,rootNode){for(node=node.parentNode;node&&node!=rootNode;node=node.parentNode){if(isContentEditableTrue(node)){return node}}return rootNode}function getParentBlock(node,rootNode){while(node&&node!=rootNode){if(isBlockLike(node)){return node}node=node.parentNode}return null}function isInSameBlock(caretPosition1,caretPosition2,rootNode){return getParentBlock(caretPosition1.container(),rootNode)==getParentBlock(caretPosition2.container(),rootNode)}function isInSameEditingHost(caretPosition1,caretPosition2,rootNode){return getEditingHost(caretPosition1.container(),rootNode)==getEditingHost(caretPosition2.container(),rootNode)}function getChildNodeAtRelativeOffset(relativeOffset,caretPosition){var container,offset;if(!caretPosition){return null}container=caretPosition.container();offset=caretPosition.offset();if(!isElement(container)){return null}return container.childNodes[offset+relativeOffset]}function beforeAfter(before,node){var range=node.ownerDocument.createRange();if(before){range.setStartBefore(node);range.setEndBefore(node)}else{range.setStartAfter(node);range.setEndAfter(node)}return range}function isNodesInSameBlock(rootNode,node1,node2){return getParentBlock(node1,rootNode)==getParentBlock(node2,rootNode)}function lean(left,rootNode,node){var sibling,siblingName;if(left){siblingName="previousSibling"}else{siblingName="nextSibling"}while(node&&node!=rootNode){sibling=node[siblingName];if(isCaretContainer(sibling)){sibling=sibling[siblingName]}if(isContentEditableFalse(sibling)){if(isNodesInSameBlock(rootNode,sibling,node)){return sibling}break}if(isCaretCandidate(sibling)){break}node=node.parentNode}return null}var before=curry(beforeAfter,true);var after=curry(beforeAfter,false);function normalizeRange(direction,rootNode,range){var node,container,offset,location;var leanLeft=curry(lean,true,rootNode);var leanRight=curry(lean,false,rootNode);container=range.startContainer;offset=range.startOffset;if(CaretContainer.isCaretContainerBlock(container)){if(!isElement(container)){container=container.parentNode}location=container.getAttribute("data-mce-caret");if(location=="before"){node=container.nextSibling;if(isContentEditableFalse(node)){return before(node)}}if(location=="after"){node=container.previousSibling;if(isContentEditableFalse(node)){return after(node)}}}if(!range.collapsed){return range}if(NodeType.isText(container)){if(isCaretContainer(container)){if(direction===1){node=leanRight(container);if(node){return before(node)}node=leanLeft(container);if(node){return after(node)}}if(direction===-1){node=leanLeft(container);if(node){return after(node)}node=leanRight(container);if(node){return before(node)}}return range}if(CaretContainer.endsWithCaretContainer(container)&&offset>=container.data.length-1){if(direction===1){node=leanRight(container);if(node){return before(node)}}return range}if(CaretContainer.startsWithCaretContainer(container)&&offset<=1){if(direction===-1){node=leanLeft(container);if(node){return after(node)}}return range}if(offset===container.data.length){node=leanRight(container);if(node){return before(node)}return range}if(offset===0){node=leanLeft(container);if(node){return after(node)}return range}}return range}function isNextToContentEditableFalse(relativeOffset,caretPosition){return isContentEditableFalse(getChildNodeAtRelativeOffset(relativeOffset,caretPosition))}return{isForwards:isForwards,isBackwards:isBackwards,findNode:findNode,getEditingHost:getEditingHost,getParentBlock:getParentBlock,isInSameBlock:isInSameBlock,isInSameEditingHost:isInSameEditingHost,isBeforeContentEditableFalse:curry(isNextToContentEditableFalse,0),isAfterContentEditableFalse:curry(isNextToContentEditableFalse,-1),normalizeRange:normalizeRange}});define("tinymce/caret/CaretWalker",["tinymce/dom/NodeType","tinymce/caret/CaretCandidate","tinymce/caret/CaretPosition","tinymce/caret/CaretUtils","tinymce/util/Arr","tinymce/util/Fun"],function(NodeType,CaretCandidate,CaretPosition,CaretUtils,Arr,Fun){var isContentEditableFalse=NodeType.isContentEditableFalse,isText=NodeType.isText,isElement=NodeType.isElement,isBr=NodeType.isBr,isForwards=CaretUtils.isForwards,isBackwards=CaretUtils.isBackwards,isCaretCandidate=CaretCandidate.isCaretCandidate,isAtomic=CaretCandidate.isAtomic,isEditableCaretCandidate=CaretCandidate.isEditableCaretCandidate;function getParents(node,rootNode){var parents=[];while(node&&node!=rootNode){parents.push(node);node=node.parentNode}return parents}function nodeAtIndex(container,offset){if(container.hasChildNodes()&&offset<container.childNodes.length){return container.childNodes[offset]}return null}function getCaretCandidatePosition(direction,node){if(isForwards(direction)){if(isCaretCandidate(node.previousSibling)&&!isText(node.previousSibling)){return CaretPosition.before(node)}if(isText(node)){return CaretPosition(node,0)}}if(isBackwards(direction)){if(isCaretCandidate(node.nextSibling)&&!isText(node.nextSibling)){return CaretPosition.after(node)}if(isText(node)){return CaretPosition(node,node.data.length)}}if(isBackwards(direction)){if(isBr(node)){return CaretPosition.before(node)}return CaretPosition.after(node)}return CaretPosition.before(node)}function isBrBeforeBlock(node,rootNode){var next;if(!NodeType.isBr(node)){return false}next=findCaretPosition(1,CaretPosition.after(node),rootNode);if(!next){return false}return!CaretUtils.isInSameBlock(CaretPosition.before(node),CaretPosition.before(next),rootNode)}function findCaretPosition(direction,startCaretPosition,rootNode){var container,offset,node,nextNode,innerNode,rootContentEditableFalseElm,caretPosition;if(!isElement(rootNode)||!startCaretPosition){return null}caretPosition=startCaretPosition;container=caretPosition.container();offset=caretPosition.offset();if(isText(container)){if(isBackwards(direction)&&offset>0){return CaretPosition(container,--offset)}if(isForwards(direction)&&offset<container.length){return CaretPosition(container,++offset)}node=container}else{if(isBackwards(direction)&&offset>0){nextNode=nodeAtIndex(container,offset-1);if(isCaretCandidate(nextNode)){if(!isAtomic(nextNode)){innerNode=CaretUtils.findNode(nextNode,direction,isEditableCaretCandidate,nextNode);if(innerNode){if(isText(innerNode)){return CaretPosition(innerNode,innerNode.data.length)}return CaretPosition.after(innerNode)}}if(isText(nextNode)){return CaretPosition(nextNode,nextNode.data.length)}return CaretPosition.before(nextNode)}}if(isForwards(direction)&&offset<container.childNodes.length){nextNode=nodeAtIndex(container,offset);if(isCaretCandidate(nextNode)){if(isBrBeforeBlock(nextNode,rootNode)){return findCaretPosition(direction,CaretPosition.after(nextNode),rootNode)}if(!isAtomic(nextNode)){innerNode=CaretUtils.findNode(nextNode,direction,isEditableCaretCandidate,nextNode);if(innerNode){if(isText(innerNode)){return CaretPosition(innerNode,0)}return CaretPosition.before(innerNode)}}if(isText(nextNode)){return CaretPosition(nextNode,0)}return CaretPosition.after(nextNode)}}node=caretPosition.getNode()}if(isForwards(direction)&&caretPosition.isAtEnd()||isBackwards(direction)&&caretPosition.isAtStart()){node=CaretUtils.findNode(node,direction,Fun.constant(true),rootNode,true);if(isEditableCaretCandidate(node)){return getCaretCandidatePosition(direction,node)}}nextNode=CaretUtils.findNode(node,direction,isEditableCaretCandidate,rootNode);rootContentEditableFalseElm=Arr.last(Arr.filter(getParents(container,rootNode),isContentEditableFalse));if(rootContentEditableFalseElm&&(!nextNode||!rootContentEditableFalseElm.contains(nextNode))){if(isForwards(direction)){caretPosition=CaretPosition.after(rootContentEditableFalseElm)}else{caretPosition=CaretPosition.before(rootContentEditableFalseElm)}return caretPosition}if(nextNode){return getCaretCandidatePosition(direction,nextNode)}return null}return function(rootNode){return{next:function(caretPosition){return findCaretPosition(1,caretPosition,rootNode)},prev:function(caretPosition){return findCaretPosition(-1,caretPosition,rootNode)}}}});define("tinymce/EditorCommands",["tinymce/html/Serializer","tinymce/Env","tinymce/util/Tools","tinymce/dom/ElementUtils","tinymce/dom/RangeUtils","tinymce/dom/TreeWalker","tinymce/caret/CaretWalker","tinymce/caret/CaretPosition","tinymce/dom/NodeType"],function(Serializer,Env,Tools,ElementUtils,RangeUtils,TreeWalker,CaretWalker,CaretPosition,NodeType){var each=Tools.each,extend=Tools.extend;var map=Tools.map,inArray=Tools.inArray,explode=Tools.explode;var isIE=Env.ie,isOldIE=Env.ie&&Env.ie<11;var TRUE=true,FALSE=false,isTableCell=NodeType.matchNodeNames("td th");return function(editor){var dom,selection,formatter,commands={state:{},exec:{},value:{}},settings=editor.settings,bookmark;editor.on("PreInit",function(){dom=editor.dom;selection=editor.selection;settings=editor.settings;formatter=editor.formatter});function execCommand(command,ui,value,args){var func,customCommand,state=0;if(!/^(mceAddUndoLevel|mceEndUndoLevel|mceBeginUndoLevel|mceRepaint)$/.test(command)&&(!args||!args.skip_focus)){editor.focus()}args=editor.fire("BeforeExecCommand",{command:command,ui:ui,value:value});if(args.isDefaultPrevented()){return false}customCommand=command.toLowerCase();if(func=commands.exec[customCommand]){func(customCommand,ui,value);editor.fire("ExecCommand",{command:command,ui:ui,value:value});return true}each(editor.plugins,function(p){if(p.execCommand&&p.execCommand(command,ui,value)){editor.fire("ExecCommand",{command:command,ui:ui,value:value});state=true;return false}});if(state){return state}if(editor.theme&&editor.theme.execCommand&&editor.theme.execCommand(command,ui,value)){editor.fire("ExecCommand",{command:command,ui:ui,value:value});return true}try{state=editor.getDoc().execCommand(command,ui,value)}catch(ex){}if(state){editor.fire("ExecCommand",{command:command,ui:ui,value:value});return true}return false}function queryCommandState(command){var func;if(editor.quirks.isHidden()){return}command=command.toLowerCase();if(func=commands.state[command]){return func(command)}try{return editor.getDoc().queryCommandState(command)}catch(ex){}return false}function queryCommandValue(command){var func;if(editor.quirks.isHidden()){return}command=command.toLowerCase();if(func=commands.value[command]){return func(command)}try{return editor.getDoc().queryCommandValue(command)}catch(ex){}}function addCommands(command_list,type){type=type||"exec";each(command_list,function(callback,command){each(command.toLowerCase().split(","),function(command){commands[type][command]=callback})})}function addCommand(command,callback,scope){command=command.toLowerCase();commands.exec[command]=function(command,ui,value,args){return callback.call(scope||editor,ui,value,args)}}function queryCommandSupported(command){command=command.toLowerCase();if(commands.exec[command]){return true}try{return editor.getDoc().queryCommandSupported(command)}catch(ex){}return false}function addQueryStateHandler(command,callback,scope){command=command.toLowerCase();commands.state[command]=function(){return callback.call(scope||editor)}}function addQueryValueHandler(command,callback,scope){command=command.toLowerCase();commands.value[command]=function(){return callback.call(scope||editor)}}function hasCustomCommand(command){command=command.toLowerCase();return!!commands.exec[command]}extend(this,{execCommand:execCommand,queryCommandState:queryCommandState,queryCommandValue:queryCommandValue,queryCommandSupported:queryCommandSupported,addCommands:addCommands,addCommand:addCommand,addQueryStateHandler:addQueryStateHandler,addQueryValueHandler:addQueryValueHandler,hasCustomCommand:hasCustomCommand});function execNativeCommand(command,ui,value){if(ui===undefined){ui=FALSE}if(value===undefined){value=null}return editor.getDoc().execCommand(command,ui,value)}function isFormatMatch(name){return formatter.match(name)}function toggleFormat(name,value){formatter.toggle(name,value?{value:value}:undefined);editor.nodeChanged()}function storeSelection(type){bookmark=selection.getBookmark(type)}function restoreSelection(){selection.moveToBookmark(bookmark)}addCommands({"mceResetDesignMode,mceBeginUndoLevel":function(){},"mceEndUndoLevel,mceAddUndoLevel":function(){editor.undoManager.add()},"Cut,Copy,Paste":function(command){var doc=editor.getDoc(),failed;try{execNativeCommand(command)}catch(ex){failed=TRUE}if(command==="paste"&&!doc.queryCommandEnabled(command)){failed=true}if(failed||!doc.queryCommandSupported(command)){var msg=editor.translate("Your browser doesn't support direct access to the clipboard. "+"Please use the Ctrl+X/C/V keyboard shortcuts instead.");if(Env.mac){msg=msg.replace(/Ctrl\+/g,"+")}editor.notificationManager.open({text:msg,type:"error"})}},unlink:function(){if(selection.isCollapsed()){var elm=selection.getNode();if(elm.tagName=="A"){editor.dom.remove(elm,true)}return}formatter.remove("link")},"JustifyLeft,JustifyCenter,JustifyRight,JustifyFull,JustifyNone":function(command){var align=command.substring(7);if(align=="full"){align="justify"}each("left,center,right,justify".split(","),function(name){if(align!=name){formatter.remove("align"+name)}});if(align!="none"){toggleFormat("align"+align)}},"InsertUnorderedList,InsertOrderedList":function(command){var listElm,listParent;execNativeCommand(command);listElm=dom.getParent(selection.getNode(),"ol,ul");if(listElm){listParent=listElm.parentNode;if(/^(H[1-6]|P|ADDRESS|PRE)$/.test(listParent.nodeName)){storeSelection();dom.split(listParent,listElm);restoreSelection()}}},"Bold,Italic,Underline,Strikethrough,Superscript,Subscript":function(command){toggleFormat(command)},"ForeColor,HiliteColor,FontName":function(command,ui,value){toggleFormat(command,value)},FontSize:function(command,ui,value){var fontClasses,fontSizes;if(value>=1&&value<=7){fontSizes=explode(settings.font_size_style_values);fontClasses=explode(settings.font_size_classes);if(fontClasses){value=fontClasses[value-1]||value}else{value=fontSizes[value-1]||value}}toggleFormat(command,value)},RemoveFormat:function(command){formatter.remove(command)},mceBlockQuote:function(){toggleFormat("blockquote")},FormatBlock:function(command,ui,value){return toggleFormat(value||"p")},mceCleanup:function(){var bookmark=selection.getBookmark();editor.setContent(editor.getContent({cleanup:TRUE}),{cleanup:TRUE});selection.moveToBookmark(bookmark)},mceRemoveNode:function(command,ui,value){var node=value||selection.getNode();if(node!=editor.getBody()){storeSelection();editor.dom.remove(node,TRUE);restoreSelection()}},mceSelectNodeDepth:function(command,ui,value){var counter=0;dom.getParent(selection.getNode(),function(node){if(node.nodeType==1&&counter++==value){selection.select(node);return FALSE}},editor.getBody())},mceSelectNode:function(command,ui,value){selection.select(value)},mceInsertContent:function(command,ui,value){var parser,serializer,parentNode,rootNode,fragment,args;var marker,rng,node,node2,bookmarkHtml,merge,data;var textInlineElements=editor.schema.getTextInlineElements();function trimOrPaddLeftRight(html){var rng,container,offset;rng=selection.getRng(true);container=rng.startContainer;offset=rng.startOffset;function hasSiblingText(siblingName){return container[siblingName]&&container[siblingName].nodeType==3}if(container.nodeType==3){if(offset>0){html=html.replace(/^&nbsp;/," ")}else if(!hasSiblingText("previousSibling")){html=html.replace(/^ /,"&nbsp;")}if(offset<container.length){html=html.replace(/&nbsp;(<br>|)$/," ")}else if(!hasSiblingText("nextSibling")){html=html.replace(/(&nbsp;| )(<br>|)$/,"&nbsp;")}}return html}function trimNbspAfterDeleteAndPaddValue(){var rng,container,offset;rng=selection.getRng(true);container=rng.startContainer;offset=rng.startOffset;if(container.nodeType==3&&rng.collapsed){if(container.data[offset]===""){container.deleteData(offset,1);if(!/[\u00a0| ]$/.test(value)){value+=" "}}else if(container.data[offset-1]===""){container.deleteData(offset-1,1);if(!/[\u00a0| ]$/.test(value)){value=" "+value}}}}function markInlineFormatElements(fragment){if(merge){for(node=fragment.firstChild;node;node=node.walk(true)){if(textInlineElements[node.name]){node.attr("data-mce-new","true")}}}}function reduceInlineTextElements(){if(merge){var root=editor.getBody(),elementUtils=new ElementUtils(dom);each(dom.select("*[data-mce-new]"),function(node){node.removeAttribute("data-mce-new");for(var testNode=node.parentNode;testNode&&testNode!=root;testNode=testNode.parentNode){if(elementUtils.compare(testNode,node)){dom.remove(node,true)}}})}}function markFragmentElements(fragment){var node=fragment;while(node=node.walk()){if(node.type===1){node.attr("data-mce-fragment","1")}}}function umarkFragmentElements(elm){Tools.each(elm.getElementsByTagName("*"),function(elm){elm.removeAttribute("data-mce-fragment")})}function isPartOfFragment(node){return!!node.getAttribute("data-mce-fragment")}function canHaveChildren(node){return node&&!editor.schema.getShortEndedElements()[node.nodeName]}function moveSelectionToMarker(marker){var parentEditableFalseElm,parentBlock,nextRng;function getContentEditableFalseParent(node){var root=editor.getBody();for(;node&&node!==root;node=node.parentNode){if(editor.dom.getContentEditable(node)==="false"){return node}}return null}if(!marker){return}selection.scrollIntoView(marker);parentEditableFalseElm=getContentEditableFalseParent(marker);if(parentEditableFalseElm){dom.remove(marker);selection.select(parentEditableFalseElm);return}rng=dom.createRng();node=marker.previousSibling;if(node&&node.nodeType==3){rng.setStart(node,node.nodeValue.length);if(!isIE){node2=marker.nextSibling;if(node2&&node2.nodeType==3){node.appendData(node2.data);node2.parentNode.removeChild(node2)}}}else{rng.setStartBefore(marker);rng.setEndBefore(marker)}function findNextCaretRng(rng){var caretPos=CaretPosition.fromRangeStart(rng);var caretWalker=new CaretWalker(editor.getBody());caretPos=caretWalker.next(caretPos);if(caretPos){return caretPos.toRange()}}parentBlock=dom.getParent(marker,dom.isBlock);dom.remove(marker);if(parentBlock&&dom.isEmpty(parentBlock)){editor.$(parentBlock).empty();rng.setStart(parentBlock,0);rng.setEnd(parentBlock,0);if(!isTableCell(parentBlock)&&!isPartOfFragment(parentBlock)&&(nextRng=findNextCaretRng(rng))){rng=nextRng;dom.remove(parentBlock)}else{dom.add(parentBlock,dom.create("br",{"data-mce-bogus":"1"}))}}selection.setRng(rng)}if(typeof value!="string"){merge=value.merge;data=value.data;value=value.content}if(/^ | $/.test(value)){value=trimOrPaddLeftRight(value)}parser=editor.parser;serializer=new Serializer({validate:settings.validate},editor.schema);bookmarkHtml='<span id="mce_marker" data-mce-type="bookmark">&#xFEFF;&#x200B;</span>';args={content:value,format:"html",selection:true};editor.fire("BeforeSetContent",args);value=args.content;if(value.indexOf("{$caret}")==-1){value+="{$caret}"}value=value.replace(/\{\$caret\}/,bookmarkHtml);rng=selection.getRng();
var caretElement=rng.startContainer||(rng.parentElement?rng.parentElement():null);var body=editor.getBody();if(caretElement===body&&selection.isCollapsed()){if(dom.isBlock(body.firstChild)&&canHaveChildren(body.firstChild)&&dom.isEmpty(body.firstChild)){rng=dom.createRng();rng.setStart(body.firstChild,0);rng.setEnd(body.firstChild,0);selection.setRng(rng)}}if(!selection.isCollapsed()){editor.selection.setRng(editor.selection.getRng());editor.getDoc().execCommand("Delete",false,null);trimNbspAfterDeleteAndPaddValue()}parentNode=selection.getNode();var parserArgs={context:parentNode.nodeName.toLowerCase(),data:data};fragment=parser.parse(value,parserArgs);markFragmentElements(fragment);markInlineFormatElements(fragment);node=fragment.lastChild;if(node.attr("id")=="mce_marker"){marker=node;for(node=node.prev;node;node=node.walk(true)){if(node.type==3||!dom.isBlock(node.name)){if(editor.schema.isValidChild(node.parent.name,"span")){node.parent.insert(marker,node,node.name==="br")}break}}}editor._selectionOverrides.showBlockCaretContainer(parentNode);if(!parserArgs.invalid){value=serializer.serialize(fragment);node=parentNode.firstChild;node2=parentNode.lastChild;if(!node||node===node2&&node.nodeName==="BR"){dom.setHTML(parentNode,value)}else{selection.setContent(value)}}else{selection.setContent(bookmarkHtml);parentNode=selection.getNode();rootNode=editor.getBody();if(parentNode.nodeType==9){parentNode=node=rootNode}else{node=parentNode}while(node!==rootNode){parentNode=node;node=node.parentNode}value=parentNode==rootNode?rootNode.innerHTML:dom.getOuterHTML(parentNode);value=serializer.serialize(parser.parse(value.replace(/<span (id="mce_marker"|id=mce_marker).+?<\/span>/i,function(){return serializer.serialize(fragment)})));if(parentNode==rootNode){dom.setHTML(rootNode,value)}else{dom.setOuterHTML(parentNode,value)}}reduceInlineTextElements();moveSelectionToMarker(dom.get("mce_marker"));umarkFragmentElements(editor.getBody());editor.fire("SetContent",args);editor.addVisual()},mceInsertRawHTML:function(command,ui,value){selection.setContent("tiny_mce_marker");editor.setContent(editor.getContent().replace(/tiny_mce_marker/g,function(){return value}))},mceToggleFormat:function(command,ui,value){toggleFormat(value)},mceSetContent:function(command,ui,value){editor.setContent(value)},"Indent,Outdent":function(command){var intentValue,indentUnit,value;intentValue=settings.indentation;indentUnit=/[a-z%]+$/i.exec(intentValue);intentValue=parseInt(intentValue,10);if(!queryCommandState("InsertUnorderedList")&&!queryCommandState("InsertOrderedList")){if(!settings.forced_root_block&&!dom.getParent(selection.getNode(),dom.isBlock)){formatter.apply("div")}each(selection.getSelectedBlocks(),function(element){if(dom.getContentEditable(element)==="false"){return}if(element.nodeName!="LI"){var indentStyleName=editor.getParam("indent_use_margin",false)?"margin":"padding";indentStyleName+=dom.getStyle(element,"direction",true)=="rtl"?"Right":"Left";if(command=="outdent"){value=Math.max(0,parseInt(element.style[indentStyleName]||0,10)-intentValue);dom.setStyle(element,indentStyleName,value?value+indentUnit:"")}else{value=parseInt(element.style[indentStyleName]||0,10)+intentValue+indentUnit;dom.setStyle(element,indentStyleName,value)}}})}else{execNativeCommand(command)}},mceRepaint:function(){},InsertHorizontalRule:function(){editor.execCommand("mceInsertContent",false,"<hr />")},mceToggleVisualAid:function(){editor.hasVisual=!editor.hasVisual;editor.addVisual()},mceReplaceContent:function(command,ui,value){editor.execCommand("mceInsertContent",false,value.replace(/\{\$selection\}/g,selection.getContent({format:"text"})))},mceInsertLink:function(command,ui,value){var anchor;if(typeof value=="string"){value={href:value}}anchor=dom.getParent(selection.getNode(),"a");value.href=value.href.replace(" ","%20");if(!anchor||!value.href){formatter.remove("link")}if(value.href){formatter.apply("link",value,anchor)}},selectAll:function(){var root=dom.getRoot(),rng;if(selection.getRng().setStart){rng=dom.createRng();rng.setStart(root,0);rng.setEnd(root,root.childNodes.length);selection.setRng(rng)}else{rng=selection.getRng();if(!rng.item){rng.moveToElementText(root);rng.select()}}},delete:function(){execNativeCommand("Delete");var body=editor.getBody();if(dom.isEmpty(body)){editor.setContent("");if(body.firstChild&&dom.isBlock(body.firstChild)){editor.selection.setCursorLocation(body.firstChild,0)}else{editor.selection.setCursorLocation(body,0)}}},mceNewDocument:function(){editor.setContent("")},InsertLineBreak:function(command,ui,value){var evt=value;var brElm,extraBr,marker;var rng=selection.getRng(true);new RangeUtils(dom).normalize(rng);var offset=rng.startOffset;var container=rng.startContainer;if(container.nodeType==1&&container.hasChildNodes()){var isAfterLastNodeInContainer=offset>container.childNodes.length-1;container=container.childNodes[Math.min(offset,container.childNodes.length-1)]||container;if(isAfterLastNodeInContainer&&container.nodeType==3){offset=container.nodeValue.length}else{offset=0}}var parentBlock=dom.getParent(container,dom.isBlock);var parentBlockName=parentBlock?parentBlock.nodeName.toUpperCase():"";var containerBlock=parentBlock?dom.getParent(parentBlock.parentNode,dom.isBlock):null;var containerBlockName=containerBlock?containerBlock.nodeName.toUpperCase():"";var isControlKey=evt&&evt.ctrlKey;if(containerBlockName=="LI"&&!isControlKey){parentBlock=containerBlock;parentBlockName=containerBlockName}function hasRightSideContent(){var walker=new TreeWalker(container,parentBlock),node;var nonEmptyElementsMap=editor.schema.getNonEmptyElements();while(node=walker.next()){if(nonEmptyElementsMap[node.nodeName.toLowerCase()]||node.length>0){return true}}}if(container&&container.nodeType==3&&offset>=container.nodeValue.length){if(!isOldIE&&!hasRightSideContent()){brElm=dom.create("br");rng.insertNode(brElm);rng.setStartAfter(brElm);rng.setEndAfter(brElm);extraBr=true}}brElm=dom.create("br");rng.insertNode(brElm);var documentMode=dom.doc.documentMode;if(isOldIE&&parentBlockName=="PRE"&&(!documentMode||documentMode<8)){brElm.parentNode.insertBefore(dom.doc.createTextNode("\r"),brElm)}marker=dom.create("span",{},"&nbsp;");brElm.parentNode.insertBefore(marker,brElm);selection.scrollIntoView(marker);dom.remove(marker);if(!extraBr){rng.setStartAfter(brElm);rng.setEndAfter(brElm)}else{rng.setStartBefore(brElm);rng.setEndBefore(brElm)}selection.setRng(rng);editor.undoManager.add();return TRUE}});addCommands({"JustifyLeft,JustifyCenter,JustifyRight,JustifyFull":function(command){var name="align"+command.substring(7);var nodes=selection.isCollapsed()?[dom.getParent(selection.getNode(),dom.isBlock)]:selection.getSelectedBlocks();var matches=map(nodes,function(node){return!!formatter.matchNode(node,name)});return inArray(matches,TRUE)!==-1},"Bold,Italic,Underline,Strikethrough,Superscript,Subscript":function(command){return isFormatMatch(command)},mceBlockQuote:function(){return isFormatMatch("blockquote")},Outdent:function(){var node;if(settings.inline_styles){if((node=dom.getParent(selection.getStart(),dom.isBlock))&&parseInt(node.style.paddingLeft,10)>0){return TRUE}if((node=dom.getParent(selection.getEnd(),dom.isBlock))&&parseInt(node.style.paddingLeft,10)>0){return TRUE}}return queryCommandState("InsertUnorderedList")||queryCommandState("InsertOrderedList")||!settings.inline_styles&&!!dom.getParent(selection.getNode(),"BLOCKQUOTE")},"InsertUnorderedList,InsertOrderedList":function(command){var list=dom.getParent(selection.getNode(),"ul,ol");return list&&(command==="insertunorderedlist"&&list.tagName==="UL"||command==="insertorderedlist"&&list.tagName==="OL")}},"state");addCommands({"FontSize,FontName":function(command){var value=0,parent;if(parent=dom.getParent(selection.getNode(),"span")){if(command=="fontsize"){value=parent.style.fontSize}else{value=parent.style.fontFamily.replace(/, /g,",").replace(/[\'\"]/g,"").toLowerCase()}}return value}},"value");addCommands({Undo:function(){editor.undoManager.undo()},Redo:function(){editor.undoManager.redo()}})}});define("tinymce/util/URI",["tinymce/util/Tools"],function(Tools){var each=Tools.each,trim=Tools.trim;var queryParts="source protocol authority userInfo user password host port relative path directory file query anchor".split(" ");var DEFAULT_PORTS={ftp:21,http:80,https:443,mailto:25};function URI(url,settings){var self=this,baseUri,base_url;url=trim(url);settings=self.settings=settings||{};baseUri=settings.base_uri;if(/^([\w\-]+):([^\/]{2})/i.test(url)||/^\s*#/.test(url)){self.source=url;return}var isProtocolRelative=url.indexOf("//")===0;if(url.indexOf("/")===0&&!isProtocolRelative){url=(baseUri?baseUri.protocol||"http":"http")+"://mce_host"+url}if(!/^[\w\-]*:?\/\//.test(url)){base_url=settings.base_uri?settings.base_uri.path:new URI(location.href).directory;if(settings.base_uri.protocol===""){url="//mce_host"+self.toAbsPath(base_url,url)}else{url=/([^#?]*)([#?]?.*)/.exec(url);url=(baseUri&&baseUri.protocol||"http")+"://mce_host"+self.toAbsPath(base_url,url[1])+url[2]}}url=url.replace(/@@/g,"(mce_at)");url=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@\/]*):?([^:@\/]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/.exec(url);each(queryParts,function(v,i){var part=url[i];if(part){part=part.replace(/\(mce_at\)/g,"@@")}self[v]=part});if(baseUri){if(!self.protocol){self.protocol=baseUri.protocol}if(!self.userInfo){self.userInfo=baseUri.userInfo}if(!self.port&&self.host==="mce_host"){self.port=baseUri.port}if(!self.host||self.host==="mce_host"){self.host=baseUri.host}self.source=""}if(isProtocolRelative){self.protocol=""}}URI.prototype={setPath:function(path){var self=this;path=/^(.*?)\/?(\w+)?$/.exec(path);self.path=path[0];self.directory=path[1];self.file=path[2];self.source="";self.getURI()},toRelative:function(uri){var self=this,output;if(uri==="./"){return uri}uri=new URI(uri,{base_uri:self});if(uri.host!="mce_host"&&self.host!=uri.host&&uri.host||self.port!=uri.port||self.protocol!=uri.protocol&&uri.protocol!==""){return uri.getURI()}var tu=self.getURI(),uu=uri.getURI();if(tu==uu||tu.charAt(tu.length-1)=="/"&&tu.substr(0,tu.length-1)==uu){return tu}output=self.toRelPath(self.path,uri.path);if(uri.query){output+="?"+uri.query}if(uri.anchor){output+="#"+uri.anchor}return output},toAbsolute:function(uri,noHost){uri=new URI(uri,{base_uri:this});return uri.getURI(noHost&&this.isSameOrigin(uri))},isSameOrigin:function(uri){if(this.host==uri.host&&this.protocol==uri.protocol){if(this.port==uri.port){return true}var defaultPort=DEFAULT_PORTS[this.protocol];if(defaultPort&&(this.port||defaultPort)==(uri.port||defaultPort)){return true}}return false},toRelPath:function(base,path){var items,breakPoint=0,out="",i,l;base=base.substring(0,base.lastIndexOf("/"));base=base.split("/");items=path.split("/");if(base.length>=items.length){for(i=0,l=base.length;i<l;i++){if(i>=items.length||base[i]!=items[i]){breakPoint=i+1;break}}}if(base.length<items.length){for(i=0,l=items.length;i<l;i++){if(i>=base.length||base[i]!=items[i]){breakPoint=i+1;break}}}if(breakPoint===1){return path}for(i=0,l=base.length-(breakPoint-1);i<l;i++){out+="../"}for(i=breakPoint-1,l=items.length;i<l;i++){if(i!=breakPoint-1){out+="/"+items[i]}else{out+=items[i]}}return out},toAbsPath:function(base,path){var i,nb=0,o=[],tr,outPath;tr=/\/$/.test(path)?"/":"";base=base.split("/");path=path.split("/");each(base,function(k){if(k){o.push(k)}});base=o;for(i=path.length-1,o=[];i>=0;i--){if(path[i].length===0||path[i]==="."){continue}if(path[i]===".."){nb++;continue}if(nb>0){nb--;continue}o.push(path[i])}i=base.length-nb;if(i<=0){outPath=o.reverse().join("/")}else{outPath=base.slice(0,i).join("/")+"/"+o.reverse().join("/")}if(outPath.indexOf("/")!==0){outPath="/"+outPath}if(tr&&outPath.lastIndexOf("/")!==outPath.length-1){outPath+=tr}return outPath},getURI:function(noProtoHost){var s,self=this;if(!self.source||noProtoHost){s="";if(!noProtoHost){if(self.protocol){s+=self.protocol+"://"}else{s+="//"}if(self.userInfo){s+=self.userInfo+"@"}if(self.host){s+=self.host}if(self.port){s+=":"+self.port}}if(self.path){s+=self.path}if(self.query){s+="?"+self.query}if(self.anchor){s+="#"+self.anchor}self.source=s}return self.source}};URI.parseDataUri=function(uri){var type,matches;uri=decodeURIComponent(uri).split(",");matches=/data:([^;]+)/.exec(uri[0]);if(matches){type=matches[1]}return{type:type,data:uri[1]}};URI.getDocumentBaseUrl=function(loc){var baseUrl;if(loc.protocol.indexOf("http")!==0&&loc.protocol!=="file:"){baseUrl=loc.href}else{baseUrl=loc.protocol+"//"+loc.host+loc.pathname}if(/^[^:]+:\/\/\/?[^\/]+\//.test(baseUrl)){baseUrl=baseUrl.replace(/[\?#].*$/,"").replace(/[\/\\][^\/]+$/,"");if(!/[\/\\]$/.test(baseUrl)){baseUrl+="/"}}return baseUrl};return URI});define("tinymce/util/Class",["tinymce/util/Tools"],function(Tools){var each=Tools.each,extend=Tools.extend;var extendClass,initializing;function Class(){}Class.extend=extendClass=function(prop){var self=this,_super=self.prototype,prototype,name,member;function Class(){var i,mixins,mixin,self=this;if(!initializing){if(self.init){self.init.apply(self,arguments)}mixins=self.Mixins;if(mixins){i=mixins.length;while(i--){mixin=mixins[i];if(mixin.init){mixin.init.apply(self,arguments)}}}}}function dummy(){return this}function createMethod(name,fn){return function(){var self=this,tmp=self._super,ret;self._super=_super[name];ret=fn.apply(self,arguments);self._super=tmp;return ret}}initializing=true;prototype=new self;initializing=false;if(prop.Mixins){each(prop.Mixins,function(mixin){for(var name in mixin){if(name!=="init"){prop[name]=mixin[name]}}});if(_super.Mixins){prop.Mixins=_super.Mixins.concat(prop.Mixins)}}if(prop.Methods){each(prop.Methods.split(","),function(name){prop[name]=dummy})}if(prop.Properties){each(prop.Properties.split(","),function(name){var fieldName="_"+name;prop[name]=function(value){var self=this,undef;if(value!==undef){self[fieldName]=value;return self}return self[fieldName]}})}if(prop.Statics){each(prop.Statics,function(func,name){Class[name]=func})}if(prop.Defaults&&_super.Defaults){prop.Defaults=extend({},_super.Defaults,prop.Defaults)}for(name in prop){member=prop[name];if(typeof member=="function"&&_super[name]){prototype[name]=createMethod(name,member)}else{prototype[name]=member}}Class.prototype=prototype;Class.constructor=Class;Class.extend=extendClass;return Class};return Class});define("tinymce/util/EventDispatcher",["tinymce/util/Tools"],function(Tools){var nativeEvents=Tools.makeMap("focus blur focusin focusout click dblclick mousedown mouseup mousemove mouseover beforepaste paste cut copy selectionchange "+"mouseout mouseenter mouseleave wheel keydown keypress keyup input contextmenu dragstart dragend dragover "+"draggesture dragdrop drop drag submit "+"compositionstart compositionend compositionupdate touchstart touchend"," ");function Dispatcher(settings){var self=this,scope,bindings={},toggleEvent;function returnFalse(){return false}function returnTrue(){return true}settings=settings||{};scope=settings.scope||self;toggleEvent=settings.toggleEvent||returnFalse;function fire(name,args){var handlers,i,l,callback;name=name.toLowerCase();args=args||{};args.type=name;if(!args.target){args.target=scope}if(!args.preventDefault){args.preventDefault=function(){args.isDefaultPrevented=returnTrue};args.stopPropagation=function(){args.isPropagationStopped=returnTrue};args.stopImmediatePropagation=function(){args.isImmediatePropagationStopped=returnTrue};args.isDefaultPrevented=returnFalse;args.isPropagationStopped=returnFalse;args.isImmediatePropagationStopped=returnFalse}if(settings.beforeFire){settings.beforeFire(args)}handlers=bindings[name];if(handlers){for(i=0,l=handlers.length;i<l;i++){callback=handlers[i];if(callback.once){off(name,callback.func)}if(args.isImmediatePropagationStopped()){args.stopPropagation();return args}if(callback.func.call(scope,args)===false){args.preventDefault();return args}}}return args}function on(name,callback,prepend,extra){var handlers,names,i;if(callback===false){callback=returnFalse}if(callback){callback={func:callback};if(extra){Tools.extend(callback,extra)}names=name.toLowerCase().split(" ");i=names.length;while(i--){name=names[i];handlers=bindings[name];if(!handlers){handlers=bindings[name]=[];toggleEvent(name,true)}if(prepend){handlers.unshift(callback)}else{handlers.push(callback)}}}return self}function off(name,callback){var i,handlers,bindingName,names,hi;if(name){names=name.toLowerCase().split(" ");i=names.length;while(i--){name=names[i];handlers=bindings[name];if(!name){for(bindingName in bindings){toggleEvent(bindingName,false);delete bindings[bindingName]}return self}if(handlers){if(!callback){handlers.length=0}else{hi=handlers.length;while(hi--){if(handlers[hi].func===callback){handlers=handlers.slice(0,hi).concat(handlers.slice(hi+1));bindings[name]=handlers}}}if(!handlers.length){toggleEvent(name,false);delete bindings[name]}}}}else{for(name in bindings){toggleEvent(name,false)}bindings={}}return self}function once(name,callback,prepend){return on(name,callback,prepend,{once:true})}function has(name){name=name.toLowerCase();return!(!bindings[name]||bindings[name].length===0)}self.fire=fire;self.on=on;self.off=off;self.once=once;self.has=has}Dispatcher.isNative=function(name){return!!nativeEvents[name.toLowerCase()]};return Dispatcher});define("tinymce/data/Binding",[],function(){function Binding(settings){this.create=settings.create}Binding.create=function(model,name){return new Binding({create:function(otherModel,otherName){var bindings;function fromSelfToOther(e){otherModel.set(otherName,e.value)}function fromOtherToSelf(e){model.set(name,e.value)}otherModel.on("change:"+otherName,fromOtherToSelf);model.on("change:"+name,fromSelfToOther);bindings=otherModel._bindings;if(!bindings){bindings=otherModel._bindings=[];otherModel.on("destroy",function(){var i=bindings.length;while(i--){bindings[i]()}})}bindings.push(function(){model.off("change:"+name,fromSelfToOther)});return model.get(name)}})};return Binding});define("tinymce/util/Observable",["tinymce/util/EventDispatcher"],function(EventDispatcher){function getEventDispatcher(obj){if(!obj._eventDispatcher){obj._eventDispatcher=new EventDispatcher({scope:obj,toggleEvent:function(name,state){if(EventDispatcher.isNative(name)&&obj.toggleNativeEvent){obj.toggleNativeEvent(name,state)}}})}return obj._eventDispatcher}return{fire:function(name,args,bubble){var self=this;if(self.removed&&name!=="remove"){return args}args=getEventDispatcher(self).fire(name,args,bubble);if(bubble!==false&&self.parent){var parent=self.parent();while(parent&&!args.isPropagationStopped()){parent.fire(name,args,false);parent=parent.parent()}}return args},on:function(name,callback,prepend){return getEventDispatcher(this).on(name,callback,prepend)},off:function(name,callback){return getEventDispatcher(this).off(name,callback)},once:function(name,callback){return getEventDispatcher(this).once(name,callback)},hasEventListeners:function(name){return getEventDispatcher(this).has(name)}}});define("tinymce/data/ObservableObject",["tinymce/data/Binding","tinymce/util/Observable","tinymce/util/Class","tinymce/util/Tools"],function(Binding,Observable,Class,Tools){function isNode(node){return node.nodeType>0}function isEqual(a,b){var k,checked;if(a===b){return true}if(a===null||b===null){return a===b}if(typeof a!=="object"||typeof b!=="object"){return a===b}if(Tools.isArray(b)){if(a.length!==b.length){return false}k=a.length;while(k--){if(!isEqual(a[k],b[k])){return false}}}if(isNode(a)||isNode(b)){return a===b}checked={};for(k in b){if(!isEqual(a[k],b[k])){return false}checked[k]=true}for(k in a){if(!checked[k]&&!isEqual(a[k],b[k])){return false}}return true}return Class.extend({Mixins:[Observable],init:function(data){var name,value;data=data||{};for(name in data){value=data[name];if(value instanceof Binding){data[name]=value.create(this,name)}}this.data=data},set:function(name,value){var key,args,oldValue=this.data[name];if(value instanceof Binding){value=value.create(this,name)}if(typeof name==="object"){for(key in name){this.set(key,name[key])}return this}if(!isEqual(oldValue,value)){this.data[name]=value;args={target:this,name:name,value:value,oldValue:oldValue};this.fire("change:"+name,args);this.fire("change",args)}return this},get:function(name){return this.data[name]},has:function(name){return name in this.data},bind:function(name){return Binding.create(this,name)},destroy:function(){this.fire("destroy")}})});define("tinymce/ui/Selector",["tinymce/util/Class"],function(Class){"use strict";function unique(array){var uniqueItems=[],i=array.length,item;while(i--){item=array[i];if(!item.__checked){uniqueItems.push(item);item.__checked=1}}i=uniqueItems.length;while(i--){delete uniqueItems[i].__checked}return uniqueItems}var expression=/^([\w\\*]+)?(?:#([\w\-\\]+))?(?:\.([\w\\\.]+))?(?:\[\@?([\w\\]+)([\^\$\*!~]?=)([\w\\]+)\])?(?:\:(.+))?/i;var chunker=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,whiteSpace=/^\s*|\s*$/g,Collection;var Selector=Class.extend({init:function(selector){var match=this.match;function compileNameFilter(name){if(name){name=name.toLowerCase();return function(item){return name==="*"||item.type===name}}}function compileIdFilter(id){if(id){return function(item){return item._name===id}}}function compileClassesFilter(classes){if(classes){classes=classes.split(".");return function(item){var i=classes.length;while(i--){if(!item.classes.contains(classes[i])){return false}}return true}}}function compileAttrFilter(name,cmp,check){if(name){return function(item){var value=item[name]?item[name]():"";return!cmp?!!check:cmp==="="?value===check:cmp==="*="?value.indexOf(check)>=0:cmp==="~="?(" "+value+" ").indexOf(" "+check+" ")>=0:cmp==="!="?value!=check:cmp==="^="?value.indexOf(check)===0:cmp==="$="?value.substr(value.length-check.length)===check:false}}}function compilePsuedoFilter(name){var notSelectors;if(name){name=/(?:not\((.+)\))|(.+)/i.exec(name);if(!name[1]){name=name[2];return function(item,index,length){return name==="first"?index===0:name==="last"?index===length-1:name==="even"?index%2===0:name==="odd"?index%2===1:item[name]?item[name]():false}}notSelectors=parseChunks(name[1],[]);return function(item){return!match(item,notSelectors)}}}function compile(selector,filters,direct){var parts;function add(filter){if(filter){filters.push(filter)}}parts=expression.exec(selector.replace(whiteSpace,""));add(compileNameFilter(parts[1]));add(compileIdFilter(parts[2]));add(compileClassesFilter(parts[3]));add(compileAttrFilter(parts[4],parts[5],parts[6]));add(compilePsuedoFilter(parts[7]));filters.pseudo=!!parts[7];filters.direct=direct;return filters}function parseChunks(selector,selectors){var parts=[],extra,matches,i;do{chunker.exec("");matches=chunker.exec(selector);if(matches){selector=matches[3];parts.push(matches[1]);if(matches[2]){extra=matches[3];break}}}while(matches);if(extra){parseChunks(extra,selectors)}selector=[];for(i=0;i<parts.length;i++){if(parts[i]!=">"){selector.push(compile(parts[i],[],parts[i-1]===">"))}}selectors.push(selector);return selectors}this._selectors=parseChunks(selector,[])},match:function(control,selectors){var i,l,si,sl,selector,fi,fl,filters,index,length,siblings,count,item;selectors=selectors||this._selectors;for(i=0,l=selectors.length;i<l;i++){selector=selectors[i];sl=selector.length;item=control;count=0;for(si=sl-1;si>=0;si--){filters=selector[si];while(item){if(filters.pseudo){siblings=item.parent().items();index=length=siblings.length;while(index--){if(siblings[index]===item){break}}}for(fi=0,fl=filters.length;fi<fl;fi++){if(!filters[fi](item,index,length)){fi=fl+1;break}}if(fi===fl){count++;break}else{if(si===sl-1){break}}item=item.parent()}}if(count===sl){return true}}return false},find:function(container){var matches=[],i,l,selectors=this._selectors;function collect(items,selector,index){var i,l,fi,fl,item,filters=selector[index];for(i=0,l=items.length;i<l;i++){item=items[i];for(fi=0,fl=filters.length;fi<fl;fi++){if(!filters[fi](item,i,l)){fi=fl+1;break}}if(fi===fl){if(index==selector.length-1){matches.push(item)}else{if(item.items){collect(item.items(),selector,index+1)}}}else if(filters.direct){return}if(item.items){collect(item.items(),selector,index)}}}if(container.items){for(i=0,l=selectors.length;i<l;i++){collect(container.items(),selectors[i],0)}if(l>1){matches=unique(matches)}}if(!Collection){Collection=Selector.Collection}return new Collection(matches)}});return Selector});define("tinymce/ui/Collection",["tinymce/util/Tools","tinymce/ui/Selector","tinymce/util/Class"],function(Tools,Selector,Class){"use strict";var Collection,proto,push=Array.prototype.push,slice=Array.prototype.slice;proto={length:0,init:function(items){if(items){this.add(items)}},add:function(items){var self=this;if(!Tools.isArray(items)){if(items instanceof Collection){self.add(items.toArray())}else{push.call(self,items)}}else{push.apply(self,items)}return self},set:function(items){var self=this,len=self.length,i;self.length=0;self.add(items);for(i=self.length;i<len;i++){delete self[i]}return self},filter:function(selector){var self=this,i,l,matches=[],item,match;if(typeof selector==="string"){selector=new Selector(selector);match=function(item){return selector.match(item)}}else{match=selector}for(i=0,l=self.length;i<l;i++){item=self[i];if(match(item)){matches.push(item)}}return new Collection(matches)},slice:function(){return new Collection(slice.apply(this,arguments))},eq:function(index){return index===-1?this.slice(index):this.slice(index,+index+1)},each:function(callback){Tools.each(this,callback);return this},toArray:function(){return Tools.toArray(this)},indexOf:function(ctrl){var self=this,i=self.length;while(i--){if(self[i]===ctrl){break}}return i},reverse:function(){return new Collection(Tools.toArray(this).reverse())},hasClass:function(cls){return this[0]?this[0].classes.contains(cls):false},prop:function(name,value){var self=this,undef,item;if(value!==undef){self.each(function(item){if(item[name]){item[name](value)}});return self}item=self[0];if(item&&item[name]){return item[name]()}},exec:function(name){var self=this,args=Tools.toArray(arguments).slice(1);self.each(function(item){if(item[name]){item[name].apply(item,args)}});return self},remove:function(){var i=this.length;while(i--){this[i].remove()}return this},addClass:function(cls){return this.each(function(item){item.classes.add(cls)})},removeClass:function(cls){return this.each(function(item){item.classes.remove(cls)})}};Tools.each("fire on off show hide append prepend before after reflow".split(" "),function(name){proto[name]=function(){var args=Tools.toArray(arguments);this.each(function(ctrl){if(name in ctrl){ctrl[name].apply(ctrl,args)}});return this}});Tools.each("text name disabled active selected checked visible parent value data".split(" "),function(name){proto[name]=function(value){return this.prop(name,value)}});Collection=Class.extend(proto);Selector.Collection=Collection;return Collection});define("tinymce/ui/DomUtils",["tinymce/util/Tools","tinymce/dom/DOMUtils"],function(Tools,DOMUtils){"use strict";var count=0;return{id:function(){return"mceu_"+count++},create:function(name,attrs,children){var elm=document.createElement(name);DOMUtils.DOM.setAttribs(elm,attrs);if(typeof children==="string"){elm.innerHTML=children}else{Tools.each(children,function(child){if(child.nodeType){elm.appendChild(child)}})}return elm},createFragment:function(html){return DOMUtils.DOM.createFragment(html)},getWindowSize:function(){return DOMUtils.DOM.getViewPort()},getSize:function(elm){var width,height;if(elm.getBoundingClientRect){var rect=elm.getBoundingClientRect();width=Math.max(rect.width||rect.right-rect.left,elm.offsetWidth);height=Math.max(rect.height||rect.bottom-rect.bottom,elm.offsetHeight)}else{width=elm.offsetWidth;height=elm.offsetHeight}return{width:width,height:height}},getPos:function(elm,root){return DOMUtils.DOM.getPos(elm,root)},getViewPort:function(win){return DOMUtils.DOM.getViewPort(win)},get:function(id){return document.getElementById(id)},addClass:function(elm,cls){return DOMUtils.DOM.addClass(elm,cls)},removeClass:function(elm,cls){return DOMUtils.DOM.removeClass(elm,cls)},hasClass:function(elm,cls){return DOMUtils.DOM.hasClass(elm,cls)},toggleClass:function(elm,cls,state){return DOMUtils.DOM.toggleClass(elm,cls,state)},css:function(elm,name,value){return DOMUtils.DOM.setStyle(elm,name,value)},getRuntimeStyle:function(elm,name){return DOMUtils.DOM.getStyle(elm,name,true)},on:function(target,name,callback,scope){return DOMUtils.DOM.bind(target,name,callback,scope)},off:function(target,name,callback){return DOMUtils.DOM.unbind(target,name,callback)},fire:function(target,name,args){return DOMUtils.DOM.fire(target,name,args)},innerHtml:function(elm,html){DOMUtils.DOM.setHTML(elm,html)}}});define("tinymce/ui/BoxUtils",[],function(){"use strict";return{parseBox:function(value){var len,radix=10;if(!value){return}if(typeof value==="number"){value=value||0;return{top:value,left:value,bottom:value,right:value}}value=value.split(" ");len=value.length;if(len===1){value[1]=value[2]=value[3]=value[0]}else if(len===2){value[2]=value[0];value[3]=value[1]}else if(len===3){value[3]=value[1]}return{top:parseInt(value[0],radix)||0,right:parseInt(value[1],radix)||0,bottom:parseInt(value[2],radix)||0,left:parseInt(value[3],radix)||0}},measureBox:function(elm,prefix){function getStyle(name){var defaultView=document.defaultView;if(defaultView){name=name.replace(/[A-Z]/g,function(a){return"-"+a});return defaultView.getComputedStyle(elm,null).getPropertyValue(name)}return elm.currentStyle[name]}function getSide(name){var val=parseFloat(getStyle(name),10);return isNaN(val)?0:val}return{top:getSide(prefix+"TopWidth"),right:getSide(prefix+"RightWidth"),bottom:getSide(prefix+"BottomWidth"),left:getSide(prefix+"LeftWidth")}}}});define("tinymce/ui/ClassList",["tinymce/util/Tools"],function(Tools){"use strict";function noop(){}function ClassList(onchange){this.cls=[];this.cls._map={};this.onchange=onchange||noop;this.prefix=""}Tools.extend(ClassList.prototype,{add:function(cls){if(cls&&!this.contains(cls)){this.cls._map[cls]=true;this.cls.push(cls);this._change()}return this},remove:function(cls){if(this.contains(cls)){for(var i=0;i<this.cls.length;i++){if(this.cls[i]===cls){break}}this.cls.splice(i,1);delete this.cls._map[cls];this._change()}return this},toggle:function(cls,state){var curState=this.contains(cls);if(curState!==state){if(curState){this.remove(cls)}else{this.add(cls)}this._change()}return this},contains:function(cls){return!!this.cls._map[cls]},_change:function(){delete this.clsValue;this.onchange.call(this)}});ClassList.prototype.toString=function(){var value;if(this.clsValue){return this.clsValue}value="";for(var i=0;i<this.cls.length;i++){if(i>0){value+=" "}value+=this.prefix+this.cls[i]}return value};return ClassList});define("tinymce/ui/ReflowQueue",["tinymce/util/Delay"],function(Delay){var dirtyCtrls={},animationFrameRequested;return{add:function(ctrl){var parent=ctrl.parent();if(parent){if(!parent._layout||parent._layout.isNative()){return}if(!dirtyCtrls[parent._id]){dirtyCtrls[parent._id]=parent}if(!animationFrameRequested){animationFrameRequested=true;Delay.requestAnimationFrame(function(){var id,ctrl;animationFrameRequested=false;for(id in dirtyCtrls){ctrl=dirtyCtrls[id];if(ctrl.state.get("rendered")){ctrl.reflow()}}dirtyCtrls={}},document.body)}}},remove:function(ctrl){if(dirtyCtrls[ctrl._id]){delete dirtyCtrls[ctrl._id]}}}});define("tinymce/ui/Control",["tinymce/util/Class","tinymce/util/Tools","tinymce/util/EventDispatcher","tinymce/data/ObservableObject","tinymce/ui/Collection","tinymce/ui/DomUtils","tinymce/dom/DomQuery","tinymce/ui/BoxUtils","tinymce/ui/ClassList","tinymce/ui/ReflowQueue"],function(Class,Tools,EventDispatcher,ObservableObject,Collection,DomUtils,$,BoxUtils,ClassList,ReflowQueue){
"use strict";var hasMouseWheelEventSupport="onmousewheel"in document;var hasWheelEventSupport=false;var classPrefix="mce-";var Control,idCounter=0;var proto={Statics:{classPrefix:classPrefix},isRtl:function(){return Control.rtl},classPrefix:classPrefix,init:function(settings){var self=this,classes,defaultClasses;function applyClasses(classes){var i;classes=classes.split(" ");for(i=0;i<classes.length;i++){self.classes.add(classes[i])}}self.settings=settings=Tools.extend({},self.Defaults,settings);self._id=settings.id||"mceu_"+idCounter++;self._aria={role:settings.role};self._elmCache={};self.$=$;self.state=new ObservableObject({visible:true,active:false,disabled:false,value:""});self.data=new ObservableObject(settings.data);self.classes=new ClassList(function(){if(self.state.get("rendered")){self.getEl().className=this.toString()}});self.classes.prefix=self.classPrefix;classes=settings.classes;if(classes){if(self.Defaults){defaultClasses=self.Defaults.classes;if(defaultClasses&&classes!=defaultClasses){applyClasses(defaultClasses)}}applyClasses(classes)}Tools.each("title text name visible disabled active value".split(" "),function(name){if(name in settings){self[name](settings[name])}});self.on("click",function(){if(self.disabled()){return false}});self.settings=settings;self.borderBox=BoxUtils.parseBox(settings.border);self.paddingBox=BoxUtils.parseBox(settings.padding);self.marginBox=BoxUtils.parseBox(settings.margin);if(settings.hidden){self.hide()}},Properties:"parent,name",getContainerElm:function(){return document.body},getParentCtrl:function(elm){var ctrl,lookup=this.getRoot().controlIdLookup;while(elm&&lookup){ctrl=lookup[elm.id];if(ctrl){break}elm=elm.parentNode}return ctrl},initLayoutRect:function(){var self=this,settings=self.settings,borderBox,layoutRect;var elm=self.getEl(),width,height,minWidth,minHeight,autoResize;var startMinWidth,startMinHeight,initialSize;borderBox=self.borderBox=self.borderBox||BoxUtils.measureBox(elm,"border");self.paddingBox=self.paddingBox||BoxUtils.measureBox(elm,"padding");self.marginBox=self.marginBox||BoxUtils.measureBox(elm,"margin");initialSize=DomUtils.getSize(elm);startMinWidth=settings.minWidth;startMinHeight=settings.minHeight;minWidth=startMinWidth||initialSize.width;minHeight=startMinHeight||initialSize.height;width=settings.width;height=settings.height;autoResize=settings.autoResize;autoResize=typeof autoResize!="undefined"?autoResize:!width&&!height;width=width||minWidth;height=height||minHeight;var deltaW=borderBox.left+borderBox.right;var deltaH=borderBox.top+borderBox.bottom;var maxW=settings.maxWidth||65535;var maxH=settings.maxHeight||65535;self._layoutRect=layoutRect={x:settings.x||0,y:settings.y||0,w:width,h:height,deltaW:deltaW,deltaH:deltaH,contentW:width-deltaW,contentH:height-deltaH,innerW:width-deltaW,innerH:height-deltaH,startMinWidth:startMinWidth||0,startMinHeight:startMinHeight||0,minW:Math.min(minWidth,maxW),minH:Math.min(minHeight,maxH),maxW:maxW,maxH:maxH,autoResize:autoResize,scrollW:0};self._lastLayoutRect={};return layoutRect},layoutRect:function(newRect){var self=this,curRect=self._layoutRect,lastLayoutRect,size,deltaWidth,deltaHeight,undef,repaintControls;if(!curRect){curRect=self.initLayoutRect()}if(newRect){deltaWidth=curRect.deltaW;deltaHeight=curRect.deltaH;if(newRect.x!==undef){curRect.x=newRect.x}if(newRect.y!==undef){curRect.y=newRect.y}if(newRect.minW!==undef){curRect.minW=newRect.minW}if(newRect.minH!==undef){curRect.minH=newRect.minH}size=newRect.w;if(size!==undef){size=size<curRect.minW?curRect.minW:size;size=size>curRect.maxW?curRect.maxW:size;curRect.w=size;curRect.innerW=size-deltaWidth}size=newRect.h;if(size!==undef){size=size<curRect.minH?curRect.minH:size;size=size>curRect.maxH?curRect.maxH:size;curRect.h=size;curRect.innerH=size-deltaHeight}size=newRect.innerW;if(size!==undef){size=size<curRect.minW-deltaWidth?curRect.minW-deltaWidth:size;size=size>curRect.maxW-deltaWidth?curRect.maxW-deltaWidth:size;curRect.innerW=size;curRect.w=size+deltaWidth}size=newRect.innerH;if(size!==undef){size=size<curRect.minH-deltaHeight?curRect.minH-deltaHeight:size;size=size>curRect.maxH-deltaHeight?curRect.maxH-deltaHeight:size;curRect.innerH=size;curRect.h=size+deltaHeight}if(newRect.contentW!==undef){curRect.contentW=newRect.contentW}if(newRect.contentH!==undef){curRect.contentH=newRect.contentH}lastLayoutRect=self._lastLayoutRect;if(lastLayoutRect.x!==curRect.x||lastLayoutRect.y!==curRect.y||lastLayoutRect.w!==curRect.w||lastLayoutRect.h!==curRect.h){repaintControls=Control.repaintControls;if(repaintControls){if(repaintControls.map&&!repaintControls.map[self._id]){repaintControls.push(self);repaintControls.map[self._id]=true}}lastLayoutRect.x=curRect.x;lastLayoutRect.y=curRect.y;lastLayoutRect.w=curRect.w;lastLayoutRect.h=curRect.h}return self}return curRect},repaint:function(){var self=this,style,bodyStyle,bodyElm,rect,borderBox;var borderW,borderH,lastRepaintRect,round,value;round=!document.createRange?Math.round:function(value){return value};style=self.getEl().style;rect=self._layoutRect;lastRepaintRect=self._lastRepaintRect||{};borderBox=self.borderBox;borderW=borderBox.left+borderBox.right;borderH=borderBox.top+borderBox.bottom;if(rect.x!==lastRepaintRect.x){style.left=round(rect.x)+"px";lastRepaintRect.x=rect.x}if(rect.y!==lastRepaintRect.y){style.top=round(rect.y)+"px";lastRepaintRect.y=rect.y}if(rect.w!==lastRepaintRect.w){value=round(rect.w-borderW);style.width=(value>=0?value:0)+"px";lastRepaintRect.w=rect.w}if(rect.h!==lastRepaintRect.h){value=round(rect.h-borderH);style.height=(value>=0?value:0)+"px";lastRepaintRect.h=rect.h}if(self._hasBody&&rect.innerW!==lastRepaintRect.innerW){value=round(rect.innerW);bodyElm=self.getEl("body");if(bodyElm){bodyStyle=bodyElm.style;bodyStyle.width=(value>=0?value:0)+"px"}lastRepaintRect.innerW=rect.innerW}if(self._hasBody&&rect.innerH!==lastRepaintRect.innerH){value=round(rect.innerH);bodyElm=bodyElm||self.getEl("body");if(bodyElm){bodyStyle=bodyStyle||bodyElm.style;bodyStyle.height=(value>=0?value:0)+"px"}lastRepaintRect.innerH=rect.innerH}self._lastRepaintRect=lastRepaintRect;self.fire("repaint",{},false)},updateLayoutRect:function(){var self=this;self.parent()._lastRect=null;DomUtils.css(self.getEl(),{width:"",height:""});self._layoutRect=self._lastRepaintRect=self._lastLayoutRect=null;self.initLayoutRect()},on:function(name,callback){var self=this;function resolveCallbackName(name){var callback,scope;if(typeof name!="string"){return name}return function(e){if(!callback){self.parentsAndSelf().each(function(ctrl){var callbacks=ctrl.settings.callbacks;if(callbacks&&(callback=callbacks[name])){scope=ctrl;return false}})}if(!callback){e.action=name;this.fire("execute",e);return}return callback.call(scope,e)}}getEventDispatcher(self).on(name,resolveCallbackName(callback));return self},off:function(name,callback){getEventDispatcher(this).off(name,callback);return this},fire:function(name,args,bubble){var self=this;args=args||{};if(!args.control){args.control=self}args=getEventDispatcher(self).fire(name,args);if(bubble!==false&&self.parent){var parent=self.parent();while(parent&&!args.isPropagationStopped()){parent.fire(name,args,false);parent=parent.parent()}}return args},hasEventListeners:function(name){return getEventDispatcher(this).has(name)},parents:function(selector){var self=this,ctrl,parents=new Collection;for(ctrl=self.parent();ctrl;ctrl=ctrl.parent()){parents.add(ctrl)}if(selector){parents=parents.filter(selector)}return parents},parentsAndSelf:function(selector){return new Collection(this).add(this.parents(selector))},next:function(){var parentControls=this.parent().items();return parentControls[parentControls.indexOf(this)+1]},prev:function(){var parentControls=this.parent().items();return parentControls[parentControls.indexOf(this)-1]},innerHtml:function(html){this.$el.html(html);return this},getEl:function(suffix){var id=suffix?this._id+"-"+suffix:this._id;if(!this._elmCache[id]){this._elmCache[id]=$("#"+id)[0]}return this._elmCache[id]},show:function(){return this.visible(true)},hide:function(){return this.visible(false)},focus:function(){try{this.getEl().focus()}catch(ex){}return this},blur:function(){this.getEl().blur();return this},aria:function(name,value){var self=this,elm=self.getEl(self.ariaTarget);if(typeof value==="undefined"){return self._aria[name]}self._aria[name]=value;if(self.state.get("rendered")){elm.setAttribute(name=="role"?name:"aria-"+name,value)}return self},encode:function(text,translate){if(translate!==false){text=this.translate(text)}return(text||"").replace(/[&<>"]/g,function(match){return"&#"+match.charCodeAt(0)+";"})},translate:function(text){return Control.translate?Control.translate(text):text},before:function(items){var self=this,parent=self.parent();if(parent){parent.insert(items,parent.items().indexOf(self),true)}return self},after:function(items){var self=this,parent=self.parent();if(parent){parent.insert(items,parent.items().indexOf(self))}return self},remove:function(){var self=this,elm=self.getEl(),parent=self.parent(),newItems,i;if(self.items){var controls=self.items().toArray();i=controls.length;while(i--){controls[i].remove()}}if(parent&&parent.items){newItems=[];parent.items().each(function(item){if(item!==self){newItems.push(item)}});parent.items().set(newItems);parent._lastRect=null}if(self._eventsRoot&&self._eventsRoot==self){$(elm).off()}var lookup=self.getRoot().controlIdLookup;if(lookup){delete lookup[self._id]}if(elm&&elm.parentNode){elm.parentNode.removeChild(elm)}self.state.set("rendered",false);self.state.destroy();self.fire("remove");return self},renderBefore:function(elm){$(elm).before(this.renderHtml());this.postRender();return this},renderTo:function(elm){$(elm||this.getContainerElm()).append(this.renderHtml());this.postRender();return this},preRender:function(){},render:function(){},renderHtml:function(){return'<div id="'+this._id+'" class="'+this.classes+'"></div>'},postRender:function(){var self=this,settings=self.settings,elm,box,parent,name,parentEventsRoot;self.$el=$(self.getEl());self.state.set("rendered",true);for(name in settings){if(name.indexOf("on")===0){self.on(name.substr(2),settings[name])}}if(self._eventsRoot){for(parent=self.parent();!parentEventsRoot&&parent;parent=parent.parent()){parentEventsRoot=parent._eventsRoot}if(parentEventsRoot){for(name in parentEventsRoot._nativeEvents){self._nativeEvents[name]=true}}}bindPendingEvents(self);if(settings.style){elm=self.getEl();if(elm){elm.setAttribute("style",settings.style);elm.style.cssText=settings.style}}if(self.settings.border){box=self.borderBox;self.$el.css({"border-top-width":box.top,"border-right-width":box.right,"border-bottom-width":box.bottom,"border-left-width":box.left})}var root=self.getRoot();if(!root.controlIdLookup){root.controlIdLookup={}}root.controlIdLookup[self._id]=self;for(var key in self._aria){self.aria(key,self._aria[key])}if(self.state.get("visible")===false){self.getEl().style.display="none"}self.bindStates();self.state.on("change:visible",function(e){var state=e.value,parentCtrl;if(self.state.get("rendered")){self.getEl().style.display=state===false?"none":"";self.getEl().getBoundingClientRect()}parentCtrl=self.parent();if(parentCtrl){parentCtrl._lastRect=null}self.fire(state?"show":"hide");ReflowQueue.add(self)});self.fire("postrender",{},false)},bindStates:function(){},scrollIntoView:function(align){function getOffset(elm,rootElm){var x,y,parent=elm;x=y=0;while(parent&&parent!=rootElm&&parent.nodeType){x+=parent.offsetLeft||0;y+=parent.offsetTop||0;parent=parent.offsetParent}return{x:x,y:y}}var elm=this.getEl(),parentElm=elm.parentNode;var x,y,width,height,parentWidth,parentHeight;var pos=getOffset(elm,parentElm);x=pos.x;y=pos.y;width=elm.offsetWidth;height=elm.offsetHeight;parentWidth=parentElm.clientWidth;parentHeight=parentElm.clientHeight;if(align=="end"){x-=parentWidth-width;y-=parentHeight-height}else if(align=="center"){x-=parentWidth/2-width/2;y-=parentHeight/2-height/2}parentElm.scrollLeft=x;parentElm.scrollTop=y;return this},getRoot:function(){var ctrl=this,rootControl,parents=[];while(ctrl){if(ctrl.rootControl){rootControl=ctrl.rootControl;break}parents.push(ctrl);rootControl=ctrl;ctrl=ctrl.parent()}if(!rootControl){rootControl=this}var i=parents.length;while(i--){parents[i].rootControl=rootControl}return rootControl},reflow:function(){ReflowQueue.remove(this);var parent=this.parent();if(parent._layout&&!parent._layout.isNative()){parent.reflow()}return this}};Tools.each("text title visible disabled active value".split(" "),function(name){proto[name]=function(value){if(arguments.length===0){return this.state.get(name)}if(typeof value!="undefined"){this.state.set(name,value)}return this}});Control=Class.extend(proto);function getEventDispatcher(obj){if(!obj._eventDispatcher){obj._eventDispatcher=new EventDispatcher({scope:obj,toggleEvent:function(name,state){if(state&&EventDispatcher.isNative(name)){if(!obj._nativeEvents){obj._nativeEvents={}}obj._nativeEvents[name]=true;if(obj.state.get("rendered")){bindPendingEvents(obj)}}}})}return obj._eventDispatcher}function bindPendingEvents(eventCtrl){var i,l,parents,eventRootCtrl,nativeEvents,name;function delegate(e){var control=eventCtrl.getParentCtrl(e.target);if(control){control.fire(e.type,e)}}function mouseLeaveHandler(){var ctrl=eventRootCtrl._lastHoverCtrl;if(ctrl){ctrl.fire("mouseleave",{target:ctrl.getEl()});ctrl.parents().each(function(ctrl){ctrl.fire("mouseleave",{target:ctrl.getEl()})});eventRootCtrl._lastHoverCtrl=null}}function mouseEnterHandler(e){var ctrl=eventCtrl.getParentCtrl(e.target),lastCtrl=eventRootCtrl._lastHoverCtrl,idx=0,i,parents,lastParents;if(ctrl!==lastCtrl){eventRootCtrl._lastHoverCtrl=ctrl;parents=ctrl.parents().toArray().reverse();parents.push(ctrl);if(lastCtrl){lastParents=lastCtrl.parents().toArray().reverse();lastParents.push(lastCtrl);for(idx=0;idx<lastParents.length;idx++){if(parents[idx]!==lastParents[idx]){break}}for(i=lastParents.length-1;i>=idx;i--){lastCtrl=lastParents[i];lastCtrl.fire("mouseleave",{target:lastCtrl.getEl()})}}for(i=idx;i<parents.length;i++){ctrl=parents[i];ctrl.fire("mouseenter",{target:ctrl.getEl()})}}}function fixWheelEvent(e){e.preventDefault();if(e.type=="mousewheel"){e.deltaY=-1/40*e.wheelDelta;if(e.wheelDeltaX){e.deltaX=-1/40*e.wheelDeltaX}}else{e.deltaX=0;e.deltaY=e.detail}e=eventCtrl.fire("wheel",e)}nativeEvents=eventCtrl._nativeEvents;if(nativeEvents){parents=eventCtrl.parents().toArray();parents.unshift(eventCtrl);for(i=0,l=parents.length;!eventRootCtrl&&i<l;i++){eventRootCtrl=parents[i]._eventsRoot}if(!eventRootCtrl){eventRootCtrl=parents[parents.length-1]||eventCtrl}eventCtrl._eventsRoot=eventRootCtrl;for(l=i,i=0;i<l;i++){parents[i]._eventsRoot=eventRootCtrl}var eventRootDelegates=eventRootCtrl._delegates;if(!eventRootDelegates){eventRootDelegates=eventRootCtrl._delegates={}}for(name in nativeEvents){if(!nativeEvents){return false}if(name==="wheel"&&!hasWheelEventSupport){if(hasMouseWheelEventSupport){$(eventCtrl.getEl()).on("mousewheel",fixWheelEvent)}else{$(eventCtrl.getEl()).on("DOMMouseScroll",fixWheelEvent)}continue}if(name==="mouseenter"||name==="mouseleave"){if(!eventRootCtrl._hasMouseEnter){$(eventRootCtrl.getEl()).on("mouseleave",mouseLeaveHandler).on("mouseover",mouseEnterHandler);eventRootCtrl._hasMouseEnter=1}}else if(!eventRootDelegates[name]){$(eventRootCtrl.getEl()).on(name,delegate);eventRootDelegates[name]=true}nativeEvents[name]=false}}}return Control});define("tinymce/ui/Factory",[],function(){"use strict";var types={},namespaceInit;return{add:function(type,typeClass){types[type.toLowerCase()]=typeClass},has:function(type){return!!types[type.toLowerCase()]},create:function(type,settings){var ControlType,name,namespace;if(!namespaceInit){namespace=tinymce.ui;for(name in namespace){types[name.toLowerCase()]=namespace[name]}namespaceInit=true}if(typeof type=="string"){settings=settings||{};settings.type=type}else{settings=type;type=settings.type}type=type.toLowerCase();ControlType=types[type];if(!ControlType){throw new Error("Could not find control by type: "+type)}ControlType=new ControlType(settings);ControlType.type=type;return ControlType}}});define("tinymce/ui/KeyboardNavigation",[],function(){"use strict";return function(settings){var root=settings.root,focusedElement,focusedControl;function isElement(node){return node&&node.nodeType===1}try{focusedElement=document.activeElement}catch(ex){focusedElement=document.body}focusedControl=root.getParentCtrl(focusedElement);function getRole(elm){elm=elm||focusedElement;if(isElement(elm)){return elm.getAttribute("role")}return null}function getParentRole(elm){var role,parent=elm||focusedElement;while(parent=parent.parentNode){if(role=getRole(parent)){return role}}}function getAriaProp(name){var elm=focusedElement;if(isElement(elm)){return elm.getAttribute("aria-"+name)}}function isTextInputElement(elm){var tagName=elm.tagName.toUpperCase();return tagName=="INPUT"||tagName=="TEXTAREA"||tagName=="SELECT"}function canFocus(elm){if(isTextInputElement(elm)&&!elm.hidden){return true}if(/^(button|menuitem|checkbox|tab|menuitemcheckbox|option|gridcell|slider)$/.test(getRole(elm))){return true}return false}function getFocusElements(elm){var elements=[];function collect(elm){if(elm.nodeType!=1||elm.style.display=="none"){return}if(canFocus(elm)){elements.push(elm)}for(var i=0;i<elm.childNodes.length;i++){collect(elm.childNodes[i])}}collect(elm||root.getEl());return elements}function getNavigationRoot(targetControl){var navigationRoot,controls;targetControl=targetControl||focusedControl;controls=targetControl.parents().toArray();controls.unshift(targetControl);for(var i=0;i<controls.length;i++){navigationRoot=controls[i];if(navigationRoot.settings.ariaRoot){break}}return navigationRoot}function focusFirst(targetControl){var navigationRoot=getNavigationRoot(targetControl);var focusElements=getFocusElements(navigationRoot.getEl());if(navigationRoot.settings.ariaRemember&&"lastAriaIndex"in navigationRoot){moveFocusToIndex(navigationRoot.lastAriaIndex,focusElements)}else{moveFocusToIndex(0,focusElements)}}function moveFocusToIndex(idx,elements){if(idx<0){idx=elements.length-1}else if(idx>=elements.length){idx=0}if(elements[idx]){elements[idx].focus()}return idx}function moveFocus(dir,elements){var idx=-1,navigationRoot=getNavigationRoot();elements=elements||getFocusElements(navigationRoot.getEl());for(var i=0;i<elements.length;i++){if(elements[i]===focusedElement){idx=i}}idx+=dir;navigationRoot.lastAriaIndex=moveFocusToIndex(idx,elements)}function left(){var parentRole=getParentRole();if(parentRole=="tablist"){moveFocus(-1,getFocusElements(focusedElement.parentNode))}else if(focusedControl.parent().submenu){cancel()}else{moveFocus(-1)}}function right(){var role=getRole(),parentRole=getParentRole();if(parentRole=="tablist"){moveFocus(1,getFocusElements(focusedElement.parentNode))}else if(role=="menuitem"&&parentRole=="menu"&&getAriaProp("haspopup")){enter()}else{moveFocus(1)}}function up(){moveFocus(-1)}function down(){var role=getRole(),parentRole=getParentRole();if(role=="menuitem"&&parentRole=="menubar"){enter()}else if(role=="button"&&getAriaProp("haspopup")){enter({key:"down"})}else{moveFocus(1)}}function tab(e){var parentRole=getParentRole();if(parentRole=="tablist"){var elm=getFocusElements(focusedControl.getEl("body"))[0];if(elm){elm.focus()}}else{moveFocus(e.shiftKey?-1:1)}}function cancel(){focusedControl.fire("cancel")}function enter(aria){aria=aria||{};focusedControl.fire("click",{target:focusedElement,aria:aria})}root.on("keydown",function(e){function handleNonTabOrEscEvent(e,handler){if(isTextInputElement(focusedElement)){return}if(getRole(focusedElement)==="slider"){return}if(handler(e)!==false){e.preventDefault()}}if(e.isDefaultPrevented()){return}switch(e.keyCode){case 37:handleNonTabOrEscEvent(e,left);break;case 39:handleNonTabOrEscEvent(e,right);break;case 38:handleNonTabOrEscEvent(e,up);break;case 40:handleNonTabOrEscEvent(e,down);break;case 27:cancel();break;case 14:case 13:case 32:handleNonTabOrEscEvent(e,enter);break;case 9:if(tab(e)!==false){e.preventDefault()}break}});root.on("focusin",function(e){focusedElement=e.target;focusedControl=e.control});return{focusFirst:focusFirst}}});define("tinymce/ui/Container",["tinymce/ui/Control","tinymce/ui/Collection","tinymce/ui/Selector","tinymce/ui/Factory","tinymce/ui/KeyboardNavigation","tinymce/util/Tools","tinymce/dom/DomQuery","tinymce/ui/ClassList","tinymce/ui/ReflowQueue"],function(Control,Collection,Selector,Factory,KeyboardNavigation,Tools,$,ClassList,ReflowQueue){"use strict";var selectorCache={};return Control.extend({init:function(settings){var self=this;self._super(settings);settings=self.settings;if(settings.fixed){self.state.set("fixed",true)}self._items=new Collection;if(self.isRtl()){self.classes.add("rtl")}self.bodyClasses=new ClassList(function(){if(self.state.get("rendered")){self.getEl("body").className=this.toString()}});self.bodyClasses.prefix=self.classPrefix;self.classes.add("container");self.bodyClasses.add("container-body");if(settings.containerCls){self.classes.add(settings.containerCls)}self._layout=Factory.create((settings.layout||"")+"layout");if(self.settings.items){self.add(self.settings.items)}else{self.add(self.render())}self._hasBody=true},items:function(){return this._items},find:function(selector){selector=selectorCache[selector]=selectorCache[selector]||new Selector(selector);return selector.find(this)},add:function(items){var self=this;self.items().add(self.create(items)).parent(self);return self},focus:function(keyboard){var self=this,focusCtrl,keyboardNav,items;if(keyboard){keyboardNav=self.keyboardNav||self.parents().eq(-1)[0].keyboardNav;if(keyboardNav){keyboardNav.focusFirst(self);return}}items=self.find("*");if(self.statusbar){items.add(self.statusbar.items())}items.each(function(ctrl){if(ctrl.settings.autofocus){focusCtrl=null;return false}if(ctrl.canFocus){focusCtrl=focusCtrl||ctrl}});if(focusCtrl){focusCtrl.focus()}return self},replace:function(oldItem,newItem){var ctrlElm,items=this.items(),i=items.length;while(i--){if(items[i]===oldItem){items[i]=newItem;break}}if(i>=0){ctrlElm=newItem.getEl();if(ctrlElm){ctrlElm.parentNode.removeChild(ctrlElm)}ctrlElm=oldItem.getEl();if(ctrlElm){ctrlElm.parentNode.removeChild(ctrlElm)}}newItem.parent(this)},create:function(items){var self=this,settings,ctrlItems=[];if(!Tools.isArray(items)){items=[items]}Tools.each(items,function(item){if(item){if(!(item instanceof Control)){if(typeof item=="string"){item={type:item}}settings=Tools.extend({},self.settings.defaults,item);item.type=settings.type=settings.type||item.type||self.settings.defaultType||(settings.defaults?settings.defaults.type:null);item=Factory.create(settings)}ctrlItems.push(item)}});return ctrlItems},renderNew:function(){var self=this;self.items().each(function(ctrl,index){var containerElm;ctrl.parent(self);if(!ctrl.state.get("rendered")){containerElm=self.getEl("body");if(containerElm.hasChildNodes()&&index<=containerElm.childNodes.length-1){$(containerElm.childNodes[index]).before(ctrl.renderHtml())}else{$(containerElm).append(ctrl.renderHtml())}ctrl.postRender();ReflowQueue.add(ctrl)}});self._layout.applyClasses(self.items().filter(":visible"));self._lastRect=null;return self},append:function(items){return this.add(items).renderNew()},prepend:function(items){var self=this;self.items().set(self.create(items).concat(self.items().toArray()));return self.renderNew()},insert:function(items,index,before){var self=this,curItems,beforeItems,afterItems;items=self.create(items);curItems=self.items();if(!before&&index<curItems.length-1){index+=1}if(index>=0&&index<curItems.length){beforeItems=curItems.slice(0,index).toArray();afterItems=curItems.slice(index).toArray();curItems.set(beforeItems.concat(items,afterItems))}return self.renderNew()},fromJSON:function(data){var self=this;for(var name in data){self.find("#"+name).value(data[name])}return self},toJSON:function(){var self=this,data={};self.find("*").each(function(ctrl){var name=ctrl.name(),value=ctrl.value();if(name&&typeof value!="undefined"){data[name]=value}});return data},renderHtml:function(){var self=this,layout=self._layout,role=this.settings.role;self.preRender();layout.preRender(self);return'<div id="'+self._id+'" class="'+self.classes+'"'+(role?' role="'+this.settings.role+'"':"")+">"+'<div id="'+self._id+'-body" class="'+self.bodyClasses+'">'+(self.settings.html||"")+layout.renderHtml(self)+"</div>"+"</div>"},postRender:function(){var self=this,box;self.items().exec("postRender");self._super();self._layout.postRender(self);self.state.set("rendered",true);if(self.settings.style){self.$el.css(self.settings.style)}if(self.settings.border){box=self.borderBox;self.$el.css({"border-top-width":box.top,"border-right-width":box.right,"border-bottom-width":box.bottom,"border-left-width":box.left})}if(!self.parent()){self.keyboardNav=new KeyboardNavigation({root:self})}return self},initLayoutRect:function(){var self=this,layoutRect=self._super();self._layout.recalc(self);return layoutRect},recalc:function(){var self=this,rect=self._layoutRect,lastRect=self._lastRect;if(!lastRect||lastRect.w!=rect.w||lastRect.h!=rect.h){self._layout.recalc(self);rect=self.layoutRect();self._lastRect={x:rect.x,y:rect.y,w:rect.w,h:rect.h};return true}},reflow:function(){var i;ReflowQueue.remove(this);if(this.visible()){Control.repaintControls=[];Control.repaintControls.map={};this.recalc();i=Control.repaintControls.length;while(i--){Control.repaintControls[i].repaint()}if(this.settings.layout!=="flow"&&this.settings.layout!=="stack"){this.repaint()}Control.repaintControls=[]}return this}})});define("tinymce/ui/DragHelper",["tinymce/dom/DomQuery"],function($){"use strict";function getDocumentSize(doc){var documentElement,body,scrollWidth,clientWidth;var offsetWidth,scrollHeight,clientHeight,offsetHeight,max=Math.max;documentElement=doc.documentElement;body=doc.body;scrollWidth=max(documentElement.scrollWidth,body.scrollWidth);clientWidth=max(documentElement.clientWidth,body.clientWidth);offsetWidth=max(documentElement.offsetWidth,body.offsetWidth);scrollHeight=max(documentElement.scrollHeight,body.scrollHeight);clientHeight=max(documentElement.clientHeight,body.clientHeight);offsetHeight=max(documentElement.offsetHeight,body.offsetHeight);return{width:scrollWidth<offsetWidth?clientWidth:scrollWidth,height:scrollHeight<offsetHeight?clientHeight:scrollHeight}}function updateWithTouchData(e){var keys,i;if(e.changedTouches){keys="screenX screenY pageX pageY clientX clientY".split(" ");for(i=0;i<keys.length;i++){e[keys[i]]=e.changedTouches[0][keys[i]]}}}return function(id,settings){var $eventOverlay,doc=settings.document||document,downButton,start,stop,drag,startX,startY;settings=settings||{};function getHandleElm(){return doc.getElementById(settings.handle||id)}start=function(e){var docSize=getDocumentSize(doc),handleElm,cursor;updateWithTouchData(e);e.preventDefault();downButton=e.button;handleElm=getHandleElm();startX=e.screenX;startY=e.screenY;if(window.getComputedStyle){cursor=window.getComputedStyle(handleElm,null).getPropertyValue("cursor")}else{cursor=handleElm.runtimeStyle.cursor}$eventOverlay=$("<div>").css({position:"absolute",top:0,left:0,width:docSize.width,height:docSize.height,zIndex:2147483647,opacity:1e-4,cursor:cursor}).appendTo(doc.body);$(doc).on("mousemove touchmove",drag).on("mouseup touchend",stop);settings.start(e)};drag=function(e){updateWithTouchData(e);if(e.button!==downButton){return stop(e)}e.deltaX=e.screenX-startX;e.deltaY=e.screenY-startY;e.preventDefault();settings.drag(e)};stop=function(e){updateWithTouchData(e);$(doc).off("mousemove touchmove",drag).off("mouseup touchend",stop);$eventOverlay.remove();if(settings.stop){settings.stop(e)}};this.destroy=function(){$(getHandleElm()).off()};$(getHandleElm()).on("mousedown touchstart",start)}});define("tinymce/ui/Scrollable",["tinymce/dom/DomQuery","tinymce/ui/DragHelper"],function($,DragHelper){"use strict";return{init:function(){var self=this;self.on("repaint",self.renderScroll)},renderScroll:function(){var self=this,margin=2;function repaintScroll(){var hasScrollH,hasScrollV,bodyElm;function repaintAxis(axisName,posName,sizeName,contentSizeName,hasScroll,ax){var containerElm,scrollBarElm,scrollThumbElm;var containerSize,scrollSize,ratio,rect;var posNameLower,sizeNameLower;scrollBarElm=self.getEl("scroll"+axisName);if(scrollBarElm){posNameLower=posName.toLowerCase();sizeNameLower=sizeName.toLowerCase();$(self.getEl("absend")).css(posNameLower,self.layoutRect()[contentSizeName]-1);if(!hasScroll){$(scrollBarElm).css("display","none");return}$(scrollBarElm).css("display","block");containerElm=self.getEl("body");scrollThumbElm=self.getEl("scroll"+axisName+"t");containerSize=containerElm["client"+sizeName]-margin*2;containerSize-=hasScrollH&&hasScrollV?scrollBarElm["client"+ax]:0;scrollSize=containerElm["scroll"+sizeName];ratio=containerSize/scrollSize;rect={};rect[posNameLower]=containerElm["offset"+posName]+margin;rect[sizeNameLower]=containerSize;$(scrollBarElm).css(rect);rect={};rect[posNameLower]=containerElm["scroll"+posName]*ratio;rect[sizeNameLower]=containerSize*ratio;$(scrollThumbElm).css(rect)}}bodyElm=self.getEl("body");hasScrollH=bodyElm.scrollWidth>bodyElm.clientWidth;hasScrollV=bodyElm.scrollHeight>bodyElm.clientHeight;repaintAxis("h","Left","Width","contentW",hasScrollH,"Height");repaintAxis("v","Top","Height","contentH",hasScrollV,"Width")}function addScroll(){function addScrollAxis(axisName,posName,sizeName,deltaPosName,ax){var scrollStart,axisId=self._id+"-scroll"+axisName,prefix=self.classPrefix;$(self.getEl()).append('<div id="'+axisId+'" class="'+prefix+"scrollbar "+prefix+"scrollbar-"+axisName+'">'+'<div id="'+axisId+'t" class="'+prefix+'scrollbar-thumb"></div>'+"</div>");self.draghelper=new DragHelper(axisId+"t",{start:function(){scrollStart=self.getEl("body")["scroll"+posName];$("#"+axisId).addClass(prefix+"active")},drag:function(e){var ratio,hasScrollH,hasScrollV,containerSize,layoutRect=self.layoutRect();hasScrollH=layoutRect.contentW>layoutRect.innerW;hasScrollV=layoutRect.contentH>layoutRect.innerH;containerSize=self.getEl("body")["client"+sizeName]-margin*2;containerSize-=hasScrollH&&hasScrollV?self.getEl("scroll"+axisName)["client"+ax]:0;ratio=containerSize/self.getEl("body")["scroll"+sizeName];self.getEl("body")["scroll"+posName]=scrollStart+e["delta"+deltaPosName]/ratio},stop:function(){$("#"+axisId).removeClass(prefix+"active")}})}self.classes.add("scroll");addScrollAxis("v","Top","Height","Y","Width");addScrollAxis("h","Left","Width","X","Height")}if(self.settings.autoScroll){if(!self._hasScroll){self._hasScroll=true;addScroll();self.on("wheel",function(e){var bodyEl=self.getEl("body");bodyEl.scrollLeft+=(e.deltaX||0)*10;bodyEl.scrollTop+=e.deltaY*10;repaintScroll()});$(self.getEl("body")).on("scroll",repaintScroll)}repaintScroll()}}}});define("tinymce/ui/Panel",["tinymce/ui/Container","tinymce/ui/Scrollable"],function(Container,Scrollable){"use strict";return Container.extend({Defaults:{layout:"fit",containerCls:"panel"},Mixins:[Scrollable],renderHtml:function(){var self=this,layout=self._layout,innerHtml=self.settings.html;self.preRender();layout.preRender(self);if(typeof innerHtml=="undefined"){innerHtml='<div id="'+self._id+'-body" class="'+self.bodyClasses+'">'+layout.renderHtml(self)+"</div>"}else{if(typeof innerHtml=="function"){innerHtml=innerHtml.call(self)}self._hasBody=false}return'<div id="'+self._id+'" class="'+self.classes+'" hidefocus="1" tabindex="-1" role="group">'+(self._preBodyHtml||"")+innerHtml+"</div>"}})});define("tinymce/ui/Movable",["tinymce/ui/DomUtils"],function(DomUtils){"use strict";function calculateRelativePosition(ctrl,targetElm,rel){var ctrlElm,pos,x,y,selfW,selfH,targetW,targetH,viewport,size;viewport=DomUtils.getViewPort();pos=DomUtils.getPos(targetElm);x=pos.x;y=pos.y;if(ctrl.state.get("fixed")&&DomUtils.getRuntimeStyle(document.body,"position")=="static"){
x-=viewport.x;y-=viewport.y}ctrlElm=ctrl.getEl();size=DomUtils.getSize(ctrlElm);selfW=size.width;selfH=size.height;size=DomUtils.getSize(targetElm);targetW=size.width;targetH=size.height;rel=(rel||"").split("");if(rel[0]==="b"){y+=targetH}if(rel[1]==="r"){x+=targetW}if(rel[0]==="c"){y+=Math.round(targetH/2)}if(rel[1]==="c"){x+=Math.round(targetW/2)}if(rel[3]==="b"){y-=selfH}if(rel[4]==="r"){x-=selfW}if(rel[3]==="c"){y-=Math.round(selfH/2)}if(rel[4]==="c"){x-=Math.round(selfW/2)}return{x:x,y:y,w:selfW,h:selfH}}return{testMoveRel:function(elm,rels){var viewPortRect=DomUtils.getViewPort();for(var i=0;i<rels.length;i++){var pos=calculateRelativePosition(this,elm,rels[i]);if(this.state.get("fixed")){if(pos.x>0&&pos.x+pos.w<viewPortRect.w&&pos.y>0&&pos.y+pos.h<viewPortRect.h){return rels[i]}}else{if(pos.x>viewPortRect.x&&pos.x+pos.w<viewPortRect.w+viewPortRect.x&&pos.y>viewPortRect.y&&pos.y+pos.h<viewPortRect.h+viewPortRect.y){return rels[i]}}}return rels[0]},moveRel:function(elm,rel){if(typeof rel!="string"){rel=this.testMoveRel(elm,rel)}var pos=calculateRelativePosition(this,elm,rel);return this.moveTo(pos.x,pos.y)},moveBy:function(dx,dy){var self=this,rect=self.layoutRect();self.moveTo(rect.x+dx,rect.y+dy);return self},moveTo:function(x,y){var self=this;function constrain(value,max,size){if(value<0){return 0}if(value+size>max){value=max-size;return value<0?0:value}return value}if(self.settings.constrainToViewport){var viewPortRect=DomUtils.getViewPort(window);var layoutRect=self.layoutRect();x=constrain(x,viewPortRect.w+viewPortRect.x,layoutRect.w);y=constrain(y,viewPortRect.h+viewPortRect.y,layoutRect.h)}if(self.state.get("rendered")){self.layoutRect({x:x,y:y}).repaint()}else{self.settings.x=x;self.settings.y=y}self.fire("move",{x:x,y:y});return self}}});define("tinymce/ui/Resizable",["tinymce/ui/DomUtils"],function(DomUtils){"use strict";return{resizeToContent:function(){this._layoutRect.autoResize=true;this._lastRect=null;this.reflow()},resizeTo:function(w,h){if(w<=1||h<=1){var rect=DomUtils.getWindowSize();w=w<=1?w*rect.w:w;h=h<=1?h*rect.h:h}this._layoutRect.autoResize=false;return this.layoutRect({minW:w,minH:h,w:w,h:h}).reflow()},resizeBy:function(dw,dh){var self=this,rect=self.layoutRect();return self.resizeTo(rect.w+dw,rect.h+dh)}}});define("tinymce/ui/FloatPanel",["tinymce/ui/Panel","tinymce/ui/Movable","tinymce/ui/Resizable","tinymce/ui/DomUtils","tinymce/dom/DomQuery","tinymce/util/Delay"],function(Panel,Movable,Resizable,DomUtils,$,Delay){"use strict";var documentClickHandler,documentScrollHandler,windowResizeHandler,visiblePanels=[];var zOrder=[],hasModal;function isChildOf(ctrl,parent){while(ctrl){if(ctrl==parent){return true}ctrl=ctrl.parent()}}function skipOrHidePanels(e){var i=visiblePanels.length;while(i--){var panel=visiblePanels[i],clickCtrl=panel.getParentCtrl(e.target);if(panel.settings.autohide){if(clickCtrl){if(isChildOf(clickCtrl,panel)||panel.parent()===clickCtrl){continue}}e=panel.fire("autohide",{target:e.target});if(!e.isDefaultPrevented()){panel.hide()}}}}function bindDocumentClickHandler(){if(!documentClickHandler){documentClickHandler=function(e){if(e.button==2){return}skipOrHidePanels(e)};$(document).on("click touchstart",documentClickHandler)}}function bindDocumentScrollHandler(){if(!documentScrollHandler){documentScrollHandler=function(){var i;i=visiblePanels.length;while(i--){repositionPanel(visiblePanels[i])}};$(window).on("scroll",documentScrollHandler)}}function bindWindowResizeHandler(){if(!windowResizeHandler){var docElm=document.documentElement,clientWidth=docElm.clientWidth,clientHeight=docElm.clientHeight;windowResizeHandler=function(){if(!document.all||clientWidth!=docElm.clientWidth||clientHeight!=docElm.clientHeight){clientWidth=docElm.clientWidth;clientHeight=docElm.clientHeight;FloatPanel.hideAll()}};$(window).on("resize",windowResizeHandler)}}function repositionPanel(panel){var scrollY=DomUtils.getViewPort().y;function toggleFixedChildPanels(fixed,deltaY){var parent;for(var i=0;i<visiblePanels.length;i++){if(visiblePanels[i]!=panel){parent=visiblePanels[i].parent();while(parent&&(parent=parent.parent())){if(parent==panel){visiblePanels[i].fixed(fixed).moveBy(0,deltaY).repaint()}}}}}if(panel.settings.autofix){if(!panel.state.get("fixed")){panel._autoFixY=panel.layoutRect().y;if(panel._autoFixY<scrollY){panel.fixed(true).layoutRect({y:0}).repaint();toggleFixedChildPanels(true,scrollY-panel._autoFixY)}}else{if(panel._autoFixY>scrollY){panel.fixed(false).layoutRect({y:panel._autoFixY}).repaint();toggleFixedChildPanels(false,panel._autoFixY-scrollY)}}}}function addRemove(add,ctrl){var i,zIndex=FloatPanel.zIndex||65535,topModal;if(add){zOrder.push(ctrl)}else{i=zOrder.length;while(i--){if(zOrder[i]===ctrl){zOrder.splice(i,1)}}}if(zOrder.length){for(i=0;i<zOrder.length;i++){if(zOrder[i].modal){zIndex++;topModal=zOrder[i]}zOrder[i].getEl().style.zIndex=zIndex;zOrder[i].zIndex=zIndex;zIndex++}}var modalBlockEl=$("#"+ctrl.classPrefix+"modal-block",ctrl.getContainerElm())[0];if(topModal){$(modalBlockEl).css("z-index",topModal.zIndex-1)}else if(modalBlockEl){modalBlockEl.parentNode.removeChild(modalBlockEl);hasModal=false}FloatPanel.currentZIndex=zIndex}var FloatPanel=Panel.extend({Mixins:[Movable,Resizable],init:function(settings){var self=this;self._super(settings);self._eventsRoot=self;self.classes.add("floatpanel");if(settings.autohide){bindDocumentClickHandler();bindWindowResizeHandler();visiblePanels.push(self)}if(settings.autofix){bindDocumentScrollHandler();self.on("move",function(){repositionPanel(this)})}self.on("postrender show",function(e){if(e.control==self){var $modalBlockEl,prefix=self.classPrefix;if(self.modal&&!hasModal){$modalBlockEl=$("#"+prefix+"modal-block",self.getContainerElm());if(!$modalBlockEl[0]){$modalBlockEl=$('<div id="'+prefix+'modal-block" class="'+prefix+"reset "+prefix+'fade"></div>').appendTo(self.getContainerElm())}Delay.setTimeout(function(){$modalBlockEl.addClass(prefix+"in");$(self.getEl()).addClass(prefix+"in")});hasModal=true}addRemove(true,self)}});self.on("show",function(){self.parents().each(function(ctrl){if(ctrl.state.get("fixed")){self.fixed(true);return false}})});if(settings.popover){self._preBodyHtml='<div class="'+self.classPrefix+'arrow"></div>';self.classes.add("popover").add("bottom").add(self.isRtl()?"end":"start")}self.aria("label",settings.ariaLabel);self.aria("labelledby",self._id);self.aria("describedby",self.describedBy||self._id+"-none")},fixed:function(state){var self=this;if(self.state.get("fixed")!=state){if(self.state.get("rendered")){var viewport=DomUtils.getViewPort();if(state){self.layoutRect().y-=viewport.y}else{self.layoutRect().y+=viewport.y}}self.classes.toggle("fixed",state);self.state.set("fixed",state)}return self},show:function(){var self=this,i,state=self._super();i=visiblePanels.length;while(i--){if(visiblePanels[i]===self){break}}if(i===-1){visiblePanels.push(self)}return state},hide:function(){removeVisiblePanel(this);addRemove(false,this);return this._super()},hideAll:function(){FloatPanel.hideAll()},close:function(){var self=this;if(!self.fire("close").isDefaultPrevented()){self.remove();addRemove(false,self)}return self},remove:function(){removeVisiblePanel(this);this._super()},postRender:function(){var self=this;if(self.settings.bodyRole){this.getEl("body").setAttribute("role",self.settings.bodyRole)}return self._super()}});FloatPanel.hideAll=function(){var i=visiblePanels.length;while(i--){var panel=visiblePanels[i];if(panel&&panel.settings.autohide){panel.hide();visiblePanels.splice(i,1)}}};function removeVisiblePanel(panel){var i;i=visiblePanels.length;while(i--){if(visiblePanels[i]===panel){visiblePanels.splice(i,1)}}i=zOrder.length;while(i--){if(zOrder[i]===panel){zOrder.splice(i,1)}}}return FloatPanel});define("tinymce/ui/Window",["tinymce/ui/FloatPanel","tinymce/ui/Panel","tinymce/ui/DomUtils","tinymce/dom/DomQuery","tinymce/ui/DragHelper","tinymce/ui/BoxUtils","tinymce/Env","tinymce/util/Delay"],function(FloatPanel,Panel,DomUtils,$,DragHelper,BoxUtils,Env,Delay){"use strict";var windows=[],oldMetaValue="";function toggleFullScreenState(state){var noScaleMetaValue="width=device-width,initial-scale=1.0,user-scalable=0,minimum-scale=1.0,maximum-scale=1.0",viewport=$("meta[name=viewport]")[0],contentValue;if(Env.overrideViewPort===false){return}if(!viewport){viewport=document.createElement("meta");viewport.setAttribute("name","viewport");document.getElementsByTagName("head")[0].appendChild(viewport)}contentValue=viewport.getAttribute("content");if(contentValue&&typeof oldMetaValue!="undefined"){oldMetaValue=contentValue}viewport.setAttribute("content",state?noScaleMetaValue:oldMetaValue)}function toggleBodyFullScreenClasses(classPrefix){for(var i=0;i<windows.length;i++){if(windows[i]._fullscreen){return}}$([document.documentElement,document.body]).removeClass(classPrefix+"fullscreen")}function handleWindowResize(){if(!Env.desktop){var lastSize={w:window.innerWidth,h:window.innerHeight};Delay.setInterval(function(){var w=window.innerWidth,h=window.innerHeight;if(lastSize.w!=w||lastSize.h!=h){lastSize={w:w,h:h};$(window).trigger("resize")}},100)}function reposition(){var i,rect=DomUtils.getWindowSize(),layoutRect;for(i=0;i<windows.length;i++){layoutRect=windows[i].layoutRect();windows[i].moveTo(windows[i].settings.x||Math.max(0,rect.w/2-layoutRect.w/2),windows[i].settings.y||Math.max(0,rect.h/2-layoutRect.h/2))}}$(window).on("resize",reposition)}var Window=FloatPanel.extend({modal:true,Defaults:{border:1,layout:"flex",containerCls:"panel",role:"dialog",callbacks:{submit:function(){this.fire("submit",{data:this.toJSON()})},close:function(){this.close()}}},init:function(settings){var self=this;self._super(settings);if(self.isRtl()){self.classes.add("rtl")}self.classes.add("window");self.bodyClasses.add("window-body");self.state.set("fixed",true);if(settings.buttons){self.statusbar=new Panel({layout:"flex",border:"1 0 0 0",spacing:3,padding:10,align:"center",pack:self.isRtl()?"start":"end",defaults:{type:"button"},items:settings.buttons});self.statusbar.classes.add("foot");self.statusbar.parent(self)}self.on("click",function(e){var closeClass=self.classPrefix+"close";if(DomUtils.hasClass(e.target,closeClass)||DomUtils.hasClass(e.target.parentNode,closeClass)){self.close()}});self.on("cancel",function(){self.close()});self.aria("describedby",self.describedBy||self._id+"-none");self.aria("label",settings.title);self._fullscreen=false},recalc:function(){var self=this,statusbar=self.statusbar,layoutRect,width,x,needsRecalc;if(self._fullscreen){self.layoutRect(DomUtils.getWindowSize());self.layoutRect().contentH=self.layoutRect().innerH}self._super();layoutRect=self.layoutRect();if(self.settings.title&&!self._fullscreen){width=layoutRect.headerW;if(width>layoutRect.w){x=layoutRect.x-Math.max(0,width/2);self.layoutRect({w:width,x:x});needsRecalc=true}}if(statusbar){statusbar.layoutRect({w:self.layoutRect().innerW}).recalc();width=statusbar.layoutRect().minW+layoutRect.deltaW;if(width>layoutRect.w){x=layoutRect.x-Math.max(0,width-layoutRect.w);self.layoutRect({w:width,x:x});needsRecalc=true}}if(needsRecalc){self.recalc()}},initLayoutRect:function(){var self=this,layoutRect=self._super(),deltaH=0,headEl;if(self.settings.title&&!self._fullscreen){headEl=self.getEl("head");var size=DomUtils.getSize(headEl);layoutRect.headerW=size.width;layoutRect.headerH=size.height;deltaH+=layoutRect.headerH}if(self.statusbar){deltaH+=self.statusbar.layoutRect().h}layoutRect.deltaH+=deltaH;layoutRect.minH+=deltaH;layoutRect.h+=deltaH;var rect=DomUtils.getWindowSize();layoutRect.x=self.settings.x||Math.max(0,rect.w/2-layoutRect.w/2);layoutRect.y=self.settings.y||Math.max(0,rect.h/2-layoutRect.h/2);return layoutRect},renderHtml:function(){var self=this,layout=self._layout,id=self._id,prefix=self.classPrefix;var settings=self.settings,headerHtml="",footerHtml="",html=settings.html;self.preRender();layout.preRender(self);if(settings.title){headerHtml='<div id="'+id+'-head" class="'+prefix+'window-head">'+'<div id="'+id+'-title" class="'+prefix+'title">'+self.encode(settings.title)+"</div>"+'<div id="'+id+'-dragh" class="'+prefix+'dragh"></div>'+'<button type="button" class="'+prefix+'close" aria-hidden="true">'+'<i class="mce-ico mce-i-remove"></i>'+"</button>"+"</div>"}if(settings.url){html='<iframe src="'+settings.url+'" tabindex="-1"></iframe>'}if(typeof html=="undefined"){html=layout.renderHtml(self)}if(self.statusbar){footerHtml=self.statusbar.renderHtml()}return'<div id="'+id+'" class="'+self.classes+'" hidefocus="1">'+'<div class="'+self.classPrefix+'reset" role="application">'+headerHtml+'<div id="'+id+'-body" class="'+self.bodyClasses+'">'+html+"</div>"+footerHtml+"</div>"+"</div>"},fullscreen:function(state){var self=this,documentElement=document.documentElement,slowRendering,prefix=self.classPrefix,layoutRect;if(state!=self._fullscreen){$(window).on("resize",function(){var time;if(self._fullscreen){if(!slowRendering){time=(new Date).getTime();var rect=DomUtils.getWindowSize();self.moveTo(0,0).resizeTo(rect.w,rect.h);if((new Date).getTime()-time>50){slowRendering=true}}else{if(!self._timer){self._timer=Delay.setTimeout(function(){var rect=DomUtils.getWindowSize();self.moveTo(0,0).resizeTo(rect.w,rect.h);self._timer=0},50)}}}});layoutRect=self.layoutRect();self._fullscreen=state;if(!state){self.borderBox=BoxUtils.parseBox(self.settings.border);self.getEl("head").style.display="";layoutRect.deltaH+=layoutRect.headerH;$([documentElement,document.body]).removeClass(prefix+"fullscreen");self.classes.remove("fullscreen");self.moveTo(self._initial.x,self._initial.y).resizeTo(self._initial.w,self._initial.h)}else{self._initial={x:layoutRect.x,y:layoutRect.y,w:layoutRect.w,h:layoutRect.h};self.borderBox=BoxUtils.parseBox("0");self.getEl("head").style.display="none";layoutRect.deltaH-=layoutRect.headerH+2;$([documentElement,document.body]).addClass(prefix+"fullscreen");self.classes.add("fullscreen");var rect=DomUtils.getWindowSize();self.moveTo(0,0).resizeTo(rect.w,rect.h)}}return self.reflow()},postRender:function(){var self=this,startPos;setTimeout(function(){self.classes.add("in");self.fire("open")},0);self._super();if(self.statusbar){self.statusbar.postRender()}self.focus();this.dragHelper=new DragHelper(self._id+"-dragh",{start:function(){startPos={x:self.layoutRect().x,y:self.layoutRect().y}},drag:function(e){self.moveTo(startPos.x+e.deltaX,startPos.y+e.deltaY)}});self.on("submit",function(e){if(!e.isDefaultPrevented()){self.close()}});windows.push(self);toggleFullScreenState(true)},submit:function(){return this.fire("submit",{data:this.toJSON()})},remove:function(){var self=this,i;self.dragHelper.destroy();self._super();if(self.statusbar){this.statusbar.remove()}i=windows.length;while(i--){if(windows[i]===self){windows.splice(i,1)}}toggleFullScreenState(windows.length>0);toggleBodyFullScreenClasses(self.classPrefix)},getContentWindow:function(){var ifr=this.getEl().getElementsByTagName("iframe")[0];return ifr?ifr.contentWindow:null}});handleWindowResize();return Window});define("tinymce/ui/MessageBox",["tinymce/ui/Window"],function(Window){"use strict";var MessageBox=Window.extend({init:function(settings){settings={border:1,padding:20,layout:"flex",pack:"center",align:"center",containerCls:"panel",autoScroll:true,buttons:{type:"button",text:"Ok",action:"ok"},items:{type:"label",multiline:true,maxWidth:500,maxHeight:200}};this._super(settings)},Statics:{OK:1,OK_CANCEL:2,YES_NO:3,YES_NO_CANCEL:4,msgBox:function(settings){var buttons,callback=settings.callback||function(){};function createButton(text,status,primary){return{type:"button",text:text,subtype:primary?"primary":"",onClick:function(e){e.control.parents()[1].close();callback(status)}}}switch(settings.buttons){case MessageBox.OK_CANCEL:buttons=[createButton("Ok",true,true),createButton("Cancel",false)];break;case MessageBox.YES_NO:case MessageBox.YES_NO_CANCEL:buttons=[createButton("Yes",1,true),createButton("No",0)];if(settings.buttons==MessageBox.YES_NO_CANCEL){buttons.push(createButton("Cancel",-1))}break;default:buttons=[createButton("Ok",true,true)];break}return new Window({padding:20,x:settings.x,y:settings.y,minWidth:300,minHeight:100,layout:"flex",pack:"center",align:"center",buttons:buttons,title:settings.title,role:"alertdialog",items:{type:"label",multiline:true,maxWidth:500,maxHeight:200,text:settings.text},onPostRender:function(){this.aria("describedby",this.items()[0]._id)},onClose:settings.onClose,onCancel:function(){callback(false)}}).renderTo(document.body).reflow()},alert:function(settings,callback){if(typeof settings=="string"){settings={text:settings}}settings.callback=callback;return MessageBox.msgBox(settings)},confirm:function(settings,callback){if(typeof settings=="string"){settings={text:settings}}settings.callback=callback;settings.buttons=MessageBox.OK_CANCEL;return MessageBox.msgBox(settings)}}});return MessageBox});define("tinymce/WindowManager",["tinymce/ui/Window","tinymce/ui/MessageBox"],function(Window,MessageBox){return function(editor){var self=this,windows=[];function getTopMostWindow(){if(windows.length){return windows[windows.length-1]}}function fireOpenEvent(win){editor.fire("OpenWindow",{win:win})}function fireCloseEvent(win){editor.fire("CloseWindow",{win:win})}self.windows=windows;editor.on("remove",function(){var i=windows.length;while(i--){windows[i].close()}});self.open=function(args,params){var win;editor.editorManager.setActive(editor);args.title=args.title||" ";args.url=args.url||args.file;if(args.url){args.width=parseInt(args.width||320,10);args.height=parseInt(args.height||240,10)}if(args.body){args.items={defaults:args.defaults,type:args.bodyType||"form",items:args.body,data:args.data,callbacks:args.commands}}if(!args.url&&!args.buttons){args.buttons=[{text:"Ok",subtype:"primary",onclick:function(){win.find("form")[0].submit()}},{text:"Cancel",onclick:function(){win.close()}}]}win=new Window(args);windows.push(win);win.on("close",function(){var i=windows.length;while(i--){if(windows[i]===win){windows.splice(i,1)}}if(!windows.length){editor.focus()}fireCloseEvent(win)});if(args.data){win.on("postRender",function(){this.find("*").each(function(ctrl){var name=ctrl.name();if(name in args.data){ctrl.value(args.data[name])}})})}win.features=args||{};win.params=params||{};if(windows.length===1){editor.nodeChanged()}win=win.renderTo().reflow();fireOpenEvent(win);return win};self.alert=function(message,callback,scope){var win;win=MessageBox.alert(message,function(){if(callback){callback.call(scope||this)}else{editor.focus()}});win.on("close",function(){fireCloseEvent(win)});fireOpenEvent(win)};self.confirm=function(message,callback,scope){var win;win=MessageBox.confirm(message,function(state){callback.call(scope||this,state)});win.on("close",function(){fireCloseEvent(win)});fireOpenEvent(win)};self.close=function(){if(getTopMostWindow()){getTopMostWindow().close()}};self.getParams=function(){return getTopMostWindow()?getTopMostWindow().params:null};self.setParams=function(params){if(getTopMostWindow()){getTopMostWindow().params=params}};self.getWindows=function(){return windows}}});define("tinymce/ui/Tooltip",["tinymce/ui/Control","tinymce/ui/Movable"],function(Control,Movable){return Control.extend({Mixins:[Movable],Defaults:{classes:"widget tooltip tooltip-n"},renderHtml:function(){var self=this,prefix=self.classPrefix;return'<div id="'+self._id+'" class="'+self.classes+'" role="presentation">'+'<div class="'+prefix+'tooltip-arrow"></div>'+'<div class="'+prefix+'tooltip-inner">'+self.encode(self.state.get("text"))+"</div>"+"</div>"},bindStates:function(){var self=this;self.state.on("change:text",function(e){self.getEl().lastChild.innerHTML=self.encode(e.value)});return self._super()},repaint:function(){var self=this,style,rect;style=self.getEl().style;rect=self._layoutRect;style.left=rect.x+"px";style.top=rect.y+"px";style.zIndex=65535+65535}})});define("tinymce/ui/Widget",["tinymce/ui/Control","tinymce/ui/Tooltip"],function(Control,Tooltip){"use strict";var tooltip;var Widget=Control.extend({init:function(settings){var self=this;self._super(settings);settings=self.settings;self.canFocus=true;if(settings.tooltip&&Widget.tooltips!==false){self.on("mouseenter",function(e){var tooltip=self.tooltip().moveTo(-65535);if(e.control==self){var rel=tooltip.text(settings.tooltip).show().testMoveRel(self.getEl(),["bc-tc","bc-tl","bc-tr"]);tooltip.classes.toggle("tooltip-n",rel=="bc-tc");tooltip.classes.toggle("tooltip-nw",rel=="bc-tl");tooltip.classes.toggle("tooltip-ne",rel=="bc-tr");tooltip.moveRel(self.getEl(),rel)}else{tooltip.hide()}});self.on("mouseleave mousedown click",function(){self.tooltip().hide()})}self.aria("label",settings.ariaLabel||settings.tooltip)},tooltip:function(){if(!tooltip){tooltip=new Tooltip({type:"tooltip"});tooltip.renderTo()}return tooltip},postRender:function(){var self=this,settings=self.settings;self._super();if(!self.parent()&&(settings.width||settings.height)){self.initLayoutRect();self.repaint()}if(settings.autofocus){self.focus()}},bindStates:function(){var self=this;function disable(state){self.aria("disabled",state);self.classes.toggle("disabled",state)}function active(state){self.aria("pressed",state);self.classes.toggle("active",state)}self.state.on("change:disabled",function(e){disable(e.value)});self.state.on("change:active",function(e){active(e.value)});if(self.state.get("disabled")){disable(true)}if(self.state.get("active")){active(true)}return self._super()},remove:function(){this._super();if(tooltip){tooltip.remove();tooltip=null}}});return Widget});define("tinymce/ui/Progress",["tinymce/ui/Widget"],function(Widget){"use strict";return Widget.extend({Defaults:{value:0},init:function(settings){var self=this;self._super(settings);self.classes.add("progress");if(!self.settings.filter){self.settings.filter=function(value){return Math.round(value)}}},renderHtml:function(){var self=this,id=self._id,prefix=this.classPrefix;return'<div id="'+id+'" class="'+self.classes+'">'+'<div class="'+prefix+'bar-container">'+'<div class="'+prefix+'bar"></div>'+"</div>"+'<div class="'+prefix+'text">0%</div>'+"</div>"},postRender:function(){var self=this;self._super();self.value(self.settings.value);return self},bindStates:function(){var self=this;function setValue(value){value=self.settings.filter(value);self.getEl().lastChild.innerHTML=value+"%";self.getEl().firstChild.firstChild.style.width=value+"%"}self.state.on("change:value",function(e){setValue(e.value)});setValue(self.state.get("value"));return self._super()}})});define("tinymce/ui/Notification",["tinymce/ui/Control","tinymce/ui/Movable","tinymce/ui/Progress","tinymce/util/Delay"],function(Control,Movable,Progress,Delay){return Control.extend({Mixins:[Movable],Defaults:{classes:"widget notification"},init:function(settings){var self=this;self._super(settings);if(settings.text){self.text(settings.text)}if(settings.icon){self.icon=settings.icon}if(settings.color){self.color=settings.color}if(settings.type){self.classes.add("notification-"+settings.type)}if(settings.timeout&&(settings.timeout<0||settings.timeout>0)&&!settings.closeButton){self.closeButton=false}else{self.classes.add("has-close");self.closeButton=true}if(settings.progressBar){self.progressBar=new Progress}self.on("click",function(e){if(e.target.className.indexOf(self.classPrefix+"close")!=-1){self.close()}})},renderHtml:function(){var self=this,prefix=self.classPrefix,icon="",closeButton="",progressBar="",notificationStyle="";if(self.icon){icon='<i class="'+prefix+"ico"+" "+prefix+"i-"+self.icon+'"></i>'}if(self.color){notificationStyle=' style="background-color: '+self.color+'"'}if(self.closeButton){closeButton='<button type="button" class="'+prefix+'close" aria-hidden="true"></button>'}if(self.progressBar){progressBar=self.progressBar.renderHtml()}return'<div id="'+self._id+'" class="'+self.classes+'"'+notificationStyle+' role="presentation">'+icon+'<div class="'+prefix+'notification-inner">'+self.state.get("text")+"</div>"+progressBar+closeButton+"</div>"},postRender:function(){var self=this;Delay.setTimeout(function(){self.$el.addClass(self.classPrefix+"in")});return self._super()},bindStates:function(){var self=this;self.state.on("change:text",function(e){self.getEl().childNodes[1].innerHTML=e.value});if(self.progressBar){self.progressBar.bindStates()}return self._super()},close:function(){var self=this;if(!self.fire("close").isDefaultPrevented()){self.remove()}return self},repaint:function(){var self=this,style,rect;style=self.getEl().style;rect=self._layoutRect;style.left=rect.x+"px";style.top=rect.y+"px";style.zIndex=65535+65535}})});define("tinymce/NotificationManager",["tinymce/ui/Notification","tinymce/util/Delay"],function(Notification,Delay){return function(editor){var self=this,notifications=[];function getLastNotification(){if(notifications.length){return notifications[notifications.length-1]}}self.notifications=notifications;function resizeWindowEvent(){Delay.requestAnimationFrame(function(){prePositionNotifications();positionNotifications()})}function prePositionNotifications(){for(var i=0;i<notifications.length;i++){notifications[i].moveTo(0,0)}}function positionNotifications(){if(notifications.length>0){var firstItem=notifications.slice(0,1)[0];var container=editor.inline?editor.getElement():editor.getContentAreaContainer();firstItem.moveRel(container,"tc-tc");if(notifications.length>1){for(var i=1;i<notifications.length;i++){notifications[i].moveRel(notifications[i-1].getEl(),"bc-tc")}}}}editor.on("remove",function(){var i=notifications.length;while(i--){notifications[i].close()}});editor.on("ResizeEditor",positionNotifications);editor.on("ResizeWindow",resizeWindowEvent);self.open=function(args){var notif;editor.editorManager.setActive(editor);notif=new Notification(args);notifications.push(notif);if(args.timeout>0){notif.timer=setTimeout(function(){notif.close()},args.timeout)}notif.on("close",function(){var i=notifications.length;if(notif.timer){editor.getWin().clearTimeout(notif.timer)}while(i--){if(notifications[i]===notif){notifications.splice(i,1)}}positionNotifications()});notif.renderTo();positionNotifications();return notif};self.close=function(){if(getLastNotification()){getLastNotification().close()}};self.getNotifications=function(){return notifications};editor.on("SkinLoaded",function(){var serviceMessage=editor.settings.service_message;if(serviceMessage){editor.notificationManager.open({text:serviceMessage,type:"warning",timeout:0,icon:""})}})}});define("tinymce/dom/NodePath",["tinymce/dom/DOMUtils"],function(DOMUtils){function create(rootNode,targetNode,normalized){var path=[];for(;targetNode&&targetNode!=rootNode;targetNode=targetNode.parentNode){path.push(DOMUtils.nodeIndex(targetNode,normalized))}return path}function resolve(rootNode,path){var i,node,children;for(node=rootNode,i=path.length-1;i>=0;i--){children=node.childNodes;if(path[i]>children.length-1){return null}node=children[path[i]]}return node}return{create:create,resolve:resolve}});define("tinymce/util/Quirks",["tinymce/util/VK","tinymce/dom/RangeUtils","tinymce/dom/TreeWalker","tinymce/dom/NodePath","tinymce/html/Node","tinymce/html/Entities","tinymce/Env","tinymce/util/Tools","tinymce/util/Delay","tinymce/caret/CaretContainer"],function(VK,RangeUtils,TreeWalker,NodePath,Node,Entities,Env,Tools,Delay,CaretContainer){return function(editor){var each=Tools.each,$=editor.$;var BACKSPACE=VK.BACKSPACE,DELETE=VK.DELETE,dom=editor.dom,selection=editor.selection,settings=editor.settings,parser=editor.parser,serializer=editor.serializer;var isGecko=Env.gecko,isIE=Env.ie,isWebKit=Env.webkit;var mceInternalUrlPrefix="data:text/mce-internal,";var mceInternalDataType=isIE?"Text":"URL";function setEditorCommandState(cmd,state){try{editor.getDoc().execCommand(cmd,false,state)}catch(ex){}}function getDocumentMode(){var documentMode=editor.getDoc().documentMode;return documentMode?documentMode:6}function isDefaultPrevented(e){return e.isDefaultPrevented()}function setMceInternalContent(e){var selectionHtml,internalContent;if(e.dataTransfer){if(editor.selection.isCollapsed()&&e.target.tagName=="IMG"){selection.select(e.target)}selectionHtml=editor.selection.getContent();if(selectionHtml.length>0){internalContent=mceInternalUrlPrefix+escape(editor.id)+","+escape(selectionHtml);e.dataTransfer.setData(mceInternalDataType,internalContent)}}}function getMceInternalContent(e){var internalContent;if(e.dataTransfer){internalContent=e.dataTransfer.getData(mceInternalDataType);if(internalContent&&internalContent.indexOf(mceInternalUrlPrefix)>=0){internalContent=internalContent.substr(mceInternalUrlPrefix.length).split(",");return{id:unescape(internalContent[0]),html:unescape(internalContent[1])}}}return null}function insertClipboardContents(content){if(editor.queryCommandSupported("mceInsertClipboardContent")){editor.execCommand("mceInsertClipboardContent",false,{content:content})}else{editor.execCommand("mceInsertContent",false,content)}}function cleanupStylesWhenDeleting(){var doc=editor.getDoc(),dom=editor.dom,selection=editor.selection;var MutationObserver=window.MutationObserver,olderWebKit,dragStartRng;if(!MutationObserver){olderWebKit=true;MutationObserver=function(){var records=[],target;function nodeInsert(e){var target=e.relatedNode||e.target;records.push({target:target,addedNodes:[target]})}function attrModified(e){var target=e.relatedNode||e.target;records.push({target:target,attributeName:e.attrName})}this.observe=function(node){target=node;target.addEventListener("DOMSubtreeModified",nodeInsert,false);target.addEventListener("DOMNodeInsertedIntoDocument",nodeInsert,false);target.addEventListener("DOMNodeInserted",nodeInsert,false);target.addEventListener("DOMAttrModified",attrModified,false)};this.disconnect=function(){target.removeEventListener("DOMSubtreeModified",nodeInsert,false);target.removeEventListener("DOMNodeInsertedIntoDocument",nodeInsert,false);target.removeEventListener("DOMNodeInserted",nodeInsert,false);target.removeEventListener("DOMAttrModified",attrModified,false)};this.takeRecords=function(){return records}}}function isTrailingBr(node){var blockElements=dom.schema.getBlockElements(),rootNode=editor.getBody();if(node.nodeName!="BR"){return false}for(;node!=rootNode&&!blockElements[node.nodeName];node=node.parentNode){if(node.nextSibling){return false}}return true}function isSiblingsIgnoreWhiteSpace(node1,node2){var node;for(node=node1.nextSibling;node&&node!=node2;node=node.nextSibling){if(node.nodeType==3&&$.trim(node.data).length===0){continue}if(node!==node2){return false}}return node===node2}function findCaretNode(node,forward,startNode){var walker,current,nonEmptyElements;nonEmptyElements=dom.schema.getNonEmptyElements();walker=new TreeWalker(startNode||node,node);while(current=walker[forward?"next":"prev"]()){if(nonEmptyElements[current.nodeName]&&!isTrailingBr(current)){return current}if(current.nodeType==3&&current.data.length>0){return current}}}function deleteRangeBetweenTextBlocks(rng){var startBlock,endBlock,caretNodeBefore,caretNodeAfter,textBlockElements;if(rng.collapsed){return}startBlock=dom.getParent(RangeUtils.getNode(rng.startContainer,rng.startOffset),dom.isBlock);endBlock=dom.getParent(RangeUtils.getNode(rng.endContainer,rng.endOffset),dom.isBlock);textBlockElements=editor.schema.getTextBlockElements();if(startBlock==endBlock){return}if(!textBlockElements[startBlock.nodeName]||!textBlockElements[endBlock.nodeName]){return}if(dom.getContentEditable(startBlock)==="false"||dom.getContentEditable(endBlock)==="false"){return}rng.deleteContents();caretNodeBefore=findCaretNode(startBlock,false);caretNodeAfter=findCaretNode(endBlock,true);if(!dom.isEmpty(endBlock)){$(startBlock).append(endBlock.childNodes)}$(endBlock).remove();if(caretNodeBefore){if(caretNodeBefore.nodeType==1){if(caretNodeBefore.nodeName=="BR"){rng.setStartBefore(caretNodeBefore);rng.setEndBefore(caretNodeBefore)}else{rng.setStartAfter(caretNodeBefore);rng.setEndAfter(caretNodeBefore);
}}else{rng.setStart(caretNodeBefore,caretNodeBefore.data.length);rng.setEnd(caretNodeBefore,caretNodeBefore.data.length)}}else if(caretNodeAfter){if(caretNodeAfter.nodeType==1){rng.setStartBefore(caretNodeAfter);rng.setEndBefore(caretNodeAfter)}else{rng.setStart(caretNodeAfter,0);rng.setEnd(caretNodeAfter,0)}}selection.setRng(rng);return true}function expandBetweenBlocks(rng,isForward){var caretNode,targetCaretNode,textBlock,targetTextBlock,container,offset;if(!rng.collapsed){return rng}container=rng.startContainer;offset=rng.startOffset;if(container.nodeType==3){if(isForward){if(offset<container.data.length){return rng}}else{if(offset>0){return rng}}}caretNode=RangeUtils.getNode(rng.startContainer,rng.startOffset);textBlock=dom.getParent(caretNode,dom.isBlock);targetCaretNode=findCaretNode(editor.getBody(),isForward,caretNode);targetTextBlock=dom.getParent(targetCaretNode,dom.isBlock);if(!caretNode||!targetCaretNode){return rng}if(targetTextBlock&&textBlock!=targetTextBlock){if(!isForward){if(!isSiblingsIgnoreWhiteSpace(targetTextBlock,textBlock)){return rng}if(targetCaretNode.nodeType==1){if(targetCaretNode.nodeName=="BR"){rng.setStartBefore(targetCaretNode)}else{rng.setStartAfter(targetCaretNode)}}else{rng.setStart(targetCaretNode,targetCaretNode.data.length)}if(caretNode.nodeType==1){rng.setEnd(caretNode,0)}else{rng.setEndBefore(caretNode)}}else{if(!isSiblingsIgnoreWhiteSpace(textBlock,targetTextBlock)){return rng}if(caretNode.nodeType==1){if(caretNode.nodeName=="BR"){rng.setStartBefore(caretNode)}else{rng.setStartAfter(caretNode)}}else{rng.setStart(caretNode,caretNode.data.length)}if(targetCaretNode.nodeType==1){rng.setEnd(targetCaretNode,0)}else{rng.setEndBefore(targetCaretNode)}}}return rng}function handleTextBlockMergeDelete(isForward){var rng=selection.getRng();rng=expandBetweenBlocks(rng,isForward);if(deleteRangeBetweenTextBlocks(rng)){return true}}function handleLastBlockCharacterDelete(isForward,rng){var path,blockElm,newBlockElm,clonedBlockElm,sibling,container,offset,br,currentFormatNodes;function cloneTextBlockWithFormats(blockElm,node){currentFormatNodes=$(node).parents().filter(function(idx,node){return!!editor.schema.getTextInlineElements()[node.nodeName]});newBlockElm=blockElm.cloneNode(false);currentFormatNodes=Tools.map(currentFormatNodes,function(formatNode){formatNode=formatNode.cloneNode(false);if(newBlockElm.hasChildNodes()){formatNode.appendChild(newBlockElm.firstChild);newBlockElm.appendChild(formatNode)}else{newBlockElm.appendChild(formatNode)}newBlockElm.appendChild(formatNode);return formatNode});if(currentFormatNodes.length){br=dom.create("br");currentFormatNodes[0].appendChild(br);dom.replace(newBlockElm,blockElm);rng.setStartBefore(br);rng.setEndBefore(br);editor.selection.setRng(rng);return br}return null}function isTextBlock(node){return node&&editor.schema.getTextBlockElements()[node.tagName]}if(!rng.collapsed){return}container=rng.startContainer;offset=rng.startOffset;blockElm=dom.getParent(container,dom.isBlock);if(!isTextBlock(blockElm)){return}if(container.nodeType==1){container=container.childNodes[offset];if(container&&container.tagName!="BR"){return}if(isForward){sibling=blockElm.nextSibling}else{sibling=blockElm.previousSibling}if(dom.isEmpty(blockElm)&&isTextBlock(sibling)&&dom.isEmpty(sibling)){if(cloneTextBlockWithFormats(blockElm,container)){dom.remove(sibling);return true}}}else if(container.nodeType==3){path=NodePath.create(blockElm,container);clonedBlockElm=blockElm.cloneNode(true);container=NodePath.resolve(clonedBlockElm,path);if(isForward){if(offset>=container.data.length){return}container.deleteData(offset,1)}else{if(offset<=0){return}container.deleteData(offset-1,1)}if(dom.isEmpty(clonedBlockElm)){return cloneTextBlockWithFormats(blockElm,container)}}}function customDelete(isForward){var mutationObserver,rng,caretElement;if(handleTextBlockMergeDelete(isForward)){return}Tools.each(editor.getBody().getElementsByTagName("*"),function(elm){if(elm.tagName=="SPAN"){elm.setAttribute("mce-data-marked",1)}if(!elm.hasAttribute("data-mce-style")&&elm.hasAttribute("style")){editor.dom.setAttrib(elm,"style",editor.dom.getAttrib(elm,"style"))}});mutationObserver=new MutationObserver(function(){});mutationObserver.observe(editor.getDoc(),{childList:true,attributes:true,subtree:true,attributeFilter:["style"]});editor.getDoc().execCommand(isForward?"ForwardDelete":"Delete",false,null);rng=editor.selection.getRng();caretElement=rng.startContainer.parentNode;Tools.each(mutationObserver.takeRecords(),function(record){if(!dom.isChildOf(record.target,editor.getBody())){return}if(record.attributeName=="style"){var oldValue=record.target.getAttribute("data-mce-style");if(oldValue){record.target.setAttribute("style",oldValue)}else{record.target.removeAttribute("style")}}Tools.each(record.addedNodes,function(node){if(node.nodeName=="SPAN"&&!node.getAttribute("mce-data-marked")){var offset,container;if(node==caretElement){offset=rng.startOffset;container=node.firstChild}dom.remove(node,true);if(container){rng.setStart(container,offset);rng.setEnd(container,offset);editor.selection.setRng(rng)}}})});mutationObserver.disconnect();Tools.each(editor.dom.select("span[mce-data-marked]"),function(span){span.removeAttribute("mce-data-marked")})}editor.on("keydown",function(e){var isForward=e.keyCode==DELETE,isMetaOrCtrl=e.ctrlKey||e.metaKey;if(!isDefaultPrevented(e)&&(isForward||e.keyCode==BACKSPACE)){var rng=editor.selection.getRng(),container=rng.startContainer,offset=rng.startOffset;if(isForward&&e.shiftKey){return}if(handleLastBlockCharacterDelete(isForward,rng)){e.preventDefault();return}if(!isMetaOrCtrl&&rng.collapsed&&container.nodeType==3){if(isForward?offset<container.data.length:offset>0){return}}e.preventDefault();if(isMetaOrCtrl){editor.selection.getSel().modify("extend",isForward?"forward":"backward",e.metaKey?"lineboundary":"word")}customDelete(isForward)}});editor.on("keypress",function(e){if(!isDefaultPrevented(e)&&!selection.isCollapsed()&&e.charCode>31&&!VK.metaKeyPressed(e)){var rng,currentFormatNodes,fragmentNode,blockParent,caretNode,charText;rng=editor.selection.getRng();charText=String.fromCharCode(e.charCode);e.preventDefault();currentFormatNodes=$(rng.startContainer).parents().filter(function(idx,node){return!!editor.schema.getTextInlineElements()[node.nodeName]});customDelete(true);currentFormatNodes=currentFormatNodes.filter(function(idx,node){return!$.contains(editor.getBody(),node)});if(currentFormatNodes.length){fragmentNode=dom.createFragment();currentFormatNodes.each(function(idx,formatNode){formatNode=formatNode.cloneNode(false);if(fragmentNode.hasChildNodes()){formatNode.appendChild(fragmentNode.firstChild);fragmentNode.appendChild(formatNode)}else{caretNode=formatNode;fragmentNode.appendChild(formatNode)}fragmentNode.appendChild(formatNode)});caretNode.appendChild(editor.getDoc().createTextNode(charText));blockParent=dom.getParent(rng.startContainer,dom.isBlock);if(dom.isEmpty(blockParent)){$(blockParent).empty().append(fragmentNode)}else{rng.insertNode(fragmentNode)}rng.setStart(caretNode.firstChild,1);rng.setEnd(caretNode.firstChild,1);editor.selection.setRng(rng)}else{editor.selection.setContent(charText)}}});editor.addCommand("Delete",function(){customDelete()});editor.addCommand("ForwardDelete",function(){customDelete(true)});if(olderWebKit){return}editor.on("dragstart",function(e){dragStartRng=selection.getRng();setMceInternalContent(e)});editor.on("drop",function(e){if(!isDefaultPrevented(e)){var internalContent=getMceInternalContent(e);if(internalContent){e.preventDefault();Delay.setEditorTimeout(editor,function(){var pointRng=RangeUtils.getCaretRangeFromPoint(e.x,e.y,doc);if(dragStartRng){selection.setRng(dragStartRng);dragStartRng=null}customDelete();selection.setRng(pointRng);insertClipboardContents(internalContent.html)})}}});editor.on("cut",function(e){if(!isDefaultPrevented(e)&&e.clipboardData&&!editor.selection.isCollapsed()){e.preventDefault();e.clipboardData.clearData();e.clipboardData.setData("text/html",editor.selection.getContent());e.clipboardData.setData("text/plain",editor.selection.getContent({format:"text"}));Delay.setEditorTimeout(editor,function(){customDelete(true)})}})}function emptyEditorWhenDeleting(){function serializeRng(rng){var body=dom.create("body");var contents=rng.cloneContents();body.appendChild(contents);return selection.serializer.serialize(body,{format:"html"})}function allContentsSelected(rng){if(!rng.setStart){if(rng.item){return false}var bodyRng=rng.duplicate();bodyRng.moveToElementText(editor.getBody());return RangeUtils.compareRanges(rng,bodyRng)}var selection=serializeRng(rng);var allRng=dom.createRng();allRng.selectNode(editor.getBody());var allSelection=serializeRng(allRng);return selection===allSelection}editor.on("keydown",function(e){var keyCode=e.keyCode,isCollapsed,body;if(!isDefaultPrevented(e)&&(keyCode==DELETE||keyCode==BACKSPACE)){isCollapsed=editor.selection.isCollapsed();body=editor.getBody();if(isCollapsed&&!dom.isEmpty(body)){return}if(!isCollapsed&&!allContentsSelected(editor.selection.getRng())){return}e.preventDefault();editor.setContent("");if(body.firstChild&&dom.isBlock(body.firstChild)){editor.selection.setCursorLocation(body.firstChild,0)}else{editor.selection.setCursorLocation(body,0)}editor.nodeChanged()}})}function selectAll(){editor.shortcuts.add("meta+a",null,"SelectAll")}function inputMethodFocus(){if(!editor.settings.content_editable){dom.bind(editor.getDoc(),"mousedown mouseup",function(e){var rng;if(e.target==editor.getDoc().documentElement){rng=selection.getRng();editor.getBody().focus();if(e.type=="mousedown"){if(CaretContainer.isCaretContainer(rng.startContainer)){return}selection.placeCaretAt(e.clientX,e.clientY)}else{selection.setRng(rng)}}})}}function removeHrOnBackspace(){editor.on("keydown",function(e){if(!isDefaultPrevented(e)&&e.keyCode===BACKSPACE){if(!editor.getBody().getElementsByTagName("hr").length){return}if(selection.isCollapsed()&&selection.getRng(true).startOffset===0){var node=selection.getNode();var previousSibling=node.previousSibling;if(node.nodeName=="HR"){dom.remove(node);e.preventDefault();return}if(previousSibling&&previousSibling.nodeName&&previousSibling.nodeName.toLowerCase()==="hr"){dom.remove(previousSibling);e.preventDefault()}}}})}function focusBody(){if(!window.Range.prototype.getClientRects){editor.on("mousedown",function(e){if(!isDefaultPrevented(e)&&e.target.nodeName==="HTML"){var body=editor.getBody();body.blur();Delay.setEditorTimeout(editor,function(){body.focus()})}})}}function selectControlElements(){editor.on("click",function(e){var target=e.target;if(/^(IMG|HR)$/.test(target.nodeName)&&dom.getContentEditableParent(target)!=="false"){e.preventDefault();selection.getSel().setBaseAndExtent(target,0,target,1);editor.nodeChanged()}if(target.nodeName=="A"&&dom.hasClass(target,"mce-item-anchor")){e.preventDefault();selection.select(target)}})}function removeStylesWhenDeletingAcrossBlockElements(){function getAttributeApplyFunction(){var template=dom.getAttribs(selection.getStart().cloneNode(false));return function(){var target=selection.getStart();if(target!==editor.getBody()){dom.setAttrib(target,"style",null);each(template,function(attr){target.setAttributeNode(attr.cloneNode(true))})}}}function isSelectionAcrossElements(){return!selection.isCollapsed()&&dom.getParent(selection.getStart(),dom.isBlock)!=dom.getParent(selection.getEnd(),dom.isBlock)}editor.on("keypress",function(e){var applyAttributes;if(!isDefaultPrevented(e)&&(e.keyCode==8||e.keyCode==46)&&isSelectionAcrossElements()){applyAttributes=getAttributeApplyFunction();editor.getDoc().execCommand("delete",false,null);applyAttributes();e.preventDefault();return false}});dom.bind(editor.getDoc(),"cut",function(e){var applyAttributes;if(!isDefaultPrevented(e)&&isSelectionAcrossElements()){applyAttributes=getAttributeApplyFunction();Delay.setEditorTimeout(editor,function(){applyAttributes()})}})}function ensureBodyHasRoleApplication(){document.body.setAttribute("role","application")}function disableBackspaceIntoATable(){editor.on("keydown",function(e){if(!isDefaultPrevented(e)&&e.keyCode===BACKSPACE){if(selection.isCollapsed()&&selection.getRng(true).startOffset===0){var previousSibling=selection.getNode().previousSibling;if(previousSibling&&previousSibling.nodeName&&previousSibling.nodeName.toLowerCase()==="table"){e.preventDefault();return false}}}})}function addNewLinesBeforeBrInPre(){if(getDocumentMode()>7){return}setEditorCommandState("RespectVisibilityInDesign",true);editor.contentStyles.push(".mceHideBrInPre pre br {display: none}");dom.addClass(editor.getBody(),"mceHideBrInPre");parser.addNodeFilter("pre",function(nodes){var i=nodes.length,brNodes,j,brElm,sibling;while(i--){brNodes=nodes[i].getAll("br");j=brNodes.length;while(j--){brElm=brNodes[j];sibling=brElm.prev;if(sibling&&sibling.type===3&&sibling.value.charAt(sibling.value-1)!="\n"){sibling.value+="\n"}else{brElm.parent.insert(new Node("#text",3),brElm,true).value="\n"}}}});serializer.addNodeFilter("pre",function(nodes){var i=nodes.length,brNodes,j,brElm,sibling;while(i--){brNodes=nodes[i].getAll("br");j=brNodes.length;while(j--){brElm=brNodes[j];sibling=brElm.prev;if(sibling&&sibling.type==3){sibling.value=sibling.value.replace(/\r?\n$/,"")}}}})}function removePreSerializedStylesWhenSelectingControls(){dom.bind(editor.getBody(),"mouseup",function(){var value,node=selection.getNode();if(node.nodeName=="IMG"){if(value=dom.getStyle(node,"width")){dom.setAttrib(node,"width",value.replace(/[^0-9%]+/g,""));dom.setStyle(node,"width","")}if(value=dom.getStyle(node,"height")){dom.setAttrib(node,"height",value.replace(/[^0-9%]+/g,""));dom.setStyle(node,"height","")}}})}function removeBlockQuoteOnBackSpace(){editor.on("keydown",function(e){var rng,container,offset,root,parent;if(isDefaultPrevented(e)||e.keyCode!=VK.BACKSPACE){return}rng=selection.getRng();container=rng.startContainer;offset=rng.startOffset;root=dom.getRoot();parent=container;if(!rng.collapsed||offset!==0){return}while(parent&&parent.parentNode&&parent.parentNode.firstChild==parent&&parent.parentNode!=root){parent=parent.parentNode}if(parent.tagName==="BLOCKQUOTE"){editor.formatter.toggle("blockquote",null,parent);rng=dom.createRng();rng.setStart(container,0);rng.setEnd(container,0);selection.setRng(rng)}})}function setGeckoEditingOptions(){function setOpts(){refreshContentEditable();setEditorCommandState("StyleWithCSS",false);setEditorCommandState("enableInlineTableEditing",false);if(!settings.object_resizing){setEditorCommandState("enableObjectResizing",false)}}if(!settings.readonly){editor.on("BeforeExecCommand MouseDown",setOpts)}}function addBrAfterLastLinks(){function fixLinks(){each(dom.select("a"),function(node){var parentNode=node.parentNode,root=dom.getRoot();if(parentNode.lastChild===node){while(parentNode&&!dom.isBlock(parentNode)){if(parentNode.parentNode.lastChild!==parentNode||parentNode===root){return}parentNode=parentNode.parentNode}dom.add(parentNode,"br",{"data-mce-bogus":1})}})}editor.on("SetContent ExecCommand",function(e){if(e.type=="setcontent"||e.command==="mceInsertLink"){fixLinks()}})}function setDefaultBlockType(){if(settings.forced_root_block){editor.on("init",function(){setEditorCommandState("DefaultParagraphSeparator",settings.forced_root_block)})}}function deleteControlItemOnBackSpace(){editor.on("keydown",function(e){var rng;if(!isDefaultPrevented(e)&&e.keyCode==BACKSPACE){rng=editor.getDoc().selection.createRange();if(rng&&rng.item){e.preventDefault();editor.undoManager.beforeChange();dom.remove(rng.item(0));editor.undoManager.add()}}})}function renderEmptyBlocksFix(){var emptyBlocksCSS;if(getDocumentMode()>=10){emptyBlocksCSS="";each("p div h1 h2 h3 h4 h5 h6".split(" "),function(name,i){emptyBlocksCSS+=(i>0?",":"")+name+":empty"});editor.contentStyles.push(emptyBlocksCSS+"{padding-right: 1px !important}")}}function keepNoScriptContents(){if(getDocumentMode()<9){parser.addNodeFilter("noscript",function(nodes){var i=nodes.length,node,textNode;while(i--){node=nodes[i];textNode=node.firstChild;if(textNode){node.attr("data-mce-innertext",textNode.value)}}});serializer.addNodeFilter("noscript",function(nodes){var i=nodes.length,node,textNode,value;while(i--){node=nodes[i];textNode=nodes[i].firstChild;if(textNode){textNode.value=Entities.decode(textNode.value)}else{value=node.attributes.map["data-mce-innertext"];if(value){node.attr("data-mce-innertext",null);textNode=new Node("#text",3);textNode.value=value;textNode.raw=true;node.append(textNode)}}}})}}function fixCaretSelectionOfDocumentElementOnIe(){var doc=dom.doc,body=doc.body,started,startRng,htmlElm;function rngFromPoint(x,y){var rng=body.createTextRange();try{rng.moveToPoint(x,y)}catch(ex){rng=null}return rng}function selectionChange(e){var pointRng;if(e.button){pointRng=rngFromPoint(e.x,e.y);if(pointRng){if(pointRng.compareEndPoints("StartToStart",startRng)>0){pointRng.setEndPoint("StartToStart",startRng)}else{pointRng.setEndPoint("EndToEnd",startRng)}pointRng.select()}}else{endSelection()}}function endSelection(){var rng=doc.selection.createRange();if(startRng&&!rng.item&&rng.compareEndPoints("StartToEnd",rng)===0){startRng.select()}dom.unbind(doc,"mouseup",endSelection);dom.unbind(doc,"mousemove",selectionChange);startRng=started=0}doc.documentElement.unselectable=true;dom.bind(doc,"mousedown contextmenu",function(e){if(e.target.nodeName==="HTML"){if(started){endSelection()}htmlElm=doc.documentElement;if(htmlElm.scrollHeight>htmlElm.clientHeight){return}started=1;startRng=rngFromPoint(e.x,e.y);if(startRng){dom.bind(doc,"mouseup",endSelection);dom.bind(doc,"mousemove",selectionChange);dom.getRoot().focus();startRng.select()}}})}function normalizeSelection(){editor.on("keyup focusin mouseup",function(e){if(e.keyCode!=65||!VK.metaKeyPressed(e)){selection.normalize()}},true)}function showBrokenImageIcon(){editor.contentStyles.push("img:-moz-broken {"+"-moz-force-broken-image-icon:1;"+"min-width:24px;"+"min-height:24px"+"}")}function restoreFocusOnKeyDown(){if(!editor.inline){editor.on("keydown",function(){if(document.activeElement==document.body){editor.getWin().focus()}})}}function bodyHeight(){if(!editor.inline){editor.contentStyles.push("body {min-height: 150px}");editor.on("click",function(e){var rng;if(e.target.nodeName=="HTML"){if(Env.ie>11){editor.getBody().focus();return}rng=editor.selection.getRng();editor.getBody().focus();editor.selection.setRng(rng);editor.selection.normalize();editor.nodeChanged()}})}}function blockCmdArrowNavigation(){if(Env.mac){editor.on("keydown",function(e){if(VK.metaKeyPressed(e)&&!e.shiftKey&&(e.keyCode==37||e.keyCode==39)){e.preventDefault();editor.selection.getSel().modify("move",e.keyCode==37?"backward":"forward","lineboundary")}})}}function disableAutoUrlDetect(){setEditorCommandState("AutoUrlDetect",false)}function tapLinksAndImages(){editor.on("click",function(e){var elm=e.target;do{if(elm.tagName==="A"){e.preventDefault();return}}while(elm=elm.parentNode)});editor.contentStyles.push(".mce-content-body {-webkit-touch-callout: none}")}function blockFormSubmitInsideEditor(){editor.on("init",function(){editor.dom.bind(editor.getBody(),"submit",function(e){e.preventDefault()})})}function removeAppleInterchangeBrs(){parser.addNodeFilter("br",function(nodes){var i=nodes.length;while(i--){if(nodes[i].attr("class")=="Apple-interchange-newline"){nodes[i].remove()}}})}function ieInternalDragAndDrop(){editor.on("dragstart",function(e){setMceInternalContent(e)});editor.on("drop",function(e){if(!isDefaultPrevented(e)){var internalContent=getMceInternalContent(e);if(internalContent&&internalContent.id!=editor.id){e.preventDefault();var rng=RangeUtils.getCaretRangeFromPoint(e.x,e.y,editor.getDoc());selection.setRng(rng);insertClipboardContents(internalContent.html)}}})}function refreshContentEditable(){var body,parent;if(isHidden()){body=editor.getBody();parent=body.parentNode;parent.removeChild(body);parent.appendChild(body);body.focus()}}function isHidden(){var sel;if(!isGecko){return 0}sel=editor.selection.getSel();return!sel||!sel.rangeCount||sel.rangeCount===0}removeBlockQuoteOnBackSpace();emptyEditorWhenDeleting();if(!Env.windowsPhone){normalizeSelection()}if(isWebKit){cleanupStylesWhenDeleting();inputMethodFocus();selectControlElements();setDefaultBlockType();blockFormSubmitInsideEditor();disableBackspaceIntoATable();removeAppleInterchangeBrs();if(Env.iOS){restoreFocusOnKeyDown();bodyHeight();tapLinksAndImages()}else{selectAll()}}if(isIE&&Env.ie<11){removeHrOnBackspace();ensureBodyHasRoleApplication();addNewLinesBeforeBrInPre();removePreSerializedStylesWhenSelectingControls();deleteControlItemOnBackSpace();renderEmptyBlocksFix();keepNoScriptContents();fixCaretSelectionOfDocumentElementOnIe()}if(Env.ie>=11){bodyHeight();disableBackspaceIntoATable()}if(Env.ie){selectAll();disableAutoUrlDetect();ieInternalDragAndDrop()}if(isGecko){removeHrOnBackspace();focusBody();removeStylesWhenDeletingAcrossBlockElements();setGeckoEditingOptions();addBrAfterLastLinks();showBrokenImageIcon();blockCmdArrowNavigation();disableBackspaceIntoATable()}return{refreshContentEditable:refreshContentEditable,isHidden:isHidden}}});define("tinymce/EditorObservable",["tinymce/util/Observable","tinymce/dom/DOMUtils","tinymce/util/Tools"],function(Observable,DOMUtils,Tools){var DOM=DOMUtils.DOM,customEventRootDelegates;function getEventTarget(editor,eventName){if(eventName=="selectionchange"){return editor.getDoc()}if(!editor.inline&&/^mouse|click|contextmenu|drop|dragover|dragend/.test(eventName)){return editor.getDoc().documentElement}if(editor.settings.event_root){if(!editor.eventRoot){editor.eventRoot=DOM.select(editor.settings.event_root)[0]}return editor.eventRoot}return editor.getBody()}function bindEventDelegate(editor,eventName){var eventRootElm=getEventTarget(editor,eventName),delegate;function isListening(editor){return!editor.hidden&&!editor.readonly}if(!editor.delegates){editor.delegates={}}if(editor.delegates[eventName]){return}if(editor.settings.event_root){if(!customEventRootDelegates){customEventRootDelegates={};editor.editorManager.on("removeEditor",function(){var name;if(!editor.editorManager.activeEditor){if(customEventRootDelegates){for(name in customEventRootDelegates){editor.dom.unbind(getEventTarget(editor,name))}customEventRootDelegates=null}}})}if(customEventRootDelegates[eventName]){return}delegate=function(e){var target=e.target,editors=editor.editorManager.editors,i=editors.length;while(i--){var body=editors[i].getBody();if(body===target||DOM.isChildOf(target,body)){if(isListening(editors[i])){editors[i].fire(eventName,e)}}}};customEventRootDelegates[eventName]=delegate;DOM.bind(eventRootElm,eventName,delegate)}else{delegate=function(e){if(isListening(editor)){editor.fire(eventName,e)}};DOM.bind(eventRootElm,eventName,delegate);editor.delegates[eventName]=delegate}}var EditorObservable={bindPendingEventDelegates:function(){var self=this;Tools.each(self._pendingNativeEvents,function(name){bindEventDelegate(self,name)})},toggleNativeEvent:function(name,state){var self=this;if(name=="focus"||name=="blur"){return}if(state){if(self.initialized){bindEventDelegate(self,name)}else{if(!self._pendingNativeEvents){self._pendingNativeEvents=[name]}else{self._pendingNativeEvents.push(name)}}}else if(self.initialized){self.dom.unbind(getEventTarget(self,name),name,self.delegates[name]);delete self.delegates[name]}},unbindAllNativeEvents:function(){var self=this,name;if(self.delegates){for(name in self.delegates){self.dom.unbind(getEventTarget(self,name),name,self.delegates[name])}delete self.delegates}if(!self.inline){self.getBody().onload=null;self.dom.unbind(self.getWin());self.dom.unbind(self.getDoc())}self.dom.unbind(self.getBody());self.dom.unbind(self.getContainer())}};EditorObservable=Tools.extend({},Observable,EditorObservable);return EditorObservable});define("tinymce/Mode",[],function(){function setEditorCommandState(editor,cmd,state){try{editor.getDoc().execCommand(cmd,false,state)}catch(ex){}}function clickBlocker(editor){var target,handler;target=editor.getBody();handler=function(e){if(editor.dom.getParents(e.target,"a").length>0){e.preventDefault()}};editor.dom.bind(target,"click",handler);return{unbind:function(){editor.dom.unbind(target,"click",handler)}}}function toggleReadOnly(editor,state){if(editor._clickBlocker){editor._clickBlocker.unbind();editor._clickBlocker=null}if(state){editor._clickBlocker=clickBlocker(editor);editor.selection.controlSelection.hideResizeRect();editor.readonly=true;editor.getBody().contentEditable=false}else{editor.readonly=false;editor.getBody().contentEditable=true;setEditorCommandState(editor,"StyleWithCSS",false);setEditorCommandState(editor,"enableInlineTableEditing",false);setEditorCommandState(editor,"enableObjectResizing",false);editor.focus();editor.nodeChanged()}}function setMode(editor,mode){var currentMode=editor.readonly?"readonly":"design";if(mode==currentMode){return}if(editor.initialized){toggleReadOnly(editor,mode=="readonly")}else{editor.on("init",function(){toggleReadOnly(editor,mode=="readonly")})}editor.fire("SwitchMode",{mode:mode})}return{setMode:setMode}});define("tinymce/Shortcuts",["tinymce/util/Tools","tinymce/Env"],function(Tools,Env){var each=Tools.each,explode=Tools.explode;var keyCodeLookup={f9:120,f10:121,f11:122};var modifierNames=Tools.makeMap("alt,ctrl,shift,meta,access");return function(editor){var self=this,shortcuts={},pendingPatterns=[];function parseShortcut(pattern){var id,key,shortcut={};each(explode(pattern,"+"),function(value){if(value in modifierNames){shortcut[value]=true}else{if(/^[0-9]{2,}$/.test(value)){shortcut.keyCode=parseInt(value,10)}else{shortcut.charCode=value.charCodeAt(0);shortcut.keyCode=keyCodeLookup[value]||value.toUpperCase().charCodeAt(0)}}});id=[shortcut.keyCode];for(key in modifierNames){if(shortcut[key]){id.push(key)}else{shortcut[key]=false}}shortcut.id=id.join(",");if(shortcut.access){shortcut.alt=true;if(Env.mac){shortcut.ctrl=true}else{shortcut.shift=true}}if(shortcut.meta){if(Env.mac){shortcut.meta=true}else{shortcut.ctrl=true;shortcut.meta=false}}return shortcut}function createShortcut(pattern,desc,cmdFunc,scope){var shortcuts;shortcuts=Tools.map(explode(pattern,">"),parseShortcut);shortcuts[shortcuts.length-1]=Tools.extend(shortcuts[shortcuts.length-1],{func:cmdFunc,scope:scope||editor});return Tools.extend(shortcuts[0],{desc:editor.translate(desc),subpatterns:shortcuts.slice(1)})}function hasModifier(e){return e.altKey||e.ctrlKey||e.metaKey}function isFunctionKey(e){return e.keyCode>=112&&e.keyCode<=123}function matchShortcut(e,shortcut){if(!shortcut){return false}if(shortcut.ctrl!=e.ctrlKey||shortcut.meta!=e.metaKey){return false}if(shortcut.alt!=e.altKey||shortcut.shift!=e.shiftKey){return false}if(e.keyCode==shortcut.keyCode||e.charCode&&e.charCode==shortcut.charCode){e.preventDefault();return true}return false}function executeShortcutAction(shortcut){return shortcut.func?shortcut.func.call(shortcut.scope):null}editor.on("keyup keypress keydown",function(e){if((hasModifier(e)||isFunctionKey(e))&&!e.isDefaultPrevented()){each(shortcuts,function(shortcut){if(matchShortcut(e,shortcut)){pendingPatterns=shortcut.subpatterns.slice(0);if(e.type=="keydown"){executeShortcutAction(shortcut)}return true}});if(matchShortcut(e,pendingPatterns[0])){if(pendingPatterns.length===1){if(e.type=="keydown"){executeShortcutAction(pendingPatterns[0])}}pendingPatterns.shift()}}});self.add=function(pattern,desc,cmdFunc,scope){var cmd;cmd=cmdFunc;if(typeof cmdFunc==="string"){cmdFunc=function(){editor.execCommand(cmd,false,null)}}else if(Tools.isArray(cmd)){cmdFunc=function(){editor.execCommand(cmd[0],cmd[1],cmd[2])}}each(explode(Tools.trim(pattern.toLowerCase())),function(pattern){var shortcut=createShortcut(pattern,desc,cmdFunc,scope);shortcuts[shortcut.id]=shortcut});return true};self.remove=function(pattern){var shortcut=createShortcut(pattern);if(shortcuts[shortcut.id]){delete shortcuts[shortcut.id];return true}return false}}});define("tinymce/file/Uploader",["tinymce/util/Promise","tinymce/util/Tools","tinymce/util/Fun"],function(Promise,Tools,Fun){return function(settings){var cachedPromises={};function fileName(blobInfo){var ext,extensions;extensions={"image/jpeg":"jpg","image/jpg":"jpg","image/gif":"gif","image/png":"png"};ext=extensions[blobInfo.blob().type.toLowerCase()]||"dat";return blobInfo.id()+"."+ext}function pathJoin(path1,path2){if(path1){return path1.replace(/\/$/,"")+"/"+path2.replace(/^\//,"")}return path2}function blobInfoToData(blobInfo){return{id:blobInfo.id,blob:blobInfo.blob,base64:blobInfo.base64,filename:Fun.constant(fileName(blobInfo))}}function defaultHandler(blobInfo,success,failure,openNotification){var xhr,formData,notification;xhr=new XMLHttpRequest;xhr.open("POST",settings.url);xhr.withCredentials=settings.credentials;notification=openNotification();xhr.upload.onprogress=function(e){var percentLoaded=Math.round(e.loaded/e.total*100);notification.progressBar.value(percentLoaded)};xhr.onerror=function(){notification.close();failure("Image upload failed due to a XHR Transport error. Code: "+xhr.status)};xhr.onload=function(){var json;notification.close();if(xhr.status!=200){failure("HTTP Error: "+xhr.status);return}json=JSON.parse(xhr.responseText);if(!json||typeof json.location!="string"){failure("Invalid JSON: "+xhr.responseText);return}success(pathJoin(settings.basePath,json.location))};formData=new FormData;formData.append("file",blobInfo.blob(),fileName(blobInfo));xhr.send(formData)}function noUpload(){return new Promise(function(resolve){resolve([])})}function interpretResult(promise){return promise.then(function(result){return result})["catch"](function(error){return error})}function registerPromise(handler,id,blobInfo){var response=handler(blobInfo);var promise=interpretResult(response);delete cachedPromises[id];cachedPromises[id]=promise;return promise}function collectUploads(blobInfos,uploadBlobInfo){return Tools.map(blobInfos,function(blobInfo){var id=blobInfo.id();return cachedPromises[id]?cachedPromises[id]:registerPromise(uploadBlobInfo,id,blobInfo)})}function uploadBlobs(blobInfos,openNotification){function uploadBlobInfo(blobInfo){return new Promise(function(resolve){var handler=settings.handler;try{handler(blobInfoToData(blobInfo),function(url){resolve({url:url,blobInfo:blobInfo,status:true})},function(failure){resolve({url:"",blobInfo:blobInfo,status:false,error:failure})},openNotification)}catch(ex){resolve({url:"",blobInfo:blobInfo,status:false,error:ex.message})}})}var promises=collectUploads(blobInfos,uploadBlobInfo);return Promise.all(promises)}function upload(blobInfos,openNotification){return!settings.url&&settings.handler===defaultHandler?noUpload():uploadBlobs(blobInfos,openNotification)}settings=Tools.extend({credentials:false,handler:defaultHandler},settings);return{upload:upload}}});define("tinymce/file/Conversions",["tinymce/util/Promise"],function(Promise){function blobUriToBlob(url){return new Promise(function(resolve){var xhr=new XMLHttpRequest;xhr.open("GET",url,true);xhr.responseType="blob";xhr.onload=function(){if(this.status==200){resolve(this.response)}};xhr.send()})}function parseDataUri(uri){var type,matches;uri=decodeURIComponent(uri).split(",");matches=/data:([^;]+)/.exec(uri[0]);if(matches){type=matches[1]}return{type:type,data:uri[1]}}function dataUriToBlob(uri){return new Promise(function(resolve){var str,arr,i;uri=parseDataUri(uri);try{str=atob(uri.data)}catch(e){resolve(new Blob([]));return}arr=new Uint8Array(str.length);for(i=0;i<arr.length;i++){arr[i]=str.charCodeAt(i)}resolve(new Blob([arr],{type:uri.type}))})}function uriToBlob(url){if(url.indexOf("blob:")===0){return blobUriToBlob(url)}if(url.indexOf("data:")===0){return dataUriToBlob(url)}return null}function blobToDataUri(blob){return new Promise(function(resolve){var reader=new FileReader;reader.onloadend=function(){resolve(reader.result)};reader.readAsDataURL(blob)})}return{uriToBlob:uriToBlob,blobToDataUri:blobToDataUri,
parseDataUri:parseDataUri}});define("tinymce/file/ImageScanner",["tinymce/util/Promise","tinymce/util/Arr","tinymce/util/Fun","tinymce/file/Conversions","tinymce/Env"],function(Promise,Arr,Fun,Conversions,Env){var count=0;return function(blobCache){var cachedPromises={};function findAll(elm,predicate){var images,promises;function imageToBlobInfo(img,resolve){var base64,blobInfo;if(img.src.indexOf("blob:")===0){blobInfo=blobCache.getByUri(img.src);if(blobInfo){resolve({image:img,blobInfo:blobInfo})}return}base64=Conversions.parseDataUri(img.src).data;blobInfo=blobCache.findFirst(function(cachedBlobInfo){return cachedBlobInfo.base64()===base64});if(blobInfo){resolve({image:img,blobInfo:blobInfo})}else{Conversions.uriToBlob(img.src).then(function(blob){var blobInfoId="blobid"+count++,blobInfo=blobCache.create(blobInfoId,blob,base64);blobCache.add(blobInfo);resolve({image:img,blobInfo:blobInfo})})}}if(!predicate){predicate=Fun.constant(true)}images=Arr.filter(elm.getElementsByTagName("img"),function(img){var src=img.src;if(!Env.fileApi){return false}if(img.hasAttribute("data-mce-bogus")){return false}if(img.hasAttribute("data-mce-placeholder")){return false}if(!src||src==Env.transparentSrc){return false}if(src.indexOf("blob:")===0){return true}if(src.indexOf("data:")===0){return predicate(img)}return false});promises=Arr.map(images,function(img){var newPromise;if(cachedPromises[img.src]){return new Promise(function(resolve){cachedPromises[img.src].then(function(imageInfo){resolve({image:img,blobInfo:imageInfo.blobInfo})})})}newPromise=new Promise(function(resolve){imageToBlobInfo(img,resolve)}).then(function(result){delete cachedPromises[result.image.src];return result})["catch"](function(error){delete cachedPromises[img.src];return error});cachedPromises[img.src]=newPromise;return newPromise});return Promise.all(promises)}return{findAll:findAll}}});define("tinymce/file/BlobCache",["tinymce/util/Arr","tinymce/util/Fun"],function(Arr,Fun){return function(){var cache=[],constant=Fun.constant;function create(id,blob,base64){return{id:constant(id),blob:constant(blob),base64:constant(base64),blobUri:constant(URL.createObjectURL(blob))}}function add(blobInfo){if(!get(blobInfo.id())){cache.push(blobInfo)}}function get(id){return findFirst(function(cachedBlobInfo){return cachedBlobInfo.id()===id})}function findFirst(predicate){return Arr.filter(cache,predicate)[0]}function getByUri(blobUri){return findFirst(function(blobInfo){return blobInfo.blobUri()==blobUri})}function destroy(){Arr.each(cache,function(cachedBlobInfo){URL.revokeObjectURL(cachedBlobInfo.blobUri())});cache=[]}return{create:create,add:add,get:get,getByUri:getByUri,findFirst:findFirst,destroy:destroy}}});define("tinymce/EditorUpload",["tinymce/util/Arr","tinymce/file/Uploader","tinymce/file/ImageScanner","tinymce/file/BlobCache"],function(Arr,Uploader,ImageScanner,BlobCache){return function(editor){var blobCache=new BlobCache,uploader,imageScanner,settings=editor.settings;function aliveGuard(callback){return function(result){if(editor.selection){return callback(result)}return[]}}function replaceString(content,search,replace){var index=0;do{index=content.indexOf(search,index);if(index!==-1){content=content.substring(0,index)+replace+content.substr(index+search.length);index+=replace.length-search.length+1}}while(index!==-1);return content}function replaceImageUrl(content,targetUrl,replacementUrl){content=replaceString(content,'src="'+targetUrl+'"','src="'+replacementUrl+'"');content=replaceString(content,'data-mce-src="'+targetUrl+'"','data-mce-src="'+replacementUrl+'"');return content}function replaceUrlInUndoStack(targetUrl,replacementUrl){Arr.each(editor.undoManager.data,function(level){level.content=replaceImageUrl(level.content,targetUrl,replacementUrl)})}function openNotification(){return editor.notificationManager.open({text:editor.translate("Image uploading..."),type:"info",timeout:-1,progressBar:true})}function uploadImages(callback){if(!uploader){uploader=new Uploader({url:settings.images_upload_url,basePath:settings.images_upload_base_path,credentials:settings.images_upload_credentials,handler:settings.images_upload_handler})}return scanForImages().then(aliveGuard(function(imageInfos){var blobInfos;blobInfos=Arr.map(imageInfos,function(imageInfo){return imageInfo.blobInfo});return uploader.upload(blobInfos,openNotification).then(aliveGuard(function(result){result=Arr.map(result,function(uploadInfo,index){var image=imageInfos[index].image;if(uploadInfo.status){replaceUrlInUndoStack(image.src,uploadInfo.url);editor.$(image).attr({src:uploadInfo.url,"data-mce-src":editor.convertURL(uploadInfo.url,"src")})}return{element:image,status:uploadInfo.status}});if(callback){callback(result)}return result}))}))}function uploadImagesAuto(callback){if(settings.automatic_uploads!==false){return uploadImages(callback)}}function scanForImages(){if(!imageScanner){imageScanner=new ImageScanner(blobCache)}return imageScanner.findAll(editor.getBody(),settings.images_dataimg_filter).then(aliveGuard(function(result){Arr.each(result,function(resultItem){replaceUrlInUndoStack(resultItem.image.src,resultItem.blobInfo.blobUri());resultItem.image.src=resultItem.blobInfo.blobUri()});return result}))}function destroy(){blobCache.destroy();imageScanner=uploader=null}function replaceBlobWithBase64(content){return content.replace(/src="(blob:[^"]+)"/g,function(match,blobUri){var blobInfo=blobCache.getByUri(blobUri);if(!blobInfo){blobInfo=Arr.reduce(editor.editorManager.editors,function(result,editor){return result||editor.editorUpload.blobCache.getByUri(blobUri)},null)}if(blobInfo){return'src="data:'+blobInfo.blob().type+";base64,"+blobInfo.base64()+'"'}return match})}editor.on("setContent",function(){if(editor.settings.automatic_uploads!==false){uploadImagesAuto()}else{scanForImages()}});editor.on("RawSaveContent",function(e){e.content=replaceBlobWithBase64(e.content)});editor.on("getContent",function(e){if(e.source_view||e.format=="raw"){return}e.content=replaceBlobWithBase64(e.content)});return{blobCache:blobCache,uploadImages:uploadImages,uploadImagesAuto:uploadImagesAuto,scanForImages:scanForImages,destroy:destroy}}});define("tinymce/caret/FakeCaret",["tinymce/caret/CaretContainer","tinymce/caret/CaretPosition","tinymce/dom/NodeType","tinymce/dom/RangeUtils","tinymce/dom/DomQuery","tinymce/geom/ClientRect","tinymce/util/Delay"],function(CaretContainer,CaretPosition,NodeType,RangeUtils,$,ClientRect,Delay){var isContentEditableFalse=NodeType.isContentEditableFalse;return function(rootNode,isBlock){var cursorInterval,$lastVisualCaret,caretContainerNode;function getAbsoluteClientRect(node,before){var clientRect=ClientRect.collapse(node.getBoundingClientRect(),before),docElm,scrollX,scrollY,margin,rootRect;if(rootNode.tagName=="BODY"){docElm=rootNode.ownerDocument.documentElement;scrollX=rootNode.scrollLeft||docElm.scrollLeft;scrollY=rootNode.scrollTop||docElm.scrollTop}else{rootRect=rootNode.getBoundingClientRect();scrollX=rootNode.scrollLeft-rootRect.left;scrollY=rootNode.scrollTop-rootRect.top}clientRect.left+=scrollX;clientRect.right+=scrollX;clientRect.top+=scrollY;clientRect.bottom+=scrollY;clientRect.width=1;margin=node.offsetWidth-node.clientWidth;if(margin>0){if(before){margin*=-1}clientRect.left+=margin;clientRect.right+=margin}return clientRect}function trimInlineCaretContainers(){var contentEditableFalseNodes,node,sibling,i,data;contentEditableFalseNodes=$("*[contentEditable=false]",rootNode);for(i=0;i<contentEditableFalseNodes.length;i++){node=contentEditableFalseNodes[i];sibling=node.previousSibling;if(CaretContainer.endsWithCaretContainer(sibling)){data=sibling.data;if(data.length==1){sibling.parentNode.removeChild(sibling)}else{sibling.deleteData(data.length-1,1)}}sibling=node.nextSibling;if(CaretContainer.startsWithCaretContainer(sibling)){data=sibling.data;if(data.length==1){sibling.parentNode.removeChild(sibling)}else{sibling.deleteData(0,1)}}}return null}function show(before,node){var clientRect,rng,container;hide();if(isBlock(node)){caretContainerNode=CaretContainer.insertBlock("p",node,before);clientRect=getAbsoluteClientRect(node,before);$(caretContainerNode).css("top",clientRect.top);$lastVisualCaret=$('<div class="mce-visual-caret" data-mce-bogus="all"></div>').css(clientRect).appendTo(rootNode);if(before){$lastVisualCaret.addClass("mce-visual-caret-before")}startBlink();rng=node.ownerDocument.createRange();container=caretContainerNode.firstChild;rng.setStart(container,0);rng.setEnd(container,1)}else{caretContainerNode=CaretContainer.insertInline(node,before);rng=node.ownerDocument.createRange();if(isContentEditableFalse(caretContainerNode.nextSibling)){rng.setStart(caretContainerNode,0);rng.setEnd(caretContainerNode,0)}else{rng.setStart(caretContainerNode,1);rng.setEnd(caretContainerNode,1)}return rng}return rng}function hide(){trimInlineCaretContainers();if(caretContainerNode){CaretContainer.remove(caretContainerNode);caretContainerNode=null}if($lastVisualCaret){$lastVisualCaret.remove();$lastVisualCaret=null}clearInterval(cursorInterval)}function startBlink(){cursorInterval=Delay.setInterval(function(){$("div.mce-visual-caret",rootNode).toggleClass("mce-visual-caret-hidden")},500)}function destroy(){Delay.clearInterval(cursorInterval)}function getCss(){return".mce-visual-caret {"+"position: absolute;"+"background-color: black;"+"background-color: currentcolor;"+"}"+".mce-visual-caret-hidden {"+"display: none;"+"}"+"*[data-mce-caret] {"+"position: absolute;"+"left: -1000px;"+"right: auto;"+"top: 0;"+"margin: 0;"+"padding: 0;"+"}"}return{show:show,hide:hide,getCss:getCss,destroy:destroy}}});define("tinymce/dom/Dimensions",["tinymce/util/Arr","tinymce/dom/NodeType","tinymce/geom/ClientRect"],function(Arr,NodeType,ClientRect){function getClientRects(node){function toArrayWithNode(clientRects){return Arr.map(clientRects,function(clientRect){clientRect=ClientRect.clone(clientRect);clientRect.node=node;return clientRect})}if(Arr.isArray(node)){return Arr.reduce(node,function(result,node){return result.concat(getClientRects(node))},[])}if(NodeType.isElement(node)){return toArrayWithNode(node.getClientRects())}if(NodeType.isText(node)){var rng=node.ownerDocument.createRange();rng.setStart(node,0);rng.setEnd(node,node.data.length);return toArrayWithNode(rng.getClientRects())}}return{getClientRects:getClientRects}});define("tinymce/caret/LineWalker",["tinymce/util/Fun","tinymce/util/Arr","tinymce/dom/Dimensions","tinymce/caret/CaretCandidate","tinymce/caret/CaretUtils","tinymce/caret/CaretWalker","tinymce/caret/CaretPosition","tinymce/geom/ClientRect"],function(Fun,Arr,Dimensions,CaretCandidate,CaretUtils,CaretWalker,CaretPosition,ClientRect){var curry=Fun.curry;function findUntil(direction,rootNode,predicateFn,node){while(node=CaretUtils.findNode(node,direction,CaretCandidate.isEditableCaretCandidate,rootNode)){if(predicateFn(node)){return}}}function walkUntil(direction,isAboveFn,isBeflowFn,rootNode,predicateFn,caretPosition){var line=0,node,result=[],targetClientRect;function add(node){var i,clientRect,clientRects;clientRects=Dimensions.getClientRects(node);if(direction==-1){clientRects=clientRects.reverse()}for(i=0;i<clientRects.length;i++){clientRect=clientRects[i];if(isBeflowFn(clientRect,targetClientRect)){continue}if(result.length>0&&isAboveFn(clientRect,Arr.last(result))){line++}clientRect.line=line;if(predicateFn(clientRect)){return true}result.push(clientRect)}}targetClientRect=Arr.last(caretPosition.getClientRects());if(!targetClientRect){return result}node=caretPosition.getNode();add(node);findUntil(direction,rootNode,add,node);return result}function aboveLineNumber(lineNumber,clientRect){return clientRect.line>lineNumber}function isLine(lineNumber,clientRect){return clientRect.line===lineNumber}var upUntil=curry(walkUntil,-1,ClientRect.isAbove,ClientRect.isBelow);var downUntil=curry(walkUntil,1,ClientRect.isBelow,ClientRect.isAbove);function positionsUntil(direction,rootNode,predicateFn,node){var caretWalker=new CaretWalker(rootNode),walkFn,isBelowFn,isAboveFn,caretPosition,result=[],line=0,clientRect,targetClientRect;function getClientRect(caretPosition){if(direction==1){return Arr.last(caretPosition.getClientRects())}return Arr.last(caretPosition.getClientRects())}if(direction==1){walkFn=caretWalker.next;isBelowFn=ClientRect.isBelow;isAboveFn=ClientRect.isAbove;caretPosition=CaretPosition.after(node)}else{walkFn=caretWalker.prev;isBelowFn=ClientRect.isAbove;isAboveFn=ClientRect.isBelow;caretPosition=CaretPosition.before(node)}targetClientRect=getClientRect(caretPosition);do{if(!caretPosition.isVisible()){continue}clientRect=getClientRect(caretPosition);if(isAboveFn(clientRect,targetClientRect)){continue}if(result.length>0&&isBelowFn(clientRect,Arr.last(result))){line++}clientRect=ClientRect.clone(clientRect);clientRect.position=caretPosition;clientRect.line=line;if(predicateFn(clientRect)){return result}result.push(clientRect)}while(caretPosition=walkFn(caretPosition));return result}return{upUntil:upUntil,downUntil:downUntil,positionsUntil:positionsUntil,isAboveLine:curry(aboveLineNumber),isLine:curry(isLine)}});define("tinymce/caret/LineUtils",["tinymce/util/Fun","tinymce/util/Arr","tinymce/dom/NodeType","tinymce/dom/Dimensions","tinymce/geom/ClientRect","tinymce/caret/CaretUtils","tinymce/caret/CaretCandidate"],function(Fun,Arr,NodeType,Dimensions,ClientRect,CaretUtils,CaretCandidate){var isContentEditableFalse=NodeType.isContentEditableFalse,findNode=CaretUtils.findNode,curry=Fun.curry;function distanceToRectLeft(clientRect,clientX){return Math.abs(clientRect.left-clientX)}function distanceToRectRight(clientRect,clientX){return Math.abs(clientRect.right-clientX)}function findClosestClientRect(clientRects,clientX){function isInside(clientX,clientRect){return clientX>=clientRect.left&&clientX<=clientRect.right}return Arr.reduce(clientRects,function(oldClientRect,clientRect){var oldDistance,newDistance;oldDistance=Math.min(distanceToRectLeft(oldClientRect,clientX),distanceToRectRight(oldClientRect,clientX));newDistance=Math.min(distanceToRectLeft(clientRect,clientX),distanceToRectRight(clientRect,clientX));if(isInside(clientX,clientRect)){return clientRect}if(isInside(clientX,oldClientRect)){return oldClientRect}if(newDistance==oldDistance&&isContentEditableFalse(clientRect.node)){return clientRect}if(newDistance<oldDistance){return clientRect}return oldClientRect})}function walkUntil(direction,rootNode,predicateFn,node){while(node=findNode(node,direction,CaretCandidate.isEditableCaretCandidate,rootNode)){if(predicateFn(node)){return}}}function findLineNodeRects(rootNode,targetNodeRect){var clientRects=[];function collect(checkPosFn,node){var lineRects;lineRects=Arr.filter(Dimensions.getClientRects(node),function(clientRect){return!checkPosFn(clientRect,targetNodeRect)});clientRects=clientRects.concat(lineRects);return lineRects.length===0}clientRects.push(targetNodeRect);walkUntil(-1,rootNode,curry(collect,ClientRect.isAbove),targetNodeRect.node);walkUntil(1,rootNode,curry(collect,ClientRect.isBelow),targetNodeRect.node);return clientRects}function getContentEditableFalseChildren(rootNode){return Arr.filter(Arr.toArray(rootNode.getElementsByTagName("*")),isContentEditableFalse)}function caretInfo(clientRect,clientX){return{node:clientRect.node,before:distanceToRectLeft(clientRect,clientX)<distanceToRectRight(clientRect,clientX)}}function closestCaret(rootNode,clientX,clientY){var contentEditableFalseNodeRects,closestNodeRect;contentEditableFalseNodeRects=Dimensions.getClientRects(getContentEditableFalseChildren(rootNode));contentEditableFalseNodeRects=Arr.filter(contentEditableFalseNodeRects,function(clientRect){return clientY>=clientRect.top&&clientY<=clientRect.bottom});closestNodeRect=findClosestClientRect(contentEditableFalseNodeRects,clientX);if(closestNodeRect){closestNodeRect=findClosestClientRect(findLineNodeRects(rootNode,closestNodeRect),clientX);if(closestNodeRect&&isContentEditableFalse(closestNodeRect.node)){return caretInfo(closestNodeRect,clientX)}}return null}return{findClosestClientRect:findClosestClientRect,findLineNodeRects:findLineNodeRects,closestCaret:closestCaret}});define("tinymce/DragDropOverrides",["tinymce/dom/NodeType","tinymce/util/Arr","tinymce/util/Fun"],function(NodeType,Arr,Fun){var isContentEditableFalse=NodeType.isContentEditableFalse,isContentEditableTrue=NodeType.isContentEditableTrue;function init(editor){var $=editor.$,rootDocument=document,editableDoc=editor.getDoc(),dom=editor.dom,state={};function isDraggable(elm){return isContentEditableFalse(elm)}function setBodyCursor(cursor){$(editor.getBody()).css("cursor",cursor)}function isValidDropTarget(elm){if(elm==state.element||editor.dom.isChildOf(elm,state.element)){return false}if(isContentEditableFalse(elm)){return false}return true}function move(e){var deltaX,deltaY,pos,viewPort,overflowX=0,overflowY=0,movement,clientX,clientY,rootClientRect;if(e.button!==0){return}deltaX=e.screenX-state.screenX;deltaY=e.screenY-state.screenY;movement=Math.max(Math.abs(deltaX),Math.abs(deltaY));if(!state.dragging&&movement>10){state.dragging=true;setBodyCursor("default");state.clone=state.element.cloneNode(true);pos=dom.getPos(state.element);state.relX=state.clientX-pos.x;state.relY=state.clientY-pos.y;state.width=state.element.offsetWidth;state.height=state.element.offsetHeight;$(state.clone).css({width:state.width,height:state.height}).removeAttr("data-mce-selected");state.ghost=$("<div>").css({position:"absolute",opacity:.5,overflow:"hidden",width:state.width,height:state.height}).attr({"data-mce-bogus":"all",unselectable:"on",contenteditable:"false"}).addClass("mce-drag-container mce-reset").append(state.clone).appendTo(editor.getBody())[0];viewPort=editor.dom.getViewPort(editor.getWin());state.maxX=viewPort.w;state.maxY=viewPort.h}if(state.dragging){editor.selection.placeCaretAt(e.clientX,e.clientY);clientX=state.clientX+deltaX-state.relX;clientY=state.clientY+deltaY+5;if(clientX+state.width>state.maxX){overflowX=clientX+state.width-state.maxX}if(clientY+state.height>state.maxY){overflowY=clientY+state.height-state.maxY}if(editor.getBody().nodeName!="BODY"){rootClientRect=editor.getBody().getBoundingClientRect()}else{rootClientRect={left:0,top:0}}$(state.ghost).css({left:clientX-rootClientRect.left,top:clientY-rootClientRect.top,width:state.width-overflowX,height:state.height-overflowY})}}function drop(){var evt;if(state.dragging){editor.selection.setRng(editor.selection.getSel().getRangeAt(0));if(isValidDropTarget(editor.selection.getNode())){var targetClone=state.element;evt=editor.fire("drop",{targetClone:targetClone});if(evt.isDefaultPrevented()){return}targetClone=evt.targetClone;editor.undoManager.transact(function(){editor.insertContent(dom.getOuterHTML(targetClone));$(state.element).remove()})}}stop()}function start(e){var ceElm,evt;stop();if(e.button!==0){return}ceElm=Arr.find(editor.dom.getParents(e.target),Fun.or(isContentEditableFalse,isContentEditableTrue));if(isDraggable(ceElm)){evt=editor.fire("dragstart",{target:ceElm});if(evt.isDefaultPrevented()){return}editor.on("mousemove",move);editor.on("mouseup",drop);if(rootDocument!=editableDoc){dom.bind(rootDocument,"mousemove",move);dom.bind(rootDocument,"mouseup",drop)}state={screenX:e.screenX,screenY:e.screenY,clientX:e.clientX,clientY:e.clientY,element:ceElm}}}function stop(){$(state.ghost).remove();setBodyCursor(null);editor.off("mousemove",move);editor.off("mouseup",stop);if(rootDocument!=editableDoc){dom.unbind(rootDocument,"mousemove",move);dom.unbind(rootDocument,"mouseup",stop)}state={}}editor.on("mousedown",start);editor.on("drop",function(e){var realTarget=editor.getDoc().elementFromPoint(e.clientX,e.clientY);if(isContentEditableFalse(realTarget)||isContentEditableFalse(editor.dom.getContentEditableParent(realTarget))){e.preventDefault()}})}return{init:init}});define("tinymce/SelectionOverrides",["tinymce/Env","tinymce/caret/CaretWalker","tinymce/caret/CaretPosition","tinymce/caret/CaretContainer","tinymce/caret/CaretUtils","tinymce/caret/FakeCaret","tinymce/caret/LineWalker","tinymce/caret/LineUtils","tinymce/dom/NodeType","tinymce/dom/RangeUtils","tinymce/geom/ClientRect","tinymce/util/VK","tinymce/util/Fun","tinymce/util/Arr","tinymce/util/Delay","tinymce/DragDropOverrides","tinymce/text/Zwsp"],function(Env,CaretWalker,CaretPosition,CaretContainer,CaretUtils,FakeCaret,LineWalker,LineUtils,NodeType,RangeUtils,ClientRect,VK,Fun,Arr,Delay,DragDropOverrides,Zwsp){var curry=Fun.curry,isContentEditableTrue=NodeType.isContentEditableTrue,isContentEditableFalse=NodeType.isContentEditableFalse,isElement=NodeType.isElement,isAfterContentEditableFalse=CaretUtils.isAfterContentEditableFalse,isBeforeContentEditableFalse=CaretUtils.isBeforeContentEditableFalse,getSelectedNode=RangeUtils.getSelectedNode;function getVisualCaretPosition(walkFn,caretPosition){while(caretPosition=walkFn(caretPosition)){if(caretPosition.isVisible()){return caretPosition}}return caretPosition}function SelectionOverrides(editor){var rootNode=editor.getBody(),caretWalker=new CaretWalker(rootNode);var getNextVisualCaretPosition=curry(getVisualCaretPosition,caretWalker.next);var getPrevVisualCaretPosition=curry(getVisualCaretPosition,caretWalker.prev),fakeCaret=new FakeCaret(editor.getBody(),isBlock),realSelectionId="sel-"+editor.dom.uniqueId(),selectedContentEditableNode,$=editor.$;function isBlock(node){return editor.dom.isBlock(node)}function setRange(range){if(range){editor.selection.setRng(range)}}function getRange(){return editor.selection.getRng()}function scrollIntoView(node,alignToTop){editor.selection.scrollIntoView(node,alignToTop)}function showCaret(direction,node,before){var e;e=editor.fire("ShowCaret",{target:node,direction:direction,before:before});if(e.isDefaultPrevented()){return null}scrollIntoView(node,direction===-1);return fakeCaret.show(before,node)}function selectNode(node){var e;fakeCaret.hide();e=editor.fire("BeforeObjectSelected",{target:node});if(e.isDefaultPrevented()){return null}return getNodeRange(node)}function getNodeRange(node){var rng=node.ownerDocument.createRange();rng.selectNode(node);return rng}function isMoveInsideSameBlock(fromCaretPosition,toCaretPosition){var inSameBlock=CaretUtils.isInSameBlock(fromCaretPosition,toCaretPosition);if(!inSameBlock&&NodeType.isBr(fromCaretPosition.getNode())){return true}return inSameBlock}function getNormalizedRangeEndPoint(direction,range){range=CaretUtils.normalizeRange(direction,rootNode,range);if(direction==-1){return CaretPosition.fromRangeStart(range)}return CaretPosition.fromRangeEnd(range)}function isRangeInCaretContainerBlock(range){return CaretContainer.isCaretContainerBlock(range.startContainer)}function moveToCeFalseHorizontally(direction,getNextPosFn,isBeforeContentEditableFalseFn,range){var node,caretPosition,peekCaretPosition,rangeIsInContainerBlock;if(!range.collapsed){node=getSelectedNode(range);if(isContentEditableFalse(node)){return showCaret(direction,node,direction==-1)}}rangeIsInContainerBlock=isRangeInCaretContainerBlock(range);caretPosition=getNormalizedRangeEndPoint(direction,range);if(isBeforeContentEditableFalseFn(caretPosition)){return selectNode(caretPosition.getNode(direction==-1))}caretPosition=getNextPosFn(caretPosition);if(!caretPosition){if(rangeIsInContainerBlock){return range}return null}if(isBeforeContentEditableFalseFn(caretPosition)){return showCaret(direction,caretPosition.getNode(direction==-1),direction==1)}peekCaretPosition=getNextPosFn(caretPosition);if(isBeforeContentEditableFalseFn(peekCaretPosition)){if(isMoveInsideSameBlock(caretPosition,peekCaretPosition)){return showCaret(direction,peekCaretPosition.getNode(direction==-1),direction==1)}}if(rangeIsInContainerBlock){return renderRangeCaret(caretPosition.toRange())}return null}function moveToCeFalseVertically(direction,walkerFn,range){var caretPosition,linePositions,nextLinePositions,closestNextLineRect,caretClientRect,clientX,dist1,dist2,contentEditableFalseNode;contentEditableFalseNode=getSelectedNode(range);caretPosition=getNormalizedRangeEndPoint(direction,range);linePositions=walkerFn(rootNode,LineWalker.isAboveLine(1),caretPosition);nextLinePositions=Arr.filter(linePositions,LineWalker.isLine(1));caretClientRect=Arr.last(caretPosition.getClientRects());if(isBeforeContentEditableFalse(caretPosition)){contentEditableFalseNode=caretPosition.getNode()}if(isAfterContentEditableFalse(caretPosition)){contentEditableFalseNode=caretPosition.getNode(true)}if(!caretClientRect){return null}clientX=caretClientRect.left;closestNextLineRect=LineUtils.findClosestClientRect(nextLinePositions,clientX);if(closestNextLineRect){if(isContentEditableFalse(closestNextLineRect.node)){dist1=Math.abs(clientX-closestNextLineRect.left);dist2=Math.abs(clientX-closestNextLineRect.right);return showCaret(direction,closestNextLineRect.node,dist1<dist2)}}if(contentEditableFalseNode){var caretPositions=LineWalker.positionsUntil(direction,rootNode,LineWalker.isAboveLine(1),contentEditableFalseNode);closestNextLineRect=LineUtils.findClosestClientRect(Arr.filter(caretPositions,LineWalker.isLine(1)),clientX);if(closestNextLineRect){return renderRangeCaret(closestNextLineRect.position.toRange())}closestNextLineRect=Arr.last(Arr.filter(caretPositions,LineWalker.isLine(0)));if(closestNextLineRect){return renderRangeCaret(closestNextLineRect.position.toRange())}}}function exitPreBlock(direction,range){var pre,caretPos,newBlock;function createTextBlock(){var textBlock=editor.dom.create(editor.settings.forced_root_block);if(!Env.ie||Env.ie>=11){textBlock.innerHTML='<br data-mce-bogus="1">'}return textBlock}if(range.collapsed&&editor.settings.forced_root_block){pre=editor.dom.getParent(range.startContainer,"PRE");if(!pre){return}if(direction==1){caretPos=getNextVisualCaretPosition(CaretPosition.fromRangeStart(range))}else{caretPos=getPrevVisualCaretPosition(CaretPosition.fromRangeStart(range))}if(!caretPos){newBlock=createTextBlock();if(direction==1){editor.$(pre).after(newBlock)}else{editor.$(pre).before(newBlock)}editor.selection.select(newBlock,true);editor.selection.collapse()}}}function moveH(direction,getNextPosFn,isBeforeContentEditableFalseFn,range){var newRange;newRange=moveToCeFalseHorizontally(direction,getNextPosFn,isBeforeContentEditableFalseFn,range);if(newRange){return newRange}newRange=exitPreBlock(direction,range);if(newRange){return newRange}return null}function moveV(direction,walkerFn,range){var newRange;newRange=moveToCeFalseVertically(direction,walkerFn,range);if(newRange){return newRange}newRange=exitPreBlock(direction,range);if(newRange){return newRange}return null}function getBlockCaretContainer(){return $("*[data-mce-caret]")[0]}function showBlockCaretContainer(blockCaretContainer){blockCaretContainer=$(blockCaretContainer);if(blockCaretContainer.attr("data-mce-caret")){fakeCaret.hide();blockCaretContainer.removeAttr("data-mce-caret");blockCaretContainer.removeAttr("data-mce-bogus");blockCaretContainer.removeAttr("style");setRange(getRange());scrollIntoView(blockCaretContainer[0])}}function renderCaretAtRange(range){var caretPosition,ceRoot;range=CaretUtils.normalizeRange(1,rootNode,range);caretPosition=CaretPosition.fromRangeStart(range);if(isContentEditableFalse(caretPosition.getNode())){return showCaret(1,caretPosition.getNode(),!caretPosition.isAtEnd())}if(isContentEditableFalse(caretPosition.getNode(true))){return showCaret(1,caretPosition.getNode(true),false)}ceRoot=editor.dom.getParent(caretPosition.getNode(),Fun.or(isContentEditableFalse,isContentEditableTrue));if(isContentEditableFalse(ceRoot)){return showCaret(1,ceRoot,false)}fakeCaret.hide();return null}function renderRangeCaret(range){var caretRange;if(!range||!range.collapsed){return range}caretRange=renderCaretAtRange(range);if(caretRange){return caretRange}return range}function deleteContentEditableNode(node){var nextCaretPosition,prevCaretPosition,prevCeFalseElm,nextElement;if(!isContentEditableFalse(node)){return null}if(isContentEditableFalse(node.previousSibling)){prevCeFalseElm=node.previousSibling}prevCaretPosition=getPrevVisualCaretPosition(CaretPosition.before(node));if(!prevCaretPosition){nextCaretPosition=getNextVisualCaretPosition(CaretPosition.after(node))}if(nextCaretPosition&&isElement(nextCaretPosition.getNode())){nextElement=nextCaretPosition.getNode()}CaretContainer.remove(node.previousSibling);CaretContainer.remove(node.nextSibling);editor.dom.remove(node);clearContentEditableSelection();if(editor.dom.isEmpty(editor.getBody())){editor.setContent("");editor.focus();return}if(prevCeFalseElm){return CaretPosition.after(prevCeFalseElm).toRange()}if(nextElement){return CaretPosition.before(nextElement).toRange()}if(prevCaretPosition){return prevCaretPosition.toRange()}if(nextCaretPosition){return nextCaretPosition.toRange()}return null}function mergeTextBlocks(direction,fromCaretPosition,toCaretPosition){var dom=editor.dom,fromBlock,toBlock,node,textBlocks;if(direction===-1){if(isAfterContentEditableFalse(toCaretPosition)&&isBlock(toCaretPosition.getNode(true))){return deleteContentEditableNode(toCaretPosition.getNode(true))}}else{if(isBeforeContentEditableFalse(fromCaretPosition)&&isBlock(fromCaretPosition.getNode())){return deleteContentEditableNode(fromCaretPosition.getNode())}}textBlocks=editor.schema.getTextBlockElements();fromBlock=dom.getParent(fromCaretPosition.getNode(),dom.isBlock);toBlock=dom.getParent(toCaretPosition.getNode(),dom.isBlock);if(fromBlock===toBlock||!textBlocks[fromBlock.nodeName]||!textBlocks[toBlock.nodeName]){return null}while(node=fromBlock.firstChild){toBlock.appendChild(node)}editor.dom.remove(fromBlock);return toCaretPosition.toRange()}function backspaceDelete(direction,beforeFn,range){var node,caretPosition,peekCaretPosition;if(!range.collapsed){node=getSelectedNode(range);if(isContentEditableFalse(node)){return renderRangeCaret(deleteContentEditableNode(node))}}caretPosition=getNormalizedRangeEndPoint(direction,range);if(beforeFn(caretPosition)){return renderRangeCaret(deleteContentEditableNode(caretPosition.getNode(direction==-1)))}peekCaretPosition=direction==-1?caretWalker.prev(caretPosition):caretWalker.next(caretPosition);if(beforeFn(peekCaretPosition)){if(direction===-1){return mergeTextBlocks(direction,caretPosition,peekCaretPosition)}return mergeTextBlocks(direction,peekCaretPosition,caretPosition)}}function registerEvents(){var right=curry(moveH,1,getNextVisualCaretPosition,isBeforeContentEditableFalse);var left=curry(moveH,-1,getPrevVisualCaretPosition,isAfterContentEditableFalse);var deleteForward=curry(backspaceDelete,1,isBeforeContentEditableFalse);var backspace=curry(backspaceDelete,-1,isAfterContentEditableFalse);var up=curry(moveV,-1,LineWalker.upUntil);var down=curry(moveV,1,LineWalker.downUntil);function override(evt,moveFn){var range=moveFn(getRange());if(range&&!evt.isDefaultPrevented()){evt.preventDefault();setRange(range)}}function getContentEditableRoot(node){var root=editor.getBody();while(node&&node!=root){if(isContentEditableTrue(node)||isContentEditableFalse(node)){return node}node=node.parentNode}return null}function isXYWithinRange(clientX,clientY,range){if(range.collapsed){return false}return Arr.reduce(range.getClientRects(),function(state,rect){return state||ClientRect.containsXY(rect,clientX,clientY)},false)}editor.on("mouseup",function(){var range=getRange();if(range.collapsed){setRange(renderCaretAtRange(range))}});editor.on("click",function(e){var contentEditableRoot;contentEditableRoot=getContentEditableRoot(e.target);if(contentEditableRoot){if(isContentEditableFalse(contentEditableRoot)){e.preventDefault()}}});editor.on("mousedown",function(e){var contentEditableRoot;contentEditableRoot=getContentEditableRoot(e.target);if(contentEditableRoot){if(isContentEditableFalse(contentEditableRoot)){e.preventDefault();setContentEditableSelection(selectNode(contentEditableRoot))}else{clearContentEditableSelection();if(!isXYWithinRange(e.clientX,e.clientY,editor.selection.getRng())){editor.selection.placeCaretAt(e.clientX,e.clientY);
}}}else{clearContentEditableSelection();fakeCaret.hide();var caretInfo=LineUtils.closestCaret(rootNode,e.clientX,e.clientY);if(caretInfo){e.preventDefault();editor.getBody().focus();setRange(showCaret(1,caretInfo.node,caretInfo.before))}}});editor.on("keydown",function(e){if(VK.modifierPressed(e)){return}switch(e.keyCode){case VK.RIGHT:override(e,right);break;case VK.DOWN:override(e,down);break;case VK.LEFT:override(e,left);break;case VK.UP:override(e,up);break;case VK.DELETE:override(e,deleteForward);break;case VK.BACKSPACE:override(e,backspace);break;default:if(isContentEditableFalse(editor.selection.getNode())){e.preventDefault()}break}});function paddEmptyContentEditableArea(){var br,ceRoot=getContentEditableRoot(editor.selection.getNode());if(isContentEditableTrue(ceRoot)&&isBlock(ceRoot)&&editor.dom.isEmpty(ceRoot)){br=editor.dom.create("br",{"data-mce-bogus":"1"});editor.$(ceRoot).empty().append(br);editor.selection.setRng(CaretPosition.before(br).toRange())}}function handleBlockContainer(e){var blockCaretContainer=getBlockCaretContainer();if(!blockCaretContainer){return}if(e.type=="compositionstart"){e.preventDefault();e.stopPropagation();showBlockCaretContainer(blockCaretContainer);return}if(blockCaretContainer.innerHTML!="&nbsp;"){showBlockCaretContainer(blockCaretContainer)}}function handleEmptyBackspaceDelete(e){var prevent;switch(e.keyCode){case VK.DELETE:prevent=paddEmptyContentEditableArea();break;case VK.BACKSPACE:prevent=paddEmptyContentEditableArea();break}if(prevent){e.preventDefault()}}editor.on("keyup compositionstart",function(e){handleBlockContainer(e);handleEmptyBackspaceDelete(e)},true);editor.on("cut",function(){var node=editor.selection.getNode();if(isContentEditableFalse(node)){Delay.setEditorTimeout(editor,function(){setRange(renderRangeCaret(deleteContentEditableNode(node)))})}});editor.on("getSelectionRange",function(e){var rng=e.range;if(selectedContentEditableNode){if(!selectedContentEditableNode.parentNode){selectedContentEditableNode=null;return}rng=rng.cloneRange();rng.selectNode(selectedContentEditableNode);e.range=rng}});editor.on("setSelectionRange",function(e){var rng;rng=setContentEditableSelection(e.range);if(rng){e.range=rng}});editor.on("focus",function(){Delay.setEditorTimeout(editor,function(){editor.selection.setRng(renderRangeCaret(editor.selection.getRng()))},0)});DragDropOverrides.init(editor)}function addCss(){var styles=editor.contentStyles,rootClass=".mce-content-body";styles.push(fakeCaret.getCss());styles.push(rootClass+" .mce-offscreen-selection {"+"position: absolute;"+"left: -9999999999px;"+"width: 100px;"+"height: 100px;"+"}"+rootClass+" *[contentEditable=false] {"+"cursor: default;"+"}"+rootClass+" *[contentEditable=true] {"+"cursor: text;"+"}")}function isRangeInCaretContainer(rng){return CaretContainer.isCaretContainer(rng.startContainer)||CaretContainer.isCaretContainer(rng.endContainer)}function setContentEditableSelection(range){var node,$=editor.$,dom=editor.dom,$realSelectionContainer,sel,startContainer,startOffset,endOffset,e,caretPosition,targetClone,origTargetClone;if(!range){clearContentEditableSelection();return null}if(range.collapsed){clearContentEditableSelection();if(!isRangeInCaretContainer(range)){caretPosition=getNormalizedRangeEndPoint(1,range);if(isContentEditableFalse(caretPosition.getNode())){return showCaret(1,caretPosition.getNode(),!caretPosition.isAtEnd())}if(isContentEditableFalse(caretPosition.getNode(true))){return showCaret(1,caretPosition.getNode(true),false)}}return null}startContainer=range.startContainer;startOffset=range.startOffset;endOffset=range.endOffset;if(startContainer.nodeType==3&&startOffset==0&&isContentEditableFalse(startContainer.parentNode)){startContainer=startContainer.parentNode;startOffset=dom.nodeIndex(startContainer);startContainer=startContainer.parentNode}if(startContainer.nodeType!=1){clearContentEditableSelection();return null}if(endOffset==startOffset+1){node=startContainer.childNodes[startOffset]}if(!isContentEditableFalse(node)){clearContentEditableSelection();return null}targetClone=origTargetClone=node.cloneNode(true);e=editor.fire("ObjectSelected",{target:node,targetClone:targetClone});if(e.isDefaultPrevented()){clearContentEditableSelection();return null}targetClone=e.targetClone;$realSelectionContainer=$("#"+realSelectionId);if($realSelectionContainer.length===0){$realSelectionContainer=$('<div data-mce-bogus="all" class="mce-offscreen-selection"></div>').attr("id",realSelectionId);$realSelectionContainer.appendTo(editor.getBody())}range=editor.dom.createRng();if(targetClone===origTargetClone&&Env.ie){$realSelectionContainer.empty().append(Zwsp.ZWSP).append(targetClone).append(Zwsp.ZWSP);range.setStart($realSelectionContainer[0].firstChild,0);range.setEnd($realSelectionContainer[0].lastChild,1)}else{$realSelectionContainer.empty().append("").append(targetClone).append("");range.setStart($realSelectionContainer[0].firstChild,1);range.setEnd($realSelectionContainer[0].lastChild,0)}$realSelectionContainer.css({top:dom.getPos(node,editor.getBody()).y});editor.getBody().focus();$realSelectionContainer[0].focus();sel=editor.selection.getSel();sel.removeAllRanges();sel.addRange(range);editor.$("*[data-mce-selected]").removeAttr("data-mce-selected");node.setAttribute("data-mce-selected",1);selectedContentEditableNode=node;return range}function clearContentEditableSelection(){if(selectedContentEditableNode){selectedContentEditableNode.removeAttribute("data-mce-selected");editor.$("#"+realSelectionId).remove();selectedContentEditableNode=null}}function destroy(){fakeCaret.destroy();selectedContentEditableNode=null}if(Env.ceFalse){registerEvents();addCss()}return{showBlockCaretContainer:showBlockCaretContainer,destroy:destroy}}return SelectionOverrides});define("tinymce/Editor",["tinymce/dom/DOMUtils","tinymce/dom/DomQuery","tinymce/AddOnManager","tinymce/NodeChange","tinymce/html/Node","tinymce/dom/Serializer","tinymce/html/Serializer","tinymce/dom/Selection","tinymce/Formatter","tinymce/UndoManager","tinymce/EnterKey","tinymce/ForceBlocks","tinymce/EditorCommands","tinymce/util/URI","tinymce/dom/ScriptLoader","tinymce/dom/EventUtils","tinymce/WindowManager","tinymce/NotificationManager","tinymce/html/Schema","tinymce/html/DomParser","tinymce/util/Quirks","tinymce/Env","tinymce/util/Tools","tinymce/util/Delay","tinymce/EditorObservable","tinymce/Mode","tinymce/Shortcuts","tinymce/EditorUpload","tinymce/SelectionOverrides"],function(DOMUtils,DomQuery,AddOnManager,NodeChange,Node,DomSerializer,Serializer,Selection,Formatter,UndoManager,EnterKey,ForceBlocks,EditorCommands,URI,ScriptLoader,EventUtils,WindowManager,NotificationManager,Schema,DomParser,Quirks,Env,Tools,Delay,EditorObservable,Mode,Shortcuts,EditorUpload,SelectionOverrides){var DOM=DOMUtils.DOM,ThemeManager=AddOnManager.ThemeManager,PluginManager=AddOnManager.PluginManager;var extend=Tools.extend,each=Tools.each,explode=Tools.explode;var inArray=Tools.inArray,trim=Tools.trim,resolve=Tools.resolve;var Event=EventUtils.Event;var isGecko=Env.gecko,ie=Env.ie;function Editor(id,settings,editorManager){var self=this,documentBaseUrl,baseUri,defaultSettings;documentBaseUrl=self.documentBaseUrl=editorManager.documentBaseURL;baseUri=editorManager.baseURI;defaultSettings=editorManager.defaultSettings;settings=extend({id:id,theme:"modern",delta_width:0,delta_height:0,popup_css:"",plugins:"",document_base_url:documentBaseUrl,add_form_submit_trigger:true,submit_patch:true,add_unload_trigger:true,convert_urls:true,relative_urls:true,remove_script_host:true,object_resizing:true,doctype:"<!DOCTYPE html>",visual:true,font_size_style_values:"xx-small,x-small,small,medium,large,x-large,xx-large",font_size_legacy_values:"xx-small,small,medium,large,x-large,xx-large,300%",forced_root_block:"p",hidden_input:true,padd_empty_editor:true,render_ui:true,indentation:"30px",inline_styles:true,convert_fonts_to_spans:true,indent:"simple",indent_before:"p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,"+"tfoot,tbody,tr,section,article,hgroup,aside,figure,figcaption,option,optgroup,datalist",indent_after:"p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,"+"tfoot,tbody,tr,section,article,hgroup,aside,figure,figcaption,option,optgroup,datalist",validate:true,entity_encoding:"named",url_converter:self.convertURL,url_converter_scope:self,ie7_compat:true},defaultSettings,settings);if(defaultSettings&&defaultSettings.external_plugins&&settings.external_plugins){settings.external_plugins=extend({},defaultSettings.external_plugins,settings.external_plugins)}self.settings=settings;AddOnManager.language=settings.language||"en";AddOnManager.languageLoad=settings.language_load;AddOnManager.baseURL=editorManager.baseURL;self.id=settings.id=id;self.setDirty(false);self.plugins={};self.documentBaseURI=new URI(settings.document_base_url||documentBaseUrl,{base_uri:baseUri});self.baseURI=baseUri;self.contentCSS=[];self.contentStyles=[];self.shortcuts=new Shortcuts(self);self.loadedCSS={};self.editorCommands=new EditorCommands(self);if(settings.target){self.targetElm=settings.target}self.suffix=editorManager.suffix;self.editorManager=editorManager;self.inline=settings.inline;if(settings.cache_suffix){Env.cacheSuffix=settings.cache_suffix.replace(/^[\?\&]+/,"")}if(settings.override_viewport===false){Env.overrideViewPort=false}editorManager.fire("SetupEditor",self);self.execCallback("setup",self);self.$=DomQuery.overrideDefaults(function(){return{context:self.inline?self.getBody():self.getDoc(),element:self.getBody()}})}Editor.prototype={render:function(){var self=this,settings=self.settings,id=self.id,suffix=self.suffix;function readyHandler(){DOM.unbind(window,"ready",readyHandler);self.render()}if(!Event.domLoaded){DOM.bind(window,"ready",readyHandler);return}if(!self.getElement()){return}if(!Env.contentEditable){return}if(!settings.inline){self.orgVisibility=self.getElement().style.visibility;self.getElement().style.visibility="hidden"}else{self.inline=true}var form=self.getElement().form||DOM.getParent(id,"form");if(form){self.formElement=form;if(settings.hidden_input&&!/TEXTAREA|INPUT/i.test(self.getElement().nodeName)){DOM.insertAfter(DOM.create("input",{type:"hidden",name:id}),id);self.hasHiddenInput=true}self.formEventDelegate=function(e){self.fire(e.type,e)};DOM.bind(form,"submit reset",self.formEventDelegate);self.on("reset",function(){self.setContent(self.startContent,{format:"raw"})});if(settings.submit_patch&&!form.submit.nodeType&&!form.submit.length&&!form._mceOldSubmit){form._mceOldSubmit=form.submit;form.submit=function(){self.editorManager.triggerSave();self.setDirty(false);return form._mceOldSubmit(form)}}}self.windowManager=new WindowManager(self);self.notificationManager=new NotificationManager(self);if(settings.encoding=="xml"){self.on("GetContent",function(e){if(e.save){e.content=DOM.encode(e.content)}})}if(settings.add_form_submit_trigger){self.on("submit",function(){if(self.initialized){self.save()}})}if(settings.add_unload_trigger){self._beforeUnload=function(){if(self.initialized&&!self.destroyed&&!self.isHidden()){self.save({format:"raw",no_events:true,set_dirty:false})}};self.editorManager.on("BeforeUnload",self._beforeUnload)}function loadScripts(){var scriptLoader=ScriptLoader.ScriptLoader;if(settings.language&&settings.language!="en"&&!settings.language_url){settings.language_url=self.editorManager.baseURL+"/langs/"+settings.language+".js"}if(settings.language_url){scriptLoader.add(settings.language_url)}if(settings.theme&&typeof settings.theme!="function"&&settings.theme.charAt(0)!="-"&&!ThemeManager.urls[settings.theme]){var themeUrl=settings.theme_url;if(themeUrl){themeUrl=self.documentBaseURI.toAbsolute(themeUrl)}else{themeUrl="themes/"+settings.theme+"/theme"+suffix+".js"}ThemeManager.load(settings.theme,themeUrl)}if(Tools.isArray(settings.plugins)){settings.plugins=settings.plugins.join(" ")}each(settings.external_plugins,function(url,name){PluginManager.load(name,url);settings.plugins+=" "+name});each(settings.plugins.split(/[ ,]/),function(plugin){plugin=trim(plugin);if(plugin&&!PluginManager.urls[plugin]){if(plugin.charAt(0)=="-"){plugin=plugin.substr(1,plugin.length);var dependencies=PluginManager.dependencies(plugin);each(dependencies,function(dep){var defaultSettings={prefix:"plugins/",resource:dep,suffix:"/plugin"+suffix+".js"};dep=PluginManager.createUrl(defaultSettings,dep);PluginManager.load(dep.resource,dep)})}else{PluginManager.load(plugin,{prefix:"plugins/",resource:plugin,suffix:"/plugin"+suffix+".js"})}}});scriptLoader.loadQueue(function(){if(!self.removed){self.init()}})}loadScripts()},init:function(){var self=this,settings=self.settings,elm=self.getElement();var w,h,minHeight,n,o,Theme,url,bodyId,bodyClass,re,i,initializedPlugins=[];this.editorManager.i18n.setCode(settings.language);self.rtl=settings.rtl_ui||this.editorManager.i18n.rtl;self.editorManager.add(self);settings.aria_label=settings.aria_label||DOM.getAttrib(elm,"aria-label",self.getLang("aria.rich_text_area"));if(settings.theme){if(typeof settings.theme!="function"){settings.theme=settings.theme.replace(/-/,"");Theme=ThemeManager.get(settings.theme);self.theme=new Theme(self,ThemeManager.urls[settings.theme]);if(self.theme.init){self.theme.init(self,ThemeManager.urls[settings.theme]||self.documentBaseUrl.replace(/\/$/,""),self.$)}}else{self.theme=settings.theme}}function initPlugin(plugin){var Plugin=PluginManager.get(plugin),pluginUrl,pluginInstance;pluginUrl=PluginManager.urls[plugin]||self.documentBaseUrl.replace(/\/$/,"");plugin=trim(plugin);if(Plugin&&inArray(initializedPlugins,plugin)===-1){each(PluginManager.dependencies(plugin),function(dep){initPlugin(dep)});if(self.plugins[plugin]){return}pluginInstance=new Plugin(self,pluginUrl,self.$);self.plugins[plugin]=pluginInstance;if(pluginInstance.init){pluginInstance.init(self,pluginUrl);initializedPlugins.push(plugin)}}}each(settings.plugins.replace(/\-/g,"").split(/[ ,]/),initPlugin);if(settings.render_ui&&self.theme){self.orgDisplay=elm.style.display;if(typeof settings.theme!="function"){w=settings.width||elm.style.width||elm.offsetWidth;h=settings.height||elm.style.height||elm.offsetHeight;minHeight=settings.min_height||100;re=/^[0-9\.]+(|px)$/i;if(re.test(""+w)){w=Math.max(parseInt(w,10),100)}if(re.test(""+h)){h=Math.max(parseInt(h,10),minHeight)}o=self.theme.renderUI({targetNode:elm,width:w,height:h,deltaWidth:settings.delta_width,deltaHeight:settings.delta_height});if(!settings.content_editable){h=(o.iframeHeight||h)+(typeof h=="number"?o.deltaHeight||0:"");if(h<minHeight){h=minHeight}}}else{o=settings.theme(self,elm);if(o.editorContainer.nodeType){o.editorContainer=o.editorContainer.id=o.editorContainer.id||self.id+"_parent"}if(o.iframeContainer.nodeType){o.iframeContainer=o.iframeContainer.id=o.iframeContainer.id||self.id+"_iframecontainer"}h=o.iframeHeight||elm.offsetHeight}self.editorContainer=o.editorContainer}if(settings.content_css){each(explode(settings.content_css),function(u){self.contentCSS.push(self.documentBaseURI.toAbsolute(u))})}if(settings.content_style){self.contentStyles.push(settings.content_style)}if(settings.content_editable){elm=n=o=null;return self.initContentBody()}self.iframeHTML=settings.doctype+"<html><head>";if(settings.document_base_url!=self.documentBaseUrl){self.iframeHTML+='<base href="'+self.documentBaseURI.getURI()+'" />'}if(!Env.caretAfter&&settings.ie7_compat){self.iframeHTML+='<meta http-equiv="X-UA-Compatible" content="IE=7" />'}self.iframeHTML+='<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />';if(!/#$/.test(document.location.href)){for(i=0;i<self.contentCSS.length;i++){var cssUrl=self.contentCSS[i];self.iframeHTML+='<link type="text/css" '+'rel="stylesheet" '+'href="'+Tools._addCacheSuffix(cssUrl)+'" />';self.loadedCSS[cssUrl]=true}}bodyId=settings.body_id||"tinymce";if(bodyId.indexOf("=")!=-1){bodyId=self.getParam("body_id","","hash");bodyId=bodyId[self.id]||bodyId}bodyClass=settings.body_class||"";if(bodyClass.indexOf("=")!=-1){bodyClass=self.getParam("body_class","","hash");bodyClass=bodyClass[self.id]||""}if(settings.content_security_policy){self.iframeHTML+='<meta http-equiv="Content-Security-Policy" content="'+settings.content_security_policy+'" />'}self.iframeHTML+='</head><body id="'+bodyId+'" class="mce-content-body '+bodyClass+'" data-id="'+self.id+'"><br></body></html>';var domainRelaxUrl="javascript:(function(){"+'document.open();document.domain="'+document.domain+'";'+'var ed = window.parent.tinymce.get("'+self.id+'");document.write(ed.iframeHTML);'+"document.close();ed.initContentBody(true);})()";if(document.domain!=location.hostname){if(Env.ie&&Env.ie<12){url=domainRelaxUrl}}var ifr=DOM.create("iframe",{id:self.id+"_ifr",frameBorder:"0",allowTransparency:"true",title:self.editorManager.translate("Rich Text Area. Press ALT-F9 for menu. "+"Press ALT-F10 for toolbar. Press ALT-0 for help"),style:{width:"100%",height:h,display:"block"}});ifr.onload=function(){ifr.onload=null;self.fire("load")};DOM.setAttrib(ifr,"src",url||'javascript:""');self.contentAreaContainer=o.iframeContainer;self.iframeElement=ifr;n=DOM.add(o.iframeContainer,ifr);if(ie){try{self.getDoc()}catch(e){n.src=url=domainRelaxUrl}}if(o.editorContainer){DOM.get(o.editorContainer).style.display=self.orgDisplay;self.hidden=DOM.isHidden(o.editorContainer)}self.getElement().style.display="none";DOM.setAttrib(self.id,"aria-hidden",true);if(!url){self.initContentBody()}elm=n=o=null},initContentBody:function(skipWrite){var self=this,settings=self.settings,targetElm=self.getElement(),doc=self.getDoc(),body,contentCssText;if(!settings.inline){self.getElement().style.visibility=self.orgVisibility}if(!skipWrite&&!settings.content_editable){doc.open();doc.write(self.iframeHTML);doc.close()}if(settings.content_editable){self.on("remove",function(){var bodyEl=this.getBody();DOM.removeClass(bodyEl,"mce-content-body");DOM.removeClass(bodyEl,"mce-edit-focus");DOM.setAttrib(bodyEl,"contentEditable",null)});DOM.addClass(targetElm,"mce-content-body");self.contentDocument=doc=settings.content_document||document;self.contentWindow=settings.content_window||window;self.bodyElement=targetElm;settings.content_document=settings.content_window=null;settings.root_name=targetElm.nodeName.toLowerCase()}body=self.getBody();body.disabled=true;self.readonly=settings.readonly;if(!self.readonly){if(self.inline&&DOM.getStyle(body,"position",true)=="static"){body.style.position="relative"}body.contentEditable=self.getParam("content_editable_state",true)}body.disabled=false;self.editorUpload=new EditorUpload(self);self.schema=new Schema(settings);self.dom=new DOMUtils(doc,{keep_values:true,url_converter:self.convertURL,url_converter_scope:self,hex_colors:settings.force_hex_style_colors,class_filter:settings.class_filter,update_styles:true,root_element:self.inline?self.getBody():null,collect:settings.content_editable,schema:self.schema,onSetAttrib:function(e){self.fire("SetAttrib",e)}});self.parser=new DomParser(settings,self.schema);self.parser.addAttributeFilter("src,href,style,tabindex",function(nodes,name){var i=nodes.length,node,dom=self.dom,value,internalName;while(i--){node=nodes[i];value=node.attr(name);internalName="data-mce-"+name;if(!node.attributes.map[internalName]){if(value.indexOf("data:")===0||value.indexOf("blob:")===0){continue}if(name==="style"){value=dom.serializeStyle(dom.parseStyle(value),node.name);if(!value.length){value=null}node.attr(internalName,value);node.attr(name,value)}else if(name==="tabindex"){node.attr(internalName,value);node.attr(name,null)}else{node.attr(internalName,self.convertURL(value,name,node.name))}}}});self.parser.addNodeFilter("script",function(nodes){var i=nodes.length,node,type;while(i--){node=nodes[i];type=node.attr("type")||"no/type";if(type.indexOf("mce-")!==0){node.attr("type","mce-"+type)}}});self.parser.addNodeFilter("#cdata",function(nodes){var i=nodes.length,node;while(i--){node=nodes[i];node.type=8;node.name="#comment";node.value="[CDATA["+node.value+"]]"}});self.parser.addNodeFilter("p,h1,h2,h3,h4,h5,h6,div",function(nodes){var i=nodes.length,node,nonEmptyElements=self.schema.getNonEmptyElements();while(i--){node=nodes[i];if(node.isEmpty(nonEmptyElements)){node.append(new Node("br",1)).shortEnded=true}}});self.serializer=new DomSerializer(settings,self);self.selection=new Selection(self.dom,self.getWin(),self.serializer,self);self.formatter=new Formatter(self);self.undoManager=new UndoManager(self);self.forceBlocks=new ForceBlocks(self);self.enterKey=new EnterKey(self);self._nodeChangeDispatcher=new NodeChange(self);self._selectionOverrides=new SelectionOverrides(self);self.fire("PreInit");if(!settings.browser_spellcheck&&!settings.gecko_spellcheck){doc.body.spellcheck=false;DOM.setAttrib(body,"spellcheck","false")}self.quirks=new Quirks(self);self.fire("PostRender");if(settings.directionality){body.dir=settings.directionality}if(settings.nowrap){body.style.whiteSpace="nowrap"}if(settings.protect){self.on("BeforeSetContent",function(e){each(settings.protect,function(pattern){e.content=e.content.replace(pattern,function(str){return"<!--mce:protected "+escape(str)+"-->"})})})}self.on("SetContent",function(){self.addVisual(self.getBody())});if(settings.padd_empty_editor){self.on("PostProcess",function(e){e.content=e.content.replace(/^(<p[^>]*>(&nbsp;|&#160;|\s|\u00a0|)<\/p>[\r\n]*|<br \/>[\r\n]*)$/,"")})}self.load({initial:true,format:"html"});self.startContent=self.getContent({format:"raw"});self.initialized=true;self.bindPendingEventDelegates();self.fire("init");self.focus(true);self.nodeChanged({initial:true});self.execCallback("init_instance_callback",self);self.on("compositionstart compositionend",function(e){self.composing=e.type==="compositionstart"});if(self.contentStyles.length>0){contentCssText="";each(self.contentStyles,function(style){contentCssText+=style+"\r\n"});self.dom.addStyle(contentCssText)}each(self.contentCSS,function(cssUrl){if(!self.loadedCSS[cssUrl]){self.dom.loadCSS(cssUrl);self.loadedCSS[cssUrl]=true}});if(settings.auto_focus){Delay.setEditorTimeout(self,function(){var editor;if(settings.auto_focus===true){editor=self}else{editor=self.editorManager.get(settings.auto_focus)}if(!editor.destroyed){editor.focus()}},100)}targetElm=doc=body=null},focus:function(skipFocus){var self=this,selection=self.selection,contentEditable=self.settings.content_editable,rng;var controlElm,doc=self.getDoc(),body=self.getBody(),contentEditableHost;function getContentEditableHost(node){return self.dom.getParent(node,function(node){return self.dom.getContentEditable(node)==="true"})}if(!skipFocus){rng=selection.getRng();if(rng.item){controlElm=rng.item(0)}self.quirks.refreshContentEditable();contentEditableHost=getContentEditableHost(selection.getNode());if(self.$.contains(body,contentEditableHost)){contentEditableHost.focus();selection.normalize();self.editorManager.setActive(self);return}if(!contentEditable){if(!Env.opera){self.getBody().focus()}self.getWin().focus()}if(isGecko||contentEditable){if(body.setActive){try{body.setActive()}catch(ex){body.focus()}}else{body.focus()}if(contentEditable){selection.normalize()}}if(controlElm&&controlElm.ownerDocument==doc){rng=doc.body.createControlRange();rng.addElement(controlElm);rng.select()}}self.editorManager.setActive(self)},execCallback:function(name){var self=this,callback=self.settings[name],scope;if(!callback){return}if(self.callbackLookup&&(scope=self.callbackLookup[name])){callback=scope.func;scope=scope.scope}if(typeof callback==="string"){scope=callback.replace(/\.\w+$/,"");scope=scope?resolve(scope):0;callback=resolve(callback);self.callbackLookup=self.callbackLookup||{};self.callbackLookup[name]={func:callback,scope:scope}}return callback.apply(scope||self,Array.prototype.slice.call(arguments,1))},translate:function(text){var lang=this.settings.language||"en",i18n=this.editorManager.i18n;if(!text){return""}text=i18n.data[lang+"."+text]||text.replace(/\{\#([^\}]+)\}/g,function(a,b){return i18n.data[lang+"."+b]||"{#"+b+"}"});return this.editorManager.translate(text)},getLang:function(name,defaultVal){return this.editorManager.i18n.data[(this.settings.language||"en")+"."+name]||(defaultVal!==undefined?defaultVal:"{#"+name+"}")},getParam:function(name,defaultVal,type){var value=name in this.settings?this.settings[name]:defaultVal,output;if(type==="hash"){output={};if(typeof value==="string"){each(value.indexOf("=")>0?value.split(/[;,](?![^=;,]*(?:[;,]|$))/):value.split(","),function(value){value=value.split("=");if(value.length>1){output[trim(value[0])]=trim(value[1])}else{output[trim(value[0])]=trim(value)}})}else{output=value}return output}return value},nodeChanged:function(args){this._nodeChangeDispatcher.nodeChanged(args)},addButton:function(name,settings){var self=this;if(settings.cmd){settings.onclick=function(){self.execCommand(settings.cmd)}}if(!settings.text&&!settings.icon){settings.icon=name}self.buttons=self.buttons||{};settings.tooltip=settings.tooltip||settings.title;self.buttons[name]=settings},addMenuItem:function(name,settings){var self=this;if(settings.cmd){settings.onclick=function(){self.execCommand(settings.cmd)}}self.menuItems=self.menuItems||{};self.menuItems[name]=settings},addContextToolbar:function(predicate,items){var self=this,selector;self.contextToolbars=self.contextToolbars||[];if(typeof predicate=="string"){selector=predicate;predicate=function(elm){return self.dom.is(elm,selector)}}self.contextToolbars.push({predicate:predicate,items:items})},addCommand:function(name,callback,scope){this.editorCommands.addCommand(name,callback,scope)},addQueryStateHandler:function(name,callback,scope){this.editorCommands.addQueryStateHandler(name,callback,scope)},addQueryValueHandler:function(name,callback,scope){this.editorCommands.addQueryValueHandler(name,callback,scope)},addShortcut:function(pattern,desc,cmdFunc,scope){this.shortcuts.add(pattern,desc,cmdFunc,scope)},execCommand:function(cmd,ui,value,args){return this.editorCommands.execCommand(cmd,ui,value,args)},queryCommandState:function(cmd){return this.editorCommands.queryCommandState(cmd)},queryCommandValue:function(cmd){return this.editorCommands.queryCommandValue(cmd)},queryCommandSupported:function(cmd){return this.editorCommands.queryCommandSupported(cmd)},show:function(){var self=this;if(self.hidden){self.hidden=false;if(self.inline){self.getBody().contentEditable=true}else{DOM.show(self.getContainer());DOM.hide(self.id)}self.load();self.fire("show")}},hide:function(){var self=this,doc=self.getDoc();if(!self.hidden){if(ie&&doc&&!self.inline){doc.execCommand("SelectAll")}self.save();if(self.inline){self.getBody().contentEditable=false;if(self==self.editorManager.focusedEditor){self.editorManager.focusedEditor=null}}else{DOM.hide(self.getContainer());DOM.setStyle(self.id,"display",self.orgDisplay)}self.hidden=true;self.fire("hide")}},isHidden:function(){return!!this.hidden},setProgressState:function(state,time){this.fire("ProgressState",{state:state,time:time})},load:function(args){var self=this,elm=self.getElement(),html;if(elm){args=args||{};args.load=true;html=self.setContent(elm.value!==undefined?elm.value:elm.innerHTML,args);args.element=elm;if(!args.no_events){self.fire("LoadContent",args)}args.element=elm=null;return html}},save:function(args){var self=this,elm=self.getElement(),html,form;if(!elm||!self.initialized){return}args=args||{};args.save=true;args.element=elm;html=args.content=self.getContent(args);if(!args.no_events){self.fire("SaveContent",args)}if(args.format=="raw"){self.fire("RawSaveContent",args)}html=args.content;if(!/TEXTAREA|INPUT/i.test(elm.nodeName)){if(!self.inline){elm.innerHTML=html}if(form=DOM.getParent(self.id,"form")){each(form.elements,function(elm){if(elm.name==self.id){elm.value=html;return false}})}}else{elm.value=html}args.element=elm=null;if(args.set_dirty!==false){self.setDirty(false)}return html},setContent:function(content,args){var self=this,body=self.getBody(),forcedRootBlockName,padd;args=args||{};args.format=args.format||"html";args.set=true;args.content=content;if(!args.no_events){self.fire("BeforeSetContent",args)}content=args.content;if(content.length===0||/^\s+$/.test(content)){padd=ie&&ie<11?"":'<br data-mce-bogus="1">';if(body.nodeName=="TABLE"){content="<tr><td>"+padd+"</td></tr>"}else if(/^(UL|OL)$/.test(body.nodeName)){content="<li>"+padd+"</li>"}forcedRootBlockName=self.settings.forced_root_block;if(forcedRootBlockName&&self.schema.isValidChild(body.nodeName.toLowerCase(),forcedRootBlockName.toLowerCase())){content=padd;content=self.dom.createHTML(forcedRootBlockName,self.settings.forced_root_block_attrs,content)}else if(!ie&&!content){content='<br data-mce-bogus="1">'}self.dom.setHTML(body,content);self.fire("SetContent",args)}else{if(args.format!=="raw"){content=new Serializer({validate:self.validate},self.schema).serialize(self.parser.parse(content,{isRootContent:true}))}args.content=trim(content);self.dom.setHTML(body,args.content);if(!args.no_events){self.fire("SetContent",args)}}return args.content},getContent:function(args){var self=this,content,body=self.getBody();args=args||{};args.format=args.format||"html";args.get=true;args.getInner=true;if(!args.no_events){self.fire("BeforeGetContent",args)}if(args.format=="raw"){content=self.serializer.getTrimmedContent()}else if(args.format=="text"){content=body.innerText||body.textContent}else{content=self.serializer.serialize(body,args)}if(args.format!="text"){args.content=trim(content)}else{args.content=content}if(!args.no_events){self.fire("GetContent",args)}return args.content},insertContent:function(content,args){if(args){content=extend({content:content},args)}this.execCommand("mceInsertContent",false,content)},isDirty:function(){return!this.isNotDirty},setDirty:function(state){var oldState=!this.isNotDirty;this.isNotDirty=!state;if(state&&state!=oldState){this.fire("dirty")}},setMode:function(mode){Mode.setMode(this,mode)},getContainer:function(){var self=this;if(!self.container){self.container=DOM.get(self.editorContainer||self.id+"_parent")}return self.container},getContentAreaContainer:function(){return this.contentAreaContainer},getElement:function(){if(!this.targetElm){this.targetElm=DOM.get(this.id)}return this.targetElm},getWin:function(){var self=this,elm;if(!self.contentWindow){elm=self.iframeElement;if(elm){self.contentWindow=elm.contentWindow}}return self.contentWindow},getDoc:function(){var self=this,win;if(!self.contentDocument){win=self.getWin();if(win){self.contentDocument=win.document}}return self.contentDocument},getBody:function(){return this.bodyElement||this.getDoc().body},convertURL:function(url,name,elm){var self=this,settings=self.settings;if(settings.urlconverter_callback){return self.execCallback("urlconverter_callback",url,elm,true,name)}if(!settings.convert_urls||elm&&elm.nodeName=="LINK"||url.indexOf("file:")===0||url.length===0){return url}if(settings.relative_urls){return self.documentBaseURI.toRelative(url)}url=self.documentBaseURI.toAbsolute(url,settings.remove_script_host);return url},addVisual:function(elm){var self=this,settings=self.settings,dom=self.dom,cls;elm=elm||self.getBody();if(self.hasVisual===undefined){self.hasVisual=settings.visual}each(dom.select("table,a",elm),function(elm){var value;switch(elm.nodeName){case"TABLE":cls=settings.visual_table_class||"mce-item-table";value=dom.getAttrib(elm,"border");if((!value||value=="0")&&self.hasVisual){dom.addClass(elm,cls)}else{dom.removeClass(elm,cls)}return;case"A":if(!dom.getAttrib(elm,"href",false)){value=dom.getAttrib(elm,"name")||elm.id;cls=settings.visual_anchor_class||"mce-item-anchor";if(value&&self.hasVisual){dom.addClass(elm,cls)}else{dom.removeClass(elm,cls)}}return}});self.fire("VisualAid",{element:elm,hasVisual:self.hasVisual})},remove:function(){var self=this;if(!self.removed){self.save();self.removed=1;self.unbindAllNativeEvents();if(self.hasHiddenInput){DOM.remove(self.getElement().nextSibling);
}if(!self.inline){if(ie&&ie<10){self.getDoc().execCommand("SelectAll",false,null)}DOM.setStyle(self.id,"display",self.orgDisplay);self.getBody().onload=null}self.fire("remove");self.editorManager.remove(self);DOM.remove(self.getContainer());self._selectionOverrides.destroy();self.editorUpload.destroy();self.destroy()}},destroy:function(automatic){var self=this,form;if(self.destroyed){return}if(!automatic&&!self.removed){self.remove();return}if(!automatic){self.editorManager.off("beforeunload",self._beforeUnload);if(self.theme&&self.theme.destroy){self.theme.destroy()}self.selection.destroy();self.dom.destroy()}form=self.formElement;if(form){if(form._mceOldSubmit){form.submit=form._mceOldSubmit;form._mceOldSubmit=null}DOM.unbind(form,"submit reset",self.formEventDelegate)}self.contentAreaContainer=self.formElement=self.container=self.editorContainer=null;self.bodyElement=self.contentDocument=self.contentWindow=null;self.iframeElement=self.targetElm=null;if(self.selection){self.selection=self.selection.win=self.selection.dom=self.selection.dom.doc=null}self.destroyed=1},uploadImages:function(callback){return this.editorUpload.uploadImages(callback)},_scanForImages:function(){return this.editorUpload.scanForImages()}};extend(Editor.prototype,EditorObservable);return Editor});define("tinymce/util/I18n",[],function(){"use strict";var data={},code="en";return{setCode:function(newCode){if(newCode){code=newCode;this.rtl=this.data[newCode]?this.data[newCode]._dir==="rtl":false}},getCode:function(){return code},rtl:false,add:function(code,items){var langData=data[code];if(!langData){data[code]=langData={}}for(var name in items){langData[name]=items[name]}this.setCode(code)},translate:function(text){var langData;langData=data[code];if(!langData){langData={}}if(typeof text=="undefined"){return text}if(typeof text!="string"&&text.raw){return text.raw}if(text.push){var values=text.slice(1);text=(langData[text[0]]||text[0]).replace(/\{([0-9]+)\}/g,function(match1,match2){return values[match2]})}return(langData[text]||text).replace(/{context:\w+}$/,"")},data:data}});define("tinymce/FocusManager",["tinymce/dom/DOMUtils","tinymce/util/Delay","tinymce/Env"],function(DOMUtils,Delay,Env){var selectionChangeHandler,documentFocusInHandler,documentMouseUpHandler,DOM=DOMUtils.DOM;function FocusManager(editorManager){function getActiveElement(){try{return document.activeElement}catch(ex){return document.body}}function createBookmark(dom,rng){if(rng&&rng.startContainer){if(!dom.isChildOf(rng.startContainer,dom.getRoot())||!dom.isChildOf(rng.endContainer,dom.getRoot())){return}return{startContainer:rng.startContainer,startOffset:rng.startOffset,endContainer:rng.endContainer,endOffset:rng.endOffset}}return rng}function bookmarkToRng(editor,bookmark){var rng;if(bookmark.startContainer){rng=editor.getDoc().createRange();rng.setStart(bookmark.startContainer,bookmark.startOffset);rng.setEnd(bookmark.endContainer,bookmark.endOffset)}else{rng=bookmark}return rng}function isUIElement(elm){return!!DOM.getParent(elm,FocusManager.isEditorUIElement)}function registerEvents(e){var editor=e.editor;editor.on("init",function(){if(editor.inline||Env.ie){if("onbeforedeactivate"in document&&Env.ie<9){editor.dom.bind(editor.getBody(),"beforedeactivate",function(e){if(e.target!=editor.getBody()){return}try{editor.lastRng=editor.selection.getRng()}catch(ex){}})}else{editor.on("nodechange mouseup keyup",function(e){var node=getActiveElement();if(e.type=="nodechange"&&e.selectionChange){return}if(node&&node.id==editor.id+"_ifr"){node=editor.getBody()}if(editor.dom.isChildOf(node,editor.getBody())){editor.lastRng=editor.selection.getRng()}})}if(Env.webkit&&!selectionChangeHandler){selectionChangeHandler=function(){var activeEditor=editorManager.activeEditor;if(activeEditor&&activeEditor.selection){var rng=activeEditor.selection.getRng();if(rng&&!rng.collapsed){editor.lastRng=rng}}};DOM.bind(document,"selectionchange",selectionChangeHandler)}}});editor.on("setcontent",function(){editor.lastRng=null});editor.on("mousedown",function(){editor.selection.lastFocusBookmark=null});editor.on("focusin",function(){var focusedEditor=editorManager.focusedEditor,lastRng;if(editor.selection.lastFocusBookmark){lastRng=bookmarkToRng(editor,editor.selection.lastFocusBookmark);editor.selection.lastFocusBookmark=null;editor.selection.setRng(lastRng)}if(focusedEditor!=editor){if(focusedEditor){focusedEditor.fire("blur",{focusedEditor:editor})}editorManager.setActive(editor);editorManager.focusedEditor=editor;editor.fire("focus",{blurredEditor:focusedEditor});editor.focus(true)}editor.lastRng=null});editor.on("focusout",function(){Delay.setEditorTimeout(editor,function(){var focusedEditor=editorManager.focusedEditor;if(!isUIElement(getActiveElement())&&focusedEditor==editor){editor.fire("blur",{focusedEditor:null});editorManager.focusedEditor=null;if(editor.selection){editor.selection.lastFocusBookmark=null}}})});if(!documentFocusInHandler){documentFocusInHandler=function(e){var activeEditor=editorManager.activeEditor,target;target=e.target;if(activeEditor&&target.ownerDocument==document){if(activeEditor.selection&&target!=activeEditor.getBody()){activeEditor.selection.lastFocusBookmark=createBookmark(activeEditor.dom,activeEditor.lastRng)}if(target!=document.body&&!isUIElement(target)&&editorManager.focusedEditor==activeEditor){activeEditor.fire("blur",{focusedEditor:null});editorManager.focusedEditor=null}}};DOM.bind(document,"focusin",documentFocusInHandler)}if(editor.inline&&!documentMouseUpHandler){documentMouseUpHandler=function(e){var activeEditor=editorManager.activeEditor;if(activeEditor.inline&&!activeEditor.dom.isChildOf(e.target,activeEditor.getBody())){var rng=activeEditor.selection.getRng();if(!rng.collapsed){activeEditor.lastRng=rng}}};DOM.bind(document,"mouseup",documentMouseUpHandler)}}function unregisterDocumentEvents(e){if(editorManager.focusedEditor==e.editor){editorManager.focusedEditor=null}if(!editorManager.activeEditor){DOM.unbind(document,"selectionchange",selectionChangeHandler);DOM.unbind(document,"focusin",documentFocusInHandler);DOM.unbind(document,"mouseup",documentMouseUpHandler);selectionChangeHandler=documentFocusInHandler=documentMouseUpHandler=null}}editorManager.on("AddEditor",registerEvents);editorManager.on("RemoveEditor",unregisterDocumentEvents)}FocusManager.isEditorUIElement=function(elm){return elm.className.toString().indexOf("mce-")!==-1};return FocusManager});define("tinymce/EditorManager",["tinymce/Editor","tinymce/dom/DomQuery","tinymce/dom/DOMUtils","tinymce/util/URI","tinymce/Env","tinymce/util/Tools","tinymce/util/Promise","tinymce/util/Observable","tinymce/util/I18n","tinymce/FocusManager"],function(Editor,$,DOMUtils,URI,Env,Tools,Promise,Observable,I18n,FocusManager){var DOM=DOMUtils.DOM;var explode=Tools.explode,each=Tools.each,extend=Tools.extend;var instanceCounter=0,beforeUnloadDelegate,EditorManager,boundGlobalEvents=false;function globalEventDelegate(e){each(EditorManager.editors,function(editor){if(e.type==="scroll"){editor.fire("ScrollWindow",e)}else{editor.fire("ResizeWindow",e)}})}function toggleGlobalEvents(editors,state){if(state!==boundGlobalEvents){if(state){$(window).on("resize scroll",globalEventDelegate)}else{$(window).off("resize scroll",globalEventDelegate)}boundGlobalEvents=state}}function removeEditorFromList(editor){var editors=EditorManager.editors,removedFromList;delete editors[editor.id];for(var i=0;i<editors.length;i++){if(editors[i]==editor){editors.splice(i,1);removedFromList=true;break}}if(EditorManager.activeEditor==editor){EditorManager.activeEditor=editors[0]}if(EditorManager.focusedEditor==editor){EditorManager.focusedEditor=null}return removedFromList}function purgeDestroyedEditor(editor){if(editor&&!(editor.getContainer()||editor.getBody()).parentNode){removeEditorFromList(editor);editor.unbindAllNativeEvents();editor.destroy(true);editor.removed=true;editor=null}return editor}EditorManager={$:$,majorVersion:"4",minorVersion:"3.12",releaseDate:"2016-05-10",editors:[],i18n:I18n,activeEditor:null,setup:function(){var self=this,baseURL,documentBaseURL,suffix="",preInit,src;documentBaseURL=URI.getDocumentBaseUrl(document.location);if(/^[^:]+:\/\/\/?[^\/]+\//.test(documentBaseURL)){documentBaseURL=documentBaseURL.replace(/[\?#].*$/,"").replace(/[\/\\][^\/]+$/,"");if(!/[\/\\]$/.test(documentBaseURL)){documentBaseURL+="/"}}preInit=window.tinymce||window.tinyMCEPreInit;if(preInit){baseURL=preInit.base||preInit.baseURL;suffix=preInit.suffix}else{var scripts=document.getElementsByTagName("script");for(var i=0;i<scripts.length;i++){src=scripts[i].src;var srcScript=src.substring(src.lastIndexOf("/"));if(/tinymce(\.full|\.jquery|)(\.min|\.dev|)\.js/.test(src)){if(srcScript.indexOf(".min")!=-1){suffix=".min"}baseURL=src.substring(0,src.lastIndexOf("/"));break}}if(!baseURL&&document.currentScript){src=document.currentScript.src;if(src.indexOf(".min")!=-1){suffix=".min"}baseURL=src.substring(0,src.lastIndexOf("/"))}}self.baseURL=new URI(documentBaseURL).toAbsolute(baseURL);self.documentBaseURL=documentBaseURL;self.baseURI=new URI(self.baseURL);self.suffix=suffix;self.focusManager=new FocusManager(self)},overrideDefaults:function(defaultSettings){var baseUrl,suffix;baseUrl=defaultSettings.base_url;if(baseUrl){this.baseURL=new URI(this.documentBaseURL).toAbsolute(baseUrl.replace(/\/+$/,""));this.baseURI=new URI(this.baseURL)}suffix=defaultSettings.suffix;if(defaultSettings.suffix){this.suffix=suffix}this.defaultSettings=defaultSettings},init:function(settings){var self=this,result;function createId(elm){var id=elm.id;if(!id){id=elm.name;if(id&&!DOM.get(id)){id=elm.name}else{id=DOM.uniqueId()}elm.setAttribute("id",id)}return id}function execCallback(name){var callback=settings[name];if(!callback){return}return callback.apply(self,Array.prototype.slice.call(arguments,2))}function hasClass(elm,className){return className.constructor===RegExp?className.test(elm.className):DOM.hasClass(elm,className)}function findTargets(settings){var l,targets=[];if(settings.types){each(settings.types,function(type){targets=targets.concat(DOM.select(type.selector))});return targets}else if(settings.selector){return DOM.select(settings.selector)}else if(settings.target){return[settings.target]}switch(settings.mode){case"exact":l=settings.elements||"";if(l.length>0){each(explode(l),function(id){var elm;if(elm=DOM.get(id)){targets.push(elm)}else{each(document.forms,function(f){each(f.elements,function(e){if(e.name===id){id="mce_editor_"+instanceCounter++;DOM.setAttrib(e,"id",id);targets.push(e)}})})}})}break;case"textareas":case"specific_textareas":each(DOM.select("textarea"),function(elm){if(settings.editor_deselector&&hasClass(elm,settings.editor_deselector)){return}if(!settings.editor_selector||hasClass(elm,settings.editor_selector)){targets.push(elm)}});break}return targets}var provideResults=function(editors){result=editors};function initEditors(){var initCount=0,editors=[],targets;function createEditor(id,settings,targetElm){if(!purgeDestroyedEditor(self.get(id))){var editor=new Editor(id,settings,self);editors.push(editor);editor.on("init",function(){if(++initCount===targets.length){provideResults(editors)}});editor.targetElm=editor.targetElm||targetElm;editor.render()}}DOM.unbind(window,"ready",initEditors);execCallback("onpageload");targets=$.unique(findTargets(settings));if(settings.types){each(settings.types,function(type){Tools.each(targets,function(elm){if(DOM.is(elm,type.selector)){createEditor(createId(elm),extend({},settings,type),elm);return false}return true})});return}each(targets,function(elm){createEditor(createId(elm),settings,elm)})}self.settings=settings;DOM.bind(window,"ready",initEditors);return new Promise(function(resolve){if(result){resolve(result)}else{provideResults=function(editors){resolve(editors)}}})},get:function(id){if(!arguments.length){return this.editors}return id in this.editors?this.editors[id]:null},add:function(editor){var self=this,editors=self.editors;editors[editor.id]=editor;editors.push(editor);toggleGlobalEvents(editors,true);self.activeEditor=editor;self.fire("AddEditor",{editor:editor});if(!beforeUnloadDelegate){beforeUnloadDelegate=function(){self.fire("BeforeUnload")};DOM.bind(window,"beforeunload",beforeUnloadDelegate)}return editor},createEditor:function(id,settings){return this.add(new Editor(id,settings,this))},remove:function(selector){var self=this,i,editors=self.editors,editor;if(!selector){for(i=editors.length-1;i>=0;i--){self.remove(editors[i])}return}if(typeof selector=="string"){selector=selector.selector||selector;each(DOM.select(selector),function(elm){editor=editors[elm.id];if(editor){self.remove(editor)}});return}editor=selector;if(!editors[editor.id]){return null}if(removeEditorFromList(editor)){self.fire("RemoveEditor",{editor:editor})}if(!editors.length){DOM.unbind(window,"beforeunload",beforeUnloadDelegate)}editor.remove();toggleGlobalEvents(editors,editors.length>0);return editor},execCommand:function(cmd,ui,value){var self=this,editor=self.get(value);switch(cmd){case"mceAddEditor":if(!self.get(value)){new Editor(value,self.settings,self).render()}return true;case"mceRemoveEditor":if(editor){editor.remove()}return true;case"mceToggleEditor":if(!editor){self.execCommand("mceAddEditor",0,value);return true}if(editor.isHidden()){editor.show()}else{editor.hide()}return true}if(self.activeEditor){return self.activeEditor.execCommand(cmd,ui,value)}return false},triggerSave:function(){each(this.editors,function(editor){editor.save()})},addI18n:function(code,items){I18n.add(code,items)},translate:function(text){return I18n.translate(text)},setActive:function(editor){var activeEditor=this.activeEditor;if(this.activeEditor!=editor){if(activeEditor){activeEditor.fire("deactivate",{relatedTarget:editor})}editor.fire("activate",{relatedTarget:activeEditor})}this.activeEditor=editor}};extend(EditorManager,Observable);EditorManager.setup();window.tinymce=window.tinyMCE=EditorManager;return EditorManager});define("tinymce/LegacyInput",["tinymce/EditorManager","tinymce/util/Tools"],function(EditorManager,Tools){var each=Tools.each,explode=Tools.explode;EditorManager.on("AddEditor",function(e){var editor=e.editor;editor.on("preInit",function(){var filters,fontSizes,dom,settings=editor.settings;function replaceWithSpan(node,styles){each(styles,function(value,name){if(value){dom.setStyle(node,name,value)}});dom.rename(node,"span")}function convert(e){dom=editor.dom;if(settings.convert_fonts_to_spans){each(dom.select("font,u,strike",e.node),function(node){filters[node.nodeName.toLowerCase()](dom,node)})}}if(settings.inline_styles){fontSizes=explode(settings.font_size_legacy_values);filters={font:function(dom,node){replaceWithSpan(node,{backgroundColor:node.style.backgroundColor,color:node.color,fontFamily:node.face,fontSize:fontSizes[parseInt(node.size,10)-1]})},u:function(dom,node){if(editor.settings.schema==="html4"){replaceWithSpan(node,{textDecoration:"underline"})}},strike:function(dom,node){replaceWithSpan(node,{textDecoration:"line-through"})}};editor.on("PreProcess SetContent",convert)}})})});define("tinymce/util/XHR",["tinymce/util/Observable","tinymce/util/Tools"],function(Observable,Tools){var XHR={send:function(settings){var xhr,count=0;function ready(){if(!settings.async||xhr.readyState==4||count++>1e4){if(settings.success&&count<1e4&&xhr.status==200){settings.success.call(settings.success_scope,""+xhr.responseText,xhr,settings)}else if(settings.error){settings.error.call(settings.error_scope,count>1e4?"TIMED_OUT":"GENERAL",xhr,settings)}xhr=null}else{setTimeout(ready,10)}}settings.scope=settings.scope||this;settings.success_scope=settings.success_scope||settings.scope;settings.error_scope=settings.error_scope||settings.scope;settings.async=settings.async===false?false:true;settings.data=settings.data||"";XHR.fire("beforeInitialize",{settings:settings});xhr=new XMLHttpRequest;if(xhr){if(xhr.overrideMimeType){xhr.overrideMimeType(settings.content_type)}xhr.open(settings.type||(settings.data?"POST":"GET"),settings.url,settings.async);if(settings.crossDomain){xhr.withCredentials=true}if(settings.content_type){xhr.setRequestHeader("Content-Type",settings.content_type)}if(settings.requestheaders){Tools.each(settings.requestheaders,function(header){xhr.setRequestHeader(header.key,header.value)})}xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");xhr=XHR.fire("beforeSend",{xhr:xhr,settings:settings}).xhr;xhr.send(settings.data);if(!settings.async){return ready()}setTimeout(ready,10)}}};Tools.extend(XHR,Observable);return XHR});define("tinymce/util/JSON",[],function(){function serialize(o,quote){var i,v,t,name;quote=quote||'"';if(o===null){return"null"}t=typeof o;if(t=="string"){v="\bb\tt\nn\ff\rr\"\"''\\\\";return quote+o.replace(/([\u0080-\uFFFF\x00-\x1f\"\'\\])/g,function(a,b){if(quote==='"'&&a==="'"){return a}i=v.indexOf(b);if(i+1){return"\\"+v.charAt(i+1)}a=b.charCodeAt().toString(16);return"\\u"+"0000".substring(a.length)+a})+quote}if(t=="object"){if(o.hasOwnProperty&&Object.prototype.toString.call(o)==="[object Array]"){for(i=0,v="[";i<o.length;i++){v+=(i>0?",":"")+serialize(o[i],quote)}return v+"]"}v="{";for(name in o){if(o.hasOwnProperty(name)){v+=typeof o[name]!="function"?(v.length>1?","+quote:quote)+name+quote+":"+serialize(o[name],quote):""}}return v+"}"}return""+o}return{serialize:serialize,parse:function(text){try{return window[String.fromCharCode(101)+"val"]("("+text+")")}catch(ex){}}}});define("tinymce/util/JSONRequest",["tinymce/util/JSON","tinymce/util/XHR","tinymce/util/Tools"],function(JSON,XHR,Tools){var extend=Tools.extend;function JSONRequest(settings){this.settings=extend({},settings);this.count=0}JSONRequest.sendRPC=function(o){return(new JSONRequest).send(o)};JSONRequest.prototype={send:function(args){var ecb=args.error,scb=args.success;args=extend(this.settings,args);args.success=function(c,x){c=JSON.parse(c);if(typeof c=="undefined"){c={error:"JSON Parse error."}}if(c.error){ecb.call(args.error_scope||args.scope,c.error,x)}else{scb.call(args.success_scope||args.scope,c.result)}};args.error=function(ty,x){if(ecb){ecb.call(args.error_scope||args.scope,ty,x)}};args.data=JSON.serialize({id:args.id||"c"+this.count++,method:args.method,params:args.params});args.content_type="application/json";XHR.send(args)}};return JSONRequest});define("tinymce/util/JSONP",["tinymce/dom/DOMUtils"],function(DOMUtils){return{callbacks:{},count:0,send:function(settings){var self=this,dom=DOMUtils.DOM,count=settings.count!==undefined?settings.count:self.count;var id="tinymce_jsonp_"+count;self.callbacks[count]=function(json){dom.remove(id);delete self.callbacks[count];settings.callback(json)};dom.add(dom.doc.body,"script",{id:id,src:settings.url,type:"text/javascript"});self.count++}}});define("tinymce/util/LocalStorage",[],function(){var LocalStorage,storageElm,items,keys,userDataKey,hasOldIEDataSupport;try{if(window.localStorage){return localStorage}}catch(ex){}userDataKey="tinymce";storageElm=document.documentElement;hasOldIEDataSupport=!!storageElm.addBehavior;if(hasOldIEDataSupport){storageElm.addBehavior("#default#userData")}function updateKeys(){keys=[];for(var key in items){keys.push(key)}LocalStorage.length=keys.length}function load(){var key,data,value,pos=0;items={};if(!hasOldIEDataSupport){return}function next(end){var value,nextPos;nextPos=end!==undefined?pos+end:data.indexOf(",",pos);if(nextPos===-1||nextPos>data.length){return null}value=data.substring(pos,nextPos);pos=nextPos+1;return value}storageElm.load(userDataKey);data=storageElm.getAttribute(userDataKey)||"";do{var offset=next();if(offset===null){break}key=next(parseInt(offset,32)||0);if(key!==null){offset=next();if(offset===null){break}value=next(parseInt(offset,32)||0);if(key){items[key]=value}}}while(key!==null);updateKeys()}function save(){var value,data="";if(!hasOldIEDataSupport){return}for(var key in items){value=items[key];data+=(data?",":"")+key.length.toString(32)+","+key+","+value.length.toString(32)+","+value}storageElm.setAttribute(userDataKey,data);try{storageElm.save(userDataKey)}catch(ex){}updateKeys()}LocalStorage={key:function(index){return keys[index]},getItem:function(key){return key in items?items[key]:null},setItem:function(key,value){items[key]=""+value;save()},removeItem:function(key){delete items[key];save()},clear:function(){items={};save()}};load();return LocalStorage});define("tinymce/Compat",["tinymce/dom/DOMUtils","tinymce/dom/EventUtils","tinymce/dom/ScriptLoader","tinymce/AddOnManager","tinymce/util/Tools","tinymce/Env"],function(DOMUtils,EventUtils,ScriptLoader,AddOnManager,Tools,Env){var tinymce=window.tinymce;tinymce.DOM=DOMUtils.DOM;tinymce.ScriptLoader=ScriptLoader.ScriptLoader;tinymce.PluginManager=AddOnManager.PluginManager;tinymce.ThemeManager=AddOnManager.ThemeManager;tinymce.dom=tinymce.dom||{};tinymce.dom.Event=EventUtils.Event;Tools.each(Tools,function(func,key){tinymce[key]=func});Tools.each("isOpera isWebKit isIE isGecko isMac".split(" "),function(name){tinymce[name]=Env[name.substr(2).toLowerCase()]});return{}});define("tinymce/ui/Layout",["tinymce/util/Class","tinymce/util/Tools"],function(Class,Tools){"use strict";return Class.extend({Defaults:{firstControlClass:"first",lastControlClass:"last"},init:function(settings){this.settings=Tools.extend({},this.Defaults,settings)},preRender:function(container){container.bodyClasses.add(this.settings.containerClass)},applyClasses:function(items){var self=this,settings=self.settings,firstClass,lastClass,firstItem,lastItem;firstClass=settings.firstControlClass;lastClass=settings.lastControlClass;items.each(function(item){item.classes.remove(firstClass).remove(lastClass).add(settings.controlClass);if(item.visible()){if(!firstItem){firstItem=item}lastItem=item}});if(firstItem){firstItem.classes.add(firstClass)}if(lastItem){lastItem.classes.add(lastClass)}},renderHtml:function(container){var self=this,html="";self.applyClasses(container.items());container.items().each(function(item){html+=item.renderHtml()});return html},recalc:function(){},postRender:function(){},isNative:function(){return false}})});define("tinymce/ui/AbsoluteLayout",["tinymce/ui/Layout"],function(Layout){"use strict";return Layout.extend({Defaults:{containerClass:"abs-layout",controlClass:"abs-layout-item"},recalc:function(container){container.items().filter(":visible").each(function(ctrl){var settings=ctrl.settings;ctrl.layoutRect({x:settings.x,y:settings.y,w:settings.w,h:settings.h});if(ctrl.recalc){ctrl.recalc()}})},renderHtml:function(container){return'<div id="'+container._id+'-absend" class="'+container.classPrefix+'abs-end"></div>'+this._super(container)}})});define("tinymce/ui/Button",["tinymce/ui/Widget"],function(Widget){"use strict";return Widget.extend({Defaults:{classes:"widget btn",role:"button"},init:function(settings){var self=this,size;self._super(settings);settings=self.settings;size=self.settings.size;self.on("click mousedown",function(e){e.preventDefault()});self.on("touchstart",function(e){self.fire("click",e);e.preventDefault()});if(settings.subtype){self.classes.add(settings.subtype)}if(size){self.classes.add("btn-"+size)}if(settings.icon){self.icon(settings.icon)}},icon:function(icon){if(!arguments.length){return this.state.get("icon")}this.state.set("icon",icon);return this},repaint:function(){var btnElm=this.getEl().firstChild,btnStyle;if(btnElm){btnStyle=btnElm.style;btnStyle.width=btnStyle.height="100%"}this._super()},renderHtml:function(){var self=this,id=self._id,prefix=self.classPrefix;var icon=self.state.get("icon"),image,text=self.state.get("text"),textHtml="";image=self.settings.image;if(image){icon="none";if(typeof image!="string"){image=window.getSelection?image[0]:image[1]}image=" style=\"background-image: url('"+image+"')\""}else{image=""}if(text){self.classes.add("btn-has-text");textHtml='<span class="'+prefix+'txt">'+self.encode(text)+"</span>"}icon=self.settings.icon?prefix+"ico "+prefix+"i-"+icon:"";return'<div id="'+id+'" class="'+self.classes+'" tabindex="-1" aria-labelledby="'+id+'">'+'<button role="presentation" type="button" tabindex="-1">'+(icon?'<i class="'+icon+'"'+image+"></i>":"")+textHtml+"</button>"+"</div>"},bindStates:function(){var self=this,$=self.$,textCls=self.classPrefix+"txt";function setButtonText(text){var $span=$("span."+textCls,self.getEl());if(text){if(!$span[0]){$("button:first",self.getEl()).append('<span class="'+textCls+'"></span>');$span=$("span."+textCls,self.getEl())}$span.html(self.encode(text))}else{$span.remove()}self.classes.toggle("btn-has-text",!!text)}self.state.on("change:text",function(e){setButtonText(e.value)});self.state.on("change:icon",function(e){var icon=e.value,prefix=self.classPrefix;self.settings.icon=icon;icon=icon?prefix+"ico "+prefix+"i-"+self.settings.icon:"";var btnElm=self.getEl().firstChild,iconElm=btnElm.getElementsByTagName("i")[0];if(icon){if(!iconElm||iconElm!=btnElm.firstChild){iconElm=document.createElement("i");btnElm.insertBefore(iconElm,btnElm.firstChild)}iconElm.className=icon}else if(iconElm){btnElm.removeChild(iconElm)}setButtonText(self.state.get("text"))});return self._super()}})});define("tinymce/ui/ButtonGroup",["tinymce/ui/Container"],function(Container){"use strict";return Container.extend({Defaults:{defaultType:"button",role:"group"},renderHtml:function(){var self=this,layout=self._layout;self.classes.add("btn-group");self.preRender();layout.preRender(self);return'<div id="'+self._id+'" class="'+self.classes+'">'+'<div id="'+self._id+'-body">'+(self.settings.html||"")+layout.renderHtml(self)+"</div>"+"</div>"}})});define("tinymce/ui/Checkbox",["tinymce/ui/Widget"],function(Widget){"use strict";return Widget.extend({Defaults:{classes:"checkbox",role:"checkbox",checked:false},init:function(settings){var self=this;self._super(settings);self.on("click mousedown",function(e){e.preventDefault()});self.on("click",function(e){e.preventDefault();if(!self.disabled()){self.checked(!self.checked())}});self.checked(self.settings.checked)},checked:function(state){if(!arguments.length){return this.state.get("checked")}this.state.set("checked",state);return this},value:function(state){if(!arguments.length){return this.checked()}return this.checked(state)},renderHtml:function(){var self=this,id=self._id,prefix=self.classPrefix;return'<div id="'+id+'" class="'+self.classes+'" unselectable="on" aria-labelledby="'+id+'-al" tabindex="-1">'+'<i class="'+prefix+"ico "+prefix+'i-checkbox"></i>'+'<span id="'+id+'-al" class="'+prefix+'label">'+self.encode(self.state.get("text"))+"</span>"+"</div>"},bindStates:function(){var self=this;function checked(state){self.classes.toggle("checked",state);self.aria("checked",state)}self.state.on("change:text",function(e){self.getEl("al").firstChild.data=self.translate(e.value)});self.state.on("change:checked change:value",function(e){self.fire("change");checked(e.value)});self.state.on("change:icon",function(e){var icon=e.value,prefix=self.classPrefix;if(typeof icon=="undefined"){return self.settings.icon}self.settings.icon=icon;icon=icon?prefix+"ico "+prefix+"i-"+self.settings.icon:"";var btnElm=self.getEl().firstChild,iconElm=btnElm.getElementsByTagName("i")[0];if(icon){if(!iconElm||iconElm!=btnElm.firstChild){iconElm=document.createElement("i");btnElm.insertBefore(iconElm,btnElm.firstChild)}iconElm.className=icon}else if(iconElm){btnElm.removeChild(iconElm)}});if(self.state.get("checked")){checked(true)}return self._super()}})});define("tinymce/ui/ComboBox",["tinymce/ui/Widget","tinymce/ui/Factory","tinymce/ui/DomUtils","tinymce/dom/DomQuery"],function(Widget,Factory,DomUtils,$){"use strict";return Widget.extend({init:function(settings){var self=this;self._super(settings);settings=self.settings;self.classes.add("combobox");self.subinput=true;self.ariaTarget="inp";settings.menu=settings.menu||settings.values;if(settings.menu){settings.icon="caret"}self.on("click",function(e){var elm=e.target,root=self.getEl();if(!$.contains(root,elm)&&elm!=root){return}while(elm&&elm!=root){if(elm.id&&elm.id.indexOf("-open")!=-1){self.fire("action");if(settings.menu){self.showMenu();if(e.aria){self.menu.items()[0].focus()}}}elm=elm.parentNode}});self.on("keydown",function(e){if(e.target.nodeName=="INPUT"&&e.keyCode==13){self.parents().reverse().each(function(ctrl){var stateValue=self.state.get("value"),inputValue=self.getEl("inp").value;e.preventDefault();self.state.set("value",inputValue);if(stateValue!=inputValue){self.fire("change")}if(ctrl.hasEventListeners("submit")&&ctrl.toJSON){ctrl.fire("submit",{data:ctrl.toJSON()});return false}})}});self.on("keyup",function(e){if(e.target.nodeName=="INPUT"){self.state.set("value",e.target.value)}})},showMenu:function(){var self=this,settings=self.settings,menu;if(!self.menu){menu=settings.menu||[];if(menu.length){menu={type:"menu",items:menu}}else{menu.type=menu.type||"menu"}self.menu=Factory.create(menu).parent(self).renderTo(self.getContainerElm());self.fire("createmenu");self.menu.reflow();self.menu.on("cancel",function(e){if(e.control===self.menu){self.focus()}});self.menu.on("show hide",function(e){e.control.items().each(function(ctrl){ctrl.active(ctrl.value()==self.value())})}).fire("show");self.menu.on("select",function(e){self.value(e.control.value())});self.on("focusin",function(e){if(e.target.tagName.toUpperCase()=="INPUT"){self.menu.hide()}});self.aria("expanded",true)}self.menu.show();self.menu.layoutRect({w:self.layoutRect().w});self.menu.moveRel(self.getEl(),self.isRtl()?["br-tr","tr-br"]:["bl-tl","tl-bl"])},focus:function(){this.getEl("inp").focus()},repaint:function(){var self=this,elm=self.getEl(),openElm=self.getEl("open"),rect=self.layoutRect();var width,lineHeight;if(openElm){width=rect.w-DomUtils.getSize(openElm).width-10}else{width=rect.w-10}var doc=document;if(doc.all&&(!doc.documentMode||doc.documentMode<=8)){lineHeight=self.layoutRect().h-2+"px"}$(elm.firstChild).css({width:width,lineHeight:lineHeight});self._super();return self},postRender:function(){var self=this;$(this.getEl("inp")).on("change",function(e){self.state.set("value",e.target.value);self.fire("change",e)});return self._super()},renderHtml:function(){var self=this,id=self._id,settings=self.settings,prefix=self.classPrefix;var value=self.state.get("value")||"";var icon,text,openBtnHtml="",extraAttrs="";if("spellcheck"in settings){extraAttrs+=' spellcheck="'+settings.spellcheck+'"'}if(settings.maxLength){extraAttrs+=' maxlength="'+settings.maxLength+'"'}if(settings.size){extraAttrs+=' size="'+settings.size+'"'}if(settings.subtype){extraAttrs+=' type="'+settings.subtype+'"'}if(self.disabled()){extraAttrs+=' disabled="disabled"'}icon=settings.icon;if(icon&&icon!="caret"){icon=prefix+"ico "+prefix+"i-"+settings.icon}text=self.state.get("text");if(icon||text){openBtnHtml='<div id="'+id+'-open" class="'+prefix+"btn "+prefix+'open" tabIndex="-1" role="button">'+'<button id="'+id+'-action" type="button" hidefocus="1" tabindex="-1">'+(icon!="caret"?'<i class="'+icon+'"></i>':'<i class="'+prefix+'caret"></i>')+(text?(icon?" ":"")+text:"")+"</button>"+"</div>";self.classes.add("has-open")}return'<div id="'+id+'" class="'+self.classes+'">'+'<input id="'+id+'-inp" class="'+prefix+'textbox" value="'+self.encode(value,false)+'" hidefocus="1"'+extraAttrs+' placeholder="'+self.encode(settings.placeholder)+'" />'+openBtnHtml+"</div>"},value:function(value){if(arguments.length){this.state.set("value",value);return this}if(this.state.get("rendered")){this.state.set("value",this.getEl("inp").value)}return this.state.get("value")},bindStates:function(){var self=this;self.state.on("change:value",function(e){if(self.getEl("inp").value!=e.value){self.getEl("inp").value=e.value}});self.state.on("change:disabled",function(e){self.getEl("inp").disabled=e.value});return self._super()},remove:function(){$(this.getEl("inp")).off();this._super()}})});define("tinymce/ui/ColorBox",["tinymce/ui/ComboBox"],function(ComboBox){"use strict";return ComboBox.extend({init:function(settings){var self=this;settings.spellcheck=false;
if(settings.onaction){settings.icon="none"}self._super(settings);self.classes.add("colorbox");self.on("change keyup postrender",function(){self.repaintColor(self.value())})},repaintColor:function(value){var elm=this.getEl().getElementsByTagName("i")[0];if(elm){try{elm.style.background=value}catch(ex){}}},bindStates:function(){var self=this;self.state.on("change:value",function(e){if(self.state.get("rendered")){self.repaintColor(e.value)}});return self._super()}})});define("tinymce/ui/PanelButton",["tinymce/ui/Button","tinymce/ui/FloatPanel"],function(Button,FloatPanel){"use strict";return Button.extend({showPanel:function(){var self=this,settings=self.settings;self.active(true);if(!self.panel){var panelSettings=settings.panel;if(panelSettings.type){panelSettings={layout:"grid",items:panelSettings}}panelSettings.role=panelSettings.role||"dialog";panelSettings.popover=true;panelSettings.autohide=true;panelSettings.ariaRoot=true;self.panel=new FloatPanel(panelSettings).on("hide",function(){self.active(false)}).on("cancel",function(e){e.stopPropagation();self.focus();self.hidePanel()}).parent(self).renderTo(self.getContainerElm());self.panel.fire("show");self.panel.reflow()}else{self.panel.show()}self.panel.moveRel(self.getEl(),settings.popoverAlign||(self.isRtl()?["bc-tr","bc-tc"]:["bc-tl","bc-tc"]))},hidePanel:function(){var self=this;if(self.panel){self.panel.hide()}},postRender:function(){var self=this;self.aria("haspopup",true);self.on("click",function(e){if(e.control===self){if(self.panel&&self.panel.visible()){self.hidePanel()}else{self.showPanel();self.panel.focus(!!e.aria)}}});return self._super()},remove:function(){if(this.panel){this.panel.remove();this.panel=null}return this._super()}})});define("tinymce/ui/ColorButton",["tinymce/ui/PanelButton","tinymce/dom/DOMUtils"],function(PanelButton,DomUtils){"use strict";var DOM=DomUtils.DOM;return PanelButton.extend({init:function(settings){this._super(settings);this.classes.add("colorbutton")},color:function(color){if(color){this._color=color;this.getEl("preview").style.backgroundColor=color;return this}return this._color},resetColor:function(){this._color=null;this.getEl("preview").style.backgroundColor=null;return this},renderHtml:function(){var self=this,id=self._id,prefix=self.classPrefix,text=self.state.get("text");var icon=self.settings.icon?prefix+"ico "+prefix+"i-"+self.settings.icon:"";var image=self.settings.image?" style=\"background-image: url('"+self.settings.image+"')\"":"",textHtml="";if(text){self.classes.add("btn-has-text");textHtml='<span class="'+prefix+'txt">'+self.encode(text)+"</span>"}return'<div id="'+id+'" class="'+self.classes+'" role="button" tabindex="-1" aria-haspopup="true">'+'<button role="presentation" hidefocus="1" type="button" tabindex="-1">'+(icon?'<i class="'+icon+'"'+image+"></i>":"")+'<span id="'+id+'-preview" class="'+prefix+'preview"></span>'+textHtml+"</button>"+'<button type="button" class="'+prefix+'open" hidefocus="1" tabindex="-1">'+' <i class="'+prefix+'caret"></i>'+"</button>"+"</div>"},postRender:function(){var self=this,onClickHandler=self.settings.onclick;self.on("click",function(e){if(e.aria&&e.aria.key=="down"){return}if(e.control==self&&!DOM.getParent(e.target,"."+self.classPrefix+"open")){e.stopImmediatePropagation();onClickHandler.call(self,e)}});delete self.settings.onclick;return self._super()}})});define("tinymce/util/Color",[],function(){var min=Math.min,max=Math.max,round=Math.round;function Color(value){var self=this,r=0,g=0,b=0;function rgb2hsv(r,g,b){var h,s,v,d,minRGB,maxRGB;h=0;s=0;v=0;r=r/255;g=g/255;b=b/255;minRGB=min(r,min(g,b));maxRGB=max(r,max(g,b));if(minRGB==maxRGB){v=minRGB;return{h:0,s:0,v:v*100}}d=r==minRGB?g-b:b==minRGB?r-g:b-r;h=r==minRGB?3:b==minRGB?1:5;h=60*(h-d/(maxRGB-minRGB));s=(maxRGB-minRGB)/maxRGB;v=maxRGB;return{h:round(h),s:round(s*100),v:round(v*100)}}function hsvToRgb(hue,saturation,brightness){var side,chroma,x,match;hue=(parseInt(hue,10)||0)%360;saturation=parseInt(saturation,10)/100;brightness=parseInt(brightness,10)/100;saturation=max(0,min(saturation,1));brightness=max(0,min(brightness,1));if(saturation===0){r=g=b=round(255*brightness);return}side=hue/60;chroma=brightness*saturation;x=chroma*(1-Math.abs(side%2-1));match=brightness-chroma;switch(Math.floor(side)){case 0:r=chroma;g=x;b=0;break;case 1:r=x;g=chroma;b=0;break;case 2:r=0;g=chroma;b=x;break;case 3:r=0;g=x;b=chroma;break;case 4:r=x;g=0;b=chroma;break;case 5:r=chroma;g=0;b=x;break;default:r=g=b=0}r=round(255*(r+match));g=round(255*(g+match));b=round(255*(b+match))}function toHex(){function hex(val){val=parseInt(val,10).toString(16);return val.length>1?val:"0"+val}return"#"+hex(r)+hex(g)+hex(b)}function toRgb(){return{r:r,g:g,b:b}}function toHsv(){return rgb2hsv(r,g,b)}function parse(value){var matches;if(typeof value=="object"){if("r"in value){r=value.r;g=value.g;b=value.b}else if("v"in value){hsvToRgb(value.h,value.s,value.v)}}else{if(matches=/rgb\s*\(\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)[^\)]*\)/gi.exec(value)){r=parseInt(matches[1],10);g=parseInt(matches[2],10);b=parseInt(matches[3],10)}else if(matches=/#([0-F]{2})([0-F]{2})([0-F]{2})/gi.exec(value)){r=parseInt(matches[1],16);g=parseInt(matches[2],16);b=parseInt(matches[3],16)}else if(matches=/#([0-F])([0-F])([0-F])/gi.exec(value)){r=parseInt(matches[1]+matches[1],16);g=parseInt(matches[2]+matches[2],16);b=parseInt(matches[3]+matches[3],16)}}r=r<0?0:r>255?255:r;g=g<0?0:g>255?255:g;b=b<0?0:b>255?255:b;return self}if(value){parse(value)}self.toRgb=toRgb;self.toHsv=toHsv;self.toHex=toHex;self.parse=parse}return Color});define("tinymce/ui/ColorPicker",["tinymce/ui/Widget","tinymce/ui/DragHelper","tinymce/ui/DomUtils","tinymce/util/Color"],function(Widget,DragHelper,DomUtils,Color){"use strict";return Widget.extend({Defaults:{classes:"widget colorpicker"},init:function(settings){this._super(settings)},postRender:function(){var self=this,color=self.color(),hsv,hueRootElm,huePointElm,svRootElm,svPointElm;hueRootElm=self.getEl("h");huePointElm=self.getEl("hp");svRootElm=self.getEl("sv");svPointElm=self.getEl("svp");function getPos(elm,event){var pos=DomUtils.getPos(elm),x,y;x=event.pageX-pos.x;y=event.pageY-pos.y;x=Math.max(0,Math.min(x/elm.clientWidth,1));y=Math.max(0,Math.min(y/elm.clientHeight,1));return{x:x,y:y}}function updateColor(hsv,hueUpdate){var hue=(360-hsv.h)/360;DomUtils.css(huePointElm,{top:hue*100+"%"});if(!hueUpdate){DomUtils.css(svPointElm,{left:hsv.s+"%",top:100-hsv.v+"%"})}svRootElm.style.background=new Color({s:100,v:100,h:hsv.h}).toHex();self.color().parse({s:hsv.s,v:hsv.v,h:hsv.h})}function updateSaturationAndValue(e){var pos;pos=getPos(svRootElm,e);hsv.s=pos.x*100;hsv.v=(1-pos.y)*100;updateColor(hsv);self.fire("change")}function updateHue(e){var pos;pos=getPos(hueRootElm,e);hsv=color.toHsv();hsv.h=(1-pos.y)*360;updateColor(hsv,true);self.fire("change")}self._repaint=function(){hsv=color.toHsv();updateColor(hsv)};self._super();self._svdraghelper=new DragHelper(self._id+"-sv",{start:updateSaturationAndValue,drag:updateSaturationAndValue});self._hdraghelper=new DragHelper(self._id+"-h",{start:updateHue,drag:updateHue});self._repaint()},rgb:function(){return this.color().toRgb()},value:function(value){var self=this;if(arguments.length){self.color().parse(value);if(self._rendered){self._repaint()}}else{return self.color().toHex()}},color:function(){if(!this._color){this._color=new Color}return this._color},renderHtml:function(){var self=this,id=self._id,prefix=self.classPrefix,hueHtml;var stops="#ff0000,#ff0080,#ff00ff,#8000ff,#0000ff,#0080ff,#00ffff,#00ff80,#00ff00,#80ff00,#ffff00,#ff8000,#ff0000";function getOldIeFallbackHtml(){var i,l,html="",gradientPrefix,stopsList;gradientPrefix="filter:progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr=";stopsList=stops.split(",");for(i=0,l=stopsList.length-1;i<l;i++){html+='<div class="'+prefix+'colorpicker-h-chunk" style="'+"height:"+100/l+"%;"+gradientPrefix+stopsList[i]+",endColorstr="+stopsList[i+1]+");"+"-ms-"+gradientPrefix+stopsList[i]+",endColorstr="+stopsList[i+1]+")"+'"></div>'}return html}var gradientCssText="background: -ms-linear-gradient(top,"+stops+");"+"background: linear-gradient(to bottom,"+stops+");";hueHtml='<div id="'+id+'-h" class="'+prefix+'colorpicker-h" style="'+gradientCssText+'">'+getOldIeFallbackHtml()+'<div id="'+id+'-hp" class="'+prefix+'colorpicker-h-marker"></div>'+"</div>";return'<div id="'+id+'" class="'+self.classes+'">'+'<div id="'+id+'-sv" class="'+prefix+'colorpicker-sv">'+'<div class="'+prefix+'colorpicker-overlay1">'+'<div class="'+prefix+'colorpicker-overlay2">'+'<div id="'+id+'-svp" class="'+prefix+'colorpicker-selector1">'+'<div class="'+prefix+'colorpicker-selector2"></div>'+"</div>"+"</div>"+"</div>"+"</div>"+hueHtml+"</div>"}})});define("tinymce/ui/Path",["tinymce/ui/Widget"],function(Widget){"use strict";return Widget.extend({init:function(settings){var self=this;if(!settings.delimiter){settings.delimiter=""}self._super(settings);self.classes.add("path");self.canFocus=true;self.on("click",function(e){var index,target=e.target;if(index=target.getAttribute("data-index")){self.fire("select",{value:self.row()[index],index:index})}});self.row(self.settings.row)},focus:function(){var self=this;self.getEl().firstChild.focus();return self},row:function(row){if(!arguments.length){return this.state.get("row")}this.state.set("row",row);return this},renderHtml:function(){var self=this;return'<div id="'+self._id+'" class="'+self.classes+'">'+self._getDataPathHtml(self.state.get("row"))+"</div>"},bindStates:function(){var self=this;self.state.on("change:row",function(e){self.innerHtml(self._getDataPathHtml(e.value))});return self._super()},_getDataPathHtml:function(data){var self=this,parts=data||[],i,l,html="",prefix=self.classPrefix;for(i=0,l=parts.length;i<l;i++){html+=(i>0?'<div class="'+prefix+'divider" aria-hidden="true"> '+self.settings.delimiter+" </div>":"")+'<div role="button" class="'+prefix+"path-item"+(i==l-1?" "+prefix+"last":"")+'" data-index="'+i+'" tabindex="-1" id="'+self._id+"-"+i+'" aria-level="'+i+'">'+parts[i].name+"</div>"}if(!html){html='<div class="'+prefix+'path-item"></div>'}return html}})});define("tinymce/ui/ElementPath",["tinymce/ui/Path","tinymce/EditorManager"],function(Path,EditorManager){return Path.extend({postRender:function(){var self=this,editor=EditorManager.activeEditor;function isHidden(elm){if(elm.nodeType===1){if(elm.nodeName=="BR"||!!elm.getAttribute("data-mce-bogus")){return true}if(elm.getAttribute("data-mce-type")==="bookmark"){return true}}return false}if(editor.settings.elementpath!==false){self.on("select",function(e){editor.focus();editor.selection.select(this.row()[e.index].element);editor.nodeChanged()});editor.on("nodeChange",function(e){var outParents=[],parents=e.parents,i=parents.length;while(i--){if(parents[i].nodeType==1&&!isHidden(parents[i])){var args=editor.fire("ResolveName",{name:parents[i].nodeName.toLowerCase(),target:parents[i]});if(!args.isDefaultPrevented()){outParents.push({name:args.name,element:parents[i]})}if(args.isPropagationStopped()){break}}}self.row(outParents)})}return self._super()}})});define("tinymce/ui/FormItem",["tinymce/ui/Container"],function(Container){"use strict";return Container.extend({Defaults:{layout:"flex",align:"center",defaults:{flex:1}},renderHtml:function(){var self=this,layout=self._layout,prefix=self.classPrefix;self.classes.add("formitem");layout.preRender(self);return'<div id="'+self._id+'" class="'+self.classes+'" hidefocus="1" tabindex="-1">'+(self.settings.title?'<div id="'+self._id+'-title" class="'+prefix+'title">'+self.settings.title+"</div>":"")+'<div id="'+self._id+'-body" class="'+self.bodyClasses+'">'+(self.settings.html||"")+layout.renderHtml(self)+"</div>"+"</div>"}})});define("tinymce/ui/Form",["tinymce/ui/Container","tinymce/ui/FormItem","tinymce/util/Tools"],function(Container,FormItem,Tools){"use strict";return Container.extend({Defaults:{containerCls:"form",layout:"flex",direction:"column",align:"stretch",flex:1,padding:20,labelGap:30,spacing:10,callbacks:{submit:function(){this.submit()}}},preRender:function(){var self=this,items=self.items();if(!self.settings.formItemDefaults){self.settings.formItemDefaults={layout:"flex",autoResize:"overflow",defaults:{flex:1}}}items.each(function(ctrl){var formItem,label=ctrl.settings.label;if(label){formItem=new FormItem(Tools.extend({items:{type:"label",id:ctrl._id+"-l",text:label,flex:0,forId:ctrl._id,disabled:ctrl.disabled()}},self.settings.formItemDefaults));formItem.type="formitem";ctrl.aria("labelledby",ctrl._id+"-l");if(typeof ctrl.settings.flex=="undefined"){ctrl.settings.flex=1}self.replace(ctrl,formItem);formItem.add(ctrl)}})},submit:function(){return this.fire("submit",{data:this.toJSON()})},postRender:function(){var self=this;self._super();self.fromJSON(self.settings.data)},bindStates:function(){var self=this;self._super();function recalcLabels(){var maxLabelWidth=0,labels=[],i,labelGap,items;if(self.settings.labelGapCalc===false){return}if(self.settings.labelGapCalc=="children"){items=self.find("formitem")}else{items=self.items()}items.filter("formitem").each(function(item){var labelCtrl=item.items()[0],labelWidth=labelCtrl.getEl().clientWidth;maxLabelWidth=labelWidth>maxLabelWidth?labelWidth:maxLabelWidth;labels.push(labelCtrl)});labelGap=self.settings.labelGap||0;i=labels.length;while(i--){labels[i].settings.minWidth=maxLabelWidth+labelGap}}self.on("show",recalcLabels);recalcLabels()}})});define("tinymce/ui/FieldSet",["tinymce/ui/Form"],function(Form){"use strict";return Form.extend({Defaults:{containerCls:"fieldset",layout:"flex",direction:"column",align:"stretch",flex:1,padding:"25 15 5 15",labelGap:30,spacing:10,border:1},renderHtml:function(){var self=this,layout=self._layout,prefix=self.classPrefix;self.preRender();layout.preRender(self);return'<fieldset id="'+self._id+'" class="'+self.classes+'" hidefocus="1" tabindex="-1">'+(self.settings.title?'<legend id="'+self._id+'-title" class="'+prefix+'fieldset-title">'+self.settings.title+"</legend>":"")+'<div id="'+self._id+'-body" class="'+self.bodyClasses+'">'+(self.settings.html||"")+layout.renderHtml(self)+"</div>"+"</fieldset>"}})});define("tinymce/ui/FilePicker",["tinymce/ui/ComboBox","tinymce/util/Tools"],function(ComboBox,Tools){"use strict";return ComboBox.extend({init:function(settings){var self=this,editor=tinymce.activeEditor,editorSettings=editor.settings;var actionCallback,fileBrowserCallback,fileBrowserCallbackTypes;settings.spellcheck=false;fileBrowserCallbackTypes=editorSettings.file_picker_types||editorSettings.file_browser_callback_types;if(fileBrowserCallbackTypes){fileBrowserCallbackTypes=Tools.makeMap(fileBrowserCallbackTypes,/[, ]/)}if(!fileBrowserCallbackTypes||fileBrowserCallbackTypes[settings.filetype]){fileBrowserCallback=editorSettings.file_picker_callback;if(fileBrowserCallback&&(!fileBrowserCallbackTypes||fileBrowserCallbackTypes[settings.filetype])){actionCallback=function(){var meta=self.fire("beforecall").meta;meta=Tools.extend({filetype:settings.filetype},meta);fileBrowserCallback.call(editor,function(value,meta){self.value(value).fire("change",{meta:meta})},self.value(),meta)}}else{fileBrowserCallback=editorSettings.file_browser_callback;if(fileBrowserCallback&&(!fileBrowserCallbackTypes||fileBrowserCallbackTypes[settings.filetype])){actionCallback=function(){fileBrowserCallback(self.getEl("inp").id,self.value(),settings.filetype,window)}}}}if(actionCallback){settings.icon="browse";settings.onaction=actionCallback}self._super(settings)}})});define("tinymce/ui/FitLayout",["tinymce/ui/AbsoluteLayout"],function(AbsoluteLayout){"use strict";return AbsoluteLayout.extend({recalc:function(container){var contLayoutRect=container.layoutRect(),paddingBox=container.paddingBox;container.items().filter(":visible").each(function(ctrl){ctrl.layoutRect({x:paddingBox.left,y:paddingBox.top,w:contLayoutRect.innerW-paddingBox.right-paddingBox.left,h:contLayoutRect.innerH-paddingBox.top-paddingBox.bottom});if(ctrl.recalc){ctrl.recalc()}})}})});define("tinymce/ui/FlexLayout",["tinymce/ui/AbsoluteLayout"],function(AbsoluteLayout){"use strict";return AbsoluteLayout.extend({recalc:function(container){var i,l,items,contLayoutRect,contPaddingBox,contSettings,align,pack,spacing,totalFlex,availableSpace,direction;var ctrl,ctrlLayoutRect,ctrlSettings,flex,maxSizeItems=[],size,maxSize,ratio,rect,pos,maxAlignEndPos;var sizeName,minSizeName,posName,maxSizeName,beforeName,innerSizeName,deltaSizeName,contentSizeName;var alignAxisName,alignInnerSizeName,alignSizeName,alignMinSizeName,alignBeforeName,alignAfterName;var alignDeltaSizeName,alignContentSizeName;var max=Math.max,min=Math.min;items=container.items().filter(":visible");contLayoutRect=container.layoutRect();contPaddingBox=container.paddingBox;contSettings=container.settings;direction=container.isRtl()?contSettings.direction||"row-reversed":contSettings.direction;align=contSettings.align;pack=container.isRtl()?contSettings.pack||"end":contSettings.pack;spacing=contSettings.spacing||0;if(direction=="row-reversed"||direction=="column-reverse"){items=items.set(items.toArray().reverse());direction=direction.split("-")[0]}if(direction=="column"){posName="y";sizeName="h";minSizeName="minH";maxSizeName="maxH";innerSizeName="innerH";beforeName="top";deltaSizeName="deltaH";contentSizeName="contentH";alignBeforeName="left";alignSizeName="w";alignAxisName="x";alignInnerSizeName="innerW";alignMinSizeName="minW";alignAfterName="right";alignDeltaSizeName="deltaW";alignContentSizeName="contentW"}else{posName="x";sizeName="w";minSizeName="minW";maxSizeName="maxW";innerSizeName="innerW";beforeName="left";deltaSizeName="deltaW";contentSizeName="contentW";alignBeforeName="top";alignSizeName="h";alignAxisName="y";alignInnerSizeName="innerH";alignMinSizeName="minH";alignAfterName="bottom";alignDeltaSizeName="deltaH";alignContentSizeName="contentH"}availableSpace=contLayoutRect[innerSizeName]-contPaddingBox[beforeName]-contPaddingBox[beforeName];maxAlignEndPos=totalFlex=0;for(i=0,l=items.length;i<l;i++){ctrl=items[i];ctrlLayoutRect=ctrl.layoutRect();ctrlSettings=ctrl.settings;flex=ctrlSettings.flex;availableSpace-=i<l-1?spacing:0;if(flex>0){totalFlex+=flex;if(ctrlLayoutRect[maxSizeName]){maxSizeItems.push(ctrl)}ctrlLayoutRect.flex=flex}availableSpace-=ctrlLayoutRect[minSizeName];size=contPaddingBox[alignBeforeName]+ctrlLayoutRect[alignMinSizeName]+contPaddingBox[alignAfterName];if(size>maxAlignEndPos){maxAlignEndPos=size}}rect={};if(availableSpace<0){rect[minSizeName]=contLayoutRect[minSizeName]-availableSpace+contLayoutRect[deltaSizeName]}else{rect[minSizeName]=contLayoutRect[innerSizeName]-availableSpace+contLayoutRect[deltaSizeName]}rect[alignMinSizeName]=maxAlignEndPos+contLayoutRect[alignDeltaSizeName];rect[contentSizeName]=contLayoutRect[innerSizeName]-availableSpace;rect[alignContentSizeName]=maxAlignEndPos;rect.minW=min(rect.minW,contLayoutRect.maxW);rect.minH=min(rect.minH,contLayoutRect.maxH);rect.minW=max(rect.minW,contLayoutRect.startMinWidth);rect.minH=max(rect.minH,contLayoutRect.startMinHeight);if(contLayoutRect.autoResize&&(rect.minW!=contLayoutRect.minW||rect.minH!=contLayoutRect.minH)){rect.w=rect.minW;rect.h=rect.minH;container.layoutRect(rect);this.recalc(container);if(container._lastRect===null){var parentCtrl=container.parent();if(parentCtrl){parentCtrl._lastRect=null;parentCtrl.recalc()}}return}ratio=availableSpace/totalFlex;for(i=0,l=maxSizeItems.length;i<l;i++){ctrl=maxSizeItems[i];ctrlLayoutRect=ctrl.layoutRect();maxSize=ctrlLayoutRect[maxSizeName];size=ctrlLayoutRect[minSizeName]+ctrlLayoutRect.flex*ratio;if(size>maxSize){availableSpace-=ctrlLayoutRect[maxSizeName]-ctrlLayoutRect[minSizeName];totalFlex-=ctrlLayoutRect.flex;ctrlLayoutRect.flex=0;ctrlLayoutRect.maxFlexSize=maxSize}else{ctrlLayoutRect.maxFlexSize=0}}ratio=availableSpace/totalFlex;pos=contPaddingBox[beforeName];rect={};if(totalFlex===0){if(pack=="end"){pos=availableSpace+contPaddingBox[beforeName]}else if(pack=="center"){pos=Math.round(contLayoutRect[innerSizeName]/2-(contLayoutRect[innerSizeName]-availableSpace)/2)+contPaddingBox[beforeName];if(pos<0){pos=contPaddingBox[beforeName]}}else if(pack=="justify"){pos=contPaddingBox[beforeName];spacing=Math.floor(availableSpace/(items.length-1))}}rect[alignAxisName]=contPaddingBox[alignBeforeName];for(i=0,l=items.length;i<l;i++){ctrl=items[i];ctrlLayoutRect=ctrl.layoutRect();size=ctrlLayoutRect.maxFlexSize||ctrlLayoutRect[minSizeName];if(align==="center"){rect[alignAxisName]=Math.round(contLayoutRect[alignInnerSizeName]/2-ctrlLayoutRect[alignSizeName]/2)}else if(align==="stretch"){rect[alignSizeName]=max(ctrlLayoutRect[alignMinSizeName]||0,contLayoutRect[alignInnerSizeName]-contPaddingBox[alignBeforeName]-contPaddingBox[alignAfterName]);rect[alignAxisName]=contPaddingBox[alignBeforeName]}else if(align==="end"){rect[alignAxisName]=contLayoutRect[alignInnerSizeName]-ctrlLayoutRect[alignSizeName]-contPaddingBox.top}if(ctrlLayoutRect.flex>0){size+=ctrlLayoutRect.flex*ratio}rect[sizeName]=size;rect[posName]=pos;ctrl.layoutRect(rect);if(ctrl.recalc){ctrl.recalc()}pos+=size+spacing}}})});define("tinymce/ui/FlowLayout",["tinymce/ui/Layout"],function(Layout){return Layout.extend({Defaults:{containerClass:"flow-layout",controlClass:"flow-layout-item",endClass:"break"},recalc:function(container){container.items().filter(":visible").each(function(ctrl){if(ctrl.recalc){ctrl.recalc()}})},isNative:function(){return true}})});define("tinymce/ui/FormatControls",["tinymce/ui/Control","tinymce/ui/Widget","tinymce/ui/FloatPanel","tinymce/util/Tools","tinymce/EditorManager","tinymce/Env"],function(Control,Widget,FloatPanel,Tools,EditorManager,Env){var each=Tools.each;EditorManager.on("AddEditor",function(e){if(e.editor.rtl){Control.rtl=true}registerControls(e.editor)});Control.translate=function(text){return EditorManager.translate(text)};Widget.tooltips=!Env.iOS;function registerControls(editor){var formatMenu;function createListBoxChangeHandler(items,formatName){return function(){var self=this;editor.on("nodeChange",function(e){var formatter=editor.formatter;var value=null;each(e.parents,function(node){each(items,function(item){if(formatName){if(formatter.matchNode(node,formatName,{value:item.value})){value=item.value}}else{if(formatter.matchNode(node,item.value)){value=item.value}}if(value){return false}});if(value){return false}});self.value(value)})}}function createFormats(formats){formats=formats.replace(/;$/,"").split(";");var i=formats.length;while(i--){formats[i]=formats[i].split("=")}return formats}function createFormatMenu(){var count=0,newFormats=[];var defaultStyleFormats=[{title:"Headings",items:[{title:"Heading 1",format:"h1"},{title:"Heading 2",format:"h2"},{title:"Heading 3",format:"h3"},{title:"Heading 4",format:"h4"},{title:"Heading 5",format:"h5"},{title:"Heading 6",format:"h6"}]},{title:"Inline",items:[{title:"Bold",icon:"bold",format:"bold"},{title:"Italic",icon:"italic",format:"italic"},{title:"Underline",icon:"underline",format:"underline"},{title:"Strikethrough",icon:"strikethrough",format:"strikethrough"},{title:"Superscript",icon:"superscript",format:"superscript"},{title:"Subscript",icon:"subscript",format:"subscript"},{title:"Code",icon:"code",format:"code"}]},{title:"Blocks",items:[{title:"Paragraph",format:"p"},{title:"Blockquote",format:"blockquote"},{title:"Div",format:"div"},{title:"Pre",format:"pre"}]},{title:"Alignment",items:[{title:"Left",icon:"alignleft",format:"alignleft"},{title:"Center",icon:"aligncenter",format:"aligncenter"},{title:"Right",icon:"alignright",format:"alignright"},{title:"Justify",icon:"alignjustify",format:"alignjustify"}]}];function createMenu(formats){var menu=[];if(!formats){return}each(formats,function(format){var menuItem={text:format.title,icon:format.icon};if(format.items){menuItem.menu=createMenu(format.items)}else{var formatName=format.format||"custom"+count++;if(!format.format){format.name=formatName;newFormats.push(format)}menuItem.format=formatName;menuItem.cmd=format.cmd}menu.push(menuItem)});return menu}function createStylesMenu(){var menu;if(editor.settings.style_formats_merge){if(editor.settings.style_formats){menu=createMenu(defaultStyleFormats.concat(editor.settings.style_formats))}else{menu=createMenu(defaultStyleFormats)}}else{menu=createMenu(editor.settings.style_formats||defaultStyleFormats)}return menu}editor.on("init",function(){each(newFormats,function(format){editor.formatter.register(format.name,format)})});return{type:"menu",items:createStylesMenu(),onPostRender:function(e){editor.fire("renderFormatsMenu",{control:e.control})},itemDefaults:{preview:true,textStyle:function(){if(this.settings.format){return editor.formatter.getCssText(this.settings.format)}},onPostRender:function(){var self=this;self.parent().on("show",function(){var formatName,command;formatName=self.settings.format;if(formatName){self.disabled(!editor.formatter.canApply(formatName));self.active(editor.formatter.match(formatName))}command=self.settings.cmd;if(command){self.active(editor.queryCommandState(command))}})},onclick:function(){if(this.settings.format){toggleFormat(this.settings.format)}if(this.settings.cmd){editor.execCommand(this.settings.cmd)}}}}}formatMenu=createFormatMenu();function initOnPostRender(name){return function(){var self=this;if(editor.formatter){editor.formatter.formatChanged(name,function(state){self.active(state)})}else{editor.on("init",function(){editor.formatter.formatChanged(name,function(state){self.active(state)})})}}}each({bold:"Bold",italic:"Italic",underline:"Underline",strikethrough:"Strikethrough",subscript:"Subscript",superscript:"Superscript"},function(text,name){editor.addButton(name,{tooltip:text,onPostRender:initOnPostRender(name),onclick:function(){toggleFormat(name)}})});each({outdent:["Decrease indent","Outdent"],indent:["Increase indent","Indent"],cut:["Cut","Cut"],copy:["Copy","Copy"],paste:["Paste","Paste"],help:["Help","mceHelp"],selectall:["Select all","SelectAll"],removeformat:["Clear formatting","RemoveFormat"],visualaid:["Visual aids","mceToggleVisualAid"],newdocument:["New document","mceNewDocument"]},function(item,name){editor.addButton(name,{tooltip:item[0],cmd:item[1]})});each({blockquote:["Blockquote","mceBlockQuote"],numlist:["Numbered list","InsertOrderedList"],bullist:["Bullet list","InsertUnorderedList"],subscript:["Subscript","Subscript"],superscript:["Superscript","Superscript"],alignleft:["Align left","JustifyLeft"],aligncenter:["Align center","JustifyCenter"],alignright:["Align right","JustifyRight"],alignjustify:["Justify","JustifyFull"],alignnone:["No alignment","JustifyNone"]},function(item,name){editor.addButton(name,{tooltip:item[0],cmd:item[1],onPostRender:initOnPostRender(name)})});function toggleUndoRedoState(type){return function(){var self=this;type=type=="redo"?"hasRedo":"hasUndo";function checkState(){return editor.undoManager?editor.undoManager[type]():false}self.disabled(!checkState());editor.on("Undo Redo AddUndo TypingUndo ClearUndos SwitchMode",function(){self.disabled(editor.readonly||!checkState())})}}function toggleVisualAidState(){var self=this;editor.on("VisualAid",function(e){self.active(e.hasVisual)});self.active(editor.hasVisual)}editor.addButton("undo",{tooltip:"Undo",onPostRender:toggleUndoRedoState("undo"),cmd:"undo"});editor.addButton("redo",{tooltip:"Redo",onPostRender:toggleUndoRedoState("redo"),cmd:"redo"});editor.addMenuItem("newdocument",{text:"New document",icon:"newdocument",cmd:"mceNewDocument"});editor.addMenuItem("undo",{text:"Undo",icon:"undo",shortcut:"Meta+Z",onPostRender:toggleUndoRedoState("undo"),cmd:"undo"});editor.addMenuItem("redo",{text:"Redo",icon:"redo",shortcut:"Meta+Y",onPostRender:toggleUndoRedoState("redo"),cmd:"redo"});editor.addMenuItem("visualaid",{text:"Visual aids",selectable:true,onPostRender:toggleVisualAidState,cmd:"mceToggleVisualAid"});editor.addButton("remove",{tooltip:"Remove",icon:"remove",cmd:"Delete"});each({cut:["Cut","Cut","Meta+X"],copy:["Copy","Copy","Meta+C"],paste:["Paste","Paste","Meta+V"],selectall:["Select all","SelectAll","Meta+A"],bold:["Bold","Bold","Meta+B"],italic:["Italic","Italic","Meta+I"],underline:["Underline","Underline"],strikethrough:["Strikethrough","Strikethrough"],subscript:["Subscript","Subscript"],superscript:["Superscript","Superscript"],removeformat:["Clear formatting","RemoveFormat"]},function(item,name){editor.addMenuItem(name,{text:item[0],icon:name,shortcut:item[2],cmd:item[1]})});editor.on("mousedown",function(){FloatPanel.hideAll()});function toggleFormat(fmt){if(fmt.control){fmt=fmt.control.value()}if(fmt){editor.execCommand("mceToggleFormat",false,fmt)}}editor.addButton("styleselect",{type:"menubutton",text:"Formats",menu:formatMenu});editor.addButton("formatselect",function(){var items=[],blocks=createFormats(editor.settings.block_formats||"Paragraph=p;"+"Heading 1=h1;"+"Heading 2=h2;"+"Heading 3=h3;"+"Heading 4=h4;"+"Heading 5=h5;"+"Heading 6=h6;"+"Preformatted=pre");each(blocks,function(block){items.push({text:block[0],value:block[1],textStyle:function(){return editor.formatter.getCssText(block[1])}})});return{type:"listbox",text:blocks[0][0],values:items,fixedWidth:true,onselect:toggleFormat,onPostRender:createListBoxChangeHandler(items)}});editor.addButton("fontselect",function(){var defaultFontsFormats="Andale Mono=andale mono,monospace;"+"Arial=arial,helvetica,sans-serif;"+"Arial Black=arial black,sans-serif;"+"Book Antiqua=book antiqua,palatino,serif;"+"Comic Sans MS=comic sans ms,sans-serif;"+"Courier New=courier new,courier,monospace;"+"Georgia=georgia,palatino,serif;"+"Helvetica=helvetica,arial,sans-serif;"+"Impact=impact,sans-serif;"+"Symbol=symbol;"+"Tahoma=tahoma,arial,helvetica,sans-serif;"+"Terminal=terminal,monaco,monospace;"+"Times New Roman=times new roman,times,serif;"+"Trebuchet MS=trebuchet ms,geneva,sans-serif;"+"Verdana=verdana,geneva,sans-serif;"+"Webdings=webdings;"+"Wingdings=wingdings,zapf dingbats";var items=[],fonts=createFormats(editor.settings.font_formats||defaultFontsFormats);each(fonts,function(font){items.push({text:{raw:font[0]},value:font[1],textStyle:font[1].indexOf("dings")==-1?"font-family:"+font[1]:""})});return{type:"listbox",text:"Font Family",tooltip:"Font Family",values:items,fixedWidth:true,onPostRender:createListBoxChangeHandler(items,"fontname"),onselect:function(e){if(e.control.settings.value){editor.execCommand("FontName",false,e.control.settings.value)}}}});editor.addButton("fontsizeselect",function(){var items=[],defaultFontsizeFormats="8pt 10pt 12pt 14pt 18pt 24pt 36pt";var fontsize_formats=editor.settings.fontsize_formats||defaultFontsizeFormats;each(fontsize_formats.split(" "),function(item){var text=item,value=item;var values=item.split("=");if(values.length>1){text=values[0];value=values[1]}items.push({text:text,value:value})});return{type:"listbox",text:"Font Sizes",tooltip:"Font Sizes",values:items,fixedWidth:true,onPostRender:createListBoxChangeHandler(items,"fontsize"),onclick:function(e){if(e.control.settings.value){editor.execCommand("FontSize",false,e.control.settings.value)}}}});editor.addMenuItem("formats",{text:"Formats",menu:formatMenu})}});define("tinymce/ui/GridLayout",["tinymce/ui/AbsoluteLayout"],function(AbsoluteLayout){"use strict";return AbsoluteLayout.extend({recalc:function(container){var settings,rows,cols,items,contLayoutRect,width,height,rect,ctrlLayoutRect,ctrl,x,y,posX,posY,ctrlSettings,contPaddingBox,align,spacingH,spacingV,alignH,alignV,maxX,maxY,colWidths=[],rowHeights=[],ctrlMinWidth,ctrlMinHeight,availableWidth,availableHeight,reverseRows,idx;settings=container.settings;items=container.items().filter(":visible");contLayoutRect=container.layoutRect();cols=settings.columns||Math.ceil(Math.sqrt(items.length));rows=Math.ceil(items.length/cols);spacingH=settings.spacingH||settings.spacing||0;spacingV=settings.spacingV||settings.spacing||0;alignH=settings.alignH||settings.align;alignV=settings.alignV||settings.align;contPaddingBox=container.paddingBox;
reverseRows="reverseRows"in settings?settings.reverseRows:container.isRtl();if(alignH&&typeof alignH=="string"){alignH=[alignH]}if(alignV&&typeof alignV=="string"){alignV=[alignV]}for(x=0;x<cols;x++){colWidths.push(0)}for(y=0;y<rows;y++){rowHeights.push(0)}for(y=0;y<rows;y++){for(x=0;x<cols;x++){ctrl=items[y*cols+x];if(!ctrl){break}ctrlLayoutRect=ctrl.layoutRect();ctrlMinWidth=ctrlLayoutRect.minW;ctrlMinHeight=ctrlLayoutRect.minH;colWidths[x]=ctrlMinWidth>colWidths[x]?ctrlMinWidth:colWidths[x];rowHeights[y]=ctrlMinHeight>rowHeights[y]?ctrlMinHeight:rowHeights[y]}}availableWidth=contLayoutRect.innerW-contPaddingBox.left-contPaddingBox.right;for(maxX=0,x=0;x<cols;x++){maxX+=colWidths[x]+(x>0?spacingH:0);availableWidth-=(x>0?spacingH:0)+colWidths[x]}availableHeight=contLayoutRect.innerH-contPaddingBox.top-contPaddingBox.bottom;for(maxY=0,y=0;y<rows;y++){maxY+=rowHeights[y]+(y>0?spacingV:0);availableHeight-=(y>0?spacingV:0)+rowHeights[y]}maxX+=contPaddingBox.left+contPaddingBox.right;maxY+=contPaddingBox.top+contPaddingBox.bottom;rect={};rect.minW=maxX+(contLayoutRect.w-contLayoutRect.innerW);rect.minH=maxY+(contLayoutRect.h-contLayoutRect.innerH);rect.contentW=rect.minW-contLayoutRect.deltaW;rect.contentH=rect.minH-contLayoutRect.deltaH;rect.minW=Math.min(rect.minW,contLayoutRect.maxW);rect.minH=Math.min(rect.minH,contLayoutRect.maxH);rect.minW=Math.max(rect.minW,contLayoutRect.startMinWidth);rect.minH=Math.max(rect.minH,contLayoutRect.startMinHeight);if(contLayoutRect.autoResize&&(rect.minW!=contLayoutRect.minW||rect.minH!=contLayoutRect.minH)){rect.w=rect.minW;rect.h=rect.minH;container.layoutRect(rect);this.recalc(container);if(container._lastRect===null){var parentCtrl=container.parent();if(parentCtrl){parentCtrl._lastRect=null;parentCtrl.recalc()}}return}if(contLayoutRect.autoResize){rect=container.layoutRect(rect);rect.contentW=rect.minW-contLayoutRect.deltaW;rect.contentH=rect.minH-contLayoutRect.deltaH}var flexV;if(settings.packV=="start"){flexV=0}else{flexV=availableHeight>0?Math.floor(availableHeight/rows):0}var totalFlex=0;var flexWidths=settings.flexWidths;if(flexWidths){for(x=0;x<flexWidths.length;x++){totalFlex+=flexWidths[x]}}else{totalFlex=cols}var ratio=availableWidth/totalFlex;for(x=0;x<cols;x++){colWidths[x]+=flexWidths?flexWidths[x]*ratio:ratio}posY=contPaddingBox.top;for(y=0;y<rows;y++){posX=contPaddingBox.left;height=rowHeights[y]+flexV;for(x=0;x<cols;x++){if(reverseRows){idx=y*cols+cols-1-x}else{idx=y*cols+x}ctrl=items[idx];if(!ctrl){break}ctrlSettings=ctrl.settings;ctrlLayoutRect=ctrl.layoutRect();width=Math.max(colWidths[x],ctrlLayoutRect.startMinWidth);ctrlLayoutRect.x=posX;ctrlLayoutRect.y=posY;align=ctrlSettings.alignH||(alignH?alignH[x]||alignH[0]:null);if(align=="center"){ctrlLayoutRect.x=posX+width/2-ctrlLayoutRect.w/2}else if(align=="right"){ctrlLayoutRect.x=posX+width-ctrlLayoutRect.w}else if(align=="stretch"){ctrlLayoutRect.w=width}align=ctrlSettings.alignV||(alignV?alignV[x]||alignV[0]:null);if(align=="center"){ctrlLayoutRect.y=posY+height/2-ctrlLayoutRect.h/2}else if(align=="bottom"){ctrlLayoutRect.y=posY+height-ctrlLayoutRect.h}else if(align=="stretch"){ctrlLayoutRect.h=height}ctrl.layoutRect(ctrlLayoutRect);posX+=width+spacingH;if(ctrl.recalc){ctrl.recalc()}}posY+=height+spacingV}}})});define("tinymce/ui/Iframe",["tinymce/ui/Widget","tinymce/util/Delay"],function(Widget,Delay){"use strict";return Widget.extend({renderHtml:function(){var self=this;self.classes.add("iframe");self.canFocus=false;return'<iframe id="'+self._id+'" class="'+self.classes+'" tabindex="-1" src="'+(self.settings.url||"javascript:''")+'" frameborder="0"></iframe>'},src:function(src){this.getEl().src=src},html:function(html,callback){var self=this,body=this.getEl().contentWindow.document.body;if(!body){Delay.setTimeout(function(){self.html(html)})}else{body.innerHTML=html;if(callback){callback()}}return this}})});define("tinymce/ui/InfoBox",["tinymce/ui/Widget"],function(Widget){"use strict";return Widget.extend({init:function(settings){var self=this;self._super(settings);self.classes.add("widget").add("infobox");self.canFocus=false},severity:function(level){this.classes.remove("error");this.classes.remove("warning");this.classes.remove("success");this.classes.add(level)},help:function(state){this.state.set("help",state)},renderHtml:function(){var self=this,prefix=self.classPrefix;return'<div id="'+self._id+'" class="'+self.classes+'">'+'<div id="'+self._id+'-body">'+self.encode(self.state.get("text"))+'<button role="button" tabindex="-1">'+'<i class="'+prefix+"ico "+prefix+'i-help"></i>'+"</button>"+"</div>"+"</div>"},bindStates:function(){var self=this;self.state.on("change:text",function(e){self.getEl("body").firstChild.data=self.encode(e.value);if(self.state.get("rendered")){self.updateLayoutRect()}});self.state.on("change:help",function(e){self.classes.toggle("has-help",e.value);if(self.state.get("rendered")){self.updateLayoutRect()}});return self._super()}})});define("tinymce/ui/Label",["tinymce/ui/Widget","tinymce/ui/DomUtils"],function(Widget,DomUtils){"use strict";return Widget.extend({init:function(settings){var self=this;self._super(settings);self.classes.add("widget").add("label");self.canFocus=false;if(settings.multiline){self.classes.add("autoscroll")}if(settings.strong){self.classes.add("strong")}},initLayoutRect:function(){var self=this,layoutRect=self._super();if(self.settings.multiline){var size=DomUtils.getSize(self.getEl());if(size.width>layoutRect.maxW){layoutRect.minW=layoutRect.maxW;self.classes.add("multiline")}self.getEl().style.width=layoutRect.minW+"px";layoutRect.startMinH=layoutRect.h=layoutRect.minH=Math.min(layoutRect.maxH,DomUtils.getSize(self.getEl()).height)}return layoutRect},repaint:function(){var self=this;if(!self.settings.multiline){self.getEl().style.lineHeight=self.layoutRect().h+"px"}return self._super()},severity:function(level){this.classes.remove("error");this.classes.remove("warning");this.classes.remove("success");this.classes.add(level)},renderHtml:function(){var self=this,targetCtrl,forName,forId=self.settings.forId;if(!forId&&(forName=self.settings.forName)){targetCtrl=self.getRoot().find("#"+forName)[0];if(targetCtrl){forId=targetCtrl._id}}if(forId){return'<label id="'+self._id+'" class="'+self.classes+'"'+(forId?' for="'+forId+'"':"")+">"+self.encode(self.state.get("text"))+"</label>"}return'<span id="'+self._id+'" class="'+self.classes+'">'+self.encode(self.state.get("text"))+"</span>"},bindStates:function(){var self=this;self.state.on("change:text",function(e){self.innerHtml(self.encode(e.value));if(self.state.get("rendered")){self.updateLayoutRect()}});return self._super()}})});define("tinymce/ui/Toolbar",["tinymce/ui/Container"],function(Container){"use strict";return Container.extend({Defaults:{role:"toolbar",layout:"flow"},init:function(settings){var self=this;self._super(settings);self.classes.add("toolbar")},postRender:function(){var self=this;self.items().each(function(ctrl){ctrl.classes.add("toolbar-item")});return self._super()}})});define("tinymce/ui/MenuBar",["tinymce/ui/Toolbar"],function(Toolbar){"use strict";return Toolbar.extend({Defaults:{role:"menubar",containerCls:"menubar",ariaRoot:true,defaults:{type:"menubutton"}}})});define("tinymce/ui/MenuButton",["tinymce/ui/Button","tinymce/ui/Factory","tinymce/ui/MenuBar"],function(Button,Factory,MenuBar){"use strict";function isChildOf(node,parent){while(node){if(parent===node){return true}node=node.parentNode}return false}var MenuButton=Button.extend({init:function(settings){var self=this;self._renderOpen=true;self._super(settings);settings=self.settings;self.classes.add("menubtn");if(settings.fixedWidth){self.classes.add("fixed-width")}self.aria("haspopup",true);self.state.set("menu",settings.menu||self.render())},showMenu:function(){var self=this,menu;if(self.menu&&self.menu.visible()){return self.hideMenu()}if(!self.menu){menu=self.state.get("menu")||[];if(menu.length){menu={type:"menu",items:menu}}else{menu.type=menu.type||"menu"}if(!menu.renderTo){self.menu=Factory.create(menu).parent(self).renderTo()}else{self.menu=menu.parent(self).show().renderTo()}self.fire("createmenu");self.menu.reflow();self.menu.on("cancel",function(e){if(e.control.parent()===self.menu){e.stopPropagation();self.focus();self.hideMenu()}});self.menu.on("select",function(){self.focus()});self.menu.on("show hide",function(e){if(e.control==self.menu){self.activeMenu(e.type=="show")}self.aria("expanded",e.type=="show")}).fire("show")}self.menu.show();self.menu.layoutRect({w:self.layoutRect().w});self.menu.moveRel(self.getEl(),self.isRtl()?["br-tr","tr-br"]:["bl-tl","tl-bl"])},hideMenu:function(){var self=this;if(self.menu){self.menu.items().each(function(item){if(item.hideMenu){item.hideMenu()}});self.menu.hide()}},activeMenu:function(state){this.classes.toggle("active",state)},renderHtml:function(){var self=this,id=self._id,prefix=self.classPrefix;var icon=self.settings.icon,image,text=self.state.get("text"),textHtml="";image=self.settings.image;if(image){icon="none";if(typeof image!="string"){image=window.getSelection?image[0]:image[1]}image=" style=\"background-image: url('"+image+"')\""}else{image=""}if(text){self.classes.add("btn-has-text");textHtml='<span class="'+prefix+'txt">'+self.encode(text)+"</span>"}icon=self.settings.icon?prefix+"ico "+prefix+"i-"+icon:"";self.aria("role",self.parent()instanceof MenuBar?"menuitem":"button");return'<div id="'+id+'" class="'+self.classes+'" tabindex="-1" aria-labelledby="'+id+'">'+'<button id="'+id+'-open" role="presentation" type="button" tabindex="-1">'+(icon?'<i class="'+icon+'"'+image+"></i>":"")+textHtml+' <i class="'+prefix+'caret"></i>'+"</button>"+"</div>"},postRender:function(){var self=this;self.on("click",function(e){if(e.control===self&&isChildOf(e.target,self.getEl())){self.showMenu();if(e.aria){self.menu.items()[0].focus()}}});self.on("mouseenter",function(e){var overCtrl=e.control,parent=self.parent(),hasVisibleSiblingMenu;if(overCtrl&&parent&&overCtrl instanceof MenuButton&&overCtrl.parent()==parent){parent.items().filter("MenuButton").each(function(ctrl){if(ctrl.hideMenu&&ctrl!=overCtrl){if(ctrl.menu&&ctrl.menu.visible()){hasVisibleSiblingMenu=true}ctrl.hideMenu()}});if(hasVisibleSiblingMenu){overCtrl.focus();overCtrl.showMenu()}}});return self._super()},bindStates:function(){var self=this;self.state.on("change:menu",function(){if(self.menu){self.menu.remove()}self.menu=null});return self._super()},remove:function(){this._super();if(this.menu){this.menu.remove()}}});return MenuButton});define("tinymce/ui/MenuItem",["tinymce/ui/Widget","tinymce/ui/Factory","tinymce/Env","tinymce/util/Delay"],function(Widget,Factory,Env,Delay){"use strict";return Widget.extend({Defaults:{border:0,role:"menuitem"},init:function(settings){var self=this,text;self._super(settings);settings=self.settings;self.classes.add("menu-item");if(settings.menu){self.classes.add("menu-item-expand")}if(settings.preview){self.classes.add("menu-item-preview")}text=self.state.get("text");if(text==="-"||text==="|"){self.classes.add("menu-item-sep");self.aria("role","separator");self.state.set("text","-")}if(settings.selectable){self.aria("role","menuitemcheckbox");self.classes.add("menu-item-checkbox");settings.icon="selected"}if(!settings.preview&&!settings.selectable){self.classes.add("menu-item-normal")}self.on("mousedown",function(e){e.preventDefault()});if(settings.menu&&!settings.ariaHideMenu){self.aria("haspopup",true)}},hasMenus:function(){return!!this.settings.menu},showMenu:function(){var self=this,settings=self.settings,menu,parent=self.parent();parent.items().each(function(ctrl){if(ctrl!==self){ctrl.hideMenu()}});if(settings.menu){menu=self.menu;if(!menu){menu=settings.menu;if(menu.length){menu={type:"menu",items:menu}}else{menu.type=menu.type||"menu"}if(parent.settings.itemDefaults){menu.itemDefaults=parent.settings.itemDefaults}menu=self.menu=Factory.create(menu).parent(self).renderTo();menu.reflow();menu.on("cancel",function(e){e.stopPropagation();self.focus();menu.hide()});menu.on("show hide",function(e){e.control.items().each(function(ctrl){ctrl.active(ctrl.settings.selected)})}).fire("show");menu.on("hide",function(e){if(e.control===menu){self.classes.remove("selected")}});menu.submenu=true}else{menu.show()}menu._parentMenu=parent;menu.classes.add("menu-sub");var rel=menu.testMoveRel(self.getEl(),self.isRtl()?["tl-tr","bl-br","tr-tl","br-bl"]:["tr-tl","br-bl","tl-tr","bl-br"]);menu.moveRel(self.getEl(),rel);menu.rel=rel;rel="menu-sub-"+rel;menu.classes.remove(menu._lastRel).add(rel);menu._lastRel=rel;self.classes.add("selected");self.aria("expanded",true)}},hideMenu:function(){var self=this;if(self.menu){self.menu.items().each(function(item){if(item.hideMenu){item.hideMenu()}});self.menu.hide();self.aria("expanded",false)}return self},renderHtml:function(){var self=this,id=self._id,settings=self.settings,prefix=self.classPrefix,text=self.encode(self.state.get("text"));var icon=self.settings.icon,image="",shortcut=settings.shortcut;function convertShortcut(shortcut){var i,value,replace={};if(Env.mac){replace={alt:"&#x2325;",ctrl:"&#x2318;",shift:"&#x21E7;",meta:"&#x2318;"}}else{replace={meta:"Ctrl"}}shortcut=shortcut.split("+");for(i=0;i<shortcut.length;i++){value=replace[shortcut[i].toLowerCase()];if(value){shortcut[i]=value}}return shortcut.join("+")}if(icon){self.parent().classes.add("menu-has-icons")}if(settings.image){image=" style=\"background-image: url('"+settings.image+"')\""}if(shortcut){shortcut=convertShortcut(shortcut)}icon=prefix+"ico "+prefix+"i-"+(self.settings.icon||"none");return'<div id="'+id+'" class="'+self.classes+'" tabindex="-1">'+(text!=="-"?'<i class="'+icon+'"'+image+"></i>":"")+(text!=="-"?'<span id="'+id+'-text" class="'+prefix+'text">'+text+"</span>":"")+(shortcut?'<div id="'+id+'-shortcut" class="'+prefix+'menu-shortcut">'+shortcut+"</div>":"")+(settings.menu?'<div class="'+prefix+'caret"></div>':"")+"</div>"},postRender:function(){var self=this,settings=self.settings;var textStyle=settings.textStyle;if(typeof textStyle=="function"){textStyle=textStyle.call(this)}if(textStyle){var textElm=self.getEl("text");if(textElm){textElm.setAttribute("style",textStyle)}}self.on("mouseenter click",function(e){if(e.control===self){if(!settings.menu&&e.type==="click"){self.fire("select");Delay.requestAnimationFrame(function(){self.parent().hideAll()})}else{self.showMenu();if(e.aria){self.menu.focus(true)}}}});self._super();return self},hover:function(){var self=this;self.parent().items().each(function(ctrl){ctrl.classes.remove("selected")});self.classes.toggle("selected",true);return self},active:function(state){if(typeof state!="undefined"){this.aria("checked",state)}return this._super(state)},remove:function(){this._super();if(this.menu){this.menu.remove()}}})});define("tinymce/ui/Throbber",["tinymce/dom/DomQuery","tinymce/ui/Control","tinymce/util/Delay"],function($,Control,Delay){"use strict";return function(elm,inline){var self=this,state,classPrefix=Control.classPrefix,timer;self.show=function(time,callback){function render(){if(state){$(elm).append('<div class="'+classPrefix+"throbber"+(inline?" "+classPrefix+"throbber-inline":"")+'"></div>');if(callback){callback()}}}self.hide();state=true;if(time){timer=Delay.setTimeout(render,time)}else{render()}return self};self.hide=function(){var child=elm.lastChild;Delay.clearTimeout(timer);if(child&&child.className.indexOf("throbber")!=-1){child.parentNode.removeChild(child)}state=false;return self}}});define("tinymce/ui/Menu",["tinymce/ui/FloatPanel","tinymce/ui/MenuItem","tinymce/ui/Throbber","tinymce/util/Tools"],function(FloatPanel,MenuItem,Throbber,Tools){"use strict";return FloatPanel.extend({Defaults:{defaultType:"menuitem",border:1,layout:"stack",role:"application",bodyRole:"menu",ariaRoot:true},init:function(settings){var self=this;settings.autohide=true;settings.constrainToViewport=true;if(typeof settings.items==="function"){settings.itemsFactory=settings.items;settings.items=[]}if(settings.itemDefaults){var items=settings.items,i=items.length;while(i--){items[i]=Tools.extend({},settings.itemDefaults,items[i])}}self._super(settings);self.classes.add("menu")},repaint:function(){this.classes.toggle("menu-align",true);this._super();this.getEl().style.height="";this.getEl("body").style.height="";return this},cancel:function(){var self=this;self.hideAll();self.fire("select")},load:function(){var self=this,time,factory;function hideThrobber(){if(self.throbber){self.throbber.hide();self.throbber=null}}factory=self.settings.itemsFactory;if(!factory){return}if(!self.throbber){self.throbber=new Throbber(self.getEl("body"),true);if(self.items().length===0){self.throbber.show();self.fire("loading")}else{self.throbber.show(100,function(){self.items().remove();self.fire("loading")})}self.on("hide close",hideThrobber)}self.requestTime=time=(new Date).getTime();self.settings.itemsFactory(function(items){if(items.length===0){self.hide();return}if(self.requestTime!==time){return}self.getEl().style.width="";self.getEl("body").style.width="";hideThrobber();self.items().remove();self.getEl("body").innerHTML="";self.add(items);self.renderNew();self.fire("loaded")})},hideAll:function(){var self=this;this.find("menuitem").exec("hideMenu");return self._super()},preRender:function(){var self=this;self.items().each(function(ctrl){var settings=ctrl.settings;if(settings.icon||settings.image||settings.selectable){self._hasIcons=true;return false}});if(self.settings.itemsFactory){self.on("postrender",function(){if(self.settings.itemsFactory){self.load()}})}return self._super()}})});define("tinymce/ui/ListBox",["tinymce/ui/MenuButton","tinymce/ui/Menu"],function(MenuButton,Menu){"use strict";return MenuButton.extend({init:function(settings){var self=this,values,selected,selectedText,lastItemCtrl;function setSelected(menuValues){for(var i=0;i<menuValues.length;i++){selected=menuValues[i].selected||settings.value===menuValues[i].value;if(selected){selectedText=selectedText||menuValues[i].text;self.state.set("value",menuValues[i].value);return true}if(menuValues[i].menu){if(setSelected(menuValues[i].menu)){return true}}}}self._super(settings);settings=self.settings;self._values=values=settings.values;if(values){if(typeof settings.value!="undefined"){setSelected(values)}if(!selected&&values.length>0){selectedText=values[0].text;self.state.set("value",values[0].value)}self.state.set("menu",values)}self.state.set("text",settings.text||selectedText);self.classes.add("listbox");self.on("select",function(e){var ctrl=e.control;if(lastItemCtrl){e.lastControl=lastItemCtrl}if(settings.multiple){ctrl.active(!ctrl.active())}else{self.value(e.control.value())}lastItemCtrl=ctrl})},bindStates:function(){var self=this;function activateMenuItemsByValue(menu,value){if(menu instanceof Menu){menu.items().each(function(ctrl){if(!ctrl.hasMenus()){ctrl.active(ctrl.value()===value)}})}}function getSelectedItem(menuValues,value){var selectedItem;if(!menuValues){return}for(var i=0;i<menuValues.length;i++){if(menuValues[i].value===value){return menuValues[i]}if(menuValues[i].menu){selectedItem=getSelectedItem(menuValues[i].menu,value);if(selectedItem){return selectedItem}}}}self.on("show",function(e){activateMenuItemsByValue(e.control,self.value())});self.state.on("change:value",function(e){var selectedItem=getSelectedItem(self.state.get("menu"),e.value);if(selectedItem){self.text(selectedItem.text)}else{self.text(self.settings.text)}});return self._super()}})});define("tinymce/ui/Radio",["tinymce/ui/Checkbox"],function(Checkbox){"use strict";return Checkbox.extend({Defaults:{classes:"radio",role:"radio"}})});define("tinymce/ui/ResizeHandle",["tinymce/ui/Widget","tinymce/ui/DragHelper"],function(Widget,DragHelper){"use strict";return Widget.extend({renderHtml:function(){var self=this,prefix=self.classPrefix;self.classes.add("resizehandle");if(self.settings.direction=="both"){self.classes.add("resizehandle-both")}self.canFocus=false;return'<div id="'+self._id+'" class="'+self.classes+'">'+'<i class="'+prefix+"ico "+prefix+'i-resize"></i>'+"</div>"},postRender:function(){var self=this;self._super();self.resizeDragHelper=new DragHelper(this._id,{start:function(){self.fire("ResizeStart")},drag:function(e){if(self.settings.direction!="both"){e.deltaX=0}self.fire("Resize",e)},stop:function(){self.fire("ResizeEnd")}})},remove:function(){if(this.resizeDragHelper){this.resizeDragHelper.destroy()}return this._super()}})});define("tinymce/ui/SelectBox",["tinymce/ui/Widget"],function(Widget){"use strict";function createOptions(options){var strOptions="";if(options){for(var i=0;i<options.length;i++){strOptions+='<option value="'+options[i]+'">'+options[i]+"</option>"}}return strOptions}return Widget.extend({Defaults:{classes:"selectbox",role:"selectbox",options:[]},init:function(settings){var self=this;self._super(settings);if(self.settings.size){self.size=self.settings.size}if(self.settings.options){self._options=self.settings.options}self.on("keydown",function(e){var rootControl;if(e.keyCode==13){e.preventDefault();self.parents().reverse().each(function(ctrl){if(ctrl.toJSON){rootControl=ctrl;return false}});self.fire("submit",{data:rootControl.toJSON()})}})},options:function(state){if(!arguments.length){return this.state.get("options")}this.state.set("options",state);return this},renderHtml:function(){var self=this,options,size="";options=createOptions(self._options);if(self.size){size=' size = "'+self.size+'"'}return'<select id="'+self._id+'" class="'+self.classes+'"'+size+">"+options+"</select>"},bindStates:function(){var self=this;self.state.on("change:options",function(e){self.getEl().innerHTML=createOptions(e.value)});return self._super()}})});define("tinymce/ui/Slider",["tinymce/ui/Widget","tinymce/ui/DragHelper","tinymce/ui/DomUtils"],function(Widget,DragHelper,DomUtils){"use strict";function constrain(value,minVal,maxVal){if(value<minVal){value=minVal}if(value>maxVal){value=maxVal}return value}function setAriaProp(el,name,value){el.setAttribute("aria-"+name,value)}function updateSliderHandle(ctrl,value){var maxHandlePos,shortSizeName,sizeName,stylePosName,styleValue,handleEl;if(ctrl.settings.orientation=="v"){stylePosName="top";sizeName="height";shortSizeName="h"}else{stylePosName="left";sizeName="width";shortSizeName="w"}handleEl=ctrl.getEl("handle");maxHandlePos=(ctrl.layoutRect()[shortSizeName]||100)-DomUtils.getSize(handleEl)[sizeName];styleValue=maxHandlePos*((value-ctrl._minValue)/(ctrl._maxValue-ctrl._minValue))+"px";handleEl.style[stylePosName]=styleValue;handleEl.style.height=ctrl.layoutRect().h+"px";setAriaProp(handleEl,"valuenow",value);setAriaProp(handleEl,"valuetext",""+ctrl.settings.previewFilter(value));setAriaProp(handleEl,"valuemin",ctrl._minValue);setAriaProp(handleEl,"valuemax",ctrl._maxValue)}return Widget.extend({init:function(settings){var self=this;if(!settings.previewFilter){settings.previewFilter=function(value){return Math.round(value*100)/100}}self._super(settings);self.classes.add("slider");if(settings.orientation=="v"){self.classes.add("vertical")}self._minValue=settings.minValue||0;self._maxValue=settings.maxValue||100;self._initValue=self.state.get("value")},renderHtml:function(){var self=this,id=self._id,prefix=self.classPrefix;return'<div id="'+id+'" class="'+self.classes+'">'+'<div id="'+id+'-handle" class="'+prefix+'slider-handle" role="slider" tabindex="-1"></div>'+"</div>"},reset:function(){this.value(this._initValue).repaint()},postRender:function(){var self=this,minValue,maxValue,screenCordName,stylePosName,sizeName,shortSizeName;function toFraction(min,max,val){return(val+min)/(max-min)}function fromFraction(min,max,val){return val*(max-min)-min}function handleKeyboard(minValue,maxValue){function alter(delta){var value;value=self.value();value=fromFraction(minValue,maxValue,toFraction(minValue,maxValue,value)+delta*.05);value=constrain(value,minValue,maxValue);self.value(value);self.fire("dragstart",{value:value});self.fire("drag",{value:value});self.fire("dragend",{value:value})}self.on("keydown",function(e){switch(e.keyCode){case 37:case 38:alter(-1);break;case 39:case 40:alter(1);break}})}function handleDrag(minValue,maxValue,handleEl){var startPos,startHandlePos,maxHandlePos,handlePos,value;self._dragHelper=new DragHelper(self._id,{handle:self._id+"-handle",start:function(e){startPos=e[screenCordName];startHandlePos=parseInt(self.getEl("handle").style[stylePosName],10);maxHandlePos=(self.layoutRect()[shortSizeName]||100)-DomUtils.getSize(handleEl)[sizeName];self.fire("dragstart",{value:value})},drag:function(e){var delta=e[screenCordName]-startPos;handlePos=constrain(startHandlePos+delta,0,maxHandlePos);handleEl.style[stylePosName]=handlePos+"px";value=minValue+handlePos/maxHandlePos*(maxValue-minValue);self.value(value);self.tooltip().text(""+self.settings.previewFilter(value)).show().moveRel(handleEl,"bc tc");self.fire("drag",{value:value})},stop:function(){self.tooltip().hide();self.fire("dragend",{value:value})}})}minValue=self._minValue;maxValue=self._maxValue;if(self.settings.orientation=="v"){screenCordName="screenY";stylePosName="top";sizeName="height";shortSizeName="h"}else{screenCordName="screenX";stylePosName="left";sizeName="width";shortSizeName="w"}self._super();handleKeyboard(minValue,maxValue,self.getEl("handle"));handleDrag(minValue,maxValue,self.getEl("handle"))},repaint:function(){this._super();updateSliderHandle(this,this.value())},bindStates:function(){var self=this;self.state.on("change:value",function(e){updateSliderHandle(self,e.value)});return self._super()}})});define("tinymce/ui/Spacer",["tinymce/ui/Widget"],function(Widget){"use strict";return Widget.extend({renderHtml:function(){var self=this;self.classes.add("spacer");self.canFocus=false;return'<div id="'+self._id+'" class="'+self.classes+'"></div>'}})});define("tinymce/ui/SplitButton",["tinymce/ui/MenuButton","tinymce/ui/DomUtils","tinymce/dom/DomQuery"],function(MenuButton,DomUtils,$){return MenuButton.extend({Defaults:{classes:"widget btn splitbtn",role:"button"},repaint:function(){var self=this,elm=self.getEl(),rect=self.layoutRect(),mainButtonElm,menuButtonElm;self._super();mainButtonElm=elm.firstChild;menuButtonElm=elm.lastChild;$(mainButtonElm).css({width:rect.w-DomUtils.getSize(menuButtonElm).width,height:rect.h-2});$(menuButtonElm).css({height:rect.h-2});return self},activeMenu:function(state){var self=this;$(self.getEl().lastChild).toggleClass(self.classPrefix+"active",state)},renderHtml:function(){var self=this,id=self._id,prefix=self.classPrefix,image;var icon=self.state.get("icon"),text=self.state.get("text"),textHtml="";image=self.settings.image;if(image){icon="none";if(typeof image!="string"){image=window.getSelection?image[0]:image[1]}image=" style=\"background-image: url('"+image+"')\""}else{image=""}icon=self.settings.icon?prefix+"ico "+prefix+"i-"+icon:"";if(text){self.classes.add("btn-has-text");textHtml='<span class="'+prefix+'txt">'+self.encode(text)+"</span>"}return'<div id="'+id+'" class="'+self.classes+'" role="button" tabindex="-1">'+'<button type="button" hidefocus="1" tabindex="-1">'+(icon?'<i class="'+icon+'"'+image+"></i>":"")+textHtml+"</button>"+'<button type="button" class="'+prefix+'open" hidefocus="1" tabindex="-1">'+(self._menuBtnText?(icon?"":"")+self._menuBtnText:"")+' <i class="'+prefix+'caret"></i>'+"</button>"+"</div>"},postRender:function(){var self=this,onClickHandler=self.settings.onclick;self.on("click",function(e){var node=e.target;if(e.control==this){while(node){if(e.aria&&e.aria.key!="down"||node.nodeName=="BUTTON"&&node.className.indexOf("open")==-1){e.stopImmediatePropagation();if(onClickHandler){onClickHandler.call(this,e)}return}node=node.parentNode}}});delete self.settings.onclick;return self._super()}})});define("tinymce/ui/StackLayout",["tinymce/ui/FlowLayout"],function(FlowLayout){"use strict";return FlowLayout.extend({Defaults:{containerClass:"stack-layout",controlClass:"stack-layout-item",endClass:"break"},isNative:function(){return true}})});define("tinymce/ui/TabPanel",["tinymce/ui/Panel","tinymce/dom/DomQuery","tinymce/ui/DomUtils"],function(Panel,$,DomUtils){"use strict";return Panel.extend({Defaults:{layout:"absolute",defaults:{type:"panel"}},activateTab:function(idx){var activeTabElm;if(this.activeTabId){activeTabElm=this.getEl(this.activeTabId);$(activeTabElm).removeClass(this.classPrefix+"active");activeTabElm.setAttribute("aria-selected","false")}this.activeTabId="t"+idx;activeTabElm=this.getEl("t"+idx);activeTabElm.setAttribute("aria-selected","true");$(activeTabElm).addClass(this.classPrefix+"active");this.items()[idx].show().fire("showtab");this.reflow();this.items().each(function(item,i){if(idx!=i){item.hide()}})},renderHtml:function(){var self=this,layout=self._layout,tabsHtml="",prefix=self.classPrefix;self.preRender();layout.preRender(self);self.items().each(function(ctrl,i){var id=self._id+"-t"+i;ctrl.aria("role","tabpanel");ctrl.aria("labelledby",id);tabsHtml+='<div id="'+id+'" class="'+prefix+'tab" '+'unselectable="on" role="tab" aria-controls="'+ctrl._id+'" aria-selected="false" tabIndex="-1">'+self.encode(ctrl.settings.title)+"</div>"});return'<div id="'+self._id+'" class="'+self.classes+'" hidefocus="1" tabindex="-1">'+'<div id="'+self._id+'-head" class="'+prefix+'tabs" role="tablist">'+tabsHtml+"</div>"+'<div id="'+self._id+'-body" class="'+self.bodyClasses+'">'+layout.renderHtml(self)+"</div>"+"</div>"},postRender:function(){var self=this;self._super();self.settings.activeTab=self.settings.activeTab||0;self.activateTab(self.settings.activeTab);this.on("click",function(e){var targetParent=e.target.parentNode;if(e.target.parentNode.id==self._id+"-head"){var i=targetParent.childNodes.length;while(i--){if(targetParent.childNodes[i]==e.target){self.activateTab(i)}}}})},initLayoutRect:function(){var self=this,rect,minW,minH;minW=DomUtils.getSize(self.getEl("head")).width;minW=minW<0?0:minW;minH=0;self.items().each(function(item){minW=Math.max(minW,item.layoutRect().minW);minH=Math.max(minH,item.layoutRect().minH)});self.items().each(function(ctrl){ctrl.settings.x=0;ctrl.settings.y=0;ctrl.settings.w=minW;ctrl.settings.h=minH;ctrl.layoutRect({x:0,y:0,w:minW,h:minH})});var headH=DomUtils.getSize(self.getEl("head")).height;self.settings.minWidth=minW;self.settings.minHeight=minH+headH;rect=self._super();rect.deltaH+=headH;rect.innerH=rect.h-rect.deltaH;return rect}})});define("tinymce/ui/TextBox",["tinymce/ui/Widget","tinymce/util/Tools","tinymce/ui/DomUtils"],function(Widget,Tools,DomUtils){return Widget.extend({init:function(settings){var self=this;self._super(settings);self.classes.add("textbox");if(settings.multiline){self.classes.add("multiline")}else{self.on("keydown",function(e){var rootControl;if(e.keyCode==13){e.preventDefault();self.parents().reverse().each(function(ctrl){if(ctrl.toJSON){rootControl=ctrl;return false}});self.fire("submit",{data:rootControl.toJSON()})}});self.on("keyup",function(e){self.state.set("value",e.target.value)})}},repaint:function(){var self=this,style,rect,borderBox,borderW,borderH=0,lastRepaintRect;style=self.getEl().style;rect=self._layoutRect;lastRepaintRect=self._lastRepaintRect||{};var doc=document;if(!self.settings.multiline&&doc.all&&(!doc.documentMode||doc.documentMode<=8)){style.lineHeight=rect.h-borderH+"px"}borderBox=self.borderBox;borderW=borderBox.left+borderBox.right+8;borderH=borderBox.top+borderBox.bottom+(self.settings.multiline?8:0);if(rect.x!==lastRepaintRect.x){style.left=rect.x+"px";lastRepaintRect.x=rect.x}if(rect.y!==lastRepaintRect.y){style.top=rect.y+"px";lastRepaintRect.y=rect.y}if(rect.w!==lastRepaintRect.w){style.width=rect.w-borderW+"px";lastRepaintRect.w=rect.w}if(rect.h!==lastRepaintRect.h){style.height=rect.h-borderH+"px";lastRepaintRect.h=rect.h}self._lastRepaintRect=lastRepaintRect;self.fire("repaint",{},false);return self},renderHtml:function(){var self=this,settings=self.settings,attrs,elm;attrs={id:self._id,hidefocus:"1"};Tools.each(["rows","spellcheck","maxLength","size","readonly","min","max","step","list","pattern","placeholder","required","multiple"],function(name){
attrs[name]=settings[name]});if(self.disabled()){attrs.disabled="disabled"}if(settings.subtype){attrs.type=settings.subtype}elm=DomUtils.create(settings.multiline?"textarea":"input",attrs);elm.value=self.state.get("value");elm.className=self.classes;return elm.outerHTML},value:function(value){if(arguments.length){this.state.set("value",value);return this}if(this.state.get("rendered")){this.state.set("value",this.getEl().value)}return this.state.get("value")},postRender:function(){var self=this;self.getEl().value=self.state.get("value");self._super();self.$el.on("change",function(e){self.state.set("value",e.target.value);self.fire("change",e)})},bindStates:function(){var self=this;self.state.on("change:value",function(e){if(self.getEl().value!=e.value){self.getEl().value=e.value}});self.state.on("change:disabled",function(e){self.getEl().disabled=e.value});return self._super()},remove:function(){this.$el.off();this._super()}})});define("tinymce/Register",[],function(){var context=this||window;var tinymce=function(){return context.tinymce};if(typeof context.define==="function"){if(!context.define.amd){context.define("ephox/tinymce",[],tinymce)}}return{}});expose(["tinymce/geom/Rect","tinymce/util/Promise","tinymce/util/Delay","tinymce/Env","tinymce/dom/EventUtils","tinymce/dom/Sizzle","tinymce/util/Tools","tinymce/dom/DomQuery","tinymce/html/Styles","tinymce/dom/TreeWalker","tinymce/html/Entities","tinymce/dom/DOMUtils","tinymce/dom/ScriptLoader","tinymce/AddOnManager","tinymce/dom/RangeUtils","tinymce/html/Node","tinymce/html/Schema","tinymce/html/SaxParser","tinymce/html/DomParser","tinymce/html/Writer","tinymce/html/Serializer","tinymce/dom/Serializer","tinymce/util/VK","tinymce/dom/ControlSelection","tinymce/dom/BookmarkManager","tinymce/dom/Selection","tinymce/Formatter","tinymce/UndoManager","tinymce/EditorCommands","tinymce/util/URI","tinymce/util/Class","tinymce/util/EventDispatcher","tinymce/util/Observable","tinymce/ui/Selector","tinymce/ui/Collection","tinymce/ui/ReflowQueue","tinymce/ui/Control","tinymce/ui/Factory","tinymce/ui/KeyboardNavigation","tinymce/ui/Container","tinymce/ui/DragHelper","tinymce/ui/Scrollable","tinymce/ui/Panel","tinymce/ui/Movable","tinymce/ui/Resizable","tinymce/ui/FloatPanel","tinymce/ui/Window","tinymce/ui/MessageBox","tinymce/WindowManager","tinymce/ui/Tooltip","tinymce/ui/Widget","tinymce/ui/Progress","tinymce/ui/Notification","tinymce/NotificationManager","tinymce/EditorObservable","tinymce/Shortcuts","tinymce/Editor","tinymce/util/I18n","tinymce/FocusManager","tinymce/EditorManager","tinymce/util/XHR","tinymce/util/JSON","tinymce/util/JSONRequest","tinymce/util/JSONP","tinymce/util/LocalStorage","tinymce/Compat","tinymce/ui/Layout","tinymce/ui/AbsoluteLayout","tinymce/ui/Button","tinymce/ui/ButtonGroup","tinymce/ui/Checkbox","tinymce/ui/ComboBox","tinymce/ui/ColorBox","tinymce/ui/PanelButton","tinymce/ui/ColorButton","tinymce/util/Color","tinymce/ui/ColorPicker","tinymce/ui/Path","tinymce/ui/ElementPath","tinymce/ui/FormItem","tinymce/ui/Form","tinymce/ui/FieldSet","tinymce/ui/FilePicker","tinymce/ui/FitLayout","tinymce/ui/FlexLayout","tinymce/ui/FlowLayout","tinymce/ui/FormatControls","tinymce/ui/GridLayout","tinymce/ui/Iframe","tinymce/ui/InfoBox","tinymce/ui/Label","tinymce/ui/Toolbar","tinymce/ui/MenuBar","tinymce/ui/MenuButton","tinymce/ui/MenuItem","tinymce/ui/Throbber","tinymce/ui/Menu","tinymce/ui/ListBox","tinymce/ui/Radio","tinymce/ui/ResizeHandle","tinymce/ui/SelectBox","tinymce/ui/Slider","tinymce/ui/Spacer","tinymce/ui/SplitButton","tinymce/ui/StackLayout","tinymce/ui/TabPanel","tinymce/ui/TextBox"])})(this)}).call(window);module.exports=window.tinymce}).call(exports,__webpack_require__(308).setImmediate)},1680:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _toConsumableArray2=__webpack_require__(41);var _toConsumableArray3=_interopRequireDefault(_toConsumableArray2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _noop=__webpack_require__(38);var _noop2=_interopRequireDefault(_noop);var _button=__webpack_require__(69);var _button2=_interopRequireDefault(_button);var _card=__webpack_require__(89);var _card2=_interopRequireDefault(_card);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _analytics=__webpack_require__(20);var _analytics2=_interopRequireDefault(_analytics);var _sitesList=__webpack_require__(53);var _sitesList2=_interopRequireDefault(_sitesList);var _plans=__webpack_require__(715);var _productsValues=__webpack_require__(62);var _trackComponentView=__webpack_require__(284);var _trackComponentView2=_interopRequireDefault(_trackComponentView);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var sites=(0,_sitesList2.default)();exports.default=_react2.default.createClass({displayName:"UpgradeNudge",propTypes:{onClick:_react2.default.PropTypes.func,className:_react2.default.PropTypes.string,message:_react2.default.PropTypes.string,icon:_react2.default.PropTypes.string,event:_react2.default.PropTypes.string,href:_react2.default.PropTypes.string,jetpack:_react2.default.PropTypes.bool,compact:_react2.default.PropTypes.bool,feature:_react2.default.PropTypes.oneOf([false].concat((0,_toConsumableArray3.default)((0,_plans.getValidFeatureKeys)()))),shouldDisplay:_react2.default.PropTypes.func},getDefaultProps:function getDefaultProps(){return{onClick:_noop2.default,message:"And get your own domain address.",icon:"star",event:null,jetpack:false,feature:false,compact:false,shouldDisplay:null}},handleClick:function handleClick(){if(this.props.event||this.props.feature){_analytics2.default.tracks.recordEvent("calypso_upgrade_nudge_cta_click",{cta_name:this.props.event,cta_feature:this.props.feature,cta_size:"regular"})}this.props.onClick()},shouldDisplay:function shouldDisplay(site){var _props=this.props;var feature=_props.feature;var jetpack=_props.jetpack;var shouldDisplay=_props.shouldDisplay;if(shouldDisplay){return shouldDisplay()}if(!site){return false}if(feature&&(0,_plans.hasFeature)(feature,site.ID)){return false}if(!feature&&!(0,_productsValues.isFreePlan)(site.plan)){return false}if(feature==="no-adverts"&&site.options.wordads){return false}if(!jetpack&&site.jetpack||jetpack&&!site.jetpack){return false}return true},render:function render(){var classes=(0,_classnames2.default)(this.props.className,"upgrade-nudge");var site=sites.getSelectedSite();var href=this.props.href;if(!this.shouldDisplay(site)){return null}if(!this.props.href&&site){if(this.props.feature){href="/plans/"+site.slug+"?feature="+this.props.feature}else{href="/plans/"+site.slug}}if(this.props.compact){return _react2.default.createElement(_button2.default,{className:classes,onClick:this.handleClick,href:href},_react2.default.createElement(_gridicon2.default,{className:"upgrade-nudge__icon",icon:this.props.icon}),_react2.default.createElement("div",{className:"upgrade-nudge__info"},_react2.default.createElement("span",{className:"upgrade-nudge__title"},this.props.title||this.translate("Upgrade to Premium")),_react2.default.createElement("span",{className:"upgrade-nudge__message"},this.props.message)))}return _react2.default.createElement(_card2.default,{compact:true,className:classes,onClick:this.handleClick,href:href},_react2.default.createElement(_gridicon2.default,{className:"upgrade-nudge__icon",icon:this.props.icon,size:18}),_react2.default.createElement("div",{className:"upgrade-nudge__info"},_react2.default.createElement("span",{className:"upgrade-nudge__title"},this.props.title||this.translate("Upgrade to Premium")),_react2.default.createElement("span",{className:"upgrade-nudge__message"},this.props.message)),(this.props.event||this.props.feature)&&_react2.default.createElement(_trackComponentView2.default,{eventName:"calypso_upgrade_nudge_impression",eventProperties:{cta_name:this.props.event,cta_feature:this.props.feature,cta_size:"regular"}}))}});module.exports=exports["default"]},1681:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1),classNames=__webpack_require__(10),noop=__webpack_require__(38);var Card=__webpack_require__(89),CompactCard=__webpack_require__(1642),Gridicon=__webpack_require__(26);var FoldableCard=React.createClass({displayName:"FoldableCard",propTypes:{actionButton:React.PropTypes.element,actionButtonExpanded:React.PropTypes.element,cardKey:React.PropTypes.string,compact:React.PropTypes.bool,disabled:React.PropTypes.bool,expandedSummary:React.PropTypes.oneOfType([React.PropTypes.string,React.PropTypes.element]),expanded:React.PropTypes.bool,icon:React.PropTypes.string,onClick:React.PropTypes.func,onClose:React.PropTypes.func,onOpen:React.PropTypes.func,screenReaderText:React.PropTypes.oneOfType([React.PropTypes.string,React.PropTypes.bool]),summary:React.PropTypes.oneOfType([React.PropTypes.string,React.PropTypes.element])},getInitialState:function getInitialState(){return{expanded:this.props.expanded}},getDefaultProps:function getDefaultProps(){return{onOpen:noop,onClose:noop,cardKey:"",icon:"chevron-down",isExpanded:false,screenReaderText:false}},onClick:function onClick(){if(this.props.children){this.setState({expanded:!this.state.expanded})}if(this.props.onClick){this.props.onClick()}if(this.state.expanded){this.props.onClose(this.props.cardKey)}else{this.props.onOpen(this.props.cardKey)}},getClickAction:function getClickAction(){if(this.props.disabled){return}return this.onClick},getActionButton:function getActionButton(){if(this.state.expanded){return this.props.actionButtonExpanded||this.props.actionButton}return this.props.actionButton},renderActionButton:function renderActionButton(){var clickAction=!this.props.clickableHeader?this.getClickAction():null;if(this.props.actionButton){return React.createElement("div",{className:"foldable-card__action",onClick:clickAction},this.getActionButton())}if(this.props.children){var iconSize=24;var screenReaderText=this.props.screenReaderText||this.translate("More");return React.createElement("button",{disabled:this.props.disabled,className:"foldable-card__action foldable-card__expand",onClick:clickAction},React.createElement("span",{className:"screen-reader-text"},screenReaderText),React.createElement(Gridicon,{icon:this.props.icon,size:iconSize}))}},renderContent:function renderContent(){return React.createElement("div",{className:"foldable-card__content"},this.props.children)},renderHeader:function renderHeader(){var summary=this.props.summary?React.createElement("span",{className:"foldable-card__summary"},this.props.summary," "):null,expandedSummary=this.props.expandedSummary?React.createElement("span",{className:"foldable-card__summary_expanded"},this.props.expandedSummary," "):null,headerClickAction=this.props.clickableHeader?this.getClickAction():null,headerClasses=classNames("foldable-card__header",{"is-clickable":!!this.props.clickableHeader,"has-border":!!this.props.summary});return React.createElement("div",{className:headerClasses,onClick:headerClickAction},React.createElement("span",{className:"foldable-card__main"},this.props.header," "),React.createElement("span",{className:"foldable-card__secondary"},summary,expandedSummary,this.renderActionButton()))},render:function render(){var Container=this.props.compact?CompactCard:Card,itemSiteClasses=classNames("foldable-card",this.props.className,{"is-disabled":!!this.props.disabled,"is-expanded":!!this.state.expanded,"has-expanded-summary":!!this.props.expandedSummary});return React.createElement(Container,{className:itemSiteClasses},this.renderHeader(),this.state.expanded&&this.renderContent())}});module.exports=FoldableCard},1682:function(module,exports,__webpack_require__){"use strict";var ReactDom=__webpack_require__(44),React=__webpack_require__(1),filter=__webpack_require__(77),map=__webpack_require__(45),classNames=__webpack_require__(10);var ControlItem=__webpack_require__(1665);var _instance=1;var SegmentedControl=React.createClass({displayName:"SegmentedControl",propTypes:{initialSelected:React.PropTypes.string,compact:React.PropTypes.bool,className:React.PropTypes.string,style:React.PropTypes.object,onSelect:React.PropTypes.func,options:React.PropTypes.arrayOf(React.PropTypes.shape({value:React.PropTypes.string.isRequired,label:React.PropTypes.string.isRequired,path:React.PropTypes.string}))},getDefaultProps:function getDefaultProps(){return{compact:false}},getInitialState:function getInitialState(){var initialSelected;if(this.props.options){initialSelected=this.props.initialSelected||this.props.options[0].value}return{selected:initialSelected,keyboardNavigation:false}},componentWillMount:function componentWillMount(){this.id=_instance;_instance++},componentWillUnmount:function componentWillUnmount(){window.removeEventListener("keydown",this.navigateItem)},render:function render(){var segmentedClasses={"segmented-control":true,"keyboard-navigation":this.state.keyboardNavigation,"is-compact":this.props.compact,"is-primary":this.props.primary};if(this.props.className){this.props.className.split(" ").forEach(function(className){segmentedClasses[className]=true})}return React.createElement("ul",{className:classNames(segmentedClasses),style:this.props.style,role:"radiogroup",onKeyDown:this.navigateItem,onKeyUp:this.setKeyboardNavigation.bind(this,true)},this.getSegmentedItems())},getSegmentedItems:function getSegmentedItems(){var refIndex=0;if(this.props.children){return React.Children.map(this.props.children,function(child,index){var newChild=React.cloneElement(child,{ref:child.type===ControlItem?"item-"+refIndex:null,key:"item-"+index,onClick:function(event){this.setKeyboardNavigation(false);if(typeof child.props.onClick==="function"){child.props.onClick(event)}}.bind(this)});if(child.type===ControlItem){refIndex++}return newChild},this)}return this.props.options.map(function(item,index){return React.createElement(ControlItem,{key:"segmented-control-"+this.id+"-"+item.value,ref:"item-"+index,selected:this.state.selected===item.value,onClick:this.selectItem.bind(this,item),path:item.path,index:index},item.label)},this)},selectItem:function selectItem(option){if(!option){return}if(this.props.onSelect){this.props.onSelect(option)}this.setState({selected:option.value,keyboardNavigation:false})},setKeyboardNavigation:function setKeyboardNavigation(value){this.setState({keyboardNavigation:value})},navigateItem:function navigateItem(event){switch(event.keyCode){case 9:this.navigateItemByTabKey(event);break;case 32:case 13:event.preventDefault();document.activeElement.click();break;case 37:event.preventDefault();this.focusSibling("previous");break;case 39:event.preventDefault();this.focusSibling("next");break}},navigateItemByTabKey:function navigateItemByTabKey(event){var direction=event.shiftKey?"previous":"next",newIndex=this.focusSibling(direction);if(newIndex!==false){event.preventDefault()}},focusSibling:function focusSibling(direction){var increment,items,newIndex;if(this.props.options){items=filter(map(this.props.options,"value"),Boolean)}else{items=filter(this.props.children,function(item){return item.type===ControlItem})}if(typeof this.focused!=="number"){this.focused=this.getCurrentFocusedIndex()}increment=direction==="previous"?-1:1;newIndex=this.focused+increment;if(newIndex>=items.length||newIndex<0){return false}ReactDom.findDOMNode(this.refs["item-"+newIndex].refs.itemLink).focus();this.focused=newIndex;return newIndex},getCurrentFocusedIndex:function getCurrentFocusedIndex(){var activeItem=document.activeElement.parentNode,siblings=Array.prototype.slice(activeItem.parentNode.children),index=siblings.indexOf(activeItem);return index>-1?index:0}});module.exports=SegmentedControl},1687:function(module,exports,__webpack_require__){"use strict";var _freeze=__webpack_require__(276);var _freeze2=_interopRequireDefault(_freeze);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var assign=__webpack_require__(34),debug=__webpack_require__(3)("calypso:posts:post-edit-store"),emitter=__webpack_require__(36),isEqual=__webpack_require__(98),filter=__webpack_require__(77),without=__webpack_require__(172),pickBy=__webpack_require__(213);var Dispatcher=__webpack_require__(42),decodeEntities=__webpack_require__(81).decodeEntities,utils=__webpack_require__(1649);var REGEXP_EMPTY_CONTENT=/^<p>(<br[^>]*>|&nbsp;|\s)*<\/p>$/,CONTENT_LENGTH_ASSUME_SET=50;var _initialRawContent=null,_isAutosaving=false,_isLoading=false,_saveBlockers=[],_isNew=false,_loadingError=null,_post=null,_previewUrl=null,_queue=[],_queueChanges=false,_rawContent=null,_savedPost=null,PostEditStore;function resetState(){debug("Reset state");_initialRawContent=null;_isAutosaving=false;_isLoading=false;_saveBlockers=[];_isNew=false;_loadingError=null;_post=null;_previewUrl=null;_queue=[];_queueChanges=false;_rawContent=null;_savedPost=null}function getParentId(post){if(!post||!post.parent){return null}if(post.parent.ID){return post.parent.ID}return post.parent}function getPageTemplate(post){if(!post||!post.page_template||post.page_template==="default"){return""}return post.page_template}function startEditing(post){resetState();post=normalize(post);if(post.title){post.title=decodeEntities(post.title)}_previewUrl=utils.getPreviewURL(post);_savedPost=(0,_freeze2.default)(post);_post=_savedPost;_isLoading=false}function updatePost(post){post=normalize(post);if(post.title){post.title=decodeEntities(post.title)}_previewUrl=utils.getPreviewURL(post);_savedPost=(0,_freeze2.default)(post);_post=_savedPost;_isNew=false;_loadingError=null;_queue.forEach(function(change){set(change)})}function initializeNewPost(siteId,options){var args;options=options||{};args={site_ID:siteId,status:"draft",type:options.postType||"post",content:options.content||"",title:options.title||""};startEditing(args);_isNew=true}function setLoadingError(error){resetState();_loadingError=error;_isLoading=false}function set(attributes){var updatedPost;if(!_post){return false}if(_queueChanges){_queue.push(attributes)}updatedPost=assign({},_post,attributes);updatedPost=normalize(updatedPost);if(!isEqual(updatedPost,_post)){if(isEqual(updatedPost,_savedPost)){_post=_savedPost}else{_post=(0,_freeze2.default)(updatedPost)}return true}return false}function normalize(post){post.parent_id=getParentId(post);if(post.type==="page"){post.page_template=getPageTemplate(post)}return post}function setRawContent(content){var isDirty,hasContent;if(null===_initialRawContent){debug("Set initial raw content to: %s",content);_initialRawContent=content}if(content!==_rawContent){isDirty=PostEditStore.isDirty();hasContent=PostEditStore.hasContent();debug("Set raw content to: %s",content);_rawContent=content;if(PostEditStore.isDirty()!==isDirty||PostEditStore.hasContent()!==hasContent){PostEditStore.emit("change")}PostEditStore.emit("rawContentChange")}}function isContentEmpty(content){return!content||content.length<CONTENT_LENGTH_ASSUME_SET&&REGEXP_EMPTY_CONTENT.test(content)}function dispatcherCallback(payload){var action=payload.action,changed;switch(action.type){case"EDIT_POST":changed=set(action.post);if(changed){PostEditStore.emit("change")}break;case"RESET_POST_RAW_CONTENT":_initialRawContent=null;setRawContent(null);break;case"EDIT_POST_RAW_CONTENT":setRawContent(action.content);break;case"DRAFT_NEW_POST":initializeNewPost(action.siteId,{postType:action.postType,title:action.title,content:action.content});PostEditStore.emit("change");break;case"START_EDITING_POST":resetState();_isLoading=true;PostEditStore.emit("change");break;case"STOP_EDITING_POST":resetState();PostEditStore.emit("change");break;case"RECEIVE_POST_TO_EDIT":_isLoading=false;if(action.error){setLoadingError(action.error)}else{startEditing(action.post)}PostEditStore.emit("change");break;case"BLOCK_EDIT_POST_SAVE":if(-1===_saveBlockers.indexOf(action.key)){_saveBlockers.push(action.key);PostEditStore.emit("change")}break;case"UNBLOCK_EDIT_POST_SAVE":_saveBlockers=without(_saveBlockers,action.key);PostEditStore.emit("change");break;case"EDIT_POST_SAVE":_queueChanges=true;break;case"RECEIVE_UPDATED_POST":if(!action.error){if(_post&&action.post.ID===_post.ID){updatePost(action.post);PostEditStore.emit("change")}}_queueChanges=false;_queue=[];break;case"RECEIVE_POST_BEING_EDITED":if(!action.error){updatePost(action.post);if(typeof action.rawContent==="string"){_initialRawContent=action.rawContent}PostEditStore.emit("change")}_queueChanges=false;_queue=[];break;case"POST_AUTOSAVE":_isAutosaving=true;PostEditStore.emit("change");break;case"RECEIVE_POST_AUTOSAVE":_isAutosaving=false;if(!action.error){_previewUrl=utils.getPreviewURL(assign({preview_URL:action.autosave.preview_URL},_savedPost))}PostEditStore.emit("change");break}}PostEditStore={get:function get(){return _post},getSavedPost:function getSavedPost(){return _savedPost},getRawContent:function getRawContent(){return _rawContent},getChangedAttributes:function getChangedAttributes(){var changedAttributes,metadata;if(this.isNew()){return _post}if(!this.isDirty()){return(0,_freeze2.default)({})}changedAttributes=pickBy(_post,function(value,key){return value!==_savedPost[key]&&"metadata"!==key});if(_post.metadata){metadata=filter(_post.metadata,"operation");if(metadata.length){assign(changedAttributes,{metadata:metadata})}}if(!changedAttributes.content&&_rawContent!==_initialRawContent){changedAttributes.content=_post.content}return(0,_freeze2.default)(changedAttributes)},getLoadingError:function getLoadingError(){return _loadingError},isDirty:function isDirty(){return _post!==_savedPost||_rawContent!==_initialRawContent},isNew:function isNew(){return _isNew},isLoading:function isLoading(){return _isLoading},isAutosaving:function isAutosaving(){return _isAutosaving},isSaveBlocked:function isSaveBlocked(key){if(!key){return!!_saveBlockers.length}return-1!==_saveBlockers.indexOf(key)},getPreviewUrl:function getPreviewUrl(){return _previewUrl},hasContent:function hasContent(){if(!_post){return false}if(_post.title&&_post.title.trim()||_post.excerpt){return true}if(_rawContent){return!isContentEmpty(_rawContent)}return!isContentEmpty(_post.content)}};emitter(PostEditStore);PostEditStore.dispatchToken=Dispatcher.register(dispatcherCallback);module.exports=PostEditStore},1689:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1);var noResults=React.createClass({displayName:"noResults",getDefaultProps:function getDefaultProps(){return{text:"No results",image:false}},render:function render(){return React.createElement("div",{className:"no-results"},this.props.image?React.createElement("img",{className:"no-results__img",src:this.props.image}):null,React.createElement("span",null,this.props.text))}});module.exports=noResults},1692:function(module,exports,__webpack_require__){"use strict";var url=__webpack_require__(70),pick=__webpack_require__(91);module.exports=function(uri,search){var parsedUrl=url.parse(uri,true);if(search){parsedUrl.query.s=search}else{delete parsedUrl.query.s}parsedUrl=pick(parsedUrl,"pathname","hash","query");return url.format(parsedUrl).replace(/\%20/g,"+")}},1693:function(module,exports,__webpack_require__){"use strict";var debug=__webpack_require__(3)("calypso:url-search"),page=__webpack_require__(33);var buildUrl=__webpack_require__(1692);module.exports={getInitialState:function getInitialState(){return{searchOpen:false}},componentWillReceiveProps:function componentWillReceiveProps(nextProps){if(!nextProps.search){this.setState({searchOpen:false})}},doSearch:function doSearch(keywords){var searchURL;this.setState({searchOpen:false!==keywords});if(this.onSearch){this.onSearch(keywords);return}searchURL=buildUrl(window.location.href,keywords);debug("search posts for:",keywords);if(this.props.search&&keywords){debug("replacing URL: "+searchURL);page.replace(searchURL)}else{debug("setting URL: "+searchURL);page(searchURL)}},getSearchOpen:function getSearchOpen(){return this.state.searchOpen!==false||this.props.search}}},1708:function(module,exports,__webpack_require__){"use strict";var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var React=__webpack_require__(1),classnames=__webpack_require__(10),omit=__webpack_require__(18);module.exports=React.createClass({displayName:"FormLegend",render:function render(){return React.createElement("legend",(0,_extends3.default)({},omit(this.props,"className"),{className:classnames(this.props.className,"form-legend")}),this.props.children)}})},1709:function(module,exports,__webpack_require__){"use strict";var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var React=__webpack_require__(1);var Card=__webpack_require__(89),Search=__webpack_require__(717);var SearchCard=React.createClass({displayName:"SearchCard",propTypes:{additionalClasses:React.PropTypes.string,initialValue:React.PropTypes.string,placeholder:React.PropTypes.string,delaySearch:React.PropTypes.bool,onSearch:React.PropTypes.func.isRequired,onSearchChange:React.PropTypes.func,analyticsGroup:React.PropTypes.string,autoFocus:React.PropTypes.bool,disabled:React.PropTypes.bool,dir:React.PropTypes.string,maxLength:React.PropTypes.number},render:function render(){return React.createElement(Card,{className:"search-card"},React.createElement(Search,(0,_extends3.default)({ref:"search"},this.props)))},focus:function focus(){this.refs.search.focus()},clear:function clear(){this.refs.search.clear()}});module.exports=SearchCard},1714:function(module,exports,__webpack_require__){"use strict";var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var React=__webpack_require__(1),classnames=__webpack_require__(10),omit=__webpack_require__(18);module.exports=React.createClass({displayName:"FormRadio",render:function render(){var otherProps=omit(this.props,["className","type"]);return React.createElement("input",(0,_extends3.default)({},otherProps,{type:"radio",className:classnames(this.props.className,"form-radio")}))}})},1716:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.MimeTypes=exports.GalleryDefaultAttrs=exports.GallerySizeableTypes=exports.GalleryColumnedTypes=exports.VideoPressFileTypes=exports.ThumbnailSizeDimensions=exports.ValidationErrors=undefined;var _keyMirror=__webpack_require__(116);var _keyMirror2=_interopRequireDefault(_keyMirror);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ValidationErrors=exports.ValidationErrors=(0,_keyMirror2.default)({FILE_TYPE_UNSUPPORTED:null,FILE_TYPE_NOT_IN_PLAN:null,SERVER_ERROR:null,UPLOAD_VIA_URL_404:null,EXCEEDS_MAX_UPLOAD_SIZE:null,EXCEEDS_PLAN_STORAGE_LIMIT:null,NOT_ENOUGH_SPACE:null});var ThumbnailSizeDimensions=exports.ThumbnailSizeDimensions={thumbnail:{width:150,height:150},medium:{width:300,height:300},large:{width:1024,height:1024}};var VideoPressFileTypes=exports.VideoPressFileTypes=["ogv","mp4","m4v","mov","wmv","avi","mpg","3gp","3g2"];var GalleryColumnedTypes=exports.GalleryColumnedTypes=["default","circle","square"];var GallerySizeableTypes=exports.GallerySizeableTypes=["default"];var GalleryDefaultAttrs=exports.GalleryDefaultAttrs={items:[],type:"default",columns:3,orderBy:"menu_order",link:"",size:"thumbnail"};var MimeTypes=exports.MimeTypes={jpg:"image/jpeg",jpeg:"image/jpeg",jpe:"image/jpeg",gif:"image/gif",png:"image/png",bmp:"image/bmp",tif:"image/tiff",tiff:"image/tiff",ico:"image/x-icon",asf:"video/x-ms-asf",asx:"video/x-ms-asf",wmv:"video/x-ms-wmv",wmx:"video/x-ms-wmx",wm:"video/x-ms-wm",avi:"video/avi",divx:"video/divx",flv:"video/x-flv",mov:"video/quicktime",qt:"video/quicktime",mpeg:"video/mpeg",mpg:"video/mpeg",mpe:"video/mpeg",mp4:"video/mp4",m4v:"video/mp4",ogv:"video/ogg",webm:"video/webm",mkv:"video/x-matroska",txt:"text/plain",asc:"text/plain",c:"text/plain",cc:"text/plain",h:"text/plain",csv:"text/csv",tsv:"text/tab-separated-values",ics:"text/calendar",rtx:"text/richtext",css:"text/css",htm:"text/html",html:"text/html",mp3:"audio/mpeg",m4a:"audio/mpeg",m4b:"audio/mpeg",ra:"audio/x-realaudio",ram:"audio/x-realaudio",wav:"audio/wav",ogg:"audio/ogg",oga:"audio/ogg",mid:"audio/midi",midi:"audio/midi",wma:"audio/x-ms-wma",wax:"audio/x-ms-wax",mka:"audio/x-matroska",rtf:"application/rtf",js:"application/javascript",pdf:"application/pdf",swf:"application/x-shockwave-flash",class:"application/java",tar:"application/x-tar",zip:"application/zip",gz:"application/x-gzip",gzip:"application/x-gzip",rar:"application/rar","7z":"application/x-7z-compressed",exe:"application/x-msdownload",doc:"application/msword",pot:"application/vnd.ms-powerpoint",pps:"application/vnd.ms-powerpoint",ppt:"application/vnd.ms-powerpoint",wri:"application/vnd.ms-write",xla:"application/vnd.ms-excel",xls:"application/vnd.ms-excel",xlt:"application/vnd.ms-excel",xlw:"application/vnd.ms-excel",mdb:"application/vnd.ms-access",mpp:"application/vnd.ms-project",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",docm:"application/vnd.ms-word.document.macroEnabled.12",dotx:"application/vnd.openxmlformats-officedocument.wordprocessingml.template",dotm:"application/vnd.ms-word.template.macroEnabled.12",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xlsm:"application/vnd.ms-excel.sheet.macroEnabled.12",xlsb:"application/vnd.ms-excel.sheet.binary.macroEnabled.12",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template",xltm:"application/vnd.ms-excel.template.macroEnabled.12",xlam:"application/vnd.ms-excel.addin.macroEnabled.12",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",pptm:"application/vnd.ms-powerpoint.presentation.macroEnabled.12",ppsx:"application/vnd.openxmlformats-officedocument.presentationml.slideshow",ppsm:"application/vnd.ms-powerpoint.slideshow.macroEnabled.12",potx:"application/vnd.openxmlformats-officedocument.presentationml.template",potm:"application/vnd.ms-powerpoint.template.macroEnabled.12",ppam:"application/vnd.ms-powerpoint.addin.macroEnabled.12",sldx:"application/vnd.openxmlformats-officedocument.presentationml.slide",sldm:"application/vnd.ms-powerpoint.slide.macroEnabled.12",onetoc:"application/onenote",onetoc2:"application/onenote",onetmp:"application/onenote",onepkg:"application/onenote",odt:"application/vnd.oasis.opendocument.text",odp:"application/vnd.oasis.opendocument.presentation",ods:"application/vnd.oasis.opendocument.spreadsheet",odg:"application/vnd.oasis.opendocument.graphics",odc:"application/vnd.oasis.opendocument.chart",odb:"application/vnd.oasis.opendocument.database",odf:"application/vnd.oasis.opendocument.formula",wp:"application/wordperfect",wpd:"application/wordperfect",key:"application/vnd.apple.keynote",numbers:"application/vnd.apple.numbers",pages:"application/vnd.apple.pages"}},1717:function(module,exports,__webpack_require__){"use strict";var values=__webpack_require__(210);var Dispatcher=__webpack_require__(42),emitter=__webpack_require__(36),MediaValidationStore=__webpack_require__(1785);var MediaStore={_media:{},_pointers:{}};emitter(MediaStore);function receiveSingle(siteId,item,itemId){if(!(siteId in MediaStore._media)){MediaStore._media[siteId]={}}if(itemId){if(!(siteId in MediaStore._pointers)){MediaStore._pointers[siteId]={}}MediaStore._pointers[siteId][itemId]=item.ID;delete MediaStore._media[siteId][itemId]}MediaStore._media[siteId][item.ID]=item}function removeSingle(siteId,item){if(!(siteId in MediaStore._media)){return}delete MediaStore._media[siteId][item.ID]}function receivePage(siteId,items){
items.forEach(function(item){receiveSingle(siteId,item)})}MediaStore.get=function(siteId,postId){if(!(siteId in MediaStore._media)){return}if(siteId in MediaStore._pointers&&postId in MediaStore._pointers[siteId]){return MediaStore.get(siteId,MediaStore._pointers[siteId][postId])}return MediaStore._media[siteId][postId]};MediaStore.getAll=function(siteId){if(!(siteId in MediaStore._media)){return}return values(MediaStore._media[siteId])};MediaStore.dispatchToken=Dispatcher.register(function(payload){var action=payload.action;Dispatcher.waitFor([MediaValidationStore.dispatchToken]);switch(action.type){case"CREATE_MEDIA_ITEM":case"RECEIVE_MEDIA_ITEM":case"RECEIVE_MEDIA_ITEMS":if(action.error&&action.siteId&&action.id){removeSingle(action.siteId,{ID:action.id});MediaStore.emit("change")}if(action.error||!action.siteId||!action.data){break}if(Array.isArray(action.data.media)){receivePage(action.siteId,action.data.media)}else{receiveSingle(action.siteId,action.data,action.id)}MediaStore.emit("change");break;case"REMOVE_MEDIA_ITEM":if(!action.siteId||!action.data){break}if(action.error){receiveSingle(action.siteId,action.data)}else{removeSingle(action.siteId,action.data)}MediaStore.emit("change");break;case"FETCH_MEDIA_ITEM":if(!action.siteId||!action.id){break}receiveSingle(action.siteId,{ID:action.id});MediaStore.emit("change");break;case"FETCH_MEDIA_LIMITS":if(!action.siteId){break}MediaStore.emit("fetch-media-limits");break}});module.exports=MediaStore},1718:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1),assign=__webpack_require__(34);module.exports=function(element,additionalProps){var props=assign({},element.props,additionalProps),childElements;delete props.children;if(React.Children.count(element.props.children)>1){childElements=React.Children.map(element.props.children,function(child){if(!React.isValidElement(child)){return child}return React.cloneElement(child,props)});return React.DOM.div(null,childElements)}return React.cloneElement(element.props.children,props)}},1719:function(module,exports,__webpack_require__){"use strict";var _keys=__webpack_require__(39);var _keys2=_interopRequireDefault(_keys);var _typeof2=__webpack_require__(32);var _typeof3=_interopRequireDefault(_typeof2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var memoize=__webpack_require__(405),isEqual=__webpack_require__(98);var Shortcode={},REGEXP_ATTR_STRING=/(\w+)\s*=\s*"([^"]*)"(?:\s|$)|(\w+)\s*=\s*\'([^\']*)\'(?:\s|$)|(\w+)\s*=\s*([^\s\'"]+)(?:\s|$)|"([^"]*)"(?:\s|$)|(\S+)(?:\s|$)/g,REGEXP_SHORTCODE=/\[(\[?)([^\[\]\/\s\u00a0\u200b]+)(?![\w-])([^\]\/]*(?:\/(?!\])[^\]\/]*)*?)(?:(\/)\]|\](?:([^\[]*(?:\[(?!\/\2\])[^\[]*)*)(\[\/\2\]))?)(\]?)/;Shortcode.parseAttributes=memoize(function(text){var named={},numeric=[],match;text=text.replace(/[\u00a0\u200b]/g," ");while(match=REGEXP_ATTR_STRING.exec(text)){if(match[1]){named[match[1].toLowerCase()]=match[2]}else if(match[3]){named[match[3].toLowerCase()]=match[4]}else if(match[5]){named[match[5].toLowerCase()]=match[6]}else if(match[7]){numeric.push(match[7])}else if(match[8]){numeric.push(match[8])}}return{named:named,numeric:numeric}});Shortcode.normalizeAttributes=function(attributes){var named,numeric;if("string"===typeof attributes){return Shortcode.parseAttributes(attributes)}else if(Array.isArray(attributes)){numeric=attributes}else if("object"===(typeof attributes==="undefined"?"undefined":(0,_typeof3.default)(attributes))&&isEqual((0,_keys2.default)(attributes),["named","numeric"])){return attributes}else if("object"===(typeof attributes==="undefined"?"undefined":(0,_typeof3.default)(attributes))){named=attributes}return{named:named||{},numeric:numeric||[]}};Shortcode.stringify=function(shortcode){var text="["+shortcode.tag,attributes=Shortcode.normalizeAttributes(shortcode.attrs);(0,_keys2.default)(attributes.named).forEach(function(name){var value=attributes.named[name];text+=" "+name+'="'+value+'"'});attributes.numeric.forEach(function(value){if(/\s/.test(value)){text+=' "'+value+'"'}else{text+=" "+value}});if("single"===shortcode.type){return text+"]"}else if("self-closing"===shortcode.type){return text+" /]"}text+="]";if(shortcode.content){text+=shortcode.content}return text+"[/"+shortcode.tag+"]"};Shortcode.parse=function(shortcode){var match=shortcode.match(REGEXP_SHORTCODE),type,parsed;if(!match){return null}if(match[4]){type="self-closing"}else if(match[6]){type="closed"}else{type="single"}parsed={tag:match[2],type:type};if(/\S/.test(match[3])){parsed.attrs=Shortcode.parseAttributes(match[3])}if(match[5]){parsed.content=match[5]}return parsed};Shortcode.regexp=memoize(function(tag){return new RegExp("\\[(\\[?)("+tag+")(?![\\w-])([^\\]\\/]*(?:\\/(?!\\])[^\\]\\/]*)*?)(?:(\\/)\\]|\\](?:([^\\[]*(?:\\[(?!\\/\\2\\])[^\\[]*)*)(\\[\\/\\2\\]))?)(\\]?)","g")});Shortcode.next=function(tag,text,index){var re=Shortcode.regexp(tag),match,result;re.lastIndex=index||0;match=re.exec(text);if(!match){return}if("["===match[1]&&"]"===match[7]){return Shortcode.next(tag,text,re.lastIndex)}result={index:match.index,content:match[0],shortcode:Shortcode.parse(match[0])};if(match[1]){result.content=result.content.slice(1);result.index++}if(match[7]){result.content=result.content.slice(0,-1)}return result};module.exports=Shortcode},1725:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _popover=__webpack_require__(386);var _popover2=_interopRequireDefault(_popover);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _analytics=__webpack_require__(20);var _analytics2=_interopRequireDefault(_analytics);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"InfoPopover",propTypes:{id:_react2.default.PropTypes.string,position:_react2.default.PropTypes.string,className:_react2.default.PropTypes.string,rootClassName:_react2.default.PropTypes.string,gaEventCategory:_react2.default.PropTypes.string,popoverName:_react2.default.PropTypes.string,ignoreContext:_react2.default.PropTypes.shape({getDOMNode:_react2.default.PropTypes.function})},getDefaultProps:function getDefaultProps(){return{position:"bottom"}},getInitialState:function getInitialState(){return{showPopover:false}},render:function render(){return _react2.default.createElement("span",{onClick:this._onClick,ref:"infoPopover",className:(0,_classnames2.default)("info-popover",{is_active:this.state.showPopover},this.props.className)},_react2.default.createElement(_gridicon2.default,{icon:"info-outline",size:18}),_react2.default.createElement(_popover2.default,{id:this.props.id,isVisible:this.state.showPopover,context:this.refs&&this.refs.infoPopover,ignoreContext:this.props.ignoreContext,position:this.props.position,onClose:this._onClose,className:(0,_classnames2.default)("popover","info-popover__tooltip",this.props.className),rootClassName:this.props.rootClassName},this.props.children))},_onClick:function _onClick(event){event.preventDefault();this.setState({showPopover:!this.state.showPopover},this._recordStats)},_onClose:function _onClose(){this.setState({showPopover:false},this._recordStats)},_recordStats:function _recordStats(){var _props=this.props;var gaEventCategory=_props.gaEventCategory;var popoverName=_props.popoverName;if(gaEventCategory&&popoverName){var dialogState=this.state.showPopover?" Opened":" Closed";_analytics2.default.ga.recordEvent(gaEventCategory,"InfoPopover: "+popoverName+dialogState)}}});module.exports=exports["default"]},1726:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=getStore;var _postListStore=__webpack_require__(1904);var _postListStore2=_interopRequireDefault(_postListStore);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _postListStores={};function getStore(storeId){var postStoreId=storeId||"default";if(!_postListStores[postStoreId]){_postListStores[postStoreId]=new _postListStore2.default(postStoreId)}return _postListStores[postStoreId]}getStore._reset=function(){_postListStores={}};module.exports=exports["default"]},1727:function(module,exports,__webpack_require__){"use strict";var isEqual=__webpack_require__(98),debug=__webpack_require__(3)("calypso:posts");var utils=__webpack_require__(1649),Dispatcher=__webpack_require__(42);var _posts={},PostsStore;function setPost(post){var cachedPost=PostsStore.get(post.global_ID);if(cachedPost&&isEqual(post,cachedPost)){return}_posts[post.global_ID]=post}function normalizePost(responseSource,attributes){var _ref=attributes||{};var global_ID=_ref.global_ID;if(!global_ID){debug("global_ID is required for a post",attributes);return}var cachedPost=PostsStore.get(global_ID);if(cachedPost&&responseSource==="local"){debug("existing record (%o), do not overwrite with local response",cachedPost);return}utils.normalizeSync(attributes,function(error,post){setPost(post)})}function setAll(posts,responseSource){var boundNormalizePost=normalizePost.bind(null,responseSource);posts.forEach(boundNormalizePost)}PostsStore={get:function get(globalID){return _posts[globalID]}};PostsStore.dispatchToken=Dispatcher.register(function(payload){var action=payload.action;switch(action.type){case"RECEIVE_POSTS_PAGE":case"RECEIVE_UPDATED_POSTS":if(!action.error&&action.data.posts){var responseSource=action.data.__sync&&action.data.__sync.responseSource;setAll(action.data.posts,responseSource)}break;case"RECEIVE_UPDATED_POST":if(!action.error){normalizePost("server",action.post)}break}});module.exports=PostsStore},1728:function(module,exports,__webpack_require__){"use strict";var _assign=__webpack_require__(5);var _assign2=_interopRequireDefault(_assign);var _stringify=__webpack_require__(40);var _stringify2=_interopRequireDefault(_stringify);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var debug=__webpack_require__(3)("calypso:users:actions");var Dispatcher=__webpack_require__(42),wpcom=__webpack_require__(28),UsersStore=__webpack_require__(1739);var UsersActions={fetchUsers:function fetchUsers(fetchOptions){var paginationData=UsersStore.getPaginationData(fetchOptions);if(paginationData.fetchingUsers){return}debug("fetchUsers",fetchOptions);Dispatcher.handleViewAction({type:"FETCHING_USERS",fetchOptions:fetchOptions});wpcom.site(fetchOptions.siteId).usersList(fetchOptions,function(error,data){Dispatcher.handleServerAction({type:"RECEIVE_USERS",fetchOptions:fetchOptions,data:data,error:error})})},fetchUpdated:function fetchUpdated(fetchOptions){var paginationData=UsersStore.getPaginationData(fetchOptions);if(paginationData.fetchingUsers){return}Dispatcher.handleViewAction({type:"FETCHING_UPDATED_USERS",fetchOptions:fetchOptions});var updatedFetchOptions=UsersStore.getUpdatedParams(fetchOptions);debug("Updated fetchOptions: "+(0,_stringify2.default)(updatedFetchOptions));wpcom.site(fetchOptions.siteId).usersList(updatedFetchOptions,function(error,data){Dispatcher.handleServerAction({type:"RECEIVE_UPDATED_USERS",fetchOptions:fetchOptions,data:data,error:error})})},deleteUser:function deleteUser(siteId,userId,reassignUserId){debug("deleteUser",userId);var user=UsersStore.getUser(siteId,userId);if(!user){return}Dispatcher.handleViewAction({type:"DELETE_SITE_USER",siteId:siteId,user:user});var attributes=void 0;if("undefined"!==typeof reassignUserId){attributes={reassign:reassignUserId}}wpcom.undocumented().site(siteId).deleteUser(userId,attributes,function(error,data){if(error||!data.success){Dispatcher.handleServerAction({type:"RECEIVE_DELETE_SITE_USER_FAILURE",action:"DELETE_SITE_USER",siteId:siteId,user:user,error:error})}else{Dispatcher.handleServerAction({type:"RECEIVE_DELETE_SITE_USER_SUCCESS",action:"DELETE_SITE_USER",siteId:siteId,user:user,data:data})}})},updateUser:function updateUser(siteId,userId,attributes){debug("updateUser",userId);var user=UsersStore.getUser(siteId,userId),updatedUser=(0,_assign2.default)(user,attributes);if(!user){return}Dispatcher.handleViewAction({type:"UPDATE_SITE_USER",siteId:siteId,user:updatedUser});wpcom.undocumented().site(siteId).updateUser(userId,attributes,function(error,data){if(error){debug("Update user error",error);Dispatcher.handleServerAction({type:"RECEIVE_UPDATE_SITE_USER_FAILURE",action:"UPDATE_SITE_USER",siteId:siteId,user:user,error:error})}else{Dispatcher.handleServerAction({type:"RECEIVE_UPDATE_SITE_USER_SUCCESS",action:"UPDATE_SITE_USER",siteId:siteId,user:user,data:data})}})},fetchUser:function fetchUser(fetchOptions,login){debug("fetchUser",fetchOptions);Dispatcher.handleViewAction({type:"FETCHING_USERS",fetchOptions:fetchOptions});wpcom.undocumented().site(fetchOptions.siteId).getUser(login,function(error,data){if(error){Dispatcher.handleServerAction({type:"RECEIVE_USER_FAILED",fetchOptions:fetchOptions,siteId:fetchOptions.siteId,login:login,error:error})}else{Dispatcher.handleServerAction({type:"RECEIVE_SINGLE_USER",fetchOptions:fetchOptions,user:data})}})}};module.exports=UsersActions},1732:function(module,exports){"use strict";var tester=/^[-!#$%&'*+\/0-9=?A-Z^_a-z{|}~](\.?[-!#$%&'*+\/0-9=?A-Z^_a-z`{|}~])*@[a-zA-Z0-9](-?[a-zA-Z0-9])*(\.[a-zA-Z](-?[a-zA-Z0-9])*)+$/;function validate(email){if(email.length>254)return false;var valid=tester.test(email);if(!valid)return false;var parts=email.split("@");if(parts[0].length>64)return false;var domainParts=parts[1].split(".");if(domainParts.some(function(part){return part.length>63}))return false;return true}exports.validate=validate},1739:function(module,exports,__webpack_require__){"use strict";var _set=__webpack_require__(748);var _set2=_interopRequireDefault(_set);var _keys=__webpack_require__(39);var _keys2=_interopRequireDefault(_keys);var _assign=__webpack_require__(5);var _assign2=_interopRequireDefault(_assign);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var debug=__webpack_require__(3)("calypso:users:store"),omit=__webpack_require__(18),find=__webpack_require__(27),endsWith=__webpack_require__(283);var Dispatcher=__webpack_require__(42),emitter=__webpack_require__(36),deterministicStringify=__webpack_require__(746);var _fetchingUsersByNamespace={},_fetchingUpdatedUsersByNamespace={},_usersBySite={},_totalUsersByNamespace={},_usersFetchedByNamespace={},_offsetByNamespace={},_userIDsByNamespace={};var UsersStore={getPaginationData:function getPaginationData(fetchOptions){var namespace=getNamespace(fetchOptions);debug("getPaginationData:",namespace);return{fetchInitialized:_usersFetchedByNamespace.hasOwnProperty(namespace),totalUsers:_totalUsersByNamespace[namespace]||0,fetchingUsers:_fetchingUsersByNamespace[namespace]||false,usersCurrentOffset:_offsetByNamespace[namespace],numUsersFetched:_usersFetchedByNamespace[namespace],fetchNameSpace:namespace}},getUsers:function getUsers(fetchOptions){var namespace=getNamespace(fetchOptions),siteId=fetchOptions.siteId,users=[];debug("getUsers:",namespace);if(!_usersBySite[siteId]){_usersBySite[siteId]={}}if(!_userIDsByNamespace[namespace]){return users}_userIDsByNamespace[namespace].forEach(function(userId){if(_usersBySite[siteId][userId]){users.push(_usersBySite[siteId][userId])}});return users},getUser:function getUser(siteId,userId){if(!_usersBySite[siteId]||!_usersBySite[siteId][userId]){return null}return _usersBySite[siteId][userId]},getUserByLogin:function getUserByLogin(siteId,login){return find(_usersBySite[siteId],function(user){return user.login===login})},getUpdatedParams:function getUpdatedParams(fetchOptions){var namespace=getNamespace(fetchOptions);var requestNumber=_usersFetchedByNamespace[namespace]||fetchOptions.number;return(0,_assign2.default)({},fetchOptions,{offset:0,number:Math.min(requestNumber,1e3)})},emitChange:function emitChange(){this.emit("change")}};function updateUser(siteId,id,user){if(!_usersBySite[siteId]){_usersBySite[siteId]={}}if(!_usersBySite[siteId][id]){_usersBySite[siteId][id]={}}_usersBySite[siteId][id]=(0,_assign2.default)({},_usersBySite[siteId][id],user)}function decrementPaginationData(siteId,userId){(0,_keys2.default)(_userIDsByNamespace).forEach(function(namespace){if(endsWith(namespace,"siteId="+siteId)&&_userIDsByNamespace[namespace].has(userId)){_totalUsersByNamespace[namespace]--;_usersFetchedByNamespace[namespace]--}})}function incrementPaginationData(siteId,userId){(0,_keys2.default)(_userIDsByNamespace).forEach(function(namespace){if(endsWith(namespace,"siteId="+siteId)&&_userIDsByNamespace[namespace].has(userId)){_totalUsersByNamespace[namespace]++;_usersFetchedByNamespace[namespace]++}})}function deleteUserFromSite(siteId,userId){if(!_usersBySite[siteId]||!_usersBySite[siteId][userId]){return}delete _usersBySite[siteId][userId];decrementPaginationData(siteId,userId)}function deleteUserFromNamespaces(siteId,userId){(0,_keys2.default)(_userIDsByNamespace).forEach(function(namespace){if(endsWith(namespace,"siteId="+siteId)&&_userIDsByNamespace[namespace].has(userId)){_userIDsByNamespace[namespace].delete(userId)}})}function addSingleUser(fetchOptions,user,namespace){if(!_userIDsByNamespace[namespace]){_userIDsByNamespace[namespace]=new _set2.default}_userIDsByNamespace[namespace].add(user.ID);updateUser(fetchOptions.siteId,user.ID,user)}function updateUsers(fetchOptions,users,total){var namespace=getNamespace(fetchOptions),offset=fetchOptions.offset;debug("updateUsers:",namespace);if(!offset){_userIDsByNamespace[namespace]=new _set2.default}users.forEach(function(user){_userIDsByNamespace[namespace].add(user.ID);updateUser(fetchOptions.siteId,user.ID,user)});_totalUsersByNamespace[namespace]=total;_offsetByNamespace[namespace]=offset;_usersFetchedByNamespace[namespace]=_userIDsByNamespace[namespace].size}function getNamespace(fetchOptions){return deterministicStringify(omit(fetchOptions,["number","offset"]))}UsersStore.dispatchToken=Dispatcher.register(function(payload){var action=payload.action,namespace;switch(action.type){case"RECEIVE_USERS":namespace=getNamespace(action.fetchOptions);_fetchingUsersByNamespace[namespace]=false;if(!action.error){updateUsers(action.fetchOptions,action.data.users,action.data.found);UsersStore.emitChange()}break;case"RECEIVE_UPDATED_USERS":namespace=getNamespace(action.fetchOptions);_fetchingUpdatedUsersByNamespace[namespace]=false;if(!action.error){updateUsers(action.fetchOptions,action.data.users,action.data.found);UsersStore.emitChange()}break;case"UPDATE_SITE_USER":updateUser(action.siteId,action.user.ID,action.user);UsersStore.emitChange();break;case"RECEIVE_UPDATE_SITE_USER_FAILURE":updateUser(action.siteId,action.user.ID,action.user);UsersStore.emitChange();break;case"DELETE_SITE_USER":deleteUserFromSite(action.siteId,action.user.ID);UsersStore.emitChange();break;case"RECEIVE_DELETE_SITE_USER_SUCCESS":deleteUserFromNamespaces(action.siteId,action.user.ID);UsersStore.emitChange();break;case"RECEIVE_DELETE_SITE_USER_FAILURE":updateUser(action.siteId,action.user.ID,action.user);incrementPaginationData(action.siteId,action.user.ID);UsersStore.emitChange();break;case"FETCHING_USERS":namespace=getNamespace(action.fetchOptions);_fetchingUsersByNamespace[namespace]=true;UsersStore.emitChange();break;case"FETCHING_UPDATED_USERS":namespace=getNamespace(action.fetchOptions);_fetchingUpdatedUsersByNamespace[namespace]=true;UsersStore.emitChange();break;case"RECEIVE_SINGLE_USER":namespace=getNamespace(action.fetchOptions);_fetchingUsersByNamespace[namespace]=false;addSingleUser(action.fetchOptions,action.user,namespace);UsersStore.emitChange();break;case"RECEIVE_USER_FAILED":namespace=getNamespace(action.fetchOptions);_fetchingUsersByNamespace[namespace]=false;UsersStore.emitChange();break}});emitter(UsersStore);module.exports=UsersStore},1742:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getTermsForQueryIgnoringPage=exports.getTermsForQuery=undefined;var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);exports.isRequestingTermsForQuery=isRequestingTermsForQuery;exports.isRequestingTermsForQueryIgnoringPage=isRequestingTermsForQueryIgnoringPage;exports.getTermsLastPageForQuery=getTermsLastPageForQuery;exports.getTerms=getTerms;exports.getTerm=getTerm;var _get=__webpack_require__(24);var _get2=_interopRequireDefault(_get);var _range=__webpack_require__(735);var _range2=_interopRequireDefault(_range);var _createSelector=__webpack_require__(100);var _createSelector2=_interopRequireDefault(_createSelector);var _utils=__webpack_require__(777);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function isRequestingTermsForQuery(state,siteId,taxonomy,query){var serializedQuery=(0,_utils.getSerializedTermsQuery)(query);return!!(0,_get2.default)(state.terms.queryRequests,[siteId,taxonomy,serializedQuery])}function isRequestingTermsForQueryIgnoringPage(state,siteId,taxonomy,query){var lastPage=getTermsLastPageForQuery(state,siteId,taxonomy,query);if(null===lastPage){return false}return(0,_range2.default)(1,lastPage+1).some(function(page){var termsQuery=(0,_extends3.default)({},query,{page:page});return isRequestingTermsForQuery(state,siteId,taxonomy,termsQuery)})}var getTermsForQuery=exports.getTermsForQuery=(0,_createSelector2.default)(function(state,siteId,taxonomy,query){var manager=(0,_get2.default)(state.terms.queries,[siteId,taxonomy]);if(!manager){return null}return manager.getItems(query)},function(state,siteId,taxonomy){return(0,_get2.default)(state.terms.queries,[siteId,taxonomy])},function(state,siteId,taxonomy,query){var serializedQuery=(0,_utils.getSerializedTermsQuery)(query);return[siteId,taxonomy,serializedQuery].join()});var getTermsForQueryIgnoringPage=exports.getTermsForQueryIgnoringPage=(0,_createSelector2.default)(function(state,siteId,taxonomy,query){var manager=(0,_get2.default)(state.terms.queries,[siteId,taxonomy]);if(!manager){return null}return manager.getItemsIgnoringPage(query)},function(state,siteId,taxonomy){return(0,_get2.default)(state.terms.queries,[siteId,taxonomy])},function(state,siteId,taxonomy,query){var serializedQuery=(0,_utils.getSerializedTermsQueryWithoutPage)(query);return[siteId,taxonomy,serializedQuery].join()});function getTermsLastPageForQuery(state,siteId,taxonomy,query){var manager=(0,_get2.default)(state.terms.queries,[siteId,taxonomy]);if(!manager){return null}var pages=manager.getNumberOfPages(query);if(null===pages){return null}return Math.max(pages,1)}function getTerms(state,siteId,taxonomy){var manager=(0,_get2.default)(state.terms.queries,[siteId,taxonomy]);if(!manager){return null}return manager.getItems()}function getTerm(state,siteId,taxonomy,termId){var manager=(0,_get2.default)(state.terms.queries,[siteId,taxonomy]);if(!manager){return null}var term=manager.getItem(termId);if(!term){return null}return term}},1744:function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;(function(){"use strict";var hasOwn={}.hasOwnProperty;function classNames(){var classes=[];for(var i=0;i<arguments.length;i++){var arg=arguments[i];if(!arg)continue;var argType=typeof arg;if(argType==="string"||argType==="number"){classes.push(arg)}else if(Array.isArray(arg)){classes.push(classNames.apply(null,arg))}else if(argType==="object"){for(var key in arg){if(hasOwn.call(arg,key)&&arg[key]){classes.push(key)}}}}return classes.join(" ")}if(typeof module!=="undefined"&&module.exports){module.exports=classNames}else if(true){!(__WEBPACK_AMD_DEFINE_ARRAY__=[],__WEBPACK_AMD_DEFINE_RESULT__=function(){return classNames}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}else{window.classNames=classNames}})()},1745:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var FormToggle=function(_PureComponent){(0,_inherits3.default)(FormToggle,_PureComponent);function FormToggle(){(0,_classCallCheck3.default)(this,FormToggle);var _this=(0,_possibleConstructorReturn3.default)(this,(FormToggle.__proto__||(0,_getPrototypeOf2.default)(FormToggle)).apply(this,arguments));_this.onKeyDown=_this.onKeyDown.bind(_this);_this.onClick=_this.onClick.bind(_this);return _this}(0,_createClass3.default)(FormToggle,[{key:"componentWillMount",value:function componentWillMount(){this.id=this.constructor.idNum++}},{key:"onKeyDown",value:function onKeyDown(event){if(this.props.disabled){return}if(event.key==="Enter"||event.key===" "){event.preventDefault();this.props.onChange()}this.props.onKeyDown(event)}},{key:"onClick",value:function onClick(){if(!this.props.disabled){this.props.onChange()}}},{key:"render",value:function render(){var id=this.props.id||"toggle-"+this.id;var toggleClasses=(0,_classnames2.default)("form-toggle",this.props.className,{"is-toggling":this.props.toggling});return _react2.default.createElement("span",null,_react2.default.createElement("input",{className:toggleClasses,type:"checkbox",checked:this.props.checked,readOnly:true,disabled:this.props.disabled}),_react2.default.createElement("label",{className:"form-toggle__label",htmlFor:id},_react2.default.createElement("span",{className:"form-toggle__switch",disabled:this.props.disabled,id:id,onClick:this.onClick,onKeyDown:this.onKeyDown,role:"checkbox","aria-checked":this.props.checked,"aria-label":this.props["aria-label"],tabIndex:this.props.disabled?-1:0}),this.props.children))}}]);return FormToggle}(_react.PureComponent);FormToggle.propTypes={onChange:_react.PropTypes.func,onKeyDown:_react.PropTypes.func,checked:_react.PropTypes.bool,disabled:_react.PropTypes.bool,id:_react.PropTypes.string,className:_react.PropTypes.string,toggling:_react.PropTypes.bool,"aria-label":_react.PropTypes.string,children:_react.PropTypes.node};FormToggle.defaultProps={checked:false,disabled:false,onKeyDown:function onKeyDown(){},onChange:function onChange(){}};FormToggle.idNum=0;exports.default=FormToggle;module.exports=exports["default"]},1759:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"section",render:function render(){return _react2.default.createElement("section",{className:(0,_classnames2.default)("accordion__section",this.props.className)},this.props.children)}});module.exports=exports["default"]},1765:function(module,exports,__webpack_require__){"use strict";var throttle=__webpack_require__(388),SCROLL_CHECK_RATE_IN_MS=400;module.exports=function(nextPageMethod){return{componentDidMount:function componentDidMount(){this.checkScrollPositionHandler=throttle(this.checkScrollPosition.bind(this,{triggeredByScroll:true}),SCROLL_CHECK_RATE_IN_MS);window.addEventListener("scroll",this.checkScrollPositionHandler);this.checkScrollPosition({triggeredByScroll:false})},componentDidUpdate:function componentDidUpdate(){this.checkScrollPosition({triggeredByScroll:false})},componentWillUnmount:function componentWillUnmount(){window.removeEventListener("scroll",this.checkScrollPositionHandler)},checkScrollPosition:function checkScrollPosition(options){var scrollPosition=window.pageYOffset,documentHeight=document.body.scrollHeight,viewportHeight=window.innerHeight,scrollOffset=2*viewportHeight,triggeredByScroll=options.triggeredByScroll,self=this;if(scrollPosition>=documentHeight-viewportHeight-scrollOffset){if(scrollPosition>viewportHeight){triggeredByScroll=true}setTimeout(function(){self[nextPageMethod]({triggeredByScroll:triggeredByScroll})},0)}}}}},1772:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1);var Gridicon=__webpack_require__(26);module.exports=React.createClass({displayName:"MediaLibraryListItemFileDetails",propTypes:{media:React.PropTypes.object,scale:React.PropTypes.number,icon:React.PropTypes.string},getDefaultProps:function getDefaultProps(){return{icon:"pages"}},render:function render(){return React.createElement("div",{className:"media-library__list-item-file-details media-library__list-item-centered"},React.createElement("div",{className:"media-library__list-item-icon"},React.createElement(Gridicon,{icon:this.props.icon})),React.createElement("div",{className:"media-library__list-item-file-name",style:{fontSize:12*(1+this.props.scale)}},this.props.media.title),React.createElement("hr",{className:"media-library__list-item-details-separator"}),React.createElement("div",{className:"media-library__list-item-file-extension",style:{fontSize:9*(1+this.props.scale)}},(this.props.media.extension||"").toUpperCase()))}})},1779:function(module,exports,__webpack_require__){"use strict";var _noop2=__webpack_require__(38);var _noop3=_interopRequireDefault(_noop2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}module.exports=_react2.default.createClass({displayName:"Accordion",propTypes:{initialExpanded:_react2.default.PropTypes.bool,onToggle:_react2.default.PropTypes.func,title:_react2.default.PropTypes.string.isRequired,subtitle:_react2.default.PropTypes.string,icon:_react2.default.PropTypes.oneOfType([_react2.default.PropTypes.string,_react2.default.PropTypes.element])},getInitialState:function getInitialState(){return{isExpanded:this.props.initialExpanded}},getDefaultProps:function getDefaultProps(){return{onToggle:_noop3.default}},toggleExpanded:function toggleExpanded(){var isExpanded=!this.state.isExpanded;this.setState({isExpanded:isExpanded});this.props.onToggle(isExpanded)},renderIcon:function renderIcon(){if(!this.props.icon){return}if("string"===typeof this.props.icon){return _react2.default.createElement("span",{className:(0,_classnames2.default)("accordion__icon",this.props.icon)})}return _react2.default.createElement("span",{className:"accordion__icon"},this.props.icon)},renderSubtitle:function renderSubtitle(){if(this.props.subtitle){return _react2.default.createElement("span",{className:"accordion__subtitle"},this.props.subtitle)}},renderHeader:function renderHeader(){var classes=(0,_classnames2.default)("accordion__header",{"has-icon":!!this.props.icon,"has-subtitle":!!this.props.subtitle});return _react2.default.createElement("header",{className:classes},_react2.default.createElement("button",{type:"button",onTouchTap:this.toggleExpanded,className:"accordion__toggle"},this.renderIcon(),_react2.default.createElement("span",{className:"accordion__title"},this.props.title),this.renderSubtitle()))},render:function render(){var classes=(0,_classnames2.default)("accordion",this.props.className,{
"is-expanded":this.state.isExpanded});return _react2.default.createElement("div",{className:classes},this.renderHeader(),_react2.default.createElement("div",{ref:"content",className:"accordion__content"},_react2.default.createElement("div",{className:"accordion__content-wrap"},this.props.children)))}})},1780:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _omit=__webpack_require__(18);var _omit2=_interopRequireDefault(_omit);var _noop=__webpack_require__(38);var _noop2=_interopRequireDefault(_noop);var _formTextarea=__webpack_require__(1668);var _formTextarea2=_interopRequireDefault(_formTextarea);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"CountedTextarea",propTypes:{value:_react2.default.PropTypes.string,placeholder:_react2.default.PropTypes.string,countPlaceholderLength:_react2.default.PropTypes.bool,onChange:_react2.default.PropTypes.func,acceptableLength:_react2.default.PropTypes.number,showRemainingCharacters:_react2.default.PropTypes.bool},getDefaultProps:function getDefaultProps(){return{value:"",placeholder:"",countPlaceholderLength:false,onChange:_noop2.default,showRemainingCharacters:false}},renderCountPanel:function renderCountPanel(){var length=this.props.value.length;if(!length&&this.props.countPlaceholderLength){length=this.props.placeholder.length}var panelText=void 0;if(this.props.showRemainingCharacters&&this.props.acceptableLength){panelText=this.translate("%d character remaining","%d characters remaining",{context:"Input length",args:[this.props.acceptableLength-length],count:this.props.acceptableLength-length})}else{panelText=this.translate("%d character","%d characters",{context:"Input length",args:[length],count:length})}return _react2.default.createElement("div",{className:"counted-textarea__count-panel"},panelText,this.props.children)},render:function render(){var classes=(0,_classnames2.default)("counted-textarea",this.props.className,{"is-exceeding-acceptable-length":this.props.acceptableLength&&this.props.value.length>this.props.acceptableLength});return _react2.default.createElement("div",{className:classes},_react2.default.createElement(_formTextarea2.default,(0,_extends3.default)({},(0,_omit2.default)(this.props,"className","acceptableLength","showRemainingCharacters","children","countPlaceholderLength"),{className:"counted-textarea__input"})),this.renderCountPanel())}});module.exports=exports["default"]},1782:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _assign=__webpack_require__(34);var _assign2=_interopRequireDefault(_assign);var _noop=__webpack_require__(38);var _noop2=_interopRequireDefault(_noop);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"TrackInputChanges",propTypes:{onNewValue:_react2.default.PropTypes.func},getDefaultProps:function getDefaultProps(){return{onNewValue:_noop2.default}},componentWillMount:function componentWillMount(){this.inputEdited=false},onInputChange:function onInputChange(){this.inputEdited=true},onInputBlur:function onInputBlur(event){if(this.inputEdited){this.props.onNewValue(event);this.inputEdited=false}},render:function render(){var _this=this;var child=_react2.default.Children.only(this.props.children);var props=(0,_assign2.default)({},child.props,{onChange:function onChange(event){if(typeof child.props.onChange==="function"){child.props.onChange.call(child,event)}_this.onInputChange(event)},onBlur:function onBlur(event){if(typeof child.props.onBlur==="function"){child.props.onBlur.call(child,event)}_this.onInputBlur(event)}});return _react2.default.cloneElement(child,props)}});module.exports=exports["default"]},1784:function(module,exports,__webpack_require__){"use strict";var map=__webpack_require__(45);var MediaStore=__webpack_require__(1717),Dispatcher=__webpack_require__(42),emitter=__webpack_require__(36);var MediaLibrarySelectedStore={_media:{}};function ensureSelectedItemsForSiteId(siteId){if(siteId in MediaLibrarySelectedStore._media){return}MediaLibrarySelectedStore._media[siteId]=[]}function setSelectedItems(siteId,items){MediaLibrarySelectedStore._media[siteId]=map(items,"ID")}function addSingle(siteId,item){ensureSelectedItemsForSiteId(siteId);MediaLibrarySelectedStore._media[siteId].push(item.ID)}function receiveSingle(siteId,item,itemId){var index;if(!itemId){itemId=item.ID}if(!itemId||!(siteId in MediaLibrarySelectedStore._media)){return}index=MediaLibrarySelectedStore._media[siteId].indexOf(itemId);if(-1===index){return}MediaLibrarySelectedStore._media[siteId].splice(index,1,item.ID)}function receiveMany(siteId,items){items.forEach(function(item){receiveSingle(siteId,item)})}function removeSingle(siteId,item){var index;if(!(siteId in MediaLibrarySelectedStore._media)){return}index=MediaLibrarySelectedStore._media[siteId].indexOf(item.ID);if(-1!==index){MediaLibrarySelectedStore._media[siteId].splice(index,1)}}emitter(MediaLibrarySelectedStore);MediaLibrarySelectedStore.get=function(siteId,itemId){return MediaStore.get(siteId,itemId)};MediaLibrarySelectedStore.getAll=function(siteId){if(!(siteId in MediaLibrarySelectedStore._media)){return[]}return MediaLibrarySelectedStore._media[siteId].map(function(itemId){return MediaStore.get(siteId,itemId)})};MediaLibrarySelectedStore.dispatchToken=Dispatcher.register(function(payload){var action=payload.action;Dispatcher.waitFor([MediaStore.dispatchToken]);switch(action.type){case"SET_MEDIA_LIBRARY_SELECTED_ITEMS":if(action.error||!action.siteId||!action.data||!Array.isArray(action.data)){break}setSelectedItems(action.siteId,action.data);MediaLibrarySelectedStore.emit("change");break;case"CREATE_MEDIA_ITEM":if(!action.error&&action.siteId&&action.data){addSingle(action.siteId,action.data);MediaLibrarySelectedStore.emit("change")}break;case"RECEIVE_MEDIA_ITEM":if(action.error&&action.siteId&&action.id){removeSingle(action.siteId,{ID:action.id});MediaLibrarySelectedStore.emit("change")}if(!action.siteId||!action.data||action.error){break}receiveSingle(action.siteId,action.data,action.id);MediaLibrarySelectedStore.emit("change");break;case"RECEIVE_MEDIA_ITEMS":if(!action.error&&action.siteId&&action.data&&action.data.media){receiveMany(action.siteId,action.data.media);MediaLibrarySelectedStore.emit("change")}break;case"REMOVE_MEDIA_ITEM":if(!action.siteId||!action.data||action.error){break}removeSingle(action.siteId,action.data);MediaLibrarySelectedStore.emit("change");break}});module.exports=MediaLibrarySelectedStore},1785:function(module,exports,__webpack_require__){"use strict";var _keys=__webpack_require__(39);var _keys2=_interopRequireDefault(_keys);var _mapValues=__webpack_require__(93);var _mapValues2=_interopRequireDefault(_mapValues);var _without=__webpack_require__(172);var _without2=_interopRequireDefault(_without);var _isEmpty=__webpack_require__(80);var _isEmpty2=_interopRequireDefault(_isEmpty);var _pickBy=__webpack_require__(213);var _pickBy2=_interopRequireDefault(_pickBy);var _get=__webpack_require__(24);var _get2=_interopRequireDefault(_get);var _dispatcher=__webpack_require__(42);var _dispatcher2=_interopRequireDefault(_dispatcher);var _emitter=__webpack_require__(36);var _emitter2=_interopRequireDefault(_emitter);var _sitesList=__webpack_require__(53);var _sitesList2=_interopRequireDefault(_sitesList);var _utils=__webpack_require__(1647);var _utils2=_interopRequireDefault(_utils);var _constants=__webpack_require__(1716);var _constants2=__webpack_require__(135);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var MediaValidationStore={_errors:{}};var sites=(0,_sitesList2.default)();(0,_emitter2.default)(MediaValidationStore);function ensureErrorsObjectForSite(siteId){if(siteId in MediaValidationStore._errors){return}MediaValidationStore._errors[siteId]={}}MediaValidationStore.validateItem=function(siteId,item){var site=sites.getSite(siteId),itemErrors=[];if(!site){return}if(!_utils2.default.isSupportedFileTypeForSite(item,site)){if((0,_get2.default)(site,"plan.product_slug")===_constants2.PLAN_FREE&&_utils2.default.isSupportedFileTypeInPremium(item,site)){itemErrors.push(_constants.ValidationErrors.FILE_TYPE_NOT_IN_PLAN)}else{itemErrors.push(_constants.ValidationErrors.FILE_TYPE_UNSUPPORTED)}}if(true===_utils2.default.isExceedingSiteMaxUploadSize(item.size,site)){itemErrors.push(_constants.ValidationErrors.EXCEEDS_MAX_UPLOAD_SIZE)}if(itemErrors.length){ensureErrorsObjectForSite(siteId);MediaValidationStore._errors[siteId][item.ID]=itemErrors}};MediaValidationStore.clearValidationErrors=function(siteId,itemId){if(!(siteId in MediaValidationStore._errors)){return}if(itemId){delete MediaValidationStore._errors[siteId][itemId]}else{delete MediaValidationStore._errors[siteId]}};MediaValidationStore.clearValidationErrorsByType=function(siteId,errorType){if(!(siteId in MediaValidationStore._errors)){return}MediaValidationStore._errors[siteId]=(0,_pickBy2.default)((0,_mapValues2.default)(MediaValidationStore._errors[siteId],function(errors){return(0,_without2.default)(errors,errorType)}),function(errors){return!(0,_isEmpty2.default)(errors)})};function receiveServerError(siteId,itemId,errors){ensureErrorsObjectForSite(siteId);MediaValidationStore._errors[siteId][itemId]=errors.map(function(error){switch(error.error){case"http_404":return _constants.ValidationErrors.UPLOAD_VIA_URL_404;case"upload_error":if(error.message.indexOf("Not enough space to upload")===0){return _constants.ValidationErrors.NOT_ENOUGH_SPACE}if(error.message.indexOf("You have used your space quota")===0){return _constants.ValidationErrors.EXCEEDS_PLAN_STORAGE_LIMIT}return _constants.ValidationErrors.SERVER_ERROR;default:return _constants.ValidationErrors.SERVER_ERROR}})}MediaValidationStore.getAllErrors=function(siteId){return MediaValidationStore._errors[siteId]||{}};MediaValidationStore.getErrors=function(siteId,itemId){if(!(siteId in MediaValidationStore._errors)){return[]}return MediaValidationStore._errors[siteId][itemId]||[]};MediaValidationStore.hasErrors=function(siteId,itemId){if(itemId){return MediaValidationStore.getErrors(siteId,itemId).length}return(0,_keys2.default)(MediaValidationStore.getAllErrors(siteId)).length};MediaValidationStore.dispatchToken=_dispatcher2.default.register(function(payload){var action=payload.action,items,errors;switch(action.type){case"CREATE_MEDIA_ITEM":if(!action.siteId||!action.data){break}items=Array.isArray(action.data.media)?action.data.media:[action.data];errors=items.reduce(function(memo,item){var itemErrors;MediaValidationStore.validateItem(action.siteId,item);itemErrors=MediaValidationStore.getErrors(action.siteId,item.ID);if(itemErrors.length){memo[item.ID]=itemErrors}return memo},{});if(errors&&(0,_keys2.default)(errors).length){action.error=MediaValidationStore.getAllErrors(action.siteId);MediaValidationStore.emit("change")}break;case"RECEIVE_MEDIA_ITEM":case"RECEIVE_MEDIA_ITEMS":if(!action.error||!action.id){break}if(Array.isArray(action.error.errors)){errors=action.error.errors}else{errors=[action.error]}receiveServerError(action.siteId,action.id,errors);MediaValidationStore.emit("change");break;case"CLEAR_MEDIA_VALIDATION_ERRORS":if(!action.siteId){break}if(action.errorType){MediaValidationStore.clearValidationErrorsByType(action.siteId,action.errorType)}else{MediaValidationStore.clearValidationErrors(action.siteId,action.itemId)}MediaValidationStore.emit("change");break}});module.exports=MediaValidationStore},1788:function(module,exports,__webpack_require__){"use strict";var some=__webpack_require__(63),flatten=__webpack_require__(392),filter=__webpack_require__(77),uniq=__webpack_require__(223);var connectionsList=__webpack_require__(1840)(),sites=__webpack_require__(53)(),user=__webpack_require__(48)(),services=__webpack_require__(2126);module.exports={isServiceInConnections:function isServiceInConnections(serviceName,connections){var isInConnections=Array.isArray(connections)&&some(connections,{service:serviceName});return this.filter("isServiceInConnections",serviceName,isInConnections,arguments)},isExternalUserInConnections:function isExternalUserInConnections(keyringConnectionId,externalUserId,connections){return some(connections,{keyring_connection_ID:keyringConnectionId,external_ID:externalUserId})},isServiceForPublicize:function isServiceForPublicize(serviceName){return this.filter("isServiceForPublicize",serviceName,true,arguments)},supportsMultipleConnectionsPerSite:function supportsMultipleConnectionsPerSite(serviceName){var supportsMultipleConnections=this.isServiceForPublicize(serviceName);return this.filter("supportsMultipleConnectionsPerSite",serviceName,supportsMultipleConnections,arguments)},isServiceConnected:function isServiceConnected(serviceName,siteId){var currentUser=user.get(),isConnected;if(!siteId&&sites.selected){siteId=sites.getSelectedSite().ID}isConnected=currentUser&&this.isServiceInConnections(serviceName,this.getConnections(serviceName,siteId));return this.filter("isServiceConnected",serviceName,isConnected,arguments)},isFetchingAccounts:function isFetchingAccounts(){return!connectionsList.initialized},getConnectionStatus:function getConnectionStatus(serviceName,siteId){var status;if(!siteId&&sites.selected){siteId=sites.getSelectedSite().ID}if(this.isFetchingAccounts()){status="unknown"}else if(!this.isServiceConnected(serviceName,siteId)){status="not-connected"}else if(some(this.getConnections(serviceName,siteId),{status:"broken",keyring_connection_user_ID:user.get().ID})){status="reconnect"}else{status="connected"}return this.filter("getConnectionStatus",serviceName,status,arguments)},getConnectionsAvailableToCurrentUser:function getConnectionsAvailableToCurrentUser(serviceName,connections){var currentUser=user.get();if(!currentUser){return[]}return connections.filter(function(connection){return connection.service===serviceName&&(connection.keyring_connection_user_ID===currentUser.ID||connection.shared)})},getConnections:function getConnections(serviceName,siteId){var currentUser=user.get(),connections;if(currentUser){if(!siteId&&sites.selected){siteId=sites.getSelectedSite().ID}if(!this.isServiceForPublicize(serviceName)){siteId=null}connections=connectionsList.get(siteId);connections=this.getConnectionsAvailableToCurrentUser(serviceName,connections)}else{connections=[]}return this.filter("getConnections",serviceName,connections,arguments)},getServicesFromConnections:function getServicesFromConnections(connections){return uniq(connections.map(function(connection){return{ID:connection.service,label:connection.label}}),"ID")},getRefreshableConnections:function getRefreshableConnections(serviceName,siteId){var connections=this.getConnections(serviceName,siteId).filter(function(connection){return"broken"===connection.status&&connection.keyring_connection_user_ID===user.get().ID},this);return this.filter("getRefreshableConnections",serviceName,connections,arguments)},getRemovableConnections:function getRemovableConnections(serviceName,siteId){var connections=this.getConnections(serviceName,siteId).filter(function(connection){return this.canCurrentUserPerformActionOnConnection("delete",connection,siteId)},this);return this.filter("getRemovableConnections",serviceName,connections,arguments)},filterConnectionsToRemove:function filterConnectionsToRemove(connections,siteId){if(!Array.isArray(connections)){connections=[connections]}return connections.filter(function(connection){return this.filterConnectionToRemove(connection,siteId)},this)},filterConnectionToRemove:function filterConnectionToRemove(connection,siteId){return this.filter("filterConnectionToRemove",connection.service,true,arguments)},canCurrentUserPerformActionOnConnection:function canCurrentUserPerformActionOnConnection(action,connection,siteId){var currentUser=user.get(),site;if(!siteId&&sites.selected){siteId=sites.getSelectedSite().ID}site=sites.getSite(siteId);if(site.capabilities&&site.capabilities.edit_others_posts){return true}else{return currentUser&&"delete"===action&&connection.user_ID===currentUser.ID}},getAvailableExternalAccounts:function getAvailableExternalAccounts(serviceName,siteId){var keyringConnections=filter(connectionsList.get(),{service:serviceName}),connections=siteId?connectionsList.get(siteId):[],accounts;accounts=flatten(keyringConnections.map(function(keyringConnection){var accounts=[{name:keyringConnection.external_display||keyringConnection.external_name,picture:keyringConnection.external_profile_picture,keyringConnectionId:keyringConnection.keyring_connection_ID,isConnected:this.isExternalUserInConnections(keyringConnection.keyring_connection_ID,keyringConnection.external_ID,connections)}];keyringConnection.additional_external_users.forEach(function(externalUser){accounts.push({ID:externalUser.external_ID,name:externalUser.external_name,picture:externalUser.external_profile_picture,keyringConnectionId:keyringConnection.keyring_connection_ID,isConnected:this.isExternalUserInConnections(keyringConnection.keyring_connection_ID,externalUser.external_ID,connections),isExternal:true})},this);return accounts},this));return this.filter("getAvailableExternalAccounts",serviceName,accounts,arguments)},didKeyringConnectionSucceed:function didKeyringConnectionSucceed(serviceName,siteId){var availableExternalAccounts=this.getAvailableExternalAccounts(serviceName,siteId),isAnyConnectionOptions=some(availableExternalAccounts,{isConnected:false});if(!availableExternalAccounts.length){connectionsList.emit("create:error",{cancel:true})}else if(!isAnyConnectionOptions){connectionsList.emit("create:error",{connected:true})}return this.filter("didKeyringConnectionSucceed",serviceName,availableExternalAccounts.length&&isAnyConnectionOptions,arguments)},filter:function filter(functionName,serviceName,value,functionArguments){if(serviceName in services&&services[serviceName][functionName]){return services[serviceName][functionName].apply(this,[value].concat(Array.prototype.slice.call(functionArguments)))}return value}}},1794:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _defineProperty2=__webpack_require__(7);var _defineProperty3=_interopRequireDefault(_defineProperty2);var _extends3=__webpack_require__(16);var _extends4=_interopRequireDefault(_extends3);exports.isRequestingPostCounts=isRequestingPostCounts;exports.getAllPostCounts=getAllPostCounts;exports.getAllPostCount=getAllPostCount;exports.getMyPostCounts=getMyPostCounts;exports.getMyPostCount=getMyPostCount;exports.getNormalizedPostCounts=getNormalizedPostCounts;exports.getNormalizedMyPostCounts=getNormalizedMyPostCounts;var _get=__webpack_require__(24);var _get2=_interopRequireDefault(_get);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var POST_STATUSES=["publish","draft","pending","private","future","trash"];function isRequestingPostCounts(state,siteId,postType){return(0,_get2.default)(state.posts.counts.requesting,[siteId,postType],false)}function getAllPostCounts(state,siteId,postType){return(0,_get2.default)(state.posts.counts.counts,[siteId,postType,"all"],null)}function getAllPostCount(state,siteId,postType,status){var counts=getAllPostCounts(state,siteId,postType);if(!counts){return null}return counts[status]||0}function getMyPostCounts(state,siteId,postType){return(0,_get2.default)(state.posts.counts.counts,[siteId,postType,"mine"],null)}function getMyPostCount(state,siteId,postType,status){var counts=getMyPostCounts(state,siteId,postType);if(!counts){return null}return counts[status]||0}function getNormalizedPostCounts(state,siteId,postType){var countSelector=arguments.length>3&&arguments[3]!==undefined?arguments[3]:getAllPostCounts;var counts=countSelector(state,siteId,postType);return POST_STATUSES.reduce(function(memo,status){var count=(0,_get2.default)(counts,status,0);var key=void 0;switch(status){case"publish":case"private":key="publish";break;case"draft":case"pending":key="draft";break;default:key=status}return(0,_extends4.default)({},memo,(0,_defineProperty3.default)({},key,(memo[key]||0)+count))},{})}function getNormalizedMyPostCounts(state,siteId,postType){return getNormalizedPostCounts(state,siteId,postType,getMyPostCounts)}},1798:function(module,exports,__webpack_require__){exports.Refiner=function Refiner(){this.refine=function(text,results,opt){return results}};exports.Filter=function Filter(){exports.Refiner.call(this);this.isValid=function(text,result,opt){return true};this.refine=function(text,results,opt){var filteredResult=[];for(var i=0;i<results.length;i++){var result=results[i];if(this.isValid(text,result,opt)){filteredResult.push(result)}}return filteredResult}};exports.OverlapRemovalRefiner=__webpack_require__(3345).Refiner;exports.ExtractTimezoneOffsetRefiner=__webpack_require__(3343).Refiner;exports.ExtractTimezoneAbbrRefiner=__webpack_require__(3342).Refiner;exports.UnlikelyFormatFilter=__webpack_require__(3346).Refiner;exports.ENMergeDateTimeRefiner=__webpack_require__(3341).Refiner;exports.ENMergeDateRangeRefiner=__webpack_require__(2377).Refiner;exports.JPMergeDateRangeRefiner=__webpack_require__(3344).Refiner},1800:function(module,exports,__webpack_require__){"use strict";module.exports=__webpack_require__(3553)},1801:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};exports.default=defaultCellRangeRenderer;var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _classnames=__webpack_require__(1744);var _classnames2=_interopRequireDefault(_classnames);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function defaultCellRangeRenderer(_ref){var cellCache=_ref.cellCache;var cellClassName=_ref.cellClassName;var cellRenderer=_ref.cellRenderer;var cellStyle=_ref.cellStyle;var columnSizeAndPositionManager=_ref.columnSizeAndPositionManager;var columnStartIndex=_ref.columnStartIndex;var columnStopIndex=_ref.columnStopIndex;var horizontalOffsetAdjustment=_ref.horizontalOffsetAdjustment;var isScrolling=_ref.isScrolling;var rowSizeAndPositionManager=_ref.rowSizeAndPositionManager;var rowStartIndex=_ref.rowStartIndex;var rowStopIndex=_ref.rowStopIndex;var scrollLeft=_ref.scrollLeft;var scrollTop=_ref.scrollTop;var verticalOffsetAdjustment=_ref.verticalOffsetAdjustment;var renderedCells=[];for(var rowIndex=rowStartIndex;rowIndex<=rowStopIndex;rowIndex++){var rowDatum=rowSizeAndPositionManager.getSizeAndPositionOfCell(rowIndex);for(var columnIndex=columnStartIndex;columnIndex<=columnStopIndex;columnIndex++){var columnDatum=columnSizeAndPositionManager.getSizeAndPositionOfCell(columnIndex);var key=rowIndex+"-"+columnIndex;var cellStyleObject=cellStyle({rowIndex:rowIndex,columnIndex:columnIndex});var renderedCell=void 0;if(isScrolling){if(!cellCache[key]){cellCache[key]=cellRenderer({columnIndex:columnIndex,isScrolling:isScrolling,rowIndex:rowIndex})}renderedCell=cellCache[key]}else{renderedCell=cellRenderer({columnIndex:columnIndex,isScrolling:isScrolling,rowIndex:rowIndex})}if(renderedCell==null||renderedCell===false){continue}var className=cellClassName({columnIndex:columnIndex,rowIndex:rowIndex});var child=_react2.default.createElement("div",{key:key,className:(0,_classnames2.default)("Grid__cell",className),style:_extends({},cellStyleObject,{height:rowDatum.size,left:columnDatum.offset+horizontalOffsetAdjustment,top:rowDatum.offset+verticalOffsetAdjustment,width:columnDatum.size})},renderedCell);renderedCells.push(child)}}return renderedCells}},1802:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _react=__webpack_require__(1);var _reactRedux=__webpack_require__(15);var _selectors=__webpack_require__(79);var _actions=__webpack_require__(742);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var QuerySites=function(_Component){(0,_inherits3.default)(QuerySites,_Component);function QuerySites(){(0,_classCallCheck3.default)(this,QuerySites);return(0,_possibleConstructorReturn3.default)(this,(QuerySites.__proto__||(0,_getPrototypeOf2.default)(QuerySites)).apply(this,arguments))}(0,_createClass3.default)(QuerySites,[{key:"componentWillMount",value:function componentWillMount(){this.request(this.props)}},{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){if(nextProps.siteId!==this.props.siteId){this.request(nextProps)}}},{key:"request",value:function request(props){if(props.allSites&&!props.requestingSites){props.requestSites()}if(props.siteId&&!props.requestingSite){props.requestSite(props.siteId)}}},{key:"render",value:function render(){return null}}]);return QuerySites}(_react.Component);QuerySites.propTypes={allSites:_react.PropTypes.bool,siteId:_react.PropTypes.number,requestingSites:_react.PropTypes.bool,requestingSite:_react.PropTypes.bool,requestSites:_react.PropTypes.func,requestSite:_react.PropTypes.func};QuerySites.defaultProps={allSites:false,requestSites:function requestSites(){},requestSite:function requestSite(){}};exports.default=(0,_reactRedux.connect)(function(state,_ref){var siteId=_ref.siteId;return{requestingSites:(0,_selectors.isRequestingSites)(state),requestingSite:(0,_selectors.isRequestingSite)(state,siteId)}},{requestSites:_actions.requestSites,requestSite:_actions.requestSite})(QuerySites);module.exports=exports["default"]},1807:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1);var postListStoreFactory=__webpack_require__(1726),PostContentImagesStore=__webpack_require__(1902),Dispatcher=__webpack_require__(42),actions=__webpack_require__(1648),pollers=__webpack_require__(221);var PostListFetcher;function dispatchQueryActions(postListStoreId,query){var postListStore=postListStoreFactory(postListStoreId);actions.queryPosts(query,postListStoreId);if(postListStore.getPage()===0){actions.fetchNextPage(postListStoreId)}}function queryPosts(props){var query={type:props.type||"post",siteID:props.siteID,status:props.status,author:props.author,search:props.search,exclude_tree:props.excludeTree,orderBy:props.orderBy,order:props.order,number:props.number,before:props.before,after:props.after};if(props.withCounts){query.meta="counts"}if(Dispatcher.isDispatching()){setTimeout(function(){dispatchQueryActions(props.postListStoreId,query)},0)}else{dispatchQueryActions(props.postListStoreId,query)}}function getPostsState(postListStoreId){var postListStore=postListStoreFactory(postListStoreId);return{listId:postListStore.getID(),posts:postListStore.getAll(),postImages:PostContentImagesStore.getAll(),page:postListStore.getPage(),lastPage:postListStore.isLastPage(),loading:postListStore.isFetchingNextPage(),hasRecentError:postListStore.hasRecentError()}}function shouldQueryPosts(props,nextProps){return props.type!==nextProps.type||props.status!==nextProps.status||props.author!==nextProps.author||props.search!==nextProps.search||props.excludeTree!==nextProps.excludeTree||props.withCounts!==nextProps.withCounts||props.orderBy!==nextProps.orderBy||props.order!==nextProps.order||props.number!==nextProps.number||props.before!==nextProps.before||props.after!==nextProps.after||props.siteID!==nextProps.siteID||props.postListStoreId!==nextProps.postListStoreId}PostListFetcher=React.createClass({displayName:"PostListFetcher",propTypes:{children:React.PropTypes.element.isRequired,type:React.PropTypes.string,status:React.PropTypes.string,author:React.PropTypes.number,search:React.PropTypes.string,siteID:React.PropTypes.any,withImages:React.PropTypes.bool,withCounts:React.PropTypes.bool,excludeTree:React.PropTypes.number,orderBy:React.PropTypes.oneOf(["title","date","modified","comment_count","ID"]),order:React.PropTypes.oneOf(["ASC","DESC"]),number:React.PropTypes.number,before:React.PropTypes.string,after:React.PropTypes.string,postListStoreId:React.PropTypes.string},getDefaultProps:function getDefaultProps(){return{orderBy:"date",order:"DESC",postListStoreId:"default"}},componentWillMount:function componentWillMount(){var postListStore=postListStoreFactory(this.props.postListStoreId);postListStore.on("change",this.onPostsChange);if(this.props.withImages){PostContentImagesStore.on("change",this.onPostsChange)}queryPosts(this.props)},componentDidMount:function componentDidMount(){var postListStore=postListStoreFactory(this.props.postListStoreId);this._poller=pollers.add(postListStore,actions.fetchUpdated,{interval:6e4})},componentWillUnmount:function componentWillUnmount(){var postListStore=postListStoreFactory(this.props.postListStoreId);pollers.remove(this._poller);postListStore.off("change",this.onPostsChange);if(this.props.withImages){PostContentImagesStore.off("change",this.onPostsChange)}},componentWillReceiveProps:function componentWillReceiveProps(nextProps){var listenerChange;if(shouldQueryPosts(this.props,nextProps)){queryPosts(nextProps)}if(nextProps.withImages!==this.props.withImages){listenerChange=nextProps.withImages?"on":"off";PostContentImagesStore[listenerChange]("change",this.onPostsChange)}},onPostsChange:function onPostsChange(){this.setState(getPostsState(this.props.postListStoreId))},render:function render(){return React.cloneElement(this.props.children,this.state)}});module.exports=PostListFetcher},1808:function(module,exports,__webpack_require__){"use strict";var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}module.exports=_react2.default.createClass({displayName:"ProgressBar",getDefaultProps:function getDefaultProps(){return{total:100,compact:false,isPulsing:false}},propTypes:{value:_react2.default.PropTypes.number.isRequired,total:_react2.default.PropTypes.number,color:_react2.default.PropTypes.string,title:_react2.default.PropTypes.string,compact:_react2.default.PropTypes.bool,className:_react2.default.PropTypes.string,isPulsing:_react2.default.PropTypes.bool},renderBar:function renderBar(){var title=this.props.title?_react2.default.createElement("span",{className:"screen-reader-text"},this.props.title):null;var styles={width:Math.ceil(this.props.value/this.props.total*100)+"%"};if(this.props.color){styles.backgroundColor=this.props.color}return _react2.default.createElement("div",{className:"progress-bar__progress",style:styles},title)},render:function render(){var classes=(0,_classnames2.default)(this.props.className,"progress-bar",{"is-compact":this.props.compact,"is-pulsing":this.props.isPulsing});return _react2.default.createElement("div",{className:classes},this.renderBar())}})},1810:function(module,exports,__webpack_require__){
"use strict";var _assign=__webpack_require__(5);var _assign2=_interopRequireDefault(_assign);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var React=__webpack_require__(1),debug=__webpack_require__(3)("calypso:site-users-fetcher"),omit=__webpack_require__(18),isEqual=__webpack_require__(98),includes=__webpack_require__(30),partition=__webpack_require__(1946);var UsersStore=__webpack_require__(1739),UsersActions=__webpack_require__(1728),pollers=__webpack_require__(221);var defaultOptions={number:100,offset:0};module.exports=React.createClass({displayName:"SiteUsersFetcher",propTypes:{fetchOptions:React.PropTypes.object.isRequired,exclude:React.PropTypes.oneOfType([React.PropTypes.arrayOf(React.PropTypes.number),React.PropTypes.func])},getInitialState:function getInitialState(){return this._getState()},componentWillMount:function componentWillMount(){debug("Mounting SiteUsersFetcher");UsersStore.on("change",this._updateSiteUsers);this._fetchIfEmpty();this._poller=pollers.add(UsersStore,UsersActions.fetchUpdated.bind(UsersActions,this.props.fetchOptions,true),{leading:false})},componentWillUnmount:function componentWillUnmount(){UsersStore.off("change",this._updateSiteUsers);pollers.remove(this._poller)},componentWillReceiveProps:function componentWillReceiveProps(nextProps){if(!nextProps.fetchOptions){return}if(!isEqual(this.props.fetchOptions,nextProps.fetchOptions)){this._updateSiteUsers(nextProps.fetchOptions);this._fetchIfEmpty(nextProps.fetchOptions);pollers.remove(this._poller);this._poller=pollers.add(UsersStore,UsersActions.fetchUpdated.bind(UsersActions,nextProps.fetchOptions,true),{leading:false})}},render:function render(){var childrenProps=(0,_assign2.default)(omit(this.props,"children"),this.state);return React.cloneElement(this.props.children,childrenProps)},_updateSiteUsers:function _updateSiteUsers(fetchOptions){fetchOptions=fetchOptions||this.props.fetchOptions;this.setState(this._getState(fetchOptions))},_getState:function _getState(fetchOptions){var paginationData,users;fetchOptions=fetchOptions||this.props.fetchOptions;fetchOptions=(0,_assign2.default)({},defaultOptions,fetchOptions);paginationData=UsersStore.getPaginationData(fetchOptions);users=UsersStore.getUsers(fetchOptions);if(this.props.exclude){users=partition(users,function(user){if("function"===typeof this.props.exclude){return!this.props.exclude(user)}return!includes(this.props.exclude,user.ID)}.bind(this))}return(0,_assign2.default)({},paginationData,{users:this.props.exclude?users[0]:users,fetchOptions:fetchOptions,excludedUsers:this.props.exclude?users[1]:[]})},_fetchIfEmpty:function _fetchIfEmpty(fetchOptions){fetchOptions=fetchOptions||this.props.fetchOptions;if(!fetchOptions||!fetchOptions.siteId){return}fetchOptions=(0,_assign2.default)({},defaultOptions,fetchOptions);if(UsersStore.getUsers(fetchOptions).length){debug("initial fetch not necessary");return}setTimeout(function(){var paginationData=UsersStore.getPaginationData(fetchOptions);if(paginationData.fetchingUsers){return}UsersActions.fetchUsers(fetchOptions)},0)}})},1814:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.deserialize=deserialize;var _detectFormat=__webpack_require__(2626);var _detectFormat2=_interopRequireDefault(_detectFormat);var _strategies=__webpack_require__(2629);var _strategies2=_interopRequireDefault(_strategies);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function deserialize(node,_parsed){var format=(0,_detectFormat2.default)(node);return _strategies2.default[format.toLowerCase()].deserialize(node,_parsed)}},1833:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);exports.default={localeUtils:_react.PropTypes.shape({formatMonthTitle:_react.PropTypes.func,formatWeekdayShort:_react.PropTypes.func,formatWeekdayLong:_react.PropTypes.func,getFirstDayOfWeek:_react.PropTypes.func})}},1835:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _react=__webpack_require__(1);var _reactRedux=__webpack_require__(15);var _shallowEqual=__webpack_require__(291);var _shallowEqual2=_interopRequireDefault(_shallowEqual);var _actions=__webpack_require__(776);var _selectors=__webpack_require__(1742);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var QueryTerms=function(_Component){(0,_inherits3.default)(QueryTerms,_Component);function QueryTerms(){(0,_classCallCheck3.default)(this,QueryTerms);return(0,_possibleConstructorReturn3.default)(this,(QueryTerms.__proto__||(0,_getPrototypeOf2.default)(QueryTerms)).apply(this,arguments))}(0,_createClass3.default)(QueryTerms,[{key:"componentWillMount",value:function componentWillMount(){this.request(this.props)}},{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){if(this.props.siteId===nextProps.siteId&&this.props.taxonomy===nextProps.taxonomy&&(0,_shallowEqual2.default)(this.props.query,nextProps.query)){return}this.request(nextProps)}},{key:"request",value:function request(props){if(props.requesting||!props.siteId){return}props.requestSiteTerms(props.siteId,props.taxonomy,props.query)}},{key:"shouldComponentUpdate",value:function shouldComponentUpdate(){return false}},{key:"render",value:function render(){return null}}]);return QueryTerms}(_react.Component);QueryTerms.propTypes={siteId:_react.PropTypes.number.isRequired,taxonomy:_react.PropTypes.string.isRequired,query:_react.PropTypes.object,requesting:_react.PropTypes.bool.isRequired,requestSiteTerms:_react.PropTypes.func.isRequired};QueryTerms.defaultProps={query:{}};exports.default=(0,_reactRedux.connect)(function(state,ownProps){return{requesting:(0,_selectors.isRequestingTermsForQuery)(state,ownProps.siteId,ownProps.taxonomy,ownProps.query)}},{requestSiteTerms:_actions.requestSiteTerms})(QueryTerms);module.exports=exports["default"]},1837:function(module,exports,__webpack_require__){"use strict";var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);var _keys=__webpack_require__(39);var _keys2=_interopRequireDefault(_keys);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ReactDom=__webpack_require__(44),React=__webpack_require__(1),Clipboard=__webpack_require__(1932),omit=__webpack_require__(18),noop=__webpack_require__(38),classNames=__webpack_require__(10);var Button=__webpack_require__(69);module.exports=React.createClass({displayName:"ClipboardButton",propTypes:{className:React.PropTypes.string,text:React.PropTypes.string,onCopy:React.PropTypes.func},getDefaultProps:function getDefaultProps(){return{onCopy:noop}},componentDidMount:function componentDidMount(){var _this=this;var button=ReactDom.findDOMNode(this.refs.button);this.clipboard=new Clipboard(button,{text:function text(){return _this.props.text}});this.clipboard.on("success",this.props.onCopy);this.clipboard.on("error",this.displayPrompt)},componentWillUnmount:function componentWillUnmount(){this.clipboard.destroy();delete this.clipboard},displayPrompt:function displayPrompt(){window.prompt(this.translate("Highlight and copy the following text to your clipboard:"),this.props.text)},render:function render(){var classes=classNames("clipboard-button",this.props.className);return React.createElement(Button,(0,_extends3.default)({ref:"button"},omit(this.props,(0,_keys2.default)(this.constructor.propTypes)),{className:classes}))}})},1839:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1);var Gravatar=__webpack_require__(710);module.exports=React.createClass({displayName:"UserItem",propTypes:{user:React.PropTypes.object},render:function render(){var user=this.props.user||null,name=user?user.name:"";return React.createElement("div",{className:"user",title:name},React.createElement(Gravatar,{size:26,user:user}),React.createElement("span",{className:"user__name"},name))}})},1840:function(module,exports,__webpack_require__){"use strict";var ConnectionsList=__webpack_require__(2065),_connections;module.exports=function(){if(!_connections){_connections=new ConnectionsList}return _connections}},1846:function(module,exports,__webpack_require__){"use strict";var Traverser=__webpack_require__(1847);function TreeConvert(key){if(!(this instanceof TreeConvert)){return new TreeConvert(key)}this.key=key||"id"}TreeConvert.prototype.treeify=function(items){var tree=[],indexedNodes={};items.forEach(function(item,i){indexedNodes[items[i][this.key]]=item},this);items.forEach(function(item){var parentNode;if(item.parent>0&&indexedNodes[item.parent]){parentNode=indexedNodes[item.parent];parentNode.items=parentNode.items||[];parentNode.items.push(item)}else{item.parent=0;tree.push(item)}});this.sortItems(tree);this.removeOrderProperty(tree);return tree};TreeConvert.prototype.untreeify=function(tree,list){list=list||[];tree.forEach(function(item,index){if(item.items){TreeConvert.prototype.untreeify(item.items,list)}item.order=index+1;list.push(item)});return list};TreeConvert.prototype.sortItems=function(itemTrees){var root={};root.items=itemTrees;Traverser.traverse(root,[function(node){node.items&&node.items.sort(function(a,b){return a.order-b.order});return node}])};TreeConvert.prototype.removeOrderProperty=function(itemTrees){var root={};root.items=itemTrees;Traverser.traverse(root,[function(node){node.items&&node.items.forEach(function(item){delete item.order});return node}])};module.exports=TreeConvert},1847:function(module,exports,__webpack_require__){"use strict";var findIndex=__webpack_require__(214),some=__webpack_require__(63);function parent(node,tree){return find(tree,function(it){return some(it.items,{id:node.id})})||tree}function _traverse(node,filters,root){filters.forEach(function(filter){node=filter(node,root)},this);if(node.items){node.items=node.items.map(function(item){return _traverse(item,filters,root)})}return node}function find(node,predicate){if(predicate(node)){return node}if(node.items){return mapFindAny(node.items,function(node){return find(node,predicate)})}}function replaceItem(node,newNode,predicate){var i;if(!node.items){return}for(i=0;i<node.items.length;i++){if(predicate(node.items[i])){node.items[i]=newNode;return}replaceItem(node.items[i],newNode,predicate)}}function mapFindAny(array,fn){var i,result,length=array.length;for(i=0;i<length;i++){if(result=fn(array[i])){return result}}}function childInserter(srcNode,dstId){return function(node){if(node.id===dstId){node.items=node.items||[];node.items.push(srcNode)}return node}}function siblingInserter(srcNode,dstId,position){return function(node){var index,offset=position==="before"?0:1;if(~(index=findIndex(node.items,{id:dstId}))){node.items.splice(index+offset,0,srcNode)}return node}}module.exports={traverse:function traverse(root,filters){return _traverse(root,filters,root)},parent:parent,find:find,replaceItem:replaceItem,remover:function remover(id){return function(node){var index;if(~(index=findIndex(node.items,{id:id}))){node.items.splice(index,1)}return node}},inserter:function inserter(srcItem,dstId,position){var func="child"===position?childInserter:siblingInserter;return func(srcItem,dstId,position)}}},1860:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _promise=__webpack_require__(49);var _promise2=_interopRequireDefault(_promise);exports.dismissShareConfirmation=dismissShareConfirmation;exports.sharePost=sharePost;exports.fetchConnections=fetchConnections;exports.receiveConnections=receiveConnections;exports.failConnectionsRequest=failConnectionsRequest;var _wp=__webpack_require__(28);var _wp2=_interopRequireDefault(_wp);var _actionTypes=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function dismissShareConfirmation(siteId,postId){return{type:_actionTypes.PUBLICIZE_SHARE_DISMISS,siteId:siteId,postId:postId}}function sharePost(siteId,postId,skippedConnections,message){return function(dispatch){dispatch({type:_actionTypes.PUBLICIZE_SHARE,siteId:siteId,postId:postId,skippedConnections:skippedConnections,message:message});return new _promise2.default(function(resolve){_wp2.default.undocumented().publicizePost(siteId,postId,message,skippedConnections,function(error,data){if(error||!data.success){dispatch({type:_actionTypes.PUBLICIZE_SHARE_FAILURE,siteId:siteId,postId:postId,error:error})}else{dispatch({type:_actionTypes.PUBLICIZE_SHARE_SUCCESS,siteId:siteId,postId:postId})}resolve()})})}}function fetchConnections(siteId){return function(dispatch){dispatch({type:_actionTypes.PUBLICIZE_CONNECTIONS_REQUEST,siteId:siteId});return new _promise2.default(function(resolve){_wp2.default.undocumented().siteConnections(siteId,function(error,data){if(error){dispatch(failConnectionsRequest(siteId,error))}else{dispatch(receiveConnections(siteId,data))}resolve()})})}}function receiveConnections(siteId,data){return{type:_actionTypes.PUBLICIZE_CONNECTIONS_RECEIVE,siteId:siteId,data:data}}function failConnectionsRequest(siteId,error){return{type:_actionTypes.PUBLICIZE_CONNECTIONS_REQUEST_FAILURE,siteId:siteId,error:error}}},1861:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getConnectionsBySiteId=getConnectionsBySiteId;exports.getSiteUserConnections=getSiteUserConnections;exports.hasFetchedConnections=hasFetchedConnections;exports.isFetchingConnections=isFetchingConnections;exports.isRequestingSharePost=isRequestingSharePost;exports.sharePostSuccessMessage=sharePostSuccessMessage;exports.sharePostFailure=sharePostFailure;var _filter=__webpack_require__(77);var _filter2=_interopRequireDefault(_filter);var _get=__webpack_require__(24);var _get2=_interopRequireDefault(_get);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function getConnectionsBySiteId(state,siteId){return(0,_filter2.default)(state.sharing.publicize.connections,{site_ID:siteId})}function getSiteUserConnections(state,siteId,userId){return(0,_filter2.default)(state.sharing.publicize.connections,function(connection){var site_ID=connection.site_ID;var shared=connection.shared;var keyring_connection_user_ID=connection.keyring_connection_user_ID;return site_ID===siteId&&(shared||keyring_connection_user_ID===userId)})}function hasFetchedConnections(state,siteId){var fetchingConnections=state.sharing.publicize.fetchingConnections;return fetchingConnections.hasOwnProperty(siteId)}function isFetchingConnections(state,siteId){var fetchingConnections=state.sharing.publicize.fetchingConnections;return hasFetchedConnections(state,siteId)&&fetchingConnections[siteId]}function isRequestingSharePost(state,siteId,postId){return(0,_get2.default)(state.sharing.publicize.sharePostStatus,[siteId,postId,"requesting"],false)}function sharePostSuccessMessage(state,siteId,postId){return(0,_get2.default)(state.sharing.publicize.sharePostStatus,[siteId,postId,"success"],false)}function sharePostFailure(state,siteId,postId){return(0,_get2.default)(state.sharing.publicize.sharePostStatus,[siteId,postId,"error"],false)===true}},1864:function(module,exports,__webpack_require__){"use strict";var canUseDOM=__webpack_require__(1935);var size;module.exports=function(recalc){if(!size||recalc){if(canUseDOM){var scrollDiv=document.createElement("div");scrollDiv.style.position="absolute";scrollDiv.style.top="-9999px";scrollDiv.style.width="50px";scrollDiv.style.height="50px";scrollDiv.style.overflow="scroll";document.body.appendChild(scrollDiv);size=scrollDiv.offsetWidth-scrollDiv.clientWidth;document.body.removeChild(scrollDiv)}}return size}},1869:function(module,exports,__webpack_require__){(function(process){function normalizeArray(parts,allowAboveRoot){var up=0;for(var i=parts.length-1;i>=0;i--){var last=parts[i];if(last==="."){parts.splice(i,1)}else if(last===".."){parts.splice(i,1);up++}else if(up){parts.splice(i,1);up--}}if(allowAboveRoot){for(;up--;up){parts.unshift("..")}}return parts}var splitPathRe=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;var splitPath=function(filename){return splitPathRe.exec(filename).slice(1)};exports.resolve=function(){var resolvedPath="",resolvedAbsolute=false;for(var i=arguments.length-1;i>=-1&&!resolvedAbsolute;i--){var path=i>=0?arguments[i]:process.cwd();if(typeof path!=="string"){throw new TypeError("Arguments to path.resolve must be strings")}else if(!path){continue}resolvedPath=path+"/"+resolvedPath;resolvedAbsolute=path.charAt(0)==="/"}resolvedPath=normalizeArray(filter(resolvedPath.split("/"),function(p){return!!p}),!resolvedAbsolute).join("/");return(resolvedAbsolute?"/":"")+resolvedPath||"."};exports.normalize=function(path){var isAbsolute=exports.isAbsolute(path),trailingSlash=substr(path,-1)==="/";path=normalizeArray(filter(path.split("/"),function(p){return!!p}),!isAbsolute).join("/");if(!path&&!isAbsolute){path="."}if(path&&trailingSlash){path+="/"}return(isAbsolute?"/":"")+path};exports.isAbsolute=function(path){return path.charAt(0)==="/"};exports.join=function(){var paths=Array.prototype.slice.call(arguments,0);return exports.normalize(filter(paths,function(p,index){if(typeof p!=="string"){throw new TypeError("Arguments to path.join must be strings")}return p}).join("/"))};exports.relative=function(from,to){from=exports.resolve(from).substr(1);to=exports.resolve(to).substr(1);function trim(arr){var start=0;for(;start<arr.length;start++){if(arr[start]!=="")break}var end=arr.length-1;for(;end>=0;end--){if(arr[end]!=="")break}if(start>end)return[];return arr.slice(start,end-start+1)}var fromParts=trim(from.split("/"));var toParts=trim(to.split("/"));var length=Math.min(fromParts.length,toParts.length);var samePartsLength=length;for(var i=0;i<length;i++){if(fromParts[i]!==toParts[i]){samePartsLength=i;break}}var outputParts=[];for(var i=samePartsLength;i<fromParts.length;i++){outputParts.push("..")}outputParts=outputParts.concat(toParts.slice(samePartsLength));return outputParts.join("/")};exports.sep="/";exports.delimiter=":";exports.dirname=function(path){var result=splitPath(path),root=result[0],dir=result[1];if(!root&&!dir){return"."}if(dir){dir=dir.substr(0,dir.length-1)}return root+dir};exports.basename=function(path,ext){var f=splitPath(path)[2];if(ext&&f.substr(-1*ext.length)===ext){f=f.substr(0,f.length-ext.length)}return f};exports.extname=function(path){return splitPath(path)[3]};function filter(xs,f){if(xs.filter)return xs.filter(f);var res=[];for(var i=0;i<xs.length;i++){if(f(xs[i],i,xs))res.push(xs[i])}return res}var substr="ab".substr(-1)==="b"?function(str,start,len){return str.substr(start,len)}:function(str,start,len){if(start<0)start=str.length+start;return str.substr(start,len)}}).call(exports,__webpack_require__(54))},1870:function(module,exports,__webpack_require__){(function(global){var now=__webpack_require__(1948),root=typeof window==="undefined"?global:window,vendors=["moz","webkit"],suffix="AnimationFrame",raf=root["request"+suffix],caf=root["cancel"+suffix]||root["cancelRequest"+suffix];for(var i=0;!raf&&i<vendors.length;i++){raf=root[vendors[i]+"Request"+suffix];caf=root[vendors[i]+"Cancel"+suffix]||root[vendors[i]+"CancelRequest"+suffix]}if(!raf||!caf){var last=0,id=0,queue=[],frameDuration=1e3/60;raf=function(callback){if(queue.length===0){var _now=now(),next=Math.max(0,frameDuration-(_now-last));last=next+_now;setTimeout(function(){var cp=queue.slice(0);queue.length=0;for(var i=0;i<cp.length;i++){if(!cp[i].cancelled){try{cp[i].callback(last)}catch(e){setTimeout(function(){throw e},0)}}}},Math.round(next))}queue.push({handle:++id,callback:callback,cancelled:false});return id};caf=function(handle){for(var i=0;i<queue.length;i++){if(queue[i].handle===handle){queue[i].cancelled=true}}}}module.exports=function(fn){return raf.call(root,fn)};module.exports.cancel=function(){caf.apply(root,arguments)};module.exports.polyfill=function(){root.requestAnimationFrame=raf;root.cancelAnimationFrame=caf}}).call(exports,function(){return this}())},1871:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.VirtualScroll=exports.default=undefined;var _VirtualScroll2=__webpack_require__(1956);var _VirtualScroll3=_interopRequireDefault(_VirtualScroll2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_VirtualScroll3.default;exports.VirtualScroll=_VirtualScroll3.default},1872:function(module,exports,__webpack_require__){"use strict";var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);var _freeze=__webpack_require__(276);var _freeze2=_interopRequireDefault(_freeze);var _assign=__webpack_require__(5);var _assign2=_interopRequireDefault(_assign);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ReactDom=__webpack_require__(44),React=__webpack_require__(1),debug=__webpack_require__(3)("calypso:author-selector"),trim=__webpack_require__(219);var Popover=__webpack_require__(386),PopoverMenuItem=__webpack_require__(1652),SiteUsersFetcher=__webpack_require__(1810),UserItem=__webpack_require__(1839),Gridicon=__webpack_require__(26),InfiniteList=__webpack_require__(1691),UsersActions=__webpack_require__(1728),Search=__webpack_require__(717),hasTouch=__webpack_require__(216).hasTouch;var instance=0,SwitcherShell;SwitcherShell=React.createClass({displayName:"AuthorSwitcherShell",propTypes:{users:React.PropTypes.array,fetchingUsers:React.PropTypes.bool,numUsersFetched:React.PropTypes.number,totalUsers:React.PropTypes.number,usersCurrentOffset:React.PropTypes.number,allowSingleUser:React.PropTypes.bool,popoverPosition:React.PropTypes.string},getInitialState:function getInitialState(){return{showAuthorMenu:false}},componentWillMount:function componentWillMount(){this.instance=instance;instance++},componentWillReceiveProps:function componentWillReceiveProps(nextProps){if(!nextProps.fetchOptions.siteId||nextProps.fetchOptions.siteId!==this.props.fetchOptions.siteId){this.props.updateSearch(false)}},componentDidUpdate:function componentDidUpdate(prevProps,prevState){var _this=this;if(!this.state.showAuthorMenu){return}if(!prevState.showAuthorMenu&&this.props.users.length>10&&!hasTouch()){setTimeout(function(){return _this.refs.authorSelectorSearch.focus()},0)}},render:function render(){var users=this.props.users,infiniteListKey=this.props.fetchNameSpace+this.instance;if(!this._userCanSelectAuthor()){return React.createElement("span",null,this.props.children)}return React.createElement("span",null,React.createElement("span",{className:"author-selector__author-toggle",onClick:this._toggleShowAuthor,tabIndex:-1,ref:"author-selector-toggle"},this.props.children,React.createElement(Gridicon,{ref:"authorSelectorChevron",icon:"chevron-down",size:16})),React.createElement(Popover,{isVisible:this.state.showAuthorMenu,onClose:this._onClose,position:this.props.popoverPosition,context:this.refs&&this.refs.authorSelectorChevron,onKeyDown:this._onKeyDown,className:"author-selector__popover popover"},this.props.fetchOptions.search||users.length>10?React.createElement(Search,{onSearch:this._onSearch,placeholder:this.translate("Find Author",{context:"search label"}),delaySearch:true,ref:"authorSelectorSearch"}):null,this.props.fetchInitialized&&!users.length&&this.props.fetchOptions.search&&!this.props.fetchingUsers?this._noUsersFound():React.createElement(InfiniteList,{items:users,key:infiniteListKey,namespace:infiniteListKey,className:"author-selector__infinite-list",ref:this._setListContext,context:this.state.listContext,fetchingNextPage:this.props.fetchingUsers,guessedItemHeight:42,lastPage:this._isLastPage(),fetchNextPage:this._fetchNextPage,getItemRef:this._getAuthorItemGUID,renderLoadingPlaceholders:this._renderLoadingAuthors,renderItem:this._renderAuthor})))},_isLastPage:function _isLastPage(){var usersLength=this.props.users.length;if(this.props.exclude){usersLength+=this.props.excludedUsers.length}return this.props.totalUsers<=usersLength},_setListContext:function _setListContext(infiniteListInstance){this.setState({listContext:ReactDom.findDOMNode(infiniteListInstance)})},_userCanSelectAuthor:function _userCanSelectAuthor(){var users=this.props.users;if(this.props.fetchOptions.search){return true}if(!users||!users.length||!this.props.allowSingleUser&&users.length===1){return false}return true},_toggleShowAuthor:function _toggleShowAuthor(){this.setState({showAuthorMenu:!this.state.showAuthorMenu})},_onClose:function _onClose(event){var toggleElement=ReactDom.findDOMNode(this.refs["author-selector-toggle"]);if(event&&toggleElement.contains(event.target)){return}this.setState({showAuthorMenu:false});this.props.updateSearch(false)},_renderAuthor:function _renderAuthor(author){var authorGUID=this._getAuthorItemGUID(author);return React.createElement(PopoverMenuItem,{className:"author-selector__menu-item",onClick:this._selectAuthor.bind(this,author),focusOnHover:false,key:authorGUID,ref:authorGUID,tabIndex:"-1"},React.createElement(UserItem,{user:author}))},_noUsersFound:function _noUsersFound(){return React.createElement("div",{className:"author-selector__no-users"},this.translate("No matching users found."))},_selectAuthor:function _selectAuthor(author){debug("assign author:",author);if(this.props.onSelect){this.props.onSelect(author)}this.setState({showAuthorMenu:false});this.props.updateSearch(false)},_fetchNextPage:function _fetchNextPage(){var fetchOptions=(0,_assign2.default)({},this.props.fetchOptions,{offset:this.props.users.length});debug("fetching next batch of authors");UsersActions.fetchUsers(fetchOptions)},_getAuthorItemGUID:function _getAuthorItemGUID(author){return"author-item-"+author.ID},_renderLoadingAuthors:function _renderLoadingAuthors(){return React.createElement(PopoverMenuItem,{disabled:true,key:"author-item-placeholder"},React.createElement(UserItem,null))},_onSearch:function _onSearch(searchTerm){this.props.updateSearch(searchTerm)}});module.exports=React.createClass({displayName:"AuthorSelector",propTypes:{siteId:React.PropTypes.number.isRequired,onSelect:React.PropTypes.func,exclude:React.PropTypes.arrayOf(React.PropTypes.number),allowSingleUser:React.PropTypes.bool,popoverPosition:React.PropTypes.string},getInitialState:function getInitialState(){return{search:""}},getDefaultProps:function getDefaultProps(){return{showAuthorMenu:false,onClose:function onClose(){},allowSingleUser:false,popoverPosition:"bottom left"}},componentDidMount:function componentDidMount(){debug("AuthorSelector mounted")},render:function render(){var searchString=this.state.search||"",fetchOptions;searchString=trim(searchString);fetchOptions={siteId:this.props.siteId,order:"ASC",order_by:"display_name",number:50};if(searchString){fetchOptions.number=20;fetchOptions.search=searchString;fetchOptions.search_columns=["user_login","display_name"]}(0,_freeze2.default)(fetchOptions);return React.createElement(SiteUsersFetcher,{fetchOptions:fetchOptions,exclude:this.props.exclude},React.createElement(SwitcherShell,(0,_extends3.default)({},this.props,{updateSearch:this._updateSearch})))},_updateSearch:function _updateSearch(searchTerm){searchTerm=searchTerm?"*"+searchTerm+"*":"";this.setState({search:searchTerm})}})},1874:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _omit=__webpack_require__(18);var _omit2=_interopRequireDefault(_omit);var _clipboardButton=__webpack_require__(1837);var _clipboardButton2=_interopRequireDefault(_clipboardButton);var _formTextInput=__webpack_require__(206);var _formTextInput2=_interopRequireDefault(_formTextInput);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"ClipboardButtonInput",propTypes:{value:_react.PropTypes.string,disabled:_react.PropTypes.bool,className:_react.PropTypes.string},getInitialState:function getInitialState(){return{isCopied:false,disabled:false}},getDefaultProps:function getDefaultProps(){return{value:""}},componentWillUnmount:function componentWillUnmount(){clearTimeout(this.confirmationTimeout);delete this.confirmationTimeout},showConfirmation:function showConfirmation(){var _this=this;this.setState({isCopied:true});this.confirmationTimeout=setTimeout(function(){_this.setState({isCopied:false})},4e3)},render:function render(){var _props=this.props;var value=_props.value;var className=_props.className;var disabled=_props.disabled;var classes=(0,_classnames2.default)("clipboard-button-input",className);return _react2.default.createElement("span",{className:classes},_react2.default.createElement(_formTextInput2.default,(0,_extends3.default)({},(0,_omit2.default)(this.props,"className"),{type:"text",selectOnFocus:true,readOnly:true})),_react2.default.createElement(_clipboardButton2.default,{text:value,onCopy:this.showConfirmation,disabled:disabled,compact:true},this.state.isCopied?this.translate("Copied!"):this.translate("Copy",{context:"verb"})))}});module.exports=exports["default"]},1878:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1);var MediaLibrarySelectedStore=__webpack_require__(1784),passToChildren=__webpack_require__(1718);function getStateData(siteId){return{mediaLibrarySelectedItems:MediaLibrarySelectedStore.getAll(siteId)}}module.exports=React.createClass({displayName:"MediaLibrarySelectedData",propTypes:{siteId:React.PropTypes.number.isRequired},getInitialState:function getInitialState(){return getStateData(this.props.siteId)},componentDidMount:function componentDidMount(){MediaLibrarySelectedStore.on("change",this.updateState)},componentWillUnmount:function componentWillUnmount(){MediaLibrarySelectedStore.off("change",this.updateState)},componentWillReceiveProps:function componentWillReceiveProps(nextProps){if(this.props.siteId!==nextProps.siteId){this.setState(getStateData(nextProps.siteId))}},updateState:function updateState(){this.setState(getStateData(this.props.siteId))},render:function render(){return passToChildren(this,this.state)}})},1880:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _react=__webpack_require__(1);var _reactRedux=__webpack_require__(15);var _actions=__webpack_require__(1922);var _selectors=__webpack_require__(1794);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
var QueryPostCounts=function(_Component){(0,_inherits3.default)(QueryPostCounts,_Component);function QueryPostCounts(){(0,_classCallCheck3.default)(this,QueryPostCounts);return(0,_possibleConstructorReturn3.default)(this,(QueryPostCounts.__proto__||(0,_getPrototypeOf2.default)(QueryPostCounts)).apply(this,arguments))}(0,_createClass3.default)(QueryPostCounts,[{key:"componentWillMount",value:function componentWillMount(){this.request(this.props)}},{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){if(this.props.siteId===nextProps.siteId&&this.props.type===nextProps.type){return}this.request(nextProps)}},{key:"request",value:function request(props){if(props.requesting){return}props.requestPostCounts(props.siteId,props.type)}},{key:"render",value:function render(){return null}}]);return QueryPostCounts}(_react.Component);QueryPostCounts.propTypes={siteId:_react.PropTypes.number.isRequired,type:_react.PropTypes.string.isRequired,requesting:_react.PropTypes.bool,requestPostCounts:_react.PropTypes.func};exports.default=(0,_reactRedux.connect)(function(state,ownProps){var siteId=ownProps.siteId;var type=ownProps.type;return{requesting:(0,_selectors.isRequestingPostCounts)(state,siteId,type)}},{requestPostCounts:_actions.requestPostCounts})(QueryPostCounts);module.exports=exports["default"]},1885:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.DropZone=undefined;var _from=__webpack_require__(416);var _from2=_interopRequireDefault(_from);var _reactDom=__webpack_require__(44);var _reactDom2=_interopRequireDefault(_reactDom);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactAddonsCreateFragment=__webpack_require__(745);var _reactAddonsCreateFragment2=_interopRequireDefault(_reactAddonsCreateFragment);var _without=__webpack_require__(172);var _without2=_interopRequireDefault(_without);var _includes=__webpack_require__(30);var _includes2=_interopRequireDefault(_includes);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _noop=__webpack_require__(38);var _noop2=_interopRequireDefault(_noop);var _identity=__webpack_require__(99);var _identity2=_interopRequireDefault(_identity);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _i18nCalypso=__webpack_require__(11);var _rootChild=__webpack_require__(177);var _rootChild2=_interopRequireDefault(_rootChild);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var DropZone=exports.DropZone=_react2.default.createClass({displayName:"DropZone",propTypes:{onDrop:_react.PropTypes.func,onVerifyValidTransfer:_react.PropTypes.func,onFilesDrop:_react.PropTypes.func,fullScreen:_react.PropTypes.bool,icon:_react.PropTypes.string,translate:_react.PropTypes.func},getInitialState:function getInitialState(){return{isDraggingOverDocument:false,isDraggingOverElement:false}},getDefaultProps:function getDefaultProps(){return{onDrop:_noop2.default,onVerifyValidTransfer:function onVerifyValidTransfer(){return true},onFilesDrop:_noop2.default,fullScreen:false,icon:"cloud-upload",translate:_identity2.default}},componentDidMount:function componentDidMount(){this.dragEnterNodes=[];window.addEventListener("dragover",this.preventDefault);window.addEventListener("drop",this.onDrop);window.addEventListener("dragenter",this.toggleDraggingOverDocument);window.addEventListener("dragleave",this.toggleDraggingOverDocument);window.addEventListener("mouseup",this.resetDragState)},componentDidUpdate:function componentDidUpdate(prevProps,prevState){if(prevState.isDraggingOverDocument!==this.state.isDraggingOverDocument){this.toggleMutationObserver()}},componentWillUnmount:function componentWillUnmount(){window.removeEventListener("dragover",this.preventDefault);window.removeEventListener("drop",this.onDrop);window.removeEventListener("dragenter",this.toggleDraggingOverDocument);window.removeEventListener("dragleave",this.toggleDraggingOverDocument);window.removeEventListener("mouseup",this.resetDragState);this.disconnectMutationObserver()},resetDragState:function resetDragState(){if(!(this.state.isDraggingOverDocument||this.state.isDraggingOverElement)){return}this.setState({isDraggingOverDocument:false,isDraggingOverElement:false})},toggleMutationObserver:function toggleMutationObserver(){this.disconnectMutationObserver();if(this.state.isDraggingOverDocument){this.observer=new window.MutationObserver(this.detectNodeRemoval);this.observer.observe(document.body,{childList:true,subtree:true})}},disconnectMutationObserver:function disconnectMutationObserver(){if(!this.observer){return}this.observer.disconnect();delete this.observer},detectNodeRemoval:function detectNodeRemoval(mutations){var _this=this;mutations.forEach(function(mutation){if(!mutation.removedNodes.length){return}_this.dragEnterNodes=(0,_without2.default)(_this.dragEnterNodes,(0,_from2.default)(mutation.removedNodes))})},toggleDraggingOverDocument:function toggleDraggingOverDocument(event){var isDraggingOverDocument=void 0,detail=void 0,isValidDrag=void 0;if("dragenter"===event.type&&!(0,_includes2.default)(this.dragEnterNodes,event.target)){this.dragEnterNodes.push(event.target)}else if("dragleave"===event.type){this.dragEnterNodes=(0,_without2.default)(this.dragEnterNodes,event.target)}detail=window.CustomEvent&&event instanceof window.CustomEvent?event.detail:event;isValidDrag=this.props.onVerifyValidTransfer(detail.dataTransfer);isDraggingOverDocument=isValidDrag&&this.dragEnterNodes.length;this.setState({isDraggingOverDocument:isDraggingOverDocument,isDraggingOverElement:isDraggingOverDocument&&(this.props.fullScreen||this.isWithinZoneBounds(detail.clientX,detail.clientY))});if(window.CustomEvent&&event instanceof window.CustomEvent){this.dragEnterNodes=(0,_without2.default)(this.dragEnterNodes,window)}},preventDefault:function preventDefault(event){event.preventDefault()},isWithinZoneBounds:function isWithinZoneBounds(x,y){var rect=void 0;if(!this.refs.zone){return false}rect=this.refs.zone.getBoundingClientRect();if(rect.bottom===rect.top||rect.left===rect.right){return false}return x>=rect.left&&x<=rect.right&&y>=rect.top&&y<=rect.bottom},onDrop:function onDrop(event){event.dataTransfer&&event.dataTransfer.files.length;this.resetDragState();if(!this.props.fullScreen&&!_reactDom2.default.findDOMNode(this.refs.zone).contains(event.target)){return}this.props.onDrop(event);if(!this.props.onVerifyValidTransfer(event.dataTransfer)){return}if(event.dataTransfer){this.props.onFilesDrop(Array.prototype.slice.call(event.dataTransfer.files))}event.stopPropagation();event.preventDefault()},renderContent:function renderContent(){var content=void 0;if(this.props.children){content=this.props.children}else{content=(0,_reactAddonsCreateFragment2.default)({icon:_react2.default.createElement(_gridicon2.default,{icon:this.props.icon,size:48,className:"drop-zone__content-icon"}),text:_react2.default.createElement("span",{className:"drop-zone__content-text"},this.props.translate("Drop files to upload"))})}return _react2.default.createElement("div",{className:"drop-zone__content"},content)},render:function render(){var classes=(0,_classnames2.default)("drop-zone",{"is-active":this.state.isDraggingOverDocument||this.state.isDraggingOverElement,"is-dragging-over-document":this.state.isDraggingOverDocument,"is-dragging-over-element":this.state.isDraggingOverElement,"is-full-screen":this.props.fullScreen});var element=_react2.default.createElement("div",{ref:"zone",className:classes},this.renderContent());if(this.props.fullScreen){return _react2.default.createElement(_rootChild2.default,null,element)}return element}});exports.default=(0,_i18nCalypso.localize)(DropZone)},1892:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var SpinnerLine=function(_PureComponent){(0,_inherits3.default)(SpinnerLine,_PureComponent);function SpinnerLine(){(0,_classCallCheck3.default)(this,SpinnerLine);return(0,_possibleConstructorReturn3.default)(this,(SpinnerLine.__proto__||(0,_getPrototypeOf2.default)(SpinnerLine)).apply(this,arguments))}(0,_createClass3.default)(SpinnerLine,[{key:"render",value:function render(){var classes=(0,_classnames2.default)("spinner-line",this.props.className);return _react2.default.createElement("hr",{className:classes})}}]);return SpinnerLine}(_react.PureComponent);exports.default=SpinnerLine;SpinnerLine.propTypes={className:_react.PropTypes.string};module.exports=exports["default"]},1899:function(module,exports,__webpack_require__){"use strict";var _keys=__webpack_require__(39);var _keys2=_interopRequireDefault(_keys);var _freeze=__webpack_require__(276);var _freeze2=_interopRequireDefault(_freeze);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var assign=__webpack_require__(34),omit=__webpack_require__(18),map=__webpack_require__(45),isEqual=__webpack_require__(98);var Dispatcher=__webpack_require__(42),MediaStore=__webpack_require__(1717),MediaUtils=__webpack_require__(1647),emitter=__webpack_require__(36);var MediaListStore={_activeQueries:{},DEFAULT_QUERY:(0,_freeze2.default)({number:20}),_media:{}},DEFAULT_ACTIVE_QUERY=(0,_freeze2.default)({isFetchingNextPage:false}),SAME_QUERY_IGNORE_PARAMS=(0,_freeze2.default)(["number","page_handle"]);function sortItemsByDate(siteId){var sortedItems;if(!(siteId in MediaListStore._media)){return}sortedItems=MediaUtils.sortItemsByDate(MediaListStore.getAll(siteId));MediaListStore._media[siteId]=map(sortedItems,"ID")}function ensureMediaForSiteId(siteId){if(!(siteId in MediaListStore._media)){MediaListStore._media[siteId]=[]}}function receiveSingle(siteId,item,itemId){var existingIndex;ensureMediaForSiteId(siteId);if(itemId){existingIndex=MediaListStore._media[siteId].indexOf(itemId);if(-1!==existingIndex){MediaListStore._media[siteId].splice(existingIndex,1,item.ID)}}else if(-1===MediaListStore._media[siteId].indexOf(item.ID)&&MediaListStore.isItemMatchingQuery(siteId,item)){MediaListStore._media[siteId].push(item.ID)}}function removeSingle(siteId,item){var index;if(!(siteId in MediaListStore._media)){return}index=MediaListStore._media[siteId].indexOf(item.ID);if(-1!==index){MediaListStore._media[siteId].splice(index,1)}}function receivePage(siteId,items){ensureMediaForSiteId(siteId);items.forEach(function(item){receiveSingle(siteId,item)})}MediaListStore.ensureActiveQueryForSiteId=function(siteId){if(!(siteId in MediaListStore._activeQueries)){MediaListStore._activeQueries[siteId]=assign({},DEFAULT_ACTIVE_QUERY)}};function updateActiveQuery(siteId,query){query=omit(query,"page_handle");MediaListStore.ensureActiveQueryForSiteId(siteId);if(!isQuerySame(siteId,query)){delete MediaListStore._media[siteId];delete MediaListStore._activeQueries[siteId].nextPageHandle;MediaListStore._activeQueries[siteId].isFetchingNextPage=false}MediaListStore._activeQueries[siteId].query=query}function updateActiveQueryStatus(siteId,status){MediaListStore.ensureActiveQueryForSiteId(siteId);assign(MediaListStore._activeQueries[siteId],status)}function getNextPageMetaFromResponse(response){return response&&response.meta&&response.meta.next_page?response.meta.next_page:null}function isQuerySame(siteId,query){if(!(siteId in MediaListStore._activeQueries)){return false}return isEqual(omit(query,SAME_QUERY_IGNORE_PARAMS),omit(MediaListStore._activeQueries[siteId].query,SAME_QUERY_IGNORE_PARAMS))}MediaListStore.isItemMatchingQuery=function(siteId,item){var query,matches;if(!(siteId in MediaListStore._activeQueries)){return true}query=omit(MediaListStore._activeQueries[siteId].query,SAME_QUERY_IGNORE_PARAMS);if(!(0,_keys2.default)(query).length){return true}matches=true;if(query.search){matches=item.title&&-1!==item.title.toLowerCase().indexOf(query.search.toLowerCase())}if(query.mime_type&&matches){matches=item.mime_type&&0===item.mime_type.indexOf(query.mime_type)}return matches};emitter(MediaListStore);MediaListStore.get=function(siteId,postId){return MediaStore.get(siteId,postId)};MediaListStore.getAllIds=function(siteId){return MediaListStore._media[siteId]};MediaListStore.getAll=function(siteId){var allIds=MediaListStore.getAllIds(siteId);if(allIds){return allIds.map(MediaStore.get.bind(null,siteId))}};MediaListStore.getNextPageQuery=function(siteId){if(!(siteId in MediaListStore._activeQueries)){return MediaListStore.DEFAULT_QUERY}return assign({},MediaListStore.DEFAULT_QUERY,{page_handle:MediaListStore._activeQueries[siteId].nextPageHandle},MediaListStore._activeQueries[siteId].query)};MediaListStore.hasNextPage=function(siteId){return!(siteId in MediaListStore._activeQueries)||null!==MediaListStore._activeQueries[siteId].nextPageHandle};MediaListStore.isFetchingNextPage=function(siteId){return siteId in MediaListStore._activeQueries&&MediaListStore._activeQueries[siteId].isFetchingNextPage};MediaListStore.dispatchToken=Dispatcher.register(function(payload){var action=payload.action;Dispatcher.waitFor([MediaStore.dispatchToken]);switch(action.type){case"SET_MEDIA_QUERY":if(action.siteId&&action.query){updateActiveQuery(action.siteId,action.query)}break;case"FETCH_MEDIA_ITEMS":if(!action.siteId){break}updateActiveQueryStatus(action.siteId,{isFetchingNextPage:true});MediaListStore.emit("change");break;case"CREATE_MEDIA_ITEM":case"RECEIVE_MEDIA_ITEM":if(action.error&&action.siteId&&action.id){removeSingle(action.siteId,{ID:action.id});MediaListStore.emit("change")}if(!action.siteId){break}if(action.error||!action.data){break}receiveSingle(action.siteId,action.data,action.id);sortItemsByDate(action.siteId);MediaListStore.emit("change");break;case"RECEIVE_MEDIA_ITEMS":if(!action.siteId){break}updateActiveQueryStatus(action.siteId,{isFetchingNextPage:false,nextPageHandle:getNextPageMetaFromResponse(action.data)});if(action.error||!action.data||action.query&&!isQuerySame(action.siteId,action.query)){break}receivePage(action.siteId,action.data.media);sortItemsByDate(action.siteId);MediaListStore.emit("change");break;case"REMOVE_MEDIA_ITEM":if(!action.siteId||!action.data){break}if(action.error){receiveSingle(action.siteId,action.data)}else{removeSingle(action.siteId,action.data)}MediaListStore.emit("change");break}});module.exports=MediaListStore},1900:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1);var actions=__webpack_require__(1648),analytics=__webpack_require__(20);module.exports={getInitialState:function getInitialState(){return{updated:false,updatedStatus:null,previousStatus:null}},buildUpdateTemplate:function buildUpdateTemplate(){var post=this.props.post||this.props.page,status=this.state.updatedStatus,updateClass="conf-alert",strings=this.strings,updateText,undoTemplate,undoClick,trashText;if(!this.state.updated){return}switch(status){case"trashing":case"deleting":trashText=status==="deleting"?strings.deleting:strings.trashing;updateText=React.createElement("span",null,trashText," ",React.createElement("span",{className:"loading-dot"},"."),React.createElement("span",{className:"loading-dot"},"."),React.createElement("span",{className:"loading-dot"},"."));updateClass+=" conf-alert--trashing";break;case"trash":undoClick=this.resetToPreviousState;undoTemplate=React.createElement("a",{className:"undo",onClick:undoClick},React.createElement("span",null,strings.undo));updateText=strings.trashed;updateClass+=" conf-alert--trashed";break;case"deleted":updateText=strings.deleted;updateClass+=" conf-alert--deleted";break;case"updating":updateText=React.createElement("span",null,strings.updating," ",React.createElement("span",{className:"loading-dot"},"."),React.createElement("span",{className:"loading-dot"},"."),React.createElement("span",{className:"loading-dot"},"."));updateClass+=" conf-alert--updating";break;case"error":updateText=strings.error;updateClass+=" conf-alert--error";break;case"restoring":updateText=React.createElement("span",null,strings.restoring," ",React.createElement("span",{className:"loading-dot"},"."),React.createElement("span",{className:"loading-dot"},"."),React.createElement("span",{className:"loading-dot"},"."));updateClass+=" conf-alert--updating";break;default:if(this.state.previousStatus==="trash"){updateText=strings.restored}else{updateText=strings.updated}}return React.createElement("div",{key:post.global_ID+"-update",className:"updated-confirmation"},React.createElement("div",{className:updateClass},React.createElement("div",{className:"conf-alert_con"},React.createElement("span",{className:"conf-alert_title"},updateText),undoTemplate)))},updatePostStatus:function updatePostStatus(status){var post=this.props.post||this.props.page,previousStatus=null,strings=this.strings,setNewStatus;setNewStatus=function(error,post){if(error){this.setErrorState();return false}this.setState({previousStatus:previousStatus,updatedStatus:post.status,showMoreOptions:false});return true}.bind(this);if(status==="delete"){this.setState({updatedStatus:"deleting",updated:true});if(window.confirm(strings.deleteWarning)){actions.trash(post,setNewStatus)}else{this.resetState()}}else if(status==="trash"){this.setState({updatedStatus:"trashing",updated:true});previousStatus=post.status;actions.trash(post,setNewStatus)}else if(status==="restore"){this.setState({updatedStatus:"restoring",updated:true});previousStatus="trash";actions.restore(post,setNewStatus)}else{this.setState({updatedStatus:"updating",updated:true});actions.update(post,{status:status},function(error,post){if(!setNewStatus(error,post)){return}setTimeout(function(){this.resetState()}.bind(this),1200)}.bind(this))}},setErrorState:function setErrorState(){this.setState({updated:true,updatedStatus:"error"});setTimeout(function(){this.resetState()}.bind(this),1200)},resetState:function resetState(){this.setState({updatedStatus:null,updated:false,showMoreOptions:false,showPageActions:false})},resetToPreviousState:function resetToPreviousState(){var analyticsValues=this.props.page?{group:"Pages",eventName:"Clicked Undo Trashed Page"}:{group:"Posts",eventName:"Clicked Undo Trashed Post"};analytics.ga.recordEvent(analyticsValues.group,analyticsValues.eventName);if(this.state.previousStatus){this.updatePostStatus(this.state.previousStatus)}}}},1902:function(module,exports,__webpack_require__){"use strict";var isEqual=__webpack_require__(98),pick=__webpack_require__(91);var Emitter=__webpack_require__(36),Dispatcher=__webpack_require__(42),utils=__webpack_require__(1649),PostsStore=__webpack_require__(1727);var _contentImages={},PostContentImagesStore;function scrapeAll(posts){posts.forEach(scrapePost)}function scrapePost(post){var imagesFromPost=pick(PostsStore.get(post.global_ID),"content_images","canonical_image","featured_image","images","global_ID");utils.normalizeAsync(imagesFromPost,function(error,normalizedPostImages){var cachedImages=PostContentImagesStore.get(normalizedPostImages.global_ID);if(isEqual(normalizedPostImages,cachedImages)){return}_contentImages[normalizedPostImages.global_ID]=normalizedPostImages;PostContentImagesStore.emit("change")})}PostContentImagesStore={get:function get(postGlobalID){return _contentImages[postGlobalID]},getAll:function getAll(){return _contentImages}};Emitter(PostContentImagesStore);PostContentImagesStore.dispatchToken=Dispatcher.register(function(payload){var action=payload.action;Dispatcher.waitFor([PostsStore.dispatchToken]);switch(action.type){case"RECEIVE_POSTS_PAGE":case"RECEIVE_UPDATED_POSTS":if(!action.error&&action.data.posts){scrapeAll(action.data.posts)}break;case"RECEIVE_UPDATED_POST":if(!action.error){scrapePost(action.post)}break}});module.exports=PostContentImagesStore},1903:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _typeof2=__webpack_require__(32);var _typeof3=_interopRequireDefault(_typeof2);var _keys=__webpack_require__(39);var _keys2=_interopRequireDefault(_keys);var _toConsumableArray2=__webpack_require__(41);var _toConsumableArray3=_interopRequireDefault(_toConsumableArray2);exports.getCacheKey=getCacheKey;exports.setCanonicalList=setCanonicalList;exports.getCanonicalList=getCanonicalList;exports.deleteCanonicalList=deleteCanonicalList;var _intersection=__webpack_require__(768);var _intersection2=_interopRequireDefault(_intersection);var _debug=__webpack_require__(3);var _debug2=_interopRequireDefault(_debug);var _sitesList=__webpack_require__(53);var _sitesList2=_interopRequireDefault(_sitesList);var _dispatcher=__webpack_require__(42);var _dispatcher2=_interopRequireDefault(_dispatcher);var _cacheIndex=__webpack_require__(772);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var cache={};var _canonicalCache={};var TTL_IN_MS=5*60*1e3;var sites=(0,_sitesList2.default)();var PostsListCache={get:get,_reset:function _reset(){cache={}}};var debug=(0,_debug2.default)("calypso:posts-list:cache");function isStale(list){var now=(new Date).getTime();var timeSaved=list.timeSaved;return now-timeSaved>TTL_IN_MS}function get(listKey){if(isListKeyFresh(listKey)){return cache[listKey].list}if(cache[listKey]&&cache[listKey].dirty){debug("delete cached list %o",listKey);delete cache[listKey];delete _canonicalCache[listKey]}}function set(list){var listKey=getCacheKey(list.query);if(!cache[listKey]||!cache[listKey].dirty){cache[listKey]={timeStored:(new Date).getTime(),dirty:false,list:list,listKey:listKey}}}function markDirty(post,oldStatus){var site=sites.getSite(post.site_ID);var affectedSites=[site.slug,site.ID,false];var affectedStatuses=[post.status,oldStatus];var listStatuses=void 0,key=void 0,entry=void 0,list=void 0;for(key in cache){if(!cache.hasOwnProperty(key)){continue}entry=cache[key];list=entry.list;if(list.query.type!==post.type){continue}if(-1===affectedSites.indexOf(list.query.siteID)){continue}listStatuses=list.query.status.split(",");if((0,_intersection2.default)(listStatuses,affectedStatuses).length===0){continue}entry.dirty=true}_cacheIndex.cacheIndex.clearRecordsByParamFilter(function(reqParams){var siteIdentifiers=affectedSites.slice(0,-1);var affectedPaths=["/me/posts"].concat((0,_toConsumableArray3.default)(siteIdentifiers.map(function(status){return"/sites/"+status+"/posts"})));var recordStatuses=reqParams.query&&reqParams.query.status?reqParams.query.status.split(","):[];var intersectingStatuses=(0,_intersection2.default)(recordStatuses,affectedStatuses);if(affectedPaths.indexOf(reqParams.path)===-1){return false}if(!intersectingStatuses.length){return false}return true})}function isListKeyFresh(listKey){return cache[listKey]&&!isStale(cache[listKey])&&!cache[listKey].dirty}PostsListCache.dispatchToken=_dispatcher2.default.register(function(payload){var action=payload.action,PostListStore=__webpack_require__(1726)();_dispatcher2.default.waitFor([PostListStore.dispatchToken]);switch(action.type){case"FETCH_NEXT_POSTS_PAGE":set(PostListStore.get());break;case"RECEIVE_POSTS_PAGE":set(PostListStore.get());break;case"RECEIVE_UPDATED_POSTS":set(PostListStore.get());break;case"RECEIVE_UPDATED_POST":case"RECEIVE_POST_BEING_EDITED":if(action.post){markDirty(action.post,action.original?action.original.status:null);set(PostListStore.get())}break}});function getCacheKey(options){var cacheKey=[];var keys=(0,_keys2.default)(options).sort();keys.forEach(function(key){cacheKey.push(key+"-"+options[key])});return cacheKey.join(":")}function setCanonicalList(listKey,requestKey,list){debug("setCanonicalList %o %o (%o)",listKey,requestKey,list);_canonicalCache[listKey]=_canonicalCache[listKey]||{};_canonicalCache[listKey][requestKey]=list}function getCanonicalList(listKey,requestKey){debug("getCanonicalList %o %o",listKey,requestKey);var stream=_canonicalCache[listKey];if(!stream||(typeof stream==="undefined"?"undefined":(0,_typeof3.default)(stream))!=="object"){return false}var keys=(0,_keys2.default)(stream);if(keys[0]!==requestKey){delete cache[listKey];delete _canonicalCache[listKey];return false}return stream[requestKey]}function deleteCanonicalList(listKey,requestKey){debug("deleteCanonicalList %o %o",listKey,requestKey);var stream=_canonicalCache[listKey];if(stream&&stream[requestKey]){delete stream[requestKey]}}exports.default=PostsListCache},1904:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _typeof2=__webpack_require__(32);var _typeof3=_interopRequireDefault(_typeof2);exports.getRemovedPosts=getRemovedPosts;exports.default=function(id){if(!id){throw new Error("must supply a post-list-store id")}var _activeList={postIds:[],errors:[],query:(0,_clone2.default)(_defaultQuery),page:0,nextPageHandle:false,isLastPage:false,isFetchingNextPage:false,isFetchingUpdated:false};function queryPosts(options){var query=(0,_assign2.default)({},_defaultQuery,options);if(query.siteID&&typeof query.siteID==="string"){query.siteID=query.siteID.replace(/::/g,"/")}if(query.status==="draft,pending"){query.orderBy="modified"}var listKey=(0,_postListCacheStore.getCacheKey)(query);var list=_postListCacheStore2.default.get(listKey);if(list){_activeList=list}else{_activeList={id:_nextId,postIds:[],errors:[],page:0,isLastPage:false,isFetchingNextPage:false,isFetchingUpdated:false,query:query,listKey:listKey};_nextId++}}function cleanParams(params){return(0,_transform2.default)(params,function(result,value,key){if(value!=null){result[key]=value}},{})}function sort(){var key=_activeList.query.orderBy;_activeList.postIds.sort(function(a,b){var postA=_postsStore2.default.get(a),postB=_postsStore2.default.get(b),timeA=postA[key],timeB=postB[key];if(timeA===timeB){if(postA.title===postB.title){return 0}return postA.title>postB.title?1:-1}return timeA>timeB?-1:1})}function receivePage(listId,error,data){if(error||!data||(typeof data==="undefined"?"undefined":(0,_typeof3.default)(data))!=="object"){error=error||{message:"Error fetching PostsList: empty data response"};debug("Error fetching PostsList from api:",error);error.timestamp=Date.now();_activeList.errors.push(error);return}var found=data.found;var meta=data.meta;var posts=data.posts;var __sync=data.__sync;var _ref=__sync||{};var responseSource=_ref.responseSource;var requestKey=_ref.requestKey;if(listId!==_activeList.id){return}_activeList.isFetchingNextPage=false;_activeList.nextPageHandle=meta&&meta.next_page;if(!_activeList.nextPageHandle||!found){_activeList.isLastPage=true}var responsePostIDs=posts.map(function(post){return post.global_ID});var priorList=_activeList.postIds.slice(0);if(responseSource==="local"&&requestKey){(0,_postListCacheStore.setCanonicalList)(_activeList.listKey,requestKey,priorList)}else{var canonicalList=(0,_postListCacheStore.getCanonicalList)(_activeList.listKey,requestKey);if(canonicalList){debug("canonicalList found (%o)",canonicalList);priorList=canonicalList;(0,_postListCacheStore.deleteCanonicalList)(_activeList.listKey,requestKey)}}var removedPosts=getRemovedPosts(priorList,responsePostIDs);if(removedPosts.length){debug("removePosts (%o)",removedPosts);priorList=(0,_difference2.default)(priorList,removedPosts)}var newPosts=(0,_difference2.default)(responsePostIDs,priorList);if(newPosts.length){debug("newPosts (%o)",newPosts);priorList=priorList.concat(newPosts);_activeList.page++}_activeList.postIds=priorList;sort()}function receiveUpdates(listId,error,data){var posts=void 0;var postIds=void 0;var newPostIds=void 0;if(error){debug("An error occurred while fetching updated posts %o",error);return}if(listId!==_activeList.id){return}if(!data.posts.length){return}posts=data.posts;debug("Fetched updated posts:",posts);postIds=posts.map(function(post){return post.global_ID});newPostIds=(0,_difference2.default)(postIds,_activeList.postIds);if(newPostIds.length){_activeList.postIds=_activeList.postIds.concat(newPostIds);sort()}}return new(function(_EventEmitter){(0,_inherits3.default)(_class,_EventEmitter);function _class(){(0,_classCallCheck3.default)(this,_class);var _this=(0,_possibleConstructorReturn3.default)(this,(_class.__proto__||(0,_getPrototypeOf2.default)(_class)).call(this));_this.id=id;_this.dispatchToken=_dispatcher2.default.register(_this.handlePayload.bind(_this));return _this}(0,_createClass3.default)(_class,[{key:"get",value:function get(){return _activeList}},{key:"getID",value:function getID(){return _activeList.id}},{key:"getSiteID",value:function getSiteID(){return _activeList.query.siteID}},{key:"getAll",value:function getAll(){return _activeList.postIds.map(function(globalID){return _postsStore2.default.get(globalID)})}},{key:"getTree",value:function getTree(){var sortedPosts=[];_activeList.postIds.forEach(function(globalID){var post=(0,_clone2.default)(_postsStore2.default.get(globalID));post.parent=post.parent?post.parent.ID:0;sortedPosts.push(post)});return(0,_treeConvert2.default)("ID").treeify(sortedPosts)}},{key:"getPost",value:function getPost(globalID){if(_activeList.postIds.indexOf(globalID)>-1){return _postsStore2.default.get(globalID)}}},{key:"getPage",value:function getPage(){return _activeList.page}},{key:"off",value:function off(event,method){this.removeListener(event,method)}},{key:"isLastPage",value:function isLastPage(){return _activeList.isLastPage}},{key:"isFetchingNextPage",value:function isFetchingNextPage(){return _activeList.isFetchingNextPage}},{key:"hasRecentError",value:function hasRecentError(){var recentTimeIntervalSeconds=30;var dateNow=Date.now();return(0,_some2.default)(_activeList.errors,function(error){return dateNow-error.timestamp<recentTimeIntervalSeconds*1e3})}},{key:"getNextPageParams",value:function getNextPageParams(){var params={};var query=_activeList.query;params.status=query.status;params.order_by=query.orderBy;params.order=query.order;params.author=query.author;params.number=query.perPage;params.type=query.type;params.page_handle=_activeList.nextPageHandle;params.exclude_tree=query.exclude_tree;params.number=query.number;params.before=query.before;params.after=query.after;if(query.search){params.search=query.search}if(!params.siteID){params.site_visibility="visible"}if(query.meta){params.meta=query.meta}return cleanParams(params)}},{key:"getUpdatesParams",value:function getUpdatesParams(){var params={};var query=_activeList.query;params.status=query.status;params.author=query.author;params.type=query.type;if(query.search){params.search=query.search}if(!params.siteID){params.site_visibility="visible"}if(query.meta){params.meta=query.meta}if(_activeList.postIds.length){params.modified_after=(0,_maxBy2.default)(this.getAll(),function(post){return new Date(post.modified).getTime()}).modified;if(query.orderBy!=="modified"&&!_activeList.isLastPage){
params.after=this.getPost((0,_last2.default)(_activeList.postIds)).date}}return cleanParams(params)}},{key:"handlePayload",value:function handlePayload(payload){var action=payload.action;if(action.postListStoreId&&action.postListStoreId!==this.id&&"RECEIVE_UPDATED_POST"!==action.type){return}_dispatcher2.default.waitFor([_postsStore2.default.dispatchToken]);switch(action.type){case"QUERY_POSTS":debug("QUERY_POSTS",action);queryPosts(action.options);this.emit("change");break;case"FETCH_NEXT_POSTS_PAGE":debug("FETCH_NEXT_POSTS_PAGE",action);_activeList.isFetchingNextPage=true;this.emit("change");break;case"RECEIVE_POSTS_PAGE":debug("receivePage",action);receivePage(action.id,action.error,action.data);this.emit("change");break;case"RECEIVE_UPDATED_POSTS":receiveUpdates(action.id,action.error,action.data);this.emit("change");break;case"RECEIVE_UPDATED_POST":if(action.post){if(_activeList.postIds.indexOf(action.post.global_ID)>-1){this.emit("change")}}break}}}]);return _class}(_events.EventEmitter))};var _debug=__webpack_require__(3);var _debug2=_interopRequireDefault(_debug);var _clone=__webpack_require__(212);var _clone2=_interopRequireDefault(_clone);var _assign=__webpack_require__(34);var _assign2=_interopRequireDefault(_assign);var _transform=__webpack_require__(744);var _transform2=_interopRequireDefault(_transform);var _difference=__webpack_require__(118);var _difference2=_interopRequireDefault(_difference);var _last=__webpack_require__(215);var _last2=_interopRequireDefault(_last);var _maxBy=__webpack_require__(2021);var _maxBy2=_interopRequireDefault(_maxBy);var _events=__webpack_require__(139);var _some=__webpack_require__(63);var _some2=_interopRequireDefault(_some);var _dispatcher=__webpack_require__(42);var _dispatcher2=_interopRequireDefault(_dispatcher);var _treeConvert=__webpack_require__(1846);var _treeConvert2=_interopRequireDefault(_treeConvert);var _postsStore=__webpack_require__(1727);var _postsStore2=_interopRequireDefault(_postsStore);var _postListCacheStore=__webpack_require__(1903);var _postListCacheStore2=_interopRequireDefault(_postListCacheStore);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _defaultQuery={siteID:false,type:"post",status:"publish",orderBy:"date",order:"DESC",author:false,search:false,perPage:20};var debug=(0,_debug2.default)("calypso:posts-list");var _nextId=0;function getRemovedPosts(currentList,newPosts){if(currentList.length<3||newPosts.length<2){return[]}var overlapBegin=currentList.indexOf(newPosts[0]);if(overlapBegin===-1){return getRemovedPosts(currentList,newPosts.slice(1))}var overlapEnd=currentList.indexOf(newPosts.slice(-1)[0]);if(overlapEnd===-1){return getRemovedPosts(currentList,newPosts.slice(0,-1))}var overlapList=currentList.slice(overlapBegin,overlapEnd+1);return(0,_difference2.default)(overlapList,newPosts)}},1910:function(module,exports,__webpack_require__){"use strict";var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _noop=__webpack_require__(38);var _noop2=_interopRequireDefault(_noop);var _analytics=__webpack_require__(20);var _analytics2=_interopRequireDefault(_analytics);var _dropZone=__webpack_require__(1885);var _dropZone2=_interopRequireDefault(_dropZone);var _actions=__webpack_require__(1662);var _actions2=_interopRequireDefault(_actions);var _utils=__webpack_require__(208);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}module.exports=_react2.default.createClass({displayName:"MediaLibraryDropZone",propTypes:{site:_react2.default.PropTypes.object,fullScreen:_react2.default.PropTypes.bool,onAddMedia:_react2.default.PropTypes.func,trackStats:_react2.default.PropTypes.bool},getDefaultProps:function getDefaultProps(){return{fullScreen:true,onAddMedia:_noop2.default,trackStats:true}},uploadFiles:function uploadFiles(files){if(!this.props.site){return}_actions2.default.clearValidationErrors(this.props.site.ID);_actions2.default.add(this.props.site.ID,files);this.props.onAddMedia();if(this.props.trackStats){_analytics2.default.mc.bumpStat("editor_upload_via","drop")}},isValidTransfer:function isValidTransfer(transfer){if(!transfer){return false}if(transfer.mozSourceNode){return false}return!transfer.types||-1!==Array.prototype.indexOf.call(transfer.types,"Files")},render:function render(){if(!(0,_utils.userCan)("upload_files",this.props.site)){return null}return _react2.default.createElement(_dropZone2.default,{fullScreen:this.props.fullScreen,onVerifyValidTransfer:this.isValidTransfer,onFilesDrop:this.uploadFiles})}})},1911:function(module,exports,__webpack_require__){"use strict";var _reactDom=__webpack_require__(44);var _reactDom2=_interopRequireDefault(_reactDom);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _noop=__webpack_require__(38);var _noop2=_interopRequireDefault(_noop);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _analytics=__webpack_require__(20);var _analytics2=_interopRequireDefault(_analytics);var _actions=__webpack_require__(1662);var _actions2=_interopRequireDefault(_actions);var _utils=__webpack_require__(1647);var _utils2=_interopRequireDefault(_utils);var _uniq=__webpack_require__(223);var _uniq2=_interopRequireDefault(_uniq);var _constants=__webpack_require__(1716);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}module.exports=_react2.default.createClass({displayName:"MediaLibraryUploadButton",propTypes:{site:_react2.default.PropTypes.object,onAddMedia:_react2.default.PropTypes.func,className:_react2.default.PropTypes.string},getDefaultProps:function getDefaultProps(){return{onAddMedia:_noop2.default}},uploadFiles:function uploadFiles(event){if(event.target.files&&this.props.site){_actions2.default.clearValidationErrors(this.props.site.ID);_actions2.default.add(this.props.site.ID,event.target.files)}_reactDom2.default.findDOMNode(this.refs.form).reset();this.props.onAddMedia();_analytics2.default.mc.bumpStat("editor_upload_via","add_button")},getInputAccept:function getInputAccept(){if(!_utils2.default.isSiteAllowedFileTypesToBeTrusted(this.props.site)){return null}var allowedFileTypesForSite=_utils2.default.getAllowedFileTypesForSite(this.props.site);return(0,_uniq2.default)(allowedFileTypesForSite.concat(_constants.VideoPressFileTypes)).map(function(type){return"."+type}).join()},render:function render(){var classes=(0,_classnames2.default)("media-library__upload-button",this.props.className);return _react2.default.createElement("form",{ref:"form",className:classes},_react2.default.createElement("span",null,this.props.children),_react2.default.createElement("input",{type:"file",accept:this.getInputAccept(),multiple:true,onChange:this.uploadFiles,className:"media-library__upload-button-input"}))}})},1915:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=EditorDrawerLabel;var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _infoPopover=__webpack_require__(1725);var _infoPopover2=_interopRequireDefault(_infoPopover);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function EditorDrawerLabel(_ref){var children=_ref.children;var labelText=_ref.labelText;var helpText=_ref.helpText;return _react2.default.createElement("label",{className:"editor-drawer__label"},_react2.default.createElement("span",{className:"editor-drawer__label-text"},labelText,helpText&&_react2.default.createElement(_infoPopover2.default,{position:"top left"},helpText)),children)}EditorDrawerLabel.propTypes={children:_react.PropTypes.node,helpText:_react.PropTypes.string,labelText:_react.PropTypes.string};module.exports=exports["default"]},1916:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Views=undefined;var _keyMirror=__webpack_require__(116);var _keyMirror2=_interopRequireDefault(_keyMirror);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var Views=exports.Views=(0,_keyMirror2.default)({LIST:null,DETAIL:null,GALLERY:null,IMAGE_EDITOR:null})},1917:function(module,exports,__webpack_require__){"use strict";var ReactDomServer=__webpack_require__(1800),React=__webpack_require__(1),assign=__webpack_require__(34),classNames=__webpack_require__(10);var Shortcode=__webpack_require__(1719),MediaUtils=__webpack_require__(1647),MediaSerialization=__webpack_require__(1814),sites=__webpack_require__(53)();var Markup;Markup={get:function get(media,options){var mimePrefix;if(!media){return""}mimePrefix=MediaUtils.getMimePrefix(media);if(mimePrefix&&"function"===typeof Markup.mimeTypes[mimePrefix]){return Markup.mimeTypes[mimePrefix](media,options)}return Markup.link(media)},link:function link(media){var element=React.createElement("a",{href:media.URL,title:media.title},media.title);return ReactDomServer.renderToStaticMarkup(element)},caption:function caption(media){var parsed,match,img,caption,width;if("string"!==typeof media){media=Markup.get(media)}parsed=Shortcode.parse(media);if(!parsed||!parsed.content){return null}match=parsed.content.match(/((?:<a [^>]+>)?<img [^>]+>(?:<\/a>)?)([\s\S]*)/i);if(match){img=match[1].trim();caption=match[2].trim()}width=parsed.attrs.named.width;if(!width){width=MediaSerialization.deserialize(img).width}return React.createElement("dl",{className:classNames("wp-caption",parsed.attrs.named.align,parsed.attrs.named.classes),style:{width:width}},React.createElement("dt",{className:"wp-caption-dt",dangerouslySetInnerHTML:{__html:img}}),React.createElement("dd",{className:"wp-caption-dd"},caption))},mimeTypes:{image:function image(media,options){var site=sites.getSelectedSite();options=assign({size:"full",align:"none",forceResize:false},options);var width=void 0,height=void 0;if("full"===options.size){width=media.width;height=media.height}else{var dimensions=MediaUtils.getThumbnailSizeDimensions(options.size,site);var ratio=Math.min(dimensions.width/media.width||Infinity,dimensions.height/media.height||Infinity);width=Math.round(media.width*ratio);height=Math.round(media.height*ratio)}var urlOptions=void 0;if(options.forceResize||site&&!site.jetpack&&width&&width!==media.width){urlOptions={maxWidth:width}}else{urlOptions={size:options.size}}var img=React.createElement("img",{src:MediaUtils.url(media,urlOptions),alt:media.alt||media.title,width:isFinite(width)?width:null,height:isFinite(height)?height:null,className:classNames("align"+options.align,"size-"+options.size,"wp-image-"+media.ID)});var markup=ReactDomServer.renderToStaticMarkup(img);if(media.caption&&width){markup=Shortcode.stringify({tag:"caption",attrs:{id:"attachment_"+media.ID,width:width},content:[markup,media.caption].join(" ")})}return markup},audio:function audio(media){return Shortcode.stringify({tag:"audio",attrs:{src:media.URL}})},video:function video(media){if(MediaUtils.isVideoPressItem(media)){return Shortcode.stringify({tag:"wpvideo",attrs:[media.videopress_guid],type:"single"})}return Shortcode.stringify({tag:"video",attrs:{src:media.URL,height:media.height,width:media.width}})}}};module.exports=Markup},1922:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.receivePostCounts=receivePostCounts;exports.requestPostCounts=requestPostCounts;var _wp=__webpack_require__(28);var _wp2=_interopRequireDefault(_wp);var _actionTypes=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function receivePostCounts(siteId,postType,counts){return{type:_actionTypes.POST_COUNTS_RECEIVE,siteId:siteId,postType:postType,counts:counts}}function requestPostCounts(siteId,postType){return function(dispatch){dispatch({type:_actionTypes.POST_COUNTS_REQUEST,postType:postType,siteId:siteId});return _wp2.default.undocumented().site(siteId).postCounts({type:postType}).then(function(data){dispatch(receivePostCounts(siteId,postType,data.counts));dispatch({type:_actionTypes.POST_COUNTS_REQUEST_SUCCESS,siteId:siteId,postType:postType})}).catch(function(error){dispatch({type:_actionTypes.POST_COUNTS_REQUEST_FAILURE,siteId:siteId,postType:postType,error:error})})}}},1927:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.resetImageEditorState=resetImageEditorState;exports.resetAllImageEditorState=resetAllImageEditorState;exports.imageEditorRotateCounterclockwise=imageEditorRotateCounterclockwise;exports.imageEditorFlip=imageEditorFlip;exports.setImageEditorAspectRatio=setImageEditorAspectRatio;exports.setImageEditorFileInfo=setImageEditorFileInfo;exports.setImageEditorCropBounds=setImageEditorCropBounds;exports.imageEditorCrop=imageEditorCrop;var _actionTypes=__webpack_require__(2);function resetImageEditorState(){return{type:_actionTypes.IMAGE_EDITOR_STATE_RESET}}function resetAllImageEditorState(){return{type:_actionTypes.IMAGE_EDITOR_STATE_RESET_ALL}}function imageEditorRotateCounterclockwise(){return{type:_actionTypes.IMAGE_EDITOR_ROTATE_COUNTERCLOCKWISE}}function imageEditorFlip(){return{type:_actionTypes.IMAGE_EDITOR_FLIP}}function setImageEditorAspectRatio(ratio){return{type:_actionTypes.IMAGE_EDITOR_SET_ASPECT_RATIO,ratio:ratio}}function setImageEditorFileInfo(src,fileName,mimeType,title){return{type:_actionTypes.IMAGE_EDITOR_SET_FILE_INFO,src:src,fileName:fileName,mimeType:mimeType,title:title}}function setImageEditorCropBounds(topBound,leftBound,bottomBound,rightBound){return{type:_actionTypes.IMAGE_EDITOR_SET_CROP_BOUNDS,topBound:topBound,leftBound:leftBound,bottomBound:bottomBound,rightBound:rightBound}}function imageEditorCrop(topRatio,leftRatio,widthRatio,heightRatio){return{type:_actionTypes.IMAGE_EDITOR_CROP,topRatio:topRatio,leftRatio:leftRatio,widthRatio:widthRatio,heightRatio:heightRatio}}},1928:function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getImageEditorTransform=getImageEditorTransform;exports.getImageEditorFileInfo=getImageEditorFileInfo;exports.imageEditorHasChanges=imageEditorHasChanges;exports.getImageEditorCropBounds=getImageEditorCropBounds;exports.getImageEditorCrop=getImageEditorCrop;exports.getImageEditorAspectRatio=getImageEditorAspectRatio;function getImageEditorTransform(state){return state.ui.editor.imageEditor.transform}function getImageEditorFileInfo(state){return state.ui.editor.imageEditor.fileInfo}function imageEditorHasChanges(state){return state.ui.editor.imageEditor.hasChanges}function getImageEditorCropBounds(state){return state.ui.editor.imageEditor.cropBounds}function getImageEditorCrop(state){return state.ui.editor.imageEditor.crop}function getImageEditorAspectRatio(state){return state.ui.editor.imageEditor.aspectRatio}},1930:function(module,exports){exports.WEEKDAY_OFFSET={sunday:0,sun:0,monday:1,mon:1,tuesday:2,tue:2,wednesday:3,wed:3,thursday:4,thur:4,thu:4,friday:5,fri:5,saturday:6,sat:6};exports.MONTH_OFFSET={january:1,jan:1,"jan.":1,february:2,feb:2,"feb.":2,march:3,mar:3,"mar.":3,april:4,apr:4,"apr.":4,may:5,june:6,jun:6,"jun.":6,july:7,jul:7,"jul.":7,august:8,aug:8,"aug.":8,september:9,sep:9,"sep.":9,sept:9,"sept.":9,october:10,oct:10,"oct.":10,november:11,nov:11,"nov.":11,december:12,dec:12,"dec.":12};exports.INTEGER_WORDS_PATTERN="(?:one|two|three|four|five|six|seven|eight|nine|ten|eleven|twelve)";exports.INTEGER_WORDS={one:1,two:2,three:3,four:4,five:5,six:6,seven:7,eight:8,nine:9,ten:10,eleven:11,twelve:12}},1931:function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var _select=__webpack_require__(1959);var _select2=_interopRequireDefault(_select);var ClipboardAction=function(){function ClipboardAction(options){_classCallCheck(this,ClipboardAction);this.resolveOptions(options);this.initSelection()}ClipboardAction.prototype.resolveOptions=function resolveOptions(){var options=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];this.action=options.action;this.emitter=options.emitter;this.target=options.target;this.text=options.text;this.trigger=options.trigger;this.selectedText=""};ClipboardAction.prototype.initSelection=function initSelection(){if(this.text&&this.target){throw new Error('Multiple attributes declared, use either "target" or "text"')}else if(this.text){this.selectFake()}else if(this.target){this.selectTarget()}else{throw new Error('Missing required attributes, use either "target" or "text"')}};ClipboardAction.prototype.selectFake=function selectFake(){var _this=this;this.removeFake();this.fakeHandler=document.body.addEventListener("click",function(){return _this.removeFake()});this.fakeElem=document.createElement("textarea");this.fakeElem.style.position="absolute";this.fakeElem.style.left="-9999px";this.fakeElem.style.top=(window.pageYOffset||document.documentElement.scrollTop)+"px";this.fakeElem.setAttribute("readonly","");this.fakeElem.value=this.text;document.body.appendChild(this.fakeElem);this.selectedText=_select2["default"](this.fakeElem);this.copyText()};ClipboardAction.prototype.removeFake=function removeFake(){if(this.fakeHandler){document.body.removeEventListener("click");this.fakeHandler=null}if(this.fakeElem){document.body.removeChild(this.fakeElem);this.fakeElem=null}};ClipboardAction.prototype.selectTarget=function selectTarget(){this.selectedText=_select2["default"](this.target);this.copyText()};ClipboardAction.prototype.copyText=function copyText(){var succeeded=undefined;try{succeeded=document.execCommand(this.action)}catch(err){succeeded=false}this.handleResult(succeeded)};ClipboardAction.prototype.handleResult=function handleResult(succeeded){if(succeeded){this.emitter.emit("success",{action:this.action,text:this.selectedText,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)})}else{this.emitter.emit("error",{action:this.action,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)})}};ClipboardAction.prototype.clearSelection=function clearSelection(){if(this.target){this.target.blur()}window.getSelection().removeAllRanges()};ClipboardAction.prototype.destroy=function destroy(){this.removeFake()};_createClass(ClipboardAction,[{key:"action",set:function set(){var action=arguments.length<=0||arguments[0]===undefined?"copy":arguments[0];this._action=action;if(this._action!=="copy"&&this._action!=="cut"){throw new Error('Invalid "action" value, use either "copy" or "cut"')}},get:function get(){return this._action}},{key:"target",set:function set(target){if(target!==undefined){if(target&&typeof target==="object"&&target.nodeType===1){this._target=target}else{throw new Error('Invalid "target" value, use a valid Element')}}},get:function get(){return this._target}}]);return ClipboardAction}();exports["default"]=ClipboardAction;module.exports=exports["default"]},1932:function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var _clipboardAction=__webpack_require__(1931);var _clipboardAction2=_interopRequireDefault(_clipboardAction);var _tinyEmitter=__webpack_require__(1960);var _tinyEmitter2=_interopRequireDefault(_tinyEmitter);var _goodListener=__webpack_require__(1942);var _goodListener2=_interopRequireDefault(_goodListener);var Clipboard=function(_Emitter){_inherits(Clipboard,_Emitter);function Clipboard(trigger,options){_classCallCheck(this,Clipboard);_Emitter.call(this);this.resolveOptions(options);this.listenClick(trigger)}Clipboard.prototype.resolveOptions=function resolveOptions(){var options=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];this.action=typeof options.action==="function"?options.action:this.defaultAction;this.target=typeof options.target==="function"?options.target:this.defaultTarget;this.text=typeof options.text==="function"?options.text:this.defaultText};Clipboard.prototype.listenClick=function listenClick(trigger){var _this=this;this.listener=_goodListener2["default"](trigger,"click",function(e){return _this.onClick(e)})};Clipboard.prototype.onClick=function onClick(e){if(this.clipboardAction){this.clipboardAction=null}this.clipboardAction=new _clipboardAction2["default"]({action:this.action(e.target),target:this.target(e.target),text:this.text(e.target),trigger:e.target,emitter:this})};Clipboard.prototype.defaultAction=function defaultAction(trigger){return getAttributeValue("action",trigger)};Clipboard.prototype.defaultTarget=function defaultTarget(trigger){var selector=getAttributeValue("target",trigger);if(selector){return document.querySelector(selector)}};Clipboard.prototype.defaultText=function defaultText(trigger){return getAttributeValue("text",trigger)};Clipboard.prototype.destroy=function destroy(){this.listener.destroy();if(this.clipboardAction){this.clipboardAction.destroy();this.clipboardAction=null}};return Clipboard}(_tinyEmitter2["default"]);function getAttributeValue(suffix,element){var attribute="data-clipboard-"+suffix;if(!element.hasAttribute(attribute)){return}return element.getAttribute(attribute)}exports["default"]=Clipboard;module.exports=exports["default"]},1933:function(module,exports,__webpack_require__){try{var matches=__webpack_require__(755)}catch(err){var matches=__webpack_require__(755)}module.exports=closest;function closest(el,selector,scope){scope=scope||document.documentElement;while(el&&el!==scope){if(matches(el,selector))return el;el=el.parentNode}return matches(el,selector)?el:null}},1934:function(module,exports,__webpack_require__){var closest=__webpack_require__(1933);function delegate(element,selector,type,callback,useCapture){var listenerFn=listener.apply(this,arguments);element.addEventListener(type,listenerFn,useCapture);return{destroy:function(){element.removeEventListener(type,listenerFn,useCapture)}}}function listener(element,selector,type,callback){return function(e){e.delegateTarget=closest(e.target,selector,true);if(e.delegateTarget){callback.call(element,e)}}}module.exports=delegate},1935:function(module,exports){"use strict";module.exports=!!(typeof window!=="undefined"&&window.document&&window.document.createElement)},1940:function(module,exports,__webpack_require__){module.exports.Container=__webpack_require__(3460);module.exports.MapStore=__webpack_require__(3461);module.exports.Mixin=__webpack_require__(3462);module.exports.ReduceStore=__webpack_require__(2404);module.exports.Store=__webpack_require__(2405)},1941:function(module,exports){exports.node=function(value){return value!==undefined&&value instanceof HTMLElement&&value.nodeType===1};exports.nodeList=function(value){var type=Object.prototype.toString.call(value);return value!==undefined&&(type==="[object NodeList]"||type==="[object HTMLCollection]")&&"length"in value&&(value.length===0||exports.node(value[0]))};exports.string=function(value){return typeof value==="string"||value instanceof String};exports.fn=function(value){var type=Object.prototype.toString.call(value);return type==="[object Function]"}},1942:function(module,exports,__webpack_require__){var is=__webpack_require__(1941);var delegate=__webpack_require__(1934);function listen(target,type,callback){if(!target&&!type&&!callback){throw new Error("Missing required arguments")}if(!is.string(type)){throw new TypeError("Second argument must be a String")}if(!is.fn(callback)){throw new TypeError("Third argument must be a Function")}if(is.node(target)){return listenNode(target,type,callback)}else if(is.nodeList(target)){return listenNodeList(target,type,callback)}else if(is.string(target)){return listenSelector(target,type,callback)}else{throw new TypeError("First argument must be a String, HTMLElement, HTMLCollection, or NodeList")}}function listenNode(node,type,callback){node.addEventListener(type,callback);return{destroy:function(){node.removeEventListener(type,callback)}}}function listenNodeList(nodeList,type,callback){Array.prototype.forEach.call(nodeList,function(node){node.addEventListener(type,callback)});return{destroy:function(){Array.prototype.forEach.call(nodeList,function(node){node.removeEventListener(type,callback)})}}}function listenSelector(selector,type,callback){return delegate(document.body,selector,type,callback)}module.exports=listen},1946:function(module,exports,__webpack_require__){var createAggregator=__webpack_require__(418);var partition=createAggregator(function(result,value,key){result[key?0:1].push(value)},function(){return[[],[]]});module.exports=partition},1947:function(module,exports,__webpack_require__){var baseSlice=__webpack_require__(140),toInteger=__webpack_require__(65);function take(array,n,guard){if(!(array&&array.length)){return[]}n=guard||n===undefined?1:toInteger(n);return baseSlice(array,0,n<0?0:n)}module.exports=take},1948:function(module,exports,__webpack_require__){(function(process){(function(){var getNanoSeconds,hrtime,loadTime;if(typeof performance!=="undefined"&&performance!==null&&performance.now){module.exports=function(){return performance.now()}}else if(typeof process!=="undefined"&&process!==null&&process.hrtime){module.exports=function(){return(getNanoSeconds()-loadTime)/1e6};hrtime=process.hrtime;getNanoSeconds=function(){var hr;hr=hrtime();return hr[0]*1e9+hr[1]};loadTime=getNanoSeconds()}else if(Date.now){module.exports=function(){return Date.now()-loadTime};loadTime=Date.now()}else{module.exports=function(){return(new Date).getTime()-loadTime};loadTime=(new Date).getTime()}}).call(this)}).call(exports,__webpack_require__(54))},1949:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _classnames=__webpack_require__(1744);var _classnames2=_interopRequireDefault(_classnames);var _calculateSizeAndPositionDataAndUpdateScrollOffset=__webpack_require__(1953);var _calculateSizeAndPositionDataAndUpdateScrollOffset2=_interopRequireDefault(_calculateSizeAndPositionDataAndUpdateScrollOffset);var _ScalingCellSizeAndPositionManager=__webpack_require__(1952);var _ScalingCellSizeAndPositionManager2=_interopRequireDefault(_ScalingCellSizeAndPositionManager);var _createCallbackMemoizer=__webpack_require__(1957);var _createCallbackMemoizer2=_interopRequireDefault(_createCallbackMemoizer);var _getOverscanIndices=__webpack_require__(1954);var _getOverscanIndices2=_interopRequireDefault(_getOverscanIndices);var _scrollbarSize=__webpack_require__(1864);var _scrollbarSize2=_interopRequireDefault(_scrollbarSize);var _raf=__webpack_require__(1870);var _raf2=_interopRequireDefault(_raf);var _reactAddonsShallowCompare=__webpack_require__(738);var _reactAddonsShallowCompare2=_interopRequireDefault(_reactAddonsShallowCompare);var _updateScrollIndexHelper=__webpack_require__(1955);var _updateScrollIndexHelper2=_interopRequireDefault(_updateScrollIndexHelper);var _defaultCellRangeRenderer=__webpack_require__(1801);var _defaultCellRangeRenderer2=_interopRequireDefault(_defaultCellRangeRenderer);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var IS_SCROLLING_TIMEOUT=150;var SCROLL_POSITION_CHANGE_REASONS={OBSERVED:"observed",REQUESTED:"requested"};var Grid=function(_Component){_inherits(Grid,_Component);function Grid(props,context){_classCallCheck(this,Grid);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(Grid).call(this,props,context));_this.state={isScrolling:false,scrollLeft:0,scrollTop:0};_this._onGridRenderedMemoizer=(0,_createCallbackMemoizer2.default)();_this._onScrollMemoizer=(0,_createCallbackMemoizer2.default)(false);_this._enablePointerEventsAfterDelayCallback=_this._enablePointerEventsAfterDelayCallback.bind(_this);_this._invokeOnGridRenderedHelper=_this._invokeOnGridRenderedHelper.bind(_this);_this._onScroll=_this._onScroll.bind(_this);_this._setNextStateCallback=_this._setNextStateCallback.bind(_this);_this._updateScrollLeftForScrollToColumn=_this._updateScrollLeftForScrollToColumn.bind(_this);_this._updateScrollTopForScrollToRow=_this._updateScrollTopForScrollToRow.bind(_this);_this._columnWidthGetter=_this._wrapSizeGetter(props.columnWidth);_this._rowHeightGetter=_this._wrapSizeGetter(props.rowHeight);_this._columnSizeAndPositionManager=new _ScalingCellSizeAndPositionManager2.default({cellCount:props.columnCount,cellSizeGetter:function cellSizeGetter(index){return _this._columnWidthGetter(index)},estimatedCellSize:_this._getEstimatedColumnSize(props)});_this._rowSizeAndPositionManager=new _ScalingCellSizeAndPositionManager2.default({cellCount:props.rowCount,cellSizeGetter:function cellSizeGetter(index){return _this._rowHeightGetter(index)},estimatedCellSize:_this._getEstimatedRowSize(props)});_this._cellCache={};return _this}_createClass(Grid,[{key:"measureAllCells",value:function measureAllCells(){var _props=this.props;var columnCount=_props.columnCount;var rowCount=_props.rowCount;this._columnSizeAndPositionManager.getSizeAndPositionOfCell(columnCount-1);this._rowSizeAndPositionManager.getSizeAndPositionOfCell(rowCount-1)}},{key:"recomputeGridSize",value:function recomputeGridSize(){
this._columnSizeAndPositionManager.resetCell(0);this._rowSizeAndPositionManager.resetCell(0);this.forceUpdate()}},{key:"componentDidMount",value:function componentDidMount(){var _props2=this.props;var scrollLeft=_props2.scrollLeft;var scrollToColumn=_props2.scrollToColumn;var scrollTop=_props2.scrollTop;var scrollToRow=_props2.scrollToRow;if(!this._scrollbarSizeMeasured){this._scrollbarSize=(0,_scrollbarSize2.default)();this._scrollbarSizeMeasured=true;this.setState({})}if(scrollLeft>=0||scrollTop>=0){this._setScrollPosition({scrollLeft:scrollLeft,scrollTop:scrollTop})}if(scrollToColumn>=0||scrollToRow>=0){this._updateScrollLeftForScrollToColumn();this._updateScrollTopForScrollToRow()}this._invokeOnGridRenderedHelper();this._invokeOnScrollMemoizer({scrollLeft:scrollLeft||0,scrollTop:scrollTop||0,totalColumnsWidth:this._columnSizeAndPositionManager.getTotalSize(),totalRowsHeight:this._rowSizeAndPositionManager.getTotalSize()})}},{key:"componentDidUpdate",value:function componentDidUpdate(prevProps,prevState){var _this2=this;var _props3=this.props;var autoHeight=_props3.autoHeight;var height=_props3.height;var scrollToAlignment=_props3.scrollToAlignment;var scrollToColumn=_props3.scrollToColumn;var scrollToRow=_props3.scrollToRow;var width=_props3.width;var _state=this.state;var scrollLeft=_state.scrollLeft;var scrollPositionChangeReason=_state.scrollPositionChangeReason;var scrollTop=_state.scrollTop;if(scrollPositionChangeReason===SCROLL_POSITION_CHANGE_REASONS.REQUESTED){if(scrollLeft>=0&&scrollLeft!==prevState.scrollLeft&&scrollLeft!==this.refs.scrollingContainer.scrollLeft){this.refs.scrollingContainer.scrollLeft=scrollLeft}if(!autoHeight&&scrollTop>=0&&scrollTop!==prevState.scrollTop&&scrollTop!==this.refs.scrollingContainer.scrollTop){this.refs.scrollingContainer.scrollTop=scrollTop}}(0,_updateScrollIndexHelper2.default)({cellSizeAndPositionManager:this._columnSizeAndPositionManager,previousCellsCount:prevProps.columnCount,previousCellSize:prevProps.columnWidth,previousScrollToAlignment:prevProps.scrollToAlignment,previousScrollToIndex:prevProps.scrollToColumn,previousSize:prevProps.width,scrollOffset:scrollLeft,scrollToAlignment:scrollToAlignment,scrollToIndex:scrollToColumn,size:width,updateScrollIndexCallback:function updateScrollIndexCallback(scrollToColumn){return _this2._updateScrollLeftForScrollToColumn(_extends({},_this2.props,{scrollToColumn:scrollToColumn}))}});(0,_updateScrollIndexHelper2.default)({cellSizeAndPositionManager:this._rowSizeAndPositionManager,previousCellsCount:prevProps.rowCount,previousCellSize:prevProps.rowHeight,previousScrollToAlignment:prevProps.scrollToAlignment,previousScrollToIndex:prevProps.scrollToRow,previousSize:prevProps.height,scrollOffset:scrollTop,scrollToAlignment:scrollToAlignment,scrollToIndex:scrollToRow,size:height,updateScrollIndexCallback:function updateScrollIndexCallback(scrollToRow){return _this2._updateScrollTopForScrollToRow(_extends({},_this2.props,{scrollToRow:scrollToRow}))}});this._invokeOnGridRenderedHelper()}},{key:"componentWillMount",value:function componentWillMount(){this._scrollbarSize=(0,_scrollbarSize2.default)();if(this._scrollbarSize===undefined){this._scrollbarSizeMeasured=false;this._scrollbarSize=0}else{this._scrollbarSizeMeasured=true}}},{key:"componentWillUnmount",value:function componentWillUnmount(){if(this._disablePointerEventsTimeoutId){clearTimeout(this._disablePointerEventsTimeoutId)}if(this._setNextStateAnimationFrameId){_raf2.default.cancel(this._setNextStateAnimationFrameId)}}},{key:"componentWillUpdate",value:function componentWillUpdate(nextProps,nextState){var _this3=this;if(nextProps.columnCount===0&&nextState.scrollLeft!==0||nextProps.rowCount===0&&nextState.scrollTop!==0){this._setScrollPosition({scrollLeft:0,scrollTop:0})}else if(nextProps.scrollLeft!==this.props.scrollLeft||nextProps.scrollTop!==this.props.scrollTop){this._setScrollPosition({scrollLeft:nextProps.scrollLeft,scrollTop:nextProps.scrollTop})}this._columnWidthGetter=this._wrapSizeGetter(nextProps.columnWidth);this._rowHeightGetter=this._wrapSizeGetter(nextProps.rowHeight);this._columnSizeAndPositionManager.configure({cellCount:nextProps.columnCount,estimatedCellSize:this._getEstimatedColumnSize(nextProps)});this._rowSizeAndPositionManager.configure({cellCount:nextProps.rowCount,estimatedCellSize:this._getEstimatedRowSize(nextProps)});(0,_calculateSizeAndPositionDataAndUpdateScrollOffset2.default)({cellCount:this.props.columnCount,cellSize:this.props.columnWidth,computeMetadataCallback:function computeMetadataCallback(){return _this3._columnSizeAndPositionManager.resetCell(0)},computeMetadataCallbackProps:nextProps,nextCellsCount:nextProps.columnCount,nextCellSize:nextProps.columnWidth,nextScrollToIndex:nextProps.scrollToColumn,scrollToIndex:this.props.scrollToColumn,updateScrollOffsetForScrollToIndex:function updateScrollOffsetForScrollToIndex(){return _this3._updateScrollLeftForScrollToColumn(nextProps,nextState)}});(0,_calculateSizeAndPositionDataAndUpdateScrollOffset2.default)({cellCount:this.props.rowCount,cellSize:this.props.rowHeight,computeMetadataCallback:function computeMetadataCallback(){return _this3._rowSizeAndPositionManager.resetCell(0)},computeMetadataCallbackProps:nextProps,nextCellsCount:nextProps.rowCount,nextCellSize:nextProps.rowHeight,nextScrollToIndex:nextProps.scrollToRow,scrollToIndex:this.props.scrollToRow,updateScrollOffsetForScrollToIndex:function updateScrollOffsetForScrollToIndex(){return _this3._updateScrollTopForScrollToRow(nextProps,nextState)}})}},{key:"render",value:function render(){var _props4=this.props;var cellClassName=_props4.cellClassName;var cellRenderer=_props4.cellRenderer;var cellRangeRenderer=_props4.cellRangeRenderer;var cellStyle=_props4.cellStyle;var className=_props4.className;var columnCount=_props4.columnCount;var height=_props4.height;var noContentRenderer=_props4.noContentRenderer;var overscanColumnCount=_props4.overscanColumnCount;var overscanRowCount=_props4.overscanRowCount;var autoHeight=_props4.autoHeight;var rowCount=_props4.rowCount;var style=_props4.style;var tabIndex=_props4.tabIndex;var width=_props4.width;var _state2=this.state;var isScrolling=_state2.isScrolling;var scrollLeft=_state2.scrollLeft;var scrollTop=_state2.scrollTop;var childrenToDisplay=[];if(height>0&&width>0){var visibleColumnIndices=this._columnSizeAndPositionManager.getVisibleCellRange({containerSize:width,offset:scrollLeft});var visibleRowIndices=this._rowSizeAndPositionManager.getVisibleCellRange({containerSize:height,offset:scrollTop});var horizontalOffsetAdjustment=this._columnSizeAndPositionManager.getOffsetAdjustment({containerSize:width,offset:scrollLeft});var verticalOffsetAdjustment=this._rowSizeAndPositionManager.getOffsetAdjustment({containerSize:height,offset:scrollTop});this._renderedColumnStartIndex=visibleColumnIndices.start;this._renderedColumnStopIndex=visibleColumnIndices.stop;this._renderedRowStartIndex=visibleRowIndices.start;this._renderedRowStopIndex=visibleRowIndices.stop;var overscanColumnIndices=(0,_getOverscanIndices2.default)({cellCount:columnCount,overscanCellsCount:overscanColumnCount,startIndex:this._renderedColumnStartIndex,stopIndex:this._renderedColumnStopIndex});var overscanRowIndices=(0,_getOverscanIndices2.default)({cellCount:rowCount,overscanCellsCount:overscanRowCount,startIndex:this._renderedRowStartIndex,stopIndex:this._renderedRowStopIndex});this._columnStartIndex=overscanColumnIndices.overscanStartIndex;this._columnStopIndex=overscanColumnIndices.overscanStopIndex;this._rowStartIndex=overscanRowIndices.overscanStartIndex;this._rowStopIndex=overscanRowIndices.overscanStopIndex;childrenToDisplay=cellRangeRenderer({cellCache:this._cellCache,cellClassName:this._wrapCellClassNameGetter(cellClassName),cellRenderer:cellRenderer,cellStyle:this._wrapCellStyleGetter(cellStyle),columnSizeAndPositionManager:this._columnSizeAndPositionManager,columnStartIndex:this._columnStartIndex,columnStopIndex:this._columnStopIndex,horizontalOffsetAdjustment:horizontalOffsetAdjustment,isScrolling:isScrolling,rowSizeAndPositionManager:this._rowSizeAndPositionManager,rowStartIndex:this._rowStartIndex,rowStopIndex:this._rowStopIndex,scrollLeft:scrollLeft,scrollTop:scrollTop,verticalOffsetAdjustment:verticalOffsetAdjustment})}var gridStyle=_extends({},style,{height:autoHeight?"auto":height,width:width});var totalColumnsWidth=this._columnSizeAndPositionManager.getTotalSize();var totalRowsHeight=this._rowSizeAndPositionManager.getTotalSize();var verticalScrollBarSize=totalRowsHeight>height?this._scrollbarSize:0;var horizontalScrollBarSize=totalColumnsWidth>width?this._scrollbarSize:0;if(totalColumnsWidth+verticalScrollBarSize<=width){gridStyle.overflowX="hidden"}if(totalRowsHeight+horizontalScrollBarSize<=height){gridStyle.overflowY="hidden"}var showNoContentRenderer=childrenToDisplay.length===0&&height>0&&width>0;return _react2.default.createElement("div",{ref:"scrollingContainer","aria-label":this.props["aria-label"],className:(0,_classnames2.default)("Grid",className),onScroll:this._onScroll,role:"grid",style:gridStyle,tabIndex:tabIndex},childrenToDisplay.length>0&&_react2.default.createElement("div",{className:"Grid__innerScrollContainer",style:{width:totalColumnsWidth,height:totalRowsHeight,maxWidth:totalColumnsWidth,maxHeight:totalRowsHeight,pointerEvents:isScrolling?"none":"auto"}},childrenToDisplay),showNoContentRenderer&&noContentRenderer())}},{key:"shouldComponentUpdate",value:function shouldComponentUpdate(nextProps,nextState){return(0,_reactAddonsShallowCompare2.default)(this,nextProps,nextState)}},{key:"_enablePointerEventsAfterDelay",value:function _enablePointerEventsAfterDelay(){if(this._disablePointerEventsTimeoutId){clearTimeout(this._disablePointerEventsTimeoutId)}this._disablePointerEventsTimeoutId=setTimeout(this._enablePointerEventsAfterDelayCallback,IS_SCROLLING_TIMEOUT)}},{key:"_enablePointerEventsAfterDelayCallback",value:function _enablePointerEventsAfterDelayCallback(){this._disablePointerEventsTimeoutId=null;this._cellCache={};this.setState({isScrolling:false})}},{key:"_getEstimatedColumnSize",value:function _getEstimatedColumnSize(props){return typeof props.columnWidth==="number"?props.columnWidth:props.estimatedColumnSize}},{key:"_getEstimatedRowSize",value:function _getEstimatedRowSize(props){return typeof props.rowHeight==="number"?props.rowHeight:props.estimatedRowSize}},{key:"_invokeOnGridRenderedHelper",value:function _invokeOnGridRenderedHelper(){var onSectionRendered=this.props.onSectionRendered;this._onGridRenderedMemoizer({callback:onSectionRendered,indices:{columnOverscanStartIndex:this._columnStartIndex,columnOverscanStopIndex:this._columnStopIndex,columnStartIndex:this._renderedColumnStartIndex,columnStopIndex:this._renderedColumnStopIndex,rowOverscanStartIndex:this._rowStartIndex,rowOverscanStopIndex:this._rowStopIndex,rowStartIndex:this._renderedRowStartIndex,rowStopIndex:this._renderedRowStopIndex}})}},{key:"_invokeOnScrollMemoizer",value:function _invokeOnScrollMemoizer(_ref){var _this4=this;var scrollLeft=_ref.scrollLeft;var scrollTop=_ref.scrollTop;var totalColumnsWidth=_ref.totalColumnsWidth;var totalRowsHeight=_ref.totalRowsHeight;this._onScrollMemoizer({callback:function callback(_ref2){var scrollLeft=_ref2.scrollLeft;var scrollTop=_ref2.scrollTop;var _props5=_this4.props;var height=_props5.height;var onScroll=_props5.onScroll;var width=_props5.width;onScroll({clientHeight:height,clientWidth:width,scrollHeight:totalRowsHeight,scrollLeft:scrollLeft,scrollTop:scrollTop,scrollWidth:totalColumnsWidth})},indices:{scrollLeft:scrollLeft,scrollTop:scrollTop}})}},{key:"_setNextState",value:function _setNextState(state){this._nextState=state;if(!this._setNextStateAnimationFrameId){this._setNextStateAnimationFrameId=(0,_raf2.default)(this._setNextStateCallback)}}},{key:"_setNextStateCallback",value:function _setNextStateCallback(){var state=this._nextState;this._setNextStateAnimationFrameId=null;this._nextState=null;this.setState(state)}},{key:"_setScrollPosition",value:function _setScrollPosition(_ref3){var scrollLeft=_ref3.scrollLeft;var scrollTop=_ref3.scrollTop;var newState={scrollPositionChangeReason:SCROLL_POSITION_CHANGE_REASONS.REQUESTED};if(scrollLeft>=0){newState.scrollLeft=scrollLeft}if(scrollTop>=0){newState.scrollTop=scrollTop}if(scrollLeft>=0&&scrollLeft!==this.state.scrollLeft||scrollTop>=0&&scrollTop!==this.state.scrollTop){this.setState(newState)}}},{key:"_wrapCellClassNameGetter",value:function _wrapCellClassNameGetter(className){return this._wrapPropertyGetter(className)}},{key:"_wrapCellStyleGetter",value:function _wrapCellStyleGetter(style){return this._wrapPropertyGetter(style)}},{key:"_wrapPropertyGetter",value:function _wrapPropertyGetter(value){return value instanceof Function?value:function(){return value}}},{key:"_wrapSizeGetter",value:function _wrapSizeGetter(size){return this._wrapPropertyGetter(size)}},{key:"_updateScrollLeftForScrollToColumn",value:function _updateScrollLeftForScrollToColumn(){var props=arguments.length<=0||arguments[0]===undefined?this.props:arguments[0];var state=arguments.length<=1||arguments[1]===undefined?this.state:arguments[1];var columnCount=props.columnCount;var scrollToAlignment=props.scrollToAlignment;var scrollToColumn=props.scrollToColumn;var width=props.width;var scrollLeft=state.scrollLeft;if(scrollToColumn>=0&&columnCount>0){var targetIndex=Math.max(0,Math.min(columnCount-1,scrollToColumn));var calculatedScrollLeft=this._columnSizeAndPositionManager.getUpdatedOffsetForIndex({align:scrollToAlignment,containerSize:width,currentOffset:scrollLeft,targetIndex:targetIndex});if(scrollLeft!==calculatedScrollLeft){this._setScrollPosition({scrollLeft:calculatedScrollLeft})}}}},{key:"_updateScrollTopForScrollToRow",value:function _updateScrollTopForScrollToRow(){var props=arguments.length<=0||arguments[0]===undefined?this.props:arguments[0];var state=arguments.length<=1||arguments[1]===undefined?this.state:arguments[1];var height=props.height;var rowCount=props.rowCount;var scrollToAlignment=props.scrollToAlignment;var scrollToRow=props.scrollToRow;var scrollTop=state.scrollTop;if(scrollToRow>=0&&rowCount>0){var targetIndex=Math.max(0,Math.min(rowCount-1,scrollToRow));var calculatedScrollTop=this._rowSizeAndPositionManager.getUpdatedOffsetForIndex({align:scrollToAlignment,containerSize:height,currentOffset:scrollTop,targetIndex:targetIndex});if(scrollTop!==calculatedScrollTop){this._setScrollPosition({scrollTop:calculatedScrollTop})}}}},{key:"_onScroll",value:function _onScroll(event){if(event.target!==this.refs.scrollingContainer){return}this._enablePointerEventsAfterDelay();var _props6=this.props;var height=_props6.height;var width=_props6.width;var scrollbarSize=this._scrollbarSize;var totalRowsHeight=this._rowSizeAndPositionManager.getTotalSize();var totalColumnsWidth=this._columnSizeAndPositionManager.getTotalSize();var scrollLeft=Math.min(Math.max(0,totalColumnsWidth-width+scrollbarSize),event.target.scrollLeft);var scrollTop=Math.min(Math.max(0,totalRowsHeight-height+scrollbarSize),event.target.scrollTop);if(this.state.scrollLeft!==scrollLeft||this.state.scrollTop!==scrollTop){var scrollPositionChangeReason=event.cancelable?SCROLL_POSITION_CHANGE_REASONS.OBSERVED:SCROLL_POSITION_CHANGE_REASONS.REQUESTED;if(!this.state.isScrolling){this.setState({isScrolling:true})}this._setNextState({isScrolling:true,scrollLeft:scrollLeft,scrollPositionChangeReason:scrollPositionChangeReason,scrollTop:scrollTop})}this._invokeOnScrollMemoizer({scrollLeft:scrollLeft,scrollTop:scrollTop,totalColumnsWidth:totalColumnsWidth,totalRowsHeight:totalRowsHeight})}}]);return Grid}(_react.Component);Grid.propTypes={"aria-label":_react.PropTypes.string,autoHeight:_react.PropTypes.bool,cellClassName:_react.PropTypes.oneOfType([_react.PropTypes.string,_react.PropTypes.func]),cellStyle:_react.PropTypes.oneOfType([_react.PropTypes.object,_react.PropTypes.func]),cellRenderer:_react.PropTypes.func.isRequired,cellRangeRenderer:_react.PropTypes.func.isRequired,className:_react.PropTypes.string,columnCount:_react.PropTypes.number.isRequired,columnWidth:_react.PropTypes.oneOfType([_react.PropTypes.number,_react.PropTypes.func]).isRequired,estimatedColumnSize:_react.PropTypes.number.isRequired,estimatedRowSize:_react.PropTypes.number.isRequired,height:_react.PropTypes.number.isRequired,noContentRenderer:_react.PropTypes.func.isRequired,onScroll:_react.PropTypes.func.isRequired,onSectionRendered:_react.PropTypes.func.isRequired,overscanColumnCount:_react.PropTypes.number.isRequired,overscanRowCount:_react.PropTypes.number.isRequired,rowHeight:_react.PropTypes.oneOfType([_react.PropTypes.number,_react.PropTypes.func]).isRequired,rowCount:_react.PropTypes.number.isRequired,scrollLeft:_react.PropTypes.number,scrollToAlignment:_react.PropTypes.oneOf(["auto","end","start","center"]).isRequired,scrollToColumn:_react.PropTypes.number,scrollTop:_react.PropTypes.number,scrollToRow:_react.PropTypes.number,style:_react.PropTypes.object,tabIndex:_react.PropTypes.number,width:_react.PropTypes.number.isRequired};Grid.defaultProps={"aria-label":"grid",cellStyle:{},cellRangeRenderer:_defaultCellRangeRenderer2.default,estimatedColumnSize:100,estimatedRowSize:30,noContentRenderer:function noContentRenderer(){return null},onScroll:function onScroll(){return null},onSectionRendered:function onSectionRendered(){return null},overscanColumnCount:0,overscanRowCount:10,scrollToAlignment:"auto",style:{},tabIndex:0};exports.default=Grid},1950:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.defaultCellRangeRenderer=exports.Grid=exports.default=undefined;var _Grid2=__webpack_require__(1949);var _Grid3=_interopRequireDefault(_Grid2);var _defaultCellRangeRenderer2=__webpack_require__(1801);var _defaultCellRangeRenderer3=_interopRequireDefault(_defaultCellRangeRenderer2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_Grid3.default;exports.Grid=_Grid3.default;exports.defaultCellRangeRenderer=_defaultCellRangeRenderer3.default},1951:function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var CellSizeAndPositionManager=function(){function CellSizeAndPositionManager(_ref){var cellCount=_ref.cellCount;var cellSizeGetter=_ref.cellSizeGetter;var estimatedCellSize=_ref.estimatedCellSize;_classCallCheck(this,CellSizeAndPositionManager);this._cellSizeGetter=cellSizeGetter;this._cellCount=cellCount;this._estimatedCellSize=estimatedCellSize;this._cellSizeAndPositionData={};this._lastMeasuredIndex=-1}_createClass(CellSizeAndPositionManager,[{key:"configure",value:function configure(_ref2){var cellCount=_ref2.cellCount;var estimatedCellSize=_ref2.estimatedCellSize;this._cellCount=cellCount;this._estimatedCellSize=estimatedCellSize}},{key:"getCellCount",value:function getCellCount(){return this._cellCount}},{key:"getEstimatedCellSize",value:function getEstimatedCellSize(){return this._estimatedCellSize}},{key:"getLastMeasuredIndex",value:function getLastMeasuredIndex(){return this._lastMeasuredIndex}},{key:"getSizeAndPositionOfCell",value:function getSizeAndPositionOfCell(index){if(index<0||index>=this._cellCount){throw Error("Requested index "+index+" is outside of range 0.."+this._cellCount)}if(index>this._lastMeasuredIndex){var lastMeasuredCellSizeAndPosition=this.getSizeAndPositionOfLastMeasuredCell();var _offset=lastMeasuredCellSizeAndPosition.offset+lastMeasuredCellSizeAndPosition.size;for(var i=this._lastMeasuredIndex+1;i<=index;i++){var _size=this._cellSizeGetter({index:i});if(_size==null||isNaN(_size)){throw Error("Invalid size returned for cell "+i+" of value "+_size)}this._cellSizeAndPositionData[i]={offset:_offset,size:_size};_offset+=_size}this._lastMeasuredIndex=index}return this._cellSizeAndPositionData[index]}},{key:"getSizeAndPositionOfLastMeasuredCell",value:function getSizeAndPositionOfLastMeasuredCell(){return this._lastMeasuredIndex>=0?this._cellSizeAndPositionData[this._lastMeasuredIndex]:{offset:0,size:0}}},{key:"getTotalSize",value:function getTotalSize(){var lastMeasuredCellSizeAndPosition=this.getSizeAndPositionOfLastMeasuredCell();return lastMeasuredCellSizeAndPosition.offset+lastMeasuredCellSizeAndPosition.size+(this._cellCount-this._lastMeasuredIndex-1)*this._estimatedCellSize}},{key:"getUpdatedOffsetForIndex",value:function getUpdatedOffsetForIndex(_ref3){var _ref3$align=_ref3.align;var align=_ref3$align===undefined?"auto":_ref3$align;var containerSize=_ref3.containerSize;var currentOffset=_ref3.currentOffset;var targetIndex=_ref3.targetIndex;var datum=this.getSizeAndPositionOfCell(targetIndex);var maxOffset=datum.offset;var minOffset=maxOffset-containerSize+datum.size;switch(align){case"start":return maxOffset;case"end":return minOffset;case"center":return maxOffset-(containerSize+datum.size)/2;default:return Math.max(minOffset,Math.min(maxOffset,currentOffset))}}},{key:"getVisibleCellRange",value:function getVisibleCellRange(_ref4){var containerSize=_ref4.containerSize;var offset=_ref4.offset;var totalSize=this.getTotalSize();if(totalSize===0){return{}}var maxOffset=offset+containerSize;var start=this._findNearestCell(offset);var datum=this.getSizeAndPositionOfCell(start);offset=datum.offset+datum.size;var stop=start;while(offset<maxOffset&&stop<this._cellCount-1){stop++;offset+=this.getSizeAndPositionOfCell(stop).size}return{start:start,stop:stop}}},{key:"resetCell",value:function resetCell(index){this._lastMeasuredIndex=index-1}},{key:"_binarySearch",value:function _binarySearch(_ref5){var high=_ref5.high;var low=_ref5.low;var offset=_ref5.offset;var middle=void 0;var currentOffset=void 0;while(low<=high){middle=low+Math.floor((high-low)/2);currentOffset=this.getSizeAndPositionOfCell(middle).offset;if(currentOffset===offset){return middle}else if(currentOffset<offset){low=middle+1}else if(currentOffset>offset){high=middle-1}}if(low>0){return low-1}}},{key:"_exponentialSearch",value:function _exponentialSearch(_ref6){var index=_ref6.index;var offset=_ref6.offset;var interval=1;while(index<this._cellCount&&this.getSizeAndPositionOfCell(index).offset<offset){index+=interval;interval*=2}return this._binarySearch({high:Math.min(index,this._cellCount-1),low:Math.floor(index/2),offset:offset})}},{key:"_findNearestCell",value:function _findNearestCell(offset){if(isNaN(offset)){throw Error("Invalid offset "+offset+" specified")}offset=Math.max(0,offset);var lastMeasuredCellSizeAndPosition=this.getSizeAndPositionOfLastMeasuredCell();var lastMeasuredIndex=Math.max(0,this._lastMeasuredIndex);if(lastMeasuredCellSizeAndPosition.offset>=offset){return this._binarySearch({high:lastMeasuredIndex,low:0,offset:offset})}else{return this._exponentialSearch({index:lastMeasuredIndex,offset:offset})}}}]);return CellSizeAndPositionManager}();exports.default=CellSizeAndPositionManager},1952:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.DEFAULT_MAX_SCROLL_SIZE=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _CellSizeAndPositionManager=__webpack_require__(1951);var _CellSizeAndPositionManager2=_interopRequireDefault(_CellSizeAndPositionManager);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var DEFAULT_MAX_SCROLL_SIZE=exports.DEFAULT_MAX_SCROLL_SIZE=1e7;var ScalingCellSizeAndPositionManager=function(){function ScalingCellSizeAndPositionManager(_ref){var _ref$maxScrollSize=_ref.maxScrollSize;var maxScrollSize=_ref$maxScrollSize===undefined?DEFAULT_MAX_SCROLL_SIZE:_ref$maxScrollSize;var params=_objectWithoutProperties(_ref,["maxScrollSize"]);_classCallCheck(this,ScalingCellSizeAndPositionManager);this._cellSizeAndPositionManager=new _CellSizeAndPositionManager2.default(params);this._maxScrollSize=maxScrollSize}_createClass(ScalingCellSizeAndPositionManager,[{key:"configure",value:function configure(params){this._cellSizeAndPositionManager.configure(params)}},{key:"getCellCount",value:function getCellCount(){return this._cellSizeAndPositionManager.getCellCount()}},{key:"getEstimatedCellSize",value:function getEstimatedCellSize(){return this._cellSizeAndPositionManager.getEstimatedCellSize()}},{key:"getLastMeasuredIndex",value:function getLastMeasuredIndex(){return this._cellSizeAndPositionManager.getLastMeasuredIndex()}},{key:"getOffsetAdjustment",value:function getOffsetAdjustment(_ref2){var containerSize=_ref2.containerSize;var offset=_ref2.offset;var totalSize=this._cellSizeAndPositionManager.getTotalSize();var safeTotalSize=this.getTotalSize();var offsetPercentage=this._getOffsetPercentage({containerSize:containerSize,offset:offset,totalSize:safeTotalSize});return Math.round(offsetPercentage*(safeTotalSize-totalSize))}},{key:"getSizeAndPositionOfCell",value:function getSizeAndPositionOfCell(index){return this._cellSizeAndPositionManager.getSizeAndPositionOfCell(index)}},{key:"getSizeAndPositionOfLastMeasuredCell",value:function getSizeAndPositionOfLastMeasuredCell(){return this._cellSizeAndPositionManager.getSizeAndPositionOfLastMeasuredCell()}},{key:"getTotalSize",value:function getTotalSize(){return Math.min(this._maxScrollSize,this._cellSizeAndPositionManager.getTotalSize())}},{key:"getUpdatedOffsetForIndex",value:function getUpdatedOffsetForIndex(_ref3){var _ref3$align=_ref3.align;var align=_ref3$align===undefined?"auto":_ref3$align;var containerSize=_ref3.containerSize;var currentOffset=_ref3.currentOffset;var targetIndex=_ref3.targetIndex;currentOffset=this._safeOffsetToOffset({containerSize:containerSize,offset:currentOffset});var offset=this._cellSizeAndPositionManager.getUpdatedOffsetForIndex({align:align,containerSize:containerSize,currentOffset:currentOffset,targetIndex:targetIndex});return this._offsetToSafeOffset({containerSize:containerSize,offset:offset})}},{key:"getVisibleCellRange",value:function getVisibleCellRange(_ref4){var containerSize=_ref4.containerSize;var offset=_ref4.offset;offset=this._safeOffsetToOffset({containerSize:containerSize,offset:offset});return this._cellSizeAndPositionManager.getVisibleCellRange({containerSize:containerSize,offset:offset})}},{key:"resetCell",value:function resetCell(index){this._cellSizeAndPositionManager.resetCell(index)}},{key:"_getOffsetPercentage",value:function _getOffsetPercentage(_ref5){var containerSize=_ref5.containerSize;var offset=_ref5.offset;var totalSize=_ref5.totalSize;return totalSize<=containerSize?0:offset/(totalSize-containerSize)}},{key:"_offsetToSafeOffset",value:function _offsetToSafeOffset(_ref6){var containerSize=_ref6.containerSize;var offset=_ref6.offset;var totalSize=this._cellSizeAndPositionManager.getTotalSize();var safeTotalSize=this.getTotalSize();if(totalSize===safeTotalSize){return offset}else{var offsetPercentage=this._getOffsetPercentage({containerSize:containerSize,offset:offset,totalSize:totalSize});return Math.round(offsetPercentage*(safeTotalSize-containerSize))}}},{key:"_safeOffsetToOffset",value:function _safeOffsetToOffset(_ref7){var containerSize=_ref7.containerSize;var offset=_ref7.offset;var totalSize=this._cellSizeAndPositionManager.getTotalSize();var safeTotalSize=this.getTotalSize();if(totalSize===safeTotalSize){return offset}else{var offsetPercentage=this._getOffsetPercentage({containerSize:containerSize,offset:offset,totalSize:safeTotalSize});return Math.round(offsetPercentage*(totalSize-containerSize))}}}]);return ScalingCellSizeAndPositionManager}();exports.default=ScalingCellSizeAndPositionManager},1953:function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=calculateSizeAndPositionDataAndUpdateScrollOffset;function calculateSizeAndPositionDataAndUpdateScrollOffset(_ref){var cellCount=_ref.cellCount;var cellSize=_ref.cellSize;var computeMetadataCallback=_ref.computeMetadataCallback;var computeMetadataCallbackProps=_ref.computeMetadataCallbackProps;var nextCellsCount=_ref.nextCellsCount;var nextCellSize=_ref.nextCellSize;var nextScrollToIndex=_ref.nextScrollToIndex;var scrollToIndex=_ref.scrollToIndex;var updateScrollOffsetForScrollToIndex=_ref.updateScrollOffsetForScrollToIndex;if(cellCount!==nextCellsCount||(typeof cellSize==="number"||typeof nextCellSize==="number")&&cellSize!==nextCellSize){computeMetadataCallback(computeMetadataCallbackProps);if(scrollToIndex>=0&&scrollToIndex===nextScrollToIndex){updateScrollOffsetForScrollToIndex()}}}},1954:function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=getOverscanIndices;function getOverscanIndices(_ref){var cellCount=_ref.cellCount;var overscanCellsCount=_ref.overscanCellsCount;var startIndex=_ref.startIndex;var stopIndex=_ref.stopIndex;return{overscanStartIndex:Math.max(0,startIndex-overscanCellsCount),overscanStopIndex:Math.min(cellCount-1,stopIndex+overscanCellsCount)}}},1955:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=updateScrollIndexHelper;var _getUpdatedOffsetForIndex=__webpack_require__(1958);var _getUpdatedOffsetForIndex2=_interopRequireDefault(_getUpdatedOffsetForIndex);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function updateScrollIndexHelper(_ref){var cellSize=_ref.cellSize;var cellSizeAndPositionManager=_ref.cellSizeAndPositionManager;var previousCellsCount=_ref.previousCellsCount;var previousCellSize=_ref.previousCellSize;var previousScrollToAlignment=_ref.previousScrollToAlignment;var previousScrollToIndex=_ref.previousScrollToIndex;var previousSize=_ref.previousSize;var scrollOffset=_ref.scrollOffset;var scrollToAlignment=_ref.scrollToAlignment;var scrollToIndex=_ref.scrollToIndex;var size=_ref.size;var updateScrollIndexCallback=_ref.updateScrollIndexCallback;var cellCount=cellSizeAndPositionManager.getCellCount();var hasScrollToIndex=scrollToIndex>=0&&scrollToIndex<cellCount;var sizeHasChanged=size!==previousSize||!previousCellSize||typeof cellSize==="number"&&cellSize!==previousCellSize;if(hasScrollToIndex&&(sizeHasChanged||scrollToAlignment!==previousScrollToAlignment||scrollToIndex!==previousScrollToIndex)){updateScrollIndexCallback(scrollToIndex)}else if(!hasScrollToIndex&&cellCount>0&&(size<previousSize||cellCount<previousCellsCount)){scrollToIndex=cellCount-1;var cellMetadatum=cellSizeAndPositionManager.getSizeAndPositionOfCell(scrollToIndex);var calculatedScrollOffset=(0,_getUpdatedOffsetForIndex2.default)({cellOffset:cellMetadatum.offset,cellSize:cellMetadatum.size,
containerSize:size,currentOffset:scrollOffset});if(calculatedScrollOffset<scrollOffset){updateScrollIndexCallback(cellCount-1)}}}},1956:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _Grid=__webpack_require__(1950);var _Grid2=_interopRequireDefault(_Grid);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _classnames=__webpack_require__(1744);var _classnames2=_interopRequireDefault(_classnames);var _reactAddonsShallowCompare=__webpack_require__(738);var _reactAddonsShallowCompare2=_interopRequireDefault(_reactAddonsShallowCompare);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var VirtualScroll=function(_Component){_inherits(VirtualScroll,_Component);function VirtualScroll(props,context){_classCallCheck(this,VirtualScroll);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(VirtualScroll).call(this,props,context));_this._cellRenderer=_this._cellRenderer.bind(_this);_this._onScroll=_this._onScroll.bind(_this);_this._onSectionRendered=_this._onSectionRendered.bind(_this);_this._wrapIndexGetter=_this._wrapIndexGetter.bind(_this);return _this}_createClass(VirtualScroll,[{key:"forceUpdateGrid",value:function forceUpdateGrid(){this.refs.Grid.forceUpdate()}},{key:"measureAllRows",value:function measureAllRows(){this.refs.Grid.measureAllCells()}},{key:"recomputeRowHeights",value:function recomputeRowHeights(){this.refs.Grid.recomputeGridSize();this.forceUpdateGrid()}},{key:"render",value:function render(){var _props=this.props;var className=_props.className;var estimatedRowSize=_props.estimatedRowSize;var height=_props.height;var noRowsRenderer=_props.noRowsRenderer;var rowHeight=_props.rowHeight;var overscanRowCount=_props.overscanRowCount;var autoHeight=_props.autoHeight;var rowClassName=_props.rowClassName;var rowCount=_props.rowCount;var rowStyle=_props.rowStyle;var scrollToAlignment=_props.scrollToAlignment;var scrollToIndex=_props.scrollToIndex;var scrollTop=_props.scrollTop;var style=_props.style;var tabIndex=_props.tabIndex;var width=_props.width;var classNames=(0,_classnames2.default)("VirtualScroll",className);var cellClassName=this._wrapIndexGetter(rowClassName);var cellStyle=this._wrapIndexGetter(rowStyle);return _react2.default.createElement(_Grid2.default,{ref:"Grid","aria-label":this.props["aria-label"],className:classNames,cellRenderer:this._cellRenderer,cellClassName:cellClassName,cellStyle:cellStyle,columnWidth:width,columnCount:1,estimatedRowSize:estimatedRowSize,height:height,noContentRenderer:noRowsRenderer,onScroll:this._onScroll,onSectionRendered:this._onSectionRendered,overscanRowCount:overscanRowCount,autoHeight:autoHeight,rowHeight:rowHeight,rowCount:rowCount,scrollToAlignment:scrollToAlignment,scrollToRow:scrollToIndex,scrollTop:scrollTop,style:style,tabIndex:tabIndex,width:width})}},{key:"shouldComponentUpdate",value:function shouldComponentUpdate(nextProps,nextState){return(0,_reactAddonsShallowCompare2.default)(this,nextProps,nextState)}},{key:"_cellRenderer",value:function _cellRenderer(_ref){var columnIndex=_ref.columnIndex;var isScrolling=_ref.isScrolling;var rowIndex=_ref.rowIndex;var rowRenderer=this.props.rowRenderer;return rowRenderer({index:rowIndex,isScrolling:isScrolling})}},{key:"_onScroll",value:function _onScroll(_ref2){var clientHeight=_ref2.clientHeight;var scrollHeight=_ref2.scrollHeight;var scrollTop=_ref2.scrollTop;var onScroll=this.props.onScroll;onScroll({clientHeight:clientHeight,scrollHeight:scrollHeight,scrollTop:scrollTop})}},{key:"_onSectionRendered",value:function _onSectionRendered(_ref3){var rowOverscanStartIndex=_ref3.rowOverscanStartIndex;var rowOverscanStopIndex=_ref3.rowOverscanStopIndex;var rowStartIndex=_ref3.rowStartIndex;var rowStopIndex=_ref3.rowStopIndex;var onRowsRendered=this.props.onRowsRendered;onRowsRendered({overscanStartIndex:rowOverscanStartIndex,overscanStopIndex:rowOverscanStopIndex,startIndex:rowStartIndex,stopIndex:rowStopIndex})}},{key:"_wrapIndexGetter",value:function _wrapIndexGetter(value){return value instanceof Function?function(_ref4){var rowIndex=_ref4.rowIndex;return value({index:rowIndex})}:function(){return value}}}]);return VirtualScroll}(_react.Component);VirtualScroll.propTypes={"aria-label":_react.PropTypes.string,autoHeight:_react.PropTypes.bool,className:_react.PropTypes.string,estimatedRowSize:_react.PropTypes.number.isRequired,height:_react.PropTypes.number.isRequired,noRowsRenderer:_react.PropTypes.func.isRequired,onRowsRendered:_react.PropTypes.func.isRequired,overscanRowCount:_react.PropTypes.number.isRequired,onScroll:_react.PropTypes.func.isRequired,rowHeight:_react.PropTypes.oneOfType([_react.PropTypes.number,_react.PropTypes.func]).isRequired,rowRenderer:_react.PropTypes.func.isRequired,rowClassName:_react.PropTypes.oneOfType([_react.PropTypes.string,_react.PropTypes.func]),rowCount:_react.PropTypes.number.isRequired,rowStyle:_react.PropTypes.oneOfType([_react.PropTypes.object,_react.PropTypes.func]),scrollToAlignment:_react.PropTypes.oneOf(["auto","end","start","center"]).isRequired,scrollToIndex:_react.PropTypes.number,scrollTop:_react.PropTypes.number,style:_react.PropTypes.object,tabIndex:_react.PropTypes.number,width:_react.PropTypes.number.isRequired};VirtualScroll.defaultProps={estimatedRowSize:30,noRowsRenderer:function noRowsRenderer(){return null},onRowsRendered:function onRowsRendered(){return null},onScroll:function onScroll(){return null},overscanRowCount:10,scrollToAlignment:"auto",style:{}};exports.default=VirtualScroll},1957:function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=createCallbackMemoizer;function createCallbackMemoizer(){var requireAllKeys=arguments.length<=0||arguments[0]===undefined?true:arguments[0];var cachedIndices={};return function(_ref){var callback=_ref.callback;var indices=_ref.indices;var keys=Object.keys(indices);var allInitialized=!requireAllKeys||keys.every(function(key){var value=indices[key];return Array.isArray(value)?value.length>0:value>=0});var indexChanged=keys.length!==Object.keys(cachedIndices).length||keys.some(function(key){var cachedValue=cachedIndices[key];var value=indices[key];return Array.isArray(value)?cachedValue.join(",")!==value.join(","):cachedValue!==value});cachedIndices=indices;if(allInitialized&&indexChanged){callback(indices)}}}},1958:function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=getUpdatedOffsetForIndex;function getUpdatedOffsetForIndex(_ref){var _ref$align=_ref.align;var align=_ref$align===undefined?"auto":_ref$align;var cellOffset=_ref.cellOffset;var cellSize=_ref.cellSize;var containerSize=_ref.containerSize;var currentOffset=_ref.currentOffset;var maxOffset=cellOffset;var minOffset=maxOffset-containerSize+cellSize;switch(align){case"start":return maxOffset;case"end":return minOffset;case"center":return maxOffset-(containerSize+cellSize)/2;default:return Math.max(minOffset,Math.min(maxOffset,currentOffset))}}},1959:function(module,exports){function select(element){var selectedText;if(element.nodeName==="INPUT"||element.nodeName==="TEXTAREA"){element.focus();element.setSelectionRange(0,element.value.length);selectedText=element.value}else{if(element.hasAttribute("contenteditable")){element.focus()}var selection=window.getSelection();var range=document.createRange();range.selectNodeContents(element);selection.removeAllRanges();selection.addRange(range);selectedText=selection.toString()}return selectedText}module.exports=select},1960:function(module,exports){function E(){}E.prototype={on:function(name,callback,ctx){var e=this.e||(this.e={});(e[name]||(e[name]=[])).push({fn:callback,ctx:ctx});return this},once:function(name,callback,ctx){var self=this;function listener(){self.off(name,listener);callback.apply(ctx,arguments)}listener._=callback;return this.on(name,listener,ctx)},emit:function(name){var data=[].slice.call(arguments,1);var evtArr=((this.e||(this.e={}))[name]||[]).slice();var i=0;var len=evtArr.length;for(i;i<len;i++){evtArr[i].fn.apply(evtArr[i].ctx,data)}return this},off:function(name,callback){var e=this.e||(this.e={});var evts=e[name];var liveEvents=[];if(evts&&callback){for(var i=0,len=evts.length;i<len;i++){if(evts[i].fn!==callback&&evts[i].fn._!==callback)liveEvents.push(evts[i])}}liveEvents.length?e[name]=liveEvents:delete e[name];return this}};module.exports=E},1964:function(module,exports,__webpack_require__){"use strict";var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var React=__webpack_require__(1),classNames=__webpack_require__(10),omit=__webpack_require__(18);var Toggle=__webpack_require__(1745);module.exports=React.createClass({displayName:"CompactFormToggle",render:function render(){return React.createElement(Toggle,(0,_extends3.default)({},omit(this.props,"className"),{className:classNames(this.props.className,"is-compact")}),this.props.children)}})},1966:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);var _omit2=__webpack_require__(18);var _omit3=_interopRequireDefault(_omit2);var _reactDom=__webpack_require__(44);var _reactDom2=_interopRequireDefault(_reactDom);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _debug=__webpack_require__(3);var _debug2=_interopRequireDefault(_debug);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var debug=(0,_debug2.default)("calypso:resizable-iframe"),noop=function noop(){};exports.default=_react2.default.createClass({displayName:"ResizableIframe",propTypes:{src:_react2.default.PropTypes.string,width:_react2.default.PropTypes.oneOfType([_react2.default.PropTypes.string,_react2.default.PropTypes.number]),height:_react2.default.PropTypes.oneOfType([_react2.default.PropTypes.string,_react2.default.PropTypes.number]),onLoad:_react2.default.PropTypes.func,onResize:_react2.default.PropTypes.func},getInitialState:function getInitialState(){return{width:0,height:0}},getDefaultProps:function getDefaultProps(){return{onLoad:noop,onResize:noop}},componentWillMount:function componentWillMount(){debug("Mounting "+this.constructor.displayName+" React component.")},componentDidMount:function componentDidMount(){window.addEventListener("message",this.checkMessageForResize,false);this.maybeConnect()},componentDidUpdate:function componentDidUpdate(){this.maybeConnect()},componentWillUnmount:function componentWillUnmount(){window.removeEventListener("message",this.checkMessageForResize)},getFrameBody:function getFrameBody(){return _reactDom2.default.findDOMNode(this.refs.iframe).contentDocument.body},maybeConnect:function maybeConnect(){if(!this.isFrameAccessible()){return}var body=this.getFrameBody();if(null!==body.getAttribute("data-resizable-iframe-connected")){return}var script=document.createElement("script");script.innerHTML="\n\t\t\t( function() {\n\t\t\t\tvar observer;\n\n\t\t\t\tif ( ! window.MutationObserver || ! document.body || ! window.top ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tfunction sendResize() {\n\t\t\t\t\twindow.top.postMessage( {\n\t\t\t\t\t\taction: 'resize',\n\t\t\t\t\t\twidth: document.body.offsetWidth,\n\t\t\t\t\t\theight: document.body.offsetHeight\n\t\t\t\t\t}, '*' );\n\t\t\t\t}\n\n\t\t\t\tobserver = new MutationObserver( sendResize );\n\t\t\t\tobserver.observe( document.body, {\n\t\t\t\t\tattributes: true,\n\t\t\t\t\tattributeOldValue: false,\n\t\t\t\t\tcharacterData: true,\n\t\t\t\t\tcharacterDataOldValue: false,\n\t\t\t\t\tchildList: true,\n\t\t\t\t\tsubtree: true\n\t\t\t\t} );\n\n\t\t\t\twindow.addEventListener( 'load', sendResize, true );\n\n\t\t\t\t// Hack: Remove viewport unit styles, as these are relative\n\t\t\t\t// the iframe root and interfere with our mechanism for\n\t\t\t\t// determining the unconstrained page bounds.\n\t\t\t\tfunction removeViewportStyles( ruleOrNode ) {\n\t\t\t\t\t[ 'width', 'height', 'minHeight', 'maxHeight' ].forEach( function( style ) {\n\t\t\t\t\t\tif ( /^\\d+(vmin|vmax|vh|vw)$/.test( ruleOrNode.style[ style ] ) ) {\n\t\t\t\t\t\t\truleOrNode.style[ style ] = '';\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\t\t\t\t}\n\n\t\t\t\tArray.prototype.forEach.call( document.querySelectorAll( '[style]' ), removeViewportStyles );\n\t\t\t\tArray.prototype.forEach.call( document.styleSheets, function( stylesheet ) {\n\t\t\t\t\tArray.prototype.forEach.call( stylesheet.cssRules || stylesheet.rules, removeViewportStyles );\n\t\t\t\t} );\n\n\t\t\t\tdocument.body.style.position = 'absolute';\n\t\t\t\tdocument.body.setAttribute( 'data-resizable-iframe-connected', '' );\n\n\t\t\t\tsendResize();\n\t\t\t} )();\n\t\t";body.appendChild(script)},isFrameAccessible:function isFrameAccessible(){try{return!!this.getFrameBody()}catch(e){return false}},checkMessageForResize:function checkMessageForResize(event){var iframe=_reactDom2.default.findDOMNode(this.refs.iframe);var data=event.data||{};if("string"===typeof data){try{data=JSON.parse(data)}catch(e){}}if(!iframe||iframe.contentWindow!==event.source){return}debug("Received message: %o",data);var _data=data;var action=_data.action;var width=_data.width;var height=_data.height;var _state=this.state;var oldWidth=_state.width;var oldHeight=_state.height;if("resize"===action&&(oldWidth!==width||oldHeight!==height)){this.setState({width:width,height:height});this.props.onResize()}},onLoad:function onLoad(event){this.maybeConnect();this.props.onLoad(event)},render:function render(){var omitProps=["onResize"];return _react2.default.createElement("iframe",(0,_extends3.default)({ref:"iframe"},(0,_omit3.default)(this.props,omitProps),{onLoad:this.onLoad,width:this.props.width||this.state.width,height:this.props.height||this.state.height}))}});module.exports=exports["default"]},1969:function(module,exports,__webpack_require__){"use strict";var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);var _assign=__webpack_require__(5);var _assign2=_interopRequireDefault(_assign);var _freeze=__webpack_require__(276);var _freeze2=_interopRequireDefault(_freeze);var _typeof2=__webpack_require__(32);var _typeof3=_interopRequireDefault(_typeof2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var take=__webpack_require__(1947),clone=__webpack_require__(212),map=__webpack_require__(45),difference=__webpack_require__(118),React=__webpack_require__(1),PureRenderMixin=__webpack_require__(111),each=__webpack_require__(779),identity=__webpack_require__(99),classNames=__webpack_require__(10),debug=__webpack_require__(3)("calypso:token-field"),some=__webpack_require__(63),forEach=__webpack_require__(114);var SuggestionsList=__webpack_require__(2058),Token=__webpack_require__(2060),TokenInput=__webpack_require__(2059);var TokenField=React.createClass({displayName:"TokenField",propTypes:{suggestions:React.PropTypes.array,maxSuggestions:React.PropTypes.number,displayTransform:React.PropTypes.func,saveTransform:React.PropTypes.func,onChange:React.PropTypes.func,isBorderless:React.PropTypes.bool,maxLength:React.PropTypes.number,onFocus:React.PropTypes.func,disabled:React.PropTypes.bool,tokenizeOnSpace:React.PropTypes.bool,value:function value(props){var value=props.value;if(!Array.isArray(value)){return new Error("Value prop is expected to be an array.")}forEach(value,function(item){if("object"===(typeof item==="undefined"?"undefined":(0,_typeof3.default)(item))){if(!("value"in item)){return new Error("When using object for value prop, each object is expected to have a 'value' property.")}}})}},getDefaultProps:function getDefaultProps(){return{suggestions:(0,_freeze2.default)([]),maxSuggestions:100,value:(0,_freeze2.default)([]),displayTransform:identity,saveTransform:function saveTransform(token){return token.trim()},onChange:function onChange(){},isBorderless:false,disabled:false,tokenizeOnSpace:false}},mixins:[PureRenderMixin],getInitialState:function getInitialState(){return{incompleteTokenValue:"",inputOffsetFromEnd:0,isActive:false,selectedSuggestionIndex:-1,selectedSuggestionScroll:false}},componentDidUpdate:function componentDidUpdate(){if(this.state.isActive&&!this.refs.input.hasFocus()){debug("componentDidUpdate focusing input");this.refs.input.focus()}},componentWillReceiveProps:function componentWillReceiveProps(nextProps){if(nextProps.disabled&&this.state.isActive){this.setState({isActive:false,incompleteTokenValue:""})}},render:function render(){var classes=classNames("token-field",{"is-active":this.state.isActive,"is-disabled":this.props.disabled});var tokenFieldProps={ref:"main",className:classes,tabIndex:"-1"};if(!this.props.disabled){tokenFieldProps=(0,_assign2.default)({},tokenFieldProps,{onKeyDown:this._onKeyDown,onKeyPress:this._onKeyPress,onFocus:this._onFocus})}return React.createElement("div",tokenFieldProps,React.createElement("div",{ref:"tokensAndInput",className:"token-field__input-container",tabIndex:"-1",onMouseDown:this._onContainerTouched,onTouchStart:this._onContainerTouched},this._renderTokensAndInput()),React.createElement(SuggestionsList,{match:this.props.saveTransform(this.state.incompleteTokenValue),displayTransform:this.props.displayTransform,suggestions:this._getMatchingSuggestions(),selectedIndex:this.state.selectedSuggestionIndex,scrollIntoView:this.state.selectedSuggestionScroll,isExpanded:this.state.isActive,onHover:this._onSuggestionHovered,onSelect:this._onSuggestionSelected}))},_renderTokensAndInput:function _renderTokensAndInput(){var components=map(this.props.value,this._renderToken);components.splice(this._getIndexOfInput(),0,this._renderInput());return components},_renderToken:function _renderToken(token){var value=this._getTokenValue(token);var status=token.status?token.status:undefined;return React.createElement(Token,{key:"token-"+value,value:value,status:status,tooltip:token.tooltip,displayTransform:this.props.displayTransform,onClickRemove:this._onTokenClickRemove,isBorderless:token.isBorderless||this.props.isBorderless,onMouseEnter:token.onMouseEnter,onMouseLeave:token.onMouseLeave,disabled:"error"!==status&&this.props.disabled})},_renderInput:function _renderInput(){var _props=this.props;var autoCapitalize=_props.autoCapitalize;var autoComplete=_props.autoComplete;var maxLength=_props.maxLength;var value=_props.value;var props={autoCapitalize:autoCapitalize,autoComplete:autoComplete,ref:"input",key:"input",disabled:this.props.disabled,value:this.state.incompleteTokenValue,onBlur:this._onBlur};if(!(maxLength&&value.length>=maxLength)){props=(0,_extends3.default)({},props,{onChange:this._onInputChange})}return React.createElement(TokenInput,props)},_onFocus:function _onFocus(event){this.setState({isActive:true});if("function"===typeof this.props.onFocus){this.props.onFocus(event)}},_onBlur:function _onBlur(event){if(this._inputHasValidValue()){debug("_onBlur adding current token");this.setState({isActive:false},this._addCurrentToken)}else{debug("_onBlur not adding current token");this.setState(this.getInitialState())}},_onTokenClickRemove:function _onTokenClickRemove(event){this._deleteToken(event.value)},_onSuggestionHovered:function _onSuggestionHovered(suggestion){var index=this._getMatchingSuggestions().indexOf(suggestion);if(index>=0){this.setState({selectedSuggestionIndex:index,selectedSuggestionScroll:false})}},_onSuggestionSelected:function _onSuggestionSelected(suggestion){debug("_onSuggestionSelected",suggestion);this._addNewToken(suggestion)},_onInputChange:function _onInputChange(event){this.setState({incompleteTokenValue:event.value,selectedSuggestionIndex:-1,selectedSuggestionScroll:false})},_onContainerTouched:function _onContainerTouched(event){if(event.target===this.refs.tokensAndInput&&this.state.isActive){event.preventDefault()}},_onKeyDown:function _onKeyDown(event){var preventDefault=false;switch(event.keyCode){case 8:preventDefault=this._handleDeleteKey(this._deleteTokenBeforeInput);break;case 9:preventDefault=this._addCurrentToken();break;case 13:preventDefault=this._addCurrentToken();break;case 37:preventDefault=this._handleLeftArrowKey();break;case 38:preventDefault=this._handleUpArrowKey();break;case 39:preventDefault=this._handleRightArrowKey();break;case 40:preventDefault=this._handleDownArrowKey();break;case 46:preventDefault=this._handleDeleteKey(this._deleteTokenAfterInput);break;case 32:if(this.props.tokenizeOnSpace){preventDefault=this._addCurrentToken()}break;default:break}if(preventDefault){event.preventDefault()}},_onKeyPress:function _onKeyPress(event){var preventDefault=false;switch(event.charCode){case 44:preventDefault=this._handleCommaKey();break;default:break}if(preventDefault){event.preventDefault()}},_handleDeleteKey:function _handleDeleteKey(deleteToken){var preventDefault=false;if(this.refs.input.hasFocus()&&this._isInputEmpty()){deleteToken();preventDefault=true}return preventDefault},_getMatchingSuggestions:function _getMatchingSuggestions(){var suggestions=this.props.suggestions,match=this.props.saveTransform(this.state.incompleteTokenValue),startsWithMatch=[],containsMatch=[];if(match.length===0){suggestions=difference(suggestions,this.props.value)}else{match=match.toLocaleLowerCase();each(suggestions,function(suggestion){var index=suggestion.toLocaleLowerCase().indexOf(match);if(this.props.value.indexOf(suggestion)===-1){if(index===0){startsWithMatch.push(suggestion)}else if(index>0){containsMatch.push(suggestion)}}}.bind(this));suggestions=startsWithMatch.concat(containsMatch)}return take(suggestions,this.props.maxSuggestions)},_getSelectedSuggestion:function _getSelectedSuggestion(){if(this.state.selectedSuggestionIndex!==-1){return this._getMatchingSuggestions()[this.state.selectedSuggestionIndex]}},_addCurrentToken:function _addCurrentToken(){var preventDefault=false,selectedSuggestion=this._getSelectedSuggestion();if(selectedSuggestion){this._addNewToken(selectedSuggestion);preventDefault=true}else if(this._inputHasValidValue()){this._addNewToken(this.state.incompleteTokenValue);preventDefault=true}return preventDefault},_handleLeftArrowKey:function _handleLeftArrowKey(){var preventDefault=false;if(this._isInputEmpty()){this._moveInputBeforePreviousToken();preventDefault=true}return preventDefault},_handleRightArrowKey:function _handleRightArrowKey(){var preventDefault=false;if(this._isInputEmpty()){this._moveInputAfterNextToken();preventDefault=true}return preventDefault},_handleUpArrowKey:function _handleUpArrowKey(){this.setState({selectedSuggestionIndex:Math.max((this.state.selectedSuggestionIndex||0)-1,0),selectedSuggestionScroll:true});return true},_handleDownArrowKey:function _handleDownArrowKey(){this.setState({selectedSuggestionIndex:Math.min(this.state.selectedSuggestionIndex+1||0,this._getMatchingSuggestions().length-1),selectedSuggestionScroll:true});return true},_handleCommaKey:function _handleCommaKey(){var preventDefault=true;if(this._inputHasValidValue()){this._addNewToken(this.state.incompleteTokenValue)}return preventDefault},_isInputEmpty:function _isInputEmpty(){return this.state.incompleteTokenValue.length===0},_inputHasValidValue:function _inputHasValidValue(){return this.props.saveTransform(this.state.incompleteTokenValue).length>0},_deleteTokenBeforeInput:function _deleteTokenBeforeInput(){var index=this._getIndexOfInput()-1;if(index>-1){this._deleteToken(this.props.value[index])}},_deleteTokenAfterInput:function _deleteTokenAfterInput(){var index=this._getIndexOfInput();if(index<this.props.value.length){this._deleteToken(this.props.value[index]);this._moveInputToIndex(index)}},_deleteToken:function _deleteToken(token){var _this=this;var newTokens=this.props.value.filter(function(item){return _this._getTokenValue(item)!==_this._getTokenValue(token)});this.props.onChange(newTokens)},_moveInputToIndex:function _moveInputToIndex(index){this.setState({inputOffsetFromEnd:this.props.value.length-Math.max(index,-1)-1})},_moveInputBeforePreviousToken:function _moveInputBeforePreviousToken(){this.setState({inputOffsetFromEnd:Math.min(this.state.inputOffsetFromEnd+1,this.props.value.length)})},_moveInputAfterNextToken:function _moveInputAfterNextToken(){this.setState({inputOffsetFromEnd:Math.max(this.state.inputOffsetFromEnd-1,0)})},_addNewToken:function _addNewToken(token){var newValue;token=this.props.saveTransform(token);if(!this._valueContainsToken(token)){newValue=clone(this.props.value);newValue.splice(this._getIndexOfInput(),0,token);this.props.onChange(newValue)}this.setState({incompleteTokenValue:"",selectedSuggestionIndex:-1,selectedSuggestionScroll:false});if(this.state.isActive){debug("_addNewToken focusing input");this.refs.input.focus()}},_valueContainsToken:function _valueContainsToken(token){var _this2=this;return some(this.props.value,function(item){return _this2._getTokenValue(token)===_this2._getTokenValue(item)})},_getTokenValue:function _getTokenValue(token){if("object"===(typeof token==="undefined"?"undefined":(0,_typeof3.default)(token))){return token.value}return token},_getIndexOfInput:function _getIndexOfInput(){return this.props.value.length-this.state.inputOffsetFromEnd}});module.exports=TokenField},1976:function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Formats=exports.Formats={DOM:"DOM",STRING:"STRING",SHORTCODE:"SHORTCODE",OBJECT:"OBJECT",API:"API",UNKNOWN:"UNKNOWN"};var MediaTypes=exports.MediaTypes={IMAGE:"IMAGE",VIDEO:"VIDEO",AUDIO:"AUDIO",UNKNOWN:"UNKNOWN"}},1979:function(module,exports,__webpack_require__){"use strict";var _keys=__webpack_require__(39);var _keys2=_interopRequireDefault(_keys);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var Emitter=__webpack_require__(36);function PopupMonitor(){this.intervals={};this.monitorInterval=null}Emitter(PopupMonitor.prototype);PopupMonitor.prototype.open=function(url,name,specs){var windowInstance;name=name||Date.now();windowInstance=window.open(url,name,specs);this.startMonitoring(name,windowInstance);return this};PopupMonitor.prototype.getScreenCenterSpecs=function(width,height){var screenTop=typeof window.screenTop!=="undefined"?window.screenTop:window.screenY,screenLeft=typeof window.screenLeft!=="undefined"?window.screenLeft:window.screenX;return["width="+width,"height="+height,"top="+(screenTop+window.innerHeight/2-height/2),"left="+(screenLeft+window.innerWidth/2-width/2)].join()};PopupMonitor.prototype.isOpen=function(name){var isClosed=false;try{isClosed=this.intervals[name]&&this.intervals[name].closed}catch(e){}return!isClosed};PopupMonitor.prototype.checkStatus=function(){for(var name in this.intervals){if(this.intervals.hasOwnProperty(name)&&!this.isOpen(name)){this.emit("close",name);delete this.intervals[name]}}if(0===(0,_keys2.default)(this.intervals).length){clearInterval(this.monitorInterval);delete this.monitorInterval}};PopupMonitor.prototype.startMonitoring=function(name,windowInstance){if(!this.monitorInterval){this.monitorInterval=setInterval(this.checkStatus.bind(this),100)}this.intervals[name]=windowInstance};module.exports=PopupMonitor},1986:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);var _keys=__webpack_require__(39);var _keys2=_interopRequireDefault(_keys);var _galleryHelp=__webpack_require__(2155);var _galleryHelp2=_interopRequireDefault(_galleryHelp);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var React=__webpack_require__(1),classNames=__webpack_require__(10),noop=__webpack_require__(38),assign=__webpack_require__(34),omit=__webpack_require__(18),isEqual=__webpack_require__(98);var Spinner=__webpack_require__(282),Gridicon=__webpack_require__(26),Button=__webpack_require__(69),ListItemImage=__webpack_require__(2102),ListItemVideo=__webpack_require__(2103),ListItemAudio=__webpack_require__(2100),ListItemDocument=__webpack_require__(2101),MediaUtils=__webpack_require__(1647);exports.default=React.createClass({displayName:"MediaLibraryListItem",propTypes:{media:React.PropTypes.object,scale:React.PropTypes.number.isRequired,maxImageWidth:React.PropTypes.number,photon:React.PropTypes.bool,showGalleryHelp:React.PropTypes.bool,selectedIndex:React.PropTypes.number,onToggle:React.PropTypes.func,onEditItem:React.PropTypes.func,style:React.PropTypes.object},getDefaultProps:function getDefaultProps(){return{maxImageWidth:450,photon:true,selectedIndex:-1,onToggle:noop,onEditItem:noop}},shouldComponentUpdate:function shouldComponentUpdate(nextProps){return!(nextProps.media===this.props.media&&nextProps.scale===this.props.scale&&nextProps.maxImageWidth===this.props.maxImageWidth&&nextProps.photon===this.props.photon&&nextProps.selectedIndex===this.props.selectedIndex&&isEqual(nextProps.style,this.props.style))},clickItem:function clickItem(event){this.props.onToggle(this.props.media,event.shiftKey)},editItem:function editItem(event){this.props.onEditItem(this.props.media);event.stopPropagation()},renderItem:function renderItem(){var component;if(!this.props.media){return}switch(MediaUtils.getMimePrefix(this.props.media)){case"image":component=ListItemImage;break;case"video":component=ListItemVideo;break;case"audio":component=ListItemAudio;break;default:component=ListItemDocument;break}return React.createElement(component,this.props)},renderSpinner:function renderSpinner(){if(!this.props.media||!this.props.media.transient){return}return React.createElement(Spinner,{className:"media-library__list-item-spinner"})},render:function render(){var classes,props,style,title;classes=classNames("media-library__list-item",{"is-placeholder":!this.props.media,"is-selected":-1!==this.props.selectedIndex,"is-transient":this.props.media&&this.props.media.transient,"is-small":this.props.scale<=.125});props=omit(this.props,(0,_keys2.default)(this.constructor.propTypes));style=assign({width:this.props.scale*100+"%"},this.props.style);if(this.props.media){title=this.props.media.file}if(-1!==this.props.selectedIndex){props["data-selected-number"]=this.props.selectedIndex+1}return React.createElement("div",(0,_extends3.default)({className:classes,style:style,onClick:this.clickItem},props),React.createElement("span",{className:"media-library__list-item-selected-icon"},React.createElement(Gridicon,{icon:"checkmark",size:20})),React.createElement("figure",{className:"media-library__list-item-figure",title:title
},this.renderItem(),this.renderSpinner(),this.props.showGalleryHelp&&React.createElement(_galleryHelp2.default,null),React.createElement(Button,{type:"button",className:"media-library__list-item-edit",onClick:this.editItem},React.createElement("span",{className:"screen-reader-text"},this.translate("Edit",{context:"verb"})),React.createElement(Gridicon,{icon:"pencil"}))))}});module.exports=exports["default"]},1991:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1),PureRenderMixin=__webpack_require__(111);var Gridicon=__webpack_require__(26);module.exports=React.createClass({displayName:"PostRelativeTime",mixins:[PureRenderMixin],propTypes:{post:React.PropTypes.object.isRequired,includeNonDraftStatuses:React.PropTypes.bool,link:React.PropTypes.string,target:React.PropTypes.string},getDefaultProps:function getDefaultProps(){return{includeNonDraftStatuses:false,link:null,target:null}},getRelativeTimeText:function getRelativeTimeText(){var status=this.props.post.status;var time=void 0;if(status==="draft"||status==="pending"){time=this.props.post.modified}else if(status!=="new"){time=this.props.post.date}if(!time){return}return React.createElement("span",{className:"post-relative-time-status__time"},React.createElement(Gridicon,{icon:"time",size:18}),React.createElement("span",{className:"post-relative-time-status__time-text"},this.moment(time).fromNow()))},getStatusText:function getStatusText(){var status=this.props.post.status,statusClassName="post-relative-time-status__status",statusIcon="aside",statusText;if(this.props.post.sticky){statusText=this.translate("sticky");statusClassName+=" is-sticky";statusIcon="bookmark-outline"}else if(status==="pending"){statusText=this.translate("pending review");statusClassName+=" is-pending"}else if(status==="future"){statusText=this.translate("scheduled");statusClassName+=" is-scheduled";statusIcon="calendar"}else if(status==="trash"){statusText=this.translate("trashed");statusClassName+=" is-trash";statusIcon="trash"}else if(this.props.includeBasicStatus){if(status==="draft"){statusText=this.translate("draft")}else if(status==="publish"){statusText=this.translate("published")}else if(status==="new"){statusText=this.translate("Publish immediately")}}if(statusText){return React.createElement("span",{className:statusClassName},React.createElement(Gridicon,{icon:statusIcon,size:18}),React.createElement("span",{className:"post-relative-time-status__status-text"},statusText))}},render:function render(){var timeText=this.getRelativeTimeText(),statusText=this.getStatusText(),realtiveTimeClass=timeText?"post-relative-time-status":null,innerText=React.createElement("span",null,timeText,statusText),details;if(this.props.link){details=React.createElement("p",{className:realtiveTimeClass},React.createElement("a",{href:this.props.link,target:this.props.target,onClick:this.props.onClick},innerText))}else{details=React.createElement("p",{className:realtiveTimeClass},innerText)}return details}})},1992:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);var _reduce2=__webpack_require__(117);var _reduce3=_interopRequireDefault(_reduce2);var _range2=__webpack_require__(735);var _range3=_interopRequireDefault(_range2);var _memoize2=__webpack_require__(405);var _memoize3=_interopRequireDefault(_memoize2);var _map2=__webpack_require__(45);var _map3=_interopRequireDefault(_map2);var _filter2=__webpack_require__(77);var _filter3=_interopRequireDefault(_filter2);var _isEqual2=__webpack_require__(98);var _isEqual3=_interopRequireDefault(_isEqual2);var _includes2=__webpack_require__(30);var _includes3=_interopRequireDefault(_includes2);var _difference2=__webpack_require__(118);var _difference3=_interopRequireDefault(_difference2);var _debounce2=__webpack_require__(278);var _debounce3=_interopRequireDefault(_debounce2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactRedux=__webpack_require__(15);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _i18nCalypso=__webpack_require__(11);var _VirtualScroll=__webpack_require__(1871);var _VirtualScroll2=_interopRequireDefault(_VirtualScroll);var _analytics=__webpack_require__(20);var _analytics2=_interopRequireDefault(_analytics);var _noResults=__webpack_require__(2134);var _noResults2=_interopRequireDefault(_noResults);var _search=__webpack_require__(2135);var _search2=_interopRequireDefault(_search);var _formatting=__webpack_require__(81);var _queryTerms=__webpack_require__(1835);var _queryTerms2=_interopRequireDefault(_queryTerms);var _selectors=__webpack_require__(47);var _selectors2=__webpack_require__(1742);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var SEARCH_DEBOUNCE_TIME_MS=500;var DEFAULT_TERMS_PER_PAGE=100;var LOAD_OFFSET=10;var ITEM_HEIGHT=25;var TermTreeSelectorList=_react2.default.createClass({displayName:"TermTreeSelectorList",propTypes:{terms:_react.PropTypes.array,taxonomy:_react.PropTypes.string,multiple:_react.PropTypes.bool,selected:_react.PropTypes.array,search:_react.PropTypes.string,siteId:_react.PropTypes.number,translate:_react.PropTypes.func,defaultTermId:_react.PropTypes.number,lastPage:_react.PropTypes.number,onSearch:_react.PropTypes.func,onChange:_react.PropTypes.func},getInitialState:function getInitialState(){return{searchTerm:"",requestedPages:[1]}},getDefaultProps:function getDefaultProps(){return{analyticsPrefix:"Category Selector",searchThreshold:8,loading:true,terms:[],onSearch:function onSearch(){},onChange:function onChange(){},onNextPage:function onNextPage(){}}},componentWillMount:function componentWillMount(){var _this=this;this.itemHeights={};this.hasPerformedSearch=false;this.virtualScroll=null;this.termIds=(0,_map3.default)(this.props.terms,"ID");this.getTermChildren=(0,_memoize3.default)(this.getTermChildren);this.queueRecomputeRowHeights=(0,_debounce3.default)(this.recomputeRowHeights);this.debouncedSearch=(0,_debounce3.default)(function(){_this.props.onSearch(_this.state.searchTerm)},SEARCH_DEBOUNCE_TIME_MS)},componentWillReceiveProps:function componentWillReceiveProps(nextProps){if(nextProps.taxonomy!==this.props.taxonomy){this.setState(this.getInitialState())}if(this.props.terms!==nextProps.terms){this.getTermChildren.cache.clear();this.termIds=(0,_map3.default)(nextProps.terms,"ID")}},componentDidUpdate:function componentDidUpdate(prevProps){var forceUpdate=!(0,_isEqual3.default)(prevProps.selected,this.props.selected)||prevProps.loading&&!this.props.loading||!prevProps.terms&&this.props.terms;if(forceUpdate){this.virtualScroll.forceUpdate()}if(this.props.terms!==prevProps.terms){this.recomputeRowHeights()}},recomputeRowHeights:function recomputeRowHeights(){if(!this.virtualScroll){return}this.virtualScroll.recomputeRowHeights();this.virtualScroll.forceUpdate();if(this.isCompact()){this.forceUpdate()}},setSelectorRef:function setSelectorRef(selectorRef){if(!selectorRef){return}this.setState({selectorRef:selectorRef})},getPageForIndex:function getPageForIndex(index){var _props=this.props;var query=_props.query;var lastPage=_props.lastPage;var perPage=query.number||DEFAULT_TERMS_PER_PAGE;var page=Math.ceil(index/perPage);return Math.max(Math.min(page,lastPage||Infinity),1)},setRequestedPages:function setRequestedPages(_ref){var startIndex=_ref.startIndex;var stopIndex=_ref.stopIndex;var requestedPages=this.state.requestedPages;var pagesToRequest=(0,_difference3.default)((0,_range3.default)(this.getPageForIndex(startIndex-LOAD_OFFSET),this.getPageForIndex(stopIndex+LOAD_OFFSET)+1),requestedPages);if(!pagesToRequest.length){return}this.setState({requestedPages:requestedPages.concat(pagesToRequest)})},setItemRef:function setItemRef(item,itemRef){if(!itemRef||!item){return}var height=this.itemHeights[item.ID]||ITEM_HEIGHT;var nextHeight=itemRef.clientHeight;this.itemHeights[item.ID]=nextHeight;if(height!==nextHeight){this.queueRecomputeRowHeights()}},hasNoSearchResults:function hasNoSearchResults(){return!this.props.loading&&this.props.terms&&!this.props.terms.length&&!!this.state.searchTerm.length},hasNoTerms:function hasNoTerms(){return!this.props.loading&&this.props.terms&&!this.props.terms.length},getItem:function getItem(index){if(this.props.terms){return this.props.terms[index]}},isCompact:function isCompact(){if(!this.props.terms||this.state.searchTerm){return false}return this.props.terms.length<this.props.searchThreshold},isRowLoaded:function isRowLoaded(_ref2){var index=_ref2.index;return this.props.lastPage||!!this.getItem(index)},getTermChildren:function getTermChildren(termId){var terms=this.props.terms;return(0,_filter3.default)(terms,function(_ref3){var parent=_ref3.parent;return parent===termId})},getItemHeight:function getItemHeight(item){var _this2=this;var _recurse=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(!item){return ITEM_HEIGHT}if(item.parent&&!_recurse&&(0,_includes3.default)(this.termIds,item.parent)){return 0}if(this.itemHeights[item.ID]){return this.itemHeights[item.ID]}return(0,_reduce3.default)(this.getTermChildren(item.ID),function(memo,childItem){return memo+_this2.getItemHeight(childItem,true)},ITEM_HEIGHT)},getRowHeight:function getRowHeight(_ref4){var index=_ref4.index;return this.getItemHeight(this.getItem(index))},getCompactContainerHeight:function getCompactContainerHeight(){var _this3=this;return(0,_range3.default)(0,this.getRowCount()).reduce(function(memo,index){return memo+_this3.getRowHeight({index:index})},0)},getResultsWidth:function getResultsWidth(){var selectorRef=this.state.selectorRef;if(selectorRef){return selectorRef.clientWidth}return 0},getRowCount:function getRowCount(){var count=0;if(this.props.terms){count+=this.props.terms.length}if(this.props.loading||!this.props.terms){count+=1}return count},onSearch:function onSearch(event){var searchTerm=event.target.value;if(this.state.searchTerm&&!searchTerm){this.props.onSearch("")}if(searchTerm===this.state.searchTerm){return}if(!this.hasPerformedSearch){this.hasPerformedSearch=true;_analytics2.default.ga.recordEvent(this.props.analyticsPrefix,"Performed Term Search")}this.setState({searchTerm:searchTerm});this.debouncedSearch()},setVirtualScrollRef:function setVirtualScrollRef(ref){this.virtualScroll=ref},renderItem:function renderItem(item){var _this4=this;var _recurse=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(item.parent&&!_recurse&&(0,_includes3.default)(this.termIds,item.parent)){return}var onChange=function onChange(){var _props2;for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}return(_props2=_this4.props).onChange.apply(_props2,[item].concat(args))};var setItemRef=function setItemRef(){for(var _len2=arguments.length,args=Array(_len2),_key2=0;_key2<_len2;_key2++){args[_key2]=arguments[_key2]}return _this4.setItemRef.apply(_this4,[item].concat(args))};var children=this.getTermChildren(item.ID);var _props3=this.props;var multiple=_props3.multiple;var defaultTermId=_props3.defaultTermId;var translate=_props3.translate;var selected=_props3.selected;var itemId=item.ID;var name=(0,_formatting.decodeEntities)(item.name)||translate("Untitled");var checked=(0,_includes3.default)(selected,itemId);var inputType=multiple?"checkbox":"radio";var disabled=multiple&&checked&&defaultTermId&&1===selected.length&&defaultTermId===itemId;var input=_react2.default.createElement("input",{type:inputType,value:itemId,onChange:onChange,disabled:disabled,checked:checked});return _react2.default.createElement("div",{key:itemId,ref:setItemRef,className:"term-tree-selector__list-item"},_react2.default.createElement("label",null,input,_react2.default.createElement("span",{className:"term-tree-selector__label"},name)),children.length>0&&_react2.default.createElement("div",{className:"term-tree-selector__nested-list"},children.map(function(child){return _this4.renderItem(child,true)})))},renderNoResults:function renderNoResults(){if(this.hasNoSearchResults()||this.hasNoTerms()){return _react2.default.createElement("div",{key:"no-results",className:"term-tree-selector__list-item is-empty"},(this.hasNoSearchResults()||!this.props.emptyMessage)&&_react2.default.createElement(_noResults2.default,{createLink:this.props.createLink}),this.hasNoTerms()&&this.props.emptyMessage)}},renderRow:function renderRow(_ref5){var index=_ref5.index;var item=this.getItem(index);if(item){return this.renderItem(item)}return _react2.default.createElement("div",{key:"placeholder",className:"term-tree-selector__list-item is-placeholder"},_react2.default.createElement("label",null,_react2.default.createElement("input",{type:this.props.multiple?"checkbox":"radio",disabled:true,className:"term-tree-selector__input"}),_react2.default.createElement("span",{className:"term-tree-selector__label"},this.props.translate("Loading"))))},render:function render(){var rowCount=this.getRowCount();var isCompact=this.isCompact();var searchLength=this.state.searchTerm.length;var showSearch=(searchLength>0||!isCompact)&&(this.props.terms||!this.props.terms&&searchLength>0);var _props4=this.props;var className=_props4.className;var loading=_props4.loading;var siteId=_props4.siteId;var taxonomy=_props4.taxonomy;var query=_props4.query;var classes=(0,_classnames2.default)("term-tree-selector",className,{"is-loading":loading,"is-compact":isCompact});return _react2.default.createElement("div",{ref:this.setSelectorRef,className:classes},this.state.requestedPages.map(function(page){return _react2.default.createElement(_queryTerms2.default,{key:"query-"+page,siteId:siteId,taxonomy:taxonomy,query:(0,_extends3.default)({},query,{page:page})})}),showSearch&&_react2.default.createElement(_search2.default,{searchTerm:this.state.searchTerm,onSearch:this.onSearch}),_react2.default.createElement(_VirtualScroll2.default,{ref:this.setVirtualScrollRef,width:this.getResultsWidth(),height:isCompact?this.getCompactContainerHeight():300,onRowsRendered:this.setRequestedPages,rowCount:rowCount,estimatedRowSize:ITEM_HEIGHT,rowHeight:this.getRowHeight,rowRenderer:this.renderRow,noRowsRenderer:this.renderNoResults,className:"term-tree-selector__results"}))}});exports.default=(0,_reactRedux.connect)(function(state,ownProps){var siteId=(0,_selectors.getSelectedSiteId)(state);var taxonomy=ownProps.taxonomy;var query=ownProps.query;return{loading:(0,_selectors2.isRequestingTermsForQueryIgnoringPage)(state,siteId,taxonomy,query),terms:(0,_selectors2.getTermsForQueryIgnoringPage)(state,siteId,taxonomy,query),lastPage:(0,_selectors2.getTermsLastPageForQuery)(state,siteId,taxonomy,query),siteId:siteId,query:query}})((0,_i18nCalypso.localize)(TermTreeSelectorList));module.exports=exports["default"]},2010:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.isRequestingPostTypeTaxonomies=isRequestingPostTypeTaxonomies;exports.getPostTypeTaxonomies=getPostTypeTaxonomies;exports.getPostTypeTaxonomy=getPostTypeTaxonomy;var _find=__webpack_require__(27);var _find2=_interopRequireDefault(_find);var _get=__webpack_require__(24);var _get2=_interopRequireDefault(_get);var _values=__webpack_require__(210);var _values2=_interopRequireDefault(_values);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function isRequestingPostTypeTaxonomies(state,siteId,postType){return(0,_get2.default)(state.postTypes.taxonomies.requesting,[siteId,postType],false)}function getPostTypeTaxonomies(state,siteId,postType){var taxonomies=(0,_get2.default)(state.postTypes.taxonomies.items,[siteId,postType]);if(!taxonomies){return null}return(0,_values2.default)(taxonomies)}function getPostTypeTaxonomy(state,siteId,postType,taxonomyName){var taxonomies=getPostTypeTaxonomies(state,siteId,postType);if(!taxonomies){return null}return(0,_find2.default)(taxonomies,{name:taxonomyName})||null}},2024:function(module,exports,__webpack_require__){(function(module){(function(module){"use strict";module.exports.is_uri=is_iri;module.exports.is_http_uri=is_http_iri;module.exports.is_https_uri=is_https_iri;module.exports.is_web_uri=is_web_iri;module.exports.isUri=is_iri;module.exports.isHttpUri=is_http_iri;module.exports.isHttpsUri=is_https_iri;module.exports.isWebUri=is_web_iri;var splitUri=function(uri){var splitted=uri.match(/(?:([^:\/?#]+):)?(?:\/\/([^\/?#]*))?([^?#]*)(?:\?([^#]*))?(?:#(.*))?/);return splitted};function is_iri(value){if(!value){return}if(/[^a-z0-9\:\/\?\#\[\]\@\!\$\&\'\(\)\*\+\,\;\=\.\-\_\~\%]/i.test(value))return;if(/%[^0-9a-f]/i.test(value))return;if(/%[0-9a-f](:?[^0-9a-f]|$)/i.test(value))return;var splitted=[];var scheme="";var authority="";var path="";var query="";var fragment="";var out="";splitted=splitUri(value);scheme=splitted[1];authority=splitted[2];path=splitted[3];query=splitted[4];fragment=splitted[5];if(!(scheme&&scheme.length&&path.length>=0))return;if(authority&&authority.length){if(!(path.length===0||/^\//.test(path)))return}else{if(/^\/\//.test(path))return}if(!/^[a-z][a-z0-9\+\-\.]*$/.test(scheme.toLowerCase()))return;out+=scheme+":";if(authority&&authority.length){out+="//"+authority}out+=path;if(query&&query.length){out+="?"+query}if(fragment&&fragment.length){out+="#"+fragment}return out}function is_http_iri(value,allowHttps){if(!is_iri(value)){return}var splitted=[];var scheme="";var authority="";var path="";var port="";var query="";var fragment="";var out="";splitted=splitUri(value);scheme=splitted[1];authority=splitted[2];path=splitted[3];query=splitted[4];fragment=splitted[5];if(!scheme)return;if(allowHttps){if(scheme.toLowerCase()!="https")return}else{if(scheme.toLowerCase()!="http")return}if(!authority){return}if(/:(\d+)$/.test(authority)){port=authority.match(/:(\d+)$/)[0];authority=authority.replace(/:\d+$/,"")}out+=scheme+":";out+="//"+authority;if(port){out+=port}out+=path;if(query&&query.length){out+="?"+query}if(fragment&&fragment.length){out+="#"+fragment}return out}function is_https_iri(value){return is_http_iri(value,true)}function is_web_iri(value){return is_http_iri(value)||is_https_iri(value)}})(module)}).call(exports,__webpack_require__(104)(module))},2029:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1),assign=__webpack_require__(34),isEqual=__webpack_require__(98);var MediaActions=__webpack_require__(1662),MediaListStore=__webpack_require__(1899),passToChildren=__webpack_require__(1718),utils=__webpack_require__(2030);function getStateData(siteId){return{media:MediaListStore.getAll(siteId),mediaHasNextPage:MediaListStore.hasNextPage(siteId),mediaFetchingNextPage:MediaListStore.isFetchingNextPage(siteId)}}module.exports=React.createClass({displayName:"MediaListData",propTypes:{siteId:React.PropTypes.number.isRequired,filter:React.PropTypes.string,search:React.PropTypes.string},getInitialState:function getInitialState(){return getStateData(this.props.siteId)},componentWillMount:function componentWillMount(){MediaActions.setQuery(this.props.siteId,this.getQuery());MediaListStore.on("change",this.updateStateData);this.updateStateData()},componentWillUnmount:function componentWillUnmount(){MediaListStore.off("change",this.updateStateData)},componentWillReceiveProps:function componentWillReceiveProps(nextProps){var nextQuery=this.getQuery(nextProps);if(this.props.siteId!==nextProps.siteId||!isEqual(nextQuery,this.getQuery())){MediaActions.setQuery(nextProps.siteId,nextQuery);this.setState(getStateData(nextProps.siteId))}},getQuery:function getQuery(props){var query={};props=props||this.props;if(props.search){query.search=props.search}if(props.filter){query.mime_type=utils.getMimeBaseTypeFromFilter(props.filter)}return query},fetchData:function fetchData(){MediaActions.fetchNextPage(this.props.siteId)},updateStateData:function updateStateData(){this.setState(getStateData(this.props.siteId))},render:function render(){return passToChildren(this,assign({},this.state,{mediaOnFetchNextPage:this.fetchData}))}})},2030:function(module,exports){"use strict";module.exports={getMimeBaseTypeFromFilter:function getMimeBaseTypeFromFilter(filter){var mime;switch(filter){case"images":mime="image/";break;case"audio":mime="audio/";break;case"videos":mime="video/";break;case"documents":mime="application/";break;default:mime="";break}return mime}}},2031:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1);var MediaValidationStore=__webpack_require__(1785),passToChildren=__webpack_require__(1718);function getStateData(siteId){return{mediaValidationErrors:MediaValidationStore.getAllErrors(siteId)}}module.exports=React.createClass({displayName:"MediaValidationData",propTypes:{siteId:React.PropTypes.number.isRequired},getInitialState:function getInitialState(){return getStateData(this.props.siteId)},componentDidMount:function componentDidMount(){MediaValidationStore.on("change",this.updateState)},componentWillUnmount:function componentWillUnmount(){MediaValidationStore.off("change",this.updateState)},componentWillReceiveProps:function componentWillReceiveProps(nextProps){if(this.props.siteId!==nextProps.siteId){this.setState(getStateData(nextProps.siteId))}},updateState:function updateState(){this.setState(getStateData(this.props.siteId))},render:function render(){return passToChildren(this,this.state)}})},2032:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1);var PreferencesActions=__webpack_require__(754),PreferencesStore=__webpack_require__(747),passToChildren=__webpack_require__(1718);function getStateData(){return{preferences:PreferencesStore.getAll()}}module.exports=React.createClass({displayName:"PreferencesData",getInitialState:function getInitialState(){return getStateData()},componentDidMount:function componentDidMount(){PreferencesStore.on("change",this.updateState);if(undefined===this.state.preferences){PreferencesActions.fetch()}},componentWillUnmount:function componentWillUnmount(){PreferencesStore.off("change",this.updateState)},updateState:function updateState(){this.setState(getStateData())},render:function render(){return passToChildren(this,this.state)}})},2035:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _react=__webpack_require__(1);var _reactRedux=__webpack_require__(15);var _redux=__webpack_require__(6);var _selectors=__webpack_require__(1861);var _actions=__webpack_require__(1860);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var QueryPublicizeConnections=function(_Component){(0,_inherits3.default)(QueryPublicizeConnections,_Component);function QueryPublicizeConnections(){(0,_classCallCheck3.default)(this,QueryPublicizeConnections);return(0,_possibleConstructorReturn3.default)(this,(QueryPublicizeConnections.__proto__||(0,_getPrototypeOf2.default)(QueryPublicizeConnections)).apply(this,arguments))}(0,_createClass3.default)(QueryPublicizeConnections,[{key:"componentWillMount",value:function componentWillMount(){if(!this.props.requestingConnections&&this.props.siteId){this.props.requestConnections(this.props.siteId)}}},{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){if(nextProps.requestingConnections||!nextProps.siteId||this.props.siteId===nextProps.siteId){return}nextProps.requestConnections(nextProps.siteId)}},{key:"render",value:function render(){return null}}]);return QueryPublicizeConnections}(_react.Component);QueryPublicizeConnections.propTypes={siteId:_react.PropTypes.number,requestingConnections:_react.PropTypes.bool,requestConnections:_react.PropTypes.func};QueryPublicizeConnections.defaultProps={requestConnections:function requestConnections(){}};exports.default=(0,_reactRedux.connect)(function(state,ownProps){return{requestingConnections:(0,_selectors.isFetchingConnections)(state,ownProps.siteId)}},function(dispatch){return(0,_redux.bindActionCreators)({requestConnections:_actions.fetchConnections},dispatch)})(QueryPublicizeConnections);module.exports=exports["default"]},2048:function(module,exports,__webpack_require__){"use strict";var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var React=__webpack_require__(1),omit=__webpack_require__(18),classnames=__webpack_require__(10);module.exports=React.createClass({displayName:"FormRange",propTypes:{onChange:React.PropTypes.func},getDefaultProps:function getDefaultProps(){return{onChange:function onChange(){}}},componentDidMount:function componentDidMount(){if(this.shouldNormalizeChange()){this.refs.range.addEventListener("change",this.onChange)}},componentWillUnmount:function componentWillUnmount(){this.refs.range.removeEventListener("change",this.onChange)},shouldNormalizeChange:function shouldNormalizeChange(){var ua=window.navigator.userAgent;return-1!==ua.indexOf("MSIE")||-1!==ua.indexOf("Trident/")},onChange:function onChange(event){this.props.onChange(event)},render:function render(){var classes=classnames(this.props.className,"form-range");return React.createElement("input",(0,_extends3.default)({ref:"range",type:"range",className:classes},omit(this.props,"className")))}})},2050:function(module,exports,__webpack_require__){"use strict";var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var React=__webpack_require__(1),omit=__webpack_require__(18),classnames=__webpack_require__(10),uniqueId=__webpack_require__(399);var FormRange=__webpack_require__(2048);module.exports=React.createClass({displayName:"Range",propTypes:{minContent:React.PropTypes.oneOfType([React.PropTypes.element,React.PropTypes.string]),maxContent:React.PropTypes.oneOfType([React.PropTypes.element,React.PropTypes.string]),min:React.PropTypes.oneOfType([React.PropTypes.string,React.PropTypes.number]),max:React.PropTypes.oneOfType([React.PropTypes.string,React.PropTypes.number]),value:React.PropTypes.oneOfType([React.PropTypes.string,React.PropTypes.number]),showValueLabel:React.PropTypes.bool},getInitialState:function getInitialState(){return{id:uniqueId("range")}},getDefaultProps:function getDefaultProps(){return{min:0,max:10,value:0,showValueLabel:false}},getMinContentElement:function getMinContentElement(){if(this.props.minContent){return React.createElement("span",{className:"range__content is-min"},this.props.minContent)}},getMaxContentElement:function getMaxContentElement(){if(this.props.maxContent){return React.createElement("span",{className:"range__content is-max"},this.props.maxContent)}},getValueLabelElement:function getValueLabelElement(){var left,offset;if(this.props.showValueLabel){left=100*(this.props.value-this.props.min)/(this.props.max-this.props.min);offset=Math.floor(13*((50-left)/50));return React.createElement("span",{className:"range__label",style:{left:(left||0)+"%",marginLeft:offset}},React.createElement("output",{className:"range__label-inner",htmlFor:this.state.id,value:this.props.value},this.props.value))}},render:function render(){var classes=classnames(this.props.className,"range",{"has-min-content":!!this.props.minContent,"has-max-content":!!this.props.maxContent});return React.createElement("div",{className:classes},this.getMinContentElement(),React.createElement(FormRange,(0,_extends3.default)({id:this.state.id,className:"range__input"},omit(this.props,"minContent","maxContent","showValueLabel","className"))),this.getMaxContentElement(),this.getValueLabelElement())}})},2051:function(module,exports,__webpack_require__){"use strict";var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);var _keys=__webpack_require__(39);var _keys2=_interopRequireDefault(_keys);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var React=__webpack_require__(1),fromPairs=__webpack_require__(402),findIndex=__webpack_require__(214),assign=__webpack_require__(34),debug=__webpack_require__(3)("calypso:forms:sortable-list"),classNames=__webpack_require__(10);var touchDetect=__webpack_require__(216);module.exports=React.createClass({displayName:"SortableList",propTypes:{direction:React.PropTypes.oneOf(["horizontal","vertical"]),allowDrag:React.PropTypes.bool,onChange:React.PropTypes.func},getInitialState:function getInitialState(){return{activeIndex:null,activeOrder:null,position:null}},getDefaultProps:function getDefaultProps(){return{direction:"horizontal",allowDrag:true,onChange:function onChange(){}}},componentWillMount:function componentWillMount(){debug("Mounting "+this.constructor.displayName+" React component.")},componentDidMount:function componentDidMount(){document.addEventListener("mousemove",this.onMouseMove)},componentWillUnmount:function componentWillUnmount(){document.removeEventListener("mousemove",this.onMouseMove)},getPositionForCursorElement:function getPositionForCursorElement(element,event){return{top:event.clientY-element.clientHeight/2,left:event.clientX-element.clientWidth/2}},compareCursorVerticalToElement:function compareCursorVerticalToElement(element,event){var rect=element.getBoundingClientRect();if(event.clientY<rect.top){return-1}else if(event.clientY>rect.bottom){return 1}else{return 0}},isCursorBeyondElementThreshold:function isCursorBeyondElementThreshold(element,direction,permittedVertical,event){var rect=element.getBoundingClientRect();switch(direction){case"top":return event.clientY<=rect.top+rect.height/2;case"right":return event.clientX>=rect.left+rect.width/2&&("top"===permittedVertical||event.clientY>=rect.top)&&("bottom"===permittedVertical||event.clientY<=rect.bottom);case"bottom":return event.clientY>=rect.top+rect.height/2;case"left":return event.clientX<=rect.left+rect.width/2&&("top"===permittedVertical||event.clientY>=rect.top)&&("bottom"===permittedVertical||event.clientY<=rect.bottom);default:return false}},getAdjustedElementIndex:function getAdjustedElementIndex(index){if(this.state.activeOrder){return this.state.activeOrder[index]}else{return index}},getCursorElementIndex:function getCursorElementIndex(event){var cursorCompare=this.compareCursorVerticalToElement(this.refs.list,event),adjustedActiveIndex=this.getAdjustedElementIndex(this.state.activeIndex),shadowRect=this.refs["wrap-shadow-"+this.state.activeIndex].getBoundingClientRect(),index;index=findIndex(this.props.children,function(child,i){var isBeyond,adjustedElementIndex,permittedVertical;if(i===this.state.activeIndex){return false}adjustedElementIndex=this.getAdjustedElementIndex(i);if("horizontal"===this.props.direction){if(1===cursorCompare&&this.refs["wrap-"+i].getBoundingClientRect().top>=shadowRect.top){permittedVertical="bottom"}else if(-1===cursorCompare&&this.refs["wrap-"+i].getBoundingClientRect().bottom<=shadowRect.bottom){permittedVertical="top"}}if(adjustedElementIndex<adjustedActiveIndex){isBeyond=this.isCursorBeyondElementThreshold(this.refs["wrap-"+i],"horizontal"===this.props.direction?"left":"top",permittedVertical,event)}else if(adjustedElementIndex>adjustedActiveIndex){isBeyond=isBeyond||this.isCursorBeyondElementThreshold(this.refs["wrap-"+i],"horizontal"===this.props.direction?"right":"bottom",permittedVertical,event)}return isBeyond}.bind(this));
return this.getAdjustedElementIndex(index)},moveItem:function moveItem(direction){var increment="previous"===direction?-1:1,activeOrder=(0,_keys2.default)(this.props.children).map(Number);activeOrder[this.state.activeIndex+increment]=this.state.activeIndex;activeOrder[this.state.activeIndex]=this.state.activeIndex+increment;this.props.onChange(activeOrder);this.setState({activeIndex:activeOrder[this.state.activeIndex]})},onMouseDown:function onMouseDown(index,event){this.setState({activeIndex:index,position:this.getPositionForCursorElement(event.currentTarget.firstChild,event)})},onMouseMove:function onMouseMove(event){var activeOrder,newIndex;if(null===this.state.activeIndex||!this.props.allowDrag||touchDetect.hasTouch()){return}activeOrder=this.state.activeOrder;newIndex=this.getCursorElementIndex(event);if(newIndex>=0){if(this.state.activeIndex===newIndex){activeOrder=null}else{activeOrder=(0,_keys2.default)(this.props.children).map(Number);for(var i=0,il=activeOrder.length;i<il;i++){if(i>=newIndex&&i<this.state.activeIndex){activeOrder[i]=i+1}else if(i<=newIndex&&i>this.state.activeIndex){activeOrder[i]=i-1}}activeOrder[this.state.activeIndex]=newIndex}}this.setState({position:this.getPositionForCursorElement(this.refs["wrap-"+this.state.activeIndex].firstChild,event),activeOrder:activeOrder})},onMouseUp:function onMouseUp(){if(this.state.activeOrder){this.props.onChange(this.state.activeOrder)}this.setState({activeIndex:null,activeOrder:null,position:null})},onClick:function onClick(index){this.setState({activeIndex:index})},getOrderedListItemElements:function getOrderedListItemElements(){return React.Children.map(this.props.children,function(child,index){var isActive=this.state.activeIndex===index,isDraggable=this.props.allowDrag&&!touchDetect.hasTouch(),events=isDraggable?["onMouseDown","onMouseUp"]:["onClick"],style={order:this.getAdjustedElementIndex(index)},classes=classNames({"sortable-list__item":true,"is-active":isActive,"is-draggable":isDraggable}),item;events=fromPairs(events.map(function(event){return[event,this[event].bind(null,index)]},this));if(isActive){assign(style,this.state.position)}item=React.createElement("li",(0,_extends3.default)({ref:"wrap-"+index,key:"wrap-"+index},events,{className:classes,style:style}),child);if(isActive&&isDraggable){return[React.createElement("li",{ref:"wrap-shadow-"+index,key:"wrap-shadow-"+index,className:"sortable-list__item is-shadow",style:style},child),item]}else{return item}},this)},getNavigationElement:function getNavigationElement(){if(this.props.allowDrag&&!touchDetect.hasTouch()){return}return React.createElement("div",{className:"sortable-list__navigation"},React.createElement("button",{type:"button",onClick:this.moveItem.bind(null,"previous"),className:"sortable-list__navigation-button is-previous",disabled:null===this.state.activeIndex||this.state.activeIndex===0},React.createElement("span",{className:"screen-reader-text"},this.translate("Move previous")),React.createElement("span",{className:"noticon noticon-expand"})),React.createElement("button",{type:"button",onClick:this.moveItem.bind(null,"next"),className:"sortable-list__navigation-button is-next",disabled:null===this.state.activeIndex||this.state.activeIndex===this.props.children.length-1},React.createElement("span",{className:"screen-reader-text"},this.translate("Move next")),React.createElement("span",{className:"noticon noticon-collapse"})))},render:function render(){var classes=classNames({"sortable-list":true,"is-horizontal":"horizontal"===this.props.direction,"is-vertical":"vertical"===this.props.direction});return React.createElement("div",{className:classes},React.createElement("ol",{ref:"list",className:"sortable-list__list"},this.getOrderedListItemElements()),this.getNavigationElement())}})},2055:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _i18nCalypso=__webpack_require__(11);var _i18nCalypso2=_interopRequireDefault(_i18nCalypso);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={isValidGMTOffset:function isValidGMTOffset(gmtOffset){return"number"===typeof gmtOffset},getLocalizedDate:function getLocalizedDate(date,tz,gmt){date=_i18nCalypso2.default.moment(date);if(tz){date.tz(tz)}else if(this.isValidGMTOffset(gmt)){date.utcOffset(gmt)}return date},convertDateToUserLocation:function convertDateToUserLocation(date,tz,gmt){if(!(tz||this.isValidGMTOffset(gmt))){return _i18nCalypso2.default.moment(date)}return this.getDateInLocalUTC(date).subtract(this.getTimeOffset(date,tz,gmt),"minute")},convertDateToGivenOffset:function convertDateToGivenOffset(date,tz,gmt){date=this.getLocalizedDate(date,tz,gmt).add(this.getTimeOffset(date,tz,gmt),"minute");if(!tz&&this.isValidGMTOffset(gmt)){date.utcOffset(gmt)}return date},getTimeOffset:function getTimeOffset(date,tz,gmt){var userLocalDate=this.getDateInLocalUTC(date),localizedDate=this.getLocalizedDate(date,tz,gmt);return userLocalDate.utcOffset()-localizedDate.utcOffset()},getDateInLocalUTC:function getDateInLocalUTC(date){return _i18nCalypso2.default.moment(date.format?date.format():date)}};module.exports=exports["default"]},2058:function(module,exports,__webpack_require__){"use strict";var _freeze=__webpack_require__(276);var _freeze2=_interopRequireDefault(_freeze);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var map=__webpack_require__(45),React=__webpack_require__(1),PureRenderMixin=__webpack_require__(111),classNames=__webpack_require__(10),scrollIntoView=__webpack_require__(2190);var SuggestionsList=React.createClass({displayName:"SuggestionsList",propTypes:{isExpanded:React.PropTypes.bool,match:React.PropTypes.string,displayTransform:React.PropTypes.func.isRequired,onSelect:React.PropTypes.func,suggestions:React.PropTypes.array,selectedIndex:React.PropTypes.number},getDefaultProps:function getDefaultProps(){return{isExpanded:false,match:"",onHover:function onHover(){},onSelect:function onSelect(){},suggestions:(0,_freeze2.default)([])}},mixins:[PureRenderMixin],componentDidUpdate:function componentDidUpdate(prevProps){var node;if(prevProps.isExpanded&&this.props.isExpanded&&this.props.selectedIndex>-1&&this.props.scrollIntoView){this._scrollingIntoView=true;node=this.refs.list;scrollIntoView(node.children[this.props.selectedIndex],node,{onlyScrollIfNeeded:true});setTimeout(function(){this._scrollingIntoView=false}.bind(this),100)}},_computeSuggestionMatch:function _computeSuggestionMatch(suggestion){var match=this.props.displayTransform(this.props.match||"").toLocaleLowerCase(),indexOfMatch;if(match.length===0){return null}suggestion=this.props.displayTransform(suggestion);indexOfMatch=suggestion.toLocaleLowerCase().indexOf(match);return{suggestionBeforeMatch:suggestion.substring(0,indexOfMatch),suggestionMatch:suggestion.substring(indexOfMatch,indexOfMatch+match.length),suggestionAfterMatch:suggestion.substring(indexOfMatch+match.length)}},render:function render(){var classes=classNames("token-field__suggestions-list",{"is-expanded":this.props.isExpanded&&this.props.suggestions.length>0});return React.createElement("ul",{ref:"list",className:classes,tabIndex:"-1"},this._renderSuggestions())},_renderSuggestions:function _renderSuggestions(){return map(this.props.suggestions,function(suggestion,index){var match=this._computeSuggestionMatch(suggestion),classes=classNames("token-field__suggestion",{"is-selected":index===this.props.selectedIndex});return React.createElement("li",{className:classes,key:suggestion,onMouseDown:this._handleMouseDown,onClick:this._handleClick(suggestion),onMouseEnter:this._handleHover(suggestion)},match?React.createElement("span",null,match.suggestionBeforeMatch,React.createElement("strong",{className:"token-field__suggestion-match"},match.suggestionMatch),match.suggestionAfterMatch):this.props.displayTransform(suggestion))}.bind(this))},_handleHover:function _handleHover(suggestion){return function(){if(!this._scrollingIntoView){this.props.onHover(suggestion)}}.bind(this)},_handleClick:function _handleClick(suggestion){return function(){this.props.onSelect(suggestion)}.bind(this)},_handleMouseDown:function _handleMouseDown(e){e.preventDefault()}});module.exports=SuggestionsList},2059:function(module,exports,__webpack_require__){"use strict";var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var React=__webpack_require__(1),PureRenderMixin=__webpack_require__(111);var TokenInput=React.createClass({displayName:"TokenInput",propTypes:{onChange:React.PropTypes.func,onBlur:React.PropTypes.func,value:React.PropTypes.string,disabled:React.PropTypes.bool},getDefaultProps:function getDefaultProps(){return{onChange:function onChange(){},onBlur:function onBlur(){},value:"",disabled:false}},mixins:[PureRenderMixin],render:function render(){var props=(0,_extends3.default)({},this.props,{onChange:this._onChange});return React.createElement("input",(0,_extends3.default)({ref:"input",type:"text"},props,{size:this.props.value.length+1,className:"token-field__input"}))},focus:function focus(){if(this.isMounted()){this.refs.input.focus()}},hasFocus:function hasFocus(){return this.isMounted()&&this.refs.input===document.activeElement},_onChange:function _onChange(event){this.props.onChange({value:event.target.value})}});module.exports=TokenInput},2060:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _mixin=__webpack_require__(111);var _mixin2=_interopRequireDefault(_mixin);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _tooltip=__webpack_require__(722);var _tooltip2=_interopRequireDefault(_tooltip);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"Token",propTypes:{value:_react2.default.PropTypes.string.isRequired,displayTransform:_react2.default.PropTypes.func.isRequired,onClickRemove:_react2.default.PropTypes.func,status:_react2.default.PropTypes.oneOf(["error","success","validating"]),isBorderless:_react2.default.PropTypes.bool,tooltip:_react2.default.PropTypes.string,disabled:_react2.default.PropTypes.bool},getDefaultProps:function getDefaultProps(){return{onClickRemove:function onClickRemove(){},isBorderless:false,disabled:false}},mixins:[_mixin2.default],render:function render(){var _props=this.props;var value=_props.value;var status=_props.status;var isBorderless=_props.isBorderless;var tooltip=_props.tooltip;var displayTransform=_props.displayTransform;var tokenClasses=(0,_classnames2.default)("token-field__token",{"is-error":"error"===status,"is-success":"success"===status,"is-validating":"validating"===status,"is-borderless":isBorderless,"is-disabled":this.props.disabled});return _react2.default.createElement("span",{className:tokenClasses,tabIndex:"-1",onMouseEnter:this.props.onMouseEnter,onMouseLeave:this.props.onMouseLeave},_react2.default.createElement("span",{className:"token-field__token-text"},displayTransform(value)),_react2.default.createElement("span",{className:"token-field__remove-token noticon noticon-close-alt",onClick:!this.props.disabled&&this._onClickRemove}),tooltip&&_react2.default.createElement(_tooltip2.default,{showOnMobile:true,context:this,status:status,isVisible:true,position:"bottom"},tooltip))},_onClickRemove:function _onClickRemove(){this.props.onClickRemove({value:this.props.value})}});module.exports=exports["default"]},2065:function(module,exports,__webpack_require__){"use strict";var debug=__webpack_require__(3)("calypso:connections-list"),without=__webpack_require__(172),find=__webpack_require__(27),map=__webpack_require__(45),filter=__webpack_require__(77),findIndex=__webpack_require__(214),reject=__webpack_require__(209);var wpcom=__webpack_require__(28),Emitter=__webpack_require__(36),PopupMonitor=__webpack_require__(1979);function ConnectionsList(){if(!(this instanceof ConnectionsList)){return new ConnectionsList}this.initialized=false;this.keyringData=[];this.siteData=[]}Emitter(ConnectionsList.prototype);ConnectionsList.prototype.get=function(siteId,options){var connections;options=options||{};if(!this.initialized||options.force){this.fetchkeyringConnections()}if(siteId&&(this.siteId!==siteId||options.force)){this.fetchSiteConnections(siteId)}if(siteId){connections=filter(this.siteData,{site_ID:siteId})}else{connections=this.keyringData}if(options.keyringConnectionId){connections=filter(connections,{keyring_connection_ID:options.keyringConnectionId})}if(options.userId){connections=filter(connections,function(connection){return connection.shared||connection.keyring_connection_user_ID===options.userId})}return connections};ConnectionsList.prototype.addSiteData=function(connections,index){connections=Array.isArray(connections)?connections:[connections];connections=connections.map(this.normalizeConnection,this);if(index>=0){this.siteData.splice.apply(this.siteData,[index,0].concat(connections))}else{this.siteData=this.siteData.concat(connections)}connections.forEach(function(connection){var keyringConnection=find(this.keyringData,{keyring_connection_ID:connection.keyring_connection_ID});if(keyringConnection&&-1===keyringConnection.sites.indexOf(connection.site_ID)){keyringConnection.sites.push(connection.site_ID)}},this);this.emit("change")};ConnectionsList.prototype.addKeyringData=function(connections,index){connections=Array.isArray(connections)?connections:[connections];connections=connections.map(this.normalizeConnection,this);if(index>=0){this.keyringData.splice.apply(this.keyringData,[index,0].concat(connections))}else{this.keyringData=this.keyringData.concat(connections)}this.emit("change")};ConnectionsList.prototype.add=function(connections,siteId){if(siteId){this.addSiteData(connections)}else{this.addKeyringData(connections)}};ConnectionsList.prototype.create=function(service,siteId,keyringConnectionId,externalUserId){var keyringConnections,onConnectionUpdated;if(!this.initialized){this.once("change",this.create.bind(this,service,siteId,keyringConnectionId,externalUserId));return}if(keyringConnectionId){keyringConnections=this.get(siteId,{keyringConnectionId:keyringConnectionId});onConnectionUpdated=function(error,connection){var connections;if(error||!connection){debug("error creating ConnectionsList connection",error);this.emit("create:error");return}if(connection.connections){connections=connections.connection}else{connections=[connection]}if(siteId&&keyringConnections.length){this.siteData=reject(this.siteData,{ID:keyringConnections[0].ID})}this.add(connections,siteId);this.emit("create:success")}.bind(this);if(siteId&&keyringConnections.length){wpcom.undocumented().updateConnection(siteId,keyringConnections[0].ID,{external_user_ID:externalUserId||false},onConnectionUpdated)}else{wpcom.undocumented().createConnection(keyringConnectionId,siteId,externalUserId,{shared:false},onConnectionUpdated)}}else{this.connect(service.connect_URL)}};ConnectionsList.prototype.refresh=function(connection){var keyringConnection=find(this.keyringData,{keyring_connection_ID:connection.keyring_connection_ID});if(keyringConnection){this.isRefreshing=true;this.connect(keyringConnection.refresh_URL,connection.site_ID,function(){var isOkay=!!find(this.keyringData,{keyring_connection_ID:keyringConnection.keyring_connection_ID,status:"ok"});this.isRefreshing=false;this.emit("refresh:"+(isOkay?"success":"error"))}.bind(this))}};ConnectionsList.prototype.connect=function(url,siteId,fn){if(!this.popupMonitor){this.popupMonitor=new PopupMonitor}this.popupMonitor.open(url,null,"toolbar=0,location=0,status=0,menubar=0,"+this.popupMonitor.getScreenCenterSpecs(780,500));this.popupMonitor.once("close",function(){this.get(siteId,{force:true});this.once("change",function(){this.emit("connect");if(fn){fn()}}.bind(this))}.bind(this))};ConnectionsList.prototype.removeSiteData=function(connections){var connectionsRemoved=[],connectionIdsToRemove;connections=Array.isArray(connections)?connections:[connections];connectionIdsToRemove=connections.map(function(connection){return connection.ID});this.siteData=this.siteData.filter(function(connection){var isToBeRemoved=-1!==connectionIdsToRemove.indexOf(connection.ID),keyringConnectionIndex;if(isToBeRemoved){keyringConnectionIndex=findIndex(this.keyringData,{keyring_connection_ID:connection.keyring_connection_ID});if(-1!==keyringConnectionIndex&&1===this.keyringData[keyringConnectionIndex].sites.length){this.keyringData.splice(keyringConnectionIndex,1)}else{this.keyringData[keyringConnectionIndex].sites=without(this.keyringData[keyringConnectionIndex].sites,connection.site_ID)}connectionsRemoved.push(connection)}return!isToBeRemoved},this);this.emit("change")};ConnectionsList.prototype.removeKeyringData=function(connections){var connectionsRemoved=[],connectionIdsToRemove;connections=Array.isArray(connections)?connections:[connections];connectionIdsToRemove=map(connections,"keyring_connection_ID");this.keyringData=this.keyringData.filter(function(connection){var isToBeRemoved=-1!==connectionIdsToRemove.indexOf(connection.keyring_connection_ID);if(isToBeRemoved){this.siteData=this.siteData.filter(function(siteConnection){return connection.keyring_connection_ID!==siteConnection.keyring_connection_ID});connectionsRemoved.push(connection)}return!isToBeRemoved},this);this.emit("change")};ConnectionsList.prototype.remove=function(connections,siteId){if(siteId){this.removeSiteData(connections)}else{this.removeKeyringData(connections)}};ConnectionsList.prototype.destroy=function(connections){if(!Array.isArray(connections)){connections=[connections]}connections.forEach(function(connection){if("site_ID"in connection){wpcom.undocumented().deleteSiteConnection(connection.site_ID,connection.ID,function(error,removed){if(error&&404===error.statusCode){removed=find(this.siteData,{ID:connection.ID})}if(removed){this.removeSiteData(removed);this.emit("destroy:success")}else{this.emit("destroy:error")}}.bind(this))}else{wpcom.undocumented().deletekeyringConnection(connection.keyring_connection_ID,function(error,removed){if(error&&404===error.statusCode){removed=find(this.keyringData,{keyring_connection_ID:connection.keyring_connection_ID})}if(removed&&removed.ID){removed=this.normalizeConnection(removed)}if(removed){this.removeKeyringData(removed);this.emit("destroy:success")}else{this.emit("destroy:error")}}.bind(this))}},this)};ConnectionsList.prototype.update=function(connection,attributes){wpcom.undocumented().updateConnection(connection.site_ID,connection.ID,attributes,function(error,data){var existingConnectionIndex;if(error){debug("error updating ConnectionsList connection",error);this.emit("update:error");return}existingConnectionIndex=findIndex(this.siteData,{ID:data.ID});this.siteData.splice(existingConnectionIndex,1);this.addSiteData(data,existingConnectionIndex);this.emit("update:success")}.bind(this))};ConnectionsList.prototype.fetchkeyringConnections=function(){if(!this.fetchingKeyring){this.fetchingKeyring=true;wpcom.undocumented().mekeyringConnections(function(error,data){this.fetchingKeyring=false;this.updateInitialized();if(error){debug("error fetching ConnectionsList Keyring connections from api",error);return}this.keyringData=this.parse(data);if(!this.fetchingSite){this.emit("change")}}.bind(this))}};ConnectionsList.prototype.fetchSiteConnections=function(siteId){if(!this.fetchingSite||this.siteId!==siteId){this.fetchingSite=true;this.siteId=siteId;wpcom.undocumented().siteConnections(siteId,function(error,data){this.fetchingSite=false;this.updateInitialized();if(error){debug("error fetching ConnectionsList site publicize connections from api",error);return}this.siteData=this.parse(data);if(!this.fetchingKeyring){this.emit("change")}}.bind(this))}};ConnectionsList.prototype.updateInitialized=function(){if(!this.fetchingSite&&!this.fetchingKeyring){this.initialized=true}};ConnectionsList.prototype.parse=function(data){var list=data.connections||[];return list.map(this.normalizeConnection,this)};ConnectionsList.prototype.normalizeConnection=function(connection){if(connection.read_only){return connection}if(connection.ID&&!connection.keyring_connection_ID){connection.keyring_connection_ID=connection.ID;delete connection.ID;connection.keyring_connection_user_ID=connection.user_ID;delete connection.user_ID}if(!Array.isArray(connection.sites)){connection.sites=[];if(connection.site_ID){connection.sites.push(connection.site_ID)}}return connection};module.exports=ConnectionsList},2093:function(module,exports,__webpack_require__){"use strict";var _gravatar=__webpack_require__(710);var _gravatar2=_interopRequireDefault(_gravatar);var _photon=__webpack_require__(750);var _photon2=_interopRequireDefault(_photon);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var React=__webpack_require__(1),classnames=__webpack_require__(10),noop=__webpack_require__(38),url=__webpack_require__(70);var CompactCard=__webpack_require__(1642),Gridicon=__webpack_require__(26),Notice=__webpack_require__(76),NoticeAction=__webpack_require__(134),SiteIcon=__webpack_require__(281),PostRelativeTimeStatus=__webpack_require__(1991),PopoverMenu=__webpack_require__(1673),PopoverMenuItem=__webpack_require__(1652),actions=__webpack_require__(1648),updatePostStatus=__webpack_require__(1900),utils=__webpack_require__(1649),hasTouch=__webpack_require__(216).hasTouch;module.exports=React.createClass({displayName:"Draft",mixins:[updatePostStatus],propTypes:{showAllActions:React.PropTypes.bool,post:React.PropTypes.object,isPlaceholder:React.PropTypes.bool,sites:React.PropTypes.object,onTitleClick:React.PropTypes.func,postImages:React.PropTypes.object,selected:React.PropTypes.bool,showAuthor:React.PropTypes.bool},getDefaultProps:function getDefaultProps(){return{showAllActions:false,onTitleClick:noop,selected:false,showAuthor:false}},getInitialState:function getInitialState(){return{fullImage:false,showPopoverMenu:false,isRestoring:false,hasError:false}},toggleImageState:function toggleImageState(){this.setState({fullImage:!this.state.fullImage})},trashPost:function trashPost(){var updateStatus;this.setState({showPopoverMenu:false,isTrashing:true});updateStatus=function(error){if(!this.isMounted()){return}if(error){return this.setState({isTrashing:false,hasError:true})}return this.setState({isTrashing:false})}.bind(this);if(utils.userCan("delete_post",this.props.post)){actions.trash(this.props.post,updateStatus)}},restorePost:function restorePost(){var updateStatus;this.setState({showPopoverMenu:false,isRestoring:true});updateStatus=function(error){if(!this.isMounted()){return}if(error){return this.setState({isRestoring:false,hasError:true})}return this.setState({isRestoring:false})}.bind(this);if(utils.userCan("delete_post",this.props.post)){actions.restore(this.props.post,updateStatus)}},previewPost:function previewPost(){window.open(utils.getPreviewURL(this.props.post))},publishPost:function publishPost(){this.setState({showPopoverMenu:false});if(utils.userCan("publish_post",this.props.post)){this.updatePostStatus("publish")}},togglePopoverMenu:function togglePopoverMenu(){this.setState({showPopoverMenu:!this.state.showPopoverMenu})},render:function render(){var post=this.props.post,image=null,site,classes,imageUrl,editPostURL,title,excerpt;if(this.props.isPlaceholder){return this.postPlaceholder()}site=this.props.sites.getSite(post.site_ID);if(utils.userCan("edit_post",post)){editPostURL=utils.getEditURL(post,site)}if(this.props.postImages&&this.props.postImages.canonical_image){image=url.parse(this.props.postImages.canonical_image.uri,true);imageUrl="//"+image.hostname+image.pathname+"?w=680px"}if(post&&post.canonical_image){image=url.parse(post.canonical_image.uri,true);if(image.hostname.indexOf("files.wordpress.com")>0){imageUrl="//"+image.hostname+image.pathname+"?w=680px"}else{imageUrl=(0,_photon2.default)(post.canonical_image.uri,{width:680})}}classes=["draft",{"has-all-actions":this.props.showAllActions,"has-image":!!image,"is-image-expanded":this.state.fullImage,"is-trashed":this.props.post.status==="trash"||this.state.isTrashing,"is-placeholder":this.props.isPlaceholder,"is-restoring":this.state.isRestoring,"is-touch":hasTouch(),"is-selected":this.props.selected}];title=post.title||React.createElement("span",{className:"draft__untitled"},this.translate("Untitled"));excerpt=post.excerpt?React.createElement("span",{className:"draft__excerpt"},React.createElement(Gridicon,{icon:"aside",size:18}),post.excerpt):title;return React.createElement(CompactCard,{className:classnames.apply(null,classes),key:"draft-"+post.ID},this.showStatusChange(),React.createElement("h3",{className:"draft__title"},post.status==="pending"&&React.createElement("span",{className:"draft__pending-label"},this.translate("Pending")),this.props.showAuthor&&React.createElement(_gravatar2.default,{user:post.author,size:22}),React.createElement("a",{href:editPostURL,onClick:this.props.onTitleClick},post.format==="aside"?excerpt:title)),this.props.sites.selected?this.draftActions():React.createElement(SiteIcon,{site:site,size:32}),image?this.renderImage(imageUrl):null,this.props.post.status==="trash"?this.restoreButton():null)},renderImage:function renderImage(image){var style;if(!this.state.fullImage){style={backgroundImage:"url("+image+")"}}return React.createElement("div",{className:"draft__featured-image",style:style,onClick:this.toggleImageState},this.state.fullImage?React.createElement("img",{className:"draft__image",src:image}):null)},restoreButton:function restoreButton(){if(this.state.isRestoring){return null}return React.createElement("button",{className:"draft__restore",onClick:this.restorePost},React.createElement(Gridicon,{icon:"undo",size:18}),this.translate("Restore"))},showStatusChange:function showStatusChange(){if(this.props.post.status==="publish"){return React.createElement(Notice,{isCompact:true,status:"is-success",text:"Post successfully published.",button:"View",showDismiss:false},React.createElement(NoticeAction,{href:this.props.post.URL},"View"))}else if(this.state.hasError){return React.createElement(Notice,{isCompact:true,status:"is-error",text:"There was a problem.",showDismiss:false})}},postPlaceholder:function postPlaceholder(){return React.createElement(CompactCard,{className:"draft is-placeholder"},React.createElement("h3",{className:"draft__title"}),React.createElement("div",{className:"draft__actions"},React.createElement("p",{className:"post-relative-time-status"},React.createElement("span",{className:"time"},React.createElement("span",{className:"noticon noticon-time"}),React.createElement("span",{className:"time-text"})))))},renderTrashAction:function renderTrashAction(){if(!utils.userCan("delete_post",this.props.post)){return null}if(this.props.post.status==="trash"||this.state.isRestoring){return null}return React.createElement("div",{className:"draft__actions"},React.createElement(Gridicon,{icon:"trash",onClick:this.trashPost,size:18}))},renderAllActions:function renderAllActions(){return React.createElement("div",{className:"draft__all-actions"},React.createElement(PostRelativeTimeStatus,{post:this.props.post,includeEditLink:true}),React.createElement("span",{className:"draft__actions-toggle noticon noticon-ellipsis",onClick:this.togglePopoverMenu,ref:"popoverMenuButton"}),React.createElement(PopoverMenu,{isVisible:this.state.showPopoverMenu,onClose:this.togglePopoverMenu,position:"bottom left",context:this.refs&&this.refs.popoverMenuButton},React.createElement(PopoverMenuItem,{onClick:this.previewPost},this.translate("Preview")),React.createElement(PopoverMenuItem,{onClick:this.publishPost},this.translate("Publish")),React.createElement(PopoverMenuItem,{className:"draft__trash-item",onClick:this.trashPost},this.translate("Send to Trash"))))},draftActions:function draftActions(){return this.props.showAllActions?this.renderAllActions():this.renderTrashAction()}})},2095:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _freeze=__webpack_require__(276);var _freeze2=_interopRequireDefault(_freeze);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactRedux=__webpack_require__(15);var _reactAddonsCreateFragment=__webpack_require__(745);var _reactAddonsCreateFragment2=_interopRequireDefault(_reactAddonsCreateFragment);var _noop=__webpack_require__(38);var _noop2=_interopRequireDefault(_noop);var _head=__webpack_require__(1734);var _head2=_interopRequireDefault(_head);var _values=__webpack_require__(210);var _values2=_interopRequireDefault(_values);var _mapValues=__webpack_require__(93);var _mapValues2=_interopRequireDefault(_mapValues);var _groupBy=__webpack_require__(756);var _groupBy2=_interopRequireDefault(_groupBy);var _debounce=__webpack_require__(278);var _debounce2=_interopRequireDefault(_debounce);var _debug=__webpack_require__(3);var _debug2=_interopRequireDefault(_debug);var _analytics=__webpack_require__(20);var _analytics2=_interopRequireDefault(_analytics);var _trackComponentView=__webpack_require__(284);var _trackComponentView2=_interopRequireDefault(_trackComponentView);var _notice=__webpack_require__(76);var _notice2=_interopRequireDefault(_notice);var _noticeAction=__webpack_require__(134);var _noticeAction2=_interopRequireDefault(_noticeAction);var _mediaListData=__webpack_require__(2029);var _mediaListData2=_interopRequireDefault(_mediaListData);var _mediaLibrarySelectedData=__webpack_require__(1878);var _mediaLibrarySelectedData2=_interopRequireDefault(_mediaLibrarySelectedData);var _actions=__webpack_require__(1662);var _actions2=_interopRequireDefault(_actions);var _constants=__webpack_require__(1716);var _actions3=__webpack_require__(754);var _actions4=_interopRequireDefault(_actions3);var _viewport=__webpack_require__(92);var _selectors=__webpack_require__(79);var _header=__webpack_require__(2098);var _header2=_interopRequireDefault(_header);var _list=__webpack_require__(2108);var _list2=_interopRequireDefault(_list);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var debug=(0,_debug2.default)("calypso:media-library:content");var MediaLibraryContent=_react2.default.createClass({displayName:"MediaLibraryContent",propTypes:{site:_react2.default.PropTypes.object,preferences:_react2.default.PropTypes.object,mediaValidationErrors:_react2.default.PropTypes.object,filter:_react2.default.PropTypes.string,filterRequiresUpgrade:_react2.default.PropTypes.bool,search:_react2.default.PropTypes.string,containerWidth:_react2.default.PropTypes.number,single:_react2.default.PropTypes.bool,scrollable:_react2.default.PropTypes.bool,mediaScaleChoices:_react2.default.PropTypes.arrayOf(_react2.default.PropTypes.number),initialMediaScale:_react2.default.PropTypes.number,onAddMedia:_react2.default.PropTypes.func,onMediaScaleChange:_react2.default.PropTypes.func,onEditItem:_react2.default.PropTypes.func},getInitialState:function getInitialState(){return{}},getDefaultProps:function getDefaultProps(){var scaleChoices=[1/12-.006,1/8-.01,1/6-.01,1/4-.01,1/3-.01].map(function(scale){return Math.round(1e3*scale)/1e3});return{preferences:(0,_freeze2.default)({}),mediaValidationErrors:(0,_freeze2.default)({}),onAddMedia:_noop2.default,onMediaScaleChange:_noop2.default,mediaScaleChoices:scaleChoices,initialMediaScale:scaleChoices[2]}},getMediaScale:function getMediaScale(){var scale=this.props.initialMediaScale;if(this.props.preferences&&this.props.preferences.mediaScale){scale=this.props.preferences.mediaScale}if(this.state.mediaScale){scale=this.state.mediaScale}if((0,_viewport.isMobile)()&&1!==scale){scale=_header2.default.SCALE_TOUCH_GRID}return scale},setMediaScalePreference:(0,
_debounce2.default)(function(value){_actions4.default.set("mediaScale",value)},1e3),onMediaScaleChange:function onMediaScaleChange(scale){debug("onMediaScaleChange scale=%f",scale);this.setMediaScalePreference(scale);this.setState({mediaScale:scale});this.props.onMediaScaleChange(scale)},renderErrors:function renderErrors(){var _this=this;var errorTypes,notices;errorTypes=(0,_values2.default)(this.props.mediaValidationErrors).map(_head2.default);notices=(0,_mapValues2.default)((0,_groupBy2.default)(errorTypes),function(occurrences,errorType){var message=void 0,onDismiss=void 0;var i18nOptions={count:occurrences.length,args:occurrences.length};if(_this.props.site){onDismiss=_actions2.default.clearValidationErrorsByType.bind(null,_this.props.site.ID,errorType)}var status="is-error";var upgradeNudgeName=undefined;var upgradeNudgeFeature=undefined;switch(errorType){case _constants.ValidationErrors.FILE_TYPE_NOT_IN_PLAN:status="is-warning";upgradeNudgeName="plan-media-storage-error-video";upgradeNudgeFeature="video-upload";message=_this.translate("%d file could not be uploaded because your site does not support video files. Upgrade to a premium plan for video support.","%d files could not be uploaded because your site does not support video files. Upgrade to a premium plan for video support.",i18nOptions);break;case _constants.ValidationErrors.FILE_TYPE_UNSUPPORTED:message=_this.translate("%d file could not be uploaded because the file type is not supported.","%d files could not be uploaded because their file types are unsupported.",i18nOptions);break;case _constants.ValidationErrors.UPLOAD_VIA_URL_404:message=_this.translate("%d file could not be uploaded because no image exists at the specified URL.","%d files could not be uploaded because no images exist at the specified URLs",i18nOptions);break;case _constants.ValidationErrors.EXCEEDS_MAX_UPLOAD_SIZE:message=_this.translate("%d file could not be uploaded because it exceeds the maximum upload size.","%d files could not be uploaded because they exceed the maximum upload size.",i18nOptions);break;case _constants.ValidationErrors.NOT_ENOUGH_SPACE:upgradeNudgeName="plan-media-storage-error";upgradeNudgeFeature="extra-storage";message=_this.translate("%d file could not be uploaded because there is not enough space left.","%d files could not be uploaded because there is not enough space left.",i18nOptions);break;case _constants.ValidationErrors.EXCEEDS_PLAN_STORAGE_LIMIT:upgradeNudgeName="plan-media-storage-error";upgradeNudgeFeature="extra-storage";message=_this.translate("%d file could not be uploaded because you have reached your plan storage limit.","%d files could not be uploaded because you have reached your plan storage limit.",i18nOptions);break;default:message=_this.translate("%d file could not be uploaded because an error occurred while uploading.","%d files could not be uploaded because errors occurred while uploading.",i18nOptions);break}return _react2.default.createElement(_notice2.default,{status:status,text:message,onDismissClick:onDismiss},_this.renderNoticeAction(upgradeNudgeName,upgradeNudgeFeature))});return(0,_reactAddonsCreateFragment2.default)(notices)},renderNoticeAction:function renderNoticeAction(upgradeNudgeName,upgradeNudgeFeature){if(!upgradeNudgeName){return null}var eventName="calypso_upgrade_nudge_impression";var eventProperties={cta_name:upgradeNudgeName,cta_feature:upgradeNudgeFeature};return _react2.default.createElement(_noticeAction2.default,{external:true,href:upgradeNudgeFeature?"/plans/compare/"+this.props.siteSlug+"?feature="+upgradeNudgeFeature:"/plans/"+this.props.siteSlug,onClick:this.recordPlansNavigation.bind(this,"calypso_upgrade_nudge_cta_click",eventProperties)},this.translate("Upgrade Plan"),_react2.default.createElement(_trackComponentView2.default,{eventName:eventName,eventProperties:eventProperties}))},recordPlansNavigation:function recordPlansNavigation(tracksEvent,tracksData){_analytics2.default.ga.recordEvent("Media","Clicked Upload Error Action");_analytics2.default.tracks.recordEvent(tracksEvent,tracksData)},renderMediaList:function renderMediaList(){if(!this.props.site){return _react2.default.createElement(_list2.default,{key:"list-loading",mediaScale:this.getMediaScale()})}return _react2.default.createElement(_mediaListData2.default,{siteId:this.props.site.ID,filter:this.props.filter,search:this.props.search},_react2.default.createElement(_mediaLibrarySelectedData2.default,{siteId:this.props.site.ID},_react2.default.createElement(_list2.default,{key:"list-"+[this.props.site.ID,this.props.search,this.props.filter].join(),site:this.props.site,filter:this.props.filter,filterRequiresUpgrade:this.props.filterRequiresUpgrade,search:this.props.search,containerWidth:this.props.containerWidth,mediaScale:this.getMediaScale(),photon:!this.props.site.is_private,single:this.props.single,scrollable:this.props.scrollable,onEditItem:this.props.onEditItem})))},render:function render(){return _react2.default.createElement("div",{className:"media-library__content"},!this.props.filterRequiresUpgrade&&_react2.default.createElement(_header2.default,{site:this.props.site,filter:this.props.filter,mediaScale:this.getMediaScale(),mediaScaleChoices:this.props.mediaScaleChoices,onMediaScaleChange:this.onMediaScaleChange,onAddMedia:this.props.onAddMedia,onAddAndEditImage:this.props.onAddAndEditImage}),this.renderErrors(),this.renderMediaList())}});exports.default=(0,_reactRedux.connect)(function(state,ownProps){return{siteSlug:ownProps.site?(0,_selectors.getSiteSlug)(state,ownProps.site.ID):""}},null,null,{pure:false})(MediaLibraryContent);module.exports=exports["default"]},2096:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1),includes=__webpack_require__(30),noop=__webpack_require__(38);var SectionNav=__webpack_require__(1664),SectionNavTabs=__webpack_require__(1661),SectionNavTabItem=__webpack_require__(1660),Search=__webpack_require__(717);module.exports=React.createClass({displayName:"MediaLibraryFilterBar",propTypes:{site:React.PropTypes.object,basePath:React.PropTypes.string,filter:React.PropTypes.string,filterRequiresUpgrade:React.PropTypes.bool,enabledFilters:React.PropTypes.arrayOf(React.PropTypes.string),search:React.PropTypes.string,onFilterChange:React.PropTypes.func,onSearch:React.PropTypes.func},getDefaultProps:function getDefaultProps(){return{filter:"",basePath:"/media",onFilterChange:noop,onSearch:noop}},getSearchPlaceholderText:function getSearchPlaceholderText(){var placeholderText;switch(this.props.filter){case"images":placeholderText=this.translate("Search images",{textOnly:true});break;case"audio":placeholderText=this.translate("Search audio files",{textOnly:true});break;case"videos":placeholderText=this.translate("Search videos",{textOnly:true});break;case"documents":placeholderText=this.translate("Search documents",{textOnly:true});break;default:placeholderText=this.translate("Search all media",{textOnly:true});break}return placeholderText},getFilterLabel:function getFilterLabel(filter){var label;switch(filter){case"images":label=this.translate("Images",{comment:"Filter label for media list",textOnly:true});break;case"audio":label=this.translate("Audio",{comment:"Filter label for media list",textOnly:true});break;case"videos":label=this.translate("Videos",{comment:"Filter label for media list",textOnly:true});break;case"documents":label=this.translate("Documents",{comment:"Filter label for media list",textOnly:true});break;default:label=this.translate("All",{comment:"Filter label for media list",textOnly:true});break}return label},isFilterDisabled:function isFilterDisabled(filter){return this.props.enabledFilters&&(!filter.length||!includes(this.props.enabledFilters,filter))},renderTabItems:function renderTabItems(){var tabs=["","images","documents","videos","audio"];return tabs.map(function(filter){return React.createElement(SectionNavTabItem,{key:"filter-tab-"+filter,selected:this.props.filter===filter,onClick:this.props.onFilterChange.bind(null,filter),disabled:this.isFilterDisabled(filter)},this.getFilterLabel(filter))},this)},render:function render(){return React.createElement(SectionNav,{selectedText:this.getFilterLabel(this.props.filter),hasSearch:true},React.createElement(SectionNavTabs,null,this.renderTabItems()),!this.props.filterRequiresUpgrade&&React.createElement(Search,{analyticsGroup:"Media",pinned:true,fitsContainer:true,onSearch:this.props.onSearch,initialValue:this.props.search,placeholder:this.getSearchPlaceholderText(),delaySearch:true}))}})},2097:function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(filter){var mimePrefix;switch(filter){case"images":mimePrefix="image";break;case"audio":mimePrefix="audio";break;case"videos":mimePrefix="video";break;case"documents":mimePrefix="application";break}return mimePrefix};module.exports=exports["default"]},2098:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _debug2=__webpack_require__(3);var _debug3=_interopRequireDefault(_debug2);var _viewport=__webpack_require__(92);var _range=__webpack_require__(2050);var _range2=_interopRequireDefault(_range);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _menu=__webpack_require__(1673);var _menu2=_interopRequireDefault(_menu);var _menuItem=__webpack_require__(1652);var _menuItem2=_interopRequireDefault(_menuItem);var _segmentedControl=__webpack_require__(1682);var _segmentedControl2=_interopRequireDefault(_segmentedControl);var _item=__webpack_require__(1665);var _item2=_interopRequireDefault(_item);var _uploadButton=__webpack_require__(1911);var _uploadButton2=_interopRequireDefault(_uploadButton);var _uploadUrl=__webpack_require__(2109);var _uploadUrl2=_interopRequireDefault(_uploadUrl);var _utils=__webpack_require__(208);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var debug=(0,_debug3.default)("calypso:media-library:header");exports.default=_react2.default.createClass({displayName:"MediaLibraryHeader",propTypes:{site:_react.PropTypes.object,filter:_react.PropTypes.string,scale:_react.PropTypes.number,onMediaScaleChange:_react.PropTypes.func,mediaScaleChoices:_react.PropTypes.arrayOf(_react.PropTypes.number).isRequired,mediaScale:_react.PropTypes.number.isRequired,sliderPositionCount:_react.PropTypes.number,onAddMedia:_react.PropTypes.func},statics:{SCALE_TOUCH_GRID:.32},getInitialState:function getInitialState(){return{addingViaUrl:false,isMoreOptionsVisible:false}},getDefaultProps:function getDefaultProps(){return{onAddMedia:function onAddMedia(){},onMediaScaleChange:function onMediaScaleChange(){},sliderPositionCount:100}},setMoreOptionsContext:function setMoreOptionsContext(component){if(!component){return}this.setState({moreOptionsContext:component})},onMediaScaleChange:function onMediaScaleChange(event){var sliderPosition=parseInt(event.target.value),scaleIndex=sliderPosition*this.props.mediaScaleChoices.length/this.props.sliderPositionCount,scale=this.props.mediaScaleChoices[Math.floor(scaleIndex)];debug("onMediaScaleChange sliderPosition=%d scaleIndex=%d scale=%f",sliderPosition,scaleIndex,scale);this.props.onMediaScaleChange(scale);this.setState({sliderPosition:sliderPosition})},getMediaScaleSliderPosition:function getMediaScaleSliderPosition(){if(typeof this.state.sliderPosition!=="undefined"){return this.state.sliderPosition}var scale=this.props.mediaScale,scaleIndex=this.props.mediaScaleChoices.indexOf(scale);if(scaleIndex<0){debug("getMediaScaleSliderPosition unrecognized scale %f",scale);return 0}var _props=this.props;var sliderPositionCount=_props.sliderPositionCount;var mediaScaleChoices=_props.mediaScaleChoices;var sliderPosition=Math.floor(scaleIndex*(sliderPositionCount-1)/(mediaScaleChoices.length-1));debug("getMediaScaleSliderPosition scale=%f scaleIndex=%d sliderPosition=%d",scale,scaleIndex,sliderPosition);return sliderPosition},toggleAddViaUrl:function toggleAddViaUrl(state){this.setState({addingViaUrl:state,isMoreOptionsVisible:false})},toggleMoreOptions:function toggleMoreOptions(state){this.setState({isMoreOptionsVisible:state})},renderUploadButtons:function renderUploadButtons(){var _props2=this.props;var site=_props2.site;var filter=_props2.filter;var onAddMedia=_props2.onAddMedia;if(!(0,_utils.userCan)("upload_files",site)){return}return _react2.default.createElement("div",{className:"media-library__upload-buttons"},_react2.default.createElement(_uploadButton2.default,{site:site,filter:filter,onAddMedia:onAddMedia,className:"button is-primary"},this.translate("Add New",{context:"Media upload"})),_react2.default.createElement("button",{onClick:this.toggleAddViaUrl.bind(this,true),className:"button is-desktop"},this.translate("Add via URL",{context:"Media upload"})),_react2.default.createElement("button",{ref:this.setMoreOptionsContext,onClick:this.toggleMoreOptions.bind(this,!this.state.isMoreOptionsVisible),className:"button is-primary is-mobile"},_react2.default.createElement("span",{className:"screen-reader-text"},this.translate("More Options")),_react2.default.createElement(_gridicon2.default,{icon:"chevron-down",size:20}),_react2.default.createElement(_menu2.default,{context:this.state.moreOptionsContext,isVisible:this.state.isMoreOptionsVisible,onClose:this.toggleMoreOptions.bind(this,false),position:"bottom right",className:"popover is-dialog-visible"},_react2.default.createElement(_menuItem2.default,{onClick:this.toggleAddViaUrl.bind(this,true)},this.translate("Add via URL",{context:"Media upload"})))))},renderScaleToggle:function renderScaleToggle(){var _this=this;var _props3=this.props;var mediaScale=_props3.mediaScale;var sliderPositionCount=_props3.sliderPositionCount;var onMediaScaleChange=_props3.onMediaScaleChange;if((0,_viewport.isMobile)()){return _react2.default.createElement(_segmentedControl2.default,{className:"media-library__scale-toggle",compact:true},_react2.default.createElement(_item2.default,{selected:1!==mediaScale,onClick:function onClick(){return onMediaScaleChange(_this.constructor.SCALE_TOUCH_GRID)}},_react2.default.createElement("span",{className:"screen-reader-text"},this.translate("Grid")),_react2.default.createElement(_gridicon2.default,{icon:"grid"})),_react2.default.createElement(_item2.default,{selected:1===mediaScale,onClick:function onClick(){return onMediaScaleChange(1)}},_react2.default.createElement("span",{className:"screen-reader-text"},this.translate("List")),_react2.default.createElement(_gridicon2.default,{icon:"menu"})))}return _react2.default.createElement(_range2.default,{step:"1",min:"0",max:sliderPositionCount-1,minContent:_react2.default.createElement(_gridicon2.default,{icon:"image",size:16}),maxContent:_react2.default.createElement(_gridicon2.default,{icon:"image",size:24}),value:this.getMediaScaleSliderPosition(),onChange:this.onMediaScaleChange,className:"media-library__scale-range"})},render:function render(){var _props4=this.props;var site=_props4.site;var onAddMedia=_props4.onAddMedia;if(this.state.addingViaUrl){return _react2.default.createElement(_uploadUrl2.default,{site:site,onAddMedia:onAddMedia,onClose:this.toggleAddViaUrl.bind(this,false),className:"media-library__header"})}return _react2.default.createElement("header",{className:"media-library__header"},_react2.default.createElement("h2",{className:"media-library__heading"},this.translate("Media Library")),this.renderUploadButtons(),this.renderScaleToggle())}});module.exports=exports["default"]},2099:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1),classNames=__webpack_require__(10),isEqual=__webpack_require__(98);var Content=__webpack_require__(2095),MediaActions=__webpack_require__(1662),MediaLibraryDropZone=__webpack_require__(1910),MediaLibrarySelectedStore=__webpack_require__(1784),MediaUtils=__webpack_require__(1647),filterToMimePrefix=__webpack_require__(2097),FilterBar=__webpack_require__(2096),PreferencesData=__webpack_require__(2032),MediaValidationData=__webpack_require__(2031),urlSearch=__webpack_require__(1693);module.exports=React.createClass({displayName:"MediaLibrary",mixins:[urlSearch],propTypes:{site:React.PropTypes.object,filter:React.PropTypes.string,enabledFilters:React.PropTypes.arrayOf(React.PropTypes.string),search:React.PropTypes.string,onAddMedia:React.PropTypes.func,onFilterChange:React.PropTypes.func,onSearch:React.PropTypes.func,onScaleChange:React.PropTypes.func,onEditItem:React.PropTypes.func,fullScreenDropZone:React.PropTypes.bool,containerWidth:React.PropTypes.number,single:React.PropTypes.bool,scrollable:React.PropTypes.bool},getDefaultProps:function getDefaultProps(){return{fullScreenDropZone:true,onAddMedia:function onAddMedia(){},onScaleChange:function onScaleChange(){}}},componentDidMount:function componentDidMount(){this.onSearch=this.props.onSearch},componentDidUpdate:function componentDidUpdate(){this.onSearch=this.props.onSearch},componentWillUnmount:function componentWillUnmount(){delete this.onSearch},onAddMedia:function onAddMedia(){var selectedItems=MediaLibrarySelectedStore.getAll(this.props.site.ID),filteredItems=selectedItems;if(!this.props.site){return}if(this.props.filter){filteredItems=MediaUtils.filterItemsByMimePrefix(filteredItems,filterToMimePrefix(this.props.filter))}if(this.props.single&&filteredItems.length>1){filteredItems=filteredItems.slice(-1)}if(!isEqual(selectedItems,filteredItems)){MediaActions.setLibrarySelectedItems(this.props.site.ID,filteredItems)}this.props.onAddMedia()},filterRequiresUpgrade:function filterRequiresUpgrade(){var _props=this.props;var filter=_props.filter;var site=_props.site;switch(filter){case"audio":return!(site&&site.options.upgraded_filetypes_enabled||site.jetpack);case"videos":return!(site&&site.options.videopress_enabled||site.jetpack)}return false},renderDropZone:function renderDropZone(){return React.createElement(MediaLibraryDropZone,{site:this.props.site,filter:this.props.filter,fullScreen:this.props.fullScreenDropZone,onAddMedia:this.onAddMedia})},render:function render(){var classes,content;content=React.createElement(Content,{site:this.props.site,filter:this.props.filter,filterRequiresUpgrade:this.filterRequiresUpgrade(),search:this.props.search,containerWidth:this.props.containerWidth,single:this.props.single,scrollable:this.props.scrollable,onAddMedia:this.onAddMedia,onAddAndEditImage:this.props.onAddAndEditImage,onMediaScaleChange:this.props.onScaleChange,onEditItem:this.props.onEditItem});if(this.props.site){content=React.createElement(MediaValidationData,{siteId:this.props.site.ID},content)}classes=classNames("media-library",{"is-single":this.props.single});return React.createElement("div",{className:classes},this.renderDropZone(),React.createElement(FilterBar,{site:this.props.site,filter:this.props.filter,filterRequiresUpgrade:this.filterRequiresUpgrade(),enabledFilters:this.props.enabledFilters,search:this.props.search,onFilterChange:this.props.onFilterChange,onSearch:this.doSearch}),React.createElement(PreferencesData,null,content))}})},2100:function(module,exports,__webpack_require__){"use strict";var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var React=__webpack_require__(1);var ListItemFileDetails=__webpack_require__(1772);module.exports=React.createClass({displayName:"MediaLibraryListItemDocument",render:function render(){return React.createElement(ListItemFileDetails,(0,_extends3.default)({},this.props,{icon:"audio"}))}})},2101:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1);var ListItemFileDetails=__webpack_require__(1772);module.exports=React.createClass({displayName:"MediaLibraryListItemDocument",render:function render(){return React.createElement(ListItemFileDetails,this.props)}})},2102:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1);var MediaUtils=__webpack_require__(1647),MediaLibraryListItemFileDetails=__webpack_require__(1772);module.exports=React.createClass({displayName:"MediaLibraryListItemImage",propTypes:{media:React.PropTypes.object,scale:React.PropTypes.number,maxImageWidth:React.PropTypes.number,photon:React.PropTypes.bool},getDefaultProps:function getDefaultProps(){return{maxImageWidth:450,photon:true}},getInitialState:function getInitialState(){return{}},getImageDimensions:function getImageDimensions(){var width,height;if(this.props.media.width){width=this.props.media.width}else{width=this.state.imageWidth}if(this.props.media.height){height=this.props.media.height}else{height=this.state.imageHeight}return{width:width,height:height}},getImageStyle:function getImageStyle(){var dimensions=this.getImageDimensions();return{maxHeight:dimensions.height>dimensions.width?"none":"100%",maxWidth:dimensions.height<dimensions.width?"none":"100%"}},setUnknownImageDimensions:function setUnknownImageDimensions(event){if(!this.props.media.width){this.setState({imageWidth:event.target.clientWidth})}if(!this.props.media.height){this.setState({imageHeight:event.target.clientHeight})}},render:function render(){var url=MediaUtils.url(this.props.media,{photon:this.props.photon,maxWidth:this.props.maxImageWidth});if(!url){return React.createElement(MediaLibraryListItemFileDetails,{scale:this.props.scale,media:this.props.media,icon:"image"})}return React.createElement("img",{src:url,onLoad:this.setUnknownImageDimensions,alt:this.props.media.alt||this.props.media.title,style:this.getImageStyle(),className:"media-library__list-item-centered",draggable:"false"})}})},2103:function(module,exports,__webpack_require__){"use strict";var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var React=__webpack_require__(1),photon=__webpack_require__(750);var ListItemFileDetails=__webpack_require__(1772),Gridicon=__webpack_require__(26);module.exports=React.createClass({displayName:"MediaLibraryListItemVideo",propTypes:{media:React.PropTypes.object,maxImageWidth:React.PropTypes.number},getDefaultProps:function getDefaultProps(){return{maxImageWidth:450}},getHighestQualityThumbnail:function getHighestQualityThumbnail(){if(this.props.media.thumbnails){return this.props.media.thumbnails.fmt_hd||this.props.media.thumbnails.fmt_dvd||this.props.media.thumbnails.fmt_std}},render:function render(){var thumbnail=this.getHighestQualityThumbnail(),url;if(thumbnail){url=photon(thumbnail,{width:this.props.maxImageWidth});return React.createElement("div",{className:"media-library__list-item-video",style:{backgroundImage:"url("+url+")"}},React.createElement("span",{className:"media-library__list-item-icon media-library__list-item-centered"},React.createElement(Gridicon,{icon:"video-camera"})))}else{return React.createElement(ListItemFileDetails,(0,_extends3.default)({},this.props,{icon:"video-camera"}))}}})},2104:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _emptyContent=__webpack_require__(207);var _emptyContent2=_interopRequireDefault(_emptyContent);var _uploadButton=__webpack_require__(1911);var _uploadButton2=_interopRequireDefault(_uploadButton);var _utils=__webpack_require__(208);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"MediaLibraryListNoContent",propTypes:{site:_react2.default.PropTypes.object,filter:_react2.default.PropTypes.string},getLabel:function getLabel(){switch(this.props.filter){case"images":return this.translate("You don't have any images.",{textOnly:true,context:"Media no results"});case"videos":return this.translate("You don't have any videos.",{textOnly:true,context:"Media no results"});case"audio":return this.translate("You don't have any audio files.",{textOnly:true,context:"Media no results"});case"documents":return this.translate("You don't have any documents.",{textOnly:true,context:"Media no results"});default:return this.translate("You don't have any media.",{textOnly:true,context:"Media no results"})}},render:function render(){var line=void 0,action=void 0;if((0,_utils.userCan)("upload_files",this.props.site)){line=this.translate("Would you like to upload something?");action=_react2.default.createElement(_uploadButton2.default,{className:"button is-primary",site:this.props.site},this.translate("Upload Media"))}return _react2.default.createElement(_emptyContent2.default,{title:this.getLabel(),line:line,action:action,illustration:"/calypso/images/drake/drake-nomedia.svg"})}});module.exports=exports["default"]},2105:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1);var NoResults=__webpack_require__(1689);module.exports=React.createClass({displayName:"MediaLibraryListNoResults",propTypes:{filter:React.PropTypes.string,search:React.PropTypes.string},getDefaultProps:function getDefaultProps(){return{search:""}},getLabel:function getLabel(){var label;switch(this.props.filter){case"images":label=this.translate("No images match your search for {{searchTerm/}}.",{components:{searchTerm:React.createElement("em",null,this.props.search)},context:"Media no search results"});break;case"videos":label=this.translate("No videos match your search for {{searchTerm/}}.",{components:{searchTerm:React.createElement("em",null,this.props.search)},context:"Media no search results"});break;case"audio":label=this.translate("No audio files match your search for {{searchTerm/}}.",{components:{searchTerm:React.createElement("em",null,this.props.search)},context:"Media no search results"});break;case"documents":label=this.translate("No documents match your search for {{searchTerm/}}.",{components:{searchTerm:React.createElement("em",null,this.props.search)},context:"Media no search results"});break;default:label=this.translate("No media files match your search for {{searchTerm/}}.",{components:{searchTerm:React.createElement("em",null,this.props.search)},context:"Media no search results"});break}return label},render:function render(){return React.createElement(NoResults,{text:this.getLabel(),image:"/calypso/images/pages/illustration-pages.svg"})}})},2106:function(module,exports,__webpack_require__){"use strict";var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _page=__webpack_require__(33);var _page2=_interopRequireDefault(_page);var _analytics=__webpack_require__(20);var _analytics2=_interopRequireDefault(_analytics);var _formatting=__webpack_require__(81);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var EmptyContent=__webpack_require__(207),Button=__webpack_require__(69);module.exports=_react2.default.createClass({displayName:"MediaLibraryListPlanPromo",propTypes:{site:_react2.default.PropTypes.object,filter:_react2.default.PropTypes.string},getTitle:function getTitle(){switch(this.props.filter){case"videos":return this.translate("Upload Videos",{textOnly:true,context:"Media upload plan needed"});case"audio":return this.translate("Upload Audio",{textOnly:true,context:"Media upload plan needed"});default:return this.translate("Upload Media",{textOnly:true,context:"Media upload plan needed"})}},getSummary:function getSummary(){switch(this.props.filter){case"videos":return(0,_formatting.preventWidows)(this.translate("To upload video files to your site, upgrade your plan.",{textOnly:true,context:"Media upgrade promo"}),2);case"audio":return(0,_formatting.preventWidows)(this.translate("To upload audio files to your site, upgrade your plan.",{textOnly:true,context:"Media upgrade promo"}),2);default:return(0,_formatting.preventWidows)(this.translate("To upload audio and video files to your site, upgrade your plan.",{textOnly:true,context:"Media upgrade promo"}),2)}},viewPlansPage:function viewPlansPage(){var _props$site$slug=this.props.site.slug;var slug=_props$site$slug===undefined?"":_props$site$slug;_analytics2.default.tracks.recordEvent("calypso_media_plans_button_click");(0,_page2.default)("/plans/"+slug)},render:function render(){var action=_react2.default.createElement(Button,{className:"button is-primary",onClick:this.viewPlansPage},this.translate("See Plans"));return _react2.default.createElement(EmptyContent,{title:this.getTitle(),line:this.getSummary(),action:this.props.children||action,illustration:""})}})},2107:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.MediaLibraryUpgradeNudge=undefined;var _identity2=__webpack_require__(99);var _identity3=_interopRequireDefault(_identity2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _i18nCalypso=__webpack_require__(11);var _constants=__webpack_require__(135);var _upgradeNudge=__webpack_require__(1680);var _upgradeNudge2=_interopRequireDefault(_upgradeNudge);var _listPlanPromo=__webpack_require__(2106);var _listPlanPromo2=_interopRequireDefault(_listPlanPromo);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function getTitle(filter,translate){if(filter==="audio"){return translate("Upgrade to the Premium Plan and Enable Audio Uploads")}return translate("Upgrade to a Premium Plan and Enable VideoPress")}function getSubtitle(filter,translate){if(filter==="audio"){return translate("By upgrading to the Premium plan you'll enable audio upload support on your site.")}return translate("By upgrading to a Premium Plan you'll enable VideoPress support on your site.")}var MediaLibraryUpgradeNudge=exports.MediaLibraryUpgradeNudge=function MediaLibraryUpgradeNudge(_ref){var translate=_ref.translate;var filter=_ref.filter;var site=_ref.site;return _react2.default.createElement("div",{className:"media-library__videopress-nudge-container"},_react2.default.createElement(_listPlanPromo2.default,{site:site,filter:filter},_react2.default.createElement(_upgradeNudge2.default,{className:"media-library__videopress-nudge-regular",title:getTitle(filter,translate),message:getSubtitle(filter,translate),feature:"audio"===filter?_constants.FEATURE_AUDIO_UPLOADS:_constants.FEATURE_VIDEO_UPLOADS,event:"calypso_media_uploads_upgrade_nudge"})))};MediaLibraryUpgradeNudge.propTypes={site:_react.PropTypes.object,translate:_react.PropTypes.func,filter:_react2.default.PropTypes.string};MediaLibraryUpgradeNudge.defaultProps={translate:_identity3.default,filter:"video"};exports.default=(0,_i18nCalypso.localize)(MediaLibraryUpgradeNudge)},2108:function(module,exports,__webpack_require__){"use strict";var _freeze=__webpack_require__(276);var _freeze2=_interopRequireDefault(_freeze);var _listPlanUpgradeNudge=__webpack_require__(2107);var _listPlanUpgradeNudge2=_interopRequireDefault(_listPlanUpgradeNudge);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ReactDom=__webpack_require__(44),React=__webpack_require__(1),clone=__webpack_require__(212),noop=__webpack_require__(38),filter=__webpack_require__(77),findIndex=__webpack_require__(214);var MediaActions=__webpack_require__(1662),MediaUtils=__webpack_require__(1647),ListItem=__webpack_require__(1986),ListNoResults=__webpack_require__(2105),ListNoContent=__webpack_require__(2104),InfiniteList=__webpack_require__(1691),user=__webpack_require__(48)();module.exports=React.createClass({displayName:"MediaLibraryList",propTypes:{site:React.PropTypes.object,media:React.PropTypes.arrayOf(React.PropTypes.object),mediaLibrarySelectedItems:React.PropTypes.arrayOf(React.PropTypes.object),filter:React.PropTypes.string,filterRequiresUpgrade:React.PropTypes.bool.isRequired,search:React.PropTypes.string,
containerWidth:React.PropTypes.number,rowPadding:React.PropTypes.number,mediaScale:React.PropTypes.number.isRequired,photon:React.PropTypes.bool,mediaHasNextPage:React.PropTypes.bool,mediaFetchingNextPage:React.PropTypes.bool,mediaOnFetchNextPage:React.PropTypes.func,single:React.PropTypes.bool,scrollable:React.PropTypes.bool,onEditItem:React.PropTypes.func},getInitialState:function getInitialState(){return{}},getDefaultProps:function getDefaultProps(){return{mediaLibrarySelectedItems:(0,_freeze2.default)([]),containerWidth:0,rowPadding:10,mediaHasNextPage:false,mediaFetchingNextPage:false,mediaOnFetchNextPage:noop,single:false,scrollable:false,onEditItem:noop}},setListContext:function setListContext(component){if(!component){return}this.setState({listContext:ReactDom.findDOMNode(component)})},getMediaItemHeight:function getMediaItemHeight(){return Math.round(this.props.containerWidth*this.props.mediaScale)+this.props.rowPadding},getItemsPerRow:function getItemsPerRow(){return Math.floor(1/this.props.mediaScale)},getMediaItemStyle:function getMediaItemStyle(index){var itemsPerRow=this.getItemsPerRow(),isFillingEntireRow=itemsPerRow===1/this.props.mediaScale,isLastInRow=0===(index+1)%itemsPerRow,style,marginValue;style={paddingBottom:this.props.rowPadding,fontSize:this.props.mediaScale*225};if(!isFillingEntireRow&&!isLastInRow){marginValue=1%this.props.mediaScale/(itemsPerRow-1)*100+"%";if(user.isRTL()){style.marginLeft=marginValue}else{style.marginRight=marginValue}}return style},toggleItem:function toggleItem(item,shiftKeyPressed){var selectedItems=void 0;if(this.props.single){selectedItems=filter(this.props.mediaLibrarySelectedItems,{ID:item.ID})}else{selectedItems=clone(this.props.mediaLibrarySelectedItems)}var selectedItemsIndex=findIndex(selectedItems,{ID:item.ID});var isToBeSelected=-1===selectedItemsIndex;var selectedMediaIndex=findIndex(this.props.media,{ID:item.ID});var start=selectedMediaIndex;var end=selectedMediaIndex;if(!this.props.single&&shiftKeyPressed){start=Math.min(start,this.state.lastSelectedMediaIndex);end=Math.max(end,this.state.lastSelectedMediaIndex)}for(var i=start;i<=end;i++){var interimIndex=findIndex(selectedItems,{ID:this.props.media[i].ID});if(isToBeSelected&&-1===interimIndex){selectedItems.push(this.props.media[i])}else if(!isToBeSelected&&-1!==interimIndex){selectedItems.splice(interimIndex,1)}}this.setState({lastSelectedMediaIndex:selectedMediaIndex});if(this.props.site){MediaActions.setLibrarySelectedItems(this.props.site.ID,selectedItems)}},getItemRef:function getItemRef(item){return"item-"+item.ID},renderItem:function renderItem(item){var index=findIndex(this.props.media,{ID:item.ID}),selectedItems=this.props.mediaLibrarySelectedItems,selectedIndex=findIndex(selectedItems,{ID:item.ID}),ref=this.getItemRef(item),showGalleryHelp;showGalleryHelp=!this.props.single&&selectedIndex!==-1&&selectedItems.length===1&&"image"===MediaUtils.getMimePrefix(item);return React.createElement(ListItem,{ref:ref,key:ref,style:this.getMediaItemStyle(index),media:item,scale:this.props.mediaScale,photon:this.props.photon,showGalleryHelp:showGalleryHelp,selectedIndex:selectedIndex,onToggle:this.toggleItem,onEditItem:this.props.onEditItem})},renderLoadingPlaceholders:function renderLoadingPlaceholders(){var itemsPerRow=this.getItemsPerRow(),itemsVisible=(this.props.media||[]).length,placeholders=itemsPerRow-itemsVisible%itemsPerRow;return Array.apply(null,new Array(placeholders)).map(function(value,i){return React.createElement(ListItem,{key:"placeholder-"+i,style:this.getMediaItemStyle(itemsVisible+i),scale:this.props.mediaScale})},this)},render:function render(){var onFetchNextPage;if(this.props.filterRequiresUpgrade){return React.createElement(_listPlanUpgradeNudge2.default,{filter:this.props.filter,site:this.props.site})}if(!this.props.mediaHasNextPage&&this.props.media&&0===this.props.media.length){return React.createElement(this.props.search?ListNoResults:ListNoContent,{site:this.props.site,filter:this.props.filter,search:this.props.search})}onFetchNextPage=function(){this.props.mediaOnFetchNextPage()}.bind(this);return React.createElement(InfiniteList,{ref:this.setListContext,context:this.props.scrollable?this.state.listContext:false,items:this.props.media||[],itemsPerRow:this.getItemsPerRow(),lastPage:!this.props.mediaHasNextPage,fetchingNextPage:this.props.mediaFetchingNextPage,guessedItemHeight:this.getMediaItemHeight(),fetchNextPage:onFetchNextPage,getItemRef:this.getItemRef,renderItem:this.renderItem,renderLoadingPlaceholders:this.renderLoadingPlaceholders,className:"media-library__list"})}})},2109:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _noop=__webpack_require__(38);var _noop2=_interopRequireDefault(_noop);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _analytics=__webpack_require__(20);var _analytics2=_interopRequireDefault(_analytics);var _formTextInput=__webpack_require__(206);var _formTextInput2=_interopRequireDefault(_formTextInput);var _actions=__webpack_require__(1662);var _actions2=_interopRequireDefault(_actions);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"MediaLibraryUploadUrl",propTypes:{site:_react2.default.PropTypes.object,onAddMedia:_react2.default.PropTypes.func,onClose:_react2.default.PropTypes.func,className:_react2.default.PropTypes.string},getInitialState:function getInitialState(){return{value:"",isError:false}},getDefaultProps:function getDefaultProps(){return{onAddMedia:_noop2.default,onClose:_noop2.default}},upload:function upload(event){var isError=!event.target.checkValidity();this.setState({isError:isError});if(isError||!this.props.site){return}_actions2.default.clearValidationErrors(this.props.site.ID);_actions2.default.add(this.props.site.ID,this.state.value);this.replaceState(this.getInitialState());this.props.onAddMedia();this.props.onClose();_analytics2.default.mc.bumpStat("editor_upload_via","url");event.preventDefault()},onChange:function onChange(event){this.setState({value:event.target.value,isError:false})},onKeyDown:function onKeyDown(event){if(event.key!=="Enter"){return}this.upload(event)},render:function render(){var classes=(0,_classnames2.default)("media-library__upload-url",this.props.className);return _react2.default.createElement("form",{className:classes,onSubmit:this.upload},_react2.default.createElement(_formTextInput2.default,{type:"url",value:this.state.value,placeholder:"https://",onChange:this.onChange,onKeyDown:this.onKeyDown,isError:this.state.isError,autoFocus:true,required:true}),_react2.default.createElement("div",{className:"media-library__upload-url-button-group"},_react2.default.createElement("button",{type:"submit",className:"button is-primary"},this.translate("Upload",{context:"verb"})),_react2.default.createElement("button",{type:"button",className:"media-library__upload-url-cancel",onClick:this.props.onClose},_react2.default.createElement("span",{className:"screen-reader-text"},this.translate("Cancel")),_react2.default.createElement(_gridicon2.default,{icon:"cross"}))))}});module.exports=exports["default"]},2125:function(module,exports,__webpack_require__){"use strict";var _keys=__webpack_require__(39);var _keys2=_interopRequireDefault(_keys);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var last=__webpack_require__(215);var connectionsList=__webpack_require__(1840)(),sites=__webpack_require__(53)();module.exports={isServiceForPublicize:function isServiceForPublicize(){return false},getConnections:function getConnections(connections,serviceName,siteId){var site=siteId?sites.getSite(siteId):sites.getSelectedSite();if(!site||!site.settings){return[]}return connections.filter(function(connection){return site.settings.eventbrite_api_token===connection.keyring_connection_ID})},didKeyringConnectionSucceed:function didKeyringConnectionSucceed(value,serviceName,siteId){var site=siteId?sites.getSite(siteId):sites.getSelectedSite(),connection=last(this.getAvailableExternalAccounts(serviceName,siteId));if(site&&connection){site.saveSettings({eventbrite_api_token:connection.keyringConnectionId},function(error,data){var success=!error&&(0,_keys2.default)(data.updated).length;connectionsList.emit("create:"+(success?"success":"error"))})}return value},filterConnectionToRemove:function filterConnectionToRemove(shouldDestroy,connection,siteId){var site=siteId?sites.getSite(siteId):sites.getSelectedSite();if(site){site.saveSettings({eventbrite_api_token:""},function(error,data){var success=!error&&(0,_keys2.default)(data.updated).length;connectionsList.emit("destroy:"+(success?"success":"error"))})}return false}}},2126:function(module,exports,__webpack_require__){"use strict";module.exports={eventbrite:__webpack_require__(2125)}},2133:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _terms=__webpack_require__(1992);var _terms2=_interopRequireDefault(_terms);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"TermTreeSelector",propTypes:{multiple:_react.PropTypes.bool,className:_react.PropTypes.string,onChange:_react.PropTypes.func.isRequired,selected:_react.PropTypes.array,createLink:_react.PropTypes.string,analyticsPrefix:_react.PropTypes.string,taxonomy:_react.PropTypes.string},getDefaultProps:function getDefaultProps(){return{analyticsPrefix:"Category Selector",selected:[],taxonomy:"category",onChange:function onChange(){}}},getInitialState:function getInitialState(){return{search:""}},onSearch:function onSearch(searchTerm){if(searchTerm!==this.state.search){this.setState({search:searchTerm})}},render:function render(){var _props=this.props;var className=_props.className;var taxonomy=_props.taxonomy;var onChange=_props.onChange;var selected=_props.selected;var createLink=_props.createLink;var multiple=_props.multiple;var classes=(0,_classnames2.default)(className);var search=this.state.search;var query={};if(search&&search.length){query.search=search}return _react2.default.createElement("div",{className:classes,ref:"wrapper"},_react2.default.createElement(_terms2.default,{taxonomy:taxonomy,onSearch:this.onSearch,onChange:onChange,query:query,selected:selected,createLink:createLink,multiple:multiple}))}});module.exports=exports["default"]},2134:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _mixin=__webpack_require__(111);var _mixin2=_interopRequireDefault(_mixin);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"TermTreeSelectorNoResults",mixins:[_mixin2.default],propTypes:{createLink:_react.PropTypes.string},render:function render(){var createLink=this.props.createLink;var createMessage=void 0;if(createLink){createMessage=this.translate("You may want to {{a}}create a new item{{/a}}.",{context:"Term Selector: term search/listing results",comment:"This is used when no terms match the given search, or if there are no terms at all.",components:{a:_react2.default.createElement("a",{className:"create-link",href:createLink,target:"_blank",rel:"noopener noreferrer"})}})}return _react2.default.createElement("span",{className:"is-empty-content"},this.translate("No results. Please try a different search."),"",createMessage)}});module.exports=exports["default"]},2135:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"TermTreeSelectorSearch",propTypes:{searchTerm:_react.PropTypes.string,onSearch:_react.PropTypes.func.isRequired},render:function render(){return _react2.default.createElement("div",{className:"term-tree-selector__search"},_react2.default.createElement(_gridicon2.default,{icon:"search",size:18}),_react2.default.createElement("input",{type:"search",placeholder:this.translate("Search",{textOnly:true}),value:this.props.searchTerm,onChange:this.props.onSearch}))}});module.exports=exports["default"]},2153:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var React=__webpack_require__(1);var CountedTextarea=__webpack_require__(1780),FormTextarea=__webpack_require__(1668),PostActions=__webpack_require__(1648),stats=__webpack_require__(1651),TrackInputChanges=__webpack_require__(1782),InfoPopover=__webpack_require__(1725);exports.default=React.createClass({displayName:"PublicizeMessage",propTypes:{message:React.PropTypes.string,preview:React.PropTypes.string,acceptableLength:React.PropTypes.number,requireCount:React.PropTypes.bool,onChange:React.PropTypes.func},getDefaultProps:function getDefaultProps(){return{message:"",acceptableLength:140,requireCount:false}},onChange:function onChange(event){if(this.props.onChange){this.props.onChange(event.target.value)}else{PostActions.updateMetadata("_wpas_mess",event.target.value)}},recordStats:function recordStats(){stats.recordStat("sharing_message_changed");stats.recordEvent("Publicize Sharing Message Changed")},renderInfoPopover:function renderInfoPopover(){return React.createElement(InfoPopover,{className:"publicize-message-counter-info",position:"bottom left",gaEventCategory:"Editor",popoverName:"SharingMessage"},this.translate("The length includes space for the link to your post and an attached image.",{context:"Post editor sharing message counter explanation"}))},renderTextarea:function renderTextarea(){if(this.props.requireCount){return React.createElement(CountedTextarea,{value:this.props.message,placeholder:this.props.preview,countPlaceholderLength:true,onChange:this.onChange,showRemainingCharacters:true,acceptableLength:this.props.acceptableLength,className:"editor-sharing__message-input"},this.renderInfoPopover())}else{return React.createElement(FormTextarea,{value:this.props.message,placeholder:this.props.preview,onChange:this.onChange,className:"editor-sharing__message-input"})}},render:function render(){return React.createElement("div",{className:"editor-sharing__publicize-message"},React.createElement("h5",{className:"editor-sharing__message-heading"},this.translate("Customize the message",{context:"Post editor sharing message heading"})),React.createElement(TrackInputChanges,{onNewValue:this.recordStats},this.renderTextarea()))}});module.exports=exports["default"]},2154:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _reactDom=__webpack_require__(44);var _reactDom2=_interopRequireDefault(_reactDom);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactRedux=__webpack_require__(15);var _i18nCalypso=__webpack_require__(11);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _trackInputChanges=__webpack_require__(1782);var _trackInputChanges2=_interopRequireDefault(_trackInputChanges);var _formTextInput=__webpack_require__(206);var _formTextInput2=_interopRequireDefault(_formTextInput);var _stats=__webpack_require__(1651);var _selectors=__webpack_require__(47);var _selectors2=__webpack_require__(277);var _selectors3=__webpack_require__(112);var _actions=__webpack_require__(285);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var PostEditorSlug=function(_Component){(0,_inherits3.default)(PostEditorSlug,_Component);function PostEditorSlug(){(0,_classCallCheck3.default)(this,PostEditorSlug);var _this=(0,_possibleConstructorReturn3.default)(this,(PostEditorSlug.__proto__||(0,_getPrototypeOf2.default)(PostEditorSlug)).apply(this,arguments));_this.state={isSlugFocused:false};_this.onSlugKeyDown=_this.onSlugKeyDown.bind(_this);_this.onSlugChange=_this.onSlugChange.bind(_this);_this.onBlur=_this.onBlur.bind(_this);_this.onFocus=_this.onFocus.bind(_this);_this.focusSlug=_this.focusSlug.bind(_this);_this.recordChangeStats=_this.recordChangeStats.bind(_this);_this.statTracked=false;return _this}(0,_createClass3.default)(PostEditorSlug,[{key:"onSlugChange",value:function onSlugChange(event){var _props=this.props;var siteId=_props.siteId;var postId=_props.postId;this.props.editPost(siteId,postId,{slug:event.target.value})}},{key:"onSlugKeyDown",value:function onSlugKeyDown(event){var _this2=this;if(event.key==="Enter"||event.key==="Escape"){(function(){var _props2=_this2.props;var onEscEnter=_props2.onEscEnter;var isEditable=_props2.isEditable;_this2.setState({isSlugFocused:false},function(){onEscEnter();if(isEditable){_reactDom2.default.findDOMNode(this.refs.slugField).blur()}})})()}}},{key:"onBlur",value:function onBlur(){if(this.state.isSlugFocused){this.setState({isSlugFocused:false})}}},{key:"onFocus",value:function onFocus(){this.setState({isSlugFocused:true})}},{key:"focusSlug",value:function focusSlug(){if(this.props.isEditable){_reactDom2.default.findDOMNode(this.refs.slugField).focus()}}},{key:"recordChangeStats",value:function recordChangeStats(){switch(this.props.instanceName){case"post-sidebar":(0,_stats.recordStat)("slug-edited-post-sidebar");(0,_stats.recordEvent)("Slug Edited (Post Sidebar)");break;case"post-popover":(0,_stats.recordStat)("slug-edited-post-popover");(0,_stats.recordEvent)("Slug Edited (Post Permalink Popover)");break;case"page-sidebar":(0,_stats.recordStat)("slug-edited-page-sidebar");(0,_stats.recordEvent)("Slug Edited (Page Sidebar)");break;case"page-permalink":(0,_stats.recordStat)("slug-edited-page-permalink");(0,_stats.recordEvent)("Slug Edited (Page Permalink)");break}}},{key:"render",value:function render(){var _props3=this.props;var className=_props3.className;var translate=_props3.translate;var slug=_props3.slug;var children=_props3.children;var path=_props3.path;var isEditable=_props3.isEditable;var wrapperClass=(0,_classnames2.default)("editor-slug",className,{"is-focused":this.state.isSlugFocused});return _react2.default.createElement("div",{className:wrapperClass,onClick:this.focusSlug},children,_react2.default.createElement("span",{className:"editor-slug__url-path",onClick:this.focusSlug},path),isEditable&&_react2.default.createElement(_trackInputChanges2.default,{onNewValue:this.recordChangeStats},_react2.default.createElement(_formTextInput2.default,{ref:"slugField",value:slug,onChange:this.onSlugChange,onKeyDown:this.onSlugKeyDown,onBlur:this.onBlur,onFocus:this.onFocus,"aria-label":translate("Enter slug")})))}}]);return PostEditorSlug}(_react.Component);PostEditorSlug.propTypes={path:_react.PropTypes.string,slug:_react.PropTypes.string,onEscEnter:_react.PropTypes.func,className:_react.PropTypes.string,isEditable:_react.PropTypes.bool,instanceName:_react.PropTypes.string,translate:_react.PropTypes.func,siteId:_react.PropTypes.number,postId:_react.PropTypes.number};PostEditorSlug.defaultProps={onEscEnter:function onEscEnter(){},isEditable:true,slug:""};exports.default=(0,_reactRedux.connect)(function(state){var siteId=(0,_selectors.getSelectedSiteId)(state);var postId=(0,_selectors2.getEditorPostId)(state);var slug=(0,_selectors3.getEditedPostSlug)(state,siteId,postId);return{siteId:siteId,postId:postId,slug:slug}},{editPost:_actions.editPost})((0,_i18nCalypso.localize)(PostEditorSlug));module.exports=exports["default"]},2155:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _mixin=__webpack_require__(111);var _mixin2=_interopRequireDefault(_mixin);var _reactRedux=__webpack_require__(15);var _redux=__webpack_require__(6);var _viewport=__webpack_require__(92);var _popover=__webpack_require__(386);var _popover2=_interopRequireDefault(_popover);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _formCheckbox=__webpack_require__(1654);var _formCheckbox2=_interopRequireDefault(_formCheckbox);var _button=__webpack_require__(69);var _button2=_interopRequireDefault(_button);var _actions=__webpack_require__(226);var _selectors=__webpack_require__(138);var _queryPreferences=__webpack_require__(414);var _queryPreferences2=_interopRequireDefault(_queryPreferences);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var EditorMediaModalGalleryHelp=_react2.default.createClass({displayName:"EditorMediaModalGalleryHelp",mixins:[_mixin2.default],propTypes:{onDismiss:_react.PropTypes.func},getInitialState:function getInitialState(){return{isDismissed:false,rememberDismiss:true}},getDefaultProps:function getDefaultProps(){return{onDismiss:function onDismiss(){}}},setRenderContext:function setRenderContext(renderContext){if(!renderContext){return}this.setState({renderContext:renderContext})},toggleRememberDismiss:function toggleRememberDismiss(){var _this=this;setTimeout(function(){_this.setState({rememberDismiss:!_this.state.rememberDismiss})},0)},dismiss:function dismiss(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var remember=_ref.remember;this.setState({isDismissed:true});this.props.onDismiss({remember:remember})},renderPopover:function renderPopover(){var _this2=this;var _state=this.state;var renderContext=_state.renderContext;var isDismissed=_state.isDismissed;if(!renderContext||isDismissed){return}return _react2.default.createElement(_popover2.default,{onClose:function onClose(){return _this2.dismiss()},context:renderContext,position:"bottom",isVisible:!(0,_viewport.isMobile)(),className:"popover__gallery-help is-dialog-visible"},_react2.default.createElement("div",{className:"editor-media-modal__gallery-help-content"},_react2.default.createElement("div",{className:"editor-media-modal__gallery-help-instruction"},_react2.default.createElement("span",{className:"editor-media-modal__gallery-help-icon"},_react2.default.createElement(_gridicon2.default,{icon:"image-multiple",size:20})),_react2.default.createElement("span",{className:"editor-media-modal__gallery-help-text"},this.translate("Select more than one image to create a gallery."))),_react2.default.createElement("div",{className:"editor-media-modal__gallery-help-actions"},_react2.default.createElement("label",{className:"editor-media-modal__gallery-help-remember-dismiss"},_react2.default.createElement(_formCheckbox2.default,{checked:this.state.rememberDismiss,onChange:this.toggleRememberDismiss}),_react2.default.createElement("span",null,this.translate("Don't show again"))),_react2.default.createElement(_button2.default,{onClick:function onClick(){return _this2.dismiss({remember:_this2.state.rememberDismiss})},compact:true},this.translate("Got it",{context:"Button label",comment:"User clicks this to confirm that he has understood the text"})))))},render:function render(){if(this.props.isMediaModalGalleryInstructionsDismissed){return null}return _react2.default.createElement("div",{ref:this.setRenderContext,className:"editor-media-modal__gallery-help"},_react2.default.createElement(_queryPreferences2.default,null),this.renderPopover())}});exports.default=(0,_reactRedux.connect)(function(state){return{isMediaModalGalleryInstructionsDismissed:(0,_selectors.getPreference)(state,"mediaModalGalleryInstructionsDismissed")||(0,_selectors.getPreference)(state,"mediaModalGalleryInstructionsDismissedForSession")}},function(dispatch){return(0,_redux.bindActionCreators)({onDismiss:function onDismiss(options){if(options.remember){return(0,_actions.savePreference)("mediaModalGalleryInstructionsDismissed",true)}else{return(0,_actions.setPreference)("mediaModalGalleryInstructionsDismissedForSession",true)}}},dispatch)})(EditorMediaModalGalleryHelp);module.exports=exports["default"]},2183:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.setEditorPostId=setEditorPostId;exports.toggleEditorDraftsVisible=toggleEditorDraftsVisible;var _actionTypes=__webpack_require__(2);function setEditorPostId(postId){return{type:_actionTypes.EDITOR_POST_ID_SET,postId:postId}}function toggleEditorDraftsVisible(){return{type:_actionTypes.EDITOR_SHOW_DRAFTS_TOGGLE}}},2212:function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.clone=clone;exports.addMonths=addMonths;exports.isSameDay=isSameDay;exports.isPastDay=isPastDay;exports.isDayBetween=isDayBetween;exports.addDayToRange=addDayToRange;exports.isDayInRange=isDayInRange;function clone(d){return new Date(d.getTime())}function addMonths(d,n){var newDate=clone(d);newDate.setMonth(d.getMonth()+n);return newDate}function isSameDay(d1,d2){if(!d1||!d2){return false}return d1.getDate()===d2.getDate()&&d1.getMonth()===d2.getMonth()&&d1.getFullYear()===d2.getFullYear()}function isPastDay(d){var today=new Date;today.setHours(0,0,0,0);return d<today}function isDayBetween(d,d1,d2){var date=clone(d);var date1=clone(d1);var date2=clone(d2);date.setHours(0,0,0,0);date1.setHours(0,0,0,0);date2.setHours(0,0,0,0);return date1<date&&date<date2||date2<date&&date<date1}function addDayToRange(day){var range=arguments.length<=1||arguments[1]===undefined?{from:null,to:null}:arguments[1];var from=range.from;var to=range.to;if(!from){from=day}else if(from&&to&&isSameDay(from,to)&&isSameDay(day,from)){from=null;to=null}else if(to&&day<from){from=day}else if(to&&isSameDay(day,to)){from=day;to=day}else{to=day;if(to<from){to=from;from=day}}return{from:from,to:to}}function isDayInRange(day,range){var from=range.from;var to=range.to;return from&&isSameDay(day,from)||to&&isSameDay(day,to)||from&&to&&isDayBetween(day,from,to)}exports.default={addDayToRange:addDayToRange,addMonths:addMonths,clone:clone,isSameDay:isSameDay,isDayInRange:isDayInRange,isDayBetween:isDayBetween,isPastDay:isPastDay}},2213:function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.formatDay=formatDay;exports.formatMonthTitle=formatMonthTitle;exports.formatWeekdayShort=formatWeekdayShort;exports.formatWeekdayLong=formatWeekdayLong;exports.getFirstDayOfWeek=getFirstDayOfWeek;exports.getMonths=getMonths;var WEEKDAYS_LONG=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];var WEEKDAYS_SHORT=["Su","Mo","Tu","We","Th","Fr","Sa"];var MONTHS=["January","February","March","April","May","June","July","August","September","October","November","December"];function formatDay(day){return day.toDateString()}function formatMonthTitle(d){return MONTHS[d.getMonth()]+" "+d.getFullYear()}function formatWeekdayShort(i){return WEEKDAYS_SHORT[i]}function formatWeekdayLong(i){return WEEKDAYS_LONG[i]}function getFirstDayOfWeek(){return 0}function getMonths(){return MONTHS}exports.default={formatDay:formatDay,formatMonthTitle:formatMonthTitle,formatWeekdayShort:formatWeekdayShort,formatWeekdayLong:formatWeekdayLong,getFirstDayOfWeek:getFirstDayOfWeek,getMonths:getMonths}},2214:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactAddonsShallowCompare=__webpack_require__(738);var _reactAddonsShallowCompare2=_interopRequireDefault(_reactAddonsShallowCompare);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var AutoSizer=function(_Component){_inherits(AutoSizer,_Component);function AutoSizer(props){_classCallCheck(this,AutoSizer);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(AutoSizer).call(this,props));_this.state={height:0,width:0};_this._onResize=_this._onResize.bind(_this);_this._onScroll=_this._onScroll.bind(_this);_this._setRef=_this._setRef.bind(_this);return _this}_createClass(AutoSizer,[{key:"componentDidMount",value:function componentDidMount(){this._detectElementResize=__webpack_require__(2216);this._detectElementResize.addResizeListener(this._parentNode,this._onResize);this._onResize()}},{key:"componentWillUnmount",value:function componentWillUnmount(){if(this._detectElementResize){this._detectElementResize.removeResizeListener(this._parentNode,this._onResize)}}},{key:"render",value:function render(){var _props=this.props;var children=_props.children;var disableHeight=_props.disableHeight;var disableWidth=_props.disableWidth;var _state=this.state;var height=_state.height;var width=_state.width;var outerStyle={overflow:"visible"};if(!disableHeight){outerStyle.height=0}if(!disableWidth){outerStyle.width=0}return _react2.default.createElement("div",{ref:this._setRef,onScroll:this._onScroll,style:outerStyle},children({height:height,width:width}))}},{key:"shouldComponentUpdate",value:function shouldComponentUpdate(nextProps,nextState){return(0,_reactAddonsShallowCompare2.default)(this,nextProps,nextState)}},{key:"_onResize",value:function _onResize(){var onResize=this.props.onResize;var boundingRect=this._parentNode.getBoundingClientRect();var height=boundingRect.height||0;var width=boundingRect.width||0;var style=getComputedStyle(this._parentNode);var paddingLeft=parseInt(style.paddingLeft,10)||0;var paddingRight=parseInt(style.paddingRight,10)||0;var paddingTop=parseInt(style.paddingTop,10)||0;var paddingBottom=parseInt(style.paddingBottom,10)||0;this.setState({height:height-paddingTop-paddingBottom,width:width-paddingLeft-paddingRight
});onResize({height:height,width:width})}},{key:"_onScroll",value:function _onScroll(event){event.stopPropagation()}},{key:"_setRef",value:function _setRef(autoSizer){this._parentNode=autoSizer&&autoSizer.parentNode}}]);return AutoSizer}(_react.Component);AutoSizer.propTypes={children:_react.PropTypes.func.isRequired,disableHeight:_react.PropTypes.bool,disableWidth:_react.PropTypes.bool,onResize:_react.PropTypes.func.isRequired};AutoSizer.defaultProps={onResize:function onResize(){}};exports.default=AutoSizer},2215:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.AutoSizer=exports.default=undefined;var _AutoSizer2=__webpack_require__(2214);var _AutoSizer3=_interopRequireDefault(_AutoSizer2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_AutoSizer3.default;exports.AutoSizer=_AutoSizer3.default},2216:function(module,exports){"use strict";var _window;if(typeof window!=="undefined"){_window=window}else if(typeof self!=="undefined"){_window=self}else{_window=undefined}var attachEvent=typeof document!=="undefined"&&document.attachEvent;var stylesCreated=false;if(!attachEvent){var requestFrame=function(){var raf=_window.requestAnimationFrame||_window.mozRequestAnimationFrame||_window.webkitRequestAnimationFrame||function(fn){return _window.setTimeout(fn,20)};return function(fn){return raf(fn)}}();var cancelFrame=function(){var cancel=_window.cancelAnimationFrame||_window.mozCancelAnimationFrame||_window.webkitCancelAnimationFrame||_window.clearTimeout;return function(id){return cancel(id)}}();var resetTriggers=function resetTriggers(element){var triggers=element.__resizeTriggers__,expand=triggers.firstElementChild,contract=triggers.lastElementChild,expandChild=expand.firstElementChild;contract.scrollLeft=contract.scrollWidth;contract.scrollTop=contract.scrollHeight;expandChild.style.width=expand.offsetWidth+1+"px";expandChild.style.height=expand.offsetHeight+1+"px";expand.scrollLeft=expand.scrollWidth;expand.scrollTop=expand.scrollHeight};var checkTriggers=function checkTriggers(element){return element.offsetWidth!=element.__resizeLast__.width||element.offsetHeight!=element.__resizeLast__.height};var scrollListener=function scrollListener(e){var element=this;resetTriggers(this);if(this.__resizeRAF__)cancelFrame(this.__resizeRAF__);this.__resizeRAF__=requestFrame(function(){if(checkTriggers(element)){element.__resizeLast__.width=element.offsetWidth;element.__resizeLast__.height=element.offsetHeight;element.__resizeListeners__.forEach(function(fn){fn.call(element,e)})}})};var animation=false,animationstring="animation",keyframeprefix="",animationstartevent="animationstart",domPrefixes="Webkit Moz O ms".split(" "),startEvents="webkitAnimationStart animationstart oAnimationStart MSAnimationStart".split(" "),pfx="";{var elm=document.createElement("fakeelement");if(elm.style.animationName!==undefined){animation=true}if(animation===false){for(var i=0;i<domPrefixes.length;i++){if(elm.style[domPrefixes[i]+"AnimationName"]!==undefined){pfx=domPrefixes[i];animationstring=pfx+"Animation";keyframeprefix="-"+pfx.toLowerCase()+"-";animationstartevent=startEvents[i];animation=true;break}}}}var animationName="resizeanim";var animationKeyframes="@"+keyframeprefix+"keyframes "+animationName+" { from { opacity: 0; } to { opacity: 0; } } ";var animationStyle=keyframeprefix+"animation: 1ms "+animationName+"; "}var createStyles=function createStyles(){if(!stylesCreated){var css=(animationKeyframes?animationKeyframes:"")+".resize-triggers { "+(animationStyle?animationStyle:"")+"visibility: hidden; opacity: 0; } "+'.resize-triggers, .resize-triggers > div, .contract-trigger:before { content: " "; display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; } .resize-triggers > div { background: #eee; overflow: auto; } .contract-trigger:before { width: 200%; height: 200%; }',head=document.head||document.getElementsByTagName("head")[0],style=document.createElement("style");style.type="text/css";if(style.styleSheet){style.styleSheet.cssText=css}else{style.appendChild(document.createTextNode(css))}head.appendChild(style);stylesCreated=true}};var addResizeListener=function addResizeListener(element,fn){if(attachEvent)element.attachEvent("onresize",fn);else{if(!element.__resizeTriggers__){if(getComputedStyle(element).position=="static")element.style.position="relative";createStyles();element.__resizeLast__={};element.__resizeListeners__=[];(element.__resizeTriggers__=document.createElement("div")).className="resize-triggers";element.__resizeTriggers__.innerHTML='<div class="expand-trigger"><div></div></div>'+'<div class="contract-trigger"></div>';element.appendChild(element.__resizeTriggers__);resetTriggers(element);element.addEventListener("scroll",scrollListener,true);animationstartevent&&element.__resizeTriggers__.addEventListener(animationstartevent,function(e){if(e.animationName==animationName)resetTriggers(element)})}element.__resizeListeners__.push(fn)}};var removeResizeListener=function removeResizeListener(element,fn){if(attachEvent)element.detachEvent("onresize",fn);else{element.__resizeListeners__.splice(element.__resizeListeners__.indexOf(fn),1);if(!element.__resizeListeners__.length){element.removeEventListener("scroll",scrollListener,true);element.__resizeTriggers__=!element.removeChild(element.__resizeTriggers__)}}};module.exports={addResizeListener:addResizeListener,removeResizeListener:removeResizeListener}},2218:function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;(function(global,factory){if(true){!(__WEBPACK_AMD_DEFINE_ARRAY__=[exports,module],__WEBPACK_AMD_DEFINE_FACTORY__=factory,__WEBPACK_AMD_DEFINE_RESULT__=typeof __WEBPACK_AMD_DEFINE_FACTORY__==="function"?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}else if(typeof exports!=="undefined"&&typeof module!=="undefined"){factory(exports,module)}else{var mod={exports:{}};factory(mod.exports,mod);global.autosize=mod.exports}})(this,function(exports,module){"use strict";var set=typeof Set==="function"?new Set:function(){var list=[];return{has:function has(key){return Boolean(list.indexOf(key)>-1)},add:function add(key){list.push(key)},delete:function _delete(key){list.splice(list.indexOf(key),1)}}}();var createEvent=function createEvent(name){return new Event(name)};try{new Event("test")}catch(e){createEvent=function(name){var evt=document.createEvent("Event");evt.initEvent(name,true,false);return evt}}function assign(ta){var _ref=arguments[1]===undefined?{}:arguments[1];var _ref$setOverflowX=_ref.setOverflowX;var setOverflowX=_ref$setOverflowX===undefined?true:_ref$setOverflowX;var _ref$setOverflowY=_ref.setOverflowY;var setOverflowY=_ref$setOverflowY===undefined?true:_ref$setOverflowY;if(!ta||!ta.nodeName||ta.nodeName!=="TEXTAREA"||set.has(ta))return;var heightOffset=null;var overflowY=null;var clientWidth=ta.clientWidth;function init(){var style=window.getComputedStyle(ta,null);overflowY=style.overflowY;if(style.resize==="vertical"){ta.style.resize="none"}else if(style.resize==="both"){ta.style.resize="horizontal"}if(style.boxSizing==="content-box"){heightOffset=-(parseFloat(style.paddingTop)+parseFloat(style.paddingBottom))}else{heightOffset=parseFloat(style.borderTopWidth)+parseFloat(style.borderBottomWidth)}if(isNaN(heightOffset)){heightOffset=0}update()}function changeOverflow(value){{var width=ta.style.width;ta.style.width="0px";ta.offsetWidth;ta.style.width=width}overflowY=value;if(setOverflowY){ta.style.overflowY=value}resize()}function resize(){var htmlTop=window.pageYOffset;var bodyTop=document.body.scrollTop;var originalHeight=ta.style.height;ta.style.height="auto";var endHeight=ta.scrollHeight+heightOffset;if(ta.scrollHeight===0){ta.style.height=originalHeight;return}ta.style.height=endHeight+"px";clientWidth=ta.clientWidth;document.documentElement.scrollTop=htmlTop;document.body.scrollTop=bodyTop}function update(){var startHeight=ta.style.height;resize();var style=window.getComputedStyle(ta,null);if(style.height!==ta.style.height){if(overflowY!=="visible"){changeOverflow("visible")}}else{if(overflowY!=="hidden"){changeOverflow("hidden")}}if(startHeight!==ta.style.height){var evt=createEvent("autosize:resized");ta.dispatchEvent(evt)}}var pageResize=function pageResize(){if(ta.clientWidth!==clientWidth){update()}};var destroy=function(style){window.removeEventListener("resize",pageResize,false);ta.removeEventListener("input",update,false);ta.removeEventListener("keyup",update,false);ta.removeEventListener("autosize:destroy",destroy,false);ta.removeEventListener("autosize:update",update,false);set["delete"](ta);Object.keys(style).forEach(function(key){ta.style[key]=style[key]})}.bind(ta,{height:ta.style.height,resize:ta.style.resize,overflowY:ta.style.overflowY,overflowX:ta.style.overflowX,wordWrap:ta.style.wordWrap});ta.addEventListener("autosize:destroy",destroy,false);if("onpropertychange"in ta&&"oninput"in ta){ta.addEventListener("keyup",update,false)}window.addEventListener("resize",pageResize,false);ta.addEventListener("input",update,false);ta.addEventListener("autosize:update",update,false);set.add(ta);if(setOverflowX){ta.style.overflowX="hidden";ta.style.wordWrap="break-word"}init()}function destroy(ta){if(!(ta&&ta.nodeName&&ta.nodeName==="TEXTAREA"))return;var evt=createEvent("autosize:destroy");ta.dispatchEvent(evt)}function update(ta){if(!(ta&&ta.nodeName&&ta.nodeName==="TEXTAREA"))return;var evt=createEvent("autosize:update");ta.dispatchEvent(evt)}var autosize=null;if(typeof window==="undefined"||typeof window.getComputedStyle!=="function"){autosize=function(el){return el};autosize.destroy=function(el){return el};autosize.update=function(el){return el}}else{autosize=function(el,options){if(el){Array.prototype.forEach.call(el.length?el:[el],function(x){return assign(x,options)})}return el};autosize.destroy=function(el){if(el){Array.prototype.forEach.call(el.length?el:[el],destroy)}return el};autosize.update=function(el){if(el){Array.prototype.forEach.call(el.length?el:[el],update)}return el}}module.exports=autosize})},2223:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);var _keys=__webpack_require__(39);var _keys2=_interopRequireDefault(_keys);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _debug=__webpack_require__(3);var _debug2=_interopRequireDefault(_debug);var _assign=__webpack_require__(34);var _assign2=_interopRequireDefault(_assign);var _pick=__webpack_require__(91);var _pick2=_interopRequireDefault(_pick);var _omit=__webpack_require__(18);var _omit2=_interopRequireDefault(_omit);var _shortcode=__webpack_require__(2229);var _shortcode2=_interopRequireDefault(_shortcode);var _shortcode3=__webpack_require__(1719);var _utils=__webpack_require__(1647);var _utils2=_interopRequireDefault(_utils);var _constants=__webpack_require__(1716);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var debug=(0,_debug2.default)("calypso:gallery-shortcode");exports.default=_react2.default.createClass({displayName:"GalleryShortcode",propTypes:{siteId:_react.PropTypes.number.isRequired,children:_react.PropTypes.string,items:_react.PropTypes.array,type:_react.PropTypes.string,columns:_react.PropTypes.number,orderBy:_react.PropTypes.string,link:_react.PropTypes.string,size:_react.PropTypes.string,className:_react.PropTypes.string},getDefaultProps:function getDefaultProps(){return _constants.GalleryDefaultAttrs},filterRenderResult:function filterRenderResult(rendered){if(!rendered.body&&!rendered.scripts&&!rendered.styles){return rendered}var filtered=(0,_assign2.default)({},rendered,{scripts:{"tiled-gallery":{src:"https://s0.wp.com/wp-content/mu-plugins/tiled-gallery/tiled-gallery.js"}},styles:{"tiled-gallery":{src:"https://s0.wp.com/wp-content/mu-plugins/tiled-gallery/tiled-gallery.css"},"gallery-styles":{src:"https://widgets.wp.com/gallery-preview/style.css"}}});if("slideshow"===this.getAttributes().type){(0,_assign2.default)(filtered,{scripts:{"jquery-cycle":{src:"https://s0.wp.com/wp-content/mu-plugins/shortcodes/js/jquery.cycle.js"},"jetpack-slideshow":{src:"https://s0.wp.com/wp-content/mu-plugins/shortcodes/js/slideshow-shortcode.js",extra:'var jetpackSlideshowSettings = { "spinner": "https://s0.wp.com/wp-content/mu-plugins/shortcodes/img/slideshow-loader.gif" };'}},styles:{"jetpack-slideshow":{src:"https://s0.wp.com/wp-content/mu-plugins/shortcodes/css/slideshow-shortcode.css"}}})}return filtered},getAttributes:function getAttributes(){var attributes=(0,_pick2.default)(this.props,"items","type","columns","orderBy","link","size");if(this.props.children){(0,_assign2.default)(attributes,(0,_shortcode3.parse)(this.props.children).attrs.named)}return attributes},getShortcode:function getShortcode(){if(this.props.children){return this.props.children}return _utils2.default.generateGalleryShortcode(this.getAttributes())},render:function render(){var shortcode=this.getShortcode();if(!shortcode){return null}var classes=(0,_classnames2.default)("gallery-shortcode",this.props.className);debug(shortcode);return _react2.default.createElement(_shortcode2.default,(0,_extends3.default)({},(0,_omit2.default)(this.props,(0,_keys2.default)(this.constructor.propTypes)),{siteId:this.props.siteId,filterRenderResult:this.filterRenderResult,className:classes}),shortcode)}});module.exports=exports["default"]},2224:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);var _keys=__webpack_require__(39);var _keys2=_interopRequireDefault(_keys);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _omit=__webpack_require__(18);var _omit2=_interopRequireDefault(_omit);var _noop=__webpack_require__(38);var _noop2=_interopRequireDefault(_noop);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var LoadStatus={PENDING:"PENDING",LOADING:"LOADING",LOADED:"LOADED",FAILED:"FAILED"};exports.default=_react2.default.createClass({displayName:"ImagePreloader",propTypes:{src:_react2.default.PropTypes.string,placeholder:_react2.default.PropTypes.element.isRequired,children:_react2.default.PropTypes.node,onLoad:_react2.default.PropTypes.func,onError:_react2.default.PropTypes.func},getInitialState:function getInitialState(){return{status:LoadStatus.PENDING}},componentWillMount:function componentWillMount(){this.createLoader()},componentWillReceiveProps:function componentWillReceiveProps(nextProps){if(nextProps.src!==this.props.src){this.createLoader(nextProps)}},componentWillUnmount:function componentWillUnmount(){this.destroyLoader()},createLoader:function createLoader(nextProps){var src=(nextProps||this.props).src;this.destroyLoader();this.setState({status:LoadStatus.LOADING});if(!src){return}this.image=new Image;this.image.src=src;this.image.onload=this.onLoadComplete;this.image.onerror=this.onLoadComplete},destroyLoader:function destroyLoader(){if(!this.image){return}this.image.onload=_noop2.default;this.image.onerror=_noop2.default;delete this.image},onLoadComplete:function onLoadComplete(event){var _this=this;this.destroyLoader();if(event.type!=="load"){return this.setState({status:LoadStatus.FAILED},function(){if(_this.props.onError){_this.props.onError(event)}})}this.setState({status:LoadStatus.LOADED},function(){if(_this.props.onLoad){_this.props.onLoad(event)}})},render:function render(){var children=void 0,imageProps=void 0;switch(this.state.status){case LoadStatus.LOADING:children=this.props.placeholder;break;case LoadStatus.LOADED:imageProps=(0,_omit2.default)(this.props,(0,_keys2.default)(this.constructor.propTypes));children=_react2.default.createElement("img",(0,_extends3.default)({src:this.props.src},imageProps));break;case LoadStatus.FAILED:children=this.props.children;break;default:break}return _react2.default.createElement("div",{className:"image-preloader"},children)}});module.exports=exports["default"]},2226:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _i18nCalypso=__webpack_require__(11);var _i18nCalypso2=_interopRequireDefault(_i18nCalypso);var _inputChrono=__webpack_require__(2521);var _inputChrono2=_interopRequireDefault(_inputChrono);var _datePicker=__webpack_require__(2511);var _datePicker2=_interopRequireDefault(_datePicker);var _user=__webpack_require__(48);var _user2=_interopRequireDefault(_user);var _clock=__webpack_require__(2525);var _clock2=_interopRequireDefault(_clock);var _header=__webpack_require__(2527);var _header2=_interopRequireDefault(_header);var _utils=__webpack_require__(2055);var _utils2=_interopRequireDefault(_utils);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var user=new _user2.default,noop=function noop(){};var PostSchedule=function(_Component){(0,_inherits3.default)(PostSchedule,_Component);function PostSchedule(props){(0,_classCallCheck3.default)(this,PostSchedule);var _this=(0,_possibleConstructorReturn3.default)(this,(PostSchedule.__proto__||(0,_getPrototypeOf2.default)(PostSchedule)).call(this,props));_this.updateDate=_this.updateDate.bind(_this);_this.setViewDate=_this.setViewDate.bind(_this);_this.setCurrentMonth=_this.setCurrentMonth.bind(_this);_this.state={calendarViewDate:_i18nCalypso2.default.moment(_this.props.selectedDay?_this.props.selectedDay:new Date)};return _this}(0,_createClass3.default)(PostSchedule,[{key:"componentWillMount",value:function componentWillMount(){if(!this.props.selectedDay){return this.setState({localizedDate:null})}this.setState({localizedDate:this.getDateToUserLocation(this.props.selectedDay)})}},{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){if(this.props.selectedDay===nextProps.selectedDay){return}if(!nextProps.selectedDay){return this.setState({localizedDate:null})}this.setState({localizedDate:this.getDateToUserLocation(nextProps.selectedDay)})}},{key:"locale",value:function locale(){return{formatMonthTitle:function formatMonthTitle(){return}}}},{key:"events",value:function events(){return this.props.events.concat(this.getEventsFromPosts(this.props.posts))}},{key:"getEventsFromPosts",value:function getEventsFromPosts(){var _this2=this;var postsList=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];return postsList.map(function(post){var localDate=_this2.getDateToUserLocation(post.date);return{id:post.ID,title:post.title,date:localDate.toDate()}})}},{key:"getDateToUserLocation",value:function getDateToUserLocation(date){return _utils2.default.convertDateToUserLocation(date||new Date,this.props.timezone,this.props.gmtOffset)}},{key:"setCurrentMonth",value:function setCurrentMonth(date){date=_i18nCalypso2.default.moment(date);this.props.onMonthChange(date);this.setState({calendarViewDate:date})}},{key:"setViewDate",value:function setViewDate(date){this.setState({calendarViewDate:_i18nCalypso2.default.moment(date)})}},{key:"getCurrentDate",value:function getCurrentDate(){return _i18nCalypso2.default.moment(this.state.localizedDate||this.getDateToUserLocation())}},{key:"updateDate",value:function updateDate(date){this.setState({calendarViewDate:date});this.props.onDateChange(_utils2.default.convertDateToGivenOffset(date,this.props.timezone,this.props.gmtOffset))}},{key:"renderInputChrono",value:function renderInputChrono(){var lang=user.getLanguage(),date=this.getCurrentDate(),chronoText;if(this.state.localizedDate){var today=_i18nCalypso2.default.moment().startOf("day"),selected=_i18nCalypso2.default.moment(date).startOf("day"),diffInMinutes=selected.diff(today,"days");if(-7<=diffInMinutes&&diffInMinutes<=6){chronoText=date.calendar()}else{chronoText=date.format("L LT")}}return _react2.default.createElement("div",{className:"chrono__container"},_react2.default.createElement(_inputChrono2.default,{value:chronoText,placeholder:date.calendar(),lang:lang?lang.langSlug:null,onSet:this.updateDate}),_react2.default.createElement("hr",{className:"post-schedule__hr"}))}},{key:"renderClock",value:function renderClock(){var date=this.state.localizedDate;if(!date){date=this.getDateToUserLocation(new Date)}return _react2.default.createElement(_clock2.default,{date:date,timezone:this.props.timezone,gmtOffset:this.props.gmtOffset,onChange:this.updateDate})}},{key:"render",value:function render(){return _react2.default.createElement("div",{className:"post-schedule"},_react2.default.createElement(_header2.default,{date:this.state.calendarViewDate,onDateChange:this.setViewDate}),this.renderInputChrono(),_react2.default.createElement(_datePicker2.default,{events:this.events(),locale:this.locale(),selectedDay:this.state.localizedDate?this.state.localizedDate.toDate():null,timeReference:this.getCurrentDate(),calendarViewDate:this.state.calendarViewDate.toDate(),onMonthChange:this.setCurrentMonth,onSelectDay:this.updateDate}),this.renderClock())}}]);return PostSchedule}(_react.Component);PostSchedule.displayName="PostSchedule";PostSchedule.propTypes={events:_react.PropTypes.array,posts:_react.PropTypes.array,timezone:_react.PropTypes.string,gmtOffset:_react.PropTypes.number,onDateChange:_react.PropTypes.func,onMonthChange:_react.PropTypes.func};PostSchedule.defaultProps={posts:[],events:[],onDateChange:noop,onMonthChange:noop};exports.default=PostSchedule;module.exports=exports["default"]},2229:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _omit=__webpack_require__(18);var _omit2=_interopRequireDefault(_omit);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _store=__webpack_require__(2281);var _store2=_interopRequireDefault(_store);var _actions=__webpack_require__(2655);var ShortcodesActions=_interopRequireWildcard(_actions);var _data=__webpack_require__(2534);var _data2=_interopRequireDefault(_data);var _frame=__webpack_require__(2535);var _frame2=_interopRequireDefault(_frame);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"Shortcode",propTypes:{siteId:_react.PropTypes.number.isRequired,children:_react.PropTypes.string.isRequired,filterRenderResult:_react.PropTypes.func,className:_react.PropTypes.string},componentDidMount:function componentDidMount(){this.fetchRendered();this.listener=_store2.default.addListener(this.fetchRendered)},componentDidUpdate:function componentDidUpdate(){this.fetchRendered()},componentWillUnmount:function componentWillUnmount(){this.clearFetchTimeout();if(this.listener){this.listener.remove()}},fetchRendered:function fetchRendered(){var _this=this;var _props=this.props;var siteId=_props.siteId;var shortcode=_props.children;if(_store2.default.get(siteId,shortcode)){return}this.clearFetchTimeout();this.fetchTimeout=setTimeout(function(){_this.clearFetchTimeout();ShortcodesActions.fetch(siteId,shortcode)},0)},clearFetchTimeout:function clearFetchTimeout(){clearTimeout(this.fetchTimeout);this.fetchTimeout=null},render:function render(){var _props2=this.props;var siteId=_props2.siteId;var className=_props2.className;var filterRenderResult=_props2.filterRenderResult;var children=_props2.children;var classes=(0,_classnames2.default)("shortcode",className);return _react2.default.createElement(_data2.default,{siteId:siteId,shortcode:children,filterRenderResult:filterRenderResult},_react2.default.createElement(_frame2.default,(0,_extends3.default)({},(0,_omit2.default)(this.props,"siteId","filterRenderResult"),{className:classes})))}});module.exports=exports["default"]},2230:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(type){return labels.hasOwnProperty(type)?labels[type].call():null};var _i18nCalypso=__webpack_require__(11);var _i18nCalypso2=_interopRequireDefault(_i18nCalypso);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var labels={name:function name(){return _i18nCalypso2.default.translate("Name")},email:function email(){return _i18nCalypso2.default.translate("Email Address")},checkbox:function checkbox(){return _i18nCalypso2.default.translate("Checkbox")},select:function select(){return _i18nCalypso2.default.translate("Dropdown")},radio:function radio(){return _i18nCalypso2.default.translate("Radio Button")},text:function text(){return _i18nCalypso2.default.translate("Text")},textarea:function textarea(){return _i18nCalypso2.default.translate("Text Area")},url:function url(){return _i18nCalypso2.default.translate("Web Address")}};module.exports=exports["default"]},2231:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.validateFormFields=validateFormFields;exports.validateSettingsToEmail=validateSettingsToEmail;var _every=__webpack_require__(218);var _every2=_interopRequireDefault(_every);var _emailValidator=__webpack_require__(1732);var _emailValidator2=_interopRequireDefault(_emailValidator);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function validateFormFields(fields){if(!Array.isArray(fields)||fields.length===0){return false}return(0,_every2.default)(fields,function(field){if(field.type!=="radio"&&field.type!=="select"){return!!field.label}return!!field.label&&!!field.options})}function validateSettingsToEmail(to){var emails=to?to.split(",").map(function(email){return email.trim()}):[];return(0,_every2.default)(emails,_emailValidator2.default.validate)}},2232:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.serialize=serialize;exports.deserialize=deserialize;var _pickBy=__webpack_require__(213);var _pickBy2=_interopRequireDefault(_pickBy);var _shortcode=__webpack_require__(1719);var _shortcode2=_interopRequireDefault(_shortcode);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function serialize(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var to=_ref.to;var subject=_ref.subject;var _ref$fields=_ref.fields;var fields=_ref$fields===undefined?[]:_ref$fields;var content=fields.map(function(_ref2){var label=_ref2.label;var type=_ref2.type;var options=_ref2.options;var required=_ref2.required;if(!label||!type){return}var fieldShortcode={tag:"contact-field",type:"self-closing",attrs:(0,_pickBy2.default)({label:label,type:type,options:options})};if(required){fieldShortcode.attrs.required=1}return _shortcode2.default.stringify(fieldShortcode)}).join("");return _shortcode2.default.stringify({tag:"contact-form",type:"closed",content:content,attrs:(0,_pickBy2.default)({to:to,subject:subject})})}function deserialize(shortcode){if(!shortcode){return null}var parsed=_shortcode2.default.parse(shortcode);if(parsed){return function(_ref3){var _ref3$attrs=_ref3.attrs;_ref3$attrs=_ref3$attrs===undefined?{}:_ref3$attrs;var _ref3$attrs$named=_ref3$attrs.named;_ref3$attrs$named=_ref3$attrs$named===undefined?{}:_ref3$attrs$named;var to=_ref3$attrs$named.to;var subject=_ref3$attrs$named.subject;var content=_ref3.content;var fields=[];var parsedField=void 0;while(content&&(parsedField=_shortcode2.default.next("contact-field",content))){if("attrs"in parsedField.shortcode){var _parsedField$shortcod=parsedField.shortcode.attrs.named;var label=_parsedField$shortcod.label;var type=_parsedField$shortcod.type;var options=_parsedField$shortcod.options;var required=_parsedField$shortcod.required;var field=(0,_pickBy2.default)({label:label,type:type,options:options,required:required});if("required"in field){field.required=true}fields.push(field)}content=content.slice(parsedField.index+parsedField.content.length)}return(0,_pickBy2.default)({to:to,subject:subject,fields:fields})}(parsed)}return{}}},2233:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"ContactFormViewPreviewRequired",render:function render(){if(this.props.required){return _react2.default.createElement("em",null,"(",this.translate("required"),")")}return null}});module.exports=exports["default"]},2239:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=generateEmbedFrameMarkup;var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _server=__webpack_require__(1800);var _reactAddonsCreateFragment=__webpack_require__(745);var _reactAddonsCreateFragment2=_interopRequireDefault(_reactAddonsCreateFragment);var _mapValues=__webpack_require__(93);var _mapValues2=_interopRequireDefault(_mapValues);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var JQUERY_URL="https://s0.wp.com/wp-includes/js/jquery/jquery.js";function generateEmbedFrameMarkup(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var body=_ref.body;var scripts=_ref.scripts;var styles=_ref.styles;if(!body&&!scripts&&!styles){return""}return(0,_server.renderToStaticMarkup)(_react2.default.createElement("html",null,_react2.default.createElement("head",null,(0,_reactAddonsCreateFragment2.default)((0,_mapValues2.default)(styles,function(style){return _react2.default.createElement("link",{rel:"stylesheet",media:style.media,href:style.src})})),_react2.default.createElement("style",{dangerouslySetInnerHTML:{__html:"a { cursor: default; }"}})),_react2.default.createElement("body",{style:{margin:0}},_react2.default.createElement("div",{dangerouslySetInnerHTML:{__html:body}}),_react2.default.createElement("script",{src:JQUERY_URL}),_react2.default.createElement("script",{dangerouslySetInnerHTML:{__html:"\n\t\t\t\t\t[ 'click', 'dragstart' ].forEach( function( type ) {\n\t\t\t\t\t\tdocument.addEventListener( type, function( event ) {\n\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\tevent.stopImmediatePropagation();\n\t\t\t\t\t\t}, true );\n\t\t\t\t\t} );\n\t\t\t\t"}}),(0,_reactAddonsCreateFragment2.default)((0,_mapValues2.default)(scripts,function(script){var extra=void 0;if(script.extra){extra=_react2.default.createElement("script",{dangerouslySetInnerHTML:{
__html:script.extra}})}return(0,_reactAddonsCreateFragment2.default)({extra:extra,script:_react2.default.createElement("script",{src:script.src})})})))))}module.exports=exports["default"]},2240:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _defineProperty2=__webpack_require__(7);var _defineProperty3=_interopRequireDefault(_defineProperty2);var _assign=__webpack_require__(5);var _assign2=_interopRequireDefault(_assign);var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _utils=__webpack_require__(1940);var _dispatcher=__webpack_require__(42);var _dispatcher2=_interopRequireDefault(_dispatcher);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var PostEditEmbedsStore=function(_ReduceStore){(0,_inherits3.default)(PostEditEmbedsStore,_ReduceStore);function PostEditEmbedsStore(){(0,_classCallCheck3.default)(this,PostEditEmbedsStore);return(0,_possibleConstructorReturn3.default)(this,(PostEditEmbedsStore.__proto__||(0,_getPrototypeOf2.default)(PostEditEmbedsStore)).apply(this,arguments))}(0,_createClass3.default)(PostEditEmbedsStore,[{key:"getInitialState",value:function getInitialState(){return{}}},{key:"get",value:function get(url){var embedState=this.getState()[url];return embedState?embedState:{}}},{key:"reduce",value:function reduce(state,action){action=action.action;switch(action.type){case"STOP_EDITING_POST":state={};break;case"FETCH_EMBED":state=(0,_assign2.default)({},state,(0,_defineProperty3.default)({},action.url,{status:"LOADING"}));break;case"RECEIVE_EMBED":if(action.error){state=(0,_assign2.default)({},state,(0,_defineProperty3.default)({},action.url,{status:"ERROR"}))}else if(action.data){state=(0,_assign2.default)({},state,(0,_defineProperty3.default)({},action.url,{status:"LOADED",body:action.data.result,scripts:action.data.scripts,styles:action.data.styles}))}break}return state}}]);return PostEditEmbedsStore}(_utils.ReduceStore);exports.default=new PostEditEmbedsStore(_dispatcher2.default);module.exports=exports["default"]},2280:function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var ActionTypes=exports.ActionTypes={FETCH_SHORTCODE:"FETCH_SHORTCODE",RECEIVE_SHORTCODE:"RECEIVE_SHORTCODE"};var LoadStatus=exports.LoadStatus={LOADING:"LOADING",ERROR:"ERROR",LOADED:"LOADED"}},2281:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _defineProperty2=__webpack_require__(7);var _defineProperty3=_interopRequireDefault(_defineProperty2);var _assign=__webpack_require__(5);var _assign2=_interopRequireDefault(_assign);var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _utils=__webpack_require__(1940);var _pickBy=__webpack_require__(213);var _pickBy2=_interopRequireDefault(_pickBy);var _intersection=__webpack_require__(768);var _intersection2=_interopRequireDefault(_intersection);var _dispatcher=__webpack_require__(42);var _dispatcher2=_interopRequireDefault(_dispatcher);var _shortcode=__webpack_require__(1719);var _shortcode2=_interopRequireDefault(_shortcode);var _constants=__webpack_require__(2280);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ShortcodesStore=function(_ReduceStore){(0,_inherits3.default)(ShortcodesStore,_ReduceStore);function ShortcodesStore(){(0,_classCallCheck3.default)(this,ShortcodesStore);return(0,_possibleConstructorReturn3.default)(this,(ShortcodesStore.__proto__||(0,_getPrototypeOf2.default)(ShortcodesStore)).apply(this,arguments))}(0,_createClass3.default)(ShortcodesStore,[{key:"getInitialState",value:function getInitialState(){return{}}},{key:"get",value:function get(siteId,shortcode){var state=this.getState();if(!state[siteId]||!state[siteId][shortcode]){return}return state[siteId][shortcode]}},{key:"reduce",value:function reduce(state,action){action=action.action;(function(){switch(action.type){case _constants.ActionTypes.FETCH_SHORTCODE:state=(0,_assign2.default)({},state,(0,_defineProperty3.default)({},action.payload.siteId,(0,_assign2.default)({},state[action.payload.siteId],(0,_defineProperty3.default)({},action.payload.shortcode,{status:_constants.LoadStatus.LOADING}))));break;case _constants.ActionTypes.RECEIVE_SHORTCODE:state=(0,_assign2.default)({},state,(0,_defineProperty3.default)({},action.payload.siteId,(0,_assign2.default)({},state[action.payload.siteId],(0,_defineProperty3.default)({},action.payload.shortcode,{status:action.error?_constants.LoadStatus.ERROR:_constants.LoadStatus.LOADED}))));if(!action.error){(0,_assign2.default)(state[action.payload.siteId][action.payload.shortcode],{body:action.payload.data.result,scripts:action.payload.data.scripts,styles:action.payload.data.styles})}break;case"RECEIVE_MEDIA_ITEMS":case"RECEIVE_MEDIA_ITEM":if(!state.hasOwnProperty(action.siteId)){break}var media=void 0;if(Array.isArray(action.data.media)){media=action.data.media}else{media=[action.data]}var updatedIds=media.map(function(item){return item.ID.toString()});state=(0,_assign2.default)({},state,(0,_defineProperty3.default)({},action.siteId,(0,_pickBy2.default)(state[action.siteId],function(status,shortcode){var parsed=_shortcode2.default.parse(shortcode);if(parsed.tag!=="gallery"||!parsed.attrs.named||!parsed.attrs.named.ids){return true}var ids=parsed.attrs.named.ids.split(",");return!(0,_intersection2.default)(ids,updatedIds).length})));break}})();return state}}]);return ShortcodesStore}(_utils.ReduceStore);exports.default=new ShortcodesStore(_dispatcher2.default);module.exports=exports["default"]},2313:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _snakeCase2=__webpack_require__(305);var _snakeCase3=_interopRequireDefault(_snakeCase2);var _reduce2=__webpack_require__(117);var _reduce3=_interopRequireDefault(_reduce2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _mixin=__webpack_require__(111);var _mixin2=_interopRequireDefault(_mixin);var _selector=__webpack_require__(2873);var _selector2=_interopRequireDefault(_selector);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"PostSelector",mixins:[_mixin2.default],propTypes:{type:_react.PropTypes.string,siteId:_react.PropTypes.number.isRequired,status:_react.PropTypes.string,multiple:_react.PropTypes.bool,onChange:_react.PropTypes.func,selected:_react.PropTypes.number,excludeTree:_react.PropTypes.number,emptyMessage:_react.PropTypes.string,createLink:_react.PropTypes.string,orderBy:_react.PropTypes.oneOf(["title","date","modified","comment_count","ID"]),order:_react.PropTypes.oneOf(["ASC","DESC"]),showTypeLabels:_react.PropTypes.bool},getDefaultProps:function getDefaultProps(){return{type:"post",status:"publish,private",multiple:false,orderBy:"title",order:"ASC"}},getInitialState:function getInitialState(){return{search:""}},onSearch:function onSearch(term){if(term!==this.state.search){this.setState({search:term})}},getQuery:function getQuery(){var _props=this.props;var type=_props.type;var status=_props.status;var excludeTree=_props.excludeTree;var orderBy=_props.orderBy;var order=_props.order;var search=this.state.search;return(0,_reduce3.default)({type:type,status:status,excludeTree:excludeTree,orderBy:orderBy,order:order,search:search},function(memo,value,key){if(null===value||undefined===value){return memo}memo[(0,_snakeCase3.default)(key)]=value;return memo},{})},render:function render(){var _props2=this.props;var siteId=_props2.siteId;var multiple=_props2.multiple;var onChange=_props2.onChange;var emptyMessage=_props2.emptyMessage;var createLink=_props2.createLink;var selected=_props2.selected;var showTypeLabels=_props2.showTypeLabels;return _react2.default.createElement(_selector2.default,{siteId:siteId,query:this.getQuery(),onSearch:this.onSearch,multiple:multiple,onChange:onChange,emptyMessage:emptyMessage,createLink:createLink,selected:selected,showTypeLabels:showTypeLabels})}});module.exports=exports["default"]},2339:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _noop=__webpack_require__(38);var _noop2=_interopRequireDefault(_noop);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _button=__webpack_require__(69);var _button2=_interopRequireDefault(_button);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"EditorDrawerWell",propTypes:{icon:_react.PropTypes.string,label:_react.PropTypes.node,empty:_react.PropTypes.bool,disabled:_react.PropTypes.bool,onClick:_react.PropTypes.func,onRemove:_react.PropTypes.func,children:_react.PropTypes.node},getDefaultProps:function getDefaultProps(){return{disabled:false,onClick:_noop2.default,onRemove:_noop2.default}},render:function render(){var _props=this.props;var empty=_props.empty;var onRemove=_props.onRemove;var onClick=_props.onClick;var disabled=_props.disabled;var icon=_props.icon;var label=_props.label;var children=_props.children;var classes=(0,_classnames2.default)("editor-drawer-well",{"is-empty":empty});return _react2.default.createElement("div",{className:classes},_react2.default.createElement("div",{className:"editor-drawer-well__content"},children,onRemove&&_react2.default.createElement(_button2.default,{onClick:onRemove,className:"editor-drawer-well__remove"},_react2.default.createElement("span",{className:"screen-reader-text"},this.translate("Remove")),_react2.default.createElement(_gridicon2.default,{icon:"cross",size:24,className:"editor-drawer-well__remove-icon"}))),empty&&_react2.default.createElement("button",{type:"button",onClick:onClick,disabled:disabled,className:"editor-drawer-well__placeholder"},icon&&_react2.default.createElement(_gridicon2.default,{icon:icon,className:"editor-drawer-well__icon"}),_react2.default.createElement("span",{className:"editor-drawer-well__button button is-secondary"},label)))}});module.exports=exports["default"]},2340:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _mediaLibrarySelectedData=__webpack_require__(1878);var _mediaLibrarySelectedData2=_interopRequireDefault(_mediaLibrarySelectedData);var _mediaModal=__webpack_require__(2345);var _mediaModal2=_interopRequireDefault(_mediaModal);var _actions=__webpack_require__(1648);var _actions2=_interopRequireDefault(_actions);var _utils=__webpack_require__(1649);var _utils2=_interopRequireDefault(_utils);var _stats=__webpack_require__(1651);var stats=_interopRequireWildcard(_stats);var _previewContainer=__webpack_require__(3113);var _previewContainer2=_interopRequireDefault(_previewContainer);var _button=__webpack_require__(69);var _button2=_interopRequireDefault(_button);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"EditorFeaturedImage",propTypes:{maxWidth:_react2.default.PropTypes.number,site:_react2.default.PropTypes.object,post:_react2.default.PropTypes.object,selecting:_react2.default.PropTypes.bool,onImageSelected:_react2.default.PropTypes.func},getDefaultProps:function getDefaultProps(){return{maxWidth:450,onImageSelected:function onImageSelected(){}}},getInitialState:function getInitialState(){return{isSelecting:false}},showMediaModal:function showMediaModal(){this.setState({isSelecting:true})},hideMediaModal:function hideMediaModal(){this.setState({isSelecting:false})},setImage:function setImage(items){this.hideMediaModal();this.props.onImageSelected();if(!items||!items.length){return}_actions2.default.edit({featured_image:items[0].ID});stats.recordStat("featured_image_set");stats.recordEvent("Featured image set")},renderMediaModal:function renderMediaModal(){if(!this.props.site){return}return _react2.default.createElement(_mediaLibrarySelectedData2.default,{siteId:this.props.site.ID},_react2.default.createElement(_mediaModal2.default,{visible:this.props.selecting||this.state.isSelecting,onClose:this.setImage,site:this.props.site,labels:{confirm:this.translate("Set Featured Image")},enabledFilters:["images"],single:true}))},renderCurrentImage:function renderCurrentImage(){if(!this.props.site||!this.props.post){return}var itemId=_utils2.default.getFeaturedImageId(this.props.post);if(!itemId){return}return _react2.default.createElement(_previewContainer2.default,{siteId:this.props.site.ID,itemId:itemId,maxWidth:this.props.maxWidth})},render:function render(){var classes=(0,_classnames2.default)("editor-featured-image",{"is-assigned":!!_utils2.default.getFeaturedImageId(this.props.post)});return _react2.default.createElement(_button2.default,{onClick:this.showMediaModal,borderless:true,className:classes},this.renderMediaModal(),_react2.default.createElement("div",{className:"editor-featured-image__current-image"},this.renderCurrentImage(),_react2.default.createElement(_gridicon2.default,{icon:"pencil",className:"editor-featured-image__edit-icon"})))}});module.exports=exports["default"]},2341:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1),classNames=__webpack_require__(10);module.exports=React.createClass({displayName:"EditorFieldset",propTypes:{legend:React.PropTypes.oneOfType([React.PropTypes.string,React.PropTypes.element]).isRequired},renderChildren:function renderChildren(){return React.Children.map(this.props.children,function(child){return React.createElement("div",{className:"editor-fieldset__option"},child)})},render:function render(){return React.createElement("fieldset",{className:classNames("editor-fieldset",this.props.className)},React.createElement("legend",{className:"editor-fieldset__legend"},this.props.legend),this.renderChildren())}})},2342:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _defineProperty2=__webpack_require__(7);var _defineProperty3=_interopRequireDefault(_defineProperty2);var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _toArray2=__webpack_require__(401);var _toArray3=_interopRequireDefault(_toArray2);var _map2=__webpack_require__(45);var _map3=_interopRequireDefault(_map2);var _findIndex2=__webpack_require__(214);var _findIndex3=_interopRequireDefault(_findIndex2);var _cloneDeep2=__webpack_require__(176);var _cloneDeep3=_interopRequireDefault(_cloneDeep2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactRedux=__webpack_require__(15);var _termTreeSelector=__webpack_require__(2133);var _termTreeSelector2=_interopRequireDefault(_termTreeSelector);var _addTerm=__webpack_require__(2981);var _addTerm2=_interopRequireDefault(_addTerm);var _actions=__webpack_require__(285);var _selectors=__webpack_require__(47);var _selectors2=__webpack_require__(277);var _selectors3=__webpack_require__(112);var _selectors4=__webpack_require__(90);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var EditorTermSelector=function(_Component){(0,_inherits3.default)(EditorTermSelector,_Component);function EditorTermSelector(props){(0,_classCallCheck3.default)(this,EditorTermSelector);var _this=(0,_possibleConstructorReturn3.default)(this,(EditorTermSelector.__proto__||(0,_getPrototypeOf2.default)(EditorTermSelector)).call(this,props));_this.boundOnTermsChange=_this.onTermsChange.bind(_this);return _this}(0,_createClass3.default)(EditorTermSelector,[{key:"onTermsChange",value:function onTermsChange(selectedTerm){var _props=this.props;var postTerms=_props.postTerms;var taxonomyName=_props.taxonomyName;var siteId=_props.siteId;var postId=_props.postId;var terms=(0,_cloneDeep3.default)(postTerms)||{};var taxonomyTerms=(0,_toArray3.default)(terms[taxonomyName]);var existingSelectionIndex=(0,_findIndex3.default)(taxonomyTerms,{ID:selectedTerm.ID});if(existingSelectionIndex!==-1){taxonomyTerms.splice(existingSelectionIndex,1)}else{taxonomyTerms.push(selectedTerm)}this.props.editPost(siteId,postId,{terms:(0,_defineProperty3.default)({},taxonomyName,taxonomyTerms)})}},{key:"getSelectedTermIds",value:function getSelectedTermIds(){var _props2=this.props;var postTerms=_props2.postTerms;var taxonomyName=_props2.taxonomyName;var selectedTerms=postTerms?postTerms[taxonomyName]:[];return(0,_map3.default)(selectedTerms,"ID")}},{key:"render",value:function render(){var _props3=this.props;var postType=_props3.postType;var postId=_props3.postId;var siteId=_props3.siteId;var taxonomyName=_props3.taxonomyName;var canEditTerms=_props3.canEditTerms;return _react2.default.createElement("div",null,_react2.default.createElement(_termTreeSelector2.default,{analyticsPrefix:"Editor",onChange:this.boundOnTermsChange,selected:this.getSelectedTermIds(),taxonomy:taxonomyName,siteId:siteId,multiple:true}),canEditTerms&&_react2.default.createElement(_addTerm2.default,{taxonomy:taxonomyName,postType:postType,postId:postId}))}}]);return EditorTermSelector}(_react.Component);EditorTermSelector.propTypes={siteId:_react.PropTypes.number,postId:_react.PropTypes.number,postTerms:_react.PropTypes.object,postType:_react.PropTypes.string,taxonomyName:_react.PropTypes.string,canEditTerms:_react.PropTypes.bool};exports.default=(0,_reactRedux.connect)(function(state){var siteId=(0,_selectors.getSelectedSiteId)(state);var postId=(0,_selectors2.getEditorPostId)(state);return{postType:(0,_selectors3.getEditedPostValue)(state,siteId,(0,_selectors2.getEditorPostId)(state),"type"),postTerms:(0,_selectors3.getEditedPostValue)(state,siteId,postId,"terms"),canEditTerms:(0,_selectors4.canCurrentUser)(state,siteId,"manage_categories"),siteId:siteId,postId:postId}},{editPost:_actions.editPost})(EditorTermSelector);module.exports=exports["default"]},2343:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactRedux=__webpack_require__(15);var _i18nCalypso=__webpack_require__(11);var _selectors=__webpack_require__(47);var _selectors2=__webpack_require__(79);var _stats=__webpack_require__(1651);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var EditorThemeHelp=function(_PureComponent){(0,_inherits3.default)(EditorThemeHelp,_PureComponent);function EditorThemeHelp(props){(0,_classCallCheck3.default)(this,EditorThemeHelp);var _this=(0,_possibleConstructorReturn3.default)(this,(EditorThemeHelp.__proto__||(0,_getPrototypeOf2.default)(EditorThemeHelp)).call(this,props));_this.recordClick=_this.recordClick.bind(_this);return _this}(0,_createClass3.default)(EditorThemeHelp,[{key:"recordClick",value:function recordClick(){(0,_stats.recordStat)("clicked_theme_help_link")}},{key:"render",value:function render(){var _props=this.props;var translate=_props.translate;var themeHelpPath=_props.themeHelpPath;var className=_props.className;if(!themeHelpPath){return null}return _react2.default.createElement("a",{className:className,href:themeHelpPath,onClick:this.recordClick},translate("Need help setting up your site?"))}}]);return EditorThemeHelp}(_react.PureComponent);EditorThemeHelp.propTypes={themeHelpPath:_react.PropTypes.string,classname:_react.PropTypes.string};exports.default=(0,_reactRedux.connect)(function(state){var siteId=(0,_selectors.getSelectedSiteId)(state);return{themeHelpPath:(0,_selectors2.getSiteThemeShowcasePath)(state,siteId)}})((0,_i18nCalypso.localize)(EditorThemeHelp));module.exports=exports["default"]},2344:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1),classNames=__webpack_require__(10);module.exports=React.createClass({displayName:"EditorMediaModalFieldset",propTypes:{legend:React.PropTypes.oneOfType([React.PropTypes.string,React.PropTypes.element]).isRequired},render:function render(){return React.createElement("fieldset",{className:classNames("editor-media-modal__fieldset",this.props.className)},React.createElement("legend",{className:"editor-media-modal__fieldset-legend"},this.props.legend),this.props.children)}})},2345:function(module,exports,__webpack_require__){"use strict";var _freeze=__webpack_require__(276);var _freeze2=_interopRequireDefault(_freeze);var _imageEditor=__webpack_require__(2443);var _imageEditor2=_interopRequireDefault(_imageEditor);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var React=__webpack_require__(1),noop=__webpack_require__(38),head=__webpack_require__(1734),some=__webpack_require__(63),findIndex=__webpack_require__(214),values=__webpack_require__(210),closest=__webpack_require__(729),debug=__webpack_require__(3)("calypso:post-editor:media");var MediaLibrary=__webpack_require__(2099),analytics=__webpack_require__(20),PostActions=__webpack_require__(1648),PostStats=__webpack_require__(1651),MediaModalSecondaryActions=__webpack_require__(3172),MediaModalDetail=__webpack_require__(3160),MediaModalGallery=__webpack_require__(3166),MediaActions=__webpack_require__(1662),MediaUtils=__webpack_require__(1647),Dialog=__webpack_require__(168),markup=__webpack_require__(1917),accept=__webpack_require__(397),ModalViews=__webpack_require__(1916).Views;module.exports=React.createClass({displayName:"EditorMediaModal",propTypes:{visible:React.PropTypes.bool,initialActiveView:React.PropTypes.oneOf(values(ModalViews)),mediaLibrarySelectedItems:React.PropTypes.arrayOf(React.PropTypes.object),onClose:React.PropTypes.func,onInsertMedia:React.PropTypes.func,site:React.PropTypes.object,labels:React.PropTypes.object,single:React.PropTypes.bool,defaultFilter:React.PropTypes.string,enabledFilters:React.PropTypes.arrayOf(React.PropTypes.string)},getInitialState:function getInitialState(){return this.getDefaultState(this.props)},getDefaultProps:function getDefaultProps(){return{visible:false,mediaLibrarySelectedItems:(0,_freeze2.default)([]),onClose:noop,onInsertMedia:noop,labels:(0,_freeze2.default)({})}},componentWillReceiveProps:function componentWillReceiveProps(nextProps){if(nextProps.site&&this.props.visible&&!nextProps.visible){MediaActions.setLibrarySelectedItems(nextProps.site.ID,[])}if(!nextProps.visible||this.props.visible===nextProps.visible){return}this.replaceState(this.getDefaultState(nextProps))},componentDidMount:function componentDidMount(){debug("%s component mounted.",this.constructor.name);this.statsTracking={}},getDefaultState:function getDefaultState(props){return{filter:"",activeView:props.initialActiveView||ModalViews.LIST,detailSelectedIndex:0,gallerySettings:props.initialGallerySettings}},isDisabled:function isDisabled(){return some(this.props.mediaLibrarySelectedItems,function(item){var mimePrefix=MediaUtils.getMimePrefix(item);return item.transient&&(mimePrefix!=="image"||ModalViews.GALLERY===this.state.activeView)}.bind(this))},confirmSelection:function confirmSelection(){var selectedItems=this.props.mediaLibrarySelectedItems,gallerySettings=this.state.gallerySettings,media,stat;if(!this.props.visible){return}if(ModalViews.GALLERY===this.state.activeView){if(gallerySettings&&"individual"===gallerySettings.type){media=gallerySettings.items.map(markup.get).join("")}else{media=MediaUtils.generateGalleryShortcode(gallerySettings)}stat="insert_gallery"}else{media=selectedItems.map(markup.get).join("");stat="insert_item"}if(some(selectedItems,"transient")){PostActions.blockSave("MEDIA_MODAL_TRANSIENT_INSERT")}if(media){this.props.onInsertMedia(media);if(stat){analytics.mc.bumpStat("editor_media_actions",stat)}}this.props.onClose(selectedItems)},setView:function setView(view){var stat;this.setState({activeView:view});switch(view){case ModalViews.LIST:stat="view_list";break;case ModalViews.DETAIL:stat="view_detail";break;case ModalViews.GALLERY:stat="view_gallery";break;case ModalViews.IMAGE_EDITOR:stat="view_edit";break}if(stat){analytics.mc.bumpStat("editor_media_actions",stat)}},setDetailSelectedIndex:function setDetailSelectedIndex(index){this.setState({detailSelectedIndex:index})},setNextAvailableDetailView:function setNextAvailableDetailView(){if(1===this.props.mediaLibrarySelectedItems.length){this.setView(ModalViews.LIST)}else if(this.getDetailSelectedIndex()===this.props.mediaLibrarySelectedItems.length-1){this.setDetailSelectedIndex(Math.max(this.getDetailSelectedIndex()-1,0))}},confirmDeleteMedia:function confirmDeleteMedia(accepted){var _props=this.props;var site=_props.site;var mediaLibrarySelectedItems=_props.mediaLibrarySelectedItems;if(!site||!accepted){return}var toDelete=mediaLibrarySelectedItems;if(ModalViews.DETAIL===this.state.activeView){toDelete=toDelete[this.getDetailSelectedIndex()];this.setNextAvailableDetailView()}MediaActions.delete(site.ID,toDelete);analytics.mc.bumpStat("editor_media_actions","delete_media")},deleteMedia:function deleteMedia(){var selectedCount,confirmMessage;if(ModalViews.DETAIL===this.state.activeView){selectedCount=1}else{selectedCount=this.props.mediaLibrarySelectedItems.length}confirmMessage=this.translate("Are you sure you want to permanently delete this item?","Are you sure you want to permanently delete these items?",{count:selectedCount});accept(confirmMessage,this.confirmDeleteMedia)},onAddMedia:function onAddMedia(){PostStats.recordStat("media_explorer_upload");PostStats.recordEvent("Upload Media")},onAddAndEditImage:function onAddAndEditImage(){MediaActions.setLibrarySelectedItems(this.props.site.ID,[]);this.setView(ModalViews.IMAGE_EDITOR)},onImageEditorSave:function onImageEditorSave(){MediaActions.setLibrarySelectedItems(this.props.site.ID,[]);this.setView(ModalViews.LIST)},onImageEditorCancel:function onImageEditorCancel(){var item=this.props.mediaLibrarySelectedItems[this.getDetailSelectedIndex()];if(!item){this.setView(ModalViews.LIST);return}this.setView(ModalViews.DETAIL)},getDetailSelectedIndex:function getDetailSelectedIndex(){var mediaLibrarySelectedItems=this.props.mediaLibrarySelectedItems;var detailSelectedIndex=this.state.detailSelectedIndex;if(detailSelectedIndex>=mediaLibrarySelectedItems.length){return 0}return detailSelectedIndex},onFilterChange:function onFilterChange(filter){if(filter!==this.state.filter){analytics.mc.bumpStat("editor_media_actions","filter_"+(filter||"all"))}this.setState({filter:filter})},onScaleChange:function onScaleChange(){if(!this.statsTracking.scale){analytics.mc.bumpStat("editor_media_actions","scale");this.statsTracking.scale=true}},onSearch:function onSearch(search){this.setState({search:search||undefined});if(!this.statsTracking.search){analytics.mc.bumpStat("editor_media_actions","search");this.statsTracking.search=true}},onClose:function onClose(){this.props.onClose()},editItem:function editItem(item){var _props2=this.props;var site=_props2.site;var mediaLibrarySelectedItems=_props2.mediaLibrarySelectedItems;var single=_props2.single;if(!site){return}var items=mediaLibrarySelectedItems;if(!items.some(function(selected){return selected.ID===item.ID})){if(single){items=[item]}else{items=items.concat(item)}MediaActions.setLibrarySelectedItems(site.ID,items)}this.setDetailSelectedIndex(findIndex(items,{ID:item.ID}));analytics.mc.bumpStat("editor_media_actions","edit_button_contextual");analytics.ga.recordEvent("Media","Clicked Contextual Edit Button");this.setView(ModalViews.DETAIL)},getFirstEnabledFilter:function getFirstEnabledFilter(){if(this.props.enabledFilters){return head(this.props.enabledFilters)}},getModalButtons:function getModalButtons(){var isDisabled=this.isDisabled(),selectedItems=this.props.mediaLibrarySelectedItems,buttons;if(ModalViews.IMAGE_EDITOR===this.state.activeView){return}buttons=[React.createElement(MediaModalSecondaryActions,{site:this.props.site,selectedItems:selectedItems,activeView:this.state.activeView,disabled:isDisabled,onDelete:this.deleteMedia,onChangeView:this.setView}),{action:"cancel",label:this.translate("Cancel")}];if(ModalViews.GALLERY!==this.state.activeView&&selectedItems.length>1&&!some(selectedItems,function(item){return MediaUtils.getMimePrefix(item)!=="image"})){buttons.push({action:"confirm",label:this.translate("Continue"),isPrimary:true,disabled:isDisabled||!this.props.site,onClick:this.setView.bind(this,ModalViews.GALLERY)})}else{buttons.push({action:"confirm",label:this.props.labels.confirm||this.translate("Insert"),isPrimary:true,disabled:isDisabled||0===selectedItems.length,onClick:this.confirmSelection})}return buttons},preventClose:function preventClose(event){if(ModalViews.IMAGE_EDITOR===this.state.activeView||closest(event.target,".popover.is-dialog-visible")){return true}},renderContent:function renderContent(){var _this=this;var content;switch(this.state.activeView){case ModalViews.LIST:content=React.createElement(MediaLibrary,{site:this.props.site,filter:this.state.filter||this.props.defaultFilter||this.getFirstEnabledFilter(),enabledFilters:this.props.enabledFilters,search:this.state.search,onAddMedia:this.onAddMedia,onAddAndEditImage:this.onAddAndEditImage,onFilterChange:this.onFilterChange,onScaleChange:this.onScaleChange,onSearch:this.onSearch,onEditItem:this.editItem,fullScreenDropZone:false,single:this.props.single,scrollable:true});break;case ModalViews.DETAIL:content=React.createElement(MediaModalDetail,{site:this.props.site,
items:this.props.mediaLibrarySelectedItems,selectedIndex:this.getDetailSelectedIndex(),onSelectedIndexChange:this.setDetailSelectedIndex,onChangeView:this.setView,onEdit:this.setView.bind(this,ModalViews.IMAGE_EDITOR)});break;case ModalViews.GALLERY:content=React.createElement(MediaModalGallery,{site:this.props.site,items:this.props.mediaLibrarySelectedItems,settings:this.state.gallerySettings,onUpdateSettings:function onUpdateSettings(gallerySettings){return _this.setState({gallerySettings:gallerySettings})},onChangeView:this.setView});break;case ModalViews.IMAGE_EDITOR:var _props3=this.props;var site=_props3.site;var items=_props3.mediaLibrarySelectedItems;var selectedIndex=this.getDetailSelectedIndex(),media=items?items[selectedIndex]:null;content=React.createElement(_imageEditor2.default,{siteId:site&&site.ID,media:media,onImageEditorSave:this.onImageEditorSave,onImageEditorCancel:this.onImageEditorCancel});break}return content},render:function render(){return React.createElement(Dialog,{isVisible:this.props.visible,buttons:this.getModalButtons(),onClose:this.onClose,additionalClassNames:"editor-media-modal",onClickOutside:this.preventClose},this.renderContent())}})},2346:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _keys=__webpack_require__(39);var _keys2=_interopRequireDefault(_keys);var _defineProperty2=__webpack_require__(7);var _defineProperty3=_interopRequireDefault(_defineProperty2);var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _map2=__webpack_require__(45);var _map3=_interopRequireDefault(_map2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactRedux=__webpack_require__(15);var _debug2=__webpack_require__(3);var _debug3=_interopRequireDefault(_debug2);var _selectors=__webpack_require__(47);var _selectors2=__webpack_require__(1742);var _selectors3=__webpack_require__(277);var _selectors4=__webpack_require__(112);var _selectors5=__webpack_require__(2010);var _actions=__webpack_require__(285);var _tokenField=__webpack_require__(1969);var _tokenField2=_interopRequireDefault(_tokenField);var _formatting=__webpack_require__(81);var _stats=__webpack_require__(1651);var _queryTerms=__webpack_require__(1835);var _queryTerms2=_interopRequireDefault(_queryTerms);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var debug=(0,_debug3.default)("calypso:post-editor:editor-terms");var DEFAULT_NON_HIERARCHICAL_QUERY={number:1e3,order_by:"count",order:"DESC"};var MAX_TERMS_SUGGESTIONS=20;var TermTokenField=function(_React$Component){(0,_inherits3.default)(TermTokenField,_React$Component);function TermTokenField(){(0,_classCallCheck3.default)(this,TermTokenField);return(0,_possibleConstructorReturn3.default)(this,(TermTokenField.__proto__||(0,_getPrototypeOf2.default)(TermTokenField)).apply(this,arguments))}(0,_createClass3.default)(TermTokenField,[{key:"componentWillMount",value:function componentWillMount(){this.boundOnTermsChange=this.onTermsChange.bind(this)}},{key:"onTermsChange",value:function onTermsChange(selectedTerms){debug("onTermsChange",selectedTerms,this);var termStat=void 0,termEventLabel=void 0;if(selectedTerms.length>this.getPostTerms().length){termStat="term_added";termEventLabel="Added Term"}else{termStat="term_removed";termEventLabel="Removed Term"}(0,_stats.recordStat)(termStat);(0,_stats.recordEvent)("Changed Terms",termEventLabel);var _props=this.props;var siteId=_props.siteId;var postId=_props.postId;var taxonomyName=_props.taxonomyName;this.props.editPost(siteId,postId,{terms:(0,_defineProperty3.default)({},taxonomyName,selectedTerms)})}},{key:"getPostTerms",value:function getPostTerms(){var _props2=this.props;var postTerms=_props2.postTerms;var taxonomyName=_props2.taxonomyName;if(!postTerms||!postTerms[taxonomyName]){return[]}if(Array.isArray(postTerms[taxonomyName])){return postTerms[taxonomyName]}return(0,_keys2.default)(postTerms[taxonomyName])}},{key:"render",value:function render(){var termNames=(0,_map3.default)(this.props.terms,"name");return _react2.default.createElement("div",null,_react2.default.createElement(_queryTerms2.default,{siteId:this.props.siteId,taxonomy:this.props.taxonomyName,query:DEFAULT_NON_HIERARCHICAL_QUERY}),_react2.default.createElement(_tokenField2.default,{value:this.getPostTerms(),displayTransform:_formatting.decodeEntities,suggestions:termNames,onChange:this.boundOnTermsChange,maxSuggestions:MAX_TERMS_SUGGESTIONS}))}}]);return TermTokenField}(_react2.default.Component);TermTokenField.propTypes={siteId:_react2.default.PropTypes.number,postId:_react2.default.PropTypes.number,postTerms:_react2.default.PropTypes.object,taxonomyName:_react2.default.PropTypes.string,taxonomyLabel:_react2.default.PropTypes.string,terms:_react2.default.PropTypes.arrayOf(_react2.default.PropTypes.object),editPost:_react2.default.PropTypes.func};exports.default=(0,_reactRedux.connect)(function(state,props){var siteId=(0,_selectors.getSelectedSiteId)(state);var postId=(0,_selectors3.getEditorPostId)(state);var postType=(0,_selectors4.getEditedPostValue)(state,siteId,postId,"type");var taxonomy=(0,_selectors5.getPostTypeTaxonomy)(state,siteId,postType,props.taxonomyName);return{siteId:siteId,postId:postId,taxonomyLabel:taxonomy&&taxonomy.label,terms:(0,_selectors2.getTerms)(state,siteId,props.taxonomyName),postTerms:(0,_selectors4.getEditedPostValue)(state,siteId,postId,"terms")}},{editPost:_actions.editPost})(TermTokenField);module.exports=exports["default"]},2363:function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.isRequestingPageTemplates=isRequestingPageTemplates;exports.getPageTemplates=getPageTemplates;function isRequestingPageTemplates(state,siteId){return!!state.pageTemplates.requesting[siteId]}function getPageTemplates(state,siteId){return state.pageTemplates.items[siteId]||null}},2372:function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getMediaStorage=getMediaStorage;exports.isRequestingMediaStorage=isRequestingMediaStorage;exports.isOverMediaLimit=isOverMediaLimit;function getMediaStorage(state,siteId){return state.sites.mediaStorage.items[siteId]}function isRequestingMediaStorage(state,siteId){return!!state.sites.mediaStorage.fetchingItems[siteId]}function isOverMediaLimit(state,siteId){var mediaStorage=state.sites.mediaStorage.items[siteId];if(!mediaStorage){return null}if(mediaStorage.max_storage_bytes===-1){return false}return mediaStorage.storage_used_bytes>=mediaStorage.max_storage_bytes}},2377:function(module,exports,__webpack_require__){var Refiner=__webpack_require__(1798).Refiner;exports.Refiner=function ENMergeDateRangeRefiner(){Refiner.call(this);this.pattern=function(){return/^\s*(to|\-)\s*$/i};this.refine=function(text,results,opt){if(results.length<2)return results;var mergedResult=[];var currResult=null;var prevResult=null;for(var i=1;i<results.length;i++){currResult=results[i];prevResult=results[i-1];if(!prevResult.end&&!currResult.end&&this.isAbleToMerge(text,prevResult,currResult)){prevResult=this.mergeResult(text,prevResult,currResult);currResult=null;i+=1}mergedResult.push(prevResult)}if(currResult!=null){mergedResult.push(currResult)}return mergedResult};this.isAbleToMerge=function(text,result1,result2){var begin=result1.index+result1.text.length;var end=result2.index;var textBetween=text.substring(begin,end);return textBetween.match(this.pattern())};this.isWeekdayResult=function(result){return result.start.isCertain("weekday")&&!result.start.isCertain("day")};this.mergeResult=function(text,fromResult,toResult){if(!this.isWeekdayResult(fromResult)&&!this.isWeekdayResult(toResult)){for(var key in toResult.start.knownValues){if(!fromResult.start.isCertain(key)){fromResult.start.assign(key,toResult.start.get(key))}}for(var key in fromResult.start.knownValues){if(!toResult.start.isCertain(key)){toResult.start.assign(key,fromResult.start.get(key))}}}if(fromResult.start.date().getTime()>toResult.start.date()){var tmp=toResult;toResult=fromResult;fromResult=tmp}fromResult.end=toResult.start;for(var tag in toResult.tags){fromResult.tags[tag]=true}var startIndex=Math.min(fromResult.index,toResult.index);var endIndex=Math.max(fromResult.index+fromResult.text.length,toResult.index+toResult.text.length);fromResult.index=startIndex;fromResult.text=text.substring(startIndex,endIndex);fromResult.tags[this.constructor.name]=true;return fromResult}}},2400:function(module,exports,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var EventSubscription=__webpack_require__(3444);var EmitterSubscription=function(_EventSubscription){_inherits(EmitterSubscription,_EventSubscription);function EmitterSubscription(subscriber,listener,context){_classCallCheck(this,EmitterSubscription);_EventSubscription.call(this,subscriber);this.listener=listener;this.context=context}return EmitterSubscription}(EventSubscription);module.exports=EmitterSubscription},2404:function(module,exports,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var FluxStore=__webpack_require__(2405);var abstractMethod=__webpack_require__(3463);var invariant=__webpack_require__(749);var FluxReduceStore=function(_FluxStore){_inherits(FluxReduceStore,_FluxStore);function FluxReduceStore(dispatcher){_classCallCheck(this,FluxReduceStore);_FluxStore.call(this,dispatcher);this._state=this.getInitialState()}FluxReduceStore.prototype.getState=function getState(){return this._state};FluxReduceStore.prototype.getInitialState=function getInitialState(){return abstractMethod("FluxReduceStore","getInitialState")};FluxReduceStore.prototype.reduce=function reduce(state,action){return abstractMethod("FluxReduceStore","reduce")};FluxReduceStore.prototype.areEqual=function areEqual(one,two){return one===two};FluxReduceStore.prototype.__invokeOnDispatch=function __invokeOnDispatch(action){this.__changed=false;var startingState=this._state;var endingState=this.reduce(startingState,action);!(endingState!==undefined)?false?invariant(false,"%s returned undefined from reduce(...), did you forget to return "+"state in the default case? (use null if this was intentional)",this.constructor.name):invariant(false):undefined;if(!this.areEqual(startingState,endingState)){this._state=endingState;this.__emitChange()}if(this.__changed){this.__emitter.emit(this.__changeEvent)}};return FluxReduceStore}(FluxStore);module.exports=FluxReduceStore},2405:function(module,exports,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var _require=__webpack_require__(3442);var EventEmitter=_require.EventEmitter;var invariant=__webpack_require__(749);var FluxStore=function(){function FluxStore(dispatcher){var _this=this;_classCallCheck(this,FluxStore);this.__className=this.constructor.name;this.__changed=false;this.__changeEvent="change";this.__dispatcher=dispatcher;this.__emitter=new EventEmitter;this._dispatchToken=dispatcher.register(function(payload){_this.__invokeOnDispatch(payload)})}FluxStore.prototype.addListener=function addListener(callback){return this.__emitter.addListener(this.__changeEvent,callback)};FluxStore.prototype.getDispatcher=function getDispatcher(){return this.__dispatcher};FluxStore.prototype.getDispatchToken=function getDispatchToken(){return this._dispatchToken};FluxStore.prototype.hasChanged=function hasChanged(){!this.__dispatcher.isDispatching()?false?invariant(false,"%s.hasChanged(): Must be invoked while dispatching.",this.__className):invariant(false):undefined;return this.__changed};FluxStore.prototype.__emitChange=function __emitChange(){!this.__dispatcher.isDispatching()?false?invariant(false,"%s.__emitChange(): Must be invoked while dispatching.",this.__className):invariant(false):undefined;this.__changed=true};FluxStore.prototype.__invokeOnDispatch=function __invokeOnDispatch(payload){this.__changed=false;this.__onDispatch(payload);if(this.__changed){this.__emitter.emit(this.__changeEvent)}};FluxStore.prototype.__onDispatch=function __onDispatch(payload){true?false?invariant(false,"%s has not overridden FluxStore.__onDispatch(), which is required",this.__className):invariant(false):undefined};return FluxStore}();module.exports=FluxStore},2406:function(module,exports,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var invariant=__webpack_require__(749);var FluxStoreGroup=function(){function FluxStoreGroup(stores,callback){var _this=this;_classCallCheck(this,FluxStoreGroup);this._dispatcher=_getUniformDispatcher(stores);var storeTokens=stores.map(function(store){return store.getDispatchToken()});this._dispatchToken=this._dispatcher.register(function(payload){_this._dispatcher.waitFor(storeTokens);callback()})}FluxStoreGroup.prototype.release=function release(){this._dispatcher.unregister(this._dispatchToken)};return FluxStoreGroup}();function _getUniformDispatcher(stores){!(stores&&stores.length)?false?invariant(false,"Must provide at least one store to FluxStoreGroup"):invariant(false):undefined;var dispatcher=stores[0].getDispatcher();if(false){for(var _iterator=stores,_isArray=Array.isArray(_iterator),_i=0,_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref;if(_isArray){if(_i>=_iterator.length)break;_ref=_iterator[_i++]}else{_i=_iterator.next();if(_i.done)break;_ref=_i.value}var store=_ref;!(store.getDispatcher()===dispatcher)?process.env.NODE_ENV!=="production"?invariant(false,"All stores in a FluxStoreGroup must use the same dispatcher"):invariant(false):undefined}}return dispatcher}module.exports=FluxStoreGroup},2425:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.cancelEvent=cancelEvent;exports.getCustomProps=getCustomProps;exports.getFirstDayOfMonth=getFirstDayOfMonth;exports.getDaysInMonth=getDaysInMonth;exports.getModifiersForDay=getModifiersForDay;exports.getMonthsDiff=getMonthsDiff;exports.getWeekArray=getWeekArray;exports.startOfMonth=startOfMonth;var _DateUtils=__webpack_require__(2212);var _LocaleUtils=__webpack_require__(2213);function cancelEvent(e){e.preventDefault();e.stopPropagation()}function getCustomProps(props,propTypes){var customProps={};Object.keys(props).filter(function(propName){return!propTypes.hasOwnProperty(propName)}).forEach(function(propName){customProps[propName]=props[propName]});return customProps}function getFirstDayOfMonth(d){return new Date(d.getFullYear(),d.getMonth(),1,12)}function getDaysInMonth(d){var resultDate=getFirstDayOfMonth(d);resultDate.setMonth(resultDate.getMonth()+1);resultDate.setDate(resultDate.getDate()-1);return resultDate.getDate()}function getModifiersForDay(d){var modifierFunctions=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];return Object.keys(modifierFunctions).reduce(function(modifiers,modifier){var func=modifierFunctions[modifier];if(func(d)){modifiers.push(modifier)}return modifiers},[])}function getMonthsDiff(d1,d2){return d2.getMonth()-d1.getMonth()+12*(d2.getFullYear()-d1.getFullYear())}function getWeekArray(d){var firstDayOfWeek=arguments.length<=1||arguments[1]===undefined?(0,_LocaleUtils.getFirstDayOfWeek)():arguments[1];var fixedWeeks=arguments[2];var daysInMonth=getDaysInMonth(d);var dayArray=[];var week=[];var weekArray=[];for(var i=1;i<=daysInMonth;i++){dayArray.push(new Date(d.getFullYear(),d.getMonth(),i,12))}dayArray.forEach(function(day){if(week.length>0&&day.getDay()===firstDayOfWeek){weekArray.push(week);week=[]}week.push(day);if(dayArray.indexOf(day)===dayArray.length-1){weekArray.push(week)}});var firstWeek=weekArray[0];for(var _i=7-firstWeek.length;_i>0;_i--){var outsideDate=(0,_DateUtils.clone)(firstWeek[0]);outsideDate.setDate(firstWeek[0].getDate()-1);firstWeek.unshift(outsideDate)}var lastWeek=weekArray[weekArray.length-1];for(var _i2=lastWeek.length;_i2<7;_i2++){var _outsideDate=(0,_DateUtils.clone)(lastWeek[lastWeek.length-1]);_outsideDate.setDate(lastWeek[lastWeek.length-1].getDate()+1);lastWeek.push(_outsideDate)}if(fixedWeeks&&weekArray.length<6){var lastExtraWeek=void 0;for(var _i3=weekArray.length;_i3<6;_i3++){lastExtraWeek=weekArray[weekArray.length-1];var lastDay=lastExtraWeek[lastExtraWeek.length-1];var extraWeek=[];for(var j=0;j<7;j++){var _outsideDate2=(0,_DateUtils.clone)(lastDay);_outsideDate2.setDate(lastDay.getDate()+j+1);extraWeek.push(_outsideDate2)}weekArray.push(extraWeek)}}return weekArray}function startOfMonth(d){var newDate=(0,_DateUtils.clone)(d);newDate.setDate(1);newDate.setHours(12,0,0,0);return newDate}},2426:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.NavbarPropTypes=undefined;exports.default=Navbar;var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _PropTypes=__webpack_require__(1833);var _PropTypes2=_interopRequireDefault(_PropTypes);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var buttonBaseClass="DayPicker-NavButton DayPicker-NavButton";function Navbar(_ref){var className=_ref.className;var showPreviousButton=_ref.showPreviousButton;var showNextButton=_ref.showNextButton;var onPreviousClick=_ref.onPreviousClick;var onNextClick=_ref.onNextClick;var dir=_ref.dir;var previousClickHandler=dir==="rtl"?onNextClick:onPreviousClick;var nextClickHandler=dir==="rtl"?onPreviousClick:onNextClick;var previousButton=showPreviousButton&&_react2.default.createElement("span",{role:"button",key:"previous",className:buttonBaseClass+"--prev",onClick:function onClick(){return previousClickHandler()}});var nextButton=showNextButton&&_react2.default.createElement("span",{role:"button",key:"right",className:buttonBaseClass+"--next",onClick:function onClick(){return nextClickHandler()}});return _react2.default.createElement("div",{className:className},dir==="rtl"?[nextButton,previousButton]:[previousButton,nextButton])}var NavbarPropTypes=exports.NavbarPropTypes={className:_react.PropTypes.string,nextMonth:_react.PropTypes.instanceOf(Date),previousMonth:_react.PropTypes.instanceOf(Date),showPreviousButton:_react.PropTypes.bool,showNextButton:_react.PropTypes.bool,onPreviousClick:_react.PropTypes.func,onNextClick:_react.PropTypes.func,dir:_react.PropTypes.string,locale:_react.PropTypes.string,localeUtils:_PropTypes2.default.localeUtils};Navbar.propTypes=NavbarPropTypes;Navbar.defaultProps={className:"DayPicker-NavBar",dir:"ltr",showPreviousButton:true,showNextButton:true}},2427:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.WeekdayPropTypes=undefined;exports.default=Weekday;var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _PropTypes=__webpack_require__(1833);var _PropTypes2=_interopRequireDefault(_PropTypes);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function Weekday(_ref){var weekday=_ref.weekday;var className=_ref.className;var localeUtils=_ref.localeUtils;var locale=_ref.locale;return _react2.default.createElement("div",{className:className},_react2.default.createElement("abbr",{title:localeUtils.formatWeekdayLong(weekday,locale)},localeUtils.formatWeekdayShort(weekday,locale)))}var WeekdayPropTypes=exports.WeekdayPropTypes={weekday:_react.PropTypes.number,className:_react.PropTypes.string,locale:_react.PropTypes.string,localeUtils:_PropTypes2.default.localeUtils};Weekday.propTypes=WeekdayPropTypes},2439:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _noop2=__webpack_require__(38);var _noop3=_interopRequireDefault(_noop2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactRedux=__webpack_require__(15);var _i18nCalypso=__webpack_require__(11);var _button=__webpack_require__(69);var _button2=_interopRequireDefault(_button);var _actions=__webpack_require__(1927);var _selectors=__webpack_require__(1928);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ImageEditorButtons=function(_Component){(0,_inherits3.default)(ImageEditorButtons,_Component);function ImageEditorButtons(){(0,_classCallCheck3.default)(this,ImageEditorButtons);return(0,_possibleConstructorReturn3.default)(this,(ImageEditorButtons.__proto__||(0,_getPrototypeOf2.default)(ImageEditorButtons)).apply(this,arguments))}(0,_createClass3.default)(ImageEditorButtons,[{key:"render",value:function render(){var _props=this.props;var hasChanges=_props.hasChanges;var onCancel=_props.onCancel;var src=_props.src;var onDone=_props.onDone;var translate=_props.translate;return _react2.default.createElement("div",{className:"image-editor__buttons"},_react2.default.createElement(_button2.default,{className:"image-editor__buttons-button",onClick:onCancel},translate("Cancel")),_react2.default.createElement(_button2.default,{className:"image-editor__buttons-button",disabled:!hasChanges,onClick:this.props.resetImageEditorState},translate("Reset")),_react2.default.createElement(_button2.default,{className:"image-editor__buttons-button",disabled:!src,primary:true,onClick:onDone},translate(" Done ")))}}]);return ImageEditorButtons}(_react.Component);ImageEditorButtons.propTypes={src:_react.PropTypes.string,hasChanges:_react.PropTypes.bool,resetImageEditorState:_react.PropTypes.func,onDone:_react.PropTypes.func,onCancel:_react.PropTypes.func};ImageEditorButtons.defaultProps={src:"",hasChanges:false,resetImageEditorState:_noop3.default,onDone:_noop3.default,onCancel:_noop3.default};exports.default=(0,_reactRedux.connect)(function(state){var _getImageEditorFileIn=(0,_selectors.getImageEditorFileInfo)(state);var src=_getImageEditorFileIn.src;var hasChanges=(0,_selectors.imageEditorHasChanges)(state);return{src:src,hasChanges:hasChanges}},{resetImageEditorState:_actions.resetImageEditorState})((0,_i18nCalypso.localize)(ImageEditorButtons));module.exports=exports["default"]},2440:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _throttle2=__webpack_require__(388);var _throttle3=_interopRequireDefault(_throttle2);var _noop2=__webpack_require__(38);var _noop3=_interopRequireDefault(_noop2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactDom=__webpack_require__(44);var _reactDom2=_interopRequireDefault(_reactDom);var _reactRedux=__webpack_require__(15);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _imageEditorCrop=__webpack_require__(2441);var _imageEditorCrop2=_interopRequireDefault(_imageEditorCrop);var _utils=__webpack_require__(1647);var _utils2=_interopRequireDefault(_utils);var _selectors=__webpack_require__(1928);var _actions=__webpack_require__(1927);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ImageEditorCanvas=function(_Component){(0,_inherits3.default)(ImageEditorCanvas,_Component);function ImageEditorCanvas(props){(0,_classCallCheck3.default)(this,ImageEditorCanvas);var _this=(0,_possibleConstructorReturn3.default)(this,(ImageEditorCanvas.__proto__||(0,_getPrototypeOf2.default)(ImageEditorCanvas)).call(this,props));_this.state={imageLoaded:false};_this.onWindowResize=null;_this.onLoadComplete=_this.onLoadComplete.bind(_this);return _this}(0,_createClass3.default)(ImageEditorCanvas,[{key:"componentWillReceiveProps",value:function componentWillReceiveProps(newProps){if(this.props.src!==newProps.src){this.getImage(newProps.src)}}},{key:"getImage",value:function getImage(url){var _this2=this;var _props=this.props;var onLoadError=_props.onLoadError;var mimeType=_props.mimeType;var req=new XMLHttpRequest;req.open("GET",url+"?",true);req.responseType="arraybuffer";req.onload=function(){var objectURL=window.URL.createObjectURL(new Blob([req.response],{type:mimeType}));_this2.initImage(objectURL)};req.onerror=function(error){return onLoadError(error)};req.send()}},{key:"initImage",value:function initImage(src){this.image=new Image;this.image.src=src;this.image.onload=this.onLoadComplete;this.image.onerror=this.onLoadComplete}},{key:"onLoadComplete",value:function onLoadComplete(event){if(event.type!=="load"){return}this.drawImage();this.updateCanvasPosition();this.onWindowResize=(0,_throttle3.default)(this.updateCanvasPosition,200);if(typeof window!=="undefined"){window.addEventListener("resize",this.onWindowResize)}this.setState({imageLoaded:true})}},{key:"componentWillUnmount",value:function componentWillUnmount(){if(typeof window!=="undefined"&&this.onWindowResize){window.removeEventListener("resize",this.onWindowResize);this.onWindowResize=null}}},{key:"componentDidUpdate",value:function componentDidUpdate(){this.drawImage();this.updateCanvasPosition()}},{key:"toBlob",value:function toBlob(callback){var _props$crop=this.props.crop;var leftRatio=_props$crop.leftRatio;var topRatio=_props$crop.topRatio;var widthRatio=_props$crop.widthRatio;var heightRatio=_props$crop.heightRatio;var _props2=this.props;var mimeType=_props2.mimeType;var transform=_props2.transform;var canvas=_reactDom2.default.findDOMNode(this.refs.canvas),context=canvas.getContext("2d"),rotated=transform.degrees%180!==0,imageWidth=rotated?this.image.height:this.image.width,imageHeight=rotated?this.image.width:this.image.height,croppedLeft=leftRatio*imageWidth,croppedTop=topRatio*imageHeight,croppedWidth=widthRatio*imageWidth,croppedHeight=heightRatio*imageHeight;var imageData=context.getImageData(croppedLeft,croppedTop,croppedWidth,croppedHeight);var newCanvas=document.createElement("canvas");newCanvas.width=croppedWidth;newCanvas.height=croppedHeight;var newContext=newCanvas.getContext("2d");newContext.putImageData(imageData,0,0);_utils2.default.canvasToBlob(newCanvas,callback,mimeType,1)}},{key:"drawImage",value:function drawImage(){if(!this.image){return}var canvas=_reactDom2.default.findDOMNode(this.refs.canvas),imageWidth=this.image.width,imageHeight=this.image.height,transform=this.props.transform,rotated=transform.degrees%180!==0;canvas.width=rotated?imageHeight:imageWidth;canvas.height=rotated?imageWidth:imageHeight;var context=canvas.getContext("2d");context.clearRect(0,0,canvas.width,canvas.height);context.save();context.setTransform(1,0,0,1,canvas.width/2,canvas.height/2);context.scale(transform.scaleX,transform.scaleY);context.rotate(transform.degrees*Math.PI/180);context.drawImage(this.image,-imageWidth/2,-imageHeight/2);context.restore()}},{key:"updateCanvasPosition",value:function updateCanvasPosition(){var _props$crop2=this.props.crop;var leftRatio=_props$crop2.leftRatio;var topRatio=_props$crop2.topRatio;var widthRatio=_props$crop2.widthRatio;var heightRatio=_props$crop2.heightRatio;var canvas=_reactDom2.default.findDOMNode(this.refs.canvas),canvasX=-50*widthRatio-100*leftRatio,canvasY=-50*heightRatio-100*topRatio;this.props.setImageEditorCropBounds(canvas.offsetTop-canvas.offsetHeight*-canvasY/100,canvas.offsetLeft-canvas.offsetWidth*-canvasX/100,canvas.offsetTop+canvas.offsetHeight*(1+canvasY/100),canvas.offsetLeft+canvas.offsetWidth*(1+canvasX/100))}},{key:"preventDrag",value:function preventDrag(event){event.preventDefault();return false}},{key:"render",value:function render(){var _props$crop3=this.props.crop;var leftRatio=_props$crop3.leftRatio;var topRatio=_props$crop3.topRatio;var widthRatio=_props$crop3.widthRatio;var heightRatio=_props$crop3.heightRatio;var canvasX=-50*widthRatio-100*leftRatio;var canvasY=-50*heightRatio-100*topRatio;var canvasStyle={transform:"translate("+canvasX+"%, "+canvasY+"%)",maxWidth:85/widthRatio+"%",maxHeight:85/heightRatio+"%"};var imageLoaded=this.state.imageLoaded;var canvasClasses=(0,_classnames2.default)("image-editor__canvas",{"is-placeholder":!imageLoaded});return _react2.default.createElement("div",{className:"image-editor__canvas-container"},imageLoaded&&_react2.default.createElement(_imageEditorCrop2.default,null),_react2.default.createElement("canvas",{ref:"canvas",style:canvasStyle,onMouseDown:this.preventDrag,className:canvasClasses}))}}]);return ImageEditorCanvas}(_react.Component);ImageEditorCanvas.propTypes={src:_react.PropTypes.string,mimeType:_react.PropTypes.string,transform:_react.PropTypes.shape({degrees:_react.PropTypes.number,scaleX:_react.PropTypes.number,scaleY:_react.PropTypes.number}),crop:_react.PropTypes.shape({topRatio:_react.PropTypes.number,leftRatio:_react.PropTypes.number,widthRatio:_react.PropTypes.number,heightRatio:_react.PropTypes.number}),setImageEditorCropBounds:_react.PropTypes.func,onLoadError:_react.PropTypes.func};ImageEditorCanvas.defaultProps={transform:{degrees:0,scaleX:1,scaleY:1},crop:{cropTopRatio:0,cropLeftRatio:0,cropWidthRatio:1,cropHeightRatio:1},setImageEditorCropBounds:_noop3.default,onLoadError:_noop3.default};exports.default=(0,_reactRedux.connect)(function(state){var transform=(0,_selectors.getImageEditorTransform)(state);var _getImageEditorFileIn=(0,_selectors.getImageEditorFileInfo)(state);var src=_getImageEditorFileIn.src;var mimeType=_getImageEditorFileIn.mimeType;var crop=(0,_selectors.getImageEditorCrop)(state);
return{src:src,mimeType:mimeType,transform:transform,crop:crop}},{setImageEditorCropBounds:_actions.setImageEditorCropBounds},null,{withRef:true})(ImageEditorCanvas);module.exports=exports["default"]},2441:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _assign=__webpack_require__(5);var _assign2=_interopRequireDefault(_assign);var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _noop2=__webpack_require__(38);var _noop3=_interopRequireDefault(_noop2);var _isEqual2=__webpack_require__(98);var _isEqual3=_interopRequireDefault(_isEqual2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactRedux=__webpack_require__(15);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _draggable=__webpack_require__(2512);var _draggable2=_interopRequireDefault(_draggable);var _selectors=__webpack_require__(1928);var _constants=__webpack_require__(795);var _actions=__webpack_require__(1927);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ImageEditorCrop=function(_Component){(0,_inherits3.default)(ImageEditorCrop,_Component);function ImageEditorCrop(props){(0,_classCallCheck3.default)(this,ImageEditorCrop);var _this=(0,_possibleConstructorReturn3.default)(this,(ImageEditorCrop.__proto__||(0,_getPrototypeOf2.default)(ImageEditorCrop)).call(this,props));_this.state=_this.getDefaultState(props);_this.onTopLeftDrag=_this.onTopLeftDrag.bind(_this);_this.onTopRightDrag=_this.onTopRightDrag.bind(_this);_this.onBottomLeftDrag=_this.onBottomLeftDrag.bind(_this);_this.onBottomRightDrag=_this.onBottomRightDrag.bind(_this);_this.applyCrop=_this.applyCrop.bind(_this);_this.onBorderDrag=_this.onBorderDrag.bind(_this);return _this}(0,_createClass3.default)(ImageEditorCrop,[{key:"getDefaultState",value:function getDefaultState(props){return{top:props.bounds.topBound,left:props.bounds.leftBound,bottom:props.bounds.bottomBound,right:props.bounds.rightBound}}},{key:"componentWillReceiveProps",value:function componentWillReceiveProps(newProps){var _props=this.props;var bounds=_props.bounds;var aspectRatio=_props.aspectRatio;if(!(0,_isEqual3.default)(bounds,newProps.bounds)){var imageWidth=newProps.bounds.rightBound-newProps.bounds.leftBound;var imageHeight=newProps.bounds.bottomBound-newProps.bounds.topBound;var newTop=newProps.bounds.topBound+newProps.crop.topRatio*imageHeight;var newLeft=newProps.bounds.leftBound+newProps.crop.leftRatio*imageWidth;var newBottom=newTop+newProps.crop.heightRatio*imageHeight;var newRight=newLeft+newProps.crop.widthRatio*imageWidth;this.setState({top:newTop,left:newLeft,bottom:newBottom,right:newRight})}if(aspectRatio!==newProps.aspectRatio){this.updateCrop(this.getDefaultState(newProps),newProps,this.applyCrop)}}},{key:"updateCrop",value:function updateCrop(newValues,props,callback){props=props||this.props;var aspectRatio=props.aspectRatio;if(aspectRatio===_constants.AspectRatios.FREE){this.setState(newValues,callback);return}var rotated=props.degrees%180!==0,bounds=props.bounds,newState=(0,_assign2.default)({},this.state,newValues),newWidth=newState.right-newState.left,newHeight=newState.bottom-newState.top;var imageWidth=void 0,imageHeight=void 0,finalWidth=newWidth,finalHeight=newHeight;switch(aspectRatio){case _constants.AspectRatios.ORIGINAL:imageWidth=bounds.rightBound-bounds.leftBound;imageHeight=bounds.bottomBound-bounds.topBound;break;case _constants.AspectRatios.ASPECT_1X1:imageWidth=1;imageHeight=1;break;case _constants.AspectRatios.ASPECT_16X9:imageWidth=rotated?9:16;imageHeight=rotated?16:9;break;case _constants.AspectRatios.ASPECT_4X3:imageWidth=rotated?3:4;imageHeight=rotated?4:3;break;case _constants.AspectRatios.ASPECT_3X2:imageWidth=rotated?2:3;imageHeight=rotated?3:2;break}var ratio=Math.min(newWidth/imageWidth,newHeight/imageHeight);finalWidth=imageWidth*ratio;finalHeight=imageHeight*ratio;if(newValues.hasOwnProperty("top")){newValues.top=newState.bottom-finalHeight}else if(newValues.hasOwnProperty("bottom")){newValues.bottom=newState.top+finalHeight}if(newValues.hasOwnProperty("left")){newValues.left=newState.right-finalWidth}else if(newValues.hasOwnProperty("right")){newValues.right=newState.left+finalWidth}this.setState(newValues,callback)}},{key:"onTopLeftDrag",value:function onTopLeftDrag(x,y){var _state=this.state;var right=_state.right;var bottom=_state.bottom;var minCropSize=this.props.minCropSize;var top=y,left=x;if(right-left<=minCropSize.width){left=right-minCropSize.width}if(bottom-top<=minCropSize.height){top=bottom-minCropSize.height}this.updateCrop({top:top,left:left})}},{key:"onTopRightDrag",value:function onTopRightDrag(x,y){var _state2=this.state;var left=_state2.left;var bottom=_state2.bottom;var minCropSize=this.props.minCropSize;var top=y,right=x;if(right-left<=minCropSize.width){right=left+minCropSize.width}if(bottom-top<=minCropSize.height){top=bottom-minCropSize.height}this.updateCrop({top:top,right:right})}},{key:"onBottomRightDrag",value:function onBottomRightDrag(x,y){var _state3=this.state;var left=_state3.left;var top=_state3.top;var minCropSize=this.props.minCropSize;var bottom=y,right=x;if(right-left<=minCropSize.width){right=left+minCropSize.width}if(bottom-top<=minCropSize.height){bottom=top+minCropSize.height}this.updateCrop({bottom:bottom,right:right})}},{key:"onBottomLeftDrag",value:function onBottomLeftDrag(x,y){var _state4=this.state;var right=_state4.right;var top=_state4.top;var minCropSize=this.props.minCropSize;var bottom=y,left=x;if(right-left<=minCropSize.width){left=right-minCropSize.width}if(bottom-top<=minCropSize.height){bottom=top+minCropSize.height}this.updateCrop({bottom:bottom,left:left})}},{key:"onBorderDrag",value:function onBorderDrag(x,y){var _state5=this.state;var top=_state5.top;var left=_state5.left;var right=_state5.right;var bottom=_state5.bottom;var width=right-left;var height=bottom-top;this.setState({top:y,left:x,bottom:y+height,right:x+width})}},{key:"applyCrop",value:function applyCrop(){var _state6=this.state;var top=_state6.top;var left=_state6.left;var right=_state6.right;var bottom=_state6.bottom;var _props$bounds=this.props.bounds;var topBound=_props$bounds.topBound;var leftBound=_props$bounds.leftBound;var rightBound=_props$bounds.rightBound;var bottomBound=_props$bounds.bottomBound;var currentTop=top-topBound,currentLeft=left-leftBound,currentWidth=right-left,currentHeight=bottom-top,imageWidth=rightBound-leftBound,imageHeight=bottomBound-topBound;this.props.imageEditorCrop(currentTop/imageHeight,currentLeft/imageWidth,currentWidth/imageWidth,currentHeight/imageHeight)}},{key:"render",value:function render(){var _state7=this.state;var top=_state7.top;var left=_state7.left;var right=_state7.right;var bottom=_state7.bottom;var width=right-left,height=bottom-top,handleClassName="image-editor__crop-handle";var _props$bounds2=this.props.bounds;var topBound=_props$bounds2.topBound;var leftBound=_props$bounds2.leftBound;var rightBound=_props$bounds2.rightBound;var bottomBound=_props$bounds2.bottomBound;return _react2.default.createElement("div",null,_react2.default.createElement("div",{className:"image-editor__crop-background",style:{top:topBound+"px",left:left+"px",width:width+"px",height:Math.max(0,top-topBound)+"px"}}),_react2.default.createElement("div",{className:"image-editor__crop-background",style:{top:topBound+"px",left:leftBound+"px",width:Math.max(0,left-leftBound)+"px",height:Math.max(0,bottomBound-topBound)+"px"}}),_react2.default.createElement("div",{className:"image-editor__crop-background",style:{top:bottom+"px",left:left+"px",width:width+"px",height:Math.max(0,bottomBound-bottom)+"px"}}),_react2.default.createElement("div",{className:"image-editor__crop-background",style:{top:topBound+"px",left:right+"px",width:Math.max(0,rightBound-right)+"px",height:Math.max(0,bottomBound-topBound)+"px"}}),_react2.default.createElement(_draggable2.default,{ref:"border",onDrag:this.onBorderDrag,onStop:this.applyCrop,x:left,y:top,width:width,height:height,bounds:{top:topBound,left:leftBound,bottom:bottomBound,right:rightBound},className:"image-editor__crop"}),_react2.default.createElement(_draggable2.default,{onDrag:this.onTopLeftDrag,onStop:this.applyCrop,x:left,y:top,controlled:true,bounds:{bottom:bottom,right:right,top:topBound-1,left:leftBound-1},ref:"topLeft",className:(0,_classnames2.default)(handleClassName,handleClassName+"-nwse")}),_react2.default.createElement(_draggable2.default,{onDrag:this.onTopRightDrag,onStop:this.applyCrop,y:top,x:right,controlled:true,bounds:{bottom:bottom,left:left,top:topBound-1,right:rightBound-1},ref:"topRight",className:(0,_classnames2.default)(handleClassName,handleClassName+"-nesw")}),_react2.default.createElement(_draggable2.default,{onDrag:this.onBottomRightDrag,onStop:this.applyCrop,y:bottom,x:right,controlled:true,bounds:{top:top,left:left,bottom:bottomBound-1,right:rightBound-1},ref:"bottomRight",className:(0,_classnames2.default)(handleClassName,handleClassName+"-nwse")}),_react2.default.createElement(_draggable2.default,{onDrag:this.onBottomLeftDrag,onStop:this.applyCrop,y:bottom,x:left,controlled:true,bounds:{top:top,right:right,bottom:bottomBound-1,left:leftBound-1},ref:"bottomLeft",className:(0,_classnames2.default)(handleClassName,handleClassName+"-nesw")}))}}]);return ImageEditorCrop}(_react.Component);ImageEditorCrop.propTypes={degrees:_react.PropTypes.number,bounds:_react.PropTypes.shape({topBound:_react.PropTypes.number,leftBound:_react.PropTypes.number,bottomBound:_react.PropTypes.number,rightBound:_react.PropTypes.number}),crop:_react.PropTypes.shape({topRatio:_react.PropTypes.number,leftRatio:_react.PropTypes.number,widthRatio:_react.PropTypes.number,heightRatio:_react.PropTypes.number}),aspectRatio:_react.PropTypes.string,imageEditorCrop:_react.PropTypes.func,minCropSize:_react.PropTypes.shape({width:_react.PropTypes.number,height:_react.PropTypes.number})};ImageEditorCrop.defaultProps={degrees:0,bounds:{topBound:0,leftBound:0,bottomBound:100,rightBound:100},imageEditorCrop:_noop3.default,minCropSize:{width:50,height:50}};exports.default=(0,_reactRedux.connect)(function(state){var bounds=(0,_selectors.getImageEditorCropBounds)(state);var crop=(0,_selectors.getImageEditorCrop)(state);var aspectRatio=(0,_selectors.getImageEditorAspectRatio)(state);var _getImageEditorTransf=(0,_selectors.getImageEditorTransform)(state);var degrees=_getImageEditorTransf.degrees;return{bounds:bounds,crop:crop,aspectRatio:aspectRatio,degrees:degrees}},{imageEditorCrop:_actions.imageEditorCrop})(ImageEditorCrop);module.exports=exports["default"]},2442:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _noop2=__webpack_require__(38);var _noop3=_interopRequireDefault(_noop2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactRedux=__webpack_require__(15);var _i18nCalypso=__webpack_require__(11);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _menu=__webpack_require__(1673);var _menu2=_interopRequireDefault(_menu);var _menuItem=__webpack_require__(1652);var _menuItem2=_interopRequireDefault(_menuItem);var _constants=__webpack_require__(795);var _selectors=__webpack_require__(1928);var _actions=__webpack_require__(1927);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ImageEditorToolbar=function(_Component){(0,_inherits3.default)(ImageEditorToolbar,_Component);function ImageEditorToolbar(props){(0,_classCallCheck3.default)(this,ImageEditorToolbar);var _this=(0,_possibleConstructorReturn3.default)(this,(ImageEditorToolbar.__proto__||(0,_getPrototypeOf2.default)(ImageEditorToolbar)).call(this,props));_this.state={showAspectPopover:false};_this.setAspectMenuContext=_this.setAspectMenuContext.bind(_this);_this.onAspectOpen=_this.onAspectOpen.bind(_this);_this.onAspectClose=_this.onAspectClose.bind(_this);_this.rotate=_this.rotate.bind(_this);_this.flip=_this.flip.bind(_this);return _this}(0,_createClass3.default)(ImageEditorToolbar,[{key:"rotate",value:function rotate(){this.props.imageEditorRotateCounterclockwise()}},{key:"flip",value:function flip(){this.props.imageEditorFlip()}},{key:"onAspectOpen",value:function onAspectOpen(event){event.preventDefault();this.setState({showAspectPopover:true})}},{key:"onAspectClose",value:function onAspectClose(action){this.setState({showAspectPopover:false});if("string"===typeof action){this.props.setImageEditorAspectRatio(action)}}},{key:"setAspectMenuContext",value:function setAspectMenuContext(popoverContext){this.setState({popoverContext:popoverContext})}},{key:"renderAspectMenu",value:function renderAspectMenu(){var _state=this.state;var popoverContext=_state.popoverContext;var showAspectPopover=_state.showAspectPopover;if(!popoverContext){return}var _props=this.props;var translate=_props.translate;var aspectRatio=_props.aspectRatio;var items=[{action:_constants.AspectRatios.FREE,label:translate("Free")},{action:_constants.AspectRatios.ORIGINAL,label:translate("Original")},{action:_constants.AspectRatios.ASPECT_1X1,label:translate("Square")},{action:_constants.AspectRatios.ASPECT_16X9,label:translate("16:9")},{action:_constants.AspectRatios.ASPECT_4X3,label:translate("4:3")},{action:_constants.AspectRatios.ASPECT_3X2,label:translate("3:2")}];return _react2.default.createElement(_menu2.default,{isVisible:showAspectPopover,onClose:this.onAspectClose,position:"top",context:popoverContext,className:"image-editor__toolbar-popover popover is-dialog-visible"},items.map(function(item){return _react2.default.createElement(_menuItem2.default,{key:"image-editor-toolbar-aspect-"+item.action,action:item.action},aspectRatio===item.action?_react2.default.createElement(_gridicon2.default,{icon:"checkmark",size:12}):false,item.label)}))}},{key:"renderButtons",value:function renderButtons(){var translate=this.props.translate;var buttons=[{tool:"rotate",icon:"rotate",text:translate("Rotate"),onClick:this.rotate},{tool:"aspect",ref:this.setAspectMenuContext,icon:"layout",text:translate("Aspect"),onClick:this.onAspectOpen},{tool:"flip-vertical",icon:"flip-vertical",text:translate("Flip"),onClick:this.flip}];return buttons.map(function(button){return _react2.default.createElement("button",{key:"image-editor-toolbar-"+button.tool,ref:button.ref,className:"image-editor__toolbar-button",onClick:button.onClick},_react2.default.createElement(_gridicon2.default,{icon:button.icon}),_react2.default.createElement("span",null,button.text))})}},{key:"render",value:function render(){return _react2.default.createElement("div",{className:"image-editor__toolbar"},this.renderButtons(),this.renderAspectMenu())}}]);return ImageEditorToolbar}(_react.Component);ImageEditorToolbar.propTypes={aspectRatio:_react.PropTypes.string,imageEditorRotateCounterclockwise:_react.PropTypes.func,imageEditorFlip:_react.PropTypes.func,setImageEditorAspectRatio:_react.PropTypes.func};ImageEditorToolbar.defaultProps={imageEditorRotateCounterclockwise:_noop3.default,imageEditorFlip:_noop3.default,setImageEditorAspectRatio:_noop3.default};exports.default=(0,_reactRedux.connect)(function(state){return{aspectRatio:(0,_selectors.getImageEditorAspectRatio)(state)}},{imageEditorRotateCounterclockwise:_actions.imageEditorRotateCounterclockwise,imageEditorFlip:_actions.imageEditorFlip,setImageEditorAspectRatio:_actions.setImageEditorAspectRatio})((0,_i18nCalypso.localize)(ImageEditorToolbar));module.exports=exports["default"]},2443:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);var _noop2=__webpack_require__(38);var _noop3=_interopRequireDefault(_noop2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactRedux=__webpack_require__(15);var _path=__webpack_require__(1869);var _path2=_interopRequireDefault(_path);var _i18nCalypso=__webpack_require__(11);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _notice=__webpack_require__(76);var _notice2=_interopRequireDefault(_notice);var _imageEditorCanvas=__webpack_require__(2440);var _imageEditorCanvas2=_interopRequireDefault(_imageEditorCanvas);var _imageEditorToolbar=__webpack_require__(2442);var _imageEditorToolbar2=_interopRequireDefault(_imageEditorToolbar);var _imageEditorButtons=__webpack_require__(2439);var _imageEditorButtons2=_interopRequireDefault(_imageEditorButtons);var _actions=__webpack_require__(1662);var _actions2=_interopRequireDefault(_actions);var _utils=__webpack_require__(1647);var _utils2=_interopRequireDefault(_utils);var _closeOnEsc=__webpack_require__(428);var _closeOnEsc2=_interopRequireDefault(_closeOnEsc);var _actions3=__webpack_require__(1927);var _selectors=__webpack_require__(1928);var _selectors2=__webpack_require__(47);var _selectors3=__webpack_require__(79);var _querySites=__webpack_require__(1802);var _querySites2=_interopRequireDefault(_querySites);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ImageEditor=_react2.default.createClass({displayName:"ImageEditor",mixins:[(0,_closeOnEsc2.default)("onCancel")],propTypes:{media:_react.PropTypes.object,siteId:_react.PropTypes.number,onImageEditorSave:_react.PropTypes.func,onImageEditorCancel:_react.PropTypes.func,className:_react.PropTypes.string,site:_react.PropTypes.object,fileName:_react.PropTypes.string,setImageEditorFileInfo:_react.PropTypes.func,translate:_react.PropTypes.func},getDefaultProps:function getDefaultProps(){return{media:null,onImageEditorSave:_noop3.default,onImageEditorCancel:_noop3.default}},getInitialState:function getInitialState(){return{canvasError:null}},componentDidMount:function componentDidMount(){var _props=this.props;var media=_props.media;var site=_props.site;var src=void 0,fileName="default",mimeType="image/png",title="default";if(media){src=_utils2.default.url(media,{photon:site&&!site.is_private});fileName=media.file||_path2.default.basename(src);mimeType=_utils2.default.getMimeType(media);title=media.title}this.props.resetImageEditorState();this.props.setImageEditorFileInfo(src,fileName,mimeType,title)},onDone:function onDone(){var canvasComponent=this.refs.editCanvas.getWrappedInstance();canvasComponent.toBlob(this.onImageExtracted);if(this.props.onImageEditorSave){this.props.onImageEditorSave()}},onCancel:function onCancel(){this.props.resetAllImageEditorState();if(this.props.onImageEditorCancel){this.props.onImageEditorCancel()}},onImageExtracted:function onImageExtracted(blob){var _props2=this.props;var fileName=_props2.fileName;var site=_props2.site;var translate=_props2.translate;var mimeType=_utils2.default.getMimeType(fileName);var editedCopyText=translate("%(title)s (edited copy)",{args:{title:""}});var title=this.props.title;if(title.indexOf(editedCopyText)===-1){title=translate("%(title)s (edited copy)",{args:{title:title}})}this.props.resetAllImageEditorState();_actions2.default.add(site.ID,{fileName:fileName,fileContents:blob,title:title,mimeType:mimeType})},isValidTransfer:function isValidTransfer(transfer){if(!transfer){return false}if(transfer.mozSourceNode){return false}return!transfer.types||-1!==Array.prototype.indexOf.call(transfer.types,"Files")},onLoadCanvasError:function onLoadCanvasError(){this.setState({canvasError:this.translate("We are unable to edit this image.")})},renderError:function renderError(){return _react2.default.createElement(_notice2.default,{status:"is-error",showDismiss:true,text:this.state.canvasError,isCompact:false,onDismissClick:this.props.onImageEditorCancel})},render:function render(){var _props3=this.props;var className=_props3.className;var siteId=_props3.siteId;var classes=(0,_classnames2.default)("image-editor",className);return _react2.default.createElement("div",{className:classes},this.state.canvasError&&this.renderError(),_react2.default.createElement(_querySites2.default,{siteId:siteId}),_react2.default.createElement("figure",null,_react2.default.createElement("div",{className:"image-editor__content"},_react2.default.createElement(_imageEditorCanvas2.default,{ref:"editCanvas",onLoadError:this.onLoadCanvasError}),_react2.default.createElement(_imageEditorToolbar2.default,null),_react2.default.createElement(_imageEditorButtons2.default,{onCancel:this.onCancel,onDone:this.onDone}))))}});exports.default=(0,_reactRedux.connect)(function(state,ownProps){var siteId=ownProps.siteId;if(!siteId){siteId=(0,_selectors2.getSelectedSiteId)(state)}return(0,_extends3.default)({},(0,_selectors.getImageEditorFileInfo)(state),{site:(0,_selectors3.getSite)(state,siteId)})},{resetImageEditorState:_actions3.resetImageEditorState,resetAllImageEditorState:_actions3.resetAllImageEditorState,setImageEditorFileInfo:_actions3.setImageEditorFileInfo})((0,_i18nCalypso.localize)(ImageEditor));module.exports=exports["default"]},2495:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1);var PostFormatsActions=__webpack_require__(2639),PostFormatsStore=__webpack_require__(2640);function getStateData(siteId){return{postFormats:PostFormatsStore.get(siteId)}}module.exports=React.createClass({displayName:"PostFormatsData",propTypes:{siteId:React.PropTypes.number.isRequired},getInitialState:function getInitialState(){return getStateData(this.props.siteId)},componentDidMount:function componentDidMount(){PostFormatsStore.on("change",this.updateState);this.maybeFetchData(this.props.siteId)},componentWillUnmount:function componentWillUnmount(){PostFormatsStore.off("change",this.updateState)},componentWillReceiveProps:function componentWillReceiveProps(nextProps){if(nextProps.siteId!==this.props.siteId){this.updateState(nextProps.siteId);this.maybeFetchData(nextProps.siteId)}},maybeFetchData:function maybeFetchData(siteId){if(PostFormatsStore.get(siteId)){return}setTimeout(function(){PostFormatsActions.fetch(siteId)},0)},updateState:function updateState(siteId){this.setState(getStateData(siteId||this.props.siteId))},render:function render(){return React.cloneElement(this.props.children,this.state)}})},2498:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _react=__webpack_require__(1);var _reactRedux=__webpack_require__(15);var _redux=__webpack_require__(6);var _selectors=__webpack_require__(2372);var _actions=__webpack_require__(3306);var _store=__webpack_require__(1717);var _store2=_interopRequireDefault(_store);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var QueryMediaStorage=function(_Component){(0,_inherits3.default)(QueryMediaStorage,_Component);function QueryMediaStorage(props){(0,_classCallCheck3.default)(this,QueryMediaStorage);var _this=(0,_possibleConstructorReturn3.default)(this,(QueryMediaStorage.__proto__||(0,_getPrototypeOf2.default)(QueryMediaStorage)).call(this,props));_this.requestStorage=_this.requestStorage.bind(_this);return _this}(0,_createClass3.default)(QueryMediaStorage,[{key:"requestStorage",value:function requestStorage(){var props=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.props;if(!props.requestingMediaStorage&&props.siteId){props.requestMediaStorage(props.siteId)}}},{key:"componentWillMount",value:function componentWillMount(){this.requestStorage();_store2.default.on("fetch-media-limits",this.requestStorage)}},{key:"componentWillUnmount",value:function componentWillUnmount(){_store2.default.off("fetch-media-limits",this.requestStorage)}},{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){if(nextProps.requestingMediaStorage||!nextProps.siteId||this.props.siteId===nextProps.siteId){return}this.requestStorage(nextProps)}},{key:"render",value:function render(){return null}}]);return QueryMediaStorage}(_react.Component);QueryMediaStorage.propTypes={siteId:_react.PropTypes.number,requestingMediaStorage:_react.PropTypes.bool,requestMediaStorage:_react.PropTypes.func};QueryMediaStorage.defaultProps={requestMediaStorage:function requestMediaStorage(){}};exports.default=(0,_reactRedux.connect)(function(state,ownProps){return{requestingMediaStorage:(0,_selectors.isRequestingMediaStorage)(state,ownProps.siteId)}},function(dispatch){return(0,_redux.bindActionCreators)({requestMediaStorage:_actions.requestMediaStorage},dispatch)})(QueryMediaStorage);module.exports=exports["default"]},2500:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _react=__webpack_require__(1);var _reactRedux=__webpack_require__(15);var _selectors=__webpack_require__(2363);var _selectors2=__webpack_require__(79);var _actions=__webpack_require__(3294);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var QueryPageTemplates=function(_Component){(0,_inherits3.default)(QueryPageTemplates,_Component);function QueryPageTemplates(){(0,_classCallCheck3.default)(this,QueryPageTemplates);return(0,_possibleConstructorReturn3.default)(this,(QueryPageTemplates.__proto__||(0,_getPrototypeOf2.default)(QueryPageTemplates)).apply(this,arguments))}(0,_createClass3.default)(QueryPageTemplates,[{key:"componentWillMount",value:function componentWillMount(){this.request(this.props)}},{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){var _props=this.props;var siteId=_props.siteId;var themeSlug=_props.themeSlug;var nextSiteId=nextProps.siteId;var nextThemeSlug=nextProps.themeSlug;var hasSiteOrThemeChanged=siteId!==nextSiteId||themeSlug&&nextThemeSlug&&themeSlug!==nextThemeSlug;if(hasSiteOrThemeChanged){this.request(nextProps)}}},{key:"request",value:function request(props){if(!props.isRequesting){props.requestPageTemplates(props.siteId)}}},{key:"render",value:function render(){return null}}]);return QueryPageTemplates}(_react.Component);QueryPageTemplates.propTypes={siteId:_react.PropTypes.number.isRequired,isRequesting:_react.PropTypes.bool,requestPageTemplates:_react.PropTypes.func};exports.default=(0,_reactRedux.connect)(function(state,_ref){var siteId=_ref.siteId;return{isRequesting:(0,_selectors.isRequestingPageTemplates)(state,siteId),themeSlug:(0,_selectors2.getSiteOption)(state,siteId,"theme_slug")}},{requestPageTemplates:_actions.requestPageTemplates})(QueryPageTemplates);module.exports=exports["default"]},2505:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _react=__webpack_require__(1);var _reactRedux=__webpack_require__(15);var _actions=__webpack_require__(3295);var _selectors=__webpack_require__(2010);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var QueryTaxonomies=function(_Component){(0,_inherits3.default)(QueryTaxonomies,_Component);function QueryTaxonomies(){(0,_classCallCheck3.default)(this,QueryTaxonomies);return(0,_possibleConstructorReturn3.default)(this,(QueryTaxonomies.__proto__||(0,_getPrototypeOf2.default)(QueryTaxonomies)).apply(this,arguments))}(0,_createClass3.default)(QueryTaxonomies,[{key:"componentWillMount",value:function componentWillMount(){this.request(this.props)}},{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){if(this.props.siteId===nextProps.siteId&&this.props.postType===nextProps.postType){return}this.request(nextProps)}},{key:"request",value:function request(props){if(props.requesting){return}props.requestPostTypeTaxonomies(props.siteId,props.postType)}},{key:"shouldComponentUpdate",value:function shouldComponentUpdate(){return false}},{key:"render",value:function render(){return null}}]);return QueryTaxonomies}(_react.Component);QueryTaxonomies.propTypes={siteId:_react.PropTypes.number.isRequired,postType:_react.PropTypes.string.isRequired,requesting:_react.PropTypes.bool.isRequired,requestPostTypeTaxonomies:_react.PropTypes.func.isRequired};exports.default=(0,_reactRedux.connect)(function(state,ownProps){return{requesting:(0,_selectors.isRequestingPostTypeTaxonomies)(state,ownProps.siteId,ownProps.postType)}},{requestPostTypeTaxonomies:_actions.requestPostTypeTaxonomies})(QueryTaxonomies);module.exports=exports["default"]},2510:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1),noop=__webpack_require__(38),classNames=__webpack_require__(10);var Tooltip=__webpack_require__(722);module.exports=React.createClass({displayName:"DatePickerDay",propTypes:{date:React.PropTypes.object.isRequired,events:React.PropTypes.array},getInitialState:function getInitialState(){return{showTooltip:false}},isPastDay:function isPastDay(date){var today=this.moment().set({hour:0,minute:0,second:0,millisecond:0});date=date||this.props.date;return+today-1>=+date},handleTooltip:function handleTooltip(show){var showTooltip=!!this.props.events.length&&show;this.setState({showTooltip:showTooltip})},renderTooltip:function renderTooltip(){var label;if(!this.state.showTooltip){return}label=this.translate("%(posts)d post","%(posts)d posts",{count:this.props.events.length,args:{posts:this.props.events.length}});return React.createElement(Tooltip,{context:this.refs.dayTarget,isVisible:this.state.showTooltip,onClose:noop},React.createElement("span",null,label),React.createElement("hr",{
className:"tooltip__hr"}),React.createElement("ul",null,this.props.events.map(function(event){return React.createElement("li",{key:event.id},event.title)})))},render:function render(){var classes={"date-picker__day":true},i=0,dayEvent;classes["is-selected"]=this.props.selected===true;classes["past-day"]=this.isPastDay()===true;if(this.props.events.length){classes["date-picker__day_event"]=true;for(i;i<this.props.events.length;i++){dayEvent=this.props.events[i];if(dayEvent.type&&!classes["date-picker__day_event_"+dayEvent.type]){classes["date-picker__day_event_"+dayEvent.type]=true}}}return React.createElement("div",{ref:"dayTarget",className:classNames(classes),onMouseEnter:this.handleTooltip.bind(this,true),onMouseLeave:this.handleTooltip.bind(this,false)},React.createElement("span",{key:"selected-"+(this.props.date.getTime()/1e3|0),className:"date-picker__day-selected"}),React.createElement("span",{className:"date-picker__day-text"},this.props.date.getDate()),this.renderTooltip())}})},2511:function(module,exports,__webpack_require__){"use strict";var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactDayPicker=__webpack_require__(3541);var _reactDayPicker2=_interopRequireDefault(_reactDayPicker);var _merge=__webpack_require__(58);var _merge2=_interopRequireDefault(_merge);var _noop=__webpack_require__(38);var _noop2=_interopRequireDefault(_noop);var _day=__webpack_require__(2510);var _day2=_interopRequireDefault(_day);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}module.exports=_react2.default.createClass({displayName:"DatePicker",propTypes:{calendarViewDate:_react2.default.PropTypes.object,enableOutsideDays:_react2.default.PropTypes.bool,events:_react2.default.PropTypes.array,locale:_react2.default.PropTypes.object,selectedDay:_react2.default.PropTypes.object,timeReference:_react2.default.PropTypes.object,onMonthChange:_react2.default.PropTypes.func,onSelectDay:_react2.default.PropTypes.func},getDefaultProps:function getDefaultProps(){return{enableOutsideDays:true,calendarViewDate:new Date,selectedDay:null,onMonthChange:_noop2.default,onSelectDay:_noop2.default}},isSameDay:function isSameDay(d0,d1){d0=this.moment(d0);d1=this.moment(d1);return d0.isSame(d1,"day")},filterEventsByDay:function filterEventsByDay(day){var i,event,eventsInDay=[];if(!this.props.events){return[]}for(i=0;i<this.props.events.length;i++){event=this.props.events[i];if(this.isSameDay(event.date,day)){eventsInDay.push(event)}}return eventsInDay},locale:function locale(){var moment=this.moment,localeData=moment().localeData(),locale={formatDay:function formatDay(date){return moment(date).format("llll")},formatMonthTitle:function formatMonthTitle(date){return moment(date).format("MMMM YYYY")},formatWeekdayShort:function formatWeekdayShort(day){return moment().weekday(day).format("dd")[0]},formatWeekdayLong:function formatWeekdayLong(day){return moment().weekday(day).format("dddd")},getFirstDayOfWeek:function getFirstDayOfWeek(){return Number(localeData.firstDayOfWeek())}};return(0,_merge2.default)(locale,this.props.locale)},setCalendarDay:function setCalendarDay(event,clickedDay){clickedDay=this.moment(clickedDay);var modifiers={year:clickedDay.year(),month:clickedDay.month(),date:clickedDay.date()};var date=(this.props.timeReference||clickedDay).set(modifiers);this.props.onSelectDay(date,modifiers)},handleCaptionClick:function handleCaptionClick(){var daypicker=this.refs.daypicker;daypicker.showMonth(new Date)},renderDay:function renderDay(day){var isSelected=this.props.selectedDay&&this.isSameDay(this.props.selectedDay,day);return _react2.default.createElement(_day2.default,{selected:isSelected,events:this.filterEventsByDay(day),date:day})},render:function render(){return _react2.default.createElement("div",{className:"date-picker_container"},_react2.default.createElement(_reactDayPicker2.default,{ref:"daypicker",className:"date-picker",initialMonth:this.props.calendarViewDate,renderDay:this.renderDay,localeUtils:this.locale(),onDayClick:this.setCalendarDay,onMonthChange:this.props.onMonthChange,enableOutsideDays:this.props.enableOutsideDays,onCaptionClick:this.handleCaptionClick}))}})},2512:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);var _keys=__webpack_require__(39);var _keys2=_interopRequireDefault(_keys);var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _noop=__webpack_require__(38);var _noop2=_interopRequireDefault(_noop);var _omit=__webpack_require__(18);var _omit2=_interopRequireDefault(_omit);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var Draggable=function(_Component){(0,_inherits3.default)(Draggable,_Component);function Draggable(props){(0,_classCallCheck3.default)(this,Draggable);var _this=(0,_possibleConstructorReturn3.default)(this,(Draggable.__proto__||(0,_getPrototypeOf2.default)(Draggable)).call(this,props));_this.state={x:_this.props.x,y:_this.props.y};_this.onTouchStartHandler=_this.onTouchStartHandler.bind(_this);_this.onMouseDownHandler=_this.onMouseDownHandler.bind(_this);_this.draggingHandler=_this.draggingHandler.bind(_this);_this.draggingEndedHandler=_this.draggingEndedHandler.bind(_this);_this.update=_this.update.bind(_this);return _this}(0,_createClass3.default)(Draggable,[{key:"componentWillReceiveProps",value:function componentWillReceiveProps(newProps){if(this.state.x!==newProps.x||this.state.y!==newProps.y){this.setState({x:newProps.x,y:newProps.y})}}},{key:"componentWillUnmount",value:function componentWillUnmount(){this.removeListeners()}},{key:"draggingStartedHandler",value:function draggingStartedHandler(event){this.dragging=true;var coords=event;if(this.isTouchEvent(event)){coords=event.touches[0]}this.relativePos={x:coords.pageX-this.state.x,y:coords.pageY-this.state.y};cancelAnimationFrame(this.frameRequestId);this.frameRequestId=requestAnimationFrame(this.update)}},{key:"isTouchEvent",value:function isTouchEvent(event){return(!event.pageX||!event.pageY)&&event.targetTouches&&event.targetTouches.length}},{key:"draggingHandler",value:function draggingHandler(event){var coords=event;if(this.isTouchEvent(event)){coords=event.touches[0]}var x=coords.pageX-this.relativePos.x,y=coords.pageY-this.relativePos.y;this.mousePos={x:x,y:y}}},{key:"draggingEndedHandler",value:function draggingEndedHandler(){this.dragging=false;this.mousePos=null;cancelAnimationFrame(this.frameRequestId);this.removeListeners();this.props.onStop()}},{key:"onTouchStartHandler",value:function onTouchStartHandler(event){event.preventDefault();document.addEventListener("touchmove",this.draggingHandler);document.addEventListener("touchend",this.draggingEndedHandler);this.draggingStartedHandler(event)}},{key:"onMouseDownHandler",value:function onMouseDownHandler(event){event.preventDefault();document.addEventListener("mousemove",this.draggingHandler);document.addEventListener("mouseup",this.draggingEndedHandler);this.draggingStartedHandler(event)}},{key:"update",value:function update(){if(!this.mousePos){this.frameRequestId=requestAnimationFrame(this.update);return}var bounds=this.props.bounds;var _mousePos=this.mousePos;var x=_mousePos.x;var y=_mousePos.y;if(bounds){x=Math.max(bounds.left,Math.min(bounds.right-this.props.width,x));y=Math.max(bounds.top,Math.min(bounds.bottom-this.props.height,y))}if(this.dragging){this.frameRequestId=requestAnimationFrame(this.update)}this.props.onDrag(x,y);if(this.props.controlled){return}this.setState({x:x,y:y})}},{key:"removeListeners",value:function removeListeners(){document.removeEventListener("mousemove",this.draggingHandler);document.removeEventListener("mouseup",this.draggingEndedHandler);document.removeEventListener("touchmove",this.draggingHandler);document.removeEventListener("touchend",this.draggingEndedHandler)}},{key:"render",value:function render(){var elementProps=(0,_omit2.default)(this.props,(0,_keys2.default)(this.constructor.propTypes)),style={transform:"translate("+this.state.x+"px, "+this.state.y+"px)"};if(this.props.width||this.props.height){style.width=this.props.width+"px";style.height=this.props.height+"px"}return _react2.default.createElement("div",(0,_extends3.default)({},elementProps,{style:style,onMouseDown:this.onMouseDownHandler,onTouchStart:this.onTouchStartHandler}))}}]);return Draggable}(_react.Component);Draggable.propTypes={onDrag:_react.PropTypes.func,onStop:_react.PropTypes.func,width:_react.PropTypes.number,height:_react.PropTypes.number,x:_react.PropTypes.number,y:_react.PropTypes.number,controlled:_react.PropTypes.bool,bounds:_react.PropTypes.shape({top:_react.PropTypes.number,left:_react.PropTypes.number,bottom:_react.PropTypes.number,right:_react.PropTypes.number})};Draggable.defaultProps={onDrag:_noop2.default,onStop:_noop2.default,width:0,height:0,x:0,y:0,controlled:false,bounds:null};exports.default=Draggable;module.exports=exports["default"]},2521:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _chronoNode=__webpack_require__(3318);var _chronoNode2=_interopRequireDefault(_chronoNode);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var supportedLanguages=["en","jp"];exports.default=_react2.default.createClass({displayName:"InputChrono",focused:false,propTypes:{value:_react2.default.PropTypes.string,lang:_react2.default.PropTypes.string,onSet:_react2.default.PropTypes.func,placeholder:_react2.default.PropTypes.string},getDefaultProps:function getDefaultProps(){return{value:"",lang:"",placeholder:"",onSet:function onSet(){}}},getInitialState:function getInitialState(){return{value:this.props.value}},componentWillReceiveProps:function componentWillReceiveProps(nextProps){if(!this.focused&&this.props.value!==nextProps.value){this.setState({value:nextProps.value})}},handleChange:function handleChange(event){this.setState({value:event.target.value})},handleBlur:function handleBlur(event){this.setDateText(event);this.focused=false},handleFocus:function handleFocus(){this.focused=true},onKeyDown:function onKeyDown(event){if(13!==event.keyCode){return}this.setDateText(event)},setDateText:function setDateText(event){var date=_chronoNode2.default.parseDate(event.target.value);if(date){this.setState({value:this.moment(date).calendar()});this.props.onSet(this.moment(date))}},isLangSupported:function isLangSupported(lang){return supportedLanguages.indexOf(lang)>=0},render:function render(){return _react2.default.createElement("div",{className:"input-chrono__container"},this.isLangSupported(this.props.lang)?_react2.default.createElement("input",{className:"input-chrono",value:this.state.value,placeholder:this.props.placeholder,onKeyDown:this.onKeyDown,onChange:this.handleChange,onFocus:this.handleFocus,onBlur:this.handleBlur}):_react2.default.createElement("div",{className:"text-chrono"},this.state.value))}});module.exports=exports["default"]},2525:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _i18nCalypso=__webpack_require__(11);var _i18nCalypso2=_interopRequireDefault(_i18nCalypso);var _infoPopover=__webpack_require__(1725);var _infoPopover2=_interopRequireDefault(_infoPopover);var _viewport=__webpack_require__(92);var _viewport2=_interopRequireDefault(_viewport);var _utils=__webpack_require__(2055);var _utils2=_interopRequireDefault(_utils);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var noop=function noop(){};function checkTimeValue(value){if(value!=="0"&&value!=="00"&&(value[0]==="0"||Number(value)>99)){value=value.substr(1)}if(!(isNaN(Number(value))||Number(value)<0||value.length>2)){return value}return false}var PostScheduleClock=function(_Component){(0,_inherits3.default)(PostScheduleClock,_Component);function PostScheduleClock(){(0,_classCallCheck3.default)(this,PostScheduleClock);return(0,_possibleConstructorReturn3.default)(this,(PostScheduleClock.__proto__||(0,_getPrototypeOf2.default)(PostScheduleClock)).apply(this,arguments))}(0,_createClass3.default)(PostScheduleClock,[{key:"handleKeyDown",value:function handleKeyDown(field,event){var operation=event.keyCode-39,value=Number(event.target.value),modifiers=this.getTimeValues();if(!(-1===operation||1===operation)){return null}value-=operation;if("hour"===field){value=value>23?0:value;value=value<0?23:value}else{value=value>59?0:value;value=value<0?59:value}modifiers[field]=value;this.setTime(modifiers)}},{key:"getTimeValues",value:function getTimeValues(){var modifiers={},hour=checkTimeValue(this.refs.timeHourRef.value),minute=checkTimeValue(this.refs.timeMinuteRef.value);if(false!==hour&&hour<24){modifiers.hour=Number(hour)}if(false!==minute&&minute<=59){modifiers.minute=Number(minute)}return modifiers}},{key:"setTime",value:function setTime(modifiers){var date=_i18nCalypso2.default.moment(this.props.date).set(modifiers);this.props.onChange(date,modifiers)}},{key:"render",value:function render(){var _this2=this;return _react2.default.createElement("div",{className:"post-schedule__clock"},_react2.default.createElement("input",{className:"post-schedule__clock_time",name:"post-schedule__clock_hour",ref:"timeHourRef",value:this.props.date.format("HH"),onChange:function onChange(){_this2.setTime(_this2.getTimeValues())},onKeyDown:this.handleKeyDown.bind(this,"hour"),type:"text"}),_react2.default.createElement("span",{className:"post-schedule__clock-divisor"},":"),_react2.default.createElement("input",{className:"post-schedule__clock_time",name:"post-schedule__clock_minute",ref:"timeMinuteRef",value:this.props.date.format("mm"),onChange:function onChange(){_this2.setTime(_this2.getTimeValues())},onKeyDown:this.handleKeyDown.bind(this,"minute"),type:"text"}),this.renderTimezoneBox())}},{key:"renderTimezoneBox",value:function renderTimezoneBox(){if(!(this.props.timezone||_utils2.default.isValidGMTOffset(this.props.gmtOffset))){return}var diffInHours=void 0,formatZ=void 0;if(this.props.timezone){var tzDate=this.props.date.clone().tz(this.props.timezone);diffInHours=tzDate.utcOffset()-_i18nCalypso2.default.moment().utcOffset();formatZ=tzDate.format(" Z ")}else if(_utils2.default.isValidGMTOffset(this.props.gmtOffset)){var utcDate=this.props.date.clone().utcOffset(this.props.gmtOffset);diffInHours=utcDate.utcOffset()-_i18nCalypso2.default.moment().utcOffset();formatZ=utcDate.format(" Z ")}if(!diffInHours){return}diffInHours=diffInHours/60;diffInHours=Math.round(diffInHours*100)/100;diffInHours=(diffInHours>0?"+":"")+diffInHours+"h";var popoverPosition=_viewport2.default.isMobile()?"top":"right";return _react2.default.createElement("span",null,_react2.default.createElement("div",{className:"post-schedule__clock-timezone"},_i18nCalypso2.default.translate("Site %(diff)s from you",{args:{diff:diffInHours}}),_react2.default.createElement(_infoPopover2.default,{className:"post-schedule__timezone-info",position:popoverPosition},this.props.timezone?this.props.timezone.replace(/(\/)/gi," $1 "):"UTC",formatZ)))}}]);return PostScheduleClock}(_react.Component);PostScheduleClock.propTypes={date:_react.PropTypes.object.isRequired,timezone:_react.PropTypes.string,gmtOffset:_react.PropTypes.number,onChange:_react.PropTypes.func};PostScheduleClock.defaultProps={onChange:noop};exports.default=PostScheduleClock;module.exports=exports["default"]},2526:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var noop=function noop(){};exports.default=_react2.default.createClass({displayName:"header-controls",propTypes:{onYearChange:_react2.default.PropTypes.func},getDefaultProps:function getDefaultProps(){return{onYearChange:noop}},render:function render(){var _this=this;return _react2.default.createElement("div",{className:"post-schedule__year-controls"},_react2.default.createElement("button",{className:"post-schedule__year-control-up",onClick:function onClick(){_this.props.onYearChange(1)}},_react2.default.createElement(_gridicon2.default,{icon:"chevron-up",size:14})),_react2.default.createElement("button",{className:"post-schedule__year-control-down",onClick:function onClick(){_this.props.onYearChange(-1)}},_react2.default.createElement(_gridicon2.default,{icon:"chevron-down",size:14})))}});module.exports=exports["default"]},2527:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _headerControls=__webpack_require__(2526);var _headerControls2=_interopRequireDefault(_headerControls);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var noop=function noop(){};exports.default=_react2.default.createClass({displayName:"header",propTypes:{date:_react2.default.PropTypes.object,onDateChange:_react2.default.PropTypes.func},getDefaultProps:function getDefaultProps(){return{onDateChange:noop}},getInitialState:function getInitialState(){return{showYearControls:false}},setToCurrentMonth:function setToCurrentMonth(){var month=this.moment().month();this.props.onDateChange(this.props.date.month(month))},setToCurrentYear:function setToCurrentYear(){var year=this.moment().year();this.props.onDateChange(this.props.date.year(year))},setYear:function setYear(modifier){var date=this.moment(this.props.date);date.year(date.year()+modifier);if(0>date.year()||date.year()>9999){return null}this.props.onDateChange(date)},render:function render(){var _this=this;return _react2.default.createElement("div",{className:"post-schedule__header"},_react2.default.createElement("span",{className:"post-schedule__header-month",onClick:this.setToCurrentMonth},this.props.date.format("MMMM")),_react2.default.createElement("div",{className:"post-schedule__header-year",onMouseEnter:function onMouseEnter(){_this.setState({showYearControls:true})},onMouseLeave:function onMouseLeave(){_this.setState({showYearControls:false})}},_react2.default.createElement("span",{onClick:this.setToCurrentYear},this.props.date.format("YYYY")),this.state.showYearControls&&_react2.default.createElement(_headerControls2.default,{onYearChange:this.setYear})))}});module.exports=exports["default"]},2534:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _react=__webpack_require__(1);var _utils=__webpack_require__(1940);var _pick=__webpack_require__(91);var _pick2=_interopRequireDefault(_pick);var _store=__webpack_require__(2281);var _store2=_interopRequireDefault(_store);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ShortcodeData=function(_Component){(0,_inherits3.default)(ShortcodeData,_Component);function ShortcodeData(){(0,_classCallCheck3.default)(this,ShortcodeData);return(0,_possibleConstructorReturn3.default)(this,(ShortcodeData.__proto__||(0,_getPrototypeOf2.default)(ShortcodeData)).apply(this,arguments))}(0,_createClass3.default)(ShortcodeData,[{key:"render",value:function render(){var _props=this.props;var children=_props.children;var filterRenderResult=_props.filterRenderResult;var props=(0,_pick2.default)(this.state.data,"body","scripts","styles");return(0,_react.cloneElement)(children,filterRenderResult(props))}}],[{key:"getStores",value:function getStores(){return[_store2.default]}},{key:"calculateState",value:function calculateState(prevState,props){var siteId=props.siteId;var shortcode=props.shortcode;return{data:_store2.default.get(siteId,shortcode)}}}]);return ShortcodeData}(_react.Component);ShortcodeData.propTypes={siteId:_react.PropTypes.number.isRequired,shortcode:_react.PropTypes.string.isRequired,filterRenderResult:_react.PropTypes.func};ShortcodeData.defaultProps={filterRenderResult:function filterRenderResult(props){return props}};exports.default=_utils.Container.create(ShortcodeData,{withProps:true});module.exports=exports["default"]},2535:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);var _stringify=__webpack_require__(40);var _stringify2=_interopRequireDefault(_stringify);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _omit=__webpack_require__(18);var _omit2=_interopRequireDefault(_omit);var _isEqual=__webpack_require__(98);var _isEqual2=_interopRequireDefault(_isEqual);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _embedFrameMarkup=__webpack_require__(2239);var _embedFrameMarkup2=_interopRequireDefault(_embedFrameMarkup);var _resizableIframe=__webpack_require__(1966);var _resizableIframe2=_interopRequireDefault(_resizableIframe);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"ShortcodeFrame",propTypes:{body:_react.PropTypes.string,scripts:_react.PropTypes.object,style:_react.PropTypes.object,onLoad:_react.PropTypes.func,className:_react.PropTypes.string},getDefaultProps:function getDefaultProps(){return{onLoad:function onLoad(){}}},getInitialState:function getInitialState(){return{html:""}},componentDidMount:function componentDidMount(){this.updateHtmlState(this.props)},componentWillReceiveProps:function componentWillReceiveProps(nextProps){if(!(0,_isEqual2.default)(this.props,nextProps)){this.updateHtmlState(nextProps)}},shouldComponentUpdate:function shouldComponentUpdate(nextProps,nextState){return nextState.html!==this.state.html},updateHtmlState:function updateHtmlState(props){this.setState({html:(0,_embedFrameMarkup2.default)(props)})},onFrameLoad:function onFrameLoad(event){event.target.contentWindow.postMessage((0,_stringify2.default)({content:this.state.html}),"*");this.props.onLoad(event)},render:function render(){var classes=(0,_classnames2.default)("shortcode-frame",this.props.className);if(!this.state.html){return null}var key=Math.random();return _react2.default.createElement(_resizableIframe2.default,(0,_extends3.default)({key:key},(0,_omit2.default)(this.props,"body","scripts","styles"),{src:"https://wpcomwidgets.com/render/",onLoad:this.onFrameLoad,frameBorder:"0",sandbox:"allow-scripts",className:classes}))}});module.exports=exports["default"]},2540:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _autosize=__webpack_require__(2218);var _autosize2=_interopRequireDefault(_autosize);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var TextareaAutosize=function(_Component){(0,_inherits3.default)(TextareaAutosize,_Component);function TextareaAutosize(){(0,_classCallCheck3.default)(this,TextareaAutosize);return(0,_possibleConstructorReturn3.default)(this,(TextareaAutosize.__proto__||(0,_getPrototypeOf2.default)(TextareaAutosize)).apply(this,arguments))}(0,_createClass3.default)(TextareaAutosize,[{key:"componentDidMount",value:function componentDidMount(){(0,_autosize2.default)(this.refs.textarea)}},{key:"componentWillUnmount",value:function componentWillUnmount(){_autosize2.default.destroy(this.refs.textarea)}},{key:"componentDidUpdate",value:function componentDidUpdate(prevProps){if(this.props.value!==prevProps.value){this.resize()}}},{key:"resize",value:function resize(){_autosize2.default.update(this.refs.textarea)}},{key:"render",value:function render(){var classes=(0,_classnames2.default)("textarea-autosize",this.props.className);return _react2.default.createElement("textarea",(0,_extends3.default)({ref:"textarea"},this.props,{className:classes}))}}]);return TextareaAutosize}(_react.Component);TextareaAutosize.propTypes={className:_react.PropTypes.string};exports.default=TextareaAutosize;module.exports=exports["default"]},2542:function(module,exports,__webpack_require__){"use strict";var i18n=__webpack_require__(11);module.exports={Formats:i18n.translate("Formats",{context:"TinyMCE"}),Headings:i18n.translate("Headings",{context:"TinyMCE"}),"Heading 1":i18n.translate("Heading 1"),"Heading 2":i18n.translate("Heading 2"),"Heading 3":i18n.translate("Heading 3"),"Heading 4":i18n.translate("Heading 4"),"Heading 5":i18n.translate("Heading 5"),"Heading 6":i18n.translate("Heading 6"),Blocks:i18n.translate("Blocks",{context:"TinyMCE",comment:"block tags"}),Paragraph:i18n.translate("Paragraph"),Blockquote:i18n.translate("Blockquote"),Div:i18n.translate("Div",{context:"HTML tag"}),Pre:i18n.translate("Pre",{context:"HTML tag"}),Preformatted:i18n.translate("Preformatted",{context:"HTML tag"}),Address:i18n.translate("Address",{context:"HTML tag"}),Inline:i18n.translate("Inline",{context:"HTML elements"}),Underline:i18n.translate("Underline"),Strikethrough:i18n.translate("Strikethrough"),Subscript:i18n.translate("Subscript"),Superscript:i18n.translate("Superscript"),"Clear formatting":i18n.translate("Clear formatting"),Bold:i18n.translate("Bold"),Italic:i18n.translate("Italic"),"Source code":i18n.translate("Source code"),"Font Family":i18n.translate("Font Family"),"Font Sizes":i18n.translate("Font Sizes"),"Align center":i18n.translate("Align center"),"Align right":i18n.translate("Align right"),"Align left":i18n.translate("Align left"),Justify:i18n.translate("Justify"),"Increase indent":i18n.translate("Increase indent"),"Decrease indent":i18n.translate("Decrease indent"),Cut:i18n.translate("Cut"),Copy:i18n.translate("Copy"),Paste:i18n.translate("Paste"),"Select all":i18n.translate("Select all"),Undo:i18n.translate("Undo"),Redo:i18n.translate("Redo"),Ok:i18n.translate("OK"),Cancel:i18n.translate("Cancel"),Close:i18n.translate("Close"),"Visual aids":i18n.translate("Visual aids"),"Paste is now in plain text mode. Contents will now be pasted as plain text until you toggle this option off.":i18n.translate("Paste is now in plain text mode. Contents will now be pasted as plain text until you toggle this option off.")+"\n\n"+i18n.translate("If youre looking to paste rich content from Microsoft Word, try turning this option off. The editor will clean up text pasted from Word automatically."),"Rich Text Area. Press ALT-F9 for menu. Press ALT-F10 for toolbar. Press ALT-0 for help":i18n.translate("Rich Text Area. Press Alt-Shift-H for help"),"You have unsaved changes are you sure you want to navigate away?":i18n.translate("The changes you made will be lost if you navigate away from this page."),"Your browser doesn't support direct access to the clipboard. Please use the Ctrl+X/C/V keyboard shortcuts instead.":i18n.translate("Your browser does not support direct access to the clipboard. Please use keyboard shortcuts or your browsers edit menu instead."),"Bullet list":i18n.translate("Bulleted list"),"Numbered list":i18n.translate("Numbered list"),"Toolbar Toggle":i18n.translate("Toolbar Toggle"),"Insert Read More tag":i18n.translate("Insert Read More tag"),"Insert Page Break tag":i18n.translate("Insert Page Break tag"),"No alignment":i18n.translate("No alignment"),Remove:i18n.translate("Remove"),"Edit ":i18n.translate("Edit"),"Horizontal line":i18n.translate("Horizontal line"),"Text color":i18n.translate("Text color"),"Paste as text":i18n.translate("Paste as text")}},2543:function(module,exports,__webpack_require__){"use strict";var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);var _plugin=__webpack_require__(2586);var _plugin2=_interopRequireDefault(_plugin);var _plugin3=__webpack_require__(2567);var _plugin4=_interopRequireDefault(_plugin3);var _plugin5=__webpack_require__(2571);var _plugin6=_interopRequireDefault(_plugin5);var _plugin7=__webpack_require__(2569);var _plugin8=_interopRequireDefault(_plugin7);var _plugin9=__webpack_require__(2575);var _plugin10=_interopRequireDefault(_plugin9);var _plugin11=__webpack_require__(2572);var _plugin12=_interopRequireDefault(_plugin11);var _plugin13=__webpack_require__(2587);var _plugin14=_interopRequireDefault(_plugin13);var _plugin15=__webpack_require__(2589);var _plugin16=_interopRequireDefault(_plugin15);var _plugin17=__webpack_require__(2563);var _plugin18=_interopRequireDefault(_plugin17);var _plugin19=__webpack_require__(2544);var _plugin20=_interopRequireDefault(_plugin19);var _plugin21=__webpack_require__(2573);var _plugin22=_interopRequireDefault(_plugin21);var _plugin23=__webpack_require__(2566);var _plugin24=_interopRequireDefault(_plugin23);var _plugin25=__webpack_require__(2558);var _plugin26=_interopRequireDefault(_plugin25);var _plugin27=__webpack_require__(2548);var _plugin28=_interopRequireDefault(_plugin27);var _plugin29=__webpack_require__(2557);var _plugin30=_interopRequireDefault(_plugin29);var _plugin31=__webpack_require__(2546);var _plugin32=_interopRequireDefault(_plugin31);var _plugin33=__webpack_require__(2590);var _plugin34=_interopRequireDefault(_plugin33);var _plugin35=__webpack_require__(2565);var _plugin36=_interopRequireDefault(_plugin35);var _plugin37=__webpack_require__(2560);var _plugin38=_interopRequireDefault(_plugin37);var _formatting=__webpack_require__(81);
function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ReactDom=__webpack_require__(44),React=__webpack_require__(1),classnames=__webpack_require__(10),autosize=__webpack_require__(2218),forEach=__webpack_require__(114),assign=__webpack_require__(34),tinymce=__webpack_require__(1675);__webpack_require__(3477);__webpack_require__(3470);__webpack_require__(3471);__webpack_require__(3472);__webpack_require__(3473);__webpack_require__(3474);__webpack_require__(3475);__webpack_require__(3476);[_plugin2.default,_plugin4.default,_plugin6.default,_plugin8.default,_plugin10.default,_plugin12.default,_plugin14.default,_plugin16.default,_plugin38.default,_plugin18.default,_plugin20.default,_plugin22.default,_plugin24.default,_plugin26.default,_plugin28.default,_plugin30.default,_plugin32.default,_plugin34.default,_plugin36.default].forEach(function(initializePlugin){return initializePlugin()});var user=__webpack_require__(48)(),i18n=__webpack_require__(2542),viewport=__webpack_require__(92),config=__webpack_require__(12);var _instance=1;var DUMMY_LANG_URL="/do-not-load/";var EVENTS={activate:"onActivate",blur:"onBlur",change:"onChange",input:"onInput",keyUp:"onKeyUp",deactivate:"onDeactivate",focus:"onFocus",hide:"onHide",init:"onInit",redo:"onRedo",remove:"onRemove",reset:"onReset",show:"onShow",submit:"onSubmit",undo:"onUndo",setContent:"onSetContent"};var PLUGINS=["colorpicker","hr","lists","media","paste","tabfocus","textcolor","wptextpattern","wpcom","wpeditimage","wplink","AtD","wpcom/autoresize","wpcom/media","wpcom/advanced","wpcom/help","wpcom/charmap","wpcom/tabindex","wpcom/touchscrolltoolbar","wpcom/view","wpcom/editorbuttonanalytics","wpcom/calypsoalert","wpcom/tabindex","wpcom/toolbarpin","wpcom/contactform","wpcom/sourcecode"];if(config.isEnabled("post-editor/insert-menu")){PLUGINS.push("wpcom/insertmenu")}var CONTENT_CSS=[window.app.tinymceWpSkin,"//s1.wp.com/wp-includes/css/dashicons.css",window.app.tinymceEditorCss,"//s1.wp.com/i/fonts/merriweather/merriweather.css"];module.exports=React.createClass({displayName:"TinyMCE",propTypes:{mode:React.PropTypes.string,onActivate:React.PropTypes.func,onBlur:React.PropTypes.func,onChange:React.PropTypes.func,onDeactivate:React.PropTypes.func,onFocus:React.PropTypes.func,onHide:React.PropTypes.func,onInit:React.PropTypes.func,onRedo:React.PropTypes.func,onRemove:React.PropTypes.func,onReset:React.PropTypes.func,onShow:React.PropTypes.func,onSubmit:React.PropTypes.func,onUndo:React.PropTypes.func,onSetContent:React.PropTypes.func,tabIndex:React.PropTypes.number,isNew:React.PropTypes.bool,onTextEditorChange:React.PropTypes.func,onKeyUp:React.PropTypes.func},contextTypes:{store:React.PropTypes.object},getDefaultProps:function getDefaultProps(){return{mode:"tinymce",isNew:false}},getInitialState:function getInitialState(){return{content:""}},_editor:null,componentWillMount:function componentWillMount(){this._id="tinymce-"+_instance;_instance++},componentDidUpdate:function componentDidUpdate(prevProps){if(!this._editor){return}this.bindEditorEvents(prevProps);if(this.props.mode!==prevProps.mode){this.toggleEditor()}},componentDidMount:function componentDidMount(){this.mounted=true;var setup=function(editor){var _this=this;this._editor=editor;if(!this.mounted){this.destroyEditor();return}this.bindEditorEvents();editor.on("SetTextAreaContent",function(event){return _this.setTextAreaContent(event.content)});if(!viewport.isMobile()){editor.once("PostRender",this.toggleEditor.bind(this,{autofocus:!this.props.isNew}))}}.bind(this);this.localize();tinymce.init({selector:"#"+this._id,skin_url:"//s1.wp.com/wp-includes/js/tinymce/skins/lightgray",skin:"lightgray",content_css:CONTENT_CSS.join(","),language:user.get()?user.get().localeSlug:"en",language_url:DUMMY_LANG_URL,directionality:user.isRTL()?"rtl":"ltr",formats:{alignleft:[{selector:"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li",styles:{textAlign:"left"}},{selector:"img,table,dl.wp-caption",classes:"alignleft"}],aligncenter:[{selector:"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li",styles:{textAlign:"center"}},{selector:"img,table,dl.wp-caption",classes:"aligncenter"}],alignright:[{selector:"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li",styles:{textAlign:"right"}},{selector:"img,table,dl.wp-caption",classes:"alignright"}],strikethrough:{inline:"del"}},relative_urls:false,remove_script_host:false,convert_urls:false,browser_spellcheck:true,fix_list_elements:true,entities:"38,amp,60,lt,62,gt",entity_encoding:"raw",keep_styles:false,wpeditimage_html5_captions:true,redux_store:this.context.store,preview_styles:"font-family font-size font-weight font-style text-decoration text-transform",end_container_on_empty_block:true,plugins:PLUGINS.join(),statusbar:false,resize:false,menubar:false,indent:false,atd_rpc_id:"https://wordpress.com",atd_ignore_enable:true,autoresize_min_height:Math.max(document.documentElement.clientHeight-300,300),toolbar1:config.isEnabled("post-editor/insert-menu")?"wpcom_insert_menu,formatselect,bold,italic,bullist,numlist,link,blockquote,alignleft,aligncenter,alignright,spellchecker,wp_more,wpcom_advanced":"wpcom_add_media,formatselect,bold,italic,bullist,numlist,link,blockquote,alignleft,aligncenter,alignright,spellchecker,wp_more,wpcom_add_contact_form,wpcom_advanced",toolbar2:"strikethrough,underline,hr,alignjustify,forecolor,pastetext,removeformat,wp_charmap,outdent,indent,undo,redo,wp_help",toolbar3:"",toolbar4:"",tabfocus_elements:"content-html,save-post",tabindex:this.props.tabIndex,body_class:"content post-type-post post-status-draft post-format-standard locale-en-us",add_unload_trigger:false,setup:setup});autosize(ReactDom.findDOMNode(this.refs.text))},componentWillUnmount:function componentWillUnmount(){this.mounted=false;if(this._editor){this.destroyEditor()}},destroyEditor:function destroyEditor(){forEach(EVENTS,function(eventHandler,eventName){if(this.props[eventHandler]){this._editor.off(eventName,this.props[eventHandler])}}.bind(this));tinymce.remove(this._editor);this._editor=null;autosize.destroy(ReactDom.findDOMNode(this.refs.text))},doAutosizeUpdate:function doAutosizeUpdate(){autosize.update(ReactDom.findDOMNode(this.refs.text))},bindEditorEvents:function bindEditorEvents(prevProps){prevProps=prevProps||{};forEach(EVENTS,function(eventHandler,eventName){if(prevProps[eventHandler]!==this.props[eventHandler]){if(this.props[eventHandler]){this._editor.on(eventName,this.props[eventHandler])}else{this._editor.off(eventName,this.props[eventHandler])}}}.bind(this))},toggleEditor:function toggleEditor(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{autofocus:true};if(!this._editor){return}if(this.props.mode==="html"){this._editor.hide();this.doAutosizeUpdate();if(options.autofocus){this.focusEditor()}return}this._editor.show();if(options.autofocus){this.focusEditor()}},focusEditor:function focusEditor(){if(this.props.mode==="html"){var textNode=ReactDom.findDOMNode(this.refs.text);textNode.setSelectionRange(0,0);textNode.focus()}else if(this._editor){this._editor.focus()}},getContent:function getContent(args){if(this.props.mode==="html"){return this.state.content}if(!this._editor){return""}var content=this._editor.getContent(args);if(!args||"raw"!==args.format){content=content.replace(/<p>(?:<br ?\/?>|\u00a0|\uFEFF| )*<\/p>/g,"<p>&nbsp;</p>");content=(0,_formatting.removep)(content)}return content},isDirty:function isDirty(){if(this._editor){return this._editor.isDirty()}return false},setTextAreaContent:function setTextAreaContent(content){this.setState({content:(0,_formatting.decodeEntities)(content)},this.doAutosizeUpdate)},setEditorContent:function setEditorContent(content){var args=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(this._editor){var mode=this.props.mode;this._editor.setContent((0,_formatting.wpautop)(content),(0,_extends3.default)({},args,{mode:mode}));if(args.initial){this._editor.undoManager.clear()}}this.setTextAreaContent(content)},onTextAreaChange:function onTextAreaChange(event){var content=event.target.value;if(this.props.onTextEditorChange){this.props.onTextEditorChange(content)}this.setState({content:content},this.doAutosizeUpdate)},localize:function localize(){var userData=user.get();var i18nStrings=i18n;if(!userData){return}if(user.isRTL()){i18nStrings=assign({_dir:"rtl"},i18nStrings)}tinymce.addI18n(userData.localeSlug,i18nStrings);tinymce.ScriptLoader.markDone(DUMMY_LANG_URL)},render:function render(){var className=classnames({tinymce:true,"is-visible":this.props.mode==="html"});return React.createElement("textarea",{ref:"text",className:className,id:this._id,onChange:this.onTextAreaChange,tabIndex:this.props.tabIndex,value:this.state.content})}})},2544:function(module,exports,__webpack_require__){"use strict";var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _server=__webpack_require__(1800);var _server2=_interopRequireDefault(_server);var _tinymce=__webpack_require__(1675);var _tinymce2=_interopRequireDefault(_tinymce);var _throttle=__webpack_require__(388);var _throttle2=_interopRequireDefault(_throttle);var _i18nCalypso=__webpack_require__(11);var _store=__webpack_require__(747);var _store2=_interopRequireDefault(_store);var _actions=__webpack_require__(754);var _actions2=_interopRequireDefault(_actions);var _viewport=__webpack_require__(92);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function advanced(editor){var menuButton=void 0,updateVisibleState=void 0;function isAdvancedVisible(){return!!_store2.default.get("editorAdvancedVisible")}function toggleAdvancedVisible(){_actions2.default.set("editorAdvancedVisible",!isAdvancedVisible())}updateVisibleState=(0,_throttle2.default)(function(){var toolbars=editor.theme.panel.find(".toolbar:not(.menubar)"),isSmallViewport=(0,_viewport.isWithinBreakpoint)("<960px"),containerPadding=0;toolbars.each(function(toolbar,i){var isToolbarVisible=isSmallViewport||i===0||isAdvancedVisible();toolbar.visible(isToolbarVisible);if(isAdvancedVisible){if(isSmallViewport){containerPadding=Math.max(containerPadding,toolbar.getEl().clientHeight)}else{containerPadding+=toolbar.getEl().clientHeight}}});_tinymce2.default.DOM.setStyles(editor.getContainer(),{"padding-top":containerPadding});if(menuButton){menuButton.active(isAdvancedVisible())}},500);editor.addButton("wpcom_advanced",{text:(0,_i18nCalypso.translate)("Toggle Advanced"),tooltip:(0,_i18nCalypso.translate)("Toggle Advanced"),classes:"btn wpcom-icon-button advanced",cmd:"WPCOM_ToggleAdvancedVisible",onPostRender:function onPostRender(){menuButton=this;this.innerHtml(_server2.default.renderToStaticMarkup(_react2.default.createElement("button",{type:"button",role:"presentation",tabIndex:"-1"},_react2.default.createElement(_gridicon2.default,{icon:"ellipsis",size:28}))))}});editor.addCommand("WPCOM_ToggleAdvancedVisible",toggleAdvancedVisible);editor.on("init",function(){_actions2.default.fetch()});editor.on("preInit",function(){editor.shortcuts.add("access+z","","WPCOM_ToggleAdvancedVisible")});editor.on("init show",updateVisibleState);window.addEventListener("resize",updateVisibleState);_store2.default.on("change",function(){updateVisibleState()})}module.exports=function(){_tinymce2.default.PluginManager.add("wpcom/advanced",advanced)}},2545:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _i18nCalypso=__webpack_require__(11);function AtDCore(){this.ignore_types=["Bias Language","Cliches","Complex Expression","Diacritical Marks","Double Negatives","Hidden Verbs","Jargon Language","Passive voice","Phrases to Avoid","Redundant Expression"];this.ignore_strings={};this.i18n={}}AtDCore.prototype.setIgnoreStrings=function(strings){var parent=this;if("string"===typeof strings){strings=strings.split(/,\s*/g)}this.map(strings,function(string){parent.ignore_strings[string]=1})};AtDCore.prototype.showTypes=function(strings){var show_types=strings.split(/,\s*/g),types={},ignore_types=[];types["Double Negatives"]=1;types["Hidden Verbs"]=1;types["Passive voice"]=1;types["Bias Language"]=1;types["Cliches"]=1;types["Complex Expression"]=1;types["Diacritical Marks"]=1;types["Jargon Language"]=1;types["Phrases to Avoid"]=1;types["Redundant Expression"]=1;this.map(show_types,function(type){types[type]=undefined});this.map(this.ignore_types,function(type){if(types[type]!==undefined){ignore_types.push(type)}});this.ignore_types=ignore_types};AtDCore.prototype.makeError=function(error_s,tokens,type,seps){var struct={};struct.type=type;struct.string=error_s;struct.tokens=tokens;if(new RegExp("\\b"+error_s+"\\b").test(error_s)){struct.regexp=new RegExp("(?!"+error_s+"<)\\b"+error_s.replace(/\s+/g,seps)+"\\b")}else if(new RegExp(error_s+"\\b").test(error_s)){struct.regexp=new RegExp("(?!"+error_s+"<)"+error_s.replace(/\s+/g,seps)+"\\b")}else if(new RegExp("\\b"+error_s).test(error_s)){struct.regexp=new RegExp("(?!"+error_s+"<)\\b"+error_s.replace(/\s+/g,seps))}else{struct.regexp=new RegExp("(?!"+error_s+"<)"+error_s.replace(/\s+/g,seps))}struct.used=false;return struct};AtDCore.prototype.addToErrorStructure=function(errors,list,type,seps){var parent=this;this.map(list,function(error){var tokens=error.word.split(/\s+/);var pre=error.pre;var first=tokens[0];if(errors["__"+first]===undefined){errors["__"+first]={};errors["__"+first].pretoks={};errors["__"+first].defaults=[]}if(pre===""){errors["__"+first].defaults.push(parent.makeError(error.word,tokens,type,seps,pre))}else{if(errors["__"+first].pretoks["__"+pre]===undefined){errors["__"+first].pretoks["__"+pre]=[]}errors["__"+first].pretoks["__"+pre].push(parent.makeError(error.word,tokens,type,seps,pre))}})};AtDCore.prototype.buildErrorStructure=function(spellingList,enrichmentList,grammarList){var seps=this._getSeparators();var errors={};this.addToErrorStructure(errors,spellingList,"hiddenSpellError",seps);this.addToErrorStructure(errors,grammarList,"hiddenGrammarError",seps);this.addToErrorStructure(errors,enrichmentList,"hiddenSuggestion",seps);return errors};AtDCore.prototype._getSeparators=function(){var re="",i;var str='"s!#$%&()*+,./:;<=>?@[\\]^_{|}';for(i=0;i<str.length;i++){re+="\\"+str.charAt(i)}return"(?:(?:["+re+"])|(?:\\-\\-))+"};AtDCore.prototype.processXML=function(responseXML){var types,errors,grammarErrors,spellingErrors,enrichment,i,errorString,errorType,errorDescription,errorContext,suggestion,suggestions,j,errorUrl,errorStruct,ecount;types={};this.map(this.ignore_types,function(type){types[type]=1});this.suggestions=[];errors=responseXML.getElementsByTagName("error");grammarErrors=[];spellingErrors=[];enrichment=[];for(i=0;i<errors.length;i++){if(errors[i].getElementsByTagName("string").item(0).firstChild!==null){errorString=errors[i].getElementsByTagName("string").item(0).firstChild.data;errorType=errors[i].getElementsByTagName("type").item(0).firstChild.data;errorDescription=errors[i].getElementsByTagName("description").item(0).firstChild.data;errorContext;if(errors[i].getElementsByTagName("precontext").item(0).firstChild!==null){errorContext=errors[i].getElementsByTagName("precontext").item(0).firstChild.data}else{errorContext=""}if(this.ignore_strings[errorString]===undefined){suggestion={};suggestion.description=errorDescription;suggestion.suggestions=[];suggestion.matcher=new RegExp("^"+errorString.replace(/\s+/,this._getSeparators())+"$");suggestion.context=errorContext;suggestion.string=errorString;suggestion.type=errorType;this.suggestions.push(suggestion);if(errors[i].getElementsByTagName("suggestions").item(0)!==null){suggestions=errors[i].getElementsByTagName("suggestions").item(0).getElementsByTagName("option");for(j=0;j<suggestions.length;j++){suggestion.suggestions.push(suggestions[j].firstChild.data)}}if(errors[i].getElementsByTagName("url").item(0)!==null){errorUrl=errors[i].getElementsByTagName("url").item(0).firstChild.data;suggestion.moreinfo=errorUrl+"&theme=tinymce"}if(types[errorDescription]===undefined){if(errorType==="suggestion"){enrichment.push({word:errorString,pre:errorContext})}if(errorType==="grammar"){grammarErrors.push({word:errorString,pre:errorContext})}}if(errorType==="spelling"||errorDescription==="Homophone"){spellingErrors.push({word:errorString,pre:errorContext})}if(errorDescription==="Cliches"){suggestion.description="Clichs"}if(errorDescription==="Spelling"){suggestion.description=(0,_i18nCalypso.translate)("Spelling",{comment:"Proofreading error description"})}if(errorDescription==="Repeated Word"){suggestion.description=(0,_i18nCalypso.translate)("Repeated Word",{comment:"Proofreading error description"})}if(errorDescription==="Did you mean..."){suggestion.description=(0,_i18nCalypso.translate)("Did you mean",{comment:"Proofreading error description"})}}}}ecount=spellingErrors.length+grammarErrors.length+enrichment.length;if(ecount>0){errorStruct=this.buildErrorStructure(spellingErrors,enrichment,grammarErrors)}else{errorStruct=undefined}return{errors:errorStruct,count:ecount,suggestions:this.suggestions}};AtDCore.prototype.findSuggestion=function(element){var text=element.innerHTML,context=(this.getAttrib(element,"pre")+"").replace(/[\\,!\\?\\."\s]/g,""),len=this.suggestions.length,errorDescription,i;for(i=0;i<len;i++){if((context===""||context===this.suggestions[i].context)&&this.suggestions[i].matcher.test(text)){errorDescription=this.suggestions[i];break}}return errorDescription};function TokenIterator(tokens){this.tokens=tokens;this.index=0;this.count=0;this.last=0}TokenIterator.prototype.next=function(){var current=this.tokens[this.index];this.count=this.last;this.last+=current.length+1;this.index++;if(current!==""){if(current[0]==="'"){current=current.substring(1,current.length)}if(current[current.length-1]==="'"){current=current.substring(0,current.length-1)}}return current};TokenIterator.prototype.hasNext=function(){return this.index<this.tokens.length};TokenIterator.prototype.hasNextN=function(n){return this.index+n<this.tokens.length};TokenIterator.prototype.skip=function(m,n){this.index+=m;this.last+=n;if(this.index<this.tokens.length){this.count=this.last-this.tokens[this.index].length}};TokenIterator.prototype.getCount=function(){return this.count};TokenIterator.prototype.peek=function(n){var peepers=[],end=this.index+n,x;for(x=this.index;x<end;x++){peepers.push(this.tokens[x])}return peepers};AtDCore.prototype.markMyWords=function(container_nodes,errors){var seps=new RegExp(this._getSeparators()),nl=[],ecount=0,parent=this,bogus=this._isTinyMCE?' data-mce-bogus="1"':"",emptySpan='<span class="mceItemHidden"'+bogus+">&nbsp;</span>",textOnlyMode,iterator;function splitTextNode(textnode,regexp,replacement){var text=textnode.nodeValue,index=text.search(regexp),match=text.match(regexp),captured=[],cursor;if(index<0||!match.length){return[textnode]}if(index>0){captured.push(document.createTextNode(text.substr(0,index)))}captured.push(parent.create(match[0].replace(regexp,replacement)));cursor=index+match[0].length;if(cursor<text.length){captured.push(document.createTextNode(text.substr(cursor)))}return captured}this._walk(container_nodes,function(n){if(n.nodeType===3&&!parent.isMarkedNode(n)){nl.push(n)}});this.map(nl,function(n){var foundStrings={},v,tokens,previous,doReplaces,token,current,defaults,done,prev,curr,newNode,x,regexp,result,i,contents,y,nnode;if(n.nodeType===3){v=n.nodeValue;tokens=n.nodeValue.split(seps);previous="";doReplaces=[];iterator=new TokenIterator(tokens);while(iterator.hasNext()){token=iterator.next();current=errors["__"+token];if(current!==undefined&&current.pretoks!==undefined){var checkErrors=function checkErrors(error){if(error!==undefined&&!error.used&&foundStrings["__"+error.string]===undefined&&error.regexp.test(curr)){foundStrings["__"+error.string]=1;doReplaces.push([error.regexp,'<span class="'+error.type+'" pre="'+previous+'"'+bogus+">$&</span>"]);error.used=true;done=true}};defaults=current.defaults;current=current.pretoks["__"+previous];done=false;prev=v.substr(0,iterator.getCount());curr=v.substr(prev.length,v.length);if(current!==undefined){previous=previous+" ";parent.map(current,checkErrors)}if(!done){previous="";parent.map(defaults,checkErrors)}}previous=token}if(doReplaces.length>0){newNode=n;var _loop=function _loop(){regexp=doReplaces[x][0];result=doReplaces[x][1];function bringTheHurt(node){var span,splitNodes;if(node.nodeType===3){ecount++;if(parent.isIE()&&node.nodeValue.length>0&&node.nodeValue.substr(0,1)===" "){return parent.create(emptySpan+node.nodeValue.substr(1,node.nodeValue.length-1).replace(regexp,result),false)}if(textOnlyMode){return parent.create(node.nodeValue.replace(regexp,result),false)}span=parent.create("<span />");if(typeof textOnlyMode==="undefined"){textOnlyMode=typeof span.appendChild!=="function";if(textOnlyMode){parent.remove(span);return parent.create(node.nodeValue.replace(regexp,result),false)}}splitNodes=splitTextNode(node,regexp,result);for(i=0;i<splitNodes.length;i++){span.appendChild(splitNodes[i])}node=span;return node}contents=parent.contents(node);for(y=0;y<contents.length;y++){if(contents[y].nodeType===3&&regexp.test(contents[y].nodeValue)){if(parent.isIE()&&contents[y].nodeValue.length>0&&contents[y].nodeValue.substr(0,1)===" "){nnode=parent.create(emptySpan+contents[y].nodeValue.substr(1,contents[y].nodeValue.length-1).replace(regexp,result),true)}else{nnode=parent.create(contents[y].nodeValue.replace(regexp,result),true)}parent.replaceWith(contents[y],nnode);parent.removeParent(nnode);ecount++;return node}}return node}newNode=bringTheHurt(newNode)};for(x=0;x<doReplaces.length;x++){_loop()}parent.replaceWith(n,newNode)}}});return ecount};AtDCore.prototype._walk=function(elements,f){var i;for(i=0;i<elements.length;i++){f.call(f,elements[i]);this._walk(this.contents(elements[i]),f)}};AtDCore.prototype.removeWords=function(node,w){var count=0;var parent=this;this.map(this.findSpans(node).reverse(),function(n){var nnode;if(n&&(parent.isMarkedNode(n)||parent.hasClass(n,"mceItemHidden")||parent.isEmptySpan(n))){if(n.innerHTML==="&nbsp;"){nnode=document.createTextNode(" ");parent.replaceWith(n,nnode)}else if(!w||n.innerHTML===w){parent.removeParent(n);count++}}});return count};AtDCore.prototype.isEmptySpan=function(node){return this.getAttrib(node,"class")===""&&this.getAttrib(node,"style")===""&&this.getAttrib(node,"id")===""&&!this.hasClass(node,"Apple-style-span")&&this.getAttrib(node,"mce_name")===""};AtDCore.prototype.isMarkedNode=function(node){return this.hasClass(node,"hiddenGrammarError")||this.hasClass(node,"hiddenSpellError")||this.hasClass(node,"hiddenSuggestion")};AtDCore.prototype.applySuggestion=function(element,suggestion){var node;if(suggestion==="(omit)"){this.remove(element)}else{node=this.create(suggestion);this.replaceWith(element,node);this.removeParent(node)}};AtDCore.prototype.hasErrorMessage=function(xmlr){return xmlr!==undefined&&xmlr.getElementsByTagName("message").item(0)!==null};AtDCore.prototype.getErrorMessage=function(xmlr){return xmlr.getElementsByTagName("message").item(0)};AtDCore.prototype.isIE=function(){return navigator.appName==="Microsoft Internet Explorer"};exports.default=AtDCore;module.exports=exports["default"]},2546:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(){_tinymce2.default.PluginManager.add("AtD",plugin)};var _tinymce=__webpack_require__(1675);var _tinymce2=_interopRequireDefault(_tinymce);var _querystring=__webpack_require__(121);var _querystring2=_interopRequireDefault(_querystring);var _find=__webpack_require__(27);var _find2=_interopRequireDefault(_find);var _throttle=__webpack_require__(388);var _throttle2=_interopRequireDefault(_throttle);var _i18nCalypso=__webpack_require__(11);var _core=__webpack_require__(2545);var _core2=_interopRequireDefault(_core);var _actions=__webpack_require__(754);var _actions2=_interopRequireDefault(_actions);var _store=__webpack_require__(747);var _store2=_interopRequireDefault(_store);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var SERVICE_HOSTNAME="service.afterthedeadline.com";var SERVICE_LOCALIZED_SUBDOMAINS=["en","pt","de","es","fr"];var IGNORE_PREFERENCE_NAME="editorProofreadIgnore";function plugin(editor){var suggestionsMenu,started,atdCore,dom,each=_tinymce2.default.each;var SuggestionsMenu=_tinymce2.default.ui.Menu.extend({init:function init(settings){settings.context="contextmenu";settings.autofix=false;this.throttledReposition=(0,_throttle2.default)(this.reposition.bind(this),200);this.on("autohide",function(event){return event.preventDefault()});this.boundHideIfNotMarked=this.hideIfNotMarked.bind(this);this._super(settings)},hideIfNotMarked:function hideIfNotMarked(event){if(!isMarkedNode(event.target)){this.hide()}},hide:function hide(){this._super();this.remove();window.removeEventListener("scroll",this.throttledReposition);editor.off("SpellcheckEnd click touchstart focusout",this.boundHideIfNotMarked)},postRender:function postRender(){this._super();this.reposition();window.addEventListener("scroll",this.throttledReposition);editor.on("SpellcheckEnd click touchstart focusout",this.boundHideIfNotMarked)},reposition:function reposition(){var rootNode=editor.dom.getRoot();var pos=_tinymce2.default.DOM.getPos(editor.getContentAreaContainer());var targetPos=editor.dom.getPos(this.settings.target);if(rootNode.nodeName==="BODY"){targetPos.x-=rootNode.ownerDocument.documentElement.scrollLeft||rootNode.scrollLeft;targetPos.y-=rootNode.ownerDocument.documentElement.scrollTop||rootNode.scrollTop}else{targetPos.x-=rootNode.scrollLeft;targetPos.y-=rootNode.scrollTop}pos.x+=targetPos.x;pos.y+=targetPos.y;this.moveTo(pos.x,pos.y+this.settings.target.offsetHeight)}});function initAtDCore(){atdCore=new _core2.default;atdCore.map=each;atdCore._isTinyMCE=true;atdCore.getAttrib=function(node,key){return dom.getAttrib(node,key)};atdCore.findSpans=function(parent){if(parent===undefined){return dom.select("span")}return dom.select("span",parent)};atdCore.hasClass=function(node,className){return dom.hasClass(node,className)};atdCore.contents=function(node){return node.childNodes};atdCore.replaceWith=function(old_node,new_node){return dom.replace(new_node,old_node)};atdCore.create=function(node_html){return dom.create("span",{class:"mceItemHidden","data-mce-bogus":1},node_html)};atdCore.removeParent=function(node){dom.remove(node,true);return node};atdCore.remove=function(node){dom.remove(node)};atdCore.setIgnoreStrings(editor.getParam("atd_ignore_strings",[]).join(","));atdCore.showTypes(editor.getParam("atd_show_types",""))}function isMarkedNode(node){return node.className&&/\bhidden(GrammarError|SpellError|Suggestion)\b/.test(node.className)}function markMyWords(errors){return atdCore.markMyWords(atdCore.contents(editor.getBody()),errors)}function checkIfFinished(){if(!editor.dom.select("span.hiddenSpellError, span.hiddenGrammarError, span.hiddenSuggestion").length){if(suggestionsMenu){suggestionsMenu.hideMenu()}finish()}}function ignoreWord(target,word,all){if(all){each(editor.dom.select("span.hiddenSpellError, span.hiddenGrammarError, span.hiddenSuggestion"),function(node){var text=node.innerText||node.textContent;if(text===word){dom.remove(node,true)}})}else{editor.dom.remove(target,true)}checkIfFinished()}function finish(){var node,regex=new RegExp("mceItemHidden|hidden(((Grammar|Spell)Error)|Suggestion)"),nodes=editor.dom.select("span"),i=nodes.length;while(i--){node=nodes[i];if(node.className&&regex.test(node.className)){editor.dom.remove(node,true)}}editor.setContent(editor.getContent({format:"raw"}),{format:"raw"});started=false;editor.nodeChanged();editor.fire("SpellcheckEnd")}function getServiceHostName(){var localeSlug=(0,_i18nCalypso.getLocaleSlug)();var subdomain=(0,_find2.default)(SERVICE_LOCALIZED_SUBDOMAINS,function(locale){return localeSlug===locale||0===localeSlug.indexOf(locale+"-")});if(subdomain){return subdomain+"."+SERVICE_HOSTNAME}return SERVICE_HOSTNAME}function sendRequest(path,data,success){editor.setProgressState(true);var xhr=new XMLHttpRequest;xhr.open("POST","https://"+getServiceHostName()+"/"+path);xhr.addEventListener("readystatechange",function(){if(4===xhr.readyState){editor.setProgressState();if(200===xhr.status){success(""+xhr.responseText,xhr)}}});var key=editor.getParam("atd_rpc_id");xhr.send(_querystring2.default.stringify({data:data,key:key}))}function setAlwaysIgnore(text){var ignores=_store2.default.get(IGNORE_PREFERENCE_NAME)||[];if(-1===ignores.indexOf(text)){ignores.push(text)}_actions2.default.set(IGNORE_PREFERENCE_NAME,ignores)}function showSuggestions(target){var items=[],text=target.innerText||target.textContent,errorDescription=atdCore.findSuggestion(target);if(!errorDescription){items.push({text:(0,_i18nCalypso.translate)("No suggestions",{comment:"Editor proofreading no suggestions"}),classes:"atd-menu-title",disabled:true})}else{items.push({text:errorDescription.description,classes:"atd-menu-title",disabled:true});if(errorDescription.suggestions.length){items.push({text:"-"});each(errorDescription.suggestions,function(suggestion){items.push({text:suggestion,onclick:function onclick(){atdCore.applySuggestion(target,suggestion);checkIfFinished()}})})}}if(errorDescription&&errorDescription.moreinfo){items.push({text:"-"});items.push({text:(0,_i18nCalypso.translate)("Explain",{comment:"Editor proofreading menu item"}),onclick:function onclick(){editor.windowManager.open({title:(0,_i18nCalypso.translate)("Explain",{comment:"Editor proofreading menu item"}),url:errorDescription.moreinfo,width:480,height:380,inline:true})}})}items.push.apply(items,[{text:"-"},{text:(0,_i18nCalypso.translate)("Ignore suggestion",{comment:"Editor proofreading menu item"}),onclick:function onclick(){ignoreWord(target,text)}}]);if(editor.getParam("atd_ignore_enable")){items.push({text:(0,_i18nCalypso.translate)("Ignore always",{comment:"Editor proofreading menu item"}),onclick:function onclick(){setAlwaysIgnore(text);ignoreWord(target,text,true)}})}else{items.push({text:(0,_i18nCalypso.translate)("Ignore all",{comment:"Editor proofreading menu item"}),onclick:function onclick(){ignoreWord(target,text,true)}})}suggestionsMenu=new SuggestionsMenu({items:items,target:target});suggestionsMenu.renderTo(document.body);suggestionsMenu.on("hide",function(){suggestionsMenu=null})}editor.on("init",function(){dom=editor.dom;initAtDCore();editor.addCommand("mceWritingImprovementTool",function(callback){var results,errorCount=0;if(typeof callback!=="function"){callback=function callback(){}}if(typeof window.AtD_proofread_click_count!=="undefined"){window.AtD_proofread_click_count++}if(started){finish();return}sendRequest("checkDocument",editor.getContent({format:"raw"}),function(data,request){editor.setProgressState();if(request.status!==200||request.responseText.substr(1,4)==="html"||!request.responseXML){editor.windowManager.alert((0,_i18nCalypso.translate)("There was a problem communicating with the Proofreading service. Try again in one minute.",{comment:"Editor proofreading error"}),callback(0));return}if(request.responseXML.getElementsByTagName("message").item(0)!==null){editor.windowManager.alert(request.responseXML.getElementsByTagName("message").item(0).firstChild.data,callback(0));return}results=atdCore.processXML(request.responseXML);if(results.count>0){errorCount=markMyWords(results.errors)}if(!errorCount){editor.windowManager.alert((0,_i18nCalypso.translate)("No writing errors were found.",{comment:"Editor proofreading success prompt"}))}else{started=true;editor.fire("SpellcheckStart")}callback(errorCount)})});if(editor.settings.content_css!==false){dom.addStyle(".hiddenSpellError{border-bottom:2px solid red;cursor:default;}"+".hiddenGrammarError{border-bottom:2px solid green;cursor:default;}"+".hiddenSuggestion{border-bottom:2px solid blue;cursor:default;}")}editor.on("click",function(event){
if(isMarkedNode(event.target)){event.preventDefault();editor.selection.select(event.target);showSuggestions(event.target)}})});(function(){if(!editor.getParam("atd_ignore_enable")){return}if(undefined===_store2.default.getAll()){_actions2.default.fetch()}function syncToCore(){var ignores=_store2.default.get(IGNORE_PREFERENCE_NAME);if(ignores){atdCore.setIgnoreStrings(ignores)}}editor.on("init",function(){_store2.default.on("change",syncToCore)});editor.on("remove",function(){_store2.default.off("change",syncToCore)})})();editor.on("SpellcheckStart SpellcheckEnd",function(event){editor.contentDocument.body.spellcheck="spellcheckend"===event.type;if(!editor.contentDocument.body.spellcheck){editor.contentDocument.body.focus();editor.contentDocument.body.blur()}});editor.addMenuItem("spellchecker",{text:(0,_i18nCalypso.translate)("Proofread Writing",{comment:"Editor proofreading toolbar tooltip"}),context:"tools",cmd:"mceWritingImprovementTool",onPostRender:function onPostRender(){var self=this;editor.on("SpellcheckStart SpellcheckEnd",function(){self.active(started)})}});editor.addButton("spellchecker",{tooltip:(0,_i18nCalypso.translate)("Proofread Writing",{comment:"Editor proofreading button tooltip"}),cmd:"mceWritingImprovementTool",onPostRender:function onPostRender(){var self=this;editor.on("SpellcheckStart SpellcheckEnd",function(){self.active(started)})}});editor.on("remove",function(){if(suggestionsMenu){suggestionsMenu.remove();suggestionsMenu=null}})}module.exports=exports["default"]},2547:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _dialog=__webpack_require__(168);var _dialog2=_interopRequireDefault(_dialog);var _formButton=__webpack_require__(379);var _formButton2=_interopRequireDefault(_formButton);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"Alert",propTypes:{isVisible:_react2.default.PropTypes.bool.isRequired,onClose:_react2.default.PropTypes.func.isRequired,message:_react2.default.PropTypes.string.isRequired},splitMessage:function splitMessage(){var lines=this.props.message.split("\n\n");return lines.map(function(line,i){return _react2.default.createElement("p",{key:"alert-"+i},line)})},getButtons:function getButtons(){return[_react2.default.createElement(_formButton2.default,{isPrimary:false,"aria-label":this.translate("Dismiss alert message"),onClick:this.props.onClose},this.translate("OK"))]},render:function render(){return _react2.default.createElement(_dialog2.default,{isVisible:this.props.isVisible,additionalClassNames:"editor-alert-modal",onClose:this.props.onClose,buttons:this.getButtons()},this.splitMessage())}});module.exports=exports["default"]},2548:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _tinymce=__webpack_require__(1675);var _tinymce2=_interopRequireDefault(_tinymce);var _reactDom=__webpack_require__(44);var _reactDom2=_interopRequireDefault(_reactDom);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _alert=__webpack_require__(2547);var _alert2=_interopRequireDefault(_alert);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function calypsoAlert(editor){var node=void 0;editor.on("init",function(){node=document.createElement("div");node.setAttribute("class","alert-container");editor.getContainer().appendChild(node);editor.windowManager.alert=function(message,callback,scope){function onClose(){render("hide");if(typeof callback==="function"){callback.call(scope||editor.windowManager)}else{editor.focus()}}function render(){var visibility=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"show";_reactDom2.default.render(_react2.default.createElement(_alert2.default,{isVisible:visibility==="show",onClose:onClose,message:editor.editorManager.i18n.translate(message)}),node)}render("show")};editor.notificationManager.open=function(data){editor.windowManager.alert(data.text)}});editor.on("remove",function(){_reactDom2.default.unmountComponentAtNode(node);node.parentNode.removeChild(node);node=null})}exports.default=function(){_tinymce2.default.PluginManager.add("wpcom/calypsoalert",calypsoAlert)};module.exports=exports["default"]},2549:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _noop2=__webpack_require__(38);var _noop3=_interopRequireDefault(_noop2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _i18nCalypso=__webpack_require__(11);var _button=__webpack_require__(69);var _button2=_interopRequireDefault(_button);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _popover=__webpack_require__(386);var _popover2=_interopRequireDefault(_popover);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ContactFormDialogFieldEditButton=function(_PureComponent){(0,_inherits3.default)(ContactFormDialogFieldEditButton,_PureComponent);function ContactFormDialogFieldEditButton(){(0,_classCallCheck3.default)(this,ContactFormDialogFieldEditButton);var _this=(0,_possibleConstructorReturn3.default)(this,(ContactFormDialogFieldEditButton.__proto__||(0,_getPrototypeOf2.default)(ContactFormDialogFieldEditButton)).apply(this,arguments));_this.state={showTooltip:false};_this.handleMouseEnter=_this.handleMouseEnter.bind(_this);_this.handleMouseLeave=_this.handleMouseLeave.bind(_this);return _this}(0,_createClass3.default)(ContactFormDialogFieldEditButton,[{key:"handleMouseEnter",value:function handleMouseEnter(){this.setState({showTooltip:true})}},{key:"handleMouseLeave",value:function handleMouseLeave(){this.setState({showTooltip:false})}},{key:"render",value:function render(){var _props=this.props;var expanded=_props.expanded;var translate=_props.translate;var classes=(0,_classnames2.default)("editor-contact-form-modal-field__edit",{"is-expanded":expanded});return _react2.default.createElement("div",{className:"editor-contact-form-modal-field__edit-wrapper foldable-card__expand"},_react2.default.createElement(_button2.default,{className:"editor-contact-form-modal-field__edit-wrapper-button",ref:"editField",borderless:true,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave},_react2.default.createElement(_gridicon2.default,{icon:"pencil",className:classes})),_react2.default.createElement(_popover2.default,{isVisible:this.state.showTooltip,context:this.refs&&this.refs.editField,onClose:_noop3.default,position:"bottom",className:"popover tooltip is-dialog-visible"},translate("Edit Field",{context:"button tooltip"})))}}]);return ContactFormDialogFieldEditButton}(_react.PureComponent);ContactFormDialogFieldEditButton.propTypes={expanded:_react.PropTypes.bool.isRequired};exports.default=(0,_i18nCalypso.localize)(ContactFormDialogFieldEditButton);module.exports=exports["default"]},2550:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _locales=__webpack_require__(2230);var _locales2=_interopRequireDefault(_locales);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"ContactFormDialogFieldHeader",propTypes:{label:_react.PropTypes.string.isRequired,type:_react.PropTypes.string.isRequired,options:_react.PropTypes.string,required:_react.PropTypes.bool},getLegend:function getLegend(){if(this.props.options){var count=this.props.options.split(",").length;if(this.props.required){return this.translate('Required field "%(fieldName)s" with %(numOption)d option','Required field "%(fieldName)s" with %(numOption)d options',{count:count,args:{fieldName:(0,_locales2.default)(this.props.type),numOption:count},comment:"Explains to the user the field settings. If required, type, and how many options it has."})}return this.translate('Optional field "%(fieldName)s" with %(numOption)d option','Optional field "%(fieldName)s" with %(numOption)d options',{count:count,args:{fieldName:(0,_locales2.default)(this.props.type),numOption:count},comment:"Explains to the user the field settings. If required, type, and how many options it has."})}if(this.props.required){return this.translate('Required field "%(fieldName)s"',{args:{fieldName:(0,_locales2.default)(this.props.type)},comment:"Explain to the user the field settings for fields other than dropdown and select list."})}return this.translate('Optional field "%(fieldName)s"',{args:{fieldName:(0,_locales2.default)(this.props.type)},comment:"Explain to the user the field settings for fields other than dropdown and select list."})},render:function render(){return _react2.default.createElement("div",null,_react2.default.createElement("div",null,this.props.label),_react2.default.createElement("div",null,_react2.default.createElement("small",null,this.getLegend())))}});module.exports=exports["default"]},2551:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _emptyContent=__webpack_require__(207);var _emptyContent2=_interopRequireDefault(_emptyContent);var _field=__webpack_require__(2553);var _field2=_interopRequireDefault(_field);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"ContactFormDialogFieldList",propTypes:{fields:_react.PropTypes.array.isRequired,onFieldAdd:_react.PropTypes.func.isRequired,onFieldRemove:_react.PropTypes.func.isRequired,onFieldUpdate:_react.PropTypes.func.isRequired},render:function render(){var _this=this;if(this.props.fields.length>0){return _react2.default.createElement("div",{className:"editor-contact-form-modal-fields"},this.props.fields.map(function(field,index){return _react2.default.createElement(_field2.default,(0,_extends3.default)({key:index},field,{onRemove:function onRemove(){return _this.props.onFieldRemove(index)},onUpdate:function onUpdate(newField){return _this.props.onFieldUpdate(index,newField)}}))}))}return _react2.default.createElement(_emptyContent2.default,{title:null,line:this.translate("An empty form is no fun! Go ahead and add some fields!"),action:this.translate("Add New Field"),actionCallback:this.props.onFieldAdd,isCompact:true})}});module.exports=exports["default"]},2552:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _mixin=__webpack_require__(111);var _mixin2=_interopRequireDefault(_mixin);var _button=__webpack_require__(69);var _button2=_interopRequireDefault(_button);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _popover=__webpack_require__(386);var _popover2=_interopRequireDefault(_popover);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"ContactFormDialogFieldRemoveButton",mixins:[_mixin2.default],propTypes:{onRemove:_react.PropTypes.func.isRequired},getInitialState:function getInitialState(){return{showTooltip:false}},render:function render(){var _this=this;return _react2.default.createElement("div",null,_react2.default.createElement(_button2.default,{ref:"removeField",borderless:true,onMouseEnter:function onMouseEnter(){return _this.setState({showTooltip:true})},onMouseLeave:function onMouseLeave(){return _this.setState({showTooltip:false})},onClick:this.props.onRemove},_react2.default.createElement(_gridicon2.default,{icon:"trash",className:"editor-contact-form-modal-field__remove"})),_react2.default.createElement(_popover2.default,{isVisible:this.state.showTooltip,context:this.refs&&this.refs.removeField,onClose:function onClose(){},position:"bottom",className:"popover tooltip is-dialog-visible"},this.translate("Remove Field",{context:"button tooltip"})))}});module.exports=exports["default"]},2553:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _mixin=__webpack_require__(111);var _mixin2=_interopRequireDefault(_mixin);var _omit=__webpack_require__(18);var _omit2=_interopRequireDefault(_omit);var _fieldHeader=__webpack_require__(2550);var _fieldHeader2=_interopRequireDefault(_fieldHeader);var _foldableCard=__webpack_require__(1681);var _foldableCard2=_interopRequireDefault(_foldableCard);var _formFieldset=__webpack_require__(275);var _formFieldset2=_interopRequireDefault(_formFieldset);var _formLabel=__webpack_require__(380);var _formLabel2=_interopRequireDefault(_formLabel);var _formTextInput=__webpack_require__(206);var _formTextInput2=_interopRequireDefault(_formTextInput);var _formCheckbox=__webpack_require__(1654);var _formCheckbox2=_interopRequireDefault(_formCheckbox);var _formInputValidation=__webpack_require__(1646);var _formInputValidation2=_interopRequireDefault(_formInputValidation);var _formSettingExplanation=__webpack_require__(1667);var _formSettingExplanation2=_interopRequireDefault(_formSettingExplanation);var _selectDropdown=__webpack_require__(1761);var _selectDropdown2=_interopRequireDefault(_selectDropdown);var _item=__webpack_require__(1809);var _item2=_interopRequireDefault(_item);var _tokenField=__webpack_require__(1969);var _tokenField2=_interopRequireDefault(_tokenField);var _fieldRemoveButton=__webpack_require__(2552);var _fieldRemoveButton2=_interopRequireDefault(_fieldRemoveButton);var _fieldEditButton=__webpack_require__(2549);var _fieldEditButton2=_interopRequireDefault(_fieldEditButton);var _locales=__webpack_require__(2230);var _locales2=_interopRequireDefault(_locales);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var fieldTypes=["checkbox","select","email","name","radio","text","textarea","url"];exports.default=_react2.default.createClass({displayName:"ContactFormDialogField",mixins:[_mixin2.default],propTypes:{label:_react.PropTypes.string.isRequired,type:_react.PropTypes.string.isRequired,options:_react.PropTypes.string,required:_react.PropTypes.bool,onUpdate:_react.PropTypes.func.isRequired,onRemove:_react.PropTypes.func.isRequired,isExpanded:_react.PropTypes.bool},renderOptions:function renderOptions(){var _this=this;if(this.props.type!=="radio"&&this.props.type!=="select"){return}var options=this.props.options;options=!!options?options.split(","):[];var optionsValidationError=!options||options.length===0;return _react2.default.createElement(_formFieldset2.default,null,_react2.default.createElement(_formLabel2.default,null,this.translate("Options")),_react2.default.createElement(_tokenField2.default,{value:options,onChange:function onChange(tokens){return _this.props.onUpdate({options:tokens.join()})}}),optionsValidationError&&_react2.default.createElement(_formInputValidation2.default,{isError:true,text:this.translate("Options can not be empty.")}),_react2.default.createElement(_formSettingExplanation2.default,null,"Insert an option and press enter."))},onLabelChange:function onLabelChange(event){this.props.onUpdate({label:event.target.value})},handleCardOpen:function handleCardOpen(){this.props.onUpdate({isExpanded:true})},handleCardClose:function handleCardClose(){this.props.onUpdate({isExpanded:false})},render:function render(){var _this2=this;var fielLabelValidationError=!this.props.label;var remove=_react2.default.createElement(_fieldRemoveButton2.default,{onRemove:this.props.onRemove});return _react2.default.createElement(_foldableCard2.default,{header:_react2.default.createElement(_fieldHeader2.default,(0,_omit2.default)(this.props,["onUpdate"])),summary:remove,expandedSummary:remove,expanded:this.props.isExpanded,onClose:this.handleCardClose,onOpen:this.handleCardOpen,actionButton:_react2.default.createElement(_fieldEditButton2.default,{expanded:false}),actionButtonExpanded:_react2.default.createElement(_fieldEditButton2.default,{expanded:true})},_react2.default.createElement(_formFieldset2.default,null,_react2.default.createElement(_formLabel2.default,null,this.translate("Field Label")),_react2.default.createElement(_formTextInput2.default,{value:this.props.label,onChange:this.onLabelChange,isError:fielLabelValidationError}),fielLabelValidationError&&_react2.default.createElement(_formInputValidation2.default,{isError:true,text:this.translate("Field Label can not be empty.")})),_react2.default.createElement(_formFieldset2.default,null,_react2.default.createElement(_formLabel2.default,null,this.translate("Field Type")),_react2.default.createElement(_selectDropdown2.default,{selectedText:(0,_locales2.default)(this.props.type)},fieldTypes.map(function(fieldType){return _react2.default.createElement(_item2.default,{key:"field-type-"+fieldType,selected:_this2.props.type===fieldType,onClick:function onClick(){return _this2.props.onUpdate({type:fieldType})}},(0,_locales2.default)(fieldType))}))),_react2.default.createElement(_formFieldset2.default,null,_react2.default.createElement(_formLabel2.default,null,_react2.default.createElement(_formCheckbox2.default,{checked:this.props.required,onChange:function onChange(){return _this2.props.onUpdate({required:!_this2.props.required})}}),_react2.default.createElement("span",null,this.translate("Required")))),this.renderOptions())}});module.exports=exports["default"]},2554:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactRedux=__webpack_require__(15);var _dialog=__webpack_require__(168);var _dialog2=_interopRequireDefault(_dialog);var _formButton=__webpack_require__(379);var _formButton2=_interopRequireDefault(_formButton);var _settings=__webpack_require__(2556);var _settings2=_interopRequireDefault(_settings);var _navigation=__webpack_require__(2555);var _navigation2=_interopRequireDefault(_navigation);var _fieldList=__webpack_require__(2551);var _fieldList2=_interopRequireDefault(_fieldList);var _selectors=__webpack_require__(90);var _postEditStore=__webpack_require__(1687);var _postEditStore2=_interopRequireDefault(_postEditStore);var _validations=__webpack_require__(2231);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ContactFormDialog=_react2.default.createClass({displayName:"ContactFormDialog",propTypes:{activeTab:_react.PropTypes.oneOf(["fields","settings"]).isRequired,showDialog:_react.PropTypes.bool.isRequired,isEdit:_react.PropTypes.bool.isRequired,contactForm:_react.PropTypes.shape({to:_react.PropTypes.string,subject:_react.PropTypes.string,fields:_react.PropTypes.array.isRequired}).isRequired,onInsert:_react.PropTypes.func.isRequired,onChangeTabs:_react.PropTypes.func.isRequired,onClose:_react.PropTypes.func.isRequired,onFieldAdd:_react.PropTypes.func.isRequired,onFieldRemove:_react.PropTypes.func.isRequired,onFieldUpdate:_react.PropTypes.func.isRequired,onSettingsUpdate:_react.PropTypes.func.isRequired},getActionButtons:function getActionButtons(){var isValidForm=(0,_validations.validateFormFields)(this.props.contactForm.fields)&&(0,_validations.validateSettingsToEmail)(this.props.contactForm.to);var actionButtons=[_react2.default.createElement(_formButton2.default,{key:"save",disabled:!isValidForm,onClick:this.props.onInsert},this.props.isEdit?this.translate("Update"):this.translate("Insert")),_react2.default.createElement(_formButton2.default,{key:"cancel",isPrimary:false,onClick:this.props.onClose},this.translate("Cancel"))];if(this.props.activeTab==="fields"){return[_react2.default.createElement("div",{key:"secondaryActions",className:"editor-contact-form-modal__secondary-actions"},_react2.default.createElement(_formButton2.default,{key:"add",isPrimary:false,onClick:this.props.onFieldAdd},this.translate("Add New Field")))].concat(actionButtons)}return actionButtons},render:function render(){var _props=this.props;var activeTab=_props.activeTab;var email=_props.currentUser.email;var _props$post=_props.post;var title=_props$post.title;var postType=_props$post.type;var _props$contactForm=_props.contactForm;var to=_props$contactForm.to;var subject=_props$contactForm.subject;var fields=_props$contactForm.fields;var showDialog=_props.showDialog;var onChangeTabs=_props.onChangeTabs;var onClose=_props.onClose;var onFieldAdd=_props.onFieldAdd;var onFieldUpdate=_props.onFieldUpdate;var onFieldRemove=_props.onFieldRemove;var onSettingsUpdate=_props.onSettingsUpdate;var content=activeTab==="fields"?_react2.default.createElement(_fieldList2.default,{fields:fields,onFieldAdd:onFieldAdd,onFieldRemove:onFieldRemove,onFieldUpdate:onFieldUpdate}):_react2.default.createElement(_settings2.default,{to:to,subject:subject,email:email,title:title,postType:postType,onUpdate:onSettingsUpdate});return _react2.default.createElement(_dialog2.default,{isVisible:showDialog,onClose:onClose,buttons:this.getActionButtons(),additionalClassNames:"editor-contact-form-modal"},_react2.default.createElement(_navigation2.default,{activeTab:activeTab,onChangeTabs:onChangeTabs,fieldCount:fields.length}),content)}});exports.default=(0,_reactRedux.connect)(function(state){return{post:_postEditStore2.default.get()||{},currentUser:(0,_selectors.getCurrentUser)(state),contactForm:state.ui.editor.contactForm}})(ContactFormDialog);module.exports=exports["default"]},2555:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _sectionNav=__webpack_require__(1664);var _sectionNav2=_interopRequireDefault(_sectionNav);var _tabs=__webpack_require__(1661);var _tabs2=_interopRequireDefault(_tabs);var _item=__webpack_require__(1660);var _item2=_interopRequireDefault(_item);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"ContactFormDialogNavigation",propTypes:{fieldCount:_react.PropTypes.number.isRequired,activeTab:_react.PropTypes.oneOf(["fields","settings"]).isRequired,onChangeTabs:_react.PropTypes.func.isRequired},render:function render(){var _this=this;var tabs=["fields","settings"];return _react2.default.createElement(_sectionNav2.default,{selectedText:"Form Fields"},_react2.default.createElement(_tabs2.default,null,tabs.map(function(tab){return _react2.default.createElement(_item2.default,{key:"contact-form-"+tab,selected:_this.props.activeTab===tab,count:tab==="fields"?_this.props.fieldCount:null,onClick:function onClick(){return _this.props.onChangeTabs(tab)}},tab==="fields"?_this.translate("Form Fields"):_this.translate("Settings"))})))}});module.exports=exports["default"]},2556:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _sectionHeader=__webpack_require__(1644);var _sectionHeader2=_interopRequireDefault(_sectionHeader);var _card=__webpack_require__(89);var _card2=_interopRequireDefault(_card);var _formFieldset=__webpack_require__(275);var _formFieldset2=_interopRequireDefault(_formFieldset);var _formLabel=__webpack_require__(380);var _formLabel2=_interopRequireDefault(_formLabel);var _formTextInput=__webpack_require__(206);var _formTextInput2=_interopRequireDefault(_formTextInput);var _formInputValidation=__webpack_require__(1646);var _formInputValidation2=_interopRequireDefault(_formInputValidation);var _formSettingExplanation=__webpack_require__(1667);var _formSettingExplanation2=_interopRequireDefault(_formSettingExplanation);var _validations=__webpack_require__(2231);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"ContactFormDialogFormSettings",propTypes:{to:_react.PropTypes.string,subject:_react.PropTypes.string,email:_react.PropTypes.string,title:_react.PropTypes.string,onUpdate:_react.PropTypes.func.isRequired},onToChange:function onToChange(event){this.props.onUpdate({to:event.target.value})},onSubjectChange:function onSubjectChange(event){this.props.onUpdate({subject:event.target.value})},render:function render(){var emailValidationError=!(0,_validations.validateSettingsToEmail)(this.props.to);return _react2.default.createElement("div",{className:"editor-contact-form-modal-settings"},_react2.default.createElement(_sectionHeader2.default,{label:this.translate("Contact Form Notification Settings")}),_react2.default.createElement(_card2.default,null,_react2.default.createElement("p",null,this.props.postType==="post"?this.translate("If you dont make any changes here, feedback will be sent to the author of the post and the subject will be the name of this post."):this.translate("If you dont make any changes here, feedback will be sent to the author of the page and the subject will be the name of this page.")),_react2.default.createElement(_formFieldset2.default,null,_react2.default.createElement(_formLabel2.default,null,this.translate("Enter your email address")),_react2.default.createElement(_formTextInput2.default,{value:this.props.to,placeholder:this.props.email,isError:emailValidationError,onChange:this.onToChange}),emailValidationError&&_react2.default.createElement(_formInputValidation2.default,{isError:true,text:this.translate("%(email)s is not a valid email address.",{args:{email:this.props.to}})}),_react2.default.createElement(_formSettingExplanation2.default,null,this.translate("You can enter multiple email addresses in the Email address field, and separate them with commas."+" A notification email will then be sent to each email address."))),_react2.default.createElement(_formFieldset2.default,null,_react2.default.createElement(_formLabel2.default,null,this.translate("What should the subject line be?")),_react2.default.createElement(_formTextInput2.default,{value:this.props.subject,placeholder:this.props.title,onChange:this.onSubjectChange}))))}});module.exports=exports["default"]},2557:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _tinymce=__webpack_require__(1675);var _tinymce2=_interopRequireDefault(_tinymce);var _i18nCalypso=__webpack_require__(11);var _i18nCalypso2=_interopRequireDefault(_i18nCalypso);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactDom=__webpack_require__(44);var _server=__webpack_require__(1800);var _reactRedux=__webpack_require__(15);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _dialog=__webpack_require__(2554);var _dialog2=_interopRequireDefault(_dialog);var _actions=__webpack_require__(3309);var _shortcodeUtils=__webpack_require__(2232);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var wpcomContactForm=function wpcomContactForm(editor){var node=void 0;var store=editor.getParam("redux_store");editor.on("init",function(){node=editor.getContainer().appendChild(document.createElement("div"))});editor.on("remove",function(){(0,_reactDom.unmountComponentAtNode)(node);node.parentNode.removeChild(node);node=null});editor.addCommand("wpcomContactForm",function(content){var isEdit=false;if(content){store.dispatch((0,_actions.formLoad)((0,_shortcodeUtils.deserialize)(content)));isEdit=true}else{store.dispatch((0,_actions.formClear)())}function renderModal(){var visibility=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"show";var activeTab=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"fields";(0,_reactDom.render)((0,_react.createElement)(_reactRedux.Provider,{store:store},(0,_react.createElement)(_dialog2.default,{showDialog:visibility==="show",activeTab:activeTab,isEdit:isEdit,onInsert:function onInsert(){var state=store.getState();editor.execCommand("mceInsertContent",false,(0,_shortcodeUtils.serialize)(state.ui.editor.contactForm))},onChangeTabs:function onChangeTabs(tab){renderModal("show",tab)},onClose:function onClose(){store.dispatch((0,_actions.formClear)());editor.focus();renderModal("hide")},onFieldAdd:function onFieldAdd(){store.dispatch((0,_actions.fieldAdd)())},onFieldRemove:function onFieldRemove(index){store.dispatch((0,_actions.fieldRemove)(index))},onFieldUpdate:function onFieldUpdate(index,field){store.dispatch((0,_actions.fieldUpdate)(index,field))},onSettingsUpdate:function onSettingsUpdate(settings){store.dispatch((0,_actions.settingsUpdate)(settings))}})),node)}renderModal()});editor.addButton("wpcom_add_contact_form",{classes:"btn wpcom-icon-button contact-form",title:_i18nCalypso2.default.translate("Add Contact Form"),cmd:"wpcomContactForm",onPostRender:function onPostRender(){this.innerHtml((0,_server.renderToStaticMarkup)(_react2.default.createElement("button",{type:"button",role:"presentation"},_react2.default.createElement(_gridicon2.default,{icon:"mention"}))))}})};exports.default=function(){_tinymce2.default.PluginManager.add("wpcom/contactform",wpcomContactForm)};module.exports=exports["default"]},2558:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _keys=__webpack_require__(39);var _keys2=_interopRequireDefault(_keys);exports.default=function(){_tinymce2.default.PluginManager.add("wpcom/editorbuttonanalytics",editorButtonAnalytics)};var _tinymce=__webpack_require__(1675);var _tinymce2=_interopRequireDefault(_tinymce);var _componentClosest=__webpack_require__(729);var _componentClosest2=_interopRequireDefault(_componentClosest);var _user=__webpack_require__(48);var _user2=_interopRequireDefault(_user);var _stats=__webpack_require__(1651);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var user=(0,_user2.default)();function editorButtonAnalytics(editor){function editorEventAncestor(event,selector){return(0,_componentClosest2.default)(event.target,selector,true,editor.container)}(0,_keys2.default)(editor.buttons).forEach(function(buttonName){var button=editor.buttons[buttonName];var onPostRender=button.onPostRender;button.onPostRender=function(){this.on("click",function(event){var eventName=buttonName.replace(/^(wp|wpcom)_/,"");if(buttonName==="forecolor"){if(editorEventAncestor(event,".mce-open")){eventName="forecolor_toggle"}else if(editorEventAncestor(event,".mce-custom-color-btn")){eventName="forecolor_pick_custom"}else if(editorEventAncestor(event,".mce-colorbtn-trans")){eventName="forecolor_remove"}else{eventName="forecolor_pick_color"}}(0,_stats.recordTinyMCEButtonClick)(eventName)});if(typeof onPostRender==="function"){onPostRender.apply(this,Array.prototype.slice.call(arguments))}}});function trackBodyClick(event){if(editorEventAncestor(event,".mce-colorbutton")&&!editorEventAncestor(event,".mce-open")){(0,_stats.recordTinyMCEButtonClick)("forecolor_pick_current");
}else if(editorEventAncestor(event,".mce-listbox")){(0,_stats.recordTinyMCEButtonClick)("format_dropdown")}else if((0,_componentClosest2.default)(event.target,".mce-menu-item",true)){var currentUser=user.get();var locale=currentUser?currentUser.localeSlug:"en";if(locale==="en"){var text=(0,_componentClosest2.default)(event.target,".mce-menu-item",true).textContent;var menuItemName=text.toLowerCase().trim().replace(/[^a-z0-9]+/g,"_");(0,_stats.recordTinyMCEButtonClick)("format_dropdown_"+menuItemName)}else{(0,_stats.recordTinyMCEButtonClick)("format_dropdown_non_english")}}}editor.on("init",function(){editor.dom.bind(document.body,"click",trackBodyClick)});editor.on("remove",function(){editor.dom.unbind(document.body,"click",trackBodyClick)})}module.exports=exports["default"]},2559:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _i18nCalypso=__webpack_require__(11);var _i18nCalypso2=_interopRequireDefault(_i18nCalypso);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var GridiconButton=function GridiconButton(_ref){var icon=_ref.icon;var label=_ref.label;return _react2.default.createElement("div",null,_react2.default.createElement(_gridicon2.default,{className:"wpcom-insert-menu__menu-icon",icon:icon}),_react2.default.createElement("span",{className:"wpcom-insert-menu__menu-label"},label))};exports.default=[{name:"insert_media_item",item:_react2.default.createElement(GridiconButton,{icon:"add-image",label:_i18nCalypso2.default.translate("Add Media")}),cmd:"wpcomAddMedia"},{name:"insert_contact_form",item:_react2.default.createElement(GridiconButton,{icon:"mention",label:_i18nCalypso2.default.translate("Add Contact Form")}),cmd:"wpcomContactForm"}];module.exports=exports["default"]},2560:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactDom=__webpack_require__(44);var _reactDom2=_interopRequireDefault(_reactDom);var _tinymce=__webpack_require__(1675);var _tinymce2=_interopRequireDefault(_tinymce);var _server=__webpack_require__(1800);var _i18nCalypso=__webpack_require__(11);var _i18nCalypso2=_interopRequireDefault(_i18nCalypso);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _config=__webpack_require__(12);var _config2=_interopRequireDefault(_config);var _menuItems=__webpack_require__(2559);var _menuItems2=_interopRequireDefault(_menuItems);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var initialize=function initialize(editor){_menuItems2.default.forEach(function(item){return editor.addMenuItem(item.name,{classes:"wpcom-insert-menu__menu-item",cmd:item.cmd,onPostRender:function onPostRender(){this.innerHtml((0,_server.renderToString)(item.item))}})});editor.addButton("wpcom_insert_menu",{type:"splitbutton",title:_i18nCalypso2.default.translate("Insert content"),classes:"btn wpcom-insert-menu insert-menu",cmd:_menuItems2.default[0].cmd,menu:_menuItems2.default.map(function(_ref){var name=_ref.name;return editor.menuItems[name]}),onPostRender:function onPostRender(){_reactDom2.default.render(_react2.default.createElement(_gridicon2.default,{icon:"add-outline"}),this.$el[0].children[0])}})};exports.default=function(){if(!_config2.default.isEnabled("post-editor/insert-menu")){return}_tinymce2.default.PluginManager.add("wpcom/insertmenu",initialize)};module.exports=exports["default"]},2561:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);exports.default=function(editor){var store=editor.getParam("redux_store");if(!_config2.default.isEnabled("post-editor/media-advanced")||!store){return}var container=void 0;function render(){var visible=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var item=arguments[1];if(!container){container=editor.getContainer().appendChild(document.createElement("div"))}if(!visible){return unmount()}_reactDom2.default.render(_react2.default.createElement(_reactRedux.Provider,{store:store},_react2.default.createElement(_editorMediaAdvanced2.default,(0,_extends3.default)({visible:visible,item:item},{onClose:hideModal,insertMedia:insertMedia}))),container)}function showModal(item){render(true,item)}function hideModal(){render(false)}function unmount(){if(container){_reactDom2.default.unmountComponentAtNode(container)}}function insertMedia(markup){editor.execCommand("mceInsertContent",false,markup);hideModal()}editor.addButton("wp_img_advanced",{tooltip:_i18nCalypso2.default.translate("Edit",{context:"verb"}),classes:"toolbar-segment-start",onPostRender:function onPostRender(){this.innerHtml(_server2.default.renderToStaticMarkup(_react2.default.createElement("button",{type:"button",role:"presentation",tabIndex:"-1"},_react2.default.createElement(_gridicon2.default,{icon:"pencil",size:18}))))},onClick:function onClick(){var node=editor.selection.getStart();var item=MediaSerialization.deserialize(node);showModal(item)}});editor.on("remove",unmount)};var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactDom=__webpack_require__(44);var _reactDom2=_interopRequireDefault(_reactDom);var _server=__webpack_require__(1800);var _server2=_interopRequireDefault(_server);var _reactRedux=__webpack_require__(15);var _i18nCalypso=__webpack_require__(11);var _i18nCalypso2=_interopRequireDefault(_i18nCalypso);var _mediaSerialization=__webpack_require__(1814);var MediaSerialization=_interopRequireWildcard(_mediaSerialization);var _config=__webpack_require__(12);var _config2=_interopRequireDefault(_config);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _editorMediaAdvanced=__webpack_require__(3120);var _editorMediaAdvanced2=_interopRequireDefault(_editorMediaAdvanced);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}module.exports=exports["default"]},2562:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _assign=__webpack_require__(5);var _assign2=_interopRequireDefault(_assign);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _noop=__webpack_require__(38);var _noop2=_interopRequireDefault(_noop);var _analytics=__webpack_require__(20);var _analytics2=_interopRequireDefault(_analytics);var _dataObserve=__webpack_require__(131);var _dataObserve2=_interopRequireDefault(_dataObserve);var _actions=__webpack_require__(1648);var _actions2=_interopRequireDefault(_actions);var _dropZone=__webpack_require__(1910);var _dropZone2=_interopRequireDefault(_dropZone);var _actions3=__webpack_require__(1662);var _actions4=_interopRequireDefault(_actions3);var _utils=__webpack_require__(1647);var _utils2=_interopRequireDefault(_utils);var _librarySelectedStore=__webpack_require__(1784);var _librarySelectedStore2=_interopRequireDefault(_librarySelectedStore);var _validationStore=__webpack_require__(1785);var _validationStore2=_interopRequireDefault(_validationStore);var _markup=__webpack_require__(1917);var _markup2=_interopRequireDefault(_markup);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"TinyMCEDropZone",mixins:[(0,_dataObserve2.default)("sites")],propTypes:{editor:_react.PropTypes.object,sites:_react.PropTypes.object,onInsertMedia:_react.PropTypes.func,onRenderModal:_react.PropTypes.func},getInitialState:function getInitialState(){return{isDragging:false}},getDefaultProps:function getDefaultProps(){return{onInsertMedia:_noop2.default,onRenderModal:_noop2.default}},componentDidMount:function componentDidMount(){var editor=this.props.editor;editor.dom.bind(editor.getWin(),"dragenter",this.redirectEditorDragEvent);window.addEventListener("dragleave",this.stopDragging);editor.dom.bind(editor.getWin(),"dragleave",this.stopDragging);editor.dom.bind(editor.getWin(),"dragover",this.fakeDragEnterIfNecessary)},componentWillUnmount:function componentWillUnmount(){var editor=this.props.editor;editor.dom.unbind(editor.getWin(),"dragenter",this.redirectEditorDragEvent);window.removeEventListener("dragleave",this.stopDragging);editor.dom.unbind(editor.getWin(),"dragleave",this.stopDragging);editor.dom.unbind(editor.getWin(),"dragover",this.fakeDragEnterIfNecessary)},redirectEditorDragEvent:function redirectEditorDragEvent(event){window.dispatchEvent(new CustomEvent(event.type,{detail:event}));this.setState({isDragging:true})},fakeDragEnterIfNecessary:function fakeDragEnterIfNecessary(event){if(this.state.isDragging){return}this.redirectEditorDragEvent((0,_assign2.default)({},event,{type:"dragenter"}))},stopDragging:function stopDragging(){this.setState({isDragging:false})},insertMedia:function insertMedia(){var _props=this.props;var sites=_props.sites;var onInsertMedia=_props.onInsertMedia;var onRenderModal=_props.onRenderModal;var site=sites.getSelectedSite();if(!site){return}var selectedItems=_librarySelectedStore2.default.getAll(site.ID);var isSingleImage=1===selectedItems.length&&"image"===_utils2.default.getMimePrefix(selectedItems[0]);if(isSingleImage&&!_validationStore2.default.hasErrors(site.ID)){if(selectedItems[0].transient){_actions2.default.blockSave("MEDIA_MODAL_TRANSIENT_INSERT")}onInsertMedia(_markup2.default.get(selectedItems[0]));_actions4.default.setLibrarySelectedItems(site.ID,[])}else{onRenderModal({visible:true})}_analytics2.default.mc.bumpStat("editor_upload_via","editor_drop")},render:function render(){var sites=this.props.sites;var site=sites.getSelectedSite();if(!site){return null}return _react2.default.createElement(_dropZone2.default,{site:site,fullScreen:false,trackStats:false,onAddMedia:this.insertMedia})}});module.exports=exports["default"]},2563:function(module,exports,__webpack_require__){"use strict";var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ReactDom=__webpack_require__(44),ReactDomServer=__webpack_require__(1800),ReduxProvider=__webpack_require__(15).Provider,React=__webpack_require__(1),tinymce=__webpack_require__(1675),pick=__webpack_require__(91),assign=__webpack_require__(34),values=__webpack_require__(210),debounce=__webpack_require__(278),includes=__webpack_require__(30),i18n=__webpack_require__(11),Shortcode=__webpack_require__(1719),closest=__webpack_require__(729);var sites=__webpack_require__(53)(),PostActions=__webpack_require__(1648),PostEditStore=__webpack_require__(1687),MediaConstants=__webpack_require__(1716),MediaActions=__webpack_require__(1662),MediaUtils=__webpack_require__(1647),MediaSerialization=__webpack_require__(1814),MediaMarkup=__webpack_require__(1917),MediaModalViews=__webpack_require__(1916).Views,MediaStore=__webpack_require__(1717),MediaLibrarySelectedData=__webpack_require__(1878),EditorMediaModal=__webpack_require__(2345),notices=__webpack_require__(78),TinyMCEDropZone=__webpack_require__(2562),restrictSize=__webpack_require__(2564).default,advanced=__webpack_require__(2561),Gridicon=__webpack_require__(26),config=__webpack_require__(12);var REGEXP_IMG=/<img\s[^>]*\/?>/gi,SIZE_ORDER=["thumbnail","medium","large","full"];function mediaButton(editor){var nodes={},updateMedia,resizeEditor;function insertMedia(markup){editor.execCommand("mceInsertContent",false,markup)}function renderModal(){var props=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var selectedSite=sites.getSelectedSite();if(!selectedSite){return}renderDropZone({visible:!props.visible});if(!nodes.modal){nodes.modal=editor.getContainer().appendChild(document.createElement("div"))}if(props.visible&&!options.preserveFocus){editor.focus(false)}ReactDom.render(React.createElement(ReduxProvider,{store:editor.getParam("redux_store")},React.createElement(MediaLibrarySelectedData,{siteId:selectedSite.ID},React.createElement(EditorMediaModal,(0,_extends3.default)({},props,{onClose:renderModal.bind(null,{visible:false}),onInsertMedia:function onInsertMedia(markup){insertMedia(markup);renderModal({visible:false})},site:selectedSite})))),nodes.modal)}function renderDropZone(_ref){var visible=_ref.visible;if(!visible){if(nodes.dropzone){ReactDom.unmountComponentAtNode(nodes.dropzone)}return}if(!nodes.dropzone){nodes.dropzone=document.createElement("div");editor.getContainer().parentNode.insertBefore(nodes.dropzone,editor.getContainer())}ReactDom.render(React.createElement(TinyMCEDropZone,{editor:editor,sites:sites,onInsertMedia:insertMedia,onRenderModal:renderModal}),nodes.dropzone)}var loadedImages=function(){var loaded={};function isLoaded(url){return!!loaded[url]}function onLoad(url){loaded[url]=true;updateMedia()}return{isLoaded:isLoaded,onLoad:onLoad}}();updateMedia=debounce(function(){var selectedSite=sites.getSelectedSite(),isTransientDetected=false,transients=0,isVisualEditMode,content,images;if(!selectedSite){return}isVisualEditMode=!editor.isHidden();if(isVisualEditMode){images=editor.dom.select("img")}else{content=PostEditStore.getRawContent();if(!content){return}images=content.match(REGEXP_IMG)||[]}images.forEach(function(img){var current=MediaSerialization.deserialize(img);if(!current.media.ID){return}if(current.media.transient){transients++;isTransientDetected=true}var media=MediaStore.get(selectedSite.ID,current.media.ID);if(current.media.transient&&(!media||!media.transient)){transients--}else{return}var markup=void 0;if(media){if(media.ID===current.media.ID&&media.URL===current.media.URL){return}var merged=assign({},media,current.media,pick(media,"ID","URL"),{transient:!!media.transient});var options=assign({},current.appearance,{forceResize:!media.transient&&current.media.width&&current.media.width!==media.width});delete merged.caption;markup=MediaMarkup.get(merged,options)}else{notices.error("An error occurred while uploading the file");markup=""}var event={content:markup,mode:isVisualEditMode?"tinymce":"html"};editor.fire("BeforeSetWpcomMedia",event);var imageUrl=MediaSerialization.deserialize(event.content).media.URL;if(!loadedImages.isLoaded(imageUrl)){var preloadImage=new Image;preloadImage.src=imageUrl;preloadImage.onload=loadedImages.onLoad.bind(null,imageUrl);preloadImage.onerror=preloadImage.onload;transients++;return}var imgString=void 0;if(img.outerHTML){imgString=img.outerHTML;img.outerHTML=event.content}else{imgString=img}if(content){content=content.replace(imgString,event.content)}editor.undoManager.data=editor.undoManager.data.map(function(level){level.content=level.content.replace(imgString,event.content);return level})});if(!transients&&PostEditStore.isSaveBlocked("MEDIA_MODAL_TRANSIENT_INSERT")){PostActions.unblockSave("MEDIA_MODAL_TRANSIENT_INSERT")}if(isTransientDetected&&!transients){if(!isVisualEditMode){editor.fire("SetTextAreaContent",{content:content})}editor.fire("change")}});function hideDropZoneOnDrag(event){renderDropZone({visible:event.type==="dragend"})}editor.addCommand("wpcomAddMedia",function(){var selectedSite=sites.getSelectedSite();if(selectedSite){MediaActions.clearValidationErrors(selectedSite.ID)}renderModal({visible:true,initialActiveView:MediaModalViews.LIST})});editor.addButton("wpcom_add_media",{classes:"btn wpcom-icon-button media",cmd:"wpcomAddMedia",title:i18n.translate("Add Media"),onPostRender:function onPostRender(){this.innerHtml(ReactDomServer.renderToStaticMarkup(React.createElement("button",{type:"button",role:"presentation",tabIndex:"-1"},React.createElement(Gridicon,{icon:"image-multiple",size:20}))))}});editor.addButton("wp_img_caption",{tooltip:i18n.translate("Caption",{context:"verb"}),icon:"dashicon dashicons-admin-comments",classes:"toolbar-segment-start toolbar-segment-end",stateSelector:".wp-caption",onclick:function onclick(){var node=editor.selection.getStart(),site=sites.getSelectedSite(),parsed=MediaSerialization.deserialize(node),caption,media,content,attrs,shortcode;if(!parsed||!site){return}caption=closest(node,".wp-caption");if(caption){editor.dom.replace(node,caption.parentNode);if(editor.selection.getStart()!==node){editor.selection.select(node)}editor.selection.controlSelection.showResizeRect(node);editor.nodeChanged();return}media=MediaStore.get(site.ID,parsed.media.ID);if(media&&media.caption){content=media.caption}else{content=i18n.translate("Enter a caption")}["width","height"].forEach(function(dimension){if(null===node.getAttribute(dimension)&&parsed.media[dimension]){node.setAttribute(dimension,parsed.media[dimension])}});attrs={width:parsed.media.width};if(parsed.media.ID){attrs.id="attachment_"+parsed.media.ID}if(parsed.appearance.align){attrs.align="align"+parsed.appearance.align}shortcode=Shortcode.stringify({tag:"caption",attrs:attrs,content:[node.outerHTML,content].join(" ")});editor.selection.setContent(shortcode);editor.selection.select(editor.selection.getStart().querySelector(".wp-caption-dd"),true);editor.selection.controlSelection.hideResizeRect();this.rootControl.hide()}});function resize(increment){var node=editor.selection.getStart();var site=sites.getSelectedSite();var parsed=MediaSerialization.deserialize(node);if(!parsed||!site){return}var caption=editor.dom.getParent(node,".mceTemp");if(caption){editor.selection.select(caption);parsed.media.caption=editor.dom.$(".wp-caption-dd").text()}var media=assign({},MediaStore.get(site.ID,parsed.media.ID));delete media.caption;media=assign({},parsed.media,media);var sizeIndex=SIZE_ORDER.indexOf(parsed.appearance.size);var size=void 0;do{sizeIndex+=increment;size=SIZE_ORDER[Math.max(sizeIndex,0)];var dimensions=MediaUtils.getThumbnailSizeDimensions(size,site);if(media.width>dimensions.width||media.height>dimensions.width){break}}while(sizeIndex>0&&sizeIndex<SIZE_ORDER.length-1);var markup=MediaMarkup.get(media,assign(parsed.appearance,{size:size}));editor.selection.setContent(markup);var replacement=editor.selection.getStart();if("IMG"!==replacement.nodeName){replacement=replacement.querySelector("img")}if(replacement){editor.selection.select(replacement);editor.selection.controlSelection.showResizeRect(replacement)}editor.nodeChanged()}function toggleSizingControls(event){if(!event.element||"IMG"!==event.element.nodeName){return}var parsed=MediaSerialization.deserialize(event.element);var isHidden=parsed.media.transient;if(!isHidden){isHidden=!parsed.appearance.size||!includes(SIZE_ORDER,parsed.appearance.size)}if(!isHidden){var thumb=MediaUtils.getThumbnailSizeDimensions(SIZE_ORDER[0],sites.getSelectedSite());isHidden=(parsed.media.width||Infinity)<thumb.width&&(parsed.media.height||Infinity)<thumb.height}this.classes.toggle("hidden",isHidden)}editor.addButton("wpcom_img_size_decrease",{tooltip:i18n.translate("Decrease size"),classes:"toolbar-segment-start img-size-decrease",icon:"dashicon dashicons-minus",onPostRender:function onPostRender(){var _this=this;editor.selection.selectorChanged(".size-thumbnail",function(state){_this.disabled(state)});editor.on("wptoolbar",toggleSizingControls.bind(this))},onclick:function onclick(){resize(-1)}});editor.addButton("wpcom_img_size_increase",{tooltip:i18n.translate("Increase size"),classes:"toolbar-segment-end img-size-increase",icon:"dashicon dashicons-plus",onPostRender:function onPostRender(){var _this2=this;editor.selection.selectorChanged(".size-full",function(state){_this2.disabled(state)});editor.on("wptoolbar",toggleSizingControls.bind(this))},onclick:function onclick(){resize(1)}});editor.addCommand("WP_Medialib",function(){renderModal({visible:true})});editor.addCommand("wpcomEditGallery",function(content){var site=sites.getSelectedSite();if(!site){return}var gallery=Shortcode.parse(content);if(gallery.tag!=="gallery"){return}gallery=assign({},MediaConstants.GalleryDefaultAttrs,gallery.attrs.named);gallery.items=gallery.ids.split(",").map(function(id){id=parseInt(id,10);var media=MediaStore.get(site.ID,id);if(!media){MediaActions.fetch(site.ID,id)}return assign({ID:id},media)});delete gallery.ids;if(gallery.columns){gallery.columns=parseInt(gallery.columns,10)}if(gallery.orderby){gallery.orderBy=gallery.orderby;delete gallery.orderby}MediaActions.setLibrarySelectedItems(site.ID,gallery.items);renderModal({visible:true,initialActiveView:MediaModalViews.GALLERY,initialGallerySettings:gallery,labels:{confirm:i18n.translate("Update",{context:"verb"})}},{preserveFocus:true})});resizeEditor=debounce(function(){editor.execCommand("wpcomAutoResize",null,null,{skip_focus:true})},400,{leading:true});function resizeOnImageLoad(event){if(event.target.nodeName==="IMG"){resizeEditor()}}function fetchUnknownImages(event){var site=sites.getSelectedSite();if(!site){return}(event.content.match(REGEXP_IMG)||[]).forEach(function(img){var parsed=MediaSerialization.deserialize(img);if(!parsed.media.ID||MediaStore.get(site.ID,parsed.media.ID)){return}setTimeout(function(){MediaActions.fetch(site.ID,parsed.media.ID)},0)})}function preventCaptionTripleClick(event){var caption;if(!event.detail||event.detail<2){return}caption=closest(event.target,".wp-caption-dd",true);if(caption){editor.selection.select(caption)}}function preventCaptionBackspaceRemove(event){var target,range;if(8!==event.keyCode&&46!==event.keyCode){return}target=editor.selection.getStart(true);if(!editor.dom.hasClass(target,"wp-caption-dd")){return}range=editor.selection.getRng();if(8===event.keyCode&&0===range.startOffset||46===event.keyCode&&target.textContent.length===range.endOffset){event.preventDefault()}}function removeEmptyCaptions(focussed){if(focussed){return}editor.dom.select(".wp-caption-dd").forEach(function(caption){var wrapper,img;if(caption.textContent.trim().length){return}wrapper=closest(caption,".wp-caption");img=wrapper.querySelector("img");editor.dom.replace(img,wrapper.parentNode)})}function selectImageOnTap(){var isTouchDragging=false;return function(event){switch(event.type){case"touchstart":isTouchDragging=false;break;case"touchmove":isTouchDragging=true;break;case"touchend":if(!isTouchDragging&&"IMG"===event.target.nodeName){editor.selection.select(event.target);event.preventDefault()}break}}}editor.on("click",preventCaptionTripleClick);editor.on("keydown",preventCaptionBackspaceRemove);if(config.isEnabled("desktop")){(function(){var ipc=__webpack_require__(873).ipcRenderer;editor.on("contextmenu",function(ev){ipc.send("mce-contextmenu",ev)})})()}editor.on("touchstart touchmove touchend",selectImageOnTap());editor.on("init",function(){MediaStore.on("change",updateMedia);editor.getDoc().addEventListener("load",resizeOnImageLoad,true);editor.dom.bind(editor.getDoc(),"dragstart dragend",hideDropZoneOnDrag);editor.selection.selectorChanged(".wp-caption",removeEmptyCaptions)});editor.on("init show hide",function(){renderDropZone({visible:!editor.isHidden()})});editor.on("SetContent",fetchUnknownImages);editor.on("remove",function(){values(nodes).forEach(function(node){ReactDom.unmountComponentAtNode(node);node.parentNode.removeChild(node)});nodes={};MediaStore.off("change",updateMedia);editor.getDoc().removeEventListener("load",resizeOnImageLoad)});restrictSize(editor);advanced(editor)}module.exports=function(){tinymce.PluginManager.add("wpcom/media",mediaButton)}},2564:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getMaxWidth=getMaxWidth;exports.resetImages=resetImages;exports.setImages=setImages;exports.default=function(editor){editor.on("BeforeSetContent BeforeSetWpcomMedia",function(event){if(!event.content||"html"===event.mode){return}event.content=setImages(event.content)});editor.on("GetContent",function(event){if(event.format!=="raw"||!event.content||event.selection){return}event.content=resetImages(event.content)});editor.on("PostProcess",function(event){if(!event.content){return}event.content=resetImages(event.content)});editor.on("BeforeAddUndo",function(event){if(!event.level.content){return}event.level.content=resetImages(event.level.content)})};var _mediaSerialization=__webpack_require__(1814);var _resizeImageUrl=__webpack_require__(1769);var _resizeImageUrl2=_interopRequireDefault(_resizeImageUrl);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var REGEXP_ORIGINAL_IMG=/(<img[^>]*?\ssrc=")([^"]*?)("[^>]*?\/?>)/gi;var REGEXP_REPLACED_IMG=/(<img[^>]*?\ssrc=")([^"]*?)("[^>]*?)(\sdata-wpmedia-src="([^"]*?)")([^>]*?\/?>)/gi;var MEDIA_RETINA="( -webkit-min-device-pixel-ratio: 1.5 ), ( min--moz-device-pixel-ratio: 1.5 ), ( min-resolution: 1.5dppx )";var BASE_MAX_WIDTH=680;var MAX_WIDTH=getMaxWidth();function getMaxWidth(){if(isFinite(window.devicePixelRatio)){return Math.round(BASE_MAX_WIDTH*window.devicePixelRatio)}if(window.matchMedia&&window.matchMedia(MEDIA_RETINA).matches){return Math.round(BASE_MAX_WIDTH*2)}return BASE_MAX_WIDTH}function resetImageSrc(img,opening,src,attributes,origAttr,origSrc,closing){return""+opening+origSrc+attributes+closing}function setImageSrc(img,opening,src,closing){if(-1!==img.indexOf("data-wpmedia-src")){return img}var parsed=(0,_mediaSerialization.deserialize)(img);if(parsed.media.transient||!parsed.media.width||parsed.media.width<MAX_WIDTH){return img}var url=(0,_resizeImageUrl2.default)(parsed.media.URL,{w:MAX_WIDTH});return""+opening+url+'" data-wpmedia-src="'+parsed.media.URL+closing}function resetImages(content){return content.replace(REGEXP_REPLACED_IMG,resetImageSrc)}function setImages(content){return content.replace(REGEXP_ORIGINAL_IMG,setImageSrc)}},2565:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(){_tinymce2.default.PluginManager.add("wpcom/toolbarpin",toolbarPin)};var _tinymce=__webpack_require__(1675);var _tinymce2=_interopRequireDefault(_tinymce);var _throttle=__webpack_require__(388);var _throttle2=_interopRequireDefault(_throttle);var _viewport=__webpack_require__(92);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function toolbarPin(editor){var isMonitoringScroll=false,isPinned=false,container=void 0;function setContainer(){container=editor.getContainer()}function togglePinned(toBePinned){isPinned=toBePinned;editor.dom.toggleClass(container,"is-pinned",isPinned)}var pinToolbarOnScroll=(0,_throttle2.default)(function(){if(!container){return}if(isPinned&&window.pageYOffset<container.offsetTop){togglePinned(false)}else if(!isPinned&&window.pageYOffset>container.offsetTop){togglePinned(true)}},50);var maybeBindScroll=(0,_throttle2.default)(function(event){var isVisual=!editor.isHidden();var shouldBind="remove"!==event.type&&isVisual&&(0,_viewport.isWithinBreakpoint)(">660px");if(shouldBind===isMonitoringScroll){return}var eventBindFn=(shouldBind?"add":"remove")+"EventListener";window[eventBindFn]("scroll",pinToolbarOnScroll);isMonitoringScroll=shouldBind;if(isMonitoringScroll){setContainer();pinToolbarOnScroll()}else{togglePinned(false)}},200);editor.on("init show hide remove",maybeBindScroll);window.addEventListener("resize",maybeBindScroll)}module.exports=exports["default"]},2566:function(module,exports,__webpack_require__){"use strict";var _tinymce=__webpack_require__(1675);var _tinymce2=_interopRequireDefault(_tinymce);var _throttle=__webpack_require__(388);var _throttle2=_interopRequireDefault(_throttle);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function touchScrollToolbar(editor){function disableToolbarTouchEvents(){editor.$(".mce-toolbar:not(.mce-menubar)",document.body).each(function(i,toolbar){toolbar.addEventListener("touchstart",function(event){event.stopImmediatePropagation()})})}function hideToolbarFadeOnFullScroll(){editor.$([editor.$(".mce-inline-toolbar-grp .mce-container-body",document.body),editor.$(".mce-toolbar-grp",editor.theme.panel.getEl())]).each(function(i,toolbar){toolbar.on("scroll",(0,_throttle2.default)(function(_ref){var target=_ref.target;var action=void 0;if(target.scrollLeft===target.scrollWidth-target.clientWidth){action="add"}else if(_tinymce2.default.DOM.hasClass(target,"is-scrolled-full")){action="remove"}if(action){var elements=editor.$(target);if(!elements.hasClass("mce-container-body")){elements.add(_tinymce2.default.DOM.getParent(target,".mce-container-body"))}elements[action+"Class"]("is-scrolled-full")}},200))})}function toggleToolbarsScrollableOnResize(){function toggleToolbarsScrollableClass(){editor.$(".mce-toolbar-grp",editor.theme.panel.getEl()).each(function(i,toolbar){var isScrollable=toolbar.scrollWidth>toolbar.clientWidth;editor.$(toolbar).toggleClass("is-scrollable",isScrollable)})}window.addEventListener("resize",(0,_throttle2.default)(toggleToolbarsScrollableClass,200));toggleToolbarsScrollableClass();editor.on("wptoolbar",function(event){setTimeout(function(){if(!event.toolbar||!event.toolbar.visible()){return}var toolbar=event.toolbar.getEl();var isScrollable=toolbar.firstChild.scrollWidth>toolbar.clientWidth;editor.dom.toggleClass(toolbar,"is-scrollable",isScrollable)},0)})}editor.on("init",function(){disableToolbarTouchEvents();hideToolbarFadeOnFullScroll();toggleToolbarsScrollableOnResize()})}module.exports=function(){_tinymce2.default.PluginManager.add("wpcom/touchscrolltoolbar",touchScrollToolbar)}},2567:function(module,exports,__webpack_require__){"use strict";var tinymce=__webpack_require__(1675);function wcpomAutoResize(editor){var settings=editor.settings,oldSize=0;function isFullscreen(){return editor.plugins.fullscreen&&editor.plugins.fullscreen.isFullscreen()}if(editor.settings.inline||tinymce.Env.iOS){return}function resize(e){var deltaSize,doc,body,docElm,DOM=tinymce.DOM,resizeHeight,myHeight,marginTop,marginBottom,paddingTop,paddingBottom,borderTop,borderBottom;doc=editor.getDoc();if(!doc){return}body=doc.body;docElm=doc.documentElement;resizeHeight=settings.autoresize_min_height;if(!body||e&&e.type==="setcontent"&&e.initial||isFullscreen()){if(body&&docElm){body.style.overflowY="auto";docElm.style.overflowY="auto"}return}marginTop=editor.dom.getStyle(body,"margin-top",true);marginBottom=editor.dom.getStyle(body,"margin-bottom",true);paddingTop=editor.dom.getStyle(body,"padding-top",true);paddingBottom=editor.dom.getStyle(body,"padding-bottom",true);borderTop=editor.dom.getStyle(body,"border-top-width",true);borderBottom=editor.dom.getStyle(body,"border-bottom-width",true);myHeight=body.offsetHeight+parseInt(marginTop,10)+parseInt(marginBottom,10)+parseInt(paddingTop,10)+parseInt(paddingBottom,10)+parseInt(borderTop,10)+parseInt(borderBottom,10);if(myHeight&&myHeight<docElm.offsetHeight){myHeight=docElm.offsetHeight}if(isNaN(myHeight)||myHeight<=0){myHeight=tinymce.Env.ie?body.scrollHeight:tinymce.Env.webkit&&body.clientHeight===0?0:body.offsetHeight}if(myHeight>settings.autoresize_min_height){resizeHeight=myHeight}if(settings.autoresize_max_height&&myHeight>settings.autoresize_max_height){resizeHeight=settings.autoresize_max_height;body.style.overflowY="auto";docElm.style.overflowY="auto"}else{body.style.overflowY="hidden";docElm.style.overflowY="hidden";body.scrollTop=0}if(resizeHeight!==oldSize){deltaSize=resizeHeight-oldSize;DOM.setStyle(editor.iframeElement,"height",resizeHeight+"px");oldSize=resizeHeight;if(tinymce.isWebKit&&deltaSize<0){resize(e)}}}function wait(times,interval,callback){setTimeout(function(){resize({});if(times--){
wait(times,interval,callback)}else if(callback){callback()}},interval)}settings.autoresize_min_height=parseInt(editor.getParam("autoresize_min_height",editor.getElement().offsetHeight),10);settings.autoresize_max_height=parseInt(editor.getParam("autoresize_max_height",0),10);editor.on("init",function(){var overflowPadding,bottomMargin;overflowPadding=editor.getParam("autoresize_overflow_padding",1);bottomMargin=editor.getParam("autoresize_bottom_margin",50);if(overflowPadding!==false){editor.dom.setStyles(editor.getBody(),{paddingLeft:overflowPadding,paddingRight:overflowPadding})}if(bottomMargin!==false){editor.dom.setStyles(editor.getBody(),{paddingBottom:bottomMargin})}});editor.on("nodechange setcontent keyup FullscreenStateChanged",resize);if(editor.getParam("autoresize_on_init",true)){editor.on("init",function(){editor.dom.addClass(editor.getBody(),"wp-autoresize");wait(20,100,function(){wait(5,1e3)})})}editor.addCommand("wpcomAutoResize",resize)}module.exports=function(){tinymce.PluginManager.add("wpcom/autoresize",wcpomAutoResize)}},2568:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _dialog=__webpack_require__(168);var _dialog2=_interopRequireDefault(_dialog);var _formButton=__webpack_require__(379);var _formButton2=_interopRequireDefault(_formButton);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"CharMap",propTypes:{onClose:_react2.default.PropTypes.func,showDialog:_react2.default.PropTypes.bool,editor:_react2.default.PropTypes.object},defaultCharMap:function defaultCharMap(){return[["160","no-break space"],["173","soft hyphen"],["34","quotation mark"],["162","cent sign"],["8364","euro sign"],["163","pound sign"],["165","yen sign"],["169","copyright sign"],["174","registered sign"],["8482","trade mark sign"],["8240","per mille sign"],["181","micro sign"],["183","middle dot"],["8226","bullet"],["8230","three dot leader"],["8242","minutes / feet"],["8243","seconds / inches"],["167","section sign"],["182","paragraph sign"],["223","sharp s / ess-zed"],["8249","single left-pointing angle quotation mark"],["8250","single right-pointing angle quotation mark"],["171","left pointing guillemet"],["187","right pointing guillemet"],["8216","left single quotation mark"],["8217","right single quotation mark"],["8220","left double quotation mark"],["8221","right double quotation mark"],["8218","single low-9 quotation mark"],["8222","double low-9 quotation mark"],["60","less-than sign"],["62","greater-than sign"],["8804","less-than or equal to"],["8805","greater-than or equal to"],["8211","en dash"],["8212","em dash"],["175","macron"],["8254","overline"],["164","currency sign"],["166","broken bar"],["168","diaeresis"],["161","inverted exclamation mark"],["191","turned question mark"],["710","circumflex accent"],["732","small tilde"],["176","degree sign"],["8722","minus sign"],["177","plus-minus sign"],["247","division sign"],["8260","fraction slash"],["215","multiplication sign"],["185","superscript one"],["178","superscript two"],["179","superscript three"],["188","fraction one quarter"],["189","fraction one half"],["190","fraction three quarters"],["402","function / florin"],["8747","integral"],["8721","n-ary sumation"],["8734","infinity"],["8730","square root"],["8764","similar to"],["8773","approximately equal to"],["8776","almost equal to"],["8800","not equal to"],["8801","identical to"],["8712","element of"],["8713","not an element of"],["8715","contains as member"],["8719","n-ary product"],["8743","logical and"],["8744","logical or"],["172","not sign"],["8745","intersection"],["8746","union"],["8706","partial differential"],["8704","for all"],["8707","there exists"],["8709","diameter"],["8711","backward difference"],["8727","asterisk operator"],["8733","proportional to"],["8736","angle"],["180","acute accent"],["184","cedilla"],["170","feminine ordinal indicator"],["186","masculine ordinal indicator"],["8224","dagger"],["8225","double dagger"],["192","A - grave"],["193","A - acute"],["194","A - circumflex"],["195","A - tilde"],["196","A - diaeresis"],["197","A - ring above"],["198","ligature AE"],["199","C - cedilla"],["200","E - grave"],["201","E - acute"],["202","E - circumflex"],["203","E - diaeresis"],["204","I - grave"],["205","I - acute"],["206","I - circumflex"],["207","I - diaeresis"],["208","ETH"],["209","N - tilde"],["210","O - grave"],["211","O - acute"],["212","O - circumflex"],["213","O - tilde"],["214","O - diaeresis"],["216","O - slash"],["338","ligature OE"],["352","S - caron"],["217","U - grave"],["218","U - acute"],["219","U - circumflex"],["220","U - diaeresis"],["221","Y - acute"],["376","Y - diaeresis"],["222","THORN"],["224","a - grave"],["225","a - acute"],["226","a - circumflex"],["227","a - tilde"],["228","a - diaeresis"],["229","a - ring above"],["230","ligature ae"],["231","c - cedilla"],["232","e - grave"],["233","e - acute"],["234","e - circumflex"],["235","e - diaeresis"],["236","i - grave"],["237","i - acute"],["238","i - circumflex"],["239","i - diaeresis"],["240","eth"],["241","n - tilde"],["242","o - grave"],["243","o - acute"],["244","o - circumflex"],["245","o - tilde"],["246","o - diaeresis"],["248","o slash"],["339","ligature oe"],["353","s - caron"],["249","u - grave"],["250","u - acute"],["251","u - circumflex"],["252","u - diaeresis"],["253","y - acute"],["254","thorn"],["255","y - diaeresis"],["913","Alpha"],["914","Beta"],["915","Gamma"],["916","Delta"],["917","Epsilon"],["918","Zeta"],["919","Eta"],["920","Theta"],["921","Iota"],["922","Kappa"],["923","Lambda"],["924","Mu"],["925","Nu"],["926","Xi"],["927","Omicron"],["928","Pi"],["929","Rho"],["931","Sigma"],["932","Tau"],["933","Upsilon"],["934","Phi"],["935","Chi"],["936","Psi"],["937","Omega"],["945","alpha"],["946","beta"],["947","gamma"],["948","delta"],["949","epsilon"],["950","zeta"],["951","eta"],["952","theta"],["953","iota"],["954","kappa"],["955","lambda"],["956","mu"],["957","nu"],["958","xi"],["959","omicron"],["960","pi"],["961","rho"],["962","final sigma"],["963","sigma"],["964","tau"],["965","upsilon"],["966","phi"],["967","chi"],["968","psi"],["969","omega"],["8501","alef symbol"],["982","pi symbol"],["8476","real part symbol"],["978","upsilon - hook symbol"],["8472","Weierstrass p"],["8465","imaginary part"],["8592","leftwards arrow"],["8593","upwards arrow"],["8594","rightwards arrow"],["8595","downwards arrow"],["8596","left right arrow"],["8629","carriage return"],["8656","leftwards double arrow"],["8657","upwards double arrow"],["8658","rightwards double arrow"],["8659","downwards double arrow"],["8660","left right double arrow"],["8756","therefore"],["8834","subset of"],["8835","superset of"],["8836","not a subset of"],["8838","subset of or equal to"],["8839","superset of or equal to"],["8853","circled plus"],["8855","circled times"],["8869","perpendicular"],["8901","dot operator"],["8968","left ceiling"],["8969","right ceiling"],["8970","left floor"],["8971","right floor"],["9001","left-pointing angle bracket"],["9002","right-pointing angle bracket"],["9674","lozenge"],["9824","black spade suit"],["9827","black club suit"],["9829","black heart suit"],["9830","black diamond suit"],["8194","en space"],["8195","em space"],["8201","thin space"],["8204","zero width non-joiner"],["8205","zero width joiner"],["8206","left-to-right mark"],["8207","right-to-left mark"]]},renderCell:function renderCell(cell){return _react2.default.createElement("div",{key:cell[0],onClick:this.onCellClick,role:"button",title:cell[1],className:"wpcom-charmap__character"},String.fromCharCode(parseInt(cell[0],10)))},onCellClick:function onCellClick(event){this.props.editor.execCommand("mceInsertContent",false,event.target.textContent.trim())},getButtons:function getButtons(){return[_react2.default.createElement(_formButton2.default,{isPrimary:false,"aria-label":this.translate("Close special characters dialog"),onClick:this.props.onClose},this.translate("Close"))]},render:function render(){return _react2.default.createElement(_dialog2.default,{isVisible:this.props.showDialog,buttons:this.getButtons(),additionalClassNames:"wpcom-charmap__dialog",onClose:this.props.onClose},_react2.default.createElement("h2",{className:"wpcom-charmap__heading"},this.translate("Special characters")),_react2.default.createElement("div",{className:"wpcom-charmap__table"},this.defaultCharMap().map(this.renderCell,this)))}});module.exports=exports["default"]},2569:function(module,exports,__webpack_require__){"use strict";var _reactDom=__webpack_require__(44);var _reactDom2=_interopRequireDefault(_reactDom);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _tinymce=__webpack_require__(1675);var _tinymce2=_interopRequireDefault(_tinymce);var _charmap=__webpack_require__(2568);var _charmap2=_interopRequireDefault(_charmap);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function wpcomCharMapPlugin(editor){var node;editor.on("init",function(){node=document.createElement("div");node.setAttribute("class","charmap-dialog-container");editor.getContainer().appendChild(node)});editor.on("remove",function(){_reactDom2.default.unmountComponentAtNode(node);node.parentNode.removeChild(node);node=null});editor.addCommand("Wpcom_CharMap",function(){function onClose(){editor.focus();render("hide")}function render(){var visibility=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"show";_reactDom2.default.render(_react2.default.createElement(_charmap2.default,{showDialog:visibility==="show",onClose:onClose,editor:editor}),node)}render("show")})}module.exports=function(){_tinymce2.default.PluginManager.add("wpcom/charmap",wpcomCharMapPlugin)}},2570:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1),forEach=__webpack_require__(114);var Dialog=__webpack_require__(168),FormButton=__webpack_require__(379);var HelpModal=React.createClass({displayName:"HelpModal",propTypes:{onClose:React.PropTypes.func,macosx:React.PropTypes.bool,showDialog:React.PropTypes.bool},defaultShortcuts:function defaultShortcuts(){return[{c:this.translate("Copy"),x:this.translate("Cut")},{v:this.translate("Paste"),a:this.translate("Select all")},{z:this.translate("Undo"),y:this.translate("Redo")},{b:this.translate("Bold"),i:this.translate("Italic")},{u:this.translate("Underline"),k:this.translate("Insert/edit link")}]},additionalShortcuts:function additionalShortcuts(){return[{1:this.translate("Heading 1"),2:this.translate("Heading 2")},{3:this.translate("Heading 3"),4:this.translate("Heading 4")},{5:this.translate("Heading 5"),6:this.translate("Heading 6")},{l:this.translate("Align left"),c:this.translate("Align center")},{r:this.translate("Align right"),j:this.translate("Justify")},{d:this.translate("Strikethrough"),q:this.translate("Blockquote")},{u:this.translate("Bullet list"),o:this.translate("Numbered list")},{a:this.translate("Insert/edit link"),s:this.translate("Remove link")},{m:this.translate("Insert/edit image"),t:this.translate("Insert Read More tag")},{h:this.translate("Keyboard Shortcuts"),x:this.translate("Code")},{p:this.translate("Insert Page Break tag")}]},renderRow:function renderRow(row,index){var columns=[];forEach(row,function(text,key){columns.push(React.createElement("th",{className:"wpcom-help__key",key:key},React.createElement("kbd",null,key)));columns.push(React.createElement("td",{className:"wpcom-help__action",key:text},text))});return React.createElement("tr",{key:index},columns)},getButtons:function getButtons(){return[React.createElement(FormButton,{key:"close",isPrimary:false,onClick:this.props.onClose},this.translate("Close"))]},getKeyLabel:function getKeyLabel(){return this.translate("Key",{context:"Computer key used in keyboard shortcut"})},getActionLabel:function getActionLabel(){return this.translate("Action",{context:"Action taken when pressing keyboard shortcut"})},getTableHead:function getTableHead(){return React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",{className:"wpcom-help__key"},this.getKeyLabel()),React.createElement("th",{className:"wpcom-help__action"},this.getActionLabel()),React.createElement("th",{className:"wpcom-help__key"},this.getKeyLabel()),React.createElement("th",{className:"wpcom-help__action"},this.getActionLabel())))},render:function render(){var defaultText=this.props.macosx?this.translate("Default shortcuts, Command + key:",{context:"Mac shortcuts"}):this.translate("Default shortcuts, Ctrl + key:",{context:"Windows shortcuts"});var additionalText=this.props.macosx?this.translate("Additional shortcuts, Control + Option + key:",{context:"Mac shortcuts"}):this.translate("Additional shortcuts, Shift + Alt + key:",{context:"Windows shortcuts"});return React.createElement(Dialog,{isVisible:this.props.showDialog,buttons:this.getButtons(),additionalClassNames:"wpcom-help__dialog",onClose:this.props.onClose},React.createElement("h2",{className:"wpcom-help__heading"},this.translate("Keyboard Shortcuts")),React.createElement("p",null,defaultText),React.createElement("table",{className:"wpcom-help__table"},this.getTableHead(),React.createElement("tbody",null,this.defaultShortcuts().map(this.renderRow,this))),React.createElement("p",null,additionalText),React.createElement("table",{className:"wpcom-help__table"},this.getTableHead(),React.createElement("tbody",null,this.additionalShortcuts().map(this.renderRow,this))))}});module.exports=HelpModal},2571:function(module,exports,__webpack_require__){"use strict";var ReactDom=__webpack_require__(44),React=__webpack_require__(1),tinymce=__webpack_require__(1675);var HelpModal=__webpack_require__(2570);function wpcomHelpPlugin(editor){var node;editor.on("init",function(){node=editor.getContainer().appendChild(document.createElement("div"))});editor.on("remove",function(){ReactDom.unmountComponentAtNode(node);node.parentNode.removeChild(node);node=null});editor.addCommand("WP_Help",function(){function onClose(){editor.focus();render("hide")}function render(){var visibility=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"show";ReactDom.render(React.createElement(HelpModal,{showDialog:visibility==="show"?true:false,onClose:onClose,macosx:tinymce.Env.mac}),node)}render("show")})}module.exports=function(){tinymce.PluginManager.add("wpcom/help",wpcomHelpPlugin)}},2572:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.wrapPre=wrapPre;exports.unwrapPre=unwrapPre;exports.default=function(){_tinymce2.default.PluginManager.add("wpcom/sourcecode",sourcecode)};var _tinymce=__webpack_require__(1675);var _tinymce2=_interopRequireDefault(_tinymce);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var REGEXP_CODE_SHORTCODE=new RegExp("(?:<p>\\s*)?(?:<pre>\\s*)?(\\[(code|sourcecode)[^\\]]*\\][\\s\\S]*?\\[\\/\\2\\])(?:\\s*<\\/pre>)?(?:\\s*<\\/p>)?","gi");function wrapPre(_ref){var content=_ref.content;var initial=_ref.initial;var load=_ref.load;return content=content.replace(REGEXP_CODE_SHORTCODE,function(match,shortcode){shortcode=shortcode.replace(/\r/,"");shortcode=shortcode.replace(/<br ?\/?>\n?/g,"\n").replace(/<\/?p( [^>]*)?>\n?/g,"\n");if(!initial||load){shortcode=shortcode.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}return"<pre>"+shortcode+"</pre>"})}function unwrapPre(_ref2){var content=_ref2.content;if(!content||content.indexOf("[")===-1){return content}return content.replace(REGEXP_CODE_SHORTCODE,function(match,shortcode){shortcode=shortcode.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&");return"<p>"+shortcode+"</p>"})}function sourcecode(editor){editor.on("BeforeSetContent",function(event){if(!event.content||"html"===event.mode){return}event.content=wrapPre(event)});editor.on("GetContent",function(event){if(event.format!=="raw"||!event.content||event.selection){return}event.content=unwrapPre(event)});editor.on("PostProcess",function(event){if(!event.content){return}event.content=unwrapPre(event)})}},2573:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _isInteger=__webpack_require__(3316);var _isInteger2=_interopRequireDefault(_isInteger);exports.default=function(){_tinymce2.default.PluginManager.add("wpcom/tabindex",wpcomTabIndexPlugin)};var _tinymce=__webpack_require__(1675);var _tinymce2=_interopRequireDefault(_tinymce);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function setTabIndexOnEditorIframe(tabindex){return function(){var editorIframe=document.getElementById(this.id+"_ifr");if(!editorIframe){return}editorIframe.setAttribute("tabIndex",tabindex)}}function wpcomTabIndexPlugin(editor){var settings=editor&&editor.settings;if(!settings||!("tabindex"in settings)){return}var tabindex=Math.min(32767,Number(settings.tabindex));if(!(0,_isInteger2.default)(tabindex)){return}editor.on("init",setTabIndexOnEditorIframe(tabindex))}module.exports=exports["default"]},2574:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _reactDom=__webpack_require__(44);var _reactDom2=_interopRequireDefault(_reactDom);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _shortcode=__webpack_require__(1719);var _shortcode2=_interopRequireDefault(_shortcode);var _galleryShortcode=__webpack_require__(2223);var _galleryShortcode2=_interopRequireDefault(_galleryShortcode);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var GalleryView=function(_Component){(0,_inherits3.default)(GalleryView,_Component);(0,_createClass3.default)(GalleryView,null,[{key:"match",value:function match(content){var nextMatch=_shortcode2.default.next("gallery",content);if(nextMatch){return{index:nextMatch.index,content:nextMatch.content,options:{shortcode:nextMatch.shortcode}}}}},{key:"serialize",value:function serialize(content){return encodeURIComponent(content)}},{key:"edit",value:function edit(editor,content){editor.execCommand("wpcomEditGallery",content)}}]);function GalleryView(props){(0,_classCallCheck3.default)(this,GalleryView);var _this=(0,_possibleConstructorReturn3.default)(this,(GalleryView.__proto__||(0,_getPrototypeOf2.default)(GalleryView)).call(this,props));_this.state={wrapper:null};return _this}(0,_createClass3.default)(GalleryView,[{key:"componentDidMount",value:function componentDidMount(){this.setState({wrapper:_reactDom2.default.findDOMNode(this.refs.view)});if(window.MutationObserver){this.observer=new MutationObserver(this.props.onResize);this.observer.observe(_reactDom2.default.findDOMNode(this.refs.view),{attributes:true,childList:true,subtree:true})}}},{key:"componentWillUnmount",value:function componentWillUnmount(){if(this.observer){this.observer.disconnect()}}},{key:"renderShortcode",value:function renderShortcode(){if(!this.state.wrapper){return}return _react2.default.createElement(_galleryShortcode2.default,{siteId:this.props.siteId,width:this.state.wrapper.clientWidth},this.props.content)}},{key:"render",value:function render(){return _react2.default.createElement("div",{ref:"view",className:"wpview-content wpview-type-gallery"},this.renderShortcode())}}]);return GalleryView}(_react.Component);GalleryView.propTypes={siteId:_react.PropTypes.number,content:_react.PropTypes.string,onResize:_react.PropTypes.func};GalleryView.defaultProps={onResize:function onResize(){}};exports.default=GalleryView;module.exports=exports["default"]},2575:function(module,exports,__webpack_require__){"use strict";var _reactRedux=__webpack_require__(15);var tinymce=__webpack_require__(1675),debounce=__webpack_require__(278),ReactDom=__webpack_require__(44),React=__webpack_require__(1),i18n=__webpack_require__(11);var views=__webpack_require__(2577),sites=__webpack_require__(53)();function wpview(editor){var $=editor.$,selected,Env=tinymce.Env,VK=tinymce.util.VK,TreeWalker=tinymce.dom.TreeWalker,toRemove=false,firstFocus=true,isios=/iPad|iPod|iPhone/.test(navigator.userAgent),cursorInterval,lastKeyDownNode,setViewCursorTries,focus,execCommandView,execCommandBefore,toolbar;function replaceMarkers(){var markers=$(".wpview-marker");if(!markers.length){return false}markers.each(function(index,node){var text=editor.dom.getAttrib(node,"data-wpview-text"),type=editor.dom.getAttrib(node,"data-wpview-type");editor.dom.replace(editor.dom.createFragment('<div class="wpview-wrap" data-wpview-text="'+text+'" data-wpview-type="'+type+'">'+'<p class="wpview-selection-before"></p>'+'<div class="wpview-body" contenteditable="false"></div>'+'<p class="wpview-selection-after"></p>'+"</div>"),node)});return true}function triggerNodeChanged(){editor.nodeChanged()}function renderViews(){if(!replaceMarkers()){return}$(".wpview-wrap").each(function(index,view){var $view=$(view),type;if(undefined!==$view.attr("data-wpview-rendered")){return}type=$view.attr("data-wpview-type");ReactDom.render(React.createElement(_reactRedux.Provider,{store:editor.getParam("redux_store")},React.createElement(views.components[type],{content:getText(view),siteId:sites.getSelectedSite()?sites.getSelectedSite().ID:null,onResize:debounce(triggerNodeChanged,500)})),$view.find(".wpview-body")[0]);$view.attr("data-wpview-rendered","")})}function getText(node){return decodeURIComponent($(node).attr("data-wpview-text")||"")}function getView(node){return getParent(node,"wpview-wrap")}function getParent(node,className){while(node&&node.parentNode){if(node.className&&(" "+node.className+" ").indexOf(" "+className+" ")!==-1){return node}node=node.parentNode}return false}function _stop(event){event.stopPropagation()}function setViewCursor(before,view){var location=before?"before":"after",offset=before?0:1;deselect();editor.selection.setCursorLocation(editor.dom.select(".wpview-selection-"+location,view)[0],offset);editor.nodeChanged()}function handleEnter(view,before,key){var dom=editor.dom,padNode=dom.create("p");if(!(Env.ie&&Env.ie<11)){padNode.innerHTML='<br data-mce-bogus="1">'}if(before){view.parentNode.insertBefore(padNode,view)}else{dom.insertAfter(padNode,view)}deselect();if(before&&key===VK.ENTER){setViewCursor(before,view)}else{editor.selection.setCursorLocation(padNode,0)}editor.nodeChanged()}function removeView(view){editor.undoManager.transact(function(){handleEnter(view);ReactDom.unmountComponentAtNode($(view).find(".wpview-body")[0]);editor.dom.remove(view);editor.focus()})}function select(viewNode){var clipboard,dom=editor.dom;if(!viewNode){return}if(viewNode!==selected){editor.getBody().focus();deselect();selected=viewNode;dom.setAttrib(viewNode,"data-mce-selected",1);clipboard=dom.create("div",{class:"wpview-clipboard",contenteditable:"true"},getText(viewNode));editor.dom.select(".wpview-body",viewNode)[0].appendChild(clipboard);dom.bind(clipboard,"beforedeactivate focusin focusout",_stop);dom.bind(selected,"beforedeactivate focusin focusout",_stop);if(isios){editor.selection.select(clipboard)}else{editor.selection.select(clipboard,true)}}editor.nodeChanged();editor.fire("wpview-selected",viewNode)}function deselect(){var clipboard,dom=editor.dom;if(selected){clipboard=editor.dom.select(".wpview-clipboard",selected)[0];dom.unbind(clipboard);dom.remove(clipboard);dom.unbind(selected,"beforedeactivate focusin focusout click mouseup",_stop);dom.setAttrib(selected,"data-mce-selected",null)}selected=null}function resetViewsCallback(match,viewText){return"<p>"+window.decodeURIComponent(viewText)+"</p>"}function resetViews(content){return content.replace(/<div[^>]+data-wpview-text="([^"]+)"[^>]*>(?:[\s\S]+?wpview-selection-after[^>]+>[^<>]*<\/p>\s*|\.)<\/div>/g,resetViewsCallback).replace(/<p [^>]*?data-wpview-text="([^"]+)"[^>]*>[\s\S]*?<\/p>/g,resetViewsCallback)}function setMarkers(){var content,processedContent;if(editor.isHidden()){return}content=editor.getContent({format:"raw"});processedContent=views.setMarkers(content);if(content!==processedContent){editor.setContent(processedContent,{format:"raw",isSettingMarkers:true})}}editor.on("BeforeAddUndo",function(event){if(event.level.content){event.level.content=resetViews(event.level.content)}});editor.on("BeforeSetContent",function(event){var node;if(!event.selection){$(".wpview-wrap .wpview-body").each(function(i,viewBody){ReactDom.unmountComponentAtNode(viewBody)})}if(!event.content){return}if(!event.load){if(selected){removeView(selected)}node=editor.selection.getNode();if(node&&node!==editor.getBody()&&/^\s*https?:\/\/\S+\s*$/i.test(event.content)){node=editor.dom.getParent(node,"p");if(node&&/^[\s\uFEFF\u00A0]*$/.test($(node).text()||"")){node.innerHTML=""}else{return}}}if(!event.isSettingMarkers){event.content=views.setMarkers(event.content)}});editor.on("pastePreProcess",function(event){var pastedStr=event.content;if(pastedStr){pastedStr=tinymce.trim(pastedStr.replace(/<[^>]+>/g,""));if(/^https?:\/\/\S+$/i.test(pastedStr)){event.content=pastedStr}}});editor.on("SetContent",function(){renderViews()});editor.on("click",function(event){var x=event.clientX,y=event.clientY,body=editor.getBody(),bodyRect=body.getBoundingClientRect(),first=body.firstChild,last=body.lastChild,firstRect,lastRect,view;if(!first||!last){return}firstRect=first.getBoundingClientRect();lastRect=last.getBoundingClientRect();if(y<firstRect.top&&(view=getView(first))){setViewCursor(true,view);event.preventDefault()}else if(y>lastRect.bottom&&(view=getView(last))){setViewCursor(false,view);event.preventDefault()}else if(x<bodyRect.left||x>bodyRect.right){tinymce.each(editor.dom.select(".wpview-wrap"),function(view){var rect=view.getBoundingClientRect();if(y<rect.top){return false}if(y>=rect.top&&y<=rect.bottom){if(x<bodyRect.left){setViewCursor(true,view);event.preventDefault()}else if(x>bodyRect.right){setViewCursor(false,view);event.preventDefault()}return false}})}});editor.on("init",function(){var scrolled=false,selection=editor.selection,MutationObserver=window.MutationObserver||window.WebKitMutationObserver;editor.on("BeforeSetContent",function(){var walker,target,view=getView(selection.getNode());if(!view){return}if(!view.nextSibling||getView(view.nextSibling)){target=editor.getDoc().createTextNode("");editor.dom.insertAfter(target,view)}else{walker=new TreeWalker(view.nextSibling,view.nextSibling);target=walker.next()}selection.select(target);selection.collapse(true)});editor.dom.bind(editor.getDoc(),"touchmove",function(){scrolled=true});editor.on("mousedown mouseup click touchend",function(event){var view=getView(event.target);firstFocus=false;if(view){event.stopImmediatePropagation();event.preventDefault();if(event.type==="touchend"&&scrolled){scrolled=false}else{select(view)}return false}else{if(event.type==="touchend"||event.type==="mousedown"){deselect()}}if(event.type==="touchend"&&scrolled){scrolled=false}},true);if(MutationObserver){new MutationObserver(function(){editor.fire("wp-body-class-change")}).observe(editor.getBody(),{attributes:true,attributeFilter:["class"]})}});editor.on("preinit show",function(){views.emitters.forEach(function(emitter){emitter.addListener("change",setMarkers)});setMarkers()});editor.on("hide remove",function(){views.emitters.forEach(function(emitter){emitter.removeListener("change",setMarkers)})});function emptyViewNodes(rootNode){$("div.wpview-wrap, p.wpview-marker",rootNode).each(function(i,node){node.innerHTML="."})}editor.on("PreProcess",function(event){emptyViewNodes(event.node)},true);editor.on("hide",function(){deselect();emptyViewNodes()});editor.on("GetContent",function(event){if(event.format==="raw"&&event.content&&!event.selection){event.content=resetViews(event.content)}});editor.on("PostProcess",function(event){if(event.content){event.content=event.content.replace(/<div [^>]*?data-wpview-text="([^"]+)"[^>]*>[\s\S]*?<\/div>/g,resetViewsCallback).replace(/<p [^>]*?data-wpview-text="([^"]+)"[^>]*>[\s\S]*?<\/p>/g,resetViewsCallback)}});function isSpecialKey(key){return key<=47&&key!==VK.SPACEBAR&&key!==VK.ENTER&&key!==VK.DELETE&&key!==VK.BACKSPACE&&(key<37||key>40)||key>=224||key>=144&&key<=150||key>=91&&key<=93||key>=112&&key<=135}editor.on("keydown",function(event){var key=event.keyCode,dom=editor.dom,selection=editor.selection,node,view,cursorBefore,cursorAfter,range,clonedRange,tempRange;if(selected){if((event.metaKey||event.ctrlKey)&&key!==VK.BACKSPACE&&key!==86||key>=112&&key<=123){if((event.metaKey||event.ctrlKey)&&key===88){toRemove=selected}return}view=getView(selection.getNode());if(view!==selected){deselect();return}if(key===VK.LEFT){setViewCursor(true,view);event.preventDefault()}else if(key===VK.UP){if(view.previousSibling){if(getView(view.previousSibling)){setViewCursor(true,view.previousSibling)}else{deselect();selection.select(view.previousSibling,true);selection.collapse()}}else{setViewCursor(true,view)}event.preventDefault()}else if(key===VK.RIGHT){setViewCursor(false,view);event.preventDefault()}else if(key===VK.DOWN){if(view.nextSibling){if(getView(view.nextSibling)){setViewCursor(false,view.nextSibling)}else{deselect();selection.setCursorLocation(view.nextSibling,0)}}else{setViewCursor(false,view)}event.preventDefault()}else if(!isSpecialKey(key)){removeView(selected);if(key===VK.ENTER||key===VK.DELETE||key===VK.BACKSPACE){event.preventDefault()}}}else{if(event.metaKey||event.ctrlKey||key>=112&&key<=123){return}node=selection.getNode();lastKeyDownNode=node;view=getView(node);if(!selection.isCollapsed()){range=selection.getRng();if(view=getView(range.endContainer)){clonedRange=range.cloneRange();selection.select(view.previousSibling,true);selection.collapse();tempRange=selection.getRng();clonedRange.setEnd(tempRange.endContainer,tempRange.endOffset);selection.setRng(clonedRange)}else if(view=getView(range.startContainer)){clonedRange=range.cloneRange();clonedRange.setStart(view.nextSibling,0);selection.setRng(clonedRange)}}if(!view){if(event.keyCode===VK.BACKSPACE){if(editor.dom.isEmpty(node)){if(view=getView(node.previousSibling)){setViewCursor(false,view);editor.dom.remove(node);event.preventDefault()}}else if((range=selection.getRng())&&range.startOffset===0&&range.endOffset===0&&(view=getView(node.previousSibling))){setViewCursor(false,view);event.preventDefault()}}return}if(!((cursorBefore=dom.hasClass(view,"wpview-selection-before"))||(cursorAfter=dom.hasClass(view,"wpview-selection-after")))){return}if(isSpecialKey(key)){return}if(cursorAfter&&key===VK.UP||cursorBefore&&key===VK.BACKSPACE){if(view.previousSibling){if(getView(view.previousSibling)){setViewCursor(false,view.previousSibling)}else{if(dom.isEmpty(view.previousSibling)&&key===VK.BACKSPACE){dom.remove(view.previousSibling)}else{selection.select(view.previousSibling,true);selection.collapse()}}}else{setViewCursor(true,view)}event.preventDefault()}else if(cursorAfter&&(key===VK.DOWN||key===VK.RIGHT)){if(view.nextSibling){if(getView(view.nextSibling)){setViewCursor(key===VK.RIGHT,view.nextSibling)}else{selection.setCursorLocation(view.nextSibling,0)}}event.preventDefault()}else if(cursorBefore&&(key===VK.UP||key===VK.LEFT)){if(view.previousSibling){if(getView(view.previousSibling)){setViewCursor(key===VK.UP,view.previousSibling)}else{selection.select(view.previousSibling,true);selection.collapse()}}event.preventDefault();
}else if(cursorBefore&&key===VK.DOWN){if(view.nextSibling){if(getView(view.nextSibling)){setViewCursor(true,view.nextSibling)}else{selection.setCursorLocation(view.nextSibling,0)}}else{setViewCursor(false,view)}event.preventDefault()}else if(cursorAfter&&key===VK.LEFT||cursorBefore&&key===VK.RIGHT){select(view);event.preventDefault()}else if(cursorAfter&&key===VK.BACKSPACE){removeView(view);event.preventDefault()}else if(cursorAfter){handleEnter(view)}else if(cursorBefore){handleEnter(view,true,key)}if(key===VK.ENTER){event.preventDefault()}}});editor.on("keyup",function(){if(toRemove){removeView(toRemove);toRemove=false}});editor.on("focus",function(){var view;focus=true;editor.dom.addClass(editor.getBody(),"has-focus");if(firstFocus&&(view=getView(editor.getBody().firstChild))){setViewCursor(true,view)}firstFocus=false});editor.on("blur",function(){focus=false;editor.dom.removeClass(editor.getBody(),"has-focus")});editor.on("NodeChange",function(event){var dom=editor.dom,views=editor.dom.select(".wpview-wrap"),className=event.element.className,view=getView(event.element),lKDN=lastKeyDownNode;lastKeyDownNode=false;clearInterval(cursorInterval);tinymce.each(views,function(view){if(view.className){view.className=view.className.replace(/ ?\bwpview-(?:selection-before|selection-after|cursor-hide)\b/g,"")}});if(focus&&view){if((className==="wpview-selection-before"||className==="wpview-selection-after")&&editor.selection.isCollapsed()){setViewCursorTries=0;deselect();if(lKDN===view.previousSibling){setViewCursor(true,view);return}else if(lKDN===view.nextSibling){setViewCursor(false,view);return}dom.addClass(view,className);cursorInterval=setInterval(function(){if(dom.hasClass(view,"wpview-cursor-hide")){dom.removeClass(view,"wpview-cursor-hide")}else{dom.addClass(view,"wpview-cursor-hide")}},500)}else if(!getParent(event.element,"wpview-clipboard")&&!setViewCursorTries){deselect();setViewCursorTries++;setViewCursor(true,view)}}});editor.on("BeforeExecCommand",function(){var node=editor.selection.getNode(),view;if(node&&((execCommandBefore=node.className==="wpview-selection-before")||node.className==="wpview-selection-after")&&(view=getView(node))){handleEnter(view,execCommandBefore);execCommandView=view}});editor.on("ExecCommand",function(){var toSelect,node;if(selected){toSelect=selected;deselect();select(toSelect)}if(execCommandView){node=execCommandView[execCommandBefore?"previousSibling":"nextSibling"];if(node&&node.nodeName==="P"&&editor.dom.isEmpty(node)){editor.dom.remove(node);setViewCursor(execCommandBefore,execCommandView)}execCommandView=false}});editor.on("ResolveName",function(event){if(editor.dom.hasClass(event.target,"wpview-wrap")){event.name=editor.dom.getAttrib(event.target,"data-wpview-type")||"wpview";event.stopPropagation()}else if(getView(event.target)){event.preventDefault();event.stopPropagation()}});editor.addButton("wp_view_edit",{tooltip:i18n.translate("Edit",{context:"verb"}),icon:"dashicon dashicons-edit",onPostRender:function onPostRender(){editor.on("wptoolbar",function(){var type;if(!selected){return}type=editor.dom.getAttrib(selected,"data-wpview-type");this.visible(views.isEditable(type))}.bind(this))},onClick:function onClick(){var type;if(!selected){return}type=editor.dom.getAttrib(selected,"data-wpview-type");views.edit(type,editor,getText(selected))}});editor.addButton("wp_view_remove",{tooltip:i18n.translate("Remove"),icon:"dashicon dashicons-no",onClick:function onClick(){selected&&removeView(selected)}});editor.once("preinit",function(){toolbar=editor.wp._createToolbar(["wp_view_edit","wp_view_remove"])});editor.on("wptoolbar",function(event){if(selected){event.element=selected;event.toolbar=toolbar}})}module.exports=function(){tinymce.PluginManager.add("wpcom/view",wpview)}},2576:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);exports.default=function(Component){var _class,_temp;var componentName=Component.displayName||Component.name||"";return _temp=_class=function(_PureComponent){(0,_inherits3.default)(_class,_PureComponent);function _class(){(0,_classCallCheck3.default)(this,_class);var _this=(0,_possibleConstructorReturn3.default)(this,(_class.__proto__||(0,_getPrototypeOf2.default)(_class)).apply(this,arguments));_this.boundSetWrapperState=_this.setWrapperState.bind(_this);_this.state={wrapper:null};return _this}(0,_createClass3.default)(_class,[{key:"setWrapperState",value:function setWrapperState(wrapper){if(!wrapper){return}this.setState({wrapper:wrapper});this.disconnectObserver();this.observer=new MutationObserver(this.props.onResize);this.observer.observe(wrapper,{attributes:true,childList:true,subtree:true})}},{key:"componentWillUnmount",value:function componentWillUnmount(){this.disconnectObserver()}},{key:"disconnectObserver",value:function disconnectObserver(){if(this.observer){this.observer.disconnect()}}},{key:"render",value:function render(){var childProps=void 0;if(this.state.wrapper){childProps={width:this.state.wrapper.clientWidth}}return _react2.default.createElement("div",{ref:this.boundSetWrapperState},_react2.default.createElement(Component,(0,_extends3.default)({},this.props,childProps)))}}]);return _class}(_component2.default),_class.displayName="ResizableView("+componentName+")",_class.propTypes={onResize:_react.PropTypes.func},_class.defaultProps={onResize:function onResize(){}},_temp};var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _component=__webpack_require__(3550);var _component2=_interopRequireDefault(_component);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}module.exports=exports["default"]},2577:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _events=__webpack_require__(139);var _events2=_interopRequireDefault(_events);var _forEach=__webpack_require__(114);var _forEach2=_interopRequireDefault(_forEach);var _map=__webpack_require__(45);var _map2=_interopRequireDefault(_map);var _mapValues=__webpack_require__(93);var _mapValues2=_interopRequireDefault(_mapValues);var _values=__webpack_require__(210);var _values2=_interopRequireDefault(_values);var _galleryView=__webpack_require__(2574);var _galleryView2=_interopRequireDefault(_galleryView);var _embed=__webpack_require__(2582);var _embed2=_interopRequireDefault(_embed);var _contactForm=__webpack_require__(2578);var _contactForm2=_interopRequireDefault(_contactForm);var _video=__webpack_require__(2584);var VideoView=_interopRequireWildcard(_video);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var views={gallery:_galleryView2.default,embed:new _embed2.default,contactForm:_contactForm2.default,video:VideoView};var components=(0,_mapValues2.default)(views,function(view){if("function"===typeof view.getComponent){return view.getComponent()}return view});var emitters=(0,_values2.default)(views).filter(function(view){return view instanceof _events2.default});exports.default={setMarkers:function setMarkers(content){var pieces=[{content:content}],current;(0,_forEach2.default)(views,function(view,type){current=pieces.slice();pieces=[];(0,_forEach2.default)(current,function(piece){var remaining=piece.content,result;if(piece.processed){pieces.push(piece);return}while(remaining&&(result=view.match(remaining))){if(result.index){pieces.push({content:remaining.substring(0,result.index)})}pieces.push({content:'<p class="wpview-marker" data-wpview-text="'+view.serialize(result.content,result.options)+'" data-wpview-type="'+type+'">.</p>',processed:true});remaining=remaining.slice(result.index+result.content.length)}if(remaining){pieces.push({content:remaining})}})});content=(0,_map2.default)(pieces,"content").join("");return content.replace(/<p>\s*<p data-wpview-marker=/g,"<p data-wpview-marker=").replace(/<\/p>\s*<\/p>/g,"</p>")},isEditable:function isEditable(type){return!!(views[type]&&views[type].edit)},edit:function edit(type,editor,content){if(!this.isEditable(type)){return}views[type].edit(editor,content)},components:components,emitters:emitters};module.exports=exports["default"]},2578:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _shortcodeUtils=__webpack_require__(2232);var _shortcode=__webpack_require__(1719);var _shortcode2=_interopRequireDefault(_shortcode);var _previewFields=__webpack_require__(2579);var _previewFields2=_interopRequireDefault(_previewFields);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"contact-form",statics:{match:function match(content){var match=_shortcode2.default.next("contact-form",content);if(match){return{index:match.index,content:match.content,options:{shortcode:match.shortcode}}}},serialize:function serialize(content){return encodeURIComponent(content)},edit:function edit(editor,content){editor.execCommand("wpcomContactForm",content)}},render:function render(){var _deserialize=(0,_shortcodeUtils.deserialize)(this.props.content);var fields=_deserialize.fields;return _react2.default.createElement("div",{className:"wpview-content wpview-type-contact-form"},[].concat(fields).map(_previewFields2.default),_react2.default.createElement("button",{disabled:true},this.translate("Submit")))}});module.exports=exports["default"]},2579:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(field){return fieldTypes.hasOwnProperty(field.type)?fieldTypes[field.type].apply(this,arguments):null};var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _previewFieldset=__webpack_require__(2580);var _previewFieldset2=_interopRequireDefault(_previewFieldset);var _previewLegend=__webpack_require__(2581);var _previewLegend2=_interopRequireDefault(_previewLegend);var _previewRequired=__webpack_require__(2233);var _previewRequired2=_interopRequireDefault(_previewRequired);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var textField=function textField(field,index){return _react2.default.createElement(_previewFieldset2.default,{key:"contact-form-field-"+index},_react2.default.createElement(_previewLegend2.default,field),_react2.default.createElement("input",{type:"text"}))};var textarea=function textarea(field,index){return _react2.default.createElement(_previewFieldset2.default,{key:"contact-form-field-"+index},_react2.default.createElement(_previewLegend2.default,field),_react2.default.createElement("textarea",null))};var checkbox=function checkbox(field,index){return _react2.default.createElement(_previewFieldset2.default,{key:"contact-form-field-"+index},_react2.default.createElement("label",null,_react2.default.createElement("input",{type:"checkbox"}),field.label,_react2.default.createElement(_previewRequired2.default,{required:field.required})))};var select=function select(field,index){return _react2.default.createElement(_previewFieldset2.default,{key:"contact-form-field-"+index},_react2.default.createElement(_previewLegend2.default,field),_react2.default.createElement("select",null,[].concat(field.options.split(",")).map(function(option,optionIndex){return _react2.default.createElement("option",{key:"contact-form-select-option-"+optionIndex},option)})))};var radio=function radio(field,index){return _react2.default.createElement(_previewFieldset2.default,{key:"contact-form-field-"+index},_react2.default.createElement(_previewLegend2.default,field),[].concat(field.options.split(",")).map(function(option,optionIndex){return _react2.default.createElement("label",{key:"contact-form-radio-"+optionIndex},_react2.default.createElement("input",{type:"radio"}),_react2.default.createElement("span",null,option))}))};var fieldTypes={name:textField,email:textField,url:textField,text:textField,textarea:textarea,checkbox:checkbox,select:select,radio:radio};module.exports=exports["default"]},2580:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _omit=__webpack_require__(18);var _omit2=_interopRequireDefault(_omit);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"ContactFormViewPreviewFieldset",render:function render(){return _react2.default.createElement("fieldset",(0,_extends3.default)({},(0,_omit2.default)(this.props,"className"),{className:"wpview-type-contact-form-field"}),this.props.children)}});module.exports=exports["default"]},2581:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _previewRequired=__webpack_require__(2233);var _previewRequired2=_interopRequireDefault(_previewRequired);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"preview-legend",render:function render(){return _react2.default.createElement("legend",null,this.props.label,_react2.default.createElement(_previewRequired2.default,this.props))}});module.exports=exports["default"]},2582:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _typeof2=__webpack_require__(32);var _typeof3=_interopRequireDefault(_typeof2);var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _get2=__webpack_require__(234);var _get3=_interopRequireDefault(_get2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _events=__webpack_require__(139);var _events2=_interopRequireDefault(_events);var _defer=__webpack_require__(385);var _defer2=_interopRequireDefault(_defer);var _listStore=__webpack_require__(2603);var _listStore2=_interopRequireDefault(_listStore);var _store=__webpack_require__(2240);var _store2=_interopRequireDefault(_store);var _actions=__webpack_require__(2602);var _actions2=_interopRequireDefault(_actions);var _sitesList=__webpack_require__(53);var _sitesList2=_interopRequireDefault(_sitesList);var _view=__webpack_require__(2583);var _view2=_interopRequireDefault(_view);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var sites=(0,_sitesList2.default)();var EmbedViewManager=function(_EventEmitter){(0,_inherits3.default)(EmbedViewManager,_EventEmitter);function EmbedViewManager(){(0,_classCallCheck3.default)(this,EmbedViewManager);var _this=(0,_possibleConstructorReturn3.default)(this,(EmbedViewManager.__proto__||(0,_getPrototypeOf2.default)(EmbedViewManager)).call(this));_this.sitesListener=_this.updateSite.bind(_this);return _this}(0,_createClass3.default)(EmbedViewManager,[{key:"onChange",value:function onChange(){this.emit("change");this.fetchSiteEmbeds()}},{key:"updateSite",value:function updateSite(){var siteId=(sites.getSelectedSite()||{}).ID;if(!this.hasOwnProperty("siteId")){this.siteId=siteId;this.fetchSiteEmbeds()}else if(this.siteId!==siteId){this.siteId=siteId;this.onChange()}}},{key:"addListener",value:function addListener(event,listener){(0,_get3.default)(EmbedViewManager.prototype.__proto__||(0,_getPrototypeOf2.default)(EmbedViewManager.prototype),"addListener",this).call(this,event,listener);if("change"===event&&1===this.listeners(event).length){sites.addListener(event,this.sitesListener);this.embedsListListener=_listStore2.default.addListener(this.onChange.bind(this));this.embedsListener=_store2.default.addListener(this.onChange.bind(this));this.updateSite()}}},{key:"removeListener",value:function removeListener(event,listener){(0,_get3.default)(EmbedViewManager.prototype.__proto__||(0,_getPrototypeOf2.default)(EmbedViewManager.prototype),"removeListener",this).call(this,event,listener);if("change"===event&&!this.listeners(event).length){sites.removeListener(event,this.sitesListener);if(this.embedsListListener){this.embedsListListener.remove()}if(this.embedsListener){this.embedsListener.remove()}}}},{key:"fetchSiteEmbeds",value:function fetchSiteEmbeds(){if(this.siteId&&!_listStore2.default.get(this.siteId)){_actions2.default.fetch(this.siteId)}}},{key:"fetchEmbed",value:function fetchEmbed(url){if(this.siteId&&!_store2.default.get(url).status){_actions2.default.fetch(this.siteId,url)}}},{key:"match",value:function match(content){var _this2=this;if(!this.siteId){return}var list=_listStore2.default.get(this.siteId);if(!list||"LOADED"!==list.status){return}var rxLink=/(^|<p>)(https?:\/\/[^\s"]+?)(<\/p>\s*|$)/gi;var currentMatch=void 0;var _loop=function _loop(){var url=currentMatch[2];var isMatchingPattern=list.embeds.some(function(pattern){return pattern.test(url)});if(!isMatchingPattern){return"continue"}var embed=_store2.default.get(url);if(!embed.body){(0,_defer2.default)(function(){return _this2.fetchEmbed(url)});return"continue"}return{v:{index:currentMatch.index+currentMatch[1].length,content:url}}};while(currentMatch=rxLink.exec(content)){var _ret=_loop();switch(_ret){case"continue":continue;default:if((typeof _ret==="undefined"?"undefined":(0,_typeof3.default)(_ret))==="object")return _ret.v}}}},{key:"serialize",value:function serialize(content){return encodeURIComponent(content)}},{key:"getComponent",value:function getComponent(){return _view2.default}}]);return EmbedViewManager}(_events2.default);exports.default=EmbedViewManager;module.exports=exports["default"]},2583:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _reactDom=__webpack_require__(44);var _reactDom2=_interopRequireDefault(_reactDom);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _utils=__webpack_require__(1940);var _pick=__webpack_require__(91);var _pick2=_interopRequireDefault(_pick);var _resizableIframe=__webpack_require__(1966);var _resizableIframe2=_interopRequireDefault(_resizableIframe);var _store=__webpack_require__(2240);var _store2=_interopRequireDefault(_store);var _embedFrameMarkup=__webpack_require__(2239);var _embedFrameMarkup2=_interopRequireDefault(_embedFrameMarkup);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var EmbedView=function(_Component){(0,_inherits3.default)(EmbedView,_Component);function EmbedView(){(0,_classCallCheck3.default)(this,EmbedView);return(0,_possibleConstructorReturn3.default)(this,(EmbedView.__proto__||(0,_getPrototypeOf2.default)(EmbedView)).apply(this,arguments))}(0,_createClass3.default)(EmbedView,[{key:"componentDidMount",value:function componentDidMount(){this.setState({wrapper:this.refs.view},this.setHtml)}},{key:"componentDidUpdate",value:function componentDidUpdate(prevProps,prevState){if(this.state.body!==prevState.body){this.setHtml()}this.constrainEmbedDimensions()}},{key:"constrainEmbedDimensions",value:function constrainEmbedDimensions(){if(!this.refs.iframe){return}var view=_reactDom2.default.findDOMNode(this.refs.view);var iframe=_reactDom2.default.findDOMNode(this.refs.iframe);if(!iframe.contentDocument){return}var embed=iframe.contentDocument.querySelector("iframe");if(!embed||!embed.width){return}var width=parseInt(embed.width,10);if(width<=view.clientWidth){return}embed.style.width=view.clientWidth+"px";if(embed.height){var proportion=parseInt(embed.height,10)/width;embed.style.height=Math.round(view.clientWidth*proportion)+"px"}}},{key:"setHtml",value:function setHtml(){if(!this.state.body||!this.refs.iframe){return}var iframe=_reactDom2.default.findDOMNode(this.refs.iframe);if(!iframe.contentDocument){return}var markup=(0,_embedFrameMarkup2.default)((0,_pick2.default)(this.state,"body","scripts","styles"));iframe.contentDocument.open();iframe.contentDocument.write(markup);iframe.contentDocument.body.style.width="100%";iframe.contentDocument.body.style.overflow="hidden";iframe.contentDocument.close()}},{key:"renderFrame",value:function renderFrame(){if(!this.state.wrapper){return}return _react2.default.createElement(_resizableIframe2.default,{ref:"iframe",onResize:this.props.onResize,frameBorder:"0",seamless:true,width:"100%"})}},{key:"render",value:function render(){return _react2.default.createElement("div",{ref:"view",className:"wpview-content wpview-type-embed"},this.renderFrame())}}],[{key:"getStores",value:function getStores(){return[_store2.default]}},{key:"calculateState",value:function calculateState(state,props){return _store2.default.get(props.content)}}]);return EmbedView}(_react.Component);EmbedView.propTypes={siteId:_react.PropTypes.number,content:_react.PropTypes.string,onResize:_react.PropTypes.func};EmbedView.defaultProps={onResize:function onResize(){}};var EmbedViewContainer=_utils.Container.create(EmbedView,{withProps:true});exports.default=EmbedViewContainer;module.exports=exports["default"]},2584:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.match=match;exports.serialize=serialize;exports.getComponent=getComponent;var _shortcode=__webpack_require__(1719);var _shortcode2=_interopRequireDefault(_shortcode);var _view=__webpack_require__(2585);var _view2=_interopRequireDefault(_view);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function match(content){var nextMatch=_shortcode2.default.next("wpvideo",content);if(nextMatch){return{index:nextMatch.index,content:nextMatch.content,options:{shortcode:nextMatch.shortcode}}}}function serialize(content){return encodeURIComponent(content)}function getComponent(){return _view2.default}},2585:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _merge2=__webpack_require__(58);var _merge3=_interopRequireDefault(_merge2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactRedux=__webpack_require__(15);var _resizableView=__webpack_require__(2576);var _resizableView2=_interopRequireDefault(_resizableView);var _selectors=__webpack_require__(47);var _shortcode=__webpack_require__(1719);var _shortcode2=__webpack_require__(2229);var _shortcode3=_interopRequireDefault(_shortcode2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function VideoView(_ref){var siteId=_ref.siteId;var content=_ref.content;var width=_ref.width;if(!siteId||!width){return null}var shortcode=(0,_shortcode.stringify)((0,_merge3.default)({attrs:{named:{w:width}}},(0,_shortcode.parse)(content)));return _react2.default.createElement(_shortcode3.default,{siteId:siteId,width:width},shortcode)}VideoView.propTypes={siteId:_react.PropTypes.number,content:_react.PropTypes.string,width:_react.PropTypes.number};exports.default=(0,_reactRedux.connect)(function(state){return{siteId:(0,_selectors.getSelectedSiteId)(state)}})((0,_resizableView2.default)(VideoView));module.exports=exports["default"]},2586:function(module,exports,__webpack_require__){"use strict";var tinymce=__webpack_require__(1675);var translate=__webpack_require__(11).translate;var formatting=__webpack_require__(81);function wpcomPlugin(editor){var DOM=tinymce.DOM,each=tinymce.each,style;editor.on("focus",function(){window.wpActiveEditor=editor.id});editor.on("BeforeSetContent",function(event){var title;if(event.content){if(event.content.indexOf("<!--more")!==-1){title=translate("Read more");event.content=event.content.replace(/<!--more(.*?)-->/g,function(match,moretext){return'<img src="'+tinymce.Env.transparentSrc+'" data-wp-more="more" data-wp-more-text="'+moretext+'" '+'class="wp-more-tag mce-wp-more" title="'+title+'" data-mce-resize="false" data-mce-placeholder="1" />'})}if(event.content.indexOf("<!--nextpage-->")!==-1){title=translate("Page break");event.content=event.content.replace(/<!--nextpage-->/g,'<img src="'+tinymce.Env.transparentSrc+'" data-wp-more="nextpage" class="wp-more-tag mce-wp-nextpage" '+'title="'+title+'" data-mce-resize="false" data-mce-placeholder="1" />')}if(event.load&&event.format!=="raw"){event.content=formatting.wpautop(event.content)}}});editor.on("PostProcess",function(e){if(e.get){e.content=e.content.replace(/<img[^>]+>/g,function(image){var match,moretext="";if(image.indexOf('data-wp-more="more"')!==-1){if(match=image.match(/data-wp-more-text="([^"]+)"/)){moretext=match[1]}image="<!--more"+moretext+"-->"}else if(image.indexOf('data-wp-more="nextpage"')!==-1){image="<!--nextpage-->"}return image})}});editor.on("ResolveName",function(event){var attr;if(event.target.nodeName==="IMG"&&(attr=editor.dom.getAttrib(event.target,"data-wp-more"))){event.name=attr}});editor.addCommand("WP_More",function(tag){var parent,html,title,classname="wp-more-tag",dom=editor.dom,node=editor.selection.getNode();tag=tag||"more";classname+=" mce-wp-"+tag;title=tag==="more"?translate("Read more"):translate("Next page");html='<img src="'+tinymce.Env.transparentSrc+'" title="'+title+'" class="'+classname+'" '+'data-wp-more="'+tag+'" data-mce-resize="false" data-mce-placeholder="1" />';if(node.nodeName==="BODY"||node.nodeName==="P"&&node.parentNode.nodeName==="BODY"){editor.insertContent(html);return}parent=dom.getParent(node,function(found){if(found.parentNode&&found.parentNode.nodeName==="BODY"){return true}return false},editor.getBody());if(parent){if(parent.nodeName==="P"){parent.appendChild(dom.create("p",null,html).firstChild)}else{dom.insertAfter(dom.create("p",null,html),parent)}editor.nodeChanged()}});editor.addCommand("WP_Code",function(){editor.formatter.toggle("code")});editor.addCommand("WP_Page",function(){editor.execCommand("WP_More","nextpage")});editor.addButton("wp_more",{tooltip:translate("Insert Read More tag"),onclick:function onclick(){editor.execCommand("WP_More","more")}});editor.addButton("wp_page",{tooltip:translate("Page break"),onclick:function onclick(){editor.execCommand("WP_More","nextpage")}});editor.addButton("wp_help",{tooltip:translate("Keyboard Shortcuts"),cmd:"WP_Help"});editor.addButton("wp_charmap",{icon:"charmap",tooltip:translate("Special Characters"),cmd:"Wpcom_CharMap"});editor.addButton("wp_code",{tooltip:translate("Code"),cmd:"WP_Code",stateSelector:"code"});editor.addMenuItem("wp_more",{text:translate("Insert Read More tag"),icon:"wp_more",context:"insert",onclick:function onclick(){editor.execCommand("WP_More","more")}});editor.addMenuItem("wp_page",{text:translate("Page break"),icon:"wp_page",context:"insert",onclick:function onclick(){editor.execCommand("WP_More","nextpage")}});editor.on("BeforeExecCommand",function(e){if(tinymce.Env.webkit&&(e.command==="InsertUnorderedList"||e.command==="InsertOrderedList")){if(!style){style=editor.dom.create("style",{type:"text/css"},"#tinymce,#tinymce span,#tinymce li,#tinymce li>span,#tinymce p,#tinymce p>span{font:medium sans-serif;color:#000;line-height:normal;}")}editor.getDoc().head.appendChild(style)}});editor.on("ExecCommand",function(e){if(tinymce.Env.webkit&&style&&("InsertUnorderedList"===e.command||"InsertOrderedList"===e.command)){editor.dom.remove(style)}});editor.on("init",function(){var env=tinymce.Env,bodyClass=["mceContentBody"],doc=editor.getDoc(),dom=editor.dom;if(tinymce.Env.iOS){dom.addClass(doc.documentElement,"ios")}if(editor.getParam("directionality")==="rtl"){bodyClass.push("rtl");dom.setAttrib(doc.documentElement,"dir","rtl")}if(env.ie){if(parseInt(env.ie,10)===9){bodyClass.push("ie9")}else if(parseInt(env.ie,10)===8){bodyClass.push("ie8")}else if(env.ie<8){bodyClass.push("ie7")}}else if(env.webkit){bodyClass.push("webkit")}bodyClass.push("wp-editor");each(bodyClass,function(cls){if(cls){dom.addClass(doc.body,cls)}});editor.on("BeforeSetContent",function(event){if(event.content){event.content=event.content.replace(/<p>\s*<(p|div|ul|ol|dl|table|blockquote|h[1-6]|fieldset|pre)( [^>]*)?>/gi,"<$1$2>").replace(/<\/(p|div|ul|ol|dl|table|blockquote|h[1-6]|fieldset|pre)>\s*<\/p>/gi,"</$1>")}});if(editor.getParam("wp_paste_filters",true)){editor.on("PastePreProcess",function(event){event.content=event.content.replace(/<br class="?Apple-interchange-newline"?>/gi,"");if(!tinymce.Env.webkit){event.content=event.content.replace(/(<[^>]+) style="[^"]*"([^>]*>)/gi,"$1$2");event.content=event.content.replace(/(<[^>]+) data-mce-style=([^>]+>)/gi,"$1 style=$2")}});editor.on("PastePostProcess",function(event){each(dom.select("p",event.node),function(node){if(dom.isEmpty(node)){dom.remove(node)}})})}});editor.on("SaveContent",function(e){if(!editor.inline&&editor.isHidden()){e.content=e.element.value;return}e.content=e.content.replace(/<p>(?:<br ?\/?>|\u00a0|\uFEFF| )*<\/p>/g,"<p>&nbsp;</p>");e.content=formatting.removep(e.content)});editor.on("BeforeSetContent",function(event){var paragraph=tinymce.Env.webkit?"<p><br /></p>":"<p></p>";if(event.content){event.content=event.content.replace(/<p>(?:&nbsp;|\u00a0|\uFEFF|\s)+<\/p>/gi,paragraph)}});editor.on("preInit",function(){editor.schema.addValidElements("@[id|accesskey|class|dir|lang|style|tabindex|title|contenteditable|draggable|dropzone|hidden|spellcheck|translate],i,b");if(tinymce.Env.iOS){editor.settings.height=300}each({c:"JustifyCenter",r:"JustifyRight",l:"JustifyLeft",j:"JustifyFull",q:"mceBlockQuote",u:"InsertUnorderedList",o:"InsertOrderedList",s:"unlink",m:"WP_Medialib",t:"WP_More",d:"Strikethrough",h:"WP_Help",p:"WP_Page",x:"WP_Code"},function(command,key){editor.shortcuts.add("access+"+key,"",command)})});editor.on("preinit",function(){var Factory=tinymce.ui.Factory,settings=editor.settings,activeToolbar,currentSelection,timeout,container=editor.getContainer(),wpAdminbar=document.getElementById("wpadminbar"),mceIframe=document.getElementById(editor.id+"_ifr"),mceToolbar,mceStatusbar,wpStatusbar;if(container){mceToolbar=tinymce.$(".mce-toolbar-grp",container)[0];mceStatusbar=tinymce.$(".mce-statusbar",container)[0]}if(editor.id==="content"){wpStatusbar=document.getElementById("post-status-info");
}function create(buttons,bottom){var toolbar,toolbarItems=[],buttonGroup;each(buttons,function(item){var itemName;function bindSelectorChanged(){var selection=editor.selection;if(itemName==="bullist"){selection.selectorChanged("ul > li",function(state,args){var i=args.parents.length,nodeName;while(i--){nodeName=args.parents[i].nodeName;if(nodeName==="OL"||nodeName==="UL"){break}}item.active(state&&nodeName==="UL")})}if(itemName==="numlist"){selection.selectorChanged("ol > li",function(state,args){var i=args.parents.length,nodeName;while(i--){nodeName=args.parents[i].nodeName;if(nodeName==="OL"||nodeName==="UL"){break}}item.active(state&&nodeName==="OL")})}if(item.settings.stateSelector){selection.selectorChanged(item.settings.stateSelector,function(state){item.active(state)},true)}if(item.settings.disabledStateSelector){selection.selectorChanged(item.settings.disabledStateSelector,function(state){item.disabled(state)})}}if(item==="|"){buttonGroup=null}else{if(Factory.has(item)){item={type:item};if(settings.toolbar_items_size){item.size=settings.toolbar_items_size}toolbarItems.push(item);buttonGroup=null}else{if(!buttonGroup){buttonGroup={type:"buttongroup",items:[]};toolbarItems.push(buttonGroup)}if(editor.buttons[item]){itemName=item;item=editor.buttons[itemName];if(typeof item==="function"){item=item()}item.type=item.type||"button";if(settings.toolbar_items_size){item.size=settings.toolbar_items_size}item=Factory.create(item);buttonGroup.items.push(item);if(editor.initialized){bindSelectorChanged()}else{editor.on("init",bindSelectorChanged)}}}}});toolbar=Factory.create({type:"panel",layout:"stack",classes:"toolbar-grp inline-toolbar-grp",ariaRoot:true,ariaRemember:true,items:[{type:"toolbar",layout:"flow",items:toolbarItems}]});toolbar.bottom=bottom;function reposition(){if(!currentSelection){return this}var scrollX=window.pageXOffset||document.documentElement.scrollLeft,scrollY=window.pageYOffset||document.documentElement.scrollTop,windowWidth=window.innerWidth,windowHeight=window.innerHeight,iframeRect=mceIframe?mceIframe.getBoundingClientRect():{top:0,right:windowWidth,bottom:windowHeight,left:0,width:windowWidth,height:windowHeight},toolbar=this.getEl(),toolbarWidth=toolbar.offsetWidth,toolbarHeight=toolbar.offsetHeight,selection=currentSelection.getBoundingClientRect(),selectionMiddle=(selection.left+selection.right)/2,buffer=5,margin=8,spaceNeeded=toolbarHeight+margin+buffer,wpAdminbarBottom=wpAdminbar?wpAdminbar.getBoundingClientRect().bottom:0,mceToolbarBottom=mceToolbar?mceToolbar.getBoundingClientRect().bottom:0,mceStatusbarTop=mceStatusbar?windowHeight-mceStatusbar.getBoundingClientRect().top:0,wpStatusbarTop=wpStatusbar?windowHeight-wpStatusbar.getBoundingClientRect().top:0,blockedTop=Math.max(0,wpAdminbarBottom,mceToolbarBottom,iframeRect.top),blockedBottom=Math.max(0,mceStatusbarTop,wpStatusbarTop,windowHeight-iframeRect.bottom),spaceTop=selection.top+iframeRect.top-blockedTop,spaceBottom=windowHeight-iframeRect.top-selection.bottom-blockedBottom,editorHeight=windowHeight-blockedTop-blockedBottom,className="",top,left;if(spaceTop>=editorHeight||spaceBottom>=editorHeight){return this.hide()}if(this.bottom){if(spaceBottom>=spaceNeeded){className=" mce-arrow-up";top=selection.bottom+iframeRect.top+scrollY}else if(spaceTop>=spaceNeeded){className=" mce-arrow-down";top=selection.top+iframeRect.top+scrollY-toolbarHeight-margin}}else{if(spaceTop>=spaceNeeded){className=" mce-arrow-down";top=selection.top+iframeRect.top+scrollY-toolbarHeight-margin}else if(spaceBottom>=spaceNeeded&&editorHeight/2>selection.bottom+iframeRect.top-blockedTop){className=" mce-arrow-up";top=selection.bottom+iframeRect.top+scrollY}}if(typeof top==="undefined"){top=scrollY+blockedTop+buffer}left=selectionMiddle-toolbarWidth/2+iframeRect.left+scrollX;if(selection.left<0||selection.right>iframeRect.width){left=iframeRect.left+scrollX+(iframeRect.width-toolbarWidth)/2}else if(toolbarWidth>=windowWidth){className+=" mce-arrow-full";left=0}else if(left<0&&selection.left+toolbarWidth>windowWidth||left+toolbarWidth>windowWidth&&selection.right-toolbarWidth<0){left=(windowWidth-toolbarWidth)/2}else if(left<iframeRect.left+scrollX){className+=" mce-arrow-left";left=selection.left+iframeRect.left+scrollX}else if(left+toolbarWidth>iframeRect.width+iframeRect.left+scrollX){className+=" mce-arrow-right";left=selection.right-toolbarWidth+iframeRect.left+scrollX}toolbar.className=toolbar.className.replace(/ ?mce-arrow-[\w]+/g,"")+className;DOM.setStyles(toolbar,{left:left,top:top});return this}toolbar.on("show",function(){this.reposition()});toolbar.on("keydown",function(event){if(event.keyCode===27){this.hide();editor.focus()}});editor.on("remove",function(){toolbar.remove()});toolbar.reposition=reposition;toolbar.hide().renderTo(document.body);return toolbar}editor.shortcuts.add("alt+119","",function(){var node;if(activeToolbar){node=activeToolbar.find("toolbar")[0];node&&node.focus(true)}});editor.on("nodechange",function(event){var collapsed=editor.selection.isCollapsed();var args={element:event.element,parents:event.parents,collapsed:collapsed};editor.fire("wptoolbar",args);currentSelection=args.selection||args.element;if(activeToolbar){activeToolbar.hide()}if(args.toolbar){activeToolbar=args.toolbar;activeToolbar.show()}else{activeToolbar=false}});editor.on("focus",function(){if(activeToolbar){activeToolbar.show()}});function hide(event){if(activeToolbar){activeToolbar.hide();if(event.type==="hide"||event.type==="blur"){activeToolbar=false}else if(event.type==="resizewindow"||event.type==="scrollwindow"){clearTimeout(timeout);timeout=setTimeout(function(){if(activeToolbar&&typeof activeToolbar.show==="function"){activeToolbar.show()}},250)}}}DOM.bind(window,"resize scroll",hide);editor.on("remove",function(){DOM.unbind(window,"resize scroll",hide)});editor.on("blur hide",hide);editor.wp=editor.wp||{};editor.wp._createToolbar=create},true)}module.exports=function(){tinymce.PluginManager.add("wpcom",wpcomPlugin)}},2587:function(module,exports,__webpack_require__){"use strict";var tinymce=__webpack_require__(1675);function wpEditImage(editor){var toolbar,serializer,each=tinymce.each,iOS=tinymce.Env.iOS;function isPlaceholder(node){return!!(editor.dom.getAttrib(node,"data-mce-placeholder")||editor.dom.getAttrib(node,"data-mce-object"))}editor.addButton("wp_img_remove",{tooltip:"Remove",icon:"dashicon dashicons-no",onclick:function onclick(){removeImage(editor.selection.getNode())}});each({alignleft:"Align left",aligncenter:"Align center",alignright:"Align right",alignnone:"No alignment"},function(tooltip,name){var direction=name.slice(5);editor.addButton("wp_img_"+name,{tooltip:tooltip,icon:"dashicon dashicons-align-"+direction,cmd:"alignnone"===name?"wpAlignNone":"Justify"+direction.slice(0,1).toUpperCase()+direction.slice(1),onPostRender:function onPostRender(){var self=this;editor.on("NodeChange",function(event){var node;if(event.element.nodeName!=="IMG"){return}node=editor.dom.getParent(event.element,".wp-caption")||event.element;if("alignnone"===name){self.active(!/\balign(left|center|right)\b/.test(node.className))}else{self.active(editor.dom.hasClass(node,name))}})}})});editor.once("preinit",function(){toolbar=editor.wp._createToolbar(["wp_img_alignleft","wp_img_aligncenter","wp_img_alignright","wp_img_alignnone","wpcom_img_size_decrease","wpcom_img_size_increase","wp_img_caption","wp_img_advanced","wp_img_remove"])});editor.on("wptoolbar",function(event){if(event.element.nodeName==="IMG"&&!isPlaceholder(event.element)){event.toolbar=toolbar}});if(iOS){editor.on("click",function(event){if(event.target.nodeName==="IMG"){var node=event.target;window.setTimeout(function(){editor.selection.select(node);editor.nodeChanged()},200)}else{toolbar.hide()}})}function parseShortcode(content){return content.replace(/(?:<p>)?\[(?:wp_)?caption([^\]]+)\]([\s\S]+?)\[\/(?:wp_)?caption\](?:<\/p>)?/g,function(a,b,c){var id,align,classes,caption,img,width,trim=tinymce.trim;id=b.match(/id=['"]([^'"]*)['"] ?/);if(id){b=b.replace(id[0],"")}align=b.match(/align=['"]([^'"]*)['"] ?/);if(align){b=b.replace(align[0],"")}classes=b.match(/class=['"]([^'"]*)['"] ?/);if(classes){b=b.replace(classes[0],"")}width=b.match(/width=['"]([0-9]*)['"] ?/);if(width){b=b.replace(width[0],"")}c=trim(c);img=c.match(/((?:<a [^>]+>)?<img [^>]+>(?:<\/a>)?)([\s\S]*)/i);if(img&&img[2]){caption=trim(img[2]);img=trim(img[1])}else{caption=trim(b).replace(/caption=['"]/,"").replace(/['"]$/,"");img=c}id=id&&id[1]?id[1].replace(/[<>&]+/g,""):"";align=align&&align[1]?align[1]:"alignnone";classes=classes&&classes[1]?" "+classes[1].replace(/[<>&]+/g,""):"";if(!width&&img){width=img.match(/width=['"]([0-9]*)['"]/)}if(width&&width[1]){width=width[1]}if(!width||!caption){return c}width=parseInt(width,10);if(!editor.getParam("wpeditimage_html5_captions")){width+=10}return'<div class="mceTemp"><dl id="'+id+'" class="wp-caption '+align+classes+'" style="width: '+width+'px">'+'<dt class="wp-caption-dt">'+img+'</dt><dd class="wp-caption-dd">'+caption+"</dd></dl></div>"})}function getShortcode(content){return content.replace(/<div (?:id="attachment_|class="mceTemp)[^>]*>([\s\S]+?)<\/div>/g,function(a,b){var out="";if(b.indexOf("<img ")===-1){out=b.match(/<dd [^>]+>([\s\S]+?)<\/dd>/i);if(out&&out[1]){return"<p>"+out[1]+"</p>"}return""}out=b.replace(/\s*<dl ([^>]+)>\s*<dt [^>]+>([\s\S]+?)<\/dt>\s*<dd [^>]+>([\s\S]*?)<\/dd>\s*<\/dl>\s*/gi,function(a,b,c,caption){var id,classes,align,width;width=c.match(/width="([0-9]*)"/);width=width&&width[1]?width[1]:"";classes=b.match(/class="([^"]*)"/);classes=classes&&classes[1]?classes[1]:"";align=classes.match(/align[a-z]+/i)||"alignnone";if(!width||!caption){if("alignnone"!==align[0]){c=c.replace(/><img/,' class="'+align[0]+'"><img')}return c}id=b.match(/id="([^"]*)"/);id=id&&id[1]?id[1]:"";classes=classes.replace(/wp-caption ?|align[a-z]+ ?/gi,"");if(classes){classes=' class="'+classes+'"'}caption=caption.replace(/\r\n|\r/g,"\n").replace(/<[a-zA-Z0-9]+( [^<>]+)?>/g,function(a){return a.replace(/[\r\n\t]+/," ")});caption=caption.replace(/\s*\n\s*/g,"<br />");return'[caption id="'+id+'" align="'+align+'" width="'+width+'"'+classes+"]"+c+" "+caption+"[/caption]"});if(out.indexOf("[caption")===-1){out=b.replace(/[\s\S]*?((?:<a [^>]+>)?<img [^>]+>(?:<\/a>)?)(<p>[\s\S]*<\/p>)?[\s\S]*/gi,"<p>$1</p>$2")}return out})}function verifyHTML(caption){if(!caption||caption.indexOf("<")===-1&&caption.indexOf(">")===-1){return caption}if(!serializer){serializer=new tinymce.html.Serializer({},editor.schema)}return serializer.serialize(editor.parser.parse(caption,{forced_root_block:false}))}function removeImage(node){var wrap;if(node.nodeName==="DIV"&&editor.dom.hasClass(node,"mceTemp")){wrap=node}else if(node.nodeName==="IMG"||node.nodeName==="DT"||node.nodeName==="A"){wrap=editor.dom.getParent(node,"div.mceTemp")}if(wrap){if(wrap.nextSibling){editor.selection.select(wrap.nextSibling)}else if(wrap.previousSibling){editor.selection.select(wrap.previousSibling)}else{editor.selection.select(wrap.parentNode)}editor.selection.collapse(true);editor.dom.remove(wrap)}else{editor.dom.remove(node)}editor.nodeChanged();editor.undoManager.add()}editor.on("init",function(){var dom=editor.dom,captionClass=editor.getParam("wpeditimage_html5_captions")?"html5-captions":"html4-captions";dom.addClass(editor.getBody(),captionClass);editor.on("wpLoadImageForm",function(event){if(editor.getParam("wpeditimage_disable_captions")){return}var captionField={type:"textbox",flex:1,name:"caption",minHeight:60,multiline:true,scroll:true,label:"Image caption"};event.data.splice(event.data.length-1,0,captionField)});editor.on("wpNewImageRefresh",function(event){var parent,captionWidth;if(parent=dom.getParent(event.node,"dl.wp-caption")){if(!parent.style.width){captionWidth=parseInt(event.node.clientWidth,10)+10;captionWidth=captionWidth?captionWidth+"px":"50%";dom.setStyle(parent,"width",captionWidth)}}});editor.on("wpImageFormSubmit",function(event){var data=event.imgData.data,imgNode=event.imgData.node,caption=event.imgData.caption,captionId="",captionAlign="",captionWidth="",wrap,parent,node,html,imgId;data.id="__wp-temp-img-id";event.imgData.cancel=true;if(!data.style){data.style=null}if(!data.src){if(imgNode){if(wrap=dom.getParent(imgNode,"div.mceTemp")){dom.remove(wrap)}else if(imgNode.parentNode.nodeName==="A"){dom.remove(imgNode.parentNode)}else{dom.remove(imgNode)}editor.nodeChanged()}return}if(caption){caption=caption.replace(/\r\n|\r/g,"\n").replace(/<\/?[a-zA-Z0-9]+( [^<>]+)?>/g,function(a){return a.replace(/[\r\n\t]+/," ")});caption=caption.replace(/(<br[^>]*>)\s*\n\s*/g,"$1").replace(/\s*\n\s*/g,"<br />");caption=verifyHTML(caption)}if(!imgNode){html=dom.createHTML("img",data);if(caption){node=editor.selection.getNode();if(data.width){captionWidth=parseInt(data.width,10);if(!editor.getParam("wpeditimage_html5_captions")){captionWidth+=10}captionWidth=' style="width: '+captionWidth+'px"'}html='<dl class="wp-caption alignnone"'+captionWidth+">"+'<dt class="wp-caption-dt">'+html+'</dt><dd class="wp-caption-dd">'+caption+"</dd></dl>";if(node.nodeName==="P"){parent=node}else{parent=dom.getParent(node,"p")}if(parent&&parent.nodeName==="P"){wrap=dom.create("div",{class:"mceTemp"},html);parent.parentNode.insertBefore(wrap,parent);editor.selection.select(wrap);editor.nodeChanged();if(dom.isEmpty(parent)){dom.remove(parent)}}else{editor.selection.setContent('<div class="mceTemp">'+html+"</div>")}}else{editor.selection.setContent(html)}}else{imgId=imgNode.id||null;dom.setAttribs(imgNode,data);wrap=dom.getParent(imgNode,"dl.wp-caption");if(caption){if(wrap){if(parent=dom.select("dd.wp-caption-dd",wrap)[0]){parent.innerHTML=caption}}else{if(imgNode.className){captionId=imgNode.className.match(/wp-image-([0-9]+)/);captionAlign=imgNode.className.match(/align(left|right|center|none)/)}if(captionAlign){captionAlign=captionAlign[0];imgNode.className=imgNode.className.replace(/align(left|right|center|none)/g,"")}else{captionAlign="alignnone"}captionAlign=' class="wp-caption '+captionAlign+'"';if(captionId){captionId=' id="attachment_'+captionId[1]+'"'}captionWidth=data.width||imgNode.clientWidth;if(captionWidth){captionWidth=parseInt(captionWidth,10);if(!editor.getParam("wpeditimage_html5_captions")){captionWidth+=10}captionWidth=' style="width: '+captionWidth+'px"'}if(imgNode.parentNode&&imgNode.parentNode.nodeName==="A"){node=imgNode.parentNode}else{node=imgNode}html="<dl "+captionId+captionAlign+captionWidth+">"+'<dt class="wp-caption-dt"></dt><dd class="wp-caption-dd">'+caption+"</dd></dl>";wrap=dom.create("div",{class:"mceTemp"},html);if(parent=dom.getParent(node,"p")){parent.parentNode.insertBefore(wrap,parent)}else{node.parentNode.insertBefore(wrap,node)}editor.$(wrap).find("dt.wp-caption-dt").append(node);if(parent&&dom.isEmpty(parent)){dom.remove(parent)}}}else{if(wrap){if(imgNode.parentNode.nodeName==="A"){html=dom.getOuterHTML(imgNode.parentNode)}else{html=dom.getOuterHTML(imgNode)}parent=dom.create("p",{},html);dom.insertAfter(parent,wrap.parentNode);editor.selection.select(parent);editor.nodeChanged();dom.remove(wrap.parentNode)}}}imgNode=dom.get("__wp-temp-img-id");dom.setAttrib(imgNode,"id",imgId);event.imgData.node=imgNode});editor.on("wpLoadImageData",function(event){var parent,data=event.imgData.data,imgNode=event.imgData.node;if(parent=dom.getParent(imgNode,"dl.wp-caption")){parent=dom.select("dd.wp-caption-dd",parent)[0];if(parent){data.caption=editor.serializer.serialize(parent).replace(/<br[^>]*>/g,"$&\n").replace(/^<p>/,"").replace(/<\/p>$/,"")}}});dom.bind(editor.getDoc(),"dragstart",function(event){var node=editor.selection.getNode();if(node.nodeName==="IMG"&&dom.getParent(node,".wp-caption")){event.preventDefault()}});if(tinymce.Env.ie&&tinymce.Env.ie>10){dom.bind(editor.getBody(),"mscontrolselect",function(event){if(event.target.nodeName==="IMG"&&dom.getParent(event.target,".wp-caption")){editor.getBody().focus()}else if(event.target.nodeName==="DL"&&dom.hasClass(event.target,"wp-caption")){event.target.focus()}})}});editor.on("ObjectResized",function(event){var node=event.target;if(node.nodeName==="IMG"){editor.undoManager.transact(function(){var parent,width,dom=editor.dom;node.className=node.className.replace(/\bsize-[^ ]+/,"");if(parent=dom.getParent(node,".wp-caption")){width=event.width||dom.getAttrib(node,"width");if(width){width=parseInt(width,10);if(!editor.getParam("wpeditimage_html5_captions")){width+=10}dom.setStyle(parent,"width",width+"px")}}})}});editor.on("BeforeExecCommand",function(event){var node,p,DL,align,replacement,cmd=event.command,dom=editor.dom;if(cmd==="mceInsertContent"){if(node=dom.getParent(editor.selection.getNode(),"div.mceTemp")){p=dom.create("p");dom.insertAfter(p,node);editor.selection.setCursorLocation(p,0);editor.nodeChanged()}}else if(cmd==="JustifyLeft"||cmd==="JustifyRight"||cmd==="JustifyCenter"||cmd==="wpAlignNone"){node=editor.selection.getNode();align="align"+cmd.slice(7).toLowerCase();DL=editor.dom.getParent(node,".wp-caption");if(node.nodeName!=="IMG"&&!DL){return}node=DL||node;if(editor.dom.hasClass(node,align)){replacement=" alignnone"}else{replacement=" "+align}node.className=node.className.replace(/ ?align(left|center|right|none)/g,"")+replacement;editor.nodeChanged();event.preventDefault();if(toolbar){toolbar.reposition()}editor.fire("ExecCommand",{command:cmd,ui:event.ui,value:event.value})}});editor.on("keydown",function(event){var node,wrap,P,spacer,selection=editor.selection,keyCode=event.keyCode,dom=editor.dom,VK=tinymce.util.VK;if(keyCode===VK.ENTER){node=selection.getNode();wrap=dom.getParent(node,"div.mceTemp");if(wrap){dom.events.cancel(event);tinymce.each(dom.select("dt, dd",wrap),function(element){if(dom.isEmpty(element)){dom.remove(element)}});spacer=tinymce.Env.ie&&tinymce.Env.ie<11?"":'<br data-mce-bogus="1" />';P=dom.create("p",null,spacer);if(node.nodeName==="DD"){dom.insertAfter(P,wrap)}else{wrap.parentNode.insertBefore(P,wrap)}editor.nodeChanged();selection.setCursorLocation(P,0)}}else if(keyCode===VK.DELETE||keyCode===VK.BACKSPACE){node=selection.getNode();if(node.nodeName==="DIV"&&dom.hasClass(node,"mceTemp")){wrap=node}else if(node.nodeName==="IMG"||node.nodeName==="DT"||node.nodeName==="A"){wrap=dom.getParent(node,"div.mceTemp")}if(wrap){dom.events.cancel(event);removeImage(node);return false}}});if(tinymce.Env.gecko){editor.on("undo redo",function(){if(editor.selection.getNode().nodeName==="IMG"){editor.selection.collapse()}})}editor.wpSetImgCaption=function(content){return parseShortcode(content)};editor.wpGetImgCaption=function(content){return getShortcode(content)};editor.on("BeforeSetContent",function(event){if(event.format!=="raw"){event.content=editor.wpSetImgCaption(event.content)}});editor.on("PostProcess",function(event){if(event.get){event.content=editor.wpGetImgCaption(event.content)}});editor.wp=editor.wp||{};editor.wp.isPlaceholder=isPlaceholder}module.exports=function(){tinymce.PluginManager.add("wpeditimage",wpEditImage)}},2588:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _assign=__webpack_require__(5);var _assign2=_interopRequireDefault(_assign);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _tinymce=__webpack_require__(1675);var _tinymce2=_interopRequireDefault(_tinymce);var _reactRedux=__webpack_require__(15);var _find=__webpack_require__(27);var _find2=_interopRequireDefault(_find);var _mediaSerialization=__webpack_require__(1814);var MediaSerialization=_interopRequireWildcard(_mediaSerialization);var _store=__webpack_require__(1717);var _store2=_interopRequireDefault(_store);var _utils=__webpack_require__(1647);var _utils2=_interopRequireDefault(_utils);var _dialog=__webpack_require__(168);var _dialog2=_interopRequireDefault(_dialog);var _formTextInput=__webpack_require__(206);var _formTextInput2=_interopRequireDefault(_formTextInput);var _formCheckbox=__webpack_require__(1654);var _formCheckbox2=_interopRequireDefault(_formCheckbox);var _formButton=__webpack_require__(379);var _formButton2=_interopRequireDefault(_formButton);var _formFieldset=__webpack_require__(275);var _formFieldset2=_interopRequireDefault(_formFieldset);var _formLabel=__webpack_require__(380);var _formLabel2=_interopRequireDefault(_formLabel);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _postSelector=__webpack_require__(2313);var _postSelector2=_interopRequireDefault(_postSelector);var _selectors=__webpack_require__(47);var _selectors2=__webpack_require__(112);var _formatting=__webpack_require__(81);var _stats=__webpack_require__(1651);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var REGEXP_EMAIL=/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i,REGEXP_URL=/^(https?|ftp):\/\/[A-Z0-9.-]+\.[A-Z]{2,4}[^ "]*$/i,REGEXP_STANDALONE_URL=/^(?:[a-z]+:|#|\?|\.|\/)/;var LinkDialog=_react2.default.createClass({displayName:"LinkDialog",propTypes:{visible:_react.PropTypes.bool,editor:_react.PropTypes.object,onClose:_react.PropTypes.func,site:_react.PropTypes.object,sitePosts:_react.PropTypes.array},getInitialState:function getInitialState(){return this.getState()},getDefaultProps:function getDefaultProps(){return{onClose:function onClose(){}}},componentWillReceiveProps:function componentWillReceiveProps(nextProps){if(nextProps.visible&&!this.props.visible){this.setState(this.getState())}},getLink:function getLink(){var editor=this.props.editor;return editor.dom.getParent(editor.selection.getNode(),"a")},getCorrectedUrl:function getCorrectedUrl(){var url=this.state.url.trim();if(REGEXP_EMAIL.test(url)){return"mailto:"+url}if(!REGEXP_STANDALONE_URL.test(url)){return"http://"+url}return url},updateEditor:function updateEditor(){var editor=this.props.editor,attrs,link,linkText;editor.focus();if(_tinymce2.default.isIE){editor.selection.moveToBookmark(editor.windowManager.bookmark)}if(!this.state.url){this.removeLink();return}link=this.getLink();linkText=this.state.linkText;attrs={href:this.getCorrectedUrl(),target:this.state.newWindow?"_blank":""};if(link){if(linkText){if("innerText"in link){link.innerText=linkText}else{link.textContent=linkText}}editor.dom.setAttribs(link,attrs)}else if(linkText){linkText=editor.dom.encode(linkText);editor.selection.setNode(editor.dom.create("a",attrs,linkText))}else{editor.execCommand("mceInsertLink",false,attrs)}this.closeDialog()},hasSelectedText:function hasSelectedText(linkNode){var editor=this.props.editor,html=editor.selection.getContent(),nodes,i;if(/</.test(html)&&(!/^<a [^>]+>[^<]+<\/a>$/.test(html)||html.indexOf("href=")===-1)){return false}if(linkNode){nodes=linkNode.childNodes;if(nodes.length===0){return false}for(i=nodes.length-1;i>=0;i--){if(nodes[i].nodeType!==3){return false}}}return true},getInferredUrl:function getInferredUrl(){var selectedText=this.props.editor.selection.getContent(),selectedNode,parsedImage,knownImage;if(REGEXP_EMAIL.test(selectedText)){return"mailto:"+selectedText}else if(REGEXP_URL.test(selectedText)){return selectedText.replace(/&amp;|&#0?38;/gi,"&")}selectedNode=this.props.editor.selection.getNode();if(selectedNode&&"IMG"===selectedNode.nodeName){parsedImage=MediaSerialization.deserialize(selectedNode);if(this.props.site&&parsedImage.media.ID){knownImage=_store2.default.get(this.props.site.ID,parsedImage.media.ID)||parsedImage.media;return _utils2.default.url(knownImage,{size:"full"})}else if(parsedImage.media.URL){return parsedImage.media.URL}}},getState:function getState(){var editor=this.props.editor,selectedNode=editor.selection.getNode(),linkNode=editor.dom.getParent(selectedNode,"a[href]"),onlyText=this.hasSelectedText(linkNode),nextState={isNew:true,newWindow:false,showLinkText:true,linkText:"",url:"",isUserDefinedLinkText:false};if(linkNode){nextState.linkText=linkNode.innerText||linkNode.textContent;nextState.url=editor.dom.getAttrib(linkNode,"href");nextState.newWindow="_blank"===editor.dom.getAttrib(linkNode,"target");nextState.isNew=false}else if(onlyText){nextState.linkText=editor.selection.getContent({format:"text"})}if(!linkNode){nextState.url=this.getInferredUrl()||""}if(!this.hasSelectedText(linkNode)){nextState.showLinkText=false}return nextState},closeDialog:function closeDialog(){this.props.onClose()},setUrl:function setUrl(event){this.setState({url:event.target.value})},setLinkText:function setLinkText(event){this.setState({linkText:event.target.value,isUserDefinedLinkText:true})},setNewWindow:function setNewWindow(event){this.setState({newWindow:event.target.checked})},onInputKeyDown:function onInputKeyDown(event){if(event.key==="Enter"){event.preventDefault();this.updateEditor()}},removeLink:function removeLink(){this.props.editor.execCommand("unlink");this.closeDialog()},getButtons:function getButtons(){var buttonText,buttons;if(this.state.isNew){buttonText=this.translate("Add Link")}else{buttonText=this.translate("Save")}buttons=[_react2.default.createElement(_formButton2.default,{key:"save",onClick:this.updateEditor},buttonText),_react2.default.createElement(_formButton2.default,{key:"cancel",isPrimary:false,onClick:this.closeDialog},this.translate("Cancel"))];if(this.state.url&&!this.state.isNew){buttons.push(_react2.default.createElement("button",{className:"wplink__remove-link",onClick:this.removeLink},_react2.default.createElement(_gridicon2.default,{icon:"link-break"}),this.translate("Remove")))}return buttons},setExistingContent:function setExistingContent(post){var state={url:post.URL};var shouldSetLinkText=!this.state.isUserDefinedLinkText&&!this.props.editor.selection.getContent()&&!this.getLink();if(shouldSetLinkText){(0,_assign2.default)(state,{linkText:(0,_formatting.decodeEntities)(post.title)})}(0,_stats.recordStat)("link-existing-content");(0,_stats.recordEvent)("Set link to existing content");this.setState(state)},getSelectedPostId:function getSelectedPostId(){if(!this.state.url||!this.props.sitePosts){return}var selectedPost=(0,_find2.default)(this.props.sitePosts,{URL:this.state.url});if(selectedPost){return selectedPost.ID}},render:function render(){return _react2.default.createElement(_dialog2.default,{isVisible:this.props.visible,onClose:this.closeDialog,buttons:this.getButtons(),autoFocus:false,additionalClassNames:"wplink__dialog"},_react2.default.createElement(_formFieldset2.default,null,_react2.default.createElement(_formLabel2.default,null,_react2.default.createElement("span",null,this.translate("URL")),_react2.default.createElement(_formTextInput2.default,{ref:"url",autoFocus:true,onChange:this.setUrl,value:this.state.url,onKeyDown:this.onInputKeyDown})),this.state.showLinkText?_react2.default.createElement(_formLabel2.default,null,_react2.default.createElement("span",null,this.translate("Link Text")),_react2.default.createElement(_formTextInput2.default,{onChange:this.setLinkText,value:this.state.linkText,onKeyDown:this.onInputKeyDown})):null),_react2.default.createElement(_formFieldset2.default,null,_react2.default.createElement(_formLabel2.default,null,_react2.default.createElement(_formCheckbox2.default,{onChange:this.setNewWindow,checked:this.state.newWindow}),_react2.default.createElement("span",null,this.translate("Open link in a new window/tab")))),_react2.default.createElement(_formFieldset2.default,null,_react2.default.createElement(_formLabel2.default,null,_react2.default.createElement("span",null,this.translate("Link to existing content")),this.props.site&&_react2.default.createElement(_postSelector2.default,{siteId:this.props.site.ID,type:"any",status:"publish",orderBy:"date",order:"DESC",selected:this.getSelectedPostId(),onChange:this.setExistingContent,emptyMessage:this.translate("No posts found")}))))}});exports.default=(0,_reactRedux.connect)(function(state){var selectedSite=(0,_selectors.getSelectedSite)(state);return{site:selectedSite,sitePosts:selectedSite?(0,_selectors2.getSitePosts)(state,selectedSite.ID):null}})(LinkDialog);module.exports=exports["default"]},2589:function(module,exports,__webpack_require__){"use strict";var _reactRedux=__webpack_require__(15);var ReactDom=__webpack_require__(44),React=__webpack_require__(1),tinymce=__webpack_require__(1675),translate=__webpack_require__(11).translate;var LinkDialog=__webpack_require__(2588);function wpLink(editor){var node,toolbar;function render(){var visible=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;ReactDom.render(React.createElement(_reactRedux.Provider,{store:editor.getParam("redux_store")},React.createElement(LinkDialog,{visible:visible,editor:editor,onClose:function onClose(){return render(false)}})),node);if(!visible){editor.focus()}}editor.on("init",function(){node=editor.getContainer().appendChild(document.createElement("div"))});editor.on("remove",function(){ReactDom.unmountComponentAtNode(node);node.parentNode.removeChild(node);node=null});editor.addCommand("WP_Link",function(){return render()});editor.addShortcut("access+a","","WP_Link");editor.addShortcut("meta+k","","WP_Link");editor.addButton("link",{icon:"link",tooltip:translate("Insert/edit link"),cmd:"WP_Link",stateSelector:"a[href]"});editor.addButton("unlink",{icon:"unlink",tooltip:"Remove link",cmd:"unlink"});editor.addMenuItem("link",{icon:"link",text:translate("Insert/edit link"),cmd:"WP_Link",stateSelector:"a[href]",context:"insert",prependToContext:true});editor.on("pastepreprocess",function(event){var pastedStr=event.content;if(!editor.selection.isCollapsed()){pastedStr=pastedStr.replace(/<[^>]+>/g,"");pastedStr=tinymce.trim(pastedStr);if(/^(?:https?:)?\/\/\S+$/i.test(pastedStr)){editor.execCommand("mceInsertLink",false,{href:editor.dom.decode(pastedStr)});event.preventDefault()}}});tinymce.ui.WPLinkPreview=tinymce.ui.Control.extend({url:"#",renderHtml:function renderHtml(){return'<div id="'+this._id+'" class="wp-link-preview">'+'<a href="'+this.url+'" target="_blank" rel="noopener noreferrer" tabindex="-1">'+this.url+"</a>"+"</div>"},setURL:function setURL(url){var index,lastIndex;if(this.url!==url){this.url=url;url=window.decodeURIComponent(url);url=url.replace(/^(?:https?:)?\/\/(?:www\.)?/,"");if((index=url.indexOf("?"))!==-1){url=url.slice(0,index)}if((index=url.indexOf("#"))!==-1){url=url.slice(0,index)}url=url.replace(/(?:index)?\.html$/,"");if(url.charAt(url.length-1)==="/"){url=url.slice(0,-1)}if(url.length>40&&(index=url.indexOf("/"))!==-1&&(lastIndex=url.lastIndexOf("/"))!==-1&&lastIndex!==index){if(index+url.length-lastIndex<40){lastIndex=-(40-(index+1))}url=url.slice(0,index+1)+""+url.slice(lastIndex)}tinymce.$(this.getEl().firstChild).attr("href",this.url).text(url)}}});editor.addButton("wp_link_preview",{type:"WPLinkPreview",onPostRender:function onPostRender(){var self=this;editor.on("wptoolbar",function(event){var anchor=editor.dom.getParent(event.element,"a"),$anchor,href;if(anchor){$anchor=editor.$(anchor);href=$anchor.attr("href");if(href&&!$anchor.find("img").length){self.setURL(href);event.element=anchor;event.toolbar=toolbar}}})}});editor.addButton("wp_link_edit",{tooltip:"Edit ",icon:"dashicon dashicons-edit",cmd:"WP_Link"});editor.addButton("wp_link_remove",{tooltip:"Remove",icon:"dashicon dashicons-no",cmd:"unlink"});editor.on("preinit",function(){if(editor.wp&&editor.wp._createToolbar){toolbar=editor.wp._createToolbar(["wp_link_preview","wp_link_edit","wp_link_remove"],true)}})}module.exports=function(){tinymce.PluginManager.add("wplink",wpLink)}},2590:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(){_tinymce2.default.PluginManager.add("wptextpattern",wptextpattern)};var _tinymce=__webpack_require__(1675);var _tinymce2=_interopRequireDefault(_tinymce);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{
default:obj}}function wptextpattern(editor){var VK=_tinymce2.default.util.VK;var spacePatterns=[{regExp:/^[*-]\s/,cmd:"InsertUnorderedList"},{regExp:/^1[.)]\s/,cmd:"InsertOrderedList"}];var enterPatterns=[{start:"##",format:"h2"},{start:"###",format:"h3"},{start:"####",format:"h4"},{start:"#####",format:"h5"},{start:"######",format:"h6"},{start:">",format:"blockquote"},{regExp:/^(-){3,}$/,element:"hr"}];var inlinePatterns=[{start:"`",end:"`",format:"code"}];var canUndo;var chars=[];_tinymce2.default.each(inlinePatterns,function(pattern){_tinymce2.default.each((pattern.start+pattern.end).split(""),function(c){if(_tinymce2.default.inArray(chars,c)===-1){chars.push(c)}})});editor.on("selectionchange",function(){canUndo=null});editor.on("keydown",function(event){if(canUndo&&event.keyCode===27||canUndo==="space"&&event.keyCode===VK.BACKSPACE){editor.undoManager.undo();event.preventDefault();event.stopImmediatePropagation()}if(event.keyCode===VK.ENTER&&!VK.modifierPressed(event)){enter()}if(event.keyCode===VK.SPACEBAR&&!event.ctrlKey&&!event.metaKey&&!event.altKey){setTimeout(space)}else if(event.keyCode>47&&!(event.keyCode>=91&&event.keyCode<=93)){setTimeout(inline)}},true);function inline(){var rng=editor.selection.getRng();var node=rng.startContainer;var offset=rng.startOffset;var startOffset;var endOffset;var pattern;var format;var zero;if(!node||node.nodeType!==3||!node.data.length||!offset){return}if(_tinymce2.default.inArray(chars,node.data.charAt(offset-1))===-1){return}function findStart(node){var i=inlinePatterns.length;var offset;while(i--){pattern=inlinePatterns[i];offset=node.data.indexOf(pattern.end);if(offset!==-1){return offset}}}startOffset=findStart(node);endOffset=node.data.lastIndexOf(pattern.end);if(startOffset===endOffset||endOffset===-1){return}if(endOffset-startOffset<=pattern.start.length){return}if(node.data.slice(startOffset+pattern.start.length,endOffset).indexOf(pattern.start.slice(0,1))!==-1){return}format=editor.formatter.get(pattern.format);if(format&&format[0].inline){editor.undoManager.add();editor.undoManager.transact(function(){node.insertData(offset,"");node=node.splitText(startOffset);zero=node.splitText(offset-startOffset);node.deleteData(0,pattern.start.length);node.deleteData(node.data.length-pattern.end.length,pattern.end.length);editor.formatter.apply(pattern.format,{},node);editor.selection.setCursorLocation(zero,1)});setTimeout(function(){canUndo="space";editor.once("selectionchange",function(){var offset;if(zero){offset=zero.data.indexOf("");if(offset!==-1){zero.deleteData(offset,offset+1)}}})})}}function firstTextNode(node){var parent=editor.dom.getParent(node,"p"),child;if(!parent){return}while(child=parent.firstChild){if(child.nodeType!==3){parent=child}else{break}}if(!child){return}if(!child.data){if(child.nextSibling&&child.nextSibling.nodeType===3){child=child.nextSibling}else{child=null}}return child}function space(){var rng=editor.selection.getRng(),node=rng.startContainer,parent,text;if(!node||firstTextNode(node)!==node){return}parent=node.parentNode;text=node.data;_tinymce2.default.each(spacePatterns,function(pattern){var match=text.match(pattern.regExp);if(!match||rng.startOffset!==match[0].length){return}editor.undoManager.add();editor.undoManager.transact(function(){node.deleteData(0,match[0].length);if(!parent.innerHTML){parent.appendChild(document.createElement("br"))}editor.selection.setCursorLocation(parent);editor.execCommand(pattern.cmd)});setTimeout(function(){canUndo="space"});return false})}function enter(){var rng=editor.selection.getRng(),start=rng.startContainer,node=firstTextNode(start),i=enterPatterns.length,text,pattern,parent;if(!node){return}text=node.data;while(i--){if(enterPatterns[i].start){if(text.indexOf(enterPatterns[i].start)===0){pattern=enterPatterns[i];break}}else if(enterPatterns[i].regExp){if(enterPatterns[i].regExp.test(text)){pattern=enterPatterns[i];break}}}if(!pattern){return}if(node===start&&_tinymce2.default.trim(text)===pattern.start){return}editor.once("keyup",function(){editor.undoManager.add();editor.undoManager.transact(function(){if(pattern.format){editor.formatter.apply(pattern.format,{},node);node.replaceData(0,node.data.length,ltrim(node.data.slice(pattern.start.length)))}else if(pattern.element){parent=node.parentNode&&node.parentNode.parentNode;if(parent){parent.replaceChild(document.createElement(pattern.element),node.parentNode)}}});setTimeout(function(){canUndo="enter"})})}function ltrim(text){return text?text.replace(/^\s+/,""):""}}module.exports=exports["default"]},2602:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _dispatcher=__webpack_require__(42);var _dispatcher2=_interopRequireDefault(_dispatcher);var _wp=__webpack_require__(28);var _wp2=_interopRequireDefault(_wp);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={fetch:function fetch(siteId,url){var siteHandle=_wp2.default.undocumented().site(siteId);var args=void 0;if(url){_dispatcher2.default.handleViewAction({type:"FETCH_EMBED",siteId:siteId,url:url});args={embed_url:url,force:"wpcom"}}else{_dispatcher2.default.handleViewAction({type:"FETCH_EMBEDS",siteId:siteId})}siteHandle.embeds(args,function(error,data){if(url){_dispatcher2.default.handleServerAction({type:"RECEIVE_EMBED",siteId:siteId,url:url,data:data,error:error})}else{_dispatcher2.default.handleServerAction({type:"RECEIVE_EMBEDS",siteId:siteId,embeds:data?data.embeds:null,error:error})}})}};module.exports=exports["default"]},2603:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _defineProperty2=__webpack_require__(7);var _defineProperty3=_interopRequireDefault(_defineProperty2);var _assign=__webpack_require__(5);var _assign2=_interopRequireDefault(_assign);var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _utils=__webpack_require__(1940);var _dispatcher=__webpack_require__(42);var _dispatcher2=_interopRequireDefault(_dispatcher);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var REGEXP_NAMED_CAPTURE_GROUP=/\(\?P?<([\w$]+)>/g;var REGEXP_PCRE_REGEXP=/^([^\w\s\\])(.*)([^\w\s\\])([gim])?$/;var EmbedsListStore=function(_ReduceStore){(0,_inherits3.default)(EmbedsListStore,_ReduceStore);function EmbedsListStore(){(0,_classCallCheck3.default)(this,EmbedsListStore);return(0,_possibleConstructorReturn3.default)(this,(EmbedsListStore.__proto__||(0,_getPrototypeOf2.default)(EmbedsListStore)).apply(this,arguments))}(0,_createClass3.default)(EmbedsListStore,[{key:"getInitialState",value:function getInitialState(){return{}}},{key:"get",value:function get(siteId){return this.getState()[siteId]}},{key:"reduce",value:function reduce(state,action){action=action.action;switch(action.type){case"FETCH_EMBEDS":state=(0,_assign2.default)({},state,(0,_defineProperty3.default)({},action.siteId,{status:"LOADING"}));break;case"RECEIVE_EMBEDS":if(action.error){state=(0,_assign2.default)({},state,(0,_defineProperty3.default)({},action.siteId,{status:"ERROR"}))}else{var embeds=action.embeds.map(function(embed){embed=embed.replace(REGEXP_NAMED_CAPTURE_GROUP,"(");var match=embed.match(REGEXP_PCRE_REGEXP);if(match&&match[1]===match[3]){return new RegExp(match[2],match[4])}try{return new RegExp(embed)}catch(e){return false}}).filter(Boolean);state=(0,_assign2.default)({},state,(0,_defineProperty3.default)({},action.siteId,{status:"LOADED",embeds:embeds}))}break}return state}}]);return EmbedsListStore}(_utils.ReduceStore);exports.default=new EmbedsListStore(_dispatcher2.default);module.exports=exports["default"]},2609:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _promise=__webpack_require__(49);var _promise2=_interopRequireDefault(_promise);exports.geocode=geocode;var _superagent=__webpack_require__(146);var _superagent2=_interopRequireDefault(_superagent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var GOOGLE_MAPS_API_BASE_URL="https://maps.googleapis.com/maps/api/geocode/json";function geocode(address){return new _promise2.default(function(resolve,reject){_superagent2.default.get(GOOGLE_MAPS_API_BASE_URL).query({address:address}).end(function(error,response){if(error||!response.ok||"OK"!==response.body.status){return reject(error)}resolve(response.body.results)})})}},2625:function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(string){var wrapper=void 0;if(document.implementation&&document.implementation.createHTMLDocument){wrapper=document.implementation.createHTMLDocument("").body}else if("undefined"!==typeof DOMParser){try{return(new DOMParser).parseFromString(string,"text/html").body.firstChild}catch(e){}}wrapper=wrapper||document.createElement("div");wrapper.innerHTML=string;return wrapper.firstChild};module.exports=exports["default"]},2626:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _typeof2=__webpack_require__(32);var _typeof3=_interopRequireDefault(_typeof2);exports.default=function(node){if("string"===typeof node){return _constants.Formats.STRING}if("object"===(typeof node==="undefined"?"undefined":(0,_typeof3.default)(node))&&"string"===typeof node.nodeName){return _constants.Formats.DOM}if(node&&node.tag&&(0,_includes2.default)(VALID_SHORTCODE_TYPES,node.type)){return _constants.Formats.SHORTCODE}if(node&&node.type&&(0,_includes2.default)(_constants.MediaTypes,node.type)){return _constants.Formats.OBJECT}if(_utils2.default.getMimePrefix(node)){return _constants.Formats.API}return _constants.Formats.UNKNOWN};var _includes=__webpack_require__(30);var _includes2=_interopRequireDefault(_includes);var _constants=__webpack_require__(1976);var _utils=__webpack_require__(1647);var _utils2=_interopRequireDefault(_utils);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var VALID_SHORTCODE_TYPES=["closed","self-closing","single"];module.exports=exports["default"]},2627:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.deserialize=deserialize;var _assign=__webpack_require__(34);var _assign2=_interopRequireDefault(_assign);var _utils=__webpack_require__(1647);var _utils2=_interopRequireDefault(_utils);var _constants=__webpack_require__(1976);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function deserialize(node){var normalized={media:(0,_assign2.default)({transient:false},node),appearance:{}};switch(_utils2.default.getMimePrefix(node)){case"image":normalized.type=_constants.MediaTypes.IMAGE;break;case"audio":normalized.type=_constants.MediaTypes.AUDIO;break;case"video":normalized.type=_constants.MediaTypes.VIDEO;break}return normalized}},2628:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.deserialize=deserialize;var _constants=__webpack_require__(1976);var REGEXP_IMG_CLASS_SIZE=/\bsize-(\w+)\b/;var REGEXP_IMG_CLASS_ID=/\bwp-image-((media-)?\d+)\b/;var REGEXP_IMG_CLASS_ALIGN=/\balign(left|center|right|none)\b/;function parseImage(node,_parsed){_parsed.type=_constants.MediaTypes.IMAGE;_parsed.media.URL=node.getAttribute("src");_parsed.media.alt=node.getAttribute("alt");_parsed.media.transient=0===(_parsed.media.URL||"").indexOf("blob:");["width","height"].forEach(function(dimension){var natural="natural"+dimension[0].toUpperCase()+dimension.slice(1),value=node.getAttribute(dimension)||node[natural]||node[dimension];if(value&&isFinite(value)){_parsed.media[dimension]=parseInt(value,10)}});if(REGEXP_IMG_CLASS_SIZE.test(node.className)){_parsed.appearance.size=node.className.match(REGEXP_IMG_CLASS_SIZE)[1]}if(REGEXP_IMG_CLASS_ALIGN.test(node.className)){_parsed.appearance.align=node.className.match(REGEXP_IMG_CLASS_ALIGN)[1]}if(REGEXP_IMG_CLASS_ID.test(node.className)){_parsed.media.ID=node.className.match(REGEXP_IMG_CLASS_ID)[1];if(isFinite(_parsed.media.ID)){_parsed.media.ID=parseInt(_parsed.media.ID,10)}}return _parsed}function deserialize(node){var _parsed=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{media:{},appearance:{}};switch(node.nodeName){case"IMG":_parsed=parseImage(node,_parsed);break}return _parsed}},2629:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _dom=__webpack_require__(2628);var dom=_interopRequireWildcard(_dom);var _string=__webpack_require__(2632);var string=_interopRequireWildcard(_string);var _shortcode=__webpack_require__(2631);var shortcode=_interopRequireWildcard(_shortcode);var _object=__webpack_require__(2630);var object=_interopRequireWildcard(_object);var _api=__webpack_require__(2627);var api=_interopRequireWildcard(_api);var _unknown=__webpack_require__(2633);var unknown=_interopRequireWildcard(_unknown);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}exports.default={dom:dom,string:string,shortcode:shortcode,object:object,api:api,unknown:unknown};module.exports=exports["default"]},2630:function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.deserialize=deserialize;function deserialize(node){return node}},2631:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.deserialize=deserialize;var _=__webpack_require__(1814);var REGEXP_CAPTION_CONTENT=/((?:<a [^>]+>)?<img [^>]+>(?:<\/a>)?)([\s\S]*)/i;var REGEXP_CAPTION_ID=/attachment_(\d+)/;var REGEXP_CAPTION_ALIGN=/align(\w+)/;function parseCaption(node,_parsed){if(node.attrs&&node.attrs.named){if(REGEXP_CAPTION_ALIGN.test(node.attrs.named.align)){_parsed.appearance.align=node.attrs.named.align.match(REGEXP_CAPTION_ALIGN)[1]}if(REGEXP_CAPTION_ID.test(node.attrs.named.id)){_parsed.media.ID=parseInt(node.attrs.named.id.match(REGEXP_CAPTION_ID)[1],10)}if(_parsed.media.width&&isFinite(node.attrs.named.width)){_parsed.media.width=parseInt(node.attrs.named.width,10)}}if(!node.content){return _parsed}var img=node.content.match(REGEXP_CAPTION_CONTENT);if(img&&img[2]){_parsed.media.caption=img[2].trim()}if(img){return(0,_.deserialize)(img[1],_parsed)}return _parsed}function deserialize(node){var _parsed=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{media:{},appearance:{}};switch(node.tag){case"caption":_parsed=parseCaption(node,_parsed);break}return _parsed}},2632:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _assign=__webpack_require__(5);var _assign2=_interopRequireDefault(_assign);exports.deserialize=deserialize;var _shortcode=__webpack_require__(1719);var _shortcode2=_interopRequireDefault(_shortcode);var _=__webpack_require__(1814);var _createElementFromString=__webpack_require__(2625);var _createElementFromString2=_interopRequireDefault(_createElementFromString);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function parseAsShortcode(node,_parsed){var shortcode=_shortcode2.default.parse(node);if(shortcode){return(0,_.deserialize)(shortcode,_parsed)}return _parsed}function parseAsElement(node,_parsed){var element=(0,_createElementFromString2.default)(node);if(element instanceof window.Element){return(0,_.deserialize)(element,_parsed)}return _parsed}function deserialize(node){var _parsed=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{media:{},appearance:{}};return[parseAsShortcode,parseAsElement].reduce(function(memo,parse){return(0,_assign2.default)(memo,parse(node,_parsed))},{})}},2633:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.deserialize=deserialize;var _constants=__webpack_require__(1976);function deserialize(){return{type:_constants.MediaTypes.UNKNOWN,media:{},appearance:{}}}},2639:function(module,exports,__webpack_require__){"use strict";var debug=__webpack_require__(3)("calypso:post-formats");var Dispatcher=__webpack_require__(42),wpcom=__webpack_require__(28);var PostFormatsActions={};PostFormatsActions.fetch=function(siteId){Dispatcher.handleViewAction({type:"FETCH_POST_FORMATS",siteId:siteId});debug("Fetching post formats for %d",siteId);wpcom.undocumented().site(siteId).postFormatsList(function(error,data){Dispatcher.handleServerAction({type:"RECEIVE_POST_FORMATS",error:error,siteId:siteId,data:data?data.formats:null})})};module.exports=PostFormatsActions},2640:function(module,exports,__webpack_require__){"use strict";var _keys=__webpack_require__(39);var _keys2=_interopRequireDefault(_keys);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var Dispatcher=__webpack_require__(42),emitter=__webpack_require__(36);var PostFormatsStore={_formats:{}};emitter(PostFormatsStore);function receivePostFormats(siteId,data){PostFormatsStore._formats[siteId]=(0,_keys2.default)(data).map(function(slug){return{slug:slug,label:data[slug]}})}PostFormatsStore.get=function(siteId){return PostFormatsStore._formats[siteId]};PostFormatsStore.dispatchToken=Dispatcher.register(function(payload){var action=payload.action;switch(action.type){case"RECEIVE_POST_FORMATS":if(!action.error&&action.siteId&&action.data){receivePostFormats(action.siteId,action.data);PostFormatsStore.emit("change")}break}});module.exports=PostFormatsStore},2655:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.fetch=fetch;var _dispatcher=__webpack_require__(42);var _dispatcher2=_interopRequireDefault(_dispatcher);var _wp=__webpack_require__(28);var _wp2=_interopRequireDefault(_wp);var _constants=__webpack_require__(2280);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function fetch(siteId,shortcode){_dispatcher2.default.handleViewAction({type:_constants.ActionTypes.FETCH_SHORTCODE,payload:{siteId:siteId,shortcode:shortcode}});_wp2.default.undocumented().site(siteId).shortcodes({shortcode:shortcode},function(error,data){_dispatcher2.default.handleServerAction({type:_constants.ActionTypes.RECEIVE_SHORTCODE,payload:{siteId:siteId,shortcode:shortcode,data:data},error:error})})}},2664:function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function countWords(content){if(content&&typeof content==="string"){content=content.replace(/\.\.\./g," ");content=content.replace(/<.[^<>]*?>/g," ");content=content.replace(/&nbsp;|&#160;/gi," ");content=content.replace(/(\w+)(&#?[a-z0-9]+;)+(\w+)/i,"$1$3");content=content.replace(/&.+?;/g," ");content=content.replace(/[0-9.(),;:!?%#$?\x27\x22_+=\\\/\-]*/g,"");var words=content.match(/[\w\u2019\x27\-\u00C0-\u1FFF]+/g);if(words){return words.length}}return 0}exports.default={countWords:countWords};module.exports=exports["default"]},2771:function(module,exports,__webpack_require__){"use strict";var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var React=__webpack_require__(1),PureRenderMixin=__webpack_require__(111),omit=__webpack_require__(18);var PostListFetcher=__webpack_require__(1807),hasTouch=__webpack_require__(216).hasTouch,actions=__webpack_require__(1648),Draft=__webpack_require__(2093),EmptyContent=__webpack_require__(207),infiniteScroll=__webpack_require__(1765),observe=__webpack_require__(131);var DraftList=React.createClass({displayName:"DraftList",mixins:[PureRenderMixin],propTypes:{search:React.PropTypes.string,sites:React.PropTypes.object,siteID:React.PropTypes.any,trackScrollPage:React.PropTypes.func,onTitleClick:React.PropTypes.func,showAllActionsMenu:React.PropTypes.bool,selectedId:React.PropTypes.number},getDefaultProps:function getDefaultProps(){return{showAllActionsMenu:true,selectedId:false}},render:function render(){return React.createElement(PostListFetcher,{siteID:this.props.siteID,status:"draft,pending",withImages:true,withCounts:true,onTitleClick:this.props.onTitleClick},React.createElement(Drafts,(0,_extends3.default)({},omit(this.props,"children"),{status:"draft",selectedId:this.props.selectedId})))}});var Drafts=React.createClass({displayName:"Drafts",mixins:[infiniteScroll("fetchPosts"),observe("sites")],propTypes:{loading:React.PropTypes.bool.isRequired,lastPage:React.PropTypes.bool.isRequired,page:React.PropTypes.number.isRequired,trackScrollPage:React.PropTypes.func.isRequired,sites:React.PropTypes.object.isRequired,onTitleClick:React.PropTypes.func,posts:React.PropTypes.array.isRequired,postImages:React.PropTypes.object.isRequired,search:React.PropTypes.string,siteID:React.PropTypes.any,showAllActionsMenu:React.PropTypes.bool,selectedId:React.PropTypes.number},getDefaultProps:function getDefaultProps(){return{loading:false,lastPage:false,page:0,postImages:{},posts:[],trackScrollPage:function trackScrollPage(){},showAllActionsMenu:true,selectedId:false}},fetchPosts:function fetchPosts(options){if(this.props.loading||this.props.lastPage){return}if(options.triggeredByScroll){this.props.trackScrollPage(this.props.page+1)}actions.fetchNextPage()},noDrafts:function noDrafts(){return React.createElement(EmptyContent,{title:this.translate("You don't have any drafts."),line:this.translate("Would you like to create one?"),action:this.translate("Start a Post"),actionURL:this.props.sites.selected?"/post/"+this.props.sites.getSelectedSite().slug:"/post",illustration:"/calypso/images/posts/illustration-posts.svg",illustrationWidth:150})},render:function render(){var posts=this.props.posts;if(posts.length&&this.props.sites.initialized){posts=posts.map(function(post){return React.createElement(Draft,{key:"draft-"+post.ID,onTitleClick:this.props.onTitleClick,post:post,postImages:this.props.postImages[post.global_ID],sites:this.props.sites,showAllActions:this.props.showAllActionsMenu&&hasTouch(),selected:this.props.selectedId===post.ID})},this)}else if(this.props.loading){posts=Array.apply(null,Array(1)).map(function(value,i){return React.createElement(Draft,{isPlaceholder:true,key:"draft-placeholder-"+i})})}else{return this.noDrafts()}return React.createElement("div",null,React.createElement("div",{id:"drafts",className:"drafts__list",ref:"draftList"},posts),this.props.lastPage?React.createElement("div",{className:"infinite-scroll-end"}):null)}});module.exports=DraftList},2842:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _filesize=__webpack_require__(3458);var _filesize2=_interopRequireDefault(_filesize);var _noop=__webpack_require__(38);var _noop2=_interopRequireDefault(_noop);var _button=__webpack_require__(69);var _button2=_interopRequireDefault(_button);var _progressBar=__webpack_require__(1808);var _progressBar2=_interopRequireDefault(_progressBar);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ALERT_PERCENT=80;var WARN_PERCENT=60;exports.default=_react2.default.createClass({displayName:"PlanStorageButton",propTypes:{sitePlanName:_react2.default.PropTypes.string.isRequired,mediaStorage:_react2.default.PropTypes.object,onClick:_react2.default.PropTypes.func,className:_react2.default.PropTypes.string},getDefaultProps:function getDefaultProps(){return{onClick:_noop2.default}},getPlanTranslation:function getPlanTranslation(){if(this.props.sitePlanName==="Premium"){return this.translate("Premium Plan",{context:"Short plan name on storage button"})}else if(this.props.sitePlanName==="Free"){return this.translate("Free Plan",{context:"Short plan name on storage button"})}return this.translate("%(planName)s Plan",{args:{planName:this.props.sitePlanName}})},render:function render(){if(!this.props.mediaStorage||this.props.mediaStorage.max_storage_bytes===-1){return null}var percent=Math.min(Math.round(this.props.mediaStorage.storage_used_bytes/this.props.mediaStorage.max_storage_bytes*1e3)/10,100);var classes=(0,_classnames2.default)(this.props.className,"plan-storage__button",{"is-alert":percent>ALERT_PERCENT,"is-warn":percent>WARN_PERCENT&&percent<=ALERT_PERCENT});var max=(0,_filesize2.default)(this.props.mediaStorage.max_storage_bytes);return _react2.default.createElement(_button2.default,{className:classes,onClick:this.props.onClick},_react2.default.createElement("span",{className:"plan-storage__plan-label"},this.getPlanTranslation()),_react2.default.createElement("span",{className:"plan-storage__storage-label"},this.translate("%(percent)f%% of %(max)s used",{args:{percent:percent,max:max}})),_react2.default.createElement(_progressBar2.default,{className:"plan-storage__bar",value:percent,total:100,compact:true}),this.props.children)}});module.exports=exports["default"]},2843:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactRedux=__webpack_require__(15);var _noop=__webpack_require__(38);var _noop2=_interopRequireDefault(_noop);var _queryMediaStorage=__webpack_require__(2498);var _queryMediaStorage2=_interopRequireDefault(_queryMediaStorage);var _selectors=__webpack_require__(2372);var _selectors2=__webpack_require__(79);var _button=__webpack_require__(2842);var _button2=_interopRequireDefault(_button);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var PlanStorage=_react2.default.createClass({displayName:"PlanStorage",propTypes:{className:_react2.default.PropTypes.string,mediaStorage:_react2.default.PropTypes.object,siteId:_react2.default.PropTypes.number.isRequired,onClick:_react2.default.PropTypes.func},getDefaultProps:function getDefaultProps(){return{onClick:_noop2.default}},render:function render(){if(!this.props.site||this.props.site.jetpack){return null}var classes=(0,_classnames2.default)(this.props.className,"plan-storage");return _react2.default.createElement("div",{className:classes},_react2.default.createElement(_queryMediaStorage2.default,{siteId:this.props.siteId}),_react2.default.createElement(_button2.default,{sitePlanName:this.props.site.plan.product_name_short,mediaStorage:this.props.mediaStorage,onClick:this.props.onClick},this.props.children))}});exports.default=(0,_reactRedux.connect)(function(state,ownProps){return{mediaStorage:(0,_selectors.getMediaStorage)(state,ownProps.siteId),site:(0,_selectors2.getSite)(state,ownProps.siteId)}})(PlanStorage);module.exports=exports["default"]},2871:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"PostSelectorNoResults",propTypes:{createLink:_react.PropTypes.string},render:function render(){var createMessage=void 0;var noResultsMessage=void 0;noResultsMessage=this.translate("No results. Please try a different search.");if(this.props.createLink){createMessage=this.translate("You may want to {{a}}create a new page{{/a}}.",{context:"Menus: item search/listing results",comment:"This is used when no posts or pages match the given search.",components:{a:_react2.default.createElement("a",{className:"create-link",href:this.props.createLink,target:"_blank",rel:"noopener noreferrer"})}})}return _react2.default.createElement("span",{className:"is-empty-content"},noResultsMessage,"",createMessage)}});module.exports=exports["default"]},2872:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"PostSelectorSearch",propTypes:{searchTerm:_react.PropTypes.string,onSearch:_react.PropTypes.func.isRequired},render:function render(){return _react2.default.createElement("div",{className:"post-selector__search"},_react2.default.createElement(_gridicon2.default,{icon:"search",size:18}),_react2.default.createElement("input",{type:"search",placeholder:this.translate("Search",{textOnly:true}),value:this.props.searchTerm,onChange:this.props.onSearch}))}});module.exports=exports["default"]},2873:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _stringify=__webpack_require__(40);var _stringify2=_interopRequireDefault(_stringify);var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);var _includes2=__webpack_require__(30);var _includes3=_interopRequireDefault(_includes2);var _isEqual2=__webpack_require__(98);var _isEqual3=_interopRequireDefault(_isEqual2);var _difference2=__webpack_require__(118);var _difference3=_interopRequireDefault(_difference2);var _range2=__webpack_require__(735);var _range3=_interopRequireDefault(_range2);var _filter2=__webpack_require__(77);var _filter3=_interopRequireDefault(_filter2);var _reduce2=__webpack_require__(117);var _reduce3=_interopRequireDefault(_reduce2);var _map2=__webpack_require__(45);var _map3=_interopRequireDefault(_map2);var _get2=__webpack_require__(24);var _get3=_interopRequireDefault(_get2);var _memoize2=__webpack_require__(405);var _memoize3=_interopRequireDefault(_memoize2);var _debounce2=__webpack_require__(278);var _debounce3=_interopRequireDefault(_debounce2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactRedux=__webpack_require__(15);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _scrollbarSize=__webpack_require__(1864);var _scrollbarSize2=_interopRequireDefault(_scrollbarSize);var _VirtualScroll=__webpack_require__(1871);var _VirtualScroll2=_interopRequireDefault(_VirtualScroll);var _AutoSizer=__webpack_require__(2215);var _AutoSizer2=_interopRequireDefault(_AutoSizer);var _noResults=__webpack_require__(2871);var _noResults2=_interopRequireDefault(_noResults);var _analytics=__webpack_require__(20);var _analytics2=_interopRequireDefault(_analytics);var _search=__webpack_require__(2872);var _search2=_interopRequireDefault(_search);var _formatting=__webpack_require__(81);var _selectors=__webpack_require__(112);var _selectors2=__webpack_require__(390);var _queryPostTypes=__webpack_require__(726);var _queryPostTypes2=_interopRequireDefault(_queryPostTypes);var _queryPosts=__webpack_require__(762);var _queryPosts2=_interopRequireDefault(_queryPosts);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var SEARCH_DEBOUNCE_TIME_MS=500;var ITEM_HEIGHT=25;var DEFAULT_POSTS_PER_PAGE=20;var LOAD_OFFSET=10;
var PostSelectorPosts=_react2.default.createClass({displayName:"PostSelectorPosts",propTypes:{siteId:_react.PropTypes.number.isRequired,query:_react.PropTypes.object,posts:_react.PropTypes.array,lastPage:_react.PropTypes.number,loading:_react.PropTypes.bool,emptyMessage:_react.PropTypes.string,createLink:_react.PropTypes.string,selected:_react.PropTypes.number,onSearch:_react.PropTypes.func,onChange:_react.PropTypes.func,multiple:_react.PropTypes.bool,showTypeLabels:_react.PropTypes.bool},getInitialState:function getInitialState(){return{searchTerm:"",requestedPages:[1]}},getDefaultProps:function getDefaultProps(){return{analyticsPrefix:"Post Selector",searchThreshold:8,loading:true,emptyMessage:"",posts:[],onSearch:function onSearch(){},onChange:function onChange(){}}},componentWillMount:function componentWillMount(){var _this=this;this.itemHeights={};this.hasPerformedSearch=false;this.postIds=(0,_map3.default)(this.props.posts,"ID");this.getPostChildren=(0,_memoize3.default)(this.getPostChildren);this.queueRecomputeRowHeights=(0,_debounce3.default)(this.recomputeRowHeights);this.debouncedSearch=(0,_debounce3.default)(function(){_this.props.onSearch(_this.state.searchTerm)},SEARCH_DEBOUNCE_TIME_MS)},componentWillReceiveProps:function componentWillReceiveProps(nextProps){if(!(0,_isEqual3.default)(this.props.query,nextProps.query)||this.props.siteId!==nextProps.siteId){this.setState({requestedPages:[1]})}if(this.props.posts!==nextProps.posts){this.getPostChildren.cache.clear();this.postIds=(0,_map3.default)(nextProps.posts,"ID")}},componentDidUpdate:function componentDidUpdate(prevProps){var forceUpdate=prevProps.selected!==this.props.selected||prevProps.loading&&!this.props.loading;if(forceUpdate){this.virtualScroll.forceUpdate()}if(this.props.posts!==prevProps.posts){this.recomputeRowHeights()}},recomputeRowHeights:function recomputeRowHeights(){if(!this.virtualScroll){return}this.virtualScroll.recomputeRowHeights();if(this.isCompact()){this.forceUpdate()}},setVirtualScrollRef:function setVirtualScrollRef(virtualScroll){this.virtualScroll=virtualScroll},setItemRef:function setItemRef(item,itemRef){if(!itemRef||!item){return}var height=this.itemHeights[item.global_ID]||ITEM_HEIGHT;var nextHeight=itemRef.clientHeight;this.itemHeights[item.global_ID]=nextHeight;if(height!==nextHeight){this.queueRecomputeRowHeights()}},hasNoSearchResults:function hasNoSearchResults(){return!this.props.loading&&this.props.posts&&!this.props.posts.length&&this.state.searchTerm},hasNoPosts:function hasNoPosts(){return!this.props.loading&&this.props.posts&&!this.props.posts.length},getItem:function getItem(index){if(this.props.posts){return this.props.posts[index]}},isCompact:function isCompact(){if(!this.props.posts||this.state.searchTerm||this.hasNoPosts()){return false}return this.props.posts.length<this.props.searchThreshold},isTypeLabelsVisible:function isTypeLabelsVisible(){if("boolean"===typeof this.props.showTypeLabels){return this.props.showTypeLabels}return"any"===this.props.query.type},isLastPage:function isLastPage(){var _props=this.props;var lastPage=_props.lastPage;var loading=_props.loading;var requestedPages=this.state.requestedPages;return(0,_includes3.default)(requestedPages,lastPage)&&!loading},getPostChildren:function getPostChildren(postId){var posts=this.props.posts;return(0,_filter3.default)(posts,function(_ref){var parent=_ref.parent;return parent&&parent.ID===postId})},getItemHeight:function getItemHeight(item){var _this2=this;var _recurse=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(!item){return ITEM_HEIGHT}if(item.parent&&!_recurse&&(0,_includes3.default)(this.postIds,item.parent.ID)){return 0}if(this.itemHeights[item.global_ID]){return this.itemHeights[item.global_ID]}return(0,_reduce3.default)(this.getPostChildren(item.ID),function(memo,nestedItem){return memo+_this2.getItemHeight(nestedItem,true)},ITEM_HEIGHT)},getRowHeight:function getRowHeight(_ref2){var index=_ref2.index;return this.getItemHeight(this.getItem(index))},getCompactContainerHeight:function getCompactContainerHeight(){var _this3=this;return(0,_range3.default)(0,this.getRowCount()).reduce(function(memo,index){return memo+_this3.getRowHeight({index:index})},0)},getPageForIndex:function getPageForIndex(index){var _props2=this.props;var query=_props2.query;var lastPage=_props2.lastPage;var perPage=query.number||DEFAULT_POSTS_PER_PAGE;var page=Math.ceil(index/perPage);return Math.max(Math.min(page,lastPage||Infinity),1)},getRowCount:function getRowCount(){var count=0;if(this.props.posts){count+=this.props.posts.length}if(!this.isLastPage()){count+=1}return count},setRequestedPages:function setRequestedPages(_ref3){var startIndex=_ref3.startIndex;var stopIndex=_ref3.stopIndex;var requestedPages=this.state.requestedPages;var pagesToRequest=(0,_difference3.default)((0,_range3.default)(this.getPageForIndex(startIndex-LOAD_OFFSET),this.getPageForIndex(stopIndex+LOAD_OFFSET)+1),requestedPages);if(!pagesToRequest.length){return}this.setState({requestedPages:requestedPages.concat(pagesToRequest)})},onSearch:function onSearch(event){var searchTerm=event.target.value;if(this.state.searchTerm&&!searchTerm){this.props.onSearch("")}if(searchTerm===this.state.searchTerm){return}if(!this.hasPerformedSearch){this.hasPerformedSearch=true;_analytics2.default.ga.recordEvent(this.props.analyticsPrefix,"Performed Post Search")}this.setState({searchTerm:searchTerm});this.debouncedSearch()},renderItem:function renderItem(item){var _this4=this;var _recurse=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(item.parent&&!_recurse&&(0,_includes3.default)(this.postIds,item.parent.ID)){return}var onChange=function onChange(){var _props3;for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}return(_props3=_this4.props).onChange.apply(_props3,[item].concat(args))};var setItemRef=function setItemRef(){for(var _len2=arguments.length,args=Array(_len2),_key2=0;_key2<_len2;_key2++){args[_key2]=arguments[_key2]}return _this4.setItemRef.apply(_this4,[item].concat(args))};var children=this.getPostChildren(item.ID);return _react2.default.createElement("div",{key:item.global_ID,ref:setItemRef,className:"post-selector__list-item"},_react2.default.createElement("label",null,_react2.default.createElement("input",{name:"posts",type:this.props.multiple?"checkbox":"radio",value:item.ID,onChange:onChange,checked:this.props.selected===item.ID,className:"post-selector__input"}),_react2.default.createElement("span",{className:"post-selector__label"},(0,_formatting.decodeEntities)(item.title||this.translate("Untitled")),this.isTypeLabelsVisible()&&_react2.default.createElement("span",{className:"post-selector__label-type",style:{paddingRight:this.isCompact()?0:(0,_scrollbarSize2.default)()}},(0,_formatting.decodeEntities)((0,_get3.default)(this.props.postTypes,[item.type,"labels","singular_name"],""))))),children.length>0&&_react2.default.createElement("div",{className:"post-selector__nested-list"},children.map(function(child){return _this4.renderItem(child,true)})))},renderEmptyContent:function renderEmptyContent(){var message=void 0;if(this.hasNoSearchResults()){message=_react2.default.createElement(_noResults2.default,{createLink:this.props.createLink,noResultsMessage:this.props.noResultsMessage})}else if(this.hasNoPosts()){message=this.props.emptyMessage}if(!message){return}return _react2.default.createElement("div",{key:"no-results",className:"post-selector__list-item is-empty"},message)},renderRow:function renderRow(_ref4){var index=_ref4.index;var item=this.getItem(index);if(item){return this.renderItem(item)}return _react2.default.createElement("div",{key:"placeholder",className:"post-selector__list-item is-placeholder"},_react2.default.createElement("label",null,_react2.default.createElement("input",{type:this.props.multiple?"checkbox":"radio",disabled:true,className:"post-selector__input"}),_react2.default.createElement("span",{className:"post-selector__label"},this.translate("Loading"))))},render:function render(){var _this5=this;var _props4=this.props;var className=_props4.className;var siteId=_props4.siteId;var query=_props4.query;var _state=this.state;var requestedPages=_state.requestedPages;var searchTerm=_state.searchTerm;var isCompact=this.isCompact();var isTypeLabelsVisible=this.isTypeLabelsVisible();var showSearch=searchTerm.length>0||!isCompact;var classes=(0,_classnames2.default)("post-selector",className,{"is-compact":isCompact,"is-type-labels-visible":isTypeLabelsVisible});return _react2.default.createElement("div",{className:classes},requestedPages.map(function(page){return _react2.default.createElement(_queryPosts2.default,{key:"page-"+page,siteId:siteId,query:(0,_extends3.default)({},query,{page:page})})}),isTypeLabelsVisible&&siteId&&_react2.default.createElement(_queryPostTypes2.default,{siteId:siteId}),showSearch&&_react2.default.createElement(_search2.default,{searchTerm:searchTerm,onSearch:this.onSearch}),_react2.default.createElement("div",{className:"post-selector__results"},_react2.default.createElement(_AutoSizer2.default,{key:(0,_stringify2.default)(query),disableHeight:isCompact},function(_ref5){var height=_ref5.height;var width=_ref5.width;return _react2.default.createElement(_VirtualScroll2.default,{ref:_this5.setVirtualScrollRef,width:width,height:isCompact?_this5.getCompactContainerHeight():height,onRowsRendered:_this5.setRequestedPages,noRowsRenderer:_this5.renderEmptyContent,rowCount:_this5.getRowCount(),estimatedRowSize:ITEM_HEIGHT,rowHeight:_this5.getRowHeight,rowRenderer:_this5.renderRow})})))}});exports.default=(0,_reactRedux.connect)(function(state,ownProps){var siteId=ownProps.siteId;var query=ownProps.query;return{posts:(0,_selectors.getSitePostsForQueryIgnoringPage)(state,siteId,query),found:(0,_selectors.getSitePostsFoundForQuery)(state,siteId,query),lastPage:(0,_selectors.getSitePostsLastPageForQuery)(state,siteId,query),loading:(0,_selectors.isRequestingSitePostsForQueryIgnoringPage)(state,siteId,query),postTypes:(0,_selectors2.getPostTypes)(state,siteId)}})(PostSelectorPosts);module.exports=exports["default"]},2981:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _find2=__webpack_require__(27);var _find3=_interopRequireDefault(_find2);var _get2=__webpack_require__(24);var _get3=_interopRequireDefault(_get2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactDom=__webpack_require__(44);var _reactDom2=_interopRequireDefault(_reactDom);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _reactRedux=__webpack_require__(15);var _i18nCalypso=__webpack_require__(11);var _dialog=__webpack_require__(168);var _dialog2=_interopRequireDefault(_dialog);var _terms=__webpack_require__(1992);var _terms2=_interopRequireDefault(_terms);var _button=__webpack_require__(69);var _button2=_interopRequireDefault(_button);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _formInputValidation=__webpack_require__(1646);var _formInputValidation2=_interopRequireDefault(_formInputValidation);var _formTextInput=__webpack_require__(206);var _formTextInput2=_interopRequireDefault(_formTextInput);var _formSectionHeading=__webpack_require__(1659);var _formSectionHeading2=_interopRequireDefault(_formSectionHeading);var _formCheckbox=__webpack_require__(1654);var _formCheckbox2=_interopRequireDefault(_formCheckbox);var _formLabel=__webpack_require__(380);var _formLabel2=_interopRequireDefault(_formLabel);var _formLegend=__webpack_require__(1708);var _formLegend2=_interopRequireDefault(_formLegend);var _formFieldset=__webpack_require__(275);var _formFieldset2=_interopRequireDefault(_formFieldset);var _viewport=__webpack_require__(92);var _viewport2=_interopRequireDefault(_viewport);var _selectors=__webpack_require__(47);var _selectors2=__webpack_require__(2010);var _selectors3=__webpack_require__(1742);var _actions=__webpack_require__(285);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var TermSelectorAddTerm=function(_Component){(0,_inherits3.default)(TermSelectorAddTerm,_Component);function TermSelectorAddTerm(props){(0,_classCallCheck3.default)(this,TermSelectorAddTerm);var _this=(0,_possibleConstructorReturn3.default)(this,(TermSelectorAddTerm.__proto__||(0,_getPrototypeOf2.default)(TermSelectorAddTerm)).call(this,props));_this.state=_this.constructor.initialState;_this.boundCloseDialog=_this.closeDialog.bind(_this);_this.boundOpenDialog=_this.openDialog.bind(_this);_this.boundOnParentChange=_this.onParentChange.bind(_this);_this.boundOnSearch=_this.onSearch.bind(_this);_this.boundSaveTerm=_this.saveTerm.bind(_this);_this.boundOnTopLevelChange=_this.onTopLevelChange.bind(_this);_this.boundValidateInput=_this.validateInput.bind(_this);return _this}(0,_createClass3.default)(TermSelectorAddTerm,[{key:"onSearch",value:function onSearch(searchTerm){this.setState({searchTerm:searchTerm})}},{key:"openDialog",value:function openDialog(event){event.preventDefault();this.setState({showDialog:true,selectedParent:[]})}},{key:"closeDialog",value:function closeDialog(){this.setState(this.constructor.initialState)}},{key:"onParentChange",value:function onParentChange(item){this.setState({selectedParent:[item.ID],isTopLevel:false},this.isValid)}},{key:"onTopLevelChange",value:function onTopLevelChange(){this.setState({isTopLevel:!this.state.isTopLevel,selectedParent:[]},this.isValid)}},{key:"getFormValues",value:function getFormValues(){var name=_reactDom2.default.findDOMNode(this.refs.termName).value.trim();var parent=this.state.selectedParent.length?this.state.selectedParent[0]:0;return{name:name,parent:parent}}},{key:"isValid",value:function isValid(){var error=void 0;var values=this.getFormValues();if(!values.name.length){error=true}var lowerCasedTermName=values.name.toLowerCase();var matchingTerm=(0,_find3.default)(this.props.terms,function(term){return term.name.toLowerCase()===lowerCasedTermName&&term.parent===values.parent});if(matchingTerm){error=this.props.translate("Name already exists",{context:"Terms: Add term error message - duplicate term name exists",textOnly:true})}if(error!==this.state.error){this.setState({error:error,isValid:!error})}return!error}},{key:"validateInput",value:function validateInput(event){if(13===event.keyCode){this.saveTerm()}else{this.isValid()}}},{key:"saveTerm",value:function saveTerm(){var term=this.getFormValues();if(!this.isValid()){return}var _props=this.props;var postId=_props.postId;var siteId=_props.siteId;var taxonomy=_props.taxonomy;this.props.addTermForPost(siteId,taxonomy,term,postId);this.closeDialog()}},{key:"render",value:function render(){var _props2=this.props;var labels=_props2.labels;var siteId=_props2.siteId;var taxonomy=_props2.taxonomy;var translate=_props2.translate;var terms=_props2.terms;var buttons=[{action:"cancel",label:translate("Cancel")},{action:"add",label:translate("Add"),isPrimary:true,disabled:!this.state.isValid,onClick:this.boundSaveTerm}];var _state=this.state;var searchTerm=_state.searchTerm;var selectedParent=_state.selectedParent;var query={};if(searchTerm&&searchTerm.length){query.search=searchTerm}var isError=this.state.error&&this.state.error.length;var totalTerms=terms?terms.length:0;var classes=(0,_classnames2.default)("term-tree-selector__add-term",{"is-compact":totalTerms<8});return _react2.default.createElement("div",{className:classes},_react2.default.createElement(_button2.default,{borderless:true,compact:true,onClick:this.boundOpenDialog},_react2.default.createElement(_gridicon2.default,{icon:"folder"})," ",labels.add_new_item),_react2.default.createElement(_dialog2.default,{autoFocus:false,isVisible:this.state.showDialog,buttons:buttons,onClose:this.boundCloseDialog,additionalClassNames:"term-tree-selector__add-term-dialog"},_react2.default.createElement(_formSectionHeading2.default,null,labels.add_new_item),_react2.default.createElement(_formFieldset2.default,null,_react2.default.createElement(_formTextInput2.default,{autoFocus:this.state.showDialog&&!_viewport2.default.isMobile(),placeholder:labels.new_item_name,ref:"termName",isError:isError,onKeyUp:this.boundValidateInput}),isError&&_react2.default.createElement(_formInputValidation2.default,{isError:true,text:this.state.error})),_react2.default.createElement(_formFieldset2.default,null,_react2.default.createElement(_formLegend2.default,null,labels.parent_item),_react2.default.createElement(_formLabel2.default,null,_react2.default.createElement(_formCheckbox2.default,{ref:"topLevel",checked:this.state.isTopLevel,onChange:this.boundOnTopLevelChange}),_react2.default.createElement("span",null,translate("Top level",{context:"Terms: New term being created is top level"}))),_react2.default.createElement(_terms2.default,{siteId:siteId,taxonomy:taxonomy,onSearch:this.boundOnSearch,onChange:this.boundOnParentChange,query:query,selected:selectedParent}))))}}]);return TermSelectorAddTerm}(_react.Component);TermSelectorAddTerm.initialState={showDialog:false,selectedParent:[],isTopLevel:true,isValid:false,error:null};TermSelectorAddTerm.propTypes={labels:_react.PropTypes.object,postType:_react.PropTypes.string,postId:_react.PropTypes.number,siteId:_react.PropTypes.number,terms:_react.PropTypes.array,taxonomy:_react.PropTypes.string,translate:_react.PropTypes.func};exports.default=(0,_reactRedux.connect)(function(state,ownProps){var taxonomy=ownProps.taxonomy;var postType=ownProps.postType;var siteId=(0,_selectors.getSelectedSiteId)(state);var labels=(0,_get3.default)((0,_selectors2.getPostTypeTaxonomy)(state,siteId,postType,taxonomy),"labels",{});return{terms:(0,_selectors3.getTerms)(state,siteId,taxonomy),labels:labels,siteId:siteId}},{addTermForPost:_actions.addTermForPost})((0,_i18nCalypso.localize)(TermSelectorAddTerm));module.exports=exports["default"]},3099:function(module,exports,__webpack_require__){"use strict";var _assign=__webpack_require__(5);var _assign2=_interopRequireDefault(_assign);var _actions=__webpack_require__(2183);var _selectors=__webpack_require__(47);var _selectors2=__webpack_require__(277);var _actions2=__webpack_require__(285);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ReactDom=__webpack_require__(44),ReactDomServer=__webpack_require__(1800),React=__webpack_require__(1),i18n=__webpack_require__(11),page=__webpack_require__(33),ReduxProvider=__webpack_require__(15).Provider,startsWith=__webpack_require__(83),qs=__webpack_require__(121),isValidUrl=__webpack_require__(2024).isWebUri;var actions=__webpack_require__(1648),PostEditor=__webpack_require__(3173),route=__webpack_require__(132),sites=__webpack_require__(53)(),user=__webpack_require__(48)(),userUtils=__webpack_require__(169),analytics=__webpack_require__(20);function getPostID(context){if(!context.params.post||"new"===context.params.post){return null}return parseInt(context.params.post,10)}function determinePostType(context){if(startsWith(context.path,"/post")){return"post"}if(startsWith(context.path,"/page")){return"page"}return context.params.type}function renderEditor(context,postType){ReactDom.unmountComponentAtNode(document.getElementById("secondary"));ReactDom.render(React.createElement(ReduxProvider,{store:context.store},React.createElement(PostEditor,{user:user,userUtils:userUtils,sites:sites,type:postType})),document.getElementById("primary"))}function maybeRedirect(context){var state=context.store.getState();var siteId=(0,_selectors.getSelectedSiteId)(state);var postId=(0,_selectors2.getEditorPostId)(state);var path=(0,_selectors2.getEditorPath)(state,siteId,postId);if(path!==context.pathname){page.redirect(path);return true}return false}function getPressThisContent(query){var text=query.text;var url=query.url;var title=query.title;var image=query.image;var embed=query.embed;var pieces=[];if(image){pieces.push(ReactDomServer.renderToStaticMarkup(React.createElement("p",null,React.createElement("a",{href:url},React.createElement("img",{src:image})))))}if(isValidUrl(embed)){pieces.push(ReactDomServer.renderToStaticMarkup(React.createElement("p",null,embed)))}if(text){pieces.push(ReactDomServer.renderToStaticMarkup(React.createElement("blockquote",null,text)))}pieces.push(ReactDomServer.renderToStaticMarkup(React.createElement("p",null,i18n.translate("via {{anchor/}}",{components:{anchor:React.createElement("a",{href:url},title)}}))));return pieces.join("\n\n")}module.exports={post:function post(context){var postType=determinePostType(context);var postID=getPostID(context);function startEditing(siteId){context.store.dispatch((0,_actions.setEditorPostId)(postID));context.store.dispatch((0,_actions2.editPost)(siteId,postID,{type:postType}));if(maybeRedirect(context)){return}var gaTitle=void 0;switch(postType){case"post":gaTitle="Post";break;case"page":gaTitle="Page";break;default:gaTitle="Custom Post Type"}if(postID){actions.startEditingExisting(siteId,postID);analytics.pageView.record("/"+postType+"/:blogid/:postid",gaTitle+" > Edit")}else{var postOptions={type:postType};if(context.query.url){var pressThisContent=getPressThisContent(context.query);(0,_assign2.default)(postOptions,{postFormat:"quote",title:context.query.title,content:pressThisContent})}actions.startEditingNew(siteId,postOptions);analytics.pageView.record("/"+postType,gaTitle+" > New")}}function startEditingOnSiteSelected(){var siteId=(0,_selectors.getSelectedSiteId)(context.store.getState());if(siteId){startEditing(siteId)}else{sites.once("change",startEditingOnSiteSelected)}}startEditingOnSiteSelected();renderEditor(context,postType)},pressThis:function pressThis(context,next){context.getSiteSelectionHeaderText=function(){return i18n.translate("Select a site to start writing")};if(!context.query.url){return next()}var currentUser=user.get();if(!currentUser.primarySiteSlug){return next()}var redirectPath=route.addSiteFragment(context.pathname,currentUser.primarySiteSlug);var queryString=qs.stringify(context.query);var redirectWithParams=[redirectPath,queryString].join("?");page.redirect(redirectWithParams);return false}}},3100:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactRedux=__webpack_require__(15);var _i18nCalypso=__webpack_require__(11);var _button=__webpack_require__(69);var _button2=_interopRequireDefault(_button);var _count=__webpack_require__(730);var _count2=_interopRequireDefault(_count);var _queryPostCounts=__webpack_require__(1880);var _queryPostCounts2=_interopRequireDefault(_queryPostCounts);var _selectors=__webpack_require__(47);var _selectors2=__webpack_require__(79);var _selectors3=__webpack_require__(1794);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function EditorDraftsButton(_ref){var count=_ref.count;var onClick=_ref.onClick;var jetpack=_ref.jetpack;var siteId=_ref.siteId;var hideText=_ref.hideText;return _react2.default.createElement(_button2.default,{compact:true,borderless:true,className:"drafts-button",onClick:onClick,disabled:!count&&!jetpack,"aria-label":(0,_i18nCalypso.translate)("View all drafts")},siteId&&_react2.default.createElement(_queryPostCounts2.default,{siteId:siteId,type:"post"}),!hideText&&_react2.default.createElement("span",null,(0,_i18nCalypso.translate)("Drafts")),count&&!jetpack?_react2.default.createElement(_count2.default,{count:count}):null)}EditorDraftsButton.propTypes={count:_react.PropTypes.number,onClick:_react.PropTypes.func,jetpack:_react.PropTypes.bool,siteId:_react.PropTypes.number,hideText:_react.PropTypes.bool};exports.default=(0,_reactRedux.connect)(function(state){var siteId=(0,_selectors.getSelectedSiteId)(state);return{jetpack:(0,_selectors2.isJetpackSite)(state,siteId),count:(0,_selectors3.getAllPostCount)(state,siteId,"post","draft"),siteId:siteId}})(EditorDraftsButton);module.exports=exports["default"]},3101:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var React=__webpack_require__(1),noop=__webpack_require__(38);var actions=__webpack_require__(1648),Button=__webpack_require__(69),FormToggle=__webpack_require__(1964),Revisions=__webpack_require__(3134),Gridicon=__webpack_require__(26),postUtils=__webpack_require__(1649),Popover=__webpack_require__(386),InfoPopover=__webpack_require__(1725),Tooltip=__webpack_require__(722),PostSchedule=__webpack_require__(2226),postScheduleUtils=__webpack_require__(2055),siteUtils=__webpack_require__(208),stats=__webpack_require__(1651);exports.default=React.createClass({displayName:"EditPostStatus",propTypes:{post:React.PropTypes.object,savedPost:React.PropTypes.object,type:React.PropTypes.string,onSave:React.PropTypes.func,onDateChange:React.PropTypes.func,site:React.PropTypes.object},getInitialState:function getInitialState(){return{showTZTooltip:false,showPostSchedulePopover:false,onDateChange:noop}},toggleStickyStatus:function toggleStickyStatus(){var stickyStat,stickyEventLabel;if(!this.props.post.sticky){stickyStat="advanced_sticky_enabled";stickyEventLabel="On"}else{stickyStat="advanced_sticky_disabled";stickyEventLabel="Off"}stats.recordStat(stickyStat);stats.recordEvent("Changed Sticky Setting",stickyEventLabel);actions.edit({sticky:!this.props.post.sticky})},togglePendingStatus:function togglePendingStatus(){var pending=this.props.post.status==="pending";stats.recordStat("status_changed");stats.recordEvent("Changed Pending Status",pending?"Marked Draft":"Marked Pending");actions.edit({status:pending?"draft":"pending"})},togglePostSchedulePopover:function togglePostSchedulePopover(){this.setState({showPostSchedulePopover:!this.state.showPostSchedulePopover})},revertToDraft:function revertToDraft(){this.props.onSave("draft")},showTZTooltip:function showTZTooltip(){this.setState({showTZTooltip:true})},hideTZTooltip:function hideTZTooltip(){this.setState({showTZTooltip:false})},render:function render(){var isSticky,isPublished,isPending,canPublish,isScheduled;if(this.props.post){isSticky=this.props.post.sticky;isPending=postUtils.isPending(this.props.post);isPublished=this.props.savedPost.status==="publish";isScheduled=this.props.savedPost.status==="future";canPublish=siteUtils.userCan("publish_posts",this.props.site)}var adminUrl=this.props.site&&this.props.site.options&&this.props.site.options.admin_url;var fullDate=postScheduleUtils.convertDateToUserLocation(postUtils.getEditedTime(this.props.post)||new Date,siteUtils.timezone(this.props.site),siteUtils.gmtOffset(this.props.site)).format("ll LT");return React.createElement("div",{className:"edit-post-status"},React.createElement("span",{ref:"postStatusTooltip",className:"edit-post-status__full-date",onMouseEnter:this.showTZTooltip,onMouseLeave:this.hideTZTooltip,onClick:this.togglePostSchedulePopover},postUtils.isFutureDated(this.props.savedPost)?React.createElement("span",{className:"edit-post-status__future-label"},this.translate("Future")):React.createElement(Gridicon,{icon:"time",size:18}),fullDate,this.renderTZTooltop(),this.renderPostSchedulePopover()),React.createElement(Revisions,{revisions:this.props.post&&this.props.post.revisions,adminUrl:adminUrl}),this.props.type==="post"&&React.createElement("label",{className:"edit-post-status__sticky"},React.createElement("span",{className:"edit-post-status__label-text"},this.translate("Stick to the front page"),React.createElement(InfoPopover,{position:"top right",gaEventCategory:"Editor",popoverName:"Sticky Post"},this.translate("Sticky posts will appear at the top of the posts listing."))),React.createElement(FormToggle,{checked:isSticky,onChange:this.toggleStickyStatus,"aria-label":this.translate("Stick post to the front page")})),!isPublished&&!isScheduled&&canPublish&&React.createElement("label",{className:"edit-post-status__pending-review"},React.createElement("span",{className:"edit-post-status__label-text"},this.translate("Pending review"),React.createElement(InfoPopover,{position:"top right"},this.translate("Flag this post to be reviewed for approval."))),React.createElement(FormToggle,{checked:isPending,onChange:this.togglePendingStatus,"aria-label":this.translate("Request review for post")})),(isPublished||isScheduled||isPending&&!canPublish)&&React.createElement(Button,{className:"edit-post-status__revert-to-draft",onClick:this.revertToDraft,compact:true},React.createElement(Gridicon,{icon:"undo",size:18})," ",this.translate("Revert to draft")))},renderPostSchedulePopover:function renderPostSchedulePopover(){var tz=siteUtils.timezone(this.props.site),gmt=siteUtils.gmtOffset(this.props.site),selectedDay=this.props.post&&this.props.post.date?this.moment(this.props.post.date):null;return React.createElement(Popover,{context:this.refs&&this.refs.postStatusTooltip,isVisible:this.state.showPostSchedulePopover,position:"right",onClose:this.togglePostSchedulePopover},React.createElement("div",{className:"edit-post-status__post-schedule"},React.createElement(PostSchedule,{selectedDay:selectedDay,timezone:tz,gmtOffset:gmt,onDateChange:this.props.onDateChange})))},renderTZTooltop:function renderTZTooltop(){var timezone=siteUtils.timezone(this.props.site),gmtOffset=siteUtils.gmtOffset(this.props.site);if(!(timezone||postScheduleUtils.isValidGMTOffset(gmtOffset))){return}if(this.state.showPostSchedulePopover){return}return React.createElement(Tooltip,{context:this.refs&&this.refs.postStatusTooltip,isVisible:this.state.showTZTooltip,position:"right",onClose:noop},React.createElement("div",{className:"edit-post-status__full-date__tooltip"},timezone?timezone+" ":"UTC",postScheduleUtils.getLocalizedDate(postUtils.getEditedTime(this.props.post),timezone,gmtOffset).format("Z")))}});module.exports=exports["default"]},3102:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _editorAuthor=__webpack_require__(3104);var _editorAuthor2=_interopRequireDefault(_editorAuthor);var _editorDeletePost=__webpack_require__(3106);var _editorDeletePost2=_interopRequireDefault(_editorDeletePost);var _editorPostType=__webpack_require__(3132);var _editorPostType2=_interopRequireDefault(_editorPostType);var _editorSticky=__webpack_require__(3145);var _editorSticky2=_interopRequireDefault(_editorSticky);var _editorVisibility=__webpack_require__(3148);var _editorVisibility2=_interopRequireDefault(_editorVisibility);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _utils=__webpack_require__(1649);var _utils2=_interopRequireDefault(_utils);var _tooltip=__webpack_require__(722);var _tooltip2=_interopRequireDefault(_tooltip);var _button=__webpack_require__(69);var _button2=_interopRequireDefault(_button);var _viewLabel=__webpack_require__(3103);var _viewLabel2=_interopRequireDefault(_viewLabel);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"EditorActionBar",propTypes:{isNew:_react2.default.PropTypes.bool,onTrashingPost:_react2.default.PropTypes.func,onPrivatePublish:_react2.default.PropTypes.func,post:_react2.default.PropTypes.object,savedPost:_react2.default.PropTypes.object,site:_react2.default.PropTypes.object,
type:_react2.default.PropTypes.string},getInitialState:function getInitialState(){return{viewLinkTooltip:false}},renderPostVisibility:function renderPostVisibility(){if(!this.props.post){return}var _ref=this.props.post||{};var status=_ref.status;var password=_ref.password;var type=_ref.type;var isPrivateSite=this.props.site&&this.props.site.is_private;var savedStatus=this.props.savedPost?this.props.savedPost.status:null;var savedPassword=this.props.savedPost?this.props.savedPost.password:null;var props={visibility:_utils2.default.getVisibility(this.props.post),onPrivatePublish:this.props.onPrivatePublish,isPrivateSite:isPrivateSite,type:type,status:status,password:password,savedStatus:savedStatus,savedPassword:savedPassword};return _react2.default.createElement(_editorVisibility2.default,props)},render:function render(){var _this=this;var multiUserSite=this.props.site&&!this.props.site.single_user_site;return _react2.default.createElement("div",{className:"editor-action-bar"},_react2.default.createElement("div",{className:"editor-action-bar__first-group"},multiUserSite&&_react2.default.createElement(_editorAuthor2.default,{post:this.props.post,isNew:this.props.isNew})),_react2.default.createElement(_editorPostType2.default,null),_react2.default.createElement("div",{className:"editor-action-bar__last-group"},this.props.post&&this.props.type==="post"&&_react2.default.createElement(_editorSticky2.default,{post:this.props.post}),this.renderPostVisibility(),_react2.default.createElement(_editorDeletePost2.default,{post:this.props.post,onTrashingPost:this.props.onTrashingPost}),_utils2.default.isPublished(this.props.savedPost)&&_react2.default.createElement(_button2.default,{href:this.props.savedPost.URL,target:"_blank",rel:"noopener noreferrer",onMouseEnter:function onMouseEnter(){return _this.setState({viewLinkTooltip:true})},onMouseLeave:function onMouseLeave(){return _this.setState({viewLinkTooltip:false})},ref:"viewLink",borderless:true},_react2.default.createElement(_gridicon2.default,{icon:"external"}),_react2.default.createElement(_tooltip2.default,{className:"editor-action-bar__view-post-tooltip",context:this.refs&&this.refs.viewLink,isVisible:this.state.viewLinkTooltip,position:"bottom left"},_react2.default.createElement(_viewLabel2.default,null)))))}});module.exports=exports["default"]},3103:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _assign=__webpack_require__(5);var _assign2=_interopRequireDefault(_assign);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactRedux=__webpack_require__(15);var _i18nCalypso=__webpack_require__(11);var _formatting=__webpack_require__(81);var _selectors=__webpack_require__(112);var _selectors2=__webpack_require__(47);var _selectors3=__webpack_require__(277);var _selectors4=__webpack_require__(390);var _queryPostTypes=__webpack_require__(726);var _queryPostTypes2=_interopRequireDefault(_queryPostTypes);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function EditorActionBarViewLabel(_ref){var translate=_ref.translate;var siteId=_ref.siteId;var typeSlug=_ref.typeSlug;var type=_ref.type;var label=void 0;if("page"===typeSlug){label=translate("View page")}else if("post"===typeSlug){label=translate("View post")}else if(type){label=(0,_formatting.decodeEntities)(type.labels.view_item)}else{label=translate("View",{context:"verb"})}return _react2.default.createElement("span",{className:"editor-action-bar__view-label"},siteId&&"page"!==typeSlug&&"post"!==typeSlug&&_react2.default.createElement(_queryPostTypes2.default,{siteId:siteId}),label)}EditorActionBarViewLabel.propTypes={translate:_react.PropTypes.func,siteId:_react.PropTypes.number,typeSlug:_react.PropTypes.string,type:_react.PropTypes.object};exports.default=(0,_reactRedux.connect)(function(state){var siteId=(0,_selectors2.getSelectedSiteId)(state);var props={siteId:siteId};var post=(0,_selectors.getEditedPost)(state,siteId,(0,_selectors3.getEditorPostId)(state));if(!post){return props}return(0,_assign2.default)(props,{typeSlug:post.type,type:(0,_selectors4.getPostType)(state,siteId,post.type)})})((0,_i18nCalypso.localize)(EditorActionBarViewLabel));module.exports=exports["default"]},3104:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var React=__webpack_require__(1);var Gravatar=__webpack_require__(710),user=__webpack_require__(48)(),AuthorSelector=__webpack_require__(1872),PostActions=__webpack_require__(1648),touchDetect=__webpack_require__(216),sites=__webpack_require__(53)(),stats=__webpack_require__(1651);exports.default=React.createClass({displayName:"EditorAuthor",propTypes:{post:React.PropTypes.object,isNew:React.PropTypes.bool},render:function render(){var post=this.props.post;if(!post&&!this.props.isNew){return this.renderPlaceholder()}var author=post&&post.author?post.author:user.get();var name=author.display_name||author.name;var Wrapper=this.userCanAssignAuthor()?AuthorSelector:"div";var popoverPosition=touchDetect.hasTouch()?"bottom right":"bottom left";return React.createElement("div",{className:"editor-author"},React.createElement(Wrapper,{siteId:this.props.post.site_ID,onSelect:this.onSelect,popoverPosition:popoverPosition},React.createElement(Gravatar,{size:26,user:author}),React.createElement("span",{className:"editor-author__name"},this.translate("by %(name)s",{args:{name:name}}))))},renderPlaceholder:function renderPlaceholder(){return React.createElement("div",{className:"editor-author is-placeholder"},React.createElement(Gravatar,{size:26}),React.createElement("span",{className:"editor-author__name"}))},onSelect:function onSelect(author){stats.recordStat("advanced_author_changed");stats.recordEvent("Changed Author");PostActions.edit({author:author})},userCanAssignAuthor:function userCanAssignAuthor(){var post=this.props.post,reassignCapability="edit_others_"+post.type+"s",site=sites.getSite(this.props.post.site_ID);if(!site||!site.capabilities||!site.capabilities[reassignCapability]){return false}return true}});module.exports=exports["default"]},3105:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.EditorCategoriesTagsAccordion=undefined;var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _toArray2=__webpack_require__(401);var _toArray3=_interopRequireDefault(_toArray2);var _get2=__webpack_require__(24);var _get3=_interopRequireDefault(_get2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactRedux=__webpack_require__(15);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _i18nCalypso=__webpack_require__(11);var _accordion=__webpack_require__(1779);var _accordion2=_interopRequireDefault(_accordion);var _section=__webpack_require__(1759);var _section2=_interopRequireDefault(_section);var _label=__webpack_require__(1915);var _label2=_interopRequireDefault(_label);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _editorTermSelector=__webpack_require__(2342);var _editorTermSelector2=_interopRequireDefault(_editorTermSelector);var _termTokenField=__webpack_require__(2346);var _termTokenField2=_interopRequireDefault(_termTokenField);var _unescape=__webpack_require__(3522);var _unescape2=_interopRequireDefault(_unescape);var _notice=__webpack_require__(76);var _notice2=_interopRequireDefault(_notice);var _noticeAction=__webpack_require__(134);var _noticeAction2=_interopRequireDefault(_noticeAction);var _route=__webpack_require__(132);var _selectors=__webpack_require__(47);var _selectors2=__webpack_require__(277);var _selectors3=__webpack_require__(112);var _selectors4=__webpack_require__(79);var _selectors5=__webpack_require__(1742);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var EditorCategoriesTagsAccordion=exports.EditorCategoriesTagsAccordion=function(_Component){(0,_inherits3.default)(EditorCategoriesTagsAccordion,_Component);function EditorCategoriesTagsAccordion(){(0,_classCallCheck3.default)(this,EditorCategoriesTagsAccordion);return(0,_possibleConstructorReturn3.default)(this,(EditorCategoriesTagsAccordion.__proto__||(0,_getPrototypeOf2.default)(EditorCategoriesTagsAccordion)).apply(this,arguments))}(0,_createClass3.default)(EditorCategoriesTagsAccordion,[{key:"renderJetpackNotice",value:function renderJetpackNotice(){var _props=this.props;var translate=_props.translate;var siteSlug=_props.siteSlug;return _react2.default.createElement(_notice2.default,{status:"is-warning",showDismiss:false,text:translate("You must update Jetpack to use this feature."),className:"editor-categories-tags__upgrade-notice"},_react2.default.createElement(_noticeAction2.default,{href:(0,_route.addSiteFragment)("/plugins/jetpack",siteSlug)},translate("Update Now")))}},{key:"renderCategories",value:function renderCategories(){var _props2=this.props;var translate=_props2.translate;var postType=_props2.postType;var isTermsSupported=_props2.isTermsSupported;if(postType==="page"){return}return _react2.default.createElement(_section2.default,null,_react2.default.createElement(_label2.default,{helpText:translate("Use categories to group your posts by topic."),labelText:translate("Categories")}),isTermsSupported?_react2.default.createElement(_editorTermSelector2.default,{taxonomyName:"category"}):this.renderJetpackNotice())}},{key:"renderTags",value:function renderTags(){var _props3=this.props;var isTermsSupported=_props3.isTermsSupported;var postType=_props3.postType;var translate=_props3.translate;var helpText=postType==="page"?translate("Use tags to associate more specific keywords with your pages."):translate("Use tags to associate more specific keywords with your posts.");return _react2.default.createElement(_section2.default,null,_react2.default.createElement(_label2.default,{helpText:helpText,labelText:translate("Tags")},isTermsSupported?_react2.default.createElement(_termTokenField2.default,{taxonomyName:"post_tag"}):this.renderJetpackNotice()))}},{key:"getCategoriesSubtitle",value:function getCategoriesSubtitle(){var _props4=this.props;var translate=_props4.translate;var postTerms=_props4.postTerms;var defaultCategory=_props4.defaultCategory;var categories=(0,_toArray3.default)((0,_get3.default)(postTerms,"category"));if(categories.length>1){return translate("%d category","%d categories",{args:[categories.length],count:categories.length})}var category=void 0;if(categories.length>0){category=categories[0]}else{category=defaultCategory}if(category){return(0,_unescape2.default)(category.name)}}},{key:"getTagsSubtitle",value:function getTagsSubtitle(){var _props5=this.props;var translate=_props5.translate;var postTerms=_props5.postTerms;var tags=(0,_toArray3.default)((0,_get3.default)(postTerms,"post_tag"));var tagsLength=tags.length;switch(tagsLength){case 0:return null;case 1:case 2:return tags.map(function(tag){return"#"+(0,_unescape2.default)(tag.name||tag)}).join(", ");default:return translate("%d tag","%d tags",{args:[tagsLength],count:tagsLength})}}},{key:"getSubtitle",value:function getSubtitle(){var subtitlePieces=[];var _props6=this.props;var postType=_props6.postType;var siteId=_props6.siteId;if(!siteId){return null}if(postType==="post"){var categoriesSubtitle=this.getCategoriesSubtitle();if(categoriesSubtitle){subtitlePieces.push(categoriesSubtitle)}}var tagsSubtitle=this.getTagsSubtitle();if(tagsSubtitle){subtitlePieces.push(tagsSubtitle)}return subtitlePieces.join(", ")}},{key:"getTitle",value:function getTitle(){var _props7=this.props;var translate=_props7.translate;var postType=_props7.postType;var title=void 0;if(postType==="page"){title=translate("Tags")}else{title=translate("Categories & Tags")}return title}},{key:"render",value:function render(){var classes=(0,_classnames2.default)("editor-drawer__accordion","editor-categories-tags__accordion",this.props.className);return _react2.default.createElement(_accordion2.default,{title:this.getTitle(),subtitle:this.getSubtitle(),icon:_react2.default.createElement(_gridicon2.default,{icon:"tag"}),className:classes},this.renderCategories(),this.renderTags())}}]);return EditorCategoriesTagsAccordion}(_react.Component);EditorCategoriesTagsAccordion.propTypes={translate:_react.PropTypes.func,postTerms:_react.PropTypes.object,postType:_react.PropTypes.string,defaultCategory:_react.PropTypes.object,isTermsSupported:_react.PropTypes.bool,siteSlug:_react.PropTypes.string};exports.default=(0,_reactRedux.connect)(function(state){var siteId=(0,_selectors.getSelectedSiteId)(state);var postId=(0,_selectors2.getEditorPostId)(state);var defaultCategoryId=(0,_selectors4.getSiteOption)(state,siteId,"default_category");var isTermsSupported=false!==(0,_selectors4.isJetpackMinimumVersion)(state,siteId,"4.1.0");return{defaultCategory:(0,_selectors5.getTerm)(state,siteId,"category",defaultCategoryId),postTerms:(0,_selectors3.getEditedPostValue)(state,siteId,postId,"terms"),postType:(0,_selectors3.getEditedPostValue)(state,siteId,postId,"type"),siteSlug:(0,_selectors4.getSiteSlug)(state,siteId),siteId:siteId,postId:postId,isTermsSupported:isTermsSupported}})((0,_i18nCalypso.localize)(EditorCategoriesTagsAccordion))},3106:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _actions=__webpack_require__(1648);var _actions2=_interopRequireDefault(_actions);var _accept=__webpack_require__(397);var _accept2=_interopRequireDefault(_accept);var _utils=__webpack_require__(1649);var _utils2=_interopRequireDefault(_utils);var _button=__webpack_require__(69);var _button2=_interopRequireDefault(_button);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _tooltip=__webpack_require__(722);var _tooltip2=_interopRequireDefault(_tooltip);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"EditorDeletePost",propTypes:{site:_react2.default.PropTypes.object,post:_react2.default.PropTypes.object,onTrashingPost:_react2.default.PropTypes.func},getInitialState:function getInitialState(){return{isTrashing:false,tooltip:false}},sendToTrash:function sendToTrash(){this.setState({isTrashing:true});var handleTrashingPost=function(error){if(error){this.setState({isTrashing:false})}this.props.onTrashingPost(error)}.bind(this);if(_utils2.default.userCan("delete_post",this.props.post)){_actions2.default.trash(this.props.post,handleTrashingPost)}},onSendToTrash:function onSendToTrash(){var _this=this;var message=void 0;if(this.state.isTrashing){return}if(this.props.post.type==="page"){message=this.translate("Are you sure you want to trash this page?")}else{message=this.translate("Are you sure you want to trash this post?")}(0,_accept2.default)(message,function(accepted){if(accepted){_this.sendToTrash()}},this.translate("Move to trash"),this.translate("Back"))},render:function render(){var _this2=this;var post=this.props.post;if(!post||!post.ID||post.status==="trash"){return null}var classes=(0,_classnames2.default)("editor-delete-post",{"is-trashing":this.state.isTrashing});var tooltipText=this.translate("Send post to the trash");if(post.type==="page"){tooltipText=this.translate("Send page to the trash")}return _react2.default.createElement(_button2.default,{borderless:true,className:classes,onClick:this.onSendToTrash,onMouseEnter:function onMouseEnter(){return _this2.setState({tooltip:true})},onMouseLeave:function onMouseLeave(){return _this2.setState({tooltip:false})},"aria-label":tooltipText,ref:"deletePostTooltip"},_react2.default.createElement(_gridicon2.default,{icon:"trash"}),_react2.default.createElement(_tooltip2.default,{className:"editor-delete-post__tooltip",context:this.refs&&this.refs.deletePostTooltip,isVisible:this.state.tooltip,position:"bottom left"},tooltipText))}});module.exports=exports["default"]},3107:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var React=__webpack_require__(1),pick=__webpack_require__(91);var EditorFieldset=__webpack_require__(2341),FormCheckbox=__webpack_require__(1654),PostActions=__webpack_require__(1648),InfoPopover=__webpack_require__(1725),stats=__webpack_require__(1651);function booleanToStatus(bool){return bool?"open":"closed"}function statusToBoolean(status){return"open"===status}exports.default=React.createClass({displayName:"EditorDiscussion",propTypes:{isNew:React.PropTypes.bool,post:React.PropTypes.object,site:React.PropTypes.object},getDefaultProps:function getDefaultProps(){return{isNew:false}},getDiscussionSetting:function getDiscussionSetting(){if(this.props.post&&this.props.post.discussion){return this.props.post.discussion}if(this.props.site&&this.props.isNew){return{comment_status:booleanToStatus(this.props.site.options.default_comment_status),ping_status:booleanToStatus(this.props.site.options.default_ping_status)}}return{}},onChange:function onChange(event){var discussion=pick(this.getDiscussionSetting(),"comment_status","ping_status"),newStatus=booleanToStatus(event.target.checked),discussionType=event.target.name,statName,gaEvent;discussion[discussionType]=newStatus;if("comment_status"===discussionType){statName=event.target.checked?"advanced_comments_open_enabled":"advanced_comments_open_disabled";gaEvent="Comment status changed"}else{statName=event.target.checked?"advanced_pings_open_enabled":"advanced_pings_open_disabled";gaEvent="Trackback status changed"}stats.recordStat(statName);stats.recordEvent(gaEvent,newStatus);PostActions.edit({discussion:discussion})},render:function render(){var discussion=this.getDiscussionSetting();return React.createElement(EditorFieldset,{legend:this.translate("Discussion")},React.createElement("label",null,React.createElement(FormCheckbox,{name:"comment_status",checked:statusToBoolean(discussion.comment_status),disabled:!this.props.post,onChange:this.onChange}),React.createElement("span",null,this.translate("Allow comments"),React.createElement(InfoPopover,{position:"top right",className:"editor-comment_status__info",gaEventCategory:"Editor",popoverName:"CommentStatus"},this.translate("Provide a comment section to give readers the ability to respond.")))),React.createElement("label",null,React.createElement(FormCheckbox,{name:"ping_status",checked:statusToBoolean(discussion.ping_status),disabled:!this.props.post,onChange:this.onChange}),React.createElement("span",null,this.translate("Allow Pingbacks & Trackbacks"))))}});module.exports=exports["default"]},3108:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactRedux=__webpack_require__(15);var _i18nCalypso=__webpack_require__(11);var _documentHead=__webpack_require__(721);var _documentHead2=_interopRequireDefault(_documentHead);var _queryPostTypes=__webpack_require__(726);var _queryPostTypes2=_interopRequireDefault(_queryPostTypes);var _selectors=__webpack_require__(47);var _selectors2=__webpack_require__(277);var _selectors3=__webpack_require__(112);var _selectors4=__webpack_require__(390);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function EditorDocumentHead(_ref){var translate=_ref.translate;var siteId=_ref.siteId;var type=_ref.type;var typeObject=_ref.typeObject;var newPost=_ref.newPost;var title=void 0;if("post"===type){if(newPost){title=translate("New Post",{textOnly:true})}else{title=translate("Edit Post",{textOnly:true})}}else if("page"===type){if(newPost){title=translate("New Page",{textOnly:true})}else{title=translate("Edit Page",{textOnly:true})}}else if(newPost){if(typeObject){title=typeObject.labels.new_item}else{title=translate("New",{textOnly:true})}}else if(typeObject){title=typeObject.labels.edit_item}else{title=translate("Edit",{context:"verb",textOnly:true})}return _react2.default.createElement("div",null,siteId&&"page"!==type&&"post"!==type&&_react2.default.createElement(_queryPostTypes2.default,{siteId:siteId}),_react2.default.createElement(_documentHead2.default,{title:title}))}EditorDocumentHead.propTypes={translate:_react.PropTypes.func,siteId:_react.PropTypes.number,type:_react.PropTypes.string,typeObject:_react.PropTypes.object,newPost:_react.PropTypes.bool};exports.default=(0,_reactRedux.connect)(function(state){var siteId=(0,_selectors.getSelectedSiteId)(state);var postId=(0,_selectors2.getEditorPostId)(state);var type=(0,_selectors3.getEditedPostValue)(state,siteId,postId,"type");return{siteId:siteId,type:type,typeObject:(0,_selectors4.getPostType)(state,siteId,type),newPost:(0,_selectors2.isEditorNewPost)(state)}})((0,_i18nCalypso.localize)(EditorDocumentHead));module.exports=exports["default"]},3109:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _i18nCalypso=__webpack_require__(11);var _actions=__webpack_require__(1648);var _actions2=_interopRequireDefault(_actions);var _stats=__webpack_require__(1651);var stats=_interopRequireWildcard(_stats);var _utils=__webpack_require__(1649);var _accordion=__webpack_require__(1779);var _accordion2=_interopRequireDefault(_accordion);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _editorDrawerWell=__webpack_require__(2339);var _editorDrawerWell2=_interopRequireDefault(_editorDrawerWell);var _editorFeaturedImage=__webpack_require__(2340);var _editorFeaturedImage2=_interopRequireDefault(_editorFeaturedImage);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var EditorDrawerFeaturedImage=function(_Component){(0,_inherits3.default)(EditorDrawerFeaturedImage,_Component);function EditorDrawerFeaturedImage(props){(0,_classCallCheck3.default)(this,EditorDrawerFeaturedImage);var _this=(0,_possibleConstructorReturn3.default)(this,(EditorDrawerFeaturedImage.__proto__||(0,_getPrototypeOf2.default)(EditorDrawerFeaturedImage)).call(this,props));_this.startSelecting=function(){return _this.setState({isSelecting:true})};_this.endSelecting=function(){return _this.setState({isSelecting:false})};_this.state={isSelecting:false};return _this}(0,_createClass3.default)(EditorDrawerFeaturedImage,[{key:"removeImage",value:function removeImage(){_actions2.default.edit({featured_image:""});stats.recordStat("featured_image_removed");stats.recordEvent("Featured image removed")}},{key:"render",value:function render(){var _props=this.props;var translate=_props.translate;var site=_props.site;var post=_props.post;return _react2.default.createElement(_accordion2.default,{title:translate("Featured Image"),icon:_react2.default.createElement(_gridicon2.default,{icon:"image"})},_react2.default.createElement(_editorDrawerWell2.default,{icon:"image",label:translate("Set Featured Image"),empty:!site||!post||!(0,_utils.getFeaturedImageId)(post),onClick:this.startSelecting,onRemove:this.removeImage},_react2.default.createElement(_editorFeaturedImage2.default,{selecting:this.state.isSelecting,onImageSelected:this.endSelecting,site:site,post:post})))}}]);return EditorDrawerFeaturedImage}(_react.Component);EditorDrawerFeaturedImage.propTypes={site:_react.PropTypes.object,post:_react.PropTypes.object,translate:_react.PropTypes.func};exports.default=(0,_i18nCalypso.localize)(EditorDrawerFeaturedImage);module.exports=exports["default"]},3110:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactAddonsCreateFragment=__webpack_require__(745);var _reactAddonsCreateFragment2=_interopRequireDefault(_reactAddonsCreateFragment);var _reactRedux=__webpack_require__(15);var _accordion=__webpack_require__(1779);var _accordion2=_interopRequireDefault(_accordion);var _section=__webpack_require__(1759);var _section2=_interopRequireDefault(_section);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _accordion3=__webpack_require__(3105);var _accordion4=_interopRequireDefault(_accordion3);var _accordion5=__webpack_require__(3136);var _accordion6=_interopRequireDefault(_accordion5);var _formTextarea=__webpack_require__(1668);var _formTextarea2=_interopRequireDefault(_formTextarea);var _postFormatsData=__webpack_require__(2495);var _postFormatsData2=_interopRequireDefault(_postFormatsData);var _accordion7=__webpack_require__(3129);var _accordion8=_interopRequireDefault(_accordion7);var _editorLocation=__webpack_require__(3117);var _editorLocation2=_interopRequireDefault(_editorLocation);var _editorDiscussion=__webpack_require__(3107);var _editorDiscussion2=_interopRequireDefault(_editorDiscussion);var _editorSeoAccordion=__webpack_require__(3135);var _editorSeoAccordion2=_interopRequireDefault(_editorSeoAccordion);var _slug=__webpack_require__(3122);var _slug2=_interopRequireDefault(_slug);var _postMetadata=__webpack_require__(759);var _postMetadata2=_interopRequireDefault(_postMetadata);var _trackInputChanges=__webpack_require__(1782);var _trackInputChanges2=_interopRequireDefault(_trackInputChanges);var _actions=__webpack_require__(1648);var _actions2=_interopRequireDefault(_actions);var _stats=__webpack_require__(1651);var _utils=__webpack_require__(208);var _utils2=_interopRequireDefault(_utils);var _productsValues=__webpack_require__(62);var _queryPostTypes=__webpack_require__(726);var _queryPostTypes2=_interopRequireDefault(_queryPostTypes);var _selectors=__webpack_require__(47);var _selectors2=__webpack_require__(277);var _selectors3=__webpack_require__(112);var _selectors4=__webpack_require__(390);var _selectors5=__webpack_require__(79);var _config=__webpack_require__(12);var _config2=_interopRequireDefault(_config);var _featuredImage=__webpack_require__(3109);var _featuredImage2=_interopRequireDefault(_featuredImage);var _taxonomies=__webpack_require__(3112);var _taxonomies2=_interopRequireDefault(_taxonomies);var _pageOptions=__webpack_require__(3111);var _pageOptions2=_interopRequireDefault(_pageOptions);var _label=__webpack_require__(1915);var _label2=_interopRequireDefault(_label);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var POST_TYPE_SUPPORTS={post:{thumbnail:true,excerpt:true,"post-formats":true,"geo-location":true,tags:true,comments:true},page:{thumbnail:true,"page-attributes":true,"geo-location":true,excerpt:true,comments:true}};var EditorDrawer=_react2.default.createClass({displayName:"EditorDrawer",propTypes:{site:_react2.default.PropTypes.object,post:_react2.default.PropTypes.object,canJetpackUseTaxonomies:_react2.default.PropTypes.bool,typeObject:_react2.default.PropTypes.object,isNew:_react2.default.PropTypes.bool,type:_react2.default.PropTypes.string},onExcerptChange:function onExcerptChange(event){_actions2.default.edit({excerpt:event.target.value})},currentPostTypeSupports:function currentPostTypeSupports(feature){var _props=this.props;var typeObject=_props.typeObject;var type=_props.type;if(typeObject&&typeObject.supports){return!!typeObject.supports[feature]}if(POST_TYPE_SUPPORTS.hasOwnProperty(type)){return!!POST_TYPE_SUPPORTS[type][feature]}return true},recordExcerptChangeStats:function recordExcerptChangeStats(){(0,_stats.recordStat)("excerpt_changed");(0,_stats.recordEvent)("Changed Excerpt")},renderTaxonomies:function renderTaxonomies(){var _props2=this.props;var type=_props2.type;var canJetpackUseTaxonomies=_props2.canJetpackUseTaxonomies;var isCustomTypesEnabled=_config2.default.isEnabled("manage/custom-post-types");var typeSupportsTags=!isCustomTypesEnabled&&this.currentPostTypeSupports("tags");var categories=void 0;if("post"===type||typeSupportsTags){categories=_react2.default.createElement(_accordion4.default,null)}var taxonomies=void 0;if(isCustomTypesEnabled&&false!==canJetpackUseTaxonomies){taxonomies=_react2.default.createElement(_taxonomies2.default,null)}return(0,_reactAddonsCreateFragment2.default)({categories:categories,taxonomies:taxonomies})},renderPostFormats:function renderPostFormats(){if(!this.props.site||!this.props.post||!this.currentPostTypeSupports("post-formats")){return}return _react2.default.createElement(_postFormatsData2.default,{siteId:this.props.site.ID},_react2.default.createElement(_accordion8.default,{site:this.props.site,post:this.props.post,className:"editor-drawer__accordion"}))},renderSharing:function renderSharing(){return _react2.default.createElement(_accordion6.default,{site:this.props.site,post:this.props.post})},renderFeaturedImage:function renderFeaturedImage(){if(!this.currentPostTypeSupports("thumbnail")){return}return _react2.default.createElement(_featuredImage2.default,{site:this.props.site,post:this.props.post})},renderExcerpt:function renderExcerpt(){var excerpt=void 0;if(!this.currentPostTypeSupports("excerpt")){return}if(this.props.post){excerpt=this.props.post.excerpt}return _react2.default.createElement(_section2.default,null,_react2.default.createElement(_label2.default,{labelText:this.translate("Excerpt"),helpText:this.translate("Excerpts are optional hand-crafted summaries of your content.")},_react2.default.createElement(_trackInputChanges2.default,{onNewValue:this.recordExcerptChangeStats},_react2.default.createElement(_formTextarea2.default,{id:"excerpt",name:"excerpt",onChange:this.onExcerptChange,value:excerpt,placeholder:this.translate("Write an excerpt"),"aria-label":this.translate("Write an excerpt")}))))},renderLocation:function renderLocation(){if(!this.props.site||this.props.site.jetpack){return}if(!this.currentPostTypeSupports("geo-location")){return}return _react2.default.createElement(_section2.default,null,_react2.default.createElement(_label2.default,{labelText:this.translate("Location")}),_react2.default.createElement(_editorLocation2.default,{coordinates:_postMetadata2.default.geoCoordinates(this.props.post)}))},renderDiscussion:function renderDiscussion(){if(!this.currentPostTypeSupports("comments")){return}return _react2.default.createElement(_section2.default,null,_react2.default.createElement(_editorDiscussion2.default,{site:this.props.site,post:this.props.post,isNew:this.props.isNew}))},renderSeo:function renderSeo(){if(!_config2.default.isEnabled("manage/advanced-seo")||!this.props.site){return}var plan=this.props.site.plan;
var hasBusinessPlan=(0,_productsValues.isBusiness)(plan)||(0,_productsValues.isEnterprise)(plan);if(!hasBusinessPlan){return}return _react2.default.createElement(_editorSeoAccordion2.default,{metaDescription:_postMetadata2.default.metaDescription(this.props.post)})},renderMoreOptions:function renderMoreOptions(){if(!this.currentPostTypeSupports("excerpt")&&!this.currentPostTypeSupports("geo-location")&&!this.currentPostTypeSupports("comments")&&!_utils2.default.isPermalinkEditable(this.props.site)){return}return _react2.default.createElement(_accordion2.default,{title:this.translate("More Options"),icon:_react2.default.createElement(_gridicon2.default,{icon:"ellipsis"}),className:"editor-drawer__more-options"},_utils2.default.isPermalinkEditable(this.props.site)&&_react2.default.createElement(_slug2.default,null),this.renderExcerpt(),this.renderLocation(),this.renderDiscussion())},renderPageOptions:function renderPageOptions(){if(!this.currentPostTypeSupports("page-attributes")){return}return _react2.default.createElement(_pageOptions2.default,null)},render:function render(){var site=this.props.site;return _react2.default.createElement("div",{className:"editor-drawer"},site&&_react2.default.createElement(_queryPostTypes2.default,{siteId:site.ID}),this.renderTaxonomies(),this.renderFeaturedImage(),this.renderPageOptions(),this.renderSharing(),this.renderPostFormats(),this.renderSeo(),this.renderMoreOptions())}});exports.default=(0,_reactRedux.connect)(function(state){var siteId=(0,_selectors.getSelectedSiteId)(state);var type=(0,_selectors3.getEditedPostValue)(state,siteId,(0,_selectors2.getEditorPostId)(state),"type");return{canJetpackUseTaxonomies:(0,_selectors5.isJetpackMinimumVersion)(state,siteId,"4.1"),typeObject:(0,_selectors4.getPostType)(state,siteId,type)}},null,null,{pure:false})(EditorDrawer);module.exports=exports["default"]},3111:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _get2=__webpack_require__(24);var _get3=_interopRequireDefault(_get2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactRedux=__webpack_require__(15);var _i18nCalypso=__webpack_require__(11);var _selectors=__webpack_require__(47);var _selectors2=__webpack_require__(112);var _selectors3=__webpack_require__(277);var _selectors4=__webpack_require__(390);var _editorPageParent=__webpack_require__(3125);var _editorPageParent2=_interopRequireDefault(_editorPageParent);var _editorPageTemplates=__webpack_require__(3127);var _editorPageTemplates2=_interopRequireDefault(_editorPageTemplates);var _editorPageOrder=__webpack_require__(3124);var _editorPageOrder2=_interopRequireDefault(_editorPageOrder);var _accordion=__webpack_require__(1779);var _accordion2=_interopRequireDefault(_accordion);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function EditorDrawerPageOptions(_ref){var translate=_ref.translate;var postType=_ref.postType;var hierarchical=_ref.hierarchical;var title=void 0;if("page"===postType){title=translate("Page Attributes")}else{title=translate("Attributes")}return _react2.default.createElement(_accordion2.default,{title:title,icon:_react2.default.createElement(_gridicon2.default,{icon:"pages"})},hierarchical&&_react2.default.createElement(_editorPageParent2.default,null),_react2.default.createElement(_editorPageTemplates2.default,null),_react2.default.createElement(_editorPageOrder2.default,null))}exports.default=(0,_reactRedux.connect)(function(state){var siteId=(0,_selectors.getSelectedSiteId)(state);var postId=(0,_selectors3.getEditorPostId)(state);var postType=(0,_selectors2.getEditedPostValue)(state,siteId,postId,"type");var hierarchical="page"===postType||(0,_get3.default)((0,_selectors4.getPostType)(state,siteId,postType),"hierarchical");return{postType:postType,hierarchical:hierarchical}})((0,_i18nCalypso.localize)(EditorDrawerPageOptions));module.exports=exports["default"]},3112:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _includes2=__webpack_require__(30);var _includes3=_interopRequireDefault(_includes2);var _get2=__webpack_require__(24);var _get3=_interopRequireDefault(_get2);var _map2=__webpack_require__(45);var _map3=_interopRequireDefault(_map2);var _size2=__webpack_require__(769);var _size3=_interopRequireDefault(_size2);var _reduce2=__webpack_require__(117);var _reduce3=_interopRequireDefault(_reduce2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactRedux=__webpack_require__(15);var _i18nCalypso=__webpack_require__(11);var _formatting=__webpack_require__(81);var _queryTaxonomies=__webpack_require__(2505);var _queryTaxonomies2=_interopRequireDefault(_queryTaxonomies);var _selectors=__webpack_require__(47);var _selectors2=__webpack_require__(277);var _selectors3=__webpack_require__(112);var _selectors4=__webpack_require__(2010);var _selectors5=__webpack_require__(79);var _accordion=__webpack_require__(1779);var _accordion2=_interopRequireDefault(_accordion);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _termTokenField=__webpack_require__(2346);var _termTokenField2=_interopRequireDefault(_termTokenField);var _editorTermSelector=__webpack_require__(2342);var _editorTermSelector2=_interopRequireDefault(_editorTermSelector);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function isSkippedTaxonomy(postType,taxonomy){if((0,_includes3.default)(["post_format","mentions"],taxonomy)){return true}if("post"===postType){return(0,_includes3.default)(["category","post_tag"],taxonomy)}return false}function EditorDrawerTaxonomies(_ref){var translate=_ref.translate;var siteId=_ref.siteId;var postType=_ref.postType;var isSupported=_ref.isSupported;var taxonomies=_ref.taxonomies;var terms=_ref.terms;if(!isSupported){return null}return _react2.default.createElement("div",{className:"editor-drawer__taxonomies"},siteId&&postType&&_react2.default.createElement(_queryTaxonomies2.default,{siteId:siteId,postType:postType}),(0,_reduce3.default)(taxonomies,function(memo,taxonomy){var name=taxonomy.name;var label=taxonomy.label;var hierarchical=taxonomy.hierarchical;if(isSkippedTaxonomy(postType,name)){return memo}var taxonomyTerms=(0,_get3.default)(terms,name);var taxonomyTermsCount=(0,_size3.default)(taxonomyTerms);var subtitle=void 0;if(taxonomyTermsCount>2){subtitle=translate("%d selected","%d selected",{count:taxonomyTermsCount,args:[taxonomyTermsCount]})}else{subtitle=(0,_map3.default)(taxonomyTerms,function(term){return(0,_formatting.decodeEntities)(term.name||term)}).join(", ")}return memo.concat(_react2.default.createElement(_accordion2.default,{key:name,title:label,subtitle:subtitle,icon:_react2.default.createElement(_gridicon2.default,{icon:hierarchical?"folder":"tag"})},hierarchical?_react2.default.createElement(_editorTermSelector2.default,{taxonomyName:name}):_react2.default.createElement(_termTokenField2.default,{taxonomyName:name})))},[]))}EditorDrawerTaxonomies.propTypes={translate:_react.PropTypes.func,siteId:_react.PropTypes.number,postType:_react.PropTypes.string,isSupported:_react.PropTypes.bool,terms:_react.PropTypes.oneOfType([_react.PropTypes.object,_react.PropTypes.array]),taxonomies:_react.PropTypes.array};exports.default=(0,_reactRedux.connect)(function(state){var siteId=(0,_selectors.getSelectedSiteId)(state);var postId=(0,_selectors2.getEditorPostId)(state);var postType=(0,_selectors3.getEditedPostValue)(state,siteId,postId,"type");var isSupported=false!==(0,_selectors5.isJetpackMinimumVersion)(state,siteId,"4.1.0");return{siteId:siteId,postType:postType,isSupported:isSupported,terms:(0,_selectors3.getEditedPostValue)(state,siteId,postId,"terms"),taxonomies:(0,_selectors4.getPostTypeTaxonomies)(state,siteId,postType)}})((0,_i18nCalypso.localize)(EditorDrawerTaxonomies));module.exports=exports["default"]},3113:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _defer=__webpack_require__(385);var _defer2=_interopRequireDefault(_defer);var _actions=__webpack_require__(1662);var _actions2=_interopRequireDefault(_actions);var _store=__webpack_require__(1717);var _store2=_interopRequireDefault(_store);var _actions3=__webpack_require__(1648);var _actions4=_interopRequireDefault(_actions3);var _preview=__webpack_require__(3114);var _preview2=_interopRequireDefault(_preview);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"EditorFeaturedImagePreviewContainer",propTypes:{siteId:_react.PropTypes.number.isRequired,itemId:_react.PropTypes.oneOfType([_react.PropTypes.number,_react.PropTypes.string]).isRequired,maxWidth:_react.PropTypes.number},getInitialState:function getInitialState(){return{image:null}},componentDidMount:function componentDidMount(){this.fetchImage();_store2.default.on("change",this.updateImageState)},componentDidUpdate:function componentDidUpdate(prevProps){var _props=this.props;var siteId=_props.siteId;var itemId=_props.itemId;if(siteId!==prevProps.siteId||itemId!==prevProps.itemId){this.fetchImage()}},componentWillUnmount:function componentWillUnmount(){_store2.default.off("change",this.updateImageState)},fetchImage:function fetchImage(){var _this=this;this.updateImageState(function(){if(_this.state.image){return}(0,_defer2.default)(function(){_actions2.default.fetch(_this.props.siteId,_this.props.itemId)})})},updateImageState:function updateImageState(callback){var _this2=this;var image=_store2.default.get(this.props.siteId,this.props.itemId);this.setState({image:image},function(){if("function"===typeof callback){callback()}});(0,_defer2.default)(function(){if(image&&image.ID!==_this2.props.itemId){_actions4.default.edit({featured_image:image.ID})}})},render:function render(){return _react2.default.createElement(_preview2.default,{image:this.state.image,maxWidth:this.props.maxWidth})}});module.exports=exports["default"]},3114:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactRedux=__webpack_require__(15);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _get=__webpack_require__(24);var _get2=_interopRequireDefault(_get);var _some=__webpack_require__(63);var _some2=_interopRequireDefault(_some);var _store=__webpack_require__(1717);var _store2=_interopRequireDefault(_store);var _utils=__webpack_require__(1647);var _utils2=_interopRequireDefault(_utils);var _spinner=__webpack_require__(282);var _spinner2=_interopRequireDefault(_spinner);var _spinnerLine=__webpack_require__(1892);var _spinnerLine2=_interopRequireDefault(_spinnerLine);var _imagePreloader=__webpack_require__(2224);var _imagePreloader2=_interopRequireDefault(_imagePreloader);var _selectors=__webpack_require__(47);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var EditorFeaturedImagePreview=_react2.default.createClass({displayName:"EditorFeaturedImagePreview",propTypes:{siteId:_react.PropTypes.number,image:_react.PropTypes.object,maxWidth:_react.PropTypes.number},getInitialState:function getInitialState(){return{height:null,transientSrc:null}},componentWillReceiveProps:function componentWillReceiveProps(nextProps){var currentSrc=this.src();if(!currentSrc||currentSrc===this.src(nextProps)){return}var nextState={height:this.refs.preview.clientHeight};if(this.isReceivingPersistedImage(this.props,nextProps)){nextState.transientSrc=currentSrc}this.setState(nextState)},isReceivingPersistedImage:function isReceivingPersistedImage(props,nextProps){var siteId=this.props.siteId;if(siteId!==nextProps.siteId){return false}var image=this.props.image;if(!image||!image.transient||!nextProps.image){return false}var media=_store2.default.get(siteId,image.ID);return media&&media.ID===nextProps.image.ID},src:function src(){var props=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.props;if(!props.image){return}return _utils2.default.url(props.image,{maxWidth:this.props.maxWidth,size:"post-thumbnail"})},clearState:function clearState(){if(!(0,_some2.default)(this.state)){return}this.setState(this.getInitialState())},render:function render(){var height=this.state.height;var classes=(0,_classnames2.default)("editor-featured-image__preview",{"is-transient":(0,_get2.default)(this.props.image,"transient"),"has-assigned-height":!!height});var placeholder=void 0;if(this.state.transientSrc){placeholder=_react2.default.createElement("img",{src:this.state.transientSrc})}else{placeholder=_react2.default.createElement(_spinnerLine2.default,null)}return _react2.default.createElement("div",{ref:"preview",className:classes,style:{height:height}},_react2.default.createElement(_spinner2.default,null),_react2.default.createElement(_imagePreloader2.default,{placeholder:placeholder,src:this.src(),onLoad:this.clearState,className:"editor-featured-image__preview-image"}))}});exports.default=(0,_reactRedux.connect)(function(state){return{siteId:(0,_selectors.getSelectedSiteId)(state)}})(EditorFeaturedImagePreview);module.exports=exports["default"]},3115:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactRedux=__webpack_require__(15);var _get=__webpack_require__(24);var _get2=_interopRequireDefault(_get);var _i18nCalypso=__webpack_require__(11);var _selectors=__webpack_require__(47);var _selectors2=__webpack_require__(277);var _selectors3=__webpack_require__(112);var _selectors4=__webpack_require__(390);var _selectors5=__webpack_require__(79);var _selectors6=__webpack_require__(90);var _button=__webpack_require__(69);var _button2=_interopRequireDefault(_button);var _dialog=__webpack_require__(168);var _dialog2=_interopRequireDefault(_dialog);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function EditorForbidden(_ref){var translate=_ref.translate;var userCanEdit=_ref.userCanEdit;var siteSlug=_ref.siteSlug;if(false!==userCanEdit){return null}var buttons=[_react2.default.createElement(_button2.default,{key:"back",href:"/posts/"+siteSlug,primary:true},translate("Back to My Sites"))];return _react2.default.createElement(_dialog2.default,{isVisible:true,buttons:buttons,className:"editor-forbidden"},_react2.default.createElement("h1",null,translate("You can't edit this post type")),_react2.default.createElement("p",null,translate("If you think you should have access to this post type, request that your site administrator grant you access.")))}EditorForbidden.propTypes={translate:_react.PropTypes.func,userCanEdit:_react.PropTypes.bool,siteSlug:_react.PropTypes.string};exports.default=(0,_reactRedux.connect)(function(state){var siteId=(0,_selectors.getSelectedSiteId)(state);var type=(0,_selectors3.getEditedPostValue)(state,siteId,(0,_selectors2.getEditorPostId)(state),"type");var typeObject=(0,_selectors4.getPostType)(state,siteId,type);var capability=(0,_get2.default)(typeObject,["capabilities","edit_posts"],null);return{userCanEdit:(0,_selectors6.canCurrentUser)(state,siteId,capability),siteSlug:(0,_selectors5.getSiteSlug)(state,siteId)}})((0,_i18nCalypso.localize)(EditorForbidden));module.exports=exports["default"]},3116:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var noop=__webpack_require__(38),React=__webpack_require__(1),PureRenderMixin=__webpack_require__(111),i18n=__webpack_require__(11);var Card=__webpack_require__(89),EditPostStatus=__webpack_require__(3101),Gridicon=__webpack_require__(26),Popover=__webpack_require__(386),Site=__webpack_require__(279),StatusLabel=__webpack_require__(3143),postUtils=__webpack_require__(1649),siteUtils=__webpack_require__(208),PostSchedule=__webpack_require__(2226),postActions=__webpack_require__(1648),Tooltip=__webpack_require__(722),PostListFetcher=__webpack_require__(1807),stats=__webpack_require__(1651);exports.default=React.createClass({displayName:"EditorGroundControl",propTypes:{hasContent:React.PropTypes.bool,isDirty:React.PropTypes.bool,isSaveBlocked:React.PropTypes.bool,isPublishing:React.PropTypes.bool,isSaving:React.PropTypes.bool,onClose:React.PropTypes.func,onPreview:React.PropTypes.func,onPublish:React.PropTypes.func,onSaveDraft:React.PropTypes.func,onMoreInfoAboutEmailVerify:React.PropTypes.func,post:React.PropTypes.object,savedPost:React.PropTypes.object,site:React.PropTypes.object,user:React.PropTypes.object,userUtils:React.PropTypes.object,type:React.PropTypes.string},mixins:[PureRenderMixin],getDefaultProps:function getDefaultProps(){return{hasContent:false,isDirty:false,isSaveBlocked:false,isPublishing:false,isSaving:false,onClose:noop,onPublish:noop,onSaveDraft:noop,post:null,savedPost:null,site:{},user:null,userUtils:null}},componentDidMount:function componentDidMount(){if(!this.props.user){return}this.props.user.on("change",this.updateNeedsVerification).on("verify",this.updateNeedsVerification)},componentWillUnmount:function componentWillUnmount(){if(!this.props.user){return}this.props.user.off("change",this.updateNeedsVerification).off("verify",this.updateNeedsVerification)},updateNeedsVerification:function updateNeedsVerification(){this.setState({needsVerification:this.props.userUtils&&this.props.userUtils.needsVerificationForSite(this.props.site)})},getInitialState:function getInitialState(){return{showSchedulePopover:false,showAdvanceStatus:false,showDateTooltip:false,firstDayOfTheMonth:this.getFirstDayOfTheMonth(),lastDayOfTheMonth:this.getLastDayOfTheMonth(),needsVerification:this.props.userUtils&&this.props.userUtils.needsVerificationForSite(this.props.site)}},componentWillReceiveProps:function componentWillReceiveProps(nextProps){this.setState({needsVerification:nextProps.userUtils&&nextProps.userUtils.needsVerificationForSite(nextProps.site)});if(this.props.user){this.props.user.off("change",this.updateNeedsVerification).off("verify",this.updateNeedsVerification)}if(nextProps.user){nextProps.user.on("change",this.updateNeedsVerification).on("verify",this.updateNeedsVerification)}},setPostDate:function setPostDate(date){postActions.edit({date:date?date.format():null})},setCurrentMonth:function setCurrentMonth(date){this.setState({firstDayOfTheMonth:this.getFirstDayOfTheMonth(date),lastDayOfTheMonth:this.getLastDayOfTheMonth(date)})},getPreviewLabel:function getPreviewLabel(){if(postUtils.isPublished(this.props.savedPost)&&this.props.site.jetpack){return this.translate("View")}return this.translate("Preview")},trackPrimaryButton:function trackPrimaryButton(){var postEvents={update:"Clicked Update Post Button",schedule:"Clicked Schedule Post Button",requestReview:"Clicked Request-Review Post Button",publish:"Clicked Publish Post Button"};var pageEvents={update:"Clicked Update Page Button",schedule:"Clicked Schedule Page Button",requestReview:"Clicked Request-Review Page Button",publish:"Clicked Publish Page Button"};var buttonState=this.getPrimaryButtonState();var eventString=postUtils.isPage(this.props.post)?pageEvents[buttonState]:postEvents[buttonState];stats.recordEvent(eventString);stats.recordEvent("Clicked Primary Button")},getPrimaryButtonState:function getPrimaryButtonState(){if(postUtils.isPublished(this.props.savedPost)&&!postUtils.isBackDatedPublished(this.props.savedPost)&&!postUtils.isFutureDated(this.props.post)||this.props.savedPost&&this.props.savedPost.status==="future"&&postUtils.isFutureDated(this.props.post)){return"update"}if(postUtils.isFutureDated(this.props.post)){return"schedule"}if(siteUtils.userCan("publish_posts",this.props.site)){return"publish"}if(this.props.savedPost&&this.props.savedPost.status==="pending"){return"update"}return"requestReview"},getPrimaryButtonLabel:function getPrimaryButtonLabel(){var primaryButtonState=this.getPrimaryButtonState();var buttonLabels={update:this.translate("Update"),schedule:this.translate("Schedule"),publish:this.translate("Publish"),requestReview:this.translate("Submit for Review")};return buttonLabels[primaryButtonState]},getVerificationNoticeLabel:function getVerificationNoticeLabel(){var primaryButtonState=this.getPrimaryButtonState();var buttonLabels=void 0;if(i18n.getLocaleSlug()==="en"){buttonLabels={update:this.translate("To update, check your email and confirm your address."),schedule:this.translate("To schedule, check your email and confirm your address."),publish:this.translate("To publish, check your email and confirm your address."),requestReview:this.translate("To submit for review, check your email and confirm your address.")}}else{buttonLabels={update:this.translate("To update, please confirm your email address."),schedule:this.translate("To schedule, please confirm your email address."),publish:this.translate("To publish, please confirm your email address."),requestReview:this.translate("To submit for review, please confirm your email address.")}}return buttonLabels[primaryButtonState]},toggleSchedulePopover:function toggleSchedulePopover(){this.setState({showSchedulePopover:!this.state.showSchedulePopover})},closeSchedulePopover:function closeSchedulePopover(wasCanceled){if(wasCanceled){var date=this.props.savedPost&&this.props.savedPost.date?this.moment(this.props.savedPost.date):null;this.setPostDate(date)}this.setState({showSchedulePopover:false})},renderPostScheduler:function renderPostScheduler(){var tz=siteUtils.timezone(this.props.site),gmtOffset=siteUtils.gmtOffset(this.props.site),postDate=this.props.post&&this.props.post.date?this.props.post.date:null;return React.createElement(PostSchedule,{selectedDay:postDate,timezone:tz,gmtOffset:gmtOffset,onDateChange:this.setPostDate,onMonthChange:this.setCurrentMonth})},schedulePostPopover:function schedulePostPopover(){var postScheduler=this.renderPostScheduler();return React.createElement(Popover,{isVisible:this.state.showSchedulePopover,onClose:this.closeSchedulePopover,position:"bottom left",context:this.refs&&this.refs.schedulePost,id:"editor-post-schedule"},React.createElement("span",{className:"editor-ground-control__schedule-post"},postUtils.isPage(this.props.post)?postScheduler:React.createElement(PostListFetcher,{siteID:this.props.site.ID,status:"publish,future",before:this.state.lastDayOfTheMonth.format(),after:this.state.firstDayOfTheMonth.format(),number:100},postScheduler)))},getFirstDayOfTheMonth:function getFirstDayOfTheMonth(date){var tz=siteUtils.timezone(this.props.site);date=date||this.moment();return postUtils.getOffsetDate(date,tz).set({year:date.year(),month:date.month(),date:1,hours:0,minutes:0,seconds:0,milliseconds:0})},getLastDayOfTheMonth:function getLastDayOfTheMonth(date){return this.getFirstDayOfTheMonth(date).add(1,"month").second(-1)},isSaveEnabled:function isSaveEnabled(){return!this.props.isSaving&&!this.props.isSaveBlocked&&this.props.isDirty&&this.props.hasContent&&!!this.props.post&&!postUtils.isPublished(this.props.post)},isPreviewEnabled:function isPreviewEnabled(){return this.props.hasContent&&!(this.props.isNew&&!this.props.isDirty)&&!this.props.isSaveBlocked},isPrimaryButtonEnabled:function isPrimaryButtonEnabled(){return!this.props.isPublishing&&!this.props.isSaveBlocked&&this.props.hasContent&&!this.state.needsVerification},toggleAdvancedStatus:function toggleAdvancedStatus(){this.setState({showAdvanceStatus:!this.state.showAdvanceStatus})},onPrimaryButtonClick:function onPrimaryButtonClick(){this.trackPrimaryButton();if(postUtils.isPublished(this.props.savedPost)&&!postUtils.isBackDatedPublished(this.props.savedPost)){return this.props.onSave()}if(siteUtils.userCan("publish_posts",this.props.site)){return this.props.onPublish()}return this.props.onSave("pending")},onSaveButtonClick:function onSaveButtonClick(){this.props.onSave();var eventLabel=postUtils.isPage(this.props.page)?"Clicked Save Page Button":"Clicked Save Post Button";stats.recordEvent(eventLabel);stats.recordStat("save_draft_clicked")},onPreviewButtonClick:function onPreviewButtonClick(event){this.props.onPreview(event);var eventLabel=postUtils.isPage(this.props.page)?"Clicked Preview Page Button":"Clicked Preview Post Button";stats.recordEvent(eventLabel)},renderDateTooltip:function renderDateTooltip(){if(this.state.showSchedulePopover){return null}return React.createElement(Tooltip,{context:this.refs&&this.refs.schedulePost,isVisible:this.state.showDateTooltip,position:"top",onClose:noop},this.translate("Set date and time"))},showDateTooltip:function showDateTooltip(){this.setState({showDateTooltip:true})},hideDateTooltip:function hideDateTooltip(){this.setState({showDateTooltip:false})},render:function render(){return React.createElement(Card,{className:"editor-ground-control"},React.createElement(Site,{site:this.props.site,indicator:false,homeLink:true,externalLink:true}),React.createElement("hr",{className:"editor-ground-control__separator"}),React.createElement("div",{className:"editor-ground-control__status"},React.createElement(StatusLabel,{post:this.props.savedPost,onClick:this.toggleAdvancedStatus,advancedStatus:this.state.showAdvanceStatus,type:this.props.type}),this.isSaveEnabled()&&React.createElement("button",{className:"editor-ground-control__save button is-link",onClick:this.onSaveButtonClick,tabIndex:3},this.translate("Save")),this.props.isSaving&&React.createElement("span",{className:"editor-ground-control__saving"},this.translate("Saving"))),this.state.showAdvanceStatus&&React.createElement(EditPostStatus,{post:this.props.post,savedPost:this.props.savedPost,type:this.props.type,onSave:this.props.onSave,onTrashingPost:this.props.onTrashingPost,onDateChange:this.setPostDate,site:this.props.site}),React.createElement("div",{className:"editor-ground-control__action-buttons"},React.createElement("button",{className:"editor-ground-control__preview-button button",disabled:!this.isPreviewEnabled(),onClick:this.onPreviewButtonClick,tabIndex:4},this.getPreviewLabel()),React.createElement("div",{className:"editor-ground-control__publish-combo"},React.createElement("button",{className:"editor-ground-control__publish-button button is-primary",onClick:this.onPrimaryButtonClick,disabled:!this.isPrimaryButtonEnabled(),tabIndex:5},this.getPrimaryButtonLabel()),siteUtils.userCan("publish_posts",this.props.site)&&React.createElement("button",{ref:"schedulePost",className:"editor-ground-control__time-button button is-primary",onClick:this.toggleSchedulePopover,onMouseEnter:this.showDateTooltip,onMouseLeave:this.hideDateTooltip,"aria-label":this.translate("Schedule date and time to publish post."),"aria-pressed":!!this.state.showSchedulePopover,tabIndex:6},postUtils.isFutureDated(this.props.post)?React.createElement(Gridicon,{icon:"scheduled",size:18}):React.createElement(Gridicon,{icon:"calendar",size:18})),this.renderDateTooltip()),siteUtils.userCan("publish_posts",this.props.site)&&this.schedulePostPopover()),this.state.needsVerification&&React.createElement("div",{className:"editor-ground-control__email-verification-notice",tabIndex:7,onClick:this.props.onMoreInfoAboutEmailVerify},React.createElement(Gridicon,{icon:"info",className:"editor-ground-control__email-verification-notice-icon"}),this.getVerificationNoticeLabel()," ",React.createElement("span",{className:"editor-ground-control__email-verification-notice-more"},this.translate("Learn More"))))}});module.exports=exports["default"]},3117:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var React=__webpack_require__(1),qs=__webpack_require__(121);var PostActions=__webpack_require__(1648),EditorDrawerWell=__webpack_require__(2339),Notice=__webpack_require__(76),stats=__webpack_require__(1651),EditorLocationSearch=__webpack_require__(3119);var GOOGLE_MAPS_BASE_URL="https://maps.google.com/maps/api/staticmap?";exports.default=React.createClass({displayName:"EditorLocation",propTypes:{label:React.PropTypes.string,coordinates:function coordinates(props,propName){var prop=props[propName];if(prop&&(!Array.isArray(prop)||2!==prop.length||2!==prop.filter(Number).length)){return new Error("Expected array pair of coordinates for prop `"+propName+"`.")}}},getInitialState:function getInitialState(){return{error:null}},onGeolocateSuccess:function onGeolocateSuccess(position){this.setState({locating:false});PostActions.updateMetadata({geo_latitude:position.coords.latitude,geo_longitude:position.coords.longitude});stats.recordStat("location_geolocate_success")},onGeolocateFailure:function onGeolocateFailure(error){this.setState({error:error,locating:false});stats.recordStat("location_geolocate_failed")},resetError:function resetError(){this.setState({error:null})},geolocate:function geolocate(){this.resetError();this.setState({locating:true});navigator.geolocation.getCurrentPosition(this.onGeolocateSuccess,this.onGeolocateFailure,{enableHighAccuracy:true});stats.recordStat("location_geolocate");stats.recordEvent("Location Geolocated")},clear:function clear(){PostActions.deleteMetadata(["geo_latitude","geo_longitude"])},onSearchSelect:function onSearchSelect(result){PostActions.updateMetadata({geo_latitude:result.geometry.location.lat,geo_longitude:result.geometry.location.lng})},renderCurrentLocation:function renderCurrentLocation(){if(!this.props.coordinates){return}var src=GOOGLE_MAPS_BASE_URL+qs.stringify({markers:this.props.coordinates.join(","),zoom:8,size:"400x300"});return React.createElement("img",{src:src,className:"editor-location__map"})},render:function render(){var error,buttonText;if(this.state.error){error=React.createElement(Notice,{status:"is-error",onDismissClick:this.resetError,isCompact:true},this.translate("We couldn't find your current location.",{context:"Post editor geolocation"}))}if(this.state.locating){buttonText=this.translate("Locating",{context:"Post editor geolocation"})}else{buttonText=this.translate("Get current location",{context:"Post editor geolocation"})}return React.createElement("div",{className:"editor-location"},error,React.createElement(EditorDrawerWell,{icon:"location",label:buttonText,empty:!this.props.coordinates,onClick:this.geolocate,onRemove:this.clear,disabled:this.state.locating},this.renderCurrentLocation()),React.createElement(EditorLocationSearch,{onError:this.onGeolocateFailure,onSelect:this.onSearchSelect}))}});module.exports=exports["default"]},3118:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"EditorLocationSearchResult",propTypes:{result:_react.PropTypes.object.isRequired,onClick:_react.PropTypes.func},getDefaultProps:function getDefaultProps(){return{onClick:function onClick(){}}},render:function render(){var _props=this.props;var result=_props.result;var onClick=_props.onClick;return _react2.default.createElement("div",{onClick:onClick,className:"editor-location__search-result"},result.formatted_address)}});module.exports=exports["default"]},3119:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _geocoding=__webpack_require__(2609);var _stats=__webpack_require__(1651);var stats=_interopRequireWildcard(_stats);var _searchCard=__webpack_require__(1709);var _searchCard2=_interopRequireDefault(_searchCard);var _searchResult=__webpack_require__(3118);
var _searchResult2=_interopRequireDefault(_searchResult);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"EditorLocationSearch",propTypes:{onError:_react.PropTypes.func,onSelect:_react.PropTypes.func},getDefaultProps:function getDefaultProps(){return{onError:function onError(){},onSelect:function onSelect(){}}},getInitialState:function getInitialState(){return{results:[],isSearching:false}},componentDidMount:function componentDidMount(){this.mounted=true;this.hasTrackedStats=false},componentWillUnmount:function componentWillUnmount(){this.mounted=false},geocode:function geocode(address){var _this=this;var onError=this.props.onError;if(!this.hasTrackedStats){stats.recordStat("location_search");stats.recordEvent("Location Searched");this.hasTrackedStats=true}if(!address){this.setState({results:[]});return}(0,_geocoding.geocode)(address).then(function(results){if(!_this.mounted){return}_this.setState({results:results})}).catch(onError).then(function(){if(!_this.mounted){return}_this.setState({isSearching:false})});this.setState({isSearching:true})},onSelect:function onSelect(result){this.refs.search.clear();this.props.onSelect(result)},render:function render(){var _this2=this;var _state=this.state;var results=_state.results;var isSearching=_state.isSearching;return _react2.default.createElement("div",{className:"editor-location__search"},_react2.default.createElement(_searchCard2.default,{ref:"search",onSearch:this.geocode,searching:isSearching,delaySearch:true}),_react2.default.createElement("ul",{className:"editor-location__search-results"},results.map(function(result){return _react2.default.createElement("li",{key:result.formatted_address},_react2.default.createElement(_searchResult2.default,{result:result,onClick:_this2.onSelect.bind(null,result)}))})))}});module.exports=exports["default"]},3120:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _assign=__webpack_require__(5);var _assign2=_interopRequireDefault(_assign);var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactDom=__webpack_require__(44);var _reactDom2=_interopRequireDefault(_reactDom);var _i18nCalypso=__webpack_require__(11);var _markup=__webpack_require__(1917);var _markup2=_interopRequireDefault(_markup);var _button=__webpack_require__(69);var _button2=_interopRequireDefault(_button);var _dialog=__webpack_require__(168);var _dialog2=_interopRequireDefault(_dialog);var _formFieldset=__webpack_require__(275);var _formFieldset2=_interopRequireDefault(_formFieldset);var _formLabel=__webpack_require__(380);var _formLabel2=_interopRequireDefault(_formLabel);var _formTextInput=__webpack_require__(206);var _formTextInput2=_interopRequireDefault(_formTextInput);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var EditorMediaAdvanced=function(_Component){(0,_inherits3.default)(EditorMediaAdvanced,_Component);function EditorMediaAdvanced(){(0,_classCallCheck3.default)(this,EditorMediaAdvanced);var _this=(0,_possibleConstructorReturn3.default)(this,(EditorMediaAdvanced.__proto__||(0,_getPrototypeOf2.default)(EditorMediaAdvanced)).apply(this,arguments));_this.save=_this.save.bind(_this);return _this}(0,_createClass3.default)(EditorMediaAdvanced,[{key:"save",value:function save(){var _props$item=this.props.item;var media=_props$item.media;var appearance=_props$item.appearance;var markup=_markup2.default.get((0,_assign2.default)({},media,{alt:_reactDom2.default.findDOMNode(this.refs.alt).value}),appearance);this.props.insertMedia(markup)}},{key:"render",value:function render(){var _props=this.props;var translate=_props.translate;var visible=_props.visible;var item=_props.item;var onClose=_props.onClose;var buttons=[_react2.default.createElement(_button2.default,{primary:true,onClick:this.save},translate("Save"))];return _react2.default.createElement(_dialog2.default,{isVisible:visible,buttons:buttons,onClose:onClose},_react2.default.createElement("form",{onSubmit:this.save},_react2.default.createElement(_formFieldset2.default,null,_react2.default.createElement(_formLabel2.default,null,translate("Alt text"),_react2.default.createElement(_formTextInput2.default,{ref:"alt",defaultValue:item.media.alt})))))}}]);return EditorMediaAdvanced}(_react.Component);EditorMediaAdvanced.propTypes={translate:_react.PropTypes.func,visible:_react.PropTypes.bool,item:_react.PropTypes.object,onClose:_react.PropTypes.func,insertMedia:_react.PropTypes.func};EditorMediaAdvanced.defaultProps={onClose:function onClose(){},insertMedia:function insertMedia(){}};exports.default=(0,_i18nCalypso.localize)(EditorMediaAdvanced);module.exports=exports["default"]},3121:function(module,exports,__webpack_require__){"use strict";var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactRedux=__webpack_require__(15);var _site=__webpack_require__(279);var _site2=_interopRequireDefault(_site);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _actions=__webpack_require__(82);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var EditorMobileNavigation=_react2.default.createClass({displayName:"EditorMobileNavigation",toggleSidebar:function toggleSidebar(){this.props.setLayoutFocus("sidebar")},render:function render(){if(!this.props.site){return null}return _react2.default.createElement("div",{className:"editor-mobile-navigation"},_react2.default.createElement(_site2.default,{indicator:false,site:this.props.site}),_react2.default.createElement("button",{className:"button editor-mobile-navigation__toggle",onClick:this.toggleSidebar},this.translate("Actions")),_react2.default.createElement(_gridicon2.default,{icon:"cross",onClick:this.props.onClose,className:"editor-mobile-navigation__close"}))}});module.exports=(0,_reactRedux.connect)(null,{setLayoutFocus:_actions.setLayoutFocus})(EditorMobileNavigation)},3122:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _i18nCalypso=__webpack_require__(11);var _reactRedux=__webpack_require__(15);var _label=__webpack_require__(1915);var _label2=_interopRequireDefault(_label);var _section=__webpack_require__(1759);var _section2=_interopRequireDefault(_section);var _editorSlug=__webpack_require__(2154);var _editorSlug2=_interopRequireDefault(_editorSlug);var _selectors=__webpack_require__(47);var _selectors2=__webpack_require__(277);var _selectors3=__webpack_require__(112);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var EditorMoreOptionsSlug=function(_PureComponent){(0,_inherits3.default)(EditorMoreOptionsSlug,_PureComponent);function EditorMoreOptionsSlug(){(0,_classCallCheck3.default)(this,EditorMoreOptionsSlug);return(0,_possibleConstructorReturn3.default)(this,(EditorMoreOptionsSlug.__proto__||(0,_getPrototypeOf2.default)(EditorMoreOptionsSlug)).apply(this,arguments))}(0,_createClass3.default)(EditorMoreOptionsSlug,[{key:"getPopoverLabel",value:function getPopoverLabel(){var _props=this.props;var translate=_props.translate;var postType=_props.postType;if("page"===postType){return translate("The slug is the URL-friendly version of the page title.")}return translate("The slug is the URL-friendly version of the post title.")}},{key:"render",value:function render(){var _props2=this.props;var postType=_props2.postType;var translate=_props2.translate;return _react2.default.createElement(_section2.default,{className:"editor-more-options__slug"},_react2.default.createElement(_label2.default,{labelText:translate("Slug"),helpText:this.getPopoverLabel()},_react2.default.createElement(_editorSlug2.default,{instanceName:postType+"-sidebar",className:"editor-more-options__slug-field"})))}}]);return EditorMoreOptionsSlug}(_react.PureComponent);EditorMoreOptionsSlug.propTypes={postType:_react.PropTypes.string,translate:_react.PropTypes.func};exports.default=(0,_reactRedux.connect)(function(state){var siteId=(0,_selectors.getSelectedSiteId)(state);return{postType:(0,_selectors3.getEditedPostValue)(state,siteId,(0,_selectors2.getEditorPostId)(state),"type")}})((0,_i18nCalypso.localize)(EditorMoreOptionsSlug));module.exports=exports["default"]},3123:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.EditorNotice=undefined;var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactRedux=__webpack_require__(15);var _i18nCalypso=__webpack_require__(11);var _noticeAction=__webpack_require__(134);var _noticeAction2=_interopRequireDefault(_noticeAction);var _notice=__webpack_require__(76);var _notice2=_interopRequireDefault(_notice);var _selectors=__webpack_require__(47);var _selectors2=__webpack_require__(277);var _selectors3=__webpack_require__(112);var _selectors4=__webpack_require__(390);var _queryPostTypes=__webpack_require__(726);var _queryPostTypes2=_interopRequireDefault(_queryPostTypes);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var EditorNotice=exports.EditorNotice=function(_Component){(0,_inherits3.default)(EditorNotice,_Component);function EditorNotice(){(0,_classCallCheck3.default)(this,EditorNotice);return(0,_possibleConstructorReturn3.default)(this,(EditorNotice.__proto__||(0,_getPrototypeOf2.default)(EditorNotice)).apply(this,arguments))}(0,_createClass3.default)(EditorNotice,[{key:"getErrorMessage",value:function getErrorMessage(){var _props=this.props;var translate=_props.translate;var error=_props.error;if(!error){return}switch(error.message){case"NO_CONTENT":return translate("You haven't written anything yet!")}}},{key:"getText",value:function getText(key){var _props2=this.props;var translate=_props2.translate;var type=_props2.type;var typeObject=_props2.typeObject;var site=_props2.site;switch(key){case"publishFailure":if("page"===type){return translate("Publishing of page failed.")}return translate("Publishing of post failed.");case"saveFailure":return translate("Saving of draft failed.");case"trashFailure":if("page"===type){return translate("Trashing of page failed.")}return translate("Trashing of post failed.");case"published":if(!site){if("page"===type){return translate("Page published!")}return translate("Post published!")}if("page"===type){return translate("Page published on {{siteLink/}}!",{components:{siteLink:_react2.default.createElement("a",{href:site.URL,target:"_blank",rel:"noopener noreferrer"},site.title)},comment:"Editor: Message displayed when a page is published, with a link to the site it was published on."})}return translate("Post published on {{siteLink/}}!",{components:{siteLink:_react2.default.createElement("a",{href:site.URL,target:"_blank",rel:"noopener noreferrer"},site.title)},comment:"Editor: Message displayed when a post is published, with a link to the site it was published on."});case"scheduled":if(!site){if("page"===type){return translate("Page scheduled!")}return translate("Post scheduled!")}if("page"===type){return translate("Page scheduled on {{siteLink/}}!",{components:{siteLink:_react2.default.createElement("a",{href:site.URL,target:"_blank",rel:"noopener noreferrer"},site.title)},comment:"Editor: Message displayed when a page is scheduled, with a link to the site it was scheduled on."})}return translate("Post scheduled on {{siteLink/}}!",{components:{siteLink:_react2.default.createElement("a",{href:site.URL,target:"_blank",rel:"noopener noreferrer"},site.title)},comment:"Editor: Message displayed when a post is scheduled, with a link to the site it was scheduled on."});case"publishedPrivately":if(!site){if("page"===type){return translate("Page privately published!")}return translate("Post privately published!")}if("page"===type){return translate("Page privately published on {{siteLink/}}!",{components:{siteLink:_react2.default.createElement("a",{href:site.URL,target:"_blank",rel:"noopener noreferrer"},site.title)},comment:"Editor: Message displayed when a page is published privately,"+" with a link to the site it was published on."})}return translate("Post privately published on {{siteLink/}}!",{components:{siteLink:_react2.default.createElement("a",{href:site.URL,target:"_blank",rel:"noopener noreferrer"},site.title)},comment:"Editor: Message displayed when a post is published privately,"+" with a link to the site it was published on."});case"view":if("page"===type){return translate("View Page")}else if("post"!==type&&typeObject){return typeObject.labels.view_item}return translate("View Post");case"preview":return translate("View Preview");case"updated":if(!site){if("page"===type){return translate("Page updated!")}return translate("Post updated!")}if("page"===type){return translate("Page updated on {{siteLink/}}!",{components:{siteLink:_react2.default.createElement("a",{href:site.URL,target:"_blank",rel:"noopener noreferrer"},site.title)},comment:"Editor: Message displayed when a page is updated, with a link to the site it was updated on."})}return translate("Post updated on {{siteLink/}}!",{components:{siteLink:_react2.default.createElement("a",{href:site.URL,target:"_blank",rel:"noopener noreferrer"},site.title)},comment:"Editor: Message displayed when a post is updated, with a link to the site it was updated on."})}}},{key:"render",value:function render(){var _props3=this.props;var siteId=_props3.siteId;var message=_props3.message;var status=_props3.status;var action=_props3.action;var link=_props3.link;var onDismissClick=_props3.onDismissClick;var text=this.getErrorMessage()||this.getText(message);return _react2.default.createElement("div",{className:"editor-notice"},siteId&&_react2.default.createElement(_queryPostTypes2.default,{siteId:siteId}),text&&_react2.default.createElement(_notice2.default,(0,_extends3.default)({status:status,text:text,onDismissClick:onDismissClick},{showDismiss:"is-success"!==status}),link&&_react2.default.createElement(_noticeAction2.default,{href:link,external:true},this.getText(action))))}}]);return EditorNotice}(_react.Component);EditorNotice.propTypes={translate:_react.PropTypes.func,siteId:_react.PropTypes.number,site:_react.PropTypes.object,type:_react.PropTypes.string,typeObject:_react.PropTypes.object,message:_react.PropTypes.string,status:_react.PropTypes.string,action:_react.PropTypes.string,link:_react.PropTypes.string,onDismissClick:_react.PropTypes.func,error:_react.PropTypes.object};exports.default=(0,_reactRedux.connect)(function(state){var siteId=(0,_selectors.getSelectedSiteId)(state);var post=(0,_selectors3.getEditedPost)(state,siteId,(0,_selectors2.getEditorPostId)(state));if(!post){return{}}return{siteId:siteId,site:(0,_selectors.getSelectedSite)(state),type:post.type,typeObject:(0,_selectors4.getPostType)(state,siteId,post.type)}})((0,_i18nCalypso.localize)(EditorNotice))},3124:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactRedux=__webpack_require__(15);var _i18nCalypso=__webpack_require__(11);var _section=__webpack_require__(1759);var _section2=_interopRequireDefault(_section);var _formTextInput=__webpack_require__(206);var _formTextInput2=_interopRequireDefault(_formTextInput);var _stats=__webpack_require__(1651);var _selectors=__webpack_require__(47);var _selectors2=__webpack_require__(277);var _selectors3=__webpack_require__(112);var _actions=__webpack_require__(285);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var EditorPageOrder=function(_Component){(0,_inherits3.default)(EditorPageOrder,_Component);function EditorPageOrder(){(0,_classCallCheck3.default)(this,EditorPageOrder);var _this=(0,_possibleConstructorReturn3.default)(this,(EditorPageOrder.__proto__||(0,_getPrototypeOf2.default)(EditorPageOrder)).apply(this,arguments));_this.editMenuOrder=_this.editMenuOrder.bind(_this);_this.statTracked=false;return _this}(0,_createClass3.default)(EditorPageOrder,[{key:"editMenuOrder",value:function editMenuOrder(event){var _props=this.props;var menuOrder=_props.menuOrder;var siteId=_props.siteId;var postId=_props.postId;var newOrder=parseInt(event.target.value,10)||0;if(newOrder===menuOrder){return}if(!this.statTracked){this.statTracked=true;(0,_stats.recordStat)("advanced_menu_order_changed");(0,_stats.recordEvent)("Changed page menu order")}this.props.editPost(siteId,postId,{menu_order:newOrder})}},{key:"render",value:function render(){var _props2=this.props;var translate=_props2.translate;var menuOrder=_props2.menuOrder;return _react2.default.createElement(_section2.default,{className:"editor-page-order"},_react2.default.createElement("label",null,_react2.default.createElement("span",{className:"editor-page-order__label-text"},translate("Order",{context:"Editor: Field label for menu order."})),_react2.default.createElement(_formTextInput2.default,{type:"number",value:menuOrder,pattern:"[0-9]*",onChange:this.editMenuOrder,onBlur:this.editMenuOrder,className:"editor-page-order__input"})))}}]);return EditorPageOrder}(_react.Component);EditorPageOrder.propTypes={siteId:_react.PropTypes.number,postId:_react.PropTypes.number,menuOrder:_react.PropTypes.number};EditorPageOrder.defaultProps={menuOrder:0};exports.default=(0,_reactRedux.connect)(function(state){var siteId=(0,_selectors.getSelectedSiteId)(state);var postId=(0,_selectors2.getEditorPostId)(state);var menuOrder=(0,_selectors3.getEditedPostValue)(state,siteId,postId,"menu_order");return{siteId:siteId,postId:postId,menuOrder:menuOrder}},{editPost:_actions.editPost})((0,_i18nCalypso.localize)(EditorPageOrder));module.exports=exports["default"]},3125:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _get2=__webpack_require__(24);var _get3=_interopRequireDefault(_get2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _i18nCalypso=__webpack_require__(11);var _reactRedux=__webpack_require__(15);var _postSelector=__webpack_require__(2313);var _postSelector2=_interopRequireDefault(_postSelector);var _formLabel=__webpack_require__(380);var _formLabel2=_interopRequireDefault(_formLabel);var _compact=__webpack_require__(1964);var _compact2=_interopRequireDefault(_compact);var _section=__webpack_require__(1759);var _section2=_interopRequireDefault(_section);var _selectors=__webpack_require__(47);var _selectors2=__webpack_require__(277);var _selectors3=__webpack_require__(112);var _actions=__webpack_require__(285);var _selectors4=__webpack_require__(390);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var EditorPageParent=function(_Component){(0,_inherits3.default)(EditorPageParent,_Component);function EditorPageParent(props){(0,_classCallCheck3.default)(this,EditorPageParent);var _this=(0,_possibleConstructorReturn3.default)(this,(EditorPageParent.__proto__||(0,_getPrototypeOf2.default)(EditorPageParent)).call(this,props));_this.boundUpdatePageParent=_this.updatePageParent.bind(_this);return _this}(0,_createClass3.default)(EditorPageParent,[{key:"updatePageParent",value:function updatePageParent(item){var _props=this.props;var siteId=_props.siteId;var postId=_props.postId;var parentId=item&&item.ID?item.ID:null;this.props.editPost(siteId,postId,{parent:parentId})}},{key:"render",value:function render(){var _props2=this.props;var parentId=_props2.parentId;var translate=_props2.translate;var postId=_props2.postId;var siteId=_props2.siteId;var postType=_props2.postType;var labels=_props2.labels;return _react2.default.createElement(_section2.default,{className:"editor-page-parent"},_react2.default.createElement(_formLabel2.default,null,_react2.default.createElement("span",{className:"editor-page-parent__label-text"},labels.parent||translate("Parent Page"))),_react2.default.createElement(_formLabel2.default,{className:"editor-page-parent__top-level"},_react2.default.createElement("span",{className:"editor-page-parent__top-level-label"},translate("Top level",{context:"Editor: Page being edited is top level i.e. has no parent"})),_react2.default.createElement(_compact2.default,{checked:!parentId,onChange:this.boundUpdatePageParent,"aria-label":translate("Toggle to set as top level")})),_react2.default.createElement(_postSelector2.default,{type:postType,siteId:siteId,onChange:this.boundUpdatePageParent,selected:parentId,excludeTree:postId,emptyMessage:labels.not_found||translate("You have no other pages yet.")}))}}]);return EditorPageParent}(_react.Component);EditorPageParent.propTypes={siteId:_react.PropTypes.number,postId:_react.PropTypes.number,parentId:_react.PropTypes.number,postType:_react.PropTypes.string,translate:_react.PropTypes.func,labels:_react.PropTypes.object};exports.default=(0,_reactRedux.connect)(function(state){var siteId=(0,_selectors.getSelectedSiteId)(state);var postId=(0,_selectors2.getEditorPostId)(state);var postType=(0,_selectors3.getEditedPostValue)(state,siteId,postId,"type");var parent=(0,_selectors3.getEditedPostValue)(state,siteId,postId,"parent");var parentId=(0,_get3.default)(parent,"ID",parent)||0;var labels=(0,_get3.default)((0,_selectors4.getPostType)(state,siteId,postType),"labels",{});return{siteId:siteId,postId:postId,postType:postType,parentId:parentId,labels:labels}},{editPost:_actions.editPost})((0,_i18nCalypso.localize)(EditorPageParent));module.exports=exports["default"]},3126:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _editorSlug=__webpack_require__(2154);var _editorSlug2=_interopRequireDefault(_editorSlug);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var PostEditorPageSlug=function(_PureComponent){(0,_inherits3.default)(PostEditorPageSlug,_PureComponent);function PostEditorPageSlug(){(0,_classCallCheck3.default)(this,PostEditorPageSlug);return(0,_possibleConstructorReturn3.default)(this,(PostEditorPageSlug.__proto__||(0,_getPrototypeOf2.default)(PostEditorPageSlug)).apply(this,arguments))}(0,_createClass3.default)(PostEditorPageSlug,[{key:"render",value:function render(){return _react2.default.createElement(_editorSlug2.default,{path:this.props.path,instanceName:"page-permalink"},_react2.default.createElement(_gridicon2.default,{icon:"link"}))}}]);return PostEditorPageSlug}(_react.PureComponent);PostEditorPageSlug.propTypes={path:_react.PropTypes.string};exports.default=PostEditorPageSlug;module.exports=exports["default"]},3127:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _map2=__webpack_require__(45);var _map3=_interopRequireDefault(_map2);var _size2=__webpack_require__(769);var _size3=_interopRequireDefault(_size2);var _find2=__webpack_require__(27);var _find3=_interopRequireDefault(_find2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactRedux=__webpack_require__(15);var _i18nCalypso=__webpack_require__(11);var _queryPageTemplates=__webpack_require__(2500);var _queryPageTemplates2=_interopRequireDefault(_queryPageTemplates);var _section=__webpack_require__(1759);var _section2=_interopRequireDefault(_section);var _selectDropdown=__webpack_require__(1761);var _selectDropdown2=_interopRequireDefault(_selectDropdown);var _item=__webpack_require__(1809);var _item2=_interopRequireDefault(_item);var _label=__webpack_require__(1915);var _label2=_interopRequireDefault(_label);var _selectors=__webpack_require__(47);var _selectors2=__webpack_require__(277);var _selectors3=__webpack_require__(112);var _selectors4=__webpack_require__(2363);var _actions=__webpack_require__(285);var _editorThemeHelp=__webpack_require__(2343);var _editorThemeHelp2=_interopRequireDefault(_editorThemeHelp);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var EditorPageTemplates=function(_Component){(0,_inherits3.default)(EditorPageTemplates,_Component);function EditorPageTemplates(){(0,_classCallCheck3.default)(this,EditorPageTemplates);var _this=(0,_possibleConstructorReturn3.default)(this,(EditorPageTemplates.__proto__||(0,_getPrototypeOf2.default)(EditorPageTemplates)).apply(this,arguments));_this.selectTemplate=_this.selectTemplate.bind(_this);return _this}(0,_createClass3.default)(EditorPageTemplates,[{key:"selectTemplate",value:function selectTemplate(file){var _props=this.props;var siteId=_props.siteId;var postId=_props.postId;this.props.editPost(siteId,postId,{page_template:file})}},{key:"getSelectedTemplateText",value:function getSelectedTemplateText(){var _props2=this.props;var templates=_props2.templates;var template=_props2.template;var translate=_props2.translate;var selectedTemplate=void 0;if(template){selectedTemplate=(0,_find3.default)(templates,{file:template})}if(selectedTemplate){return selectedTemplate.label}return translate("Default Template")}},{key:"getTemplates",value:function getTemplates(){var _props3=this.props;var translate=_props3.translate;var templates=_props3.templates;return[{label:translate("Default Template"),file:""}].concat(templates||[])}},{key:"render",value:function render(){var _this2=this;var _props4=this.props;var postType=_props4.postType;var template=_props4.template;var siteId=_props4.siteId;var translate=_props4.translate;if("page"!==postType){return null}var templates=this.getTemplates();return _react2.default.createElement("div",null,siteId&&_react2.default.createElement(_queryPageTemplates2.default,{siteId:siteId}),(0,_size3.default)(templates)>1&&_react2.default.createElement(_section2.default,null,_react2.default.createElement(_label2.default,{labelText:translate("Page Template")},_react2.default.createElement(_editorThemeHelp2.default,{className:"editor-page-templates__help-link"}),_react2.default.createElement(_selectDropdown2.default,{selectedText:this.getSelectedTemplateText()},(0,_map3.default)(templates,function(_ref){var file=_ref.file;var label=_ref.label;return _react2.default.createElement(_item2.default,{key:file,selected:file===template,onClick:function onClick(){return _this2.selectTemplate(file)}},label)})))))}}]);return EditorPageTemplates}(_react.Component);EditorPageTemplates.propTypes={siteId:_react.PropTypes.number,postId:_react.PropTypes.number,postType:_react.PropTypes.string,template:_react.PropTypes.string,templates:_react.PropTypes.array,editPost:_react.PropTypes.func};exports.default=(0,_reactRedux.connect)(function(state){var siteId=(0,_selectors.getSelectedSiteId)(state);var postId=(0,_selectors2.getEditorPostId)(state);var postType=(0,_selectors3.getEditedPostValue)(state,siteId,postId,"type");var template=(0,_selectors3.getEditedPostValue)(state,siteId,postId,"page_template");var templates=(0,_selectors4.getPageTemplates)(state,siteId);return{siteId:siteId,postId:postId,postType:postType,template:template,templates:templates}},{editPost:_actions.editPost})((0,_i18nCalypso.localize)(EditorPageTemplates));module.exports=exports["default"]},3128:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);
var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _pick2=__webpack_require__(91);var _pick3=_interopRequireDefault(_pick2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _i18nCalypso=__webpack_require__(11);var _reactRedux=__webpack_require__(15);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _editorSlug=__webpack_require__(2154);var _editorSlug2=_interopRequireDefault(_editorSlug);var _popover=__webpack_require__(386);var _popover2=_interopRequireDefault(_popover);var _tooltip=__webpack_require__(722);var _tooltip2=_interopRequireDefault(_tooltip);var _clipboardButton=__webpack_require__(1837);var _clipboardButton2=_interopRequireDefault(_clipboardButton);var _selectors=__webpack_require__(47);var _selectors2=__webpack_require__(277);var _selectors3=__webpack_require__(112);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var EditorPermalink=function(_Component){(0,_inherits3.default)(EditorPermalink,_Component);function EditorPermalink(){(0,_classCallCheck3.default)(this,EditorPermalink);var _this=(0,_possibleConstructorReturn3.default)(this,(EditorPermalink.__proto__||(0,_getPrototypeOf2.default)(EditorPermalink)).apply(this,arguments));_this.showPopover=_this.showPopover.bind(_this);_this.showTooltip=_this.showTooltip.bind(_this);_this.onCopy=_this.onCopy.bind(_this);_this.hideTooltip=_this.hideTooltip.bind(_this);_this.closePopover=_this.closePopover.bind(_this);_this.state={showPopover:false,popoverVisible:false,showCopyConfirmation:false,tooltip:false};return _this}(0,_createClass3.default)(EditorPermalink,[{key:"componentDidUpdate",value:function componentDidUpdate(prevProps,prevState){if(this.state.showPopover!==prevState.showPopover){this.setState({popoverVisible:this.state.showPopover})}}},{key:"componentWillUnmount",value:function componentWillUnmount(){clearTimeout(this.dismissCopyConfirmation)}},{key:"showPopover",value:function showPopover(){this.setState({showPopover:!this.state.showPopover,tooltip:false})}},{key:"showTooltip",value:function showTooltip(){if(!this.state.showPopover){this.setState({tooltip:true})}}},{key:"onCopy",value:function onCopy(){var _this2=this;this.setState({showCopyConfirmation:true});clearTimeout(this.dismissCopyConfirmation);this.dismissCopyConfirmation=setTimeout(function(){_this2.setState({showCopyConfirmation:false})},4e3)}},{key:"hideTooltip",value:function hideTooltip(){this.setState({tooltip:false})}},{key:"closePopover",value:function closePopover(){this.setState({showPopover:false})}},{key:"renderCopyButton",value:function renderCopyButton(){if(!this.state.popoverVisible){return}var _props=this.props;var path=_props.path;var slug=_props.slug;var translate=_props.translate;var label=void 0;if(this.state.showCopyConfirmation){label=translate("Copied!")}else{label=translate("Copy",{context:"verb"})}return _react2.default.createElement(_clipboardButton2.default,{text:path+slug,onCopy:this.onCopy,compact:true},label)}},{key:"render",value:function render(){var translate=this.props.translate;var tooltipMessage=void 0;if(this.props.isEditable){tooltipMessage=translate("Edit post URL")}else{tooltipMessage=translate("View post URL")}return _react2.default.createElement("div",{className:"editor-permalink",onMouseEnter:this.showTooltip,onMouseLeave:this.hideTooltip},_react2.default.createElement(_gridicon2.default,{className:"editor-permalink__toggle",icon:"link",onClick:this.showPopover,ref:"popoverButton"}),_react2.default.createElement(_popover2.default,{isVisible:this.state.showPopover,onClose:this.closePopover,position:"bottom right",context:this.refs&&this.refs.popoverButton,className:"editor-permalink__popover"},_react2.default.createElement(_editorSlug2.default,(0,_extends3.default)({},(0,_pick3.default)(this.props,"path","isEditable"),{onEscEnter:this.closePopover,instanceName:"post-popover"})),this.renderCopyButton()),_react2.default.createElement(_tooltip2.default,{context:this.refs&&this.refs.popoverButton,isVisible:this.state.tooltip,position:"bottom"},tooltipMessage))}}]);return EditorPermalink}(_react.Component);EditorPermalink.propTypes={path:_react.PropTypes.string,isEditable:_react.PropTypes.bool,translate:_react.PropTypes.func,slug:_react.PropTypes.string};exports.default=(0,_reactRedux.connect)(function(state){var siteId=(0,_selectors.getSelectedSiteId)(state);var postId=(0,_selectors2.getEditorPostId)(state);return{slug:(0,_selectors3.getEditedPostSlug)(state,siteId,postId)}})((0,_i18nCalypso.localize)(EditorPermalink));module.exports=exports["default"]},3129:function(module,exports,__webpack_require__){"use strict";var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var React=__webpack_require__(1),pick=__webpack_require__(91),find=__webpack_require__(27),classNames=__webpack_require__(10),isEmpty=__webpack_require__(80);var Accordion=__webpack_require__(1779),Gridicon=__webpack_require__(26),siteUtils=__webpack_require__(208),PostFormats=__webpack_require__(3130);module.exports=React.createClass({displayName:"EditorPostFormatsAccordion",propTypes:{site:React.PropTypes.object,post:React.PropTypes.object,postFormats:React.PropTypes.arrayOf(React.PropTypes.shape({slug:React.PropTypes.string,label:React.PropTypes.string}))},getFormatValue:function getFormatValue(){if(!this.props.post){return}if(this.props.post.format){return this.props.post.format}return siteUtils.getDefaultPostFormat(this.props.site)},getSubtitle:function getSubtitle(){var postFormat;if(!this.props.post||!this.props.postFormats){return this.translate("Loading")}postFormat=find(this.props.postFormats,{slug:this.getFormatValue()||"standard"});if(postFormat){return postFormat.label}return this.translate("Standard",{context:"Post format"})},render:function render(){var classes=classNames("editor-post-formats__accordion",this.props.className,{"is-loading":!this.props.post||!this.props.postFormats});if(isEmpty(this.props.postFormats)){return null}return React.createElement(Accordion,{title:this.translate("Post Format"),subtitle:this.getSubtitle(),icon:React.createElement(Gridicon,{icon:"types"}),className:classes},React.createElement(PostFormats,(0,_extends3.default)({},pick(this.props,"post","postFormats"),{value:this.getFormatValue()})))}})},3130:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _editorThemeHelp=__webpack_require__(2343);var _editorThemeHelp2=_interopRequireDefault(_editorThemeHelp);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var React=__webpack_require__(1);var FormRadio=__webpack_require__(1714),Gridicon=__webpack_require__(26),PostActions=__webpack_require__(1648),stats=__webpack_require__(1651),AccordionSection=__webpack_require__(1759);exports.default=React.createClass({displayName:"EditorPostFormats",propTypes:{post:React.PropTypes.object,value:React.PropTypes.string,postFormats:React.PropTypes.arrayOf(React.PropTypes.shape({slug:React.PropTypes.string,label:React.PropTypes.string}))},getDefaultProps:function getDefaultProps(){return{value:"standard"}},getSelectedPostFormat:function getSelectedPostFormat(){var value=this.props.value;if("standard"===value){return"standard"}var isSupportedFormat=this.getPostFormats().some(function(postFormat){return postFormat.slug===value});if(isSupportedFormat){return value}return"standard"},getPostFormats:function getPostFormats(){var formats=[{slug:"standard",label:this.translate("Standard",{context:"Post format"})}];if(this.props.postFormats){formats=formats.concat(this.props.postFormats)}return formats},getPostFormatIcon:function getPostFormatIcon(postFormat){var icons={aside:"aside",image:"image",video:"video-camera",quote:"quote",link:"link",gallery:"image-multiple",status:"pencil",audio:"audio",chat:"comment"};return icons[postFormat.slug]?icons[postFormat.slug]:"posts"},onChange:function onChange(event){PostActions.edit({format:event.target.value});stats.recordStat("post_format_changed");stats.recordEvent("Changed Post Format",event.target.value)},renderPostFormats:function renderPostFormats(){var selectedFormat=this.getSelectedPostFormat();return this.getPostFormats().map(function(postFormat){return React.createElement("li",{key:postFormat.slug,className:"editor-post-formats__format"},React.createElement("label",null,React.createElement(FormRadio,{name:"format",value:postFormat.slug,checked:postFormat.slug===selectedFormat,onChange:this.onChange}),React.createElement("span",{className:"editor-post-formats__format-label"},React.createElement("span",{className:"editor-post-formats__format-icon"},React.createElement(Gridicon,{icon:this.getPostFormatIcon(postFormat),size:20})),postFormat.label)))},this)},render:function render(){return React.createElement(AccordionSection,null,React.createElement(_editorThemeHelp2.default,{className:"editor-post-formats__help-link"}),React.createElement("ul",{className:"editor-post-formats"},this.renderPostFormats()))}});module.exports=exports["default"]},3131:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactRedux=__webpack_require__(15);var _includes=__webpack_require__(30);var _includes2=_interopRequireDefault(_includes);var _i18nCalypso=__webpack_require__(11);var _selectors=__webpack_require__(47);var _selectors2=__webpack_require__(277);var _selectors3=__webpack_require__(112);var _selectors4=__webpack_require__(390);var _selectors5=__webpack_require__(79);var _button=__webpack_require__(69);var _button2=_interopRequireDefault(_button);var _dialog=__webpack_require__(168);var _dialog2=_interopRequireDefault(_dialog);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var CONFIGURABLE_TYPES=["jetpack-portfolio","jetpack-testimonial"];function EditorPostTypeUnsupported(_ref){var translate=_ref.translate;var types=_ref.types;var type=_ref.type;var typeObject=_ref.typeObject;var writePostPath=_ref.writePostPath;var siteSlug=_ref.siteSlug;if(!types||!type||typeObject){return null}var buttons=[_react2.default.createElement(_button2.default,{href:"/posts/"+siteSlug},translate("Back to My Sites"))];var isConfigurableType=(0,_includes2.default)(CONFIGURABLE_TYPES,type);var helpText=void 0;if(isConfigurableType){switch(type){case"jetpack-portfolio":helpText=translate("Portfolios are not enabled. Open your site settings to activate them.");break;case"jetpack-testimonial":helpText=translate("Testimonials are not enabled. Open your site settings to activate them.");break}buttons.push(_react2.default.createElement(_button2.default,{href:"/settings/writing/"+siteSlug,primary:true},translate("Site Settings")))}else{helpText=translate("To use this post type, please check that your theme and site support it.");buttons.push(_react2.default.createElement(_button2.default,{href:writePostPath,primary:true},translate("Write a Blog Post")))}return _react2.default.createElement(_dialog2.default,{isVisible:true,buttons:buttons,className:"editor-post-type-unsupported"},_react2.default.createElement("h1",null,translate("This post type is not supported")),_react2.default.createElement("p",null,helpText),_react2.default.createElement("p",null,translate("For more information, visit our {{supportLink}}support page on custom content types{{/supportLink}}.",{components:{supportLink:_react2.default.createElement("a",{href:"https://support.wordpress.com/custom-post-types/"})}})))}EditorPostTypeUnsupported.propTypes={translate:_react.PropTypes.func,types:_react.PropTypes.object,type:_react.PropTypes.string,typeObject:_react.PropTypes.object,writePostPath:_react.PropTypes.string,siteSlug:_react.PropTypes.string};exports.default=(0,_reactRedux.connect)(function(state){var siteId=(0,_selectors.getSelectedSiteId)(state);var type=(0,_selectors3.getEditedPostValue)(state,siteId,(0,_selectors2.getEditorPostId)(state),"type");return{type:type,types:(0,_selectors4.getPostTypes)(state,siteId),typeObject:(0,_selectors4.getPostType)(state,siteId,type),writePostPath:(0,_selectors2.getEditorNewPostPath)(state,siteId),siteSlug:(0,_selectors5.getSiteSlug)(state,siteId)}})((0,_i18nCalypso.localize)(EditorPostTypeUnsupported));module.exports=exports["default"]},3132:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _assign=__webpack_require__(5);var _assign2=_interopRequireDefault(_assign);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _reactRedux=__webpack_require__(15);var _i18nCalypso=__webpack_require__(11);var _selectors=__webpack_require__(112);var _selectors2=__webpack_require__(47);var _selectors3=__webpack_require__(277);var _selectors4=__webpack_require__(390);var _queryPostTypes=__webpack_require__(726);var _queryPostTypes2=_interopRequireDefault(_queryPostTypes);var _formatting=__webpack_require__(81);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function EditorPostType(_ref){var translate=_ref.translate;var siteId=_ref.siteId;var isNew=_ref.isNew;var typeSlug=_ref.typeSlug;var type=_ref.type;var label=void 0;if("page"===typeSlug){if(isNew){label=translate("New Page")}else{label=translate("Page",{context:"noun"})}}else if("post"===typeSlug){if(isNew){label=translate("New Post")}else{label=translate("Post",{context:"noun"})}}else if(type){if(isNew){label=type.labels.new_item}else{label=type.labels.singular_name}label=(0,_formatting.decodeEntities)(label)}else{label=translate("Loading")}var classes=(0,_classnames2.default)("editor-post-type",{"is-loading":!label});return _react2.default.createElement("span",{className:classes},siteId&&"page"!==typeSlug&&"post"!==typeSlug&&_react2.default.createElement(_queryPostTypes2.default,{siteId:siteId}),label)}EditorPostType.propTypes={translate:_react.PropTypes.func,siteId:_react.PropTypes.number,isNew:_react.PropTypes.bool,typeSlug:_react.PropTypes.string,type:_react.PropTypes.object};exports.default=(0,_reactRedux.connect)(function(state){var props={isNew:(0,_selectors3.isEditorNewPost)(state)};var site=(0,_selectors2.getSelectedSite)(state);if(!site){return props}props.siteId=site.ID;var post=(0,_selectors.getEditedPost)(state,site.ID,(0,_selectors3.getEditorPostId)(state));if(!post){return props}return(0,_assign2.default)(props,{typeSlug:post.type,type:(0,_selectors4.getPostType)(state,site.ID,post.type)})})((0,_i18nCalypso.localize)(EditorPostType));module.exports=exports["default"]},3133:function(module,exports,__webpack_require__){"use strict";var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _url=__webpack_require__(70);var _url2=_interopRequireDefault(_url);var _omit=__webpack_require__(18);var _omit2=_interopRequireDefault(_omit);var _webPreview=__webpack_require__(763);var _webPreview2=_interopRequireDefault(_webPreview);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var EditorPreview=_react2.default.createClass({displayName:"EditorPreview",_hasTouch:false,propTypes:{showPreview:_react2.default.PropTypes.bool,isSaving:_react2.default.PropTypes.bool,isLoading:_react2.default.PropTypes.bool,previewUrl:_react2.default.PropTypes.string,onClose:_react2.default.PropTypes.func,postId:_react2.default.PropTypes.number},getInitialState:function getInitialState(){return{iframeUrl:"about:blank"}},componentDidUpdate:function componentDidUpdate(prevProps){if(this.didStartSaving(prevProps,this.props)){this.setState({iframeUrl:"about:blank"})}if(this.props.previewUrl&&(this.didFinishSaving(prevProps)||this.didLoad(prevProps)||this.didShowSavedPreviewViaTouch(prevProps))){this.setState({iframeUrl:this.getIframePreviewUrl()})}},componentWillUnmount:function componentWillUnmount(){window.removeEventListener("keydown",this.keyDown)},didStartSaving:function didStartSaving(props,nextProps){if(!props||!nextProps){return false}return nextProps.isSaving&&!props.isSaving},didFinishSaving:function didFinishSaving(prevProps){return prevProps.isSaving&&!this.props.isSaving},didLoad:function didLoad(prevProps){return prevProps&&prevProps.isLoading&&!this.props.isLoading},didShowSavedPreviewViaTouch:function didShowSavedPreviewViaTouch(prevProps){return this._hasTouch&&!prevProps.showPreview&&this.props.showPreview&&!this.props.isSaving&&!this.props.isLoading},getIframePreviewUrl:function getIframePreviewUrl(){var parsed=_url2.default.parse(this.props.previewUrl,true);parsed.query.preview="true";parsed.query.iframe="true";delete parsed.search;return _url2.default.format(parsed)},cleanExternalUrl:function cleanExternalUrl(externalUrl){if(!externalUrl){return null}var parsed=_url2.default.parse(externalUrl,true);parsed.query=(0,_omit2.default)(parsed.query,"preview","iframe","frame-nonce");delete parsed.search;return _url2.default.format(parsed)},render:function render(){return _react2.default.createElement(_webPreview2.default,{showPreview:this.props.showPreview,defaultViewportDevice:"tablet",onClose:this.props.onClose,previewUrl:this.state.iframeUrl,externalUrl:this.cleanExternalUrl(this.props.externalUrl),loadingMessage:"Beep beep boop"})}});module.exports=EditorPreview},3134:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _mixin=__webpack_require__(111);var _mixin2=_interopRequireDefault(_mixin);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"EditorRevisions",mixins:[_mixin2.default],propTypes:{adminUrl:_react2.default.PropTypes.string,revisions:_react2.default.PropTypes.array},getDefaultProps:function getDefaultProps(){return{revisions:[]}},render:function render(){if(!this.props.revisions.length){return null}var lastRevision=this.props.revisions[0];var revisionsLink=this.props.adminUrl+"revision.php?revision="+lastRevision;return _react2.default.createElement("a",{className:"editor-revisions",href:revisionsLink,target:"_blank",rel:"noopener noreferrer","aria-label":this.translate("Open list of revisions")},_react2.default.createElement(_gridicon2.default,{icon:"history",size:18}),this.translate("%(revisions)d revision","%(revisions)d revisions",{count:this.props.revisions.length,args:{revisions:this.props.revisions.length}}))}});module.exports=exports["default"]},3135:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _i18nCalypso=__webpack_require__(11);var _accordion=__webpack_require__(1779);var _accordion2=_interopRequireDefault(_accordion);var _section=__webpack_require__(1759);var _section2=_interopRequireDefault(_section);var _countedTextarea=__webpack_require__(1780);var _countedTextarea2=_interopRequireDefault(_countedTextarea);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _actions=__webpack_require__(1648);var _actions2=_interopRequireDefault(_actions);var _label=__webpack_require__(1915);var _label2=_interopRequireDefault(_label);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function EditorSeoAccordion(_ref){var translate=_ref.translate;var _ref$metaDescription=_ref.metaDescription;var metaDescription=_ref$metaDescription===undefined?"":_ref$metaDescription;return _react2.default.createElement(_accordion2.default,{title:translate("Advanced SEO"),icon:_react2.default.createElement(_gridicon2.default,{icon:"search"}),className:"editor-seo-accordion"},_react2.default.createElement(_section2.default,null,_react2.default.createElement(_label2.default,{helpText:translate("Craft a description of your post for search engine results. "+"The post content is used by default."),labelText:translate("Meta Description")},_react2.default.createElement(_countedTextarea2.default,{maxLength:"300",acceptableLength:159,placeholder:translate("Write a description"),"aria-label":translate("Write a description"),value:metaDescription,onChange:onMetaChange}))))}function onMetaChange(event){_actions2.default.updateMetadata({advanced_seo_description:event.target.value})}EditorSeoAccordion.propTypes={translate:_react.PropTypes.func,metaDescription:_react.PropTypes.string};exports.default=(0,_i18nCalypso.localize)(EditorSeoAccordion);module.exports=exports["default"]},3136:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _includes2=__webpack_require__(30);var _includes3=_interopRequireDefault(_includes2);var _map2=__webpack_require__(45);var _map3=_interopRequireDefault(_map2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _reactRedux=__webpack_require__(15);var _redux=__webpack_require__(6);var _accordion=__webpack_require__(1779);var _accordion2=_interopRequireDefault(_accordion);var _formTextInput=__webpack_require__(206);var _formTextInput2=_interopRequireDefault(_formTextInput);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _serviceConnections=__webpack_require__(1788);var _serviceConnections2=_interopRequireDefault(_serviceConnections);var _postMetadata=__webpack_require__(759);var _postMetadata2=_interopRequireDefault(_postMetadata);var _=__webpack_require__(3137);var _2=_interopRequireDefault(_);var _section=__webpack_require__(1759);var _section2=_interopRequireDefault(_section);var _utils=__webpack_require__(1649);var _utils2=_interopRequireDefault(_utils);var _queryPublicizeConnections=__webpack_require__(2035);var _queryPublicizeConnections2=_interopRequireDefault(_queryPublicizeConnections);var _selectors=__webpack_require__(90);var _selectors2=__webpack_require__(47);var _selectors3=__webpack_require__(277);var _selectors4=__webpack_require__(112);var _selectors5=__webpack_require__(79);var _selectors6=__webpack_require__(1861);var _selectors7=__webpack_require__(390);var _actions=__webpack_require__(1860);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var EditorSharingAccordion=_react2.default.createClass({displayName:"EditorSharingAccordion",propTypes:{site:_react.PropTypes.object,post:_react.PropTypes.object,isNew:_react.PropTypes.bool,connections:_react.PropTypes.array,isPublicizeEnabled:_react.PropTypes.bool,isSharingActive:_react.PropTypes.bool,isLikesActive:_react.PropTypes.bool},getSubtitle:function getSubtitle(){var _props=this.props;var isPublicizeEnabled=_props.isPublicizeEnabled;var post=_props.post;var connections=_props.connections;if(!isPublicizeEnabled||!post||!connections){return}var skipped=_postMetadata2.default.publicizeSkipped(post);var targeted=connections.filter(function(connection){return!(0,_includes3.default)(skipped,connection.keyring_connection_ID)});var targetedServices=_serviceConnections2.default.getServicesFromConnections(targeted);return(0,_map3.default)(targetedServices,"label").join(", ")},renderShortUrl:function renderShortUrl(){var classes=(0,_classnames2.default)("editor-sharing__shortlink",{"is-standalone":this.hideSharing()});if(!_utils2.default.isPublished(this.props.post)){return null}return _react2.default.createElement("div",{className:classes},_react2.default.createElement("label",{className:"editor-sharing__shortlink-label",htmlFor:"shortlink-field"},this.translate("Shortlink")),_react2.default.createElement(_formTextInput2.default,{className:"editor-sharing__shortlink-field",id:"shortlink-field",value:this.props.post.short_URL,size:this.props.post.short_URL&&this.props.post.short_URL.length,readOnly:true,selectOnFocus:true}))},hideSharing:function hideSharing(){var _props2=this.props;var isSharingActive=_props2.isSharingActive;var isLikesActive=_props2.isLikesActive;var isPublicizeEnabled=_props2.isPublicizeEnabled;return!isSharingActive&&!isLikesActive&&!isPublicizeEnabled},render:function render(){var hideSharing=this.hideSharing();var classes=(0,_classnames2.default)("editor-sharing__accordion",this.props.className,{"is-loading":!this.props.post||!this.props.connections});if(hideSharing&&!_utils2.default.isPublished(this.props.post)){return null}return _react2.default.createElement(_accordion2.default,{title:this.translate("Sharing"),subtitle:this.getSubtitle(),icon:_react2.default.createElement(_gridicon2.default,{icon:"share"}),className:classes},this.props.site&&_react2.default.createElement(_queryPublicizeConnections2.default,{siteId:this.props.site.ID}),_react2.default.createElement(_section2.default,null,!hideSharing&&_react2.default.createElement(_2.default,{site:this.props.site,post:this.props.post}),this.renderShortUrl()))}});exports.default=(0,_reactRedux.connect)(function(state){var siteId=(0,_selectors2.getSelectedSiteId)(state);var userId=(0,_selectors.getCurrentUserId)(state);var postId=(0,_selectors3.getEditorPostId)(state);var postType=(0,_selectors4.getEditedPostValue)(state,siteId,postId,"type");var isPublicizeEnabled=false!==(0,_selectors5.isJetpackModuleActive)(state,siteId,"publicize")&&true!==(0,_selectors5.getSiteOption)(state,siteId,"publicize_permanently_disabled")&&(0,_selectors7.postTypeSupports)(state,siteId,postType,"publicize");var isSharingActive=false!==(0,_selectors5.isJetpackModuleActive)(state,siteId,"sharedaddy");var isLikesActive=false!==(0,_selectors5.isJetpackModuleActive)(state,siteId,"likes");return{connections:(0,_selectors6.getSiteUserConnections)(state,siteId,userId),isSharingActive:isSharingActive,isLikesActive:isLikesActive,isPublicizeEnabled:isPublicizeEnabled}},function(dispatch){return(0,_redux.bindActionCreators)({requestConnections:_actions.fetchConnections},dispatch)})(EditorSharingAccordion);module.exports=exports["default"]},3137:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=EditorSharing;var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _publicizeOptions=__webpack_require__(3139);var _publicizeOptions2=_interopRequireDefault(_publicizeOptions);var _sharingLikeOptions=__webpack_require__(3141);var _sharingLikeOptions2=_interopRequireDefault(_sharingLikeOptions);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function EditorSharing(_ref){var post=_ref.post;var site=_ref.site;return _react2.default.createElement("div",{className:"editor-sharing"},_react2.default.createElement(_publicizeOptions2.default,{post:post,site:site}),_react2.default.createElement(_sharingLikeOptions2.default,{post:post,site:site}))}EditorSharing.propTypes={site:_react.PropTypes.object,post:_react.PropTypes.object};module.exports=exports["default"]},3138:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _includes=__webpack_require__(30);var _includes2=_interopRequireDefault(_includes);var _formCheckbox=__webpack_require__(1654);var _formCheckbox2=_interopRequireDefault(_formCheckbox);var _postMetadata=__webpack_require__(759);var _postMetadata2=_interopRequireDefault(_postMetadata);var _actions=__webpack_require__(1648);var _actions2=_interopRequireDefault(_actions);var _stats=__webpack_require__(1651);var PostStats=_interopRequireWildcard(_stats);var _notice=__webpack_require__(76);var _notice2=_interopRequireDefault(_notice);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"EditorSharingPublicizeConnection",propTypes:{post:_react.PropTypes.object,connection:_react.PropTypes.object,onRefresh:_react.PropTypes.func},getDefaultProps:function getDefaultProps(){return{onRefresh:function onRefresh(){}}},isConnectionSkipped:function isConnectionSkipped(){var _props=this.props;var post=_props.post;var connection=_props.connection;return post&&connection&&(0,_includes2.default)(_postMetadata2.default.publicizeSkipped(post),connection.keyring_connection_ID)},isConnectionDone:function isConnectionDone(){var _props2=this.props;var post=_props2.post;var connection=_props2.connection;return post&&connection&&(0,_includes2.default)(_postMetadata2.default.publicizeDone(post),connection.keyring_connection_ID)},isDisabled:function isDisabled(){var connection=this.props.connection;return!connection||connection.read_only},onChange:function onChange(event){var connection=this.props.connection;if(!connection){return}if(event.target.checked){_actions2.default.deleteMetadata("_wpas_skip_"+connection.keyring_connection_ID);PostStats.recordStat("sharing_enabled_"+connection.service);PostStats.recordEvent("Publicize Service",connection.service,"enabled")}else{_actions2.default.updateMetadata("_wpas_skip_"+connection.keyring_connection_ID,1);PostStats.recordStat("sharing_disabled_"+connection.service);PostStats.recordEvent("Publicize Service",connection.service,"disabled")}},renderBrokenConnection:function renderBrokenConnection(){var connection=this.props.connection;if(!connection||connection.status!=="broken"){return}return _react2.default.createElement(_notice2.default,{className:"editor-sharing__broken-publicize-connection",status:"is-warning",showDismiss:false},this.translate("There is an issue connecting to %s. {{button}}Reconnect {{icon/}}{{/button}}",{args:connection.label,components:{button:_react2.default.createElement("button",{type:"button",onClick:this.props.onRefresh,className:"editor-sharing__broken-publicize-connection-button"}),icon:_react2.default.createElement(_gridicon2.default,{icon:"external",size:18})}}))},render:function render(){var connection=this.props.connection;return _react2.default.createElement("div",{className:"editor-sharing__publicize-connection"},_react2.default.createElement("label",null,_react2.default.createElement(_formCheckbox2.default,{checked:!this.isConnectionSkipped(),disabled:this.isDisabled(),onChange:this.onChange}),_react2.default.createElement("span",null,connection&&connection.external_display)),this.renderBrokenConnection())}});module.exports=exports["default"]},3139:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _map2=__webpack_require__(45);var _map3=_interopRequireDefault(_map2);var _includes2=__webpack_require__(30);var _includes3=_interopRequireDefault(_includes2);var _get2=__webpack_require__(24);var _get3=_interopRequireDefault(_get2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactRedux=__webpack_require__(15);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _queryPostTypes=__webpack_require__(726);var _queryPostTypes2=_interopRequireDefault(_queryPostTypes);var _publicizeMessage=__webpack_require__(2153);var _publicizeMessage2=_interopRequireDefault(_publicizeMessage);var _publicizeServices=__webpack_require__(3140);
var _publicizeServices2=_interopRequireDefault(_publicizeServices);var _paths=__webpack_require__(393);var paths=_interopRequireWildcard(_paths);var _postMetadata=__webpack_require__(759);var _postMetadata2=_interopRequireDefault(_postMetadata);var _popupMonitor=__webpack_require__(1979);var _popupMonitor2=_interopRequireDefault(_popupMonitor);var _button=__webpack_require__(69);var _button2=_interopRequireDefault(_button);var _utils=__webpack_require__(208);var _utils2=_interopRequireDefault(_utils);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _stats=__webpack_require__(1651);var _selectors=__webpack_require__(47);var _selectors2=__webpack_require__(277);var _selectors3=__webpack_require__(79);var _selectors4=__webpack_require__(112);var _selectors5=__webpack_require__(390);var _selectors6=__webpack_require__(90);var _selectors7=__webpack_require__(1861);var _actions=__webpack_require__(1860);var _config=__webpack_require__(12);var _config2=_interopRequireDefault(_config);var _notice=__webpack_require__(76);var _notice2=_interopRequireDefault(_notice);var _noticeAction=__webpack_require__(134);var _noticeAction2=_interopRequireDefault(_noticeAction);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var EditorSharingPublicizeOptions=_react2.default.createClass({displayName:"EditorSharingPublicizeOptions",connectionPopupMonitor:false,jetpackModulePopupMonitor:false,propTypes:{site:_react.PropTypes.object,post:_react.PropTypes.object,siteId:_react.PropTypes.number,isPublicizeEnabled:_react.PropTypes.bool,connections:_react.PropTypes.array,requestConnections:_react.PropTypes.func},hasConnections:function hasConnections(){return this.props.connections&&this.props.connections.length},componentWillUnmount:function componentWillUnmount(){if(this.connectionPopupMonitor){this.connectionPopupMonitor.off("close",this.onNewConnectionPopupClosed)}if(this.jetpackModulePopupMonitor){this.jetpackModulePopupMonitor.off("close",this.onModuleConnectionPopupClosed)}},newConnectionPopup:function newConnectionPopup(){var href=void 0;if(!this.props.site){return}href=paths.publicizeConnections(this.props.site);if(!this.connectionPopupMonitor){this.connectionPopupMonitor=new _popupMonitor2.default}this.connectionPopupMonitor.open(href);this.connectionPopupMonitor.once("close",this.onNewConnectionPopupClosed)},onNewConnectionPopupClosed:function onNewConnectionPopupClosed(){this.props.requestConnections(this.props.site.ID)},newConnection:function newConnection(){this.newConnectionPopup();(0,_stats.recordStat)("sharing_create_service");(0,_stats.recordEvent)("Opened Create New Sharing Service Dialog")},jetpackModulePopup:function jetpackModulePopup(){var href=void 0;if(!this.props.site||!this.props.site.jetpack){return}href=paths.jetpackModules(this.props.site,"publicize");if(!this.jetpackModulePopupMonitor){this.jetpackModulePopupMonitor=new _popupMonitor2.default}this.jetpackModulePopupMonitor.open(href);this.jetpackModulePopupMonitor.once("close",this.onModuleConnectionPopupClosed)},onModuleConnectionPopupClosed:function onModuleConnectionPopupClosed(){var _this=this;if(!this.props.site||!this.props.site.jetpack){return}this.props.site.once("change",function(){if(_this.props.site.isModuleActive("publicize")){_this.props.requestConnections(_this.props.site.ID)}})},renderServices:function renderServices(){if(!this.props.site||!this.hasConnections()){return}return _react2.default.createElement(_publicizeServices2.default,{post:this.props.post,siteId:this.props.site.ID,connections:this.props.connections,newConnectionPopup:this.newConnectionPopup})},renderMessage:function renderMessage(){var preview=(0,_get3.default)(this.props.post,"title"),skipped=this.hasConnections()?_postMetadata2.default.publicizeSkipped(this.props.post):[],targeted=this.hasConnections()?this.props.connections.filter(function(connection){return skipped&&-1===skipped.indexOf(connection.keyring_connection_ID)}):[],requireCount=(0,_includes3.default)((0,_map3.default)(targeted,"service"),"twitter"),acceptableLength=requireCount?140-23-23:null;if(!this.hasConnections()){return}return _react2.default.createElement(_publicizeMessage2.default,{message:_postMetadata2.default.publicizeMessage(this.props.post),preview:preview,requireCount:requireCount,acceptableLength:acceptableLength})},renderAddNewButton:function renderAddNewButton(){if(!_utils2.default.userCan("publish_posts",this.props.site)){return}return _react2.default.createElement(_button2.default,{borderless:true,compact:true,onClick:this.newConnection},_react2.default.createElement(_gridicon2.default,{icon:"add"})," ",this.translate("Connect new service"),_react2.default.createElement("span",{className:"editor-sharing__external-link-indicator"},_react2.default.createElement(_gridicon2.default,{icon:"external",size:18})))},renderInfoNotice:function renderInfoNotice(){if(!this.hasConnections()&&!_utils2.default.userCan("publish_posts",this.props.site)){return}return _react2.default.createElement("p",{className:"editor-drawer__description"},this.translate("Connect and select social media services to automatically share this post."))},republicizePost:function republicizePost(){var skipped=_postMetadata2.default.publicizeSkipped(this.props.post);var message=_postMetadata2.default.publicizeMessage(this.props.post);this.props.sharePost(this.props.siteId,this.props.post.ID,skipped,message)},renderRepublicize:function renderRepublicize(){return _react2.default.createElement(_button2.default,{className:"button editor-sharing__publicize-share-button",disabled:this.props.connections.length-_postMetadata2.default.publicizeSkipped(this.props.post).length<1||this.props.requesting,onClick:this.republicizePost},this.translate("Share"))},dismissRepublicizeMessage:function dismissRepublicizeMessage(){this.props.dismissShareConfirmation(this.props.siteId,this.props.post.ID)},render:function render(){if(!this.props.isPublicizeEnabled){return null}if(this.props.site&&this.props.site.options.publicize_permanently_disabled){return _react2.default.createElement("div",{className:"editor-sharing__publicize-disabled"},_react2.default.createElement("p",null,_react2.default.createElement("span",null,this.translate("Publicize is disabled on this site."))))}if(this.props.site&&this.props.site.jetpack&&!this.props.site.isModuleActive("publicize")){return _react2.default.createElement("div",{className:"editor-sharing__publicize-disabled"},_react2.default.createElement("p",null,_react2.default.createElement("span",null,this.translate("Enable the Publicize module to automatically share new posts to social networks."))),_react2.default.createElement("button",{className:"editor-sharing__jetpack-modules-button button is-secondary",onClick:this.jetpackModulePopup},this.translate("View Module Settings")))}var classes=(0,_classnames2.default)("editor-sharing__publicize-options",{"has-connections":this.hasConnections(),"has-add-option":_utils2.default.userCan("publish_posts",this.props.site)});return _react2.default.createElement("div",{className:classes},this.props.siteId&&_react2.default.createElement(_queryPostTypes2.default,{siteId:this.props.siteId}),this.renderInfoNotice(),this.renderServices(),this.renderAddNewButton(),this.renderMessage(),this.props.requesting&&_react2.default.createElement(_notice2.default,{isCompact:true,status:"is-warning"},this.translate("Hang tight, socializing your media...")),this.props.success&&_react2.default.createElement(_notice2.default,{isCompact:true,status:"is-success",text:this.translate("It went out! Your social media is on fire!")},_react2.default.createElement(_noticeAction2.default,{onClick:this.dismissRepublicizeMessage},this.translate("X"))),this.props.failure&&_react2.default.createElement(_notice2.default,{isCompact:true,status:"is-error",text:this.translate("Something went wrong. Please dont be mad.")},_react2.default.createElement(_noticeAction2.default,{onClick:this.dismissRepublicizeMessage},this.translate("X"))),_config2.default.isEnabled("republicize")&&this.props.post&&this.props.post.status==="publish"&&this.renderRepublicize())}});exports.default=(0,_reactRedux.connect)(function(state){var siteId=(0,_selectors.getSelectedSiteId)(state);var userId=(0,_selectors6.getCurrentUserId)(state);var postId=(0,_selectors2.getEditorPostId)(state);var postType=(0,_selectors4.getEditedPostValue)(state,siteId,postId,"type");var isPublicizeEnabled=false!==(0,_selectors3.isJetpackModuleActive)(state,siteId,"publicize")&&(0,_selectors5.postTypeSupports)(state,siteId,postType,"publicize");return{siteId:siteId,isPublicizeEnabled:isPublicizeEnabled,connections:(0,_selectors7.getSiteUserConnections)(state,siteId,userId),requesting:(0,_selectors7.isRequestingSharePost)(state,siteId,postId),failed:(0,_selectors7.sharePostFailure)(state,siteId,postId),success:(0,_selectors7.sharePostSuccessMessage)(state,siteId,postId)}},{requestConnections:_actions.fetchConnections,sharePost:_actions.sharePost,dismissShareConfirmation:_actions.dismissShareConfirmation})(EditorSharingPublicizeOptions);module.exports=exports["default"]},3140:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1);var serviceConnections=__webpack_require__(1788),EditorSharingPublicizeConnection=__webpack_require__(3138);module.exports=React.createClass({displayName:"EditorSharingPublicizeServices",propTypes:{post:React.PropTypes.object,siteId:React.PropTypes.number.isRequired,connections:React.PropTypes.array.isRequired,newConnectionPopup:React.PropTypes.func.isRequired},renderServices:function renderServices(){var services=serviceConnections.getServicesFromConnections(this.props.connections);return services.map(function(service){return React.createElement("li",{key:service.ID,className:"editor-sharing__publicize-service"},React.createElement("h5",{className:"editor-sharing__publicize-service-heading"},service.label),this.renderConnections(service.ID))},this)},renderConnections:function renderConnections(serviceName){var connections=serviceConnections.getConnectionsAvailableToCurrentUser(serviceName,this.props.connections);return connections.map(function(connection){return React.createElement(EditorSharingPublicizeConnection,{key:connection.ID,post:this.props.post,connection:connection,onRefresh:this.props.newConnectionPopup})},this)},render:function render(){return React.createElement("ul",{className:"editor-sharing__publicize-services"},this.renderServices())}})},3141:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _defineProperty2=__webpack_require__(7);var _defineProperty3=_interopRequireDefault(_defineProperty2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactRedux=__webpack_require__(15);var _editorFieldset=__webpack_require__(2341);var _editorFieldset2=_interopRequireDefault(_editorFieldset);var _formCheckbox=__webpack_require__(1654);var _formCheckbox2=_interopRequireDefault(_formCheckbox);var _actions=__webpack_require__(1648);var _actions2=_interopRequireDefault(_actions);var _stats=__webpack_require__(1651);var _selectors=__webpack_require__(277);var _selectors2=__webpack_require__(47);var _selectors3=__webpack_require__(79);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var SharingLikeOptions=_react2.default.createClass({displayName:"SharingLikeOptions",propTypes:{site:_react2.default.PropTypes.object,post:_react2.default.PropTypes.object,isSharingButtonsEnabled:_react2.default.PropTypes.bool,isLikesEnabled:_react2.default.PropTypes.bool,isNew:_react2.default.PropTypes.bool},isShowingSharingButtons:function isShowingSharingButtons(){if(this.props.post&&"sharing_enabled"in this.props.post){return this.props.post.sharing_enabled}if(this.props.site&&this.props.isNew){return this.props.site.options.default_sharing_status}return true},isShowingLikeButton:function isShowingLikeButton(){if(this.props.post&&"likes_enabled"in this.props.post){return this.props.post.likes_enabled}if(this.props.site&&this.props.isNew){return this.props.site.options.default_likes_enabled}return true},renderSharingButtonField:function renderSharingButtonField(){if(!this.props.isSharingButtonsEnabled){return}return _react2.default.createElement("label",null,_react2.default.createElement(_formCheckbox2.default,{name:"sharing_enabled",checked:this.isShowingSharingButtons(),onChange:this.onChange}),_react2.default.createElement("span",null,this.translate("Show Sharing Buttons",{context:"Post Editor"})))},renderLikesButtonField:function renderLikesButtonField(){if(!this.props.isLikesEnabled){return}return _react2.default.createElement("label",null,_react2.default.createElement(_formCheckbox2.default,{name:"likes_enabled",checked:this.isShowingLikeButton(),onChange:this.onChange}),_react2.default.createElement("span",null,this.translate("Show Like Button",{context:"Post Editor"})))},onChange:function onChange(event){_actions2.default.edit((0,_defineProperty3.default)({},event.target.name,event.target.checked));this.recordStats(event)},recordStats:function recordStats(event){var mcStat=event.target.name,eventStat="sharing_enabled"===event.target.name?"Sharing Buttons":"Like Button";mcStat+=event.target.checked?"_enabled":"_disabled";eventStat+=event.target.checked?" Enabled":" Disabled";(0,_stats.recordStat)(mcStat);(0,_stats.recordEvent)(eventStat)},render:function render(){if(!this.props.isSharingButtonsEnabled&&!this.props.isLikesEnabled){return null}return _react2.default.createElement(_editorFieldset2.default,{className:"editor-sharing__sharing-like-options",legend:this.translate("Sharing Buttons & Likes")},this.renderSharingButtonField(),this.renderLikesButtonField())}});exports.default=(0,_reactRedux.connect)(function(state){var siteId=(0,_selectors2.getSelectedSiteId)(state);return{isSharingButtonsEnabled:false!==(0,_selectors3.isJetpackModuleActive)(state,siteId,"sharedaddy"),isLikesEnabled:false!==(0,_selectors3.isJetpackModuleActive)(state,siteId,"likes"),isNew:(0,_selectors.isEditorNewPost)(state)}})(SharingLikeOptions);module.exports=exports["default"]},3142:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _reactRedux=__webpack_require__(15);var _redux=__webpack_require__(6);var _get=__webpack_require__(24);var _get2=_interopRequireDefault(_get);var _page=__webpack_require__(33);var _page2=_interopRequireDefault(_page);var _i18nCalypso=__webpack_require__(11);var _selectors=__webpack_require__(47);var _selectors2=__webpack_require__(112);var _selectors3=__webpack_require__(277);var _actions=__webpack_require__(2183);var _button=__webpack_require__(69);var _button2=_interopRequireDefault(_button);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _draftsButton=__webpack_require__(3100);var _draftsButton2=_interopRequireDefault(_draftsButton);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function EditorSidebarHeader(_ref){var translate=_ref.translate;var type=_ref.type;var showDrafts=_ref.showDrafts;var toggleDrafts=_ref.toggleDrafts;var allPostsUrl=_ref.allPostsUrl;var toggleSidebar=_ref.toggleSidebar;var className=(0,_classnames2.default)("editor-sidebar__header",{"is-drafts-visible":showDrafts});var closeLabel=translate("Back");var closeButtonAction=_page2.default.back.bind(_page2.default,allPostsUrl);var closeButtonUrl="";var closeButtonAriaLabel=translate("Go back");return _react2.default.createElement("div",{className:className},showDrafts&&_react2.default.createElement(_button2.default,{compact:true,borderless:true,className:"editor-sidebar__close",onClick:toggleDrafts,"aria-label":translate("Close drafts list")},_react2.default.createElement(_gridicon2.default,{icon:"cross"}),translate("Close")),!showDrafts&&_react2.default.createElement(_button2.default,{compact:true,borderless:true,className:"editor-sidebar__close",href:closeButtonUrl,onClick:closeButtonAction,"aria-label":closeButtonAriaLabel},_react2.default.createElement(_gridicon2.default,{icon:"arrow-left",size:18}),closeLabel),type==="post"&&_react2.default.createElement(_draftsButton2.default,{onClick:toggleDrafts}),_react2.default.createElement(_button2.default,{onClick:toggleSidebar,className:"editor-sidebar__toggle-sidebar"},_react2.default.createElement("span",null,translate("Write"))))}EditorSidebarHeader.propTypes={translate:_react.PropTypes.func,type:_react.PropTypes.string,showDrafts:_react.PropTypes.bool,toggleDrafts:_react.PropTypes.func,allPostsUrl:_react.PropTypes.string,toggleSidebar:_react.PropTypes.func};exports.default=(0,_reactRedux.connect)(function(state){var siteId=(0,_selectors.getSelectedSiteId)(state);var postId=(0,_selectors3.getEditorPostId)(state);return{type:(0,_get2.default)((0,_selectors2.getEditedPost)(state,siteId,postId),"type"),showDrafts:(0,_selectors3.isEditorDraftsVisible)(state)}},function(dispatch){return(0,_redux.bindActionCreators)({toggleDrafts:_actions.toggleEditorDraftsVisible},dispatch)})((0,_i18nCalypso.localize)(EditorSidebarHeader));module.exports=exports["default"]},3143:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _noop=__webpack_require__(38);var _noop2=_interopRequireDefault(_noop);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _mixin=__webpack_require__(111);var _mixin2=_interopRequireDefault(_mixin);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _utils=__webpack_require__(1649);var _utils2=_interopRequireDefault(_utils);var _placeholder=__webpack_require__(3144);var _placeholder2=_interopRequireDefault(_placeholder);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"StatusLabel",propTypes:{onClick:_react2.default.PropTypes.func,post:_react2.default.PropTypes.object,type:_react2.default.PropTypes.string},mixins:[_mixin2.default],getDefaultProps:function getDefaultProps(){return{onClick:_noop2.default,post:null,advancedStatus:false,type:"post"}},getInitialState:function getInitialState(){return{currentTime:Date.now()}},componentDidMount:function componentDidMount(){this.currentTimeTimer=setInterval(this.updateCurrentTime,6e4)},componentWillReceiveProps:function componentWillReceiveProps(nextProps){if(nextProps.post!==this.props.post){this.updateCurrentTime()}},componentWillUnmount:function componentWillUnmount(){clearInterval(this.currentTimeTimer)},render:function render(){var statusClass="editor-status-label";if(!this.props.post){return _react2.default.createElement(_placeholder2.default,{className:statusClass})}statusClass=(0,_classnames2.default)(statusClass,"is-"+this.props.post.status);return _react2.default.createElement("button",{className:statusClass,onClick:this.props.onClick,ref:"statusLabel","aria-label":this.translate("Show advanced status details"),"aria-pressed":!!this.props.advancedStatus},_react2.default.createElement(_gridicon2.default,{icon:"cog",size:16}),this.renderLabel())},renderLabel:function renderLabel(){var post=this.props.post,editedTime=this.moment(_utils2.default.getEditedTime(post)),label;if(!post.modified){return this.translate("New Draft")}if("draft"===post.status&&editedTime.isAfter(this.state.currentTime)){editedTime=this.moment(this.state.currentTime)}var timeFromNow=editedTime.from(this.state.currentTime);switch(post.status){case"publish":label=this.translate("{{strong}}Published{{/strong}} %(relativeTimeFromNow)s",{args:{relativeTimeFromNow:timeFromNow},components:{strong:_react2.default.createElement("strong",null)}});break;case"private":label=this.translate("{{strong}}Published Privately{{/strong}} %(relativeTimeFromNow)s",{args:{relativeTimeFromNow:timeFromNow},components:{strong:_react2.default.createElement("strong",null)}});break;case"draft":label=this.translate("{{strong}}Draft saved{{/strong}} %(relativeTimeFromNow)s",{args:{relativeTimeFromNow:timeFromNow},components:{strong:_react2.default.createElement("strong",null)}});break;case"pending":label=this.translate("{{strong}}Pending Review{{/strong}} %(relativeTimeFromNow)s",{args:{relativeTimeFromNow:timeFromNow},components:{strong:_react2.default.createElement("strong",null)}});break;case"future":label=this.translate("{{strong}}Scheduled{{/strong}} %(relativeTimeFromNow)s",{args:{relativeTimeFromNow:timeFromNow},components:{strong:_react2.default.createElement("strong",null)}});break;case"trash":label=this.translate("{{strong}}Trashed{{/strong}}",{components:{strong:_react2.default.createElement("strong",null)}});break;default:label="";break}return label},updateCurrentTime:function updateCurrentTime(){this.setState({currentTime:Date.now()})}});module.exports=exports["default"]},3144:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _assign=__webpack_require__(5);var _assign2=_interopRequireDefault(_assign);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactRedux=__webpack_require__(15);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _i18nCalypso=__webpack_require__(11);var _selectors=__webpack_require__(112);var _selectors2=__webpack_require__(390);var _selectors3=__webpack_require__(277);var _selectors4=__webpack_require__(47);var _formatting=__webpack_require__(81);var _queryPostTypes=__webpack_require__(726);var _queryPostTypes2=_interopRequireDefault(_queryPostTypes);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function EditorStatusLabelPlaceholder(_ref){var translate=_ref.translate;var siteId=_ref.siteId;var typeSlug=_ref.typeSlug;var type=_ref.type;var className=_ref.className;var classes=(0,_classnames2.default)("editor-status-label__placeholder",className);var label=void 0;if("post"===typeSlug){label=translate("Loading Post")}else if("page"===typeSlug){label=translate("Loading Page")}else if(type){label=translate("Loading %(postType)s",{args:{postType:(0,_formatting.decodeEntities)(type.labels.singular_name)}})}else{label=translate("Loading")}return _react2.default.createElement("button",{className:classes},"post"!==typeSlug&&"page"!==typeSlug&&siteId&&_react2.default.createElement(_queryPostTypes2.default,{siteId:siteId}),_react2.default.createElement("strong",null,label))}EditorStatusLabelPlaceholder.propTypes={translate:_react.PropTypes.func,siteId:_react.PropTypes.number,typeSlug:_react.PropTypes.string,type:_react.PropTypes.object,className:_react.PropTypes.string};exports.default=(0,_reactRedux.connect)(function(state){var siteId=(0,_selectors4.getSelectedSiteId)(state);var props={siteId:siteId};var post=(0,_selectors.getEditedPost)(state,siteId,(0,_selectors3.getEditorPostId)(state));if(!post){return props}return(0,_assign2.default)(props,{typeSlug:post.type,type:(0,_selectors2.getPostType)(state,siteId,post.type)})})((0,_i18nCalypso.localize)(EditorStatusLabelPlaceholder));module.exports=exports["default"]},3145:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _actions=__webpack_require__(1648);var _actions2=_interopRequireDefault(_actions);var _tooltip=__webpack_require__(722);var _tooltip2=_interopRequireDefault(_tooltip);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _button=__webpack_require__(69);var _button2=_interopRequireDefault(_button);var _stats=__webpack_require__(1651);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"EditorSticky",propTypes:{post:_react2.default.PropTypes.object},getInitialState:function getInitialState(){return{tooltip:false}},toggleStickyStatus:function toggleStickyStatus(){var stickyStat=void 0;var stickyEventLabel=void 0;if(!this.props.post.sticky){stickyStat="advanced_sticky_enabled_toolbar";stickyEventLabel="On"}else{stickyStat="advanced_sticky_disabled_toolbar";stickyEventLabel="Off"}(0,_stats.recordStat)(stickyStat);(0,_stats.recordEvent)("Changed Sticky Setting",stickyEventLabel);_actions2.default.edit({sticky:!this.props.post.sticky});this.setState({tooltip:false})},render:function render(){var _this=this;var classes=(0,_classnames2.default)("editor-sticky",{"is-sticky":this.props.post&&this.props.post.sticky});return _react2.default.createElement(_button2.default,{borderless:true,className:classes,onClick:this.toggleStickyStatus,onMouseEnter:function onMouseEnter(){return _this.setState({tooltip:true})},onMouseLeave:function onMouseLeave(){return _this.setState({tooltip:false})},"aria-label":this.translate("Stick post to the front page"),ref:"stickyPostButton"},_react2.default.createElement(_gridicon2.default,{icon:"bookmark"}),_react2.default.createElement(_tooltip2.default,{className:"editor-sticky__tooltip",context:this.refs&&this.refs.stickyPostButton,isVisible:this.state.tooltip,position:"bottom left"},this.props.post&&this.props.post.sticky?_react2.default.createElement("span",null,this.translate("Marked as sticky")):_react2.default.createElement("div",null,this.translate("Mark as sticky"),_react2.default.createElement("span",{className:"editor-sticky__explanation"},this.translate("Displayed at top")))))}});module.exports=exports["default"]},3146:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _mixin=__webpack_require__(111);var _mixin2=_interopRequireDefault(_mixin);var _postEditStore=__webpack_require__(1687);var _postEditStore2=_interopRequireDefault(_postEditStore);var _=__webpack_require__(3147);var _2=_interopRequireDefault(_);var _sitesList=__webpack_require__(53);var _sitesList2=_interopRequireDefault(_sitesList);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var sites=(0,_sitesList2.default)();exports.default=_react2.default.createClass({displayName:"EditorTitleContainer",mixins:[_mixin2.default],getInitialState:function getInitialState(){return this.getState()},componentDidMount:function componentDidMount(){_postEditStore2.default.on("change",this.updateState);sites.on("change",this.updateState)},componentWillUnmount:function componentWillUnmount(){_postEditStore2.default.off("change",this.updateState);sites.off("change",this.updateState)},getState:function getState(){return{post:_postEditStore2.default.get(),site:sites.getSelectedSite()||null,isNew:_postEditStore2.default.isNew()}},updateState:function updateState(){this.setState(this.getState())},render:function render(){return _react2.default.createElement(_2.default,(0,_extends3.default)({},this.props,this.state))}});module.exports=exports["default"]},3147:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);var _keys=__webpack_require__(39);var _keys2=_interopRequireDefault(_keys);var _get2=__webpack_require__(24);var _get3=_interopRequireDefault(_get2);var _omit2=__webpack_require__(18);var _omit3=_interopRequireDefault(_omit2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactDom=__webpack_require__(44);var _reactDom2=_interopRequireDefault(_reactDom);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _actions=__webpack_require__(1648);var _actions2=_interopRequireDefault(_actions);var _utils=__webpack_require__(1649);var _utils2=_interopRequireDefault(_utils);var _utils3=__webpack_require__(208);var _utils4=_interopRequireDefault(_utils3);var _editorPermalink=__webpack_require__(3128);var _editorPermalink2=_interopRequireDefault(_editorPermalink);var _trackInputChanges=__webpack_require__(1782);var _trackInputChanges2=_interopRequireDefault(_trackInputChanges);var _textareaAutosize=__webpack_require__(2540);var _textareaAutosize2=_interopRequireDefault(_textareaAutosize);var _viewport=__webpack_require__(92);var _stats=__webpack_require__(1651);var stats=_interopRequireWildcard(_stats);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var REGEXP_NEWLINES=/[\r\n]+/g;exports.default=_react2.default.createClass({displayName:"EditorTitle",propTypes:{post:_react.PropTypes.object,site:_react.PropTypes.object,isNew:_react.PropTypes.bool,onChange:_react.PropTypes.func},getDefaultProps:function getDefaultProps(){return{isNew:true,onChange:function onChange(){}}},componentDidUpdate:function componentDidUpdate(prevProps){if((0,_viewport.isMobile)()){return}var _props=this.props;var isNew=_props.isNew;var site=_props.site;if(isNew&&!prevProps.isNew||isNew&&(0,_get3.default)(prevProps.site,"ID")!==(0,_get3.default)(site,"ID")){var input=_reactDom2.default.findDOMNode(this.refs.titleInput);input.focus()}},onChange:function onChange(event){if(!this.props.post){return}_actions2.default.edit({title:event.target.value.replace(REGEXP_NEWLINES," ")});this.props.onChange(event)},resizeAfterNewlineInput:function resizeAfterNewlineInput(event){var title=event.target.value;if(REGEXP_NEWLINES.test(title)){event.target.value=title.replace(REGEXP_NEWLINES," ");this.refs.titleInput.resize()}},recordChangeStats:function recordChangeStats(){var isPage=_utils2.default.isPage(this.props.post);stats.recordStat(isPage?"page_title_changed":"post_title_changed");stats.recordEvent(isPage?"Changed Page Title":"Changed Post Title")},onBlur:function onBlur(event){this.onChange(event)},render:function render(){var _props2=this.props;var post=_props2.post;var site=_props2.site;var isNew=_props2.isNew;var isPermalinkEditable=_utils4.default.isPermalinkEditable(site);var classes=(0,_classnames2.default)("editor-title",{"is-loading":!post});return _react2.default.createElement("div",{className:classes},post&&post.ID&&!_utils2.default.isPage(post)&&_react2.default.createElement(_editorPermalink2.default,{path:isPermalinkEditable?_utils2.default.getPermalinkBasePath(post):post.URL,isEditable:isPermalinkEditable}),_react2.default.createElement(_trackInputChanges2.default,{onNewValue:this.recordChangeStats},_react2.default.createElement(_textareaAutosize2.default,(0,_extends3.default)({},(0,_omit3.default)(this.props,(0,_keys2.default)(this.constructor.propTypes)),{className:"editor-title__input",placeholder:this.translate("Title"),onChange:this.onChange,onInput:this.resizeAfterNewlineInput,onBlur:this.onBlur,autoFocus:isNew&&!(0,_viewport.isMobile)(),value:post?post.title:"","aria-label":this.translate("Edit title"),ref:"titleInput",rows:"1"}))))}});module.exports=exports["default"]},3148:function(module,exports,__webpack_require__){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _reactDom=__webpack_require__(44);var _reactDom2=_interopRequireDefault(_reactDom);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _includes=__webpack_require__(30);var _includes2=_interopRequireDefault(_includes);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _formFieldset=__webpack_require__(275);var _formFieldset2=_interopRequireDefault(_formFieldset);var _formInputValidation=__webpack_require__(1646);var _formInputValidation2=_interopRequireDefault(_formInputValidation);var _formLabel=__webpack_require__(380);var _formLabel2=_interopRequireDefault(_formLabel);var _formLegend=__webpack_require__(1708);var _formLegend2=_interopRequireDefault(_formLegend);var _formRadio=__webpack_require__(1714);var _formRadio2=_interopRequireDefault(_formRadio);var _formTextInput=__webpack_require__(206);var _formTextInput2=_interopRequireDefault(_formTextInput);var _formSettingExplanation=__webpack_require__(1667);var _formSettingExplanation2=_interopRequireDefault(_formSettingExplanation);var _button=__webpack_require__(69);var _button2=_interopRequireDefault(_button);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _popover=__webpack_require__(386);var _popover2=_interopRequireDefault(_popover);var _touchDetect=__webpack_require__(216);var _touchDetect2=_interopRequireDefault(_touchDetect);var _tooltip=__webpack_require__(722);var _tooltip2=_interopRequireDefault(_tooltip);var _actions=__webpack_require__(1648);var _actions2=_interopRequireDefault(_actions);var _stats=__webpack_require__(1651);var _accept=__webpack_require__(397);var _accept2=_interopRequireDefault(_accept);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"EditorVisibility",showingAcceptDialog:false,getDefaultProps:function getDefaultProps(){return{isPrivateSite:false}},propTypes:{visibility:_react2.default.PropTypes.string,onPrivatePublish:_react2.default.PropTypes.func,isPrivateSite:_react2.default.PropTypes.bool,type:_react2.default.PropTypes.string,status:_react2.default.PropTypes.string,password:_react2.default.PropTypes.string,savedStatus:_react2.default.PropTypes.string,savedPassword:_react2.default.PropTypes.string},getInitialState:function getInitialState(){return{showPopover:false,passwordIsValid:true,tooltip:false,showVisibilityInfotips:false,visibility:"public"}},componentWillMount:function componentWillMount(){this.setVisibility(this.props)},componentWillReceiveProps:function componentWillReceiveProps(nextProps){if(this.state.passwordIsValid){this.setVisibility(nextProps)}},setVisibility:function setVisibility(props){if(props.visibility!==this.state.visibility){this.setState({visibility:props.visibility})}},togglePopover:function togglePopover(){if(this.state.showPopover){(0,_stats.recordStat)("visibility-dialog-closed");(0,_stats.recordEvent)("Closed visibility dialog");this.closePopover()}else{(0,_stats.recordStat)("visibility-dialog-opened");(0,_stats.recordEvent)("Opened visibility dialog");this.setState({showPopover:true})}},closePopover:function closePopover(event){var stateChanges={};if(this.showingAcceptDialog&&event){event.preventDefault();return}if(event&&event.type==="click"){event.stopImmediatePropagation()}if(this.isPasswordValid()){stateChanges.showPopover=false}else{stateChanges.passwordIsValid=false}this.setState(stateChanges)},isPasswordValid:function isPasswordValid(){var password;if("password"!==this.state.visibility){return true}password=_reactDom2.default.findDOMNode(this.refs.postPassword).value.trim();return password.length},renderVisibilityTip:function renderVisibilityTip(visibility){var infotext;if(!this.state.showVisibilityInfotips){return null}switch(visibility){case"public":infotext=this.translate("Visible to everyone.",{context:"Post visibility: info text shown when changing post visibility to public."});if(this.props.isPrivateSite){infotext=this.translate("Any member of the site can view this post.",{context:"Post visibility: info text shown when changing post visibility to public on a members-only site."})}break;case"private":infotext=this.translate("Only visible to site admins and editors.",{context:"Post visibility: info text shown when changing post visibility to private."});break;case"password":infotext=this.translate("Protected with a password you choose. Only those with the password can view this post.",{context:"Post visibility: info text shown when changing post visibility to password protected."});break}return _react2.default.createElement(_formSettingExplanation2.default,{className:visibility},infotext)},updateVisibility:function updateVisibility(event){var defaultVisibility,newVisibility,postEdits;defaultVisibility="draft"===this.props.status?"draft":"publish";postEdits={status:this.props.savedStatus&&"private"!==this.props.savedStatus?this.props.savedStatus:defaultVisibility};newVisibility=event.target.value;switch(newVisibility){case"public":postEdits.password="";break;case"password":postEdits.password=this.props.savedPassword||" ";this.setState({passwordIsValid:true});break}this.setState({visibility:newVisibility});(0,_stats.recordStat)("visibility-set-"+newVisibility);(0,_stats.recordEvent)("Changed visibility",newVisibility);_actions2.default.edit(postEdits)},onKey:function onKey(event){if((0,_includes2.default)(["Enter","Escape"],event.key)){this.closePopover()}},setPostToPrivate:function setPostToPrivate(){_actions2.default.edit({password:"",status:"private"});this.setState({visibility:"private"});(0,_stats.recordStat)("visibility-set-private");(0,_stats.recordEvent)("Changed visibility","private")},onPrivatePublish:function onPrivatePublish(){var _this=this;this.setPostToPrivate();this.setState({showPopover:false});setTimeout(function(){return _this.props.onPrivatePublish()},0)},onSetToPrivate:function onSetToPrivate(){var _this2=this;if("private"===this.props.savedStatus){this.setPostToPrivate();return}this.showingAcceptDialog=true;var message=void 0;if(this.props.type==="page"){message=this.translate("Private pages are only visible to administrators and editors of this site. Would you like to privately publish this page now?")}else{message=this.translate("Private posts are only visible to administrators and editors of this site. Would you like to privately publish this post now?")}(0,_accept2.default)(message,function(accepted){_this2.showingAcceptDialog=false;if(accepted){_this2.onPrivatePublish()}},this.translate("Yes"),this.translate("No"))},onPasswordChange:function onPasswordChange(event){var newPassword=event.target.value.trim();var passwordIsValid=newPassword.length>0;this.setState({passwordIsValid:passwordIsValid});if(!passwordIsValid){newPassword=" "}_actions2.default.edit({password:newPassword})},renderPasswordInput:function renderPasswordInput(){var value,isError,errorMessage;value=this.props.password?this.props.password.trim():null;isError=!this.state.passwordIsValid;errorMessage=this.translate("Password is empty.",{context:"Editor: Error shown when password is empty."});return _react2.default.createElement("div",null,_react2.default.createElement(_formTextInput2.default,{onKeyUp:this.onKey,onChange:this.onPasswordChange,value:value,isError:isError,ref:"postPassword",className:this.state.showVisibilityInfotips?"is-info-open":null,placeholder:this.translate("Create password",{context:"Editor: Create password for post"})}),isError?_react2.default.createElement(_formInputValidation2.default,{isError:true,text:errorMessage}):null)},showTooltip:function showTooltip(){if(this.state.tooltip){return}this.setState({tooltip:true})},hideTooltip:function hideTooltip(){if(!this.state.tooltip){return}this.setState({tooltip:false})},toggleVisibilityInfotips:function toggleVisibilityInfotips(){if(this.state.showVisibilityInfotips){(0,_stats.recordEvent)("InfoPopover: Visibility Closed");this.setState({showVisibilityInfotips:false})}else{(0,_stats.recordEvent)("InfoPopover: Visibility Opened");this.setState({showVisibilityInfotips:true})}},render:function render(){var visibility,icons,classes;icons={password:"lock",private:"not-visible",public:"visible"};visibility=this.state.visibility;classes=(0,_classnames2.default)("editor-visibility",{"is-dialog-open":this.state.showPopover,"is-touch":_touchDetect2.default.hasTouch()});return _react2.default.createElement(_button2.default,{borderless:true,className:classes,onClick:this.togglePopover,onMouseEnter:this.showTooltip,onMouseLeave:this.hideTooltip,ref:"setVisibility"},_react2.default.createElement(_gridicon2.default,{icon:icons[visibility]||"visible"}),_react2.default.createElement(_tooltip2.default,{className:"editor-visibility__tooltip",context:this.refs&&this.refs.setVisibility,isVisible:this.state.tooltip&&!this.state.showPopover,position:"bottom left"},this.translate("Edit visibility",{context:"Editor: Tooltip shown on icon to change the post's visibility."})),_react2.default.createElement(_popover2.default,{className:"editor-visibility__popover",isVisible:this.state.showPopover,onClose:this.closePopover,position:"bottom left",context:this.refs&&this.refs.setVisibility},_react2.default.createElement("div",{className:"editor-visibility__dialog"},_react2.default.createElement(_formFieldset2.default,{className:"editor-fieldset"},_react2.default.createElement(_formLegend2.default,{className:"editor-fieldset__legend"},this.translate("Post Visibility"),_react2.default.createElement(_gridicon2.default,{icon:"info-outline",size:18,className:(0,_classnames2.default)("editor-visibility__dialog-info",{is_active:this.state.showVisibilityInfotips}),onClick:this.toggleVisibilityInfotips})),_react2.default.createElement(_formLabel2.default,null,_react2.default.createElement(_formRadio2.default,{name:"site-visibility",value:"public",onChange:this.updateVisibility,checked:"public"===visibility}),_react2.default.createElement("span",null,this.props.isPrivateSite?this.translate("Visible for members of the site",{context:"Editor: Radio label to set post visibility"}):this.translate("Public",{context:"Editor: Radio label to set post visible to public"}))),this.renderVisibilityTip("public"),_react2.default.createElement(_formLabel2.default,null,_react2.default.createElement(_formRadio2.default,{name:"site-visibility",value:"private",onChange:this.onSetToPrivate,checked:"private"===visibility}),_react2.default.createElement("span",null,this.translate("Private",{context:"Editor: Radio label to set post to private"}))),this.renderVisibilityTip("private"),_react2.default.createElement(_formLabel2.default,null,_react2.default.createElement(_formRadio2.default,{name:"site-visibility",value:"password",onChange:this.updateVisibility,checked:"password"===visibility}),_react2.default.createElement("span",null,this.translate("Password Protected",{context:"Editor: Radio label to set post to password protected"}))),this.renderVisibilityTip("password"),visibility==="password"?this.renderPasswordInput():null))))}});module.exports=exports["default"]},3149:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _mixin=__webpack_require__(111);var _mixin2=_interopRequireDefault(_mixin);var _postEditStore=__webpack_require__(1687);var _postEditStore2=_interopRequireDefault(_postEditStore);var _user=__webpack_require__(48);var _user2=_interopRequireDefault(_user);var _textUtils=__webpack_require__(2664);var _textUtils2=_interopRequireDefault(_textUtils);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var user=(0,_user2.default)();exports.default=_react2.default.createClass({displayName:"EditorWordCount",mixins:[_mixin2.default],getInitialState:function getInitialState(){return{rawContent:""}},componentWillMount:function componentWillMount(){_postEditStore2.default.on("rawContentChange",this.onRawContentChange)},componentDidMount:function componentDidMount(){this.onRawContentChange()},componentWillUnmount:function componentWillUnmount(){_postEditStore2.default.removeListener("rawContentChange",this.onRawContentChange)},onRawContentChange:function onRawContentChange(){this.setState({rawContent:_postEditStore2.default.getRawContent()})},render:function render(){var currentUser=user.get();var localeSlug=currentUser&&currentUser.localeSlug||"en";switch(localeSlug){case"ja":case"th":case"zh-cn":case"zh-hk":case"zh-sg":case"zh-tw":return null;case"ko":return null}var wordCount=_textUtils2.default.countWords(this.state.rawContent);return _react2.default.createElement("div",{className:"editor-word-count"},this.translate("%d word","%d words",{count:wordCount,args:[wordCount]}))}});module.exports=exports["default"]},3150:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _noop=__webpack_require__(38);var _noop2=_interopRequireDefault(_noop);var _page=__webpack_require__(33);var _page2=_interopRequireDefault(_page);var _startsWith=__webpack_require__(83);var _startsWith2=_interopRequireDefault(_startsWith);var _dialog=__webpack_require__(168);var _dialog2=_interopRequireDefault(_dialog);var _formButton=__webpack_require__(379);var _formButton2=_interopRequireDefault(_formButton);var _path=__webpack_require__(222);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"EditorTrashedDialog",getInitialState:function getInitialState(){return{isPage:this.isPage()}},isPage:function isPage(){return(0,_startsWith2.default)(_page2.default.current,"/page/")},getDefaultProps:function getDefaultProps(){return{onClose:_noop2.default,onSave:_noop2.default}},propTypes:{onClose:_react2.default.PropTypes.func,onSave:_react2.default.PropTypes.func},getDialogButtons:function getDialogButtons(){var newText=this.state.isPage?this.translate("New Page"):this.translate("New Post");return[_react2.default.createElement(_formButton2.default,{key:"startNewPage",isPrimary:true,onClick:this.startNewPage},newText),_react2.default.createElement(_formButton2.default,{key:"back",isPrimary:false,onClick:this.props.onClose},this.translate("Close"))]},startNewPage:function startNewPage(){var siteFragment=(0,_path.getSiteFragment)(_page2.default.current);var postSegment=this.state.isPage?"/page/":"/post/";(0,_page2.default)(postSegment+siteFragment)},getStrings:function getStrings(isPage){if(isPage){return{dialogTitle:this.translate("Invalid Page Address"),dialogContent:this.translate("This page cannot be found. Check the web address or start a new page.")}}return{dialogTitle:this.translate("Invalid Post Address"),dialogContent:this.translate("This post cannot be found. Check the web address or start a new post.")}},render:function render(){var strings=this.getStrings(this.state.isPage);return _react2.default.createElement(_dialog2.default,{isVisible:true,buttons:this.getDialogButtons()},_react2.default.createElement("h1",null,strings.dialogTitle),_react2.default.createElement("p",null,strings.dialogContent))}});module.exports=exports["default"]},3151:function(module,exports,__webpack_require__){"use strict";var _defineProperty2=__webpack_require__(7);var _defineProperty3=_interopRequireDefault(_defineProperty2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ReactDom=__webpack_require__(44),React=__webpack_require__(1),debounce=__webpack_require__(278),assign=__webpack_require__(34),debug=__webpack_require__(3)("calypso:editor-media-modal");var analytics=__webpack_require__(20),MediaUtils=__webpack_require__(1647),MediaActions=__webpack_require__(1662),ClipboardButtonInput=__webpack_require__(1874),FormTextarea=__webpack_require__(1668),FormTextInput=__webpack_require__(206),TrackInputChanges=__webpack_require__(1782),EditorMediaModalFieldset=__webpack_require__(2344);module.exports=React.createClass({displayName:"EditorMediaModalDetailFields",propTypes:{site:React.PropTypes.object,item:React.PropTypes.object},getInitialState:function getInitialState(){return{}},componentWillMount:function componentWillMount(){this.persistChange=debounce(this.persistChange,1e3)},componentWillReceiveProps:function componentWillReceiveProps(nextProps){if(this.props.item&&nextProps.item&&nextProps.item.ID!==this.props.item.ID){this.setState({modifiedItem:null});this.persistChange.cancel()}},bumpStat:function bumpStat(stat){switch(stat){case"alt":analytics.ga.recordEvent("Media","Changed Image Alt");break;case"caption":analytics.ga.recordEvent("Media","Changed Item Caption");break;case"description":analytics.ga.recordEvent("Media","Changed Item Description");break}analytics.mc.bumpStat("calypso_media_edit_details",stat)},isMimePrefix:function isMimePrefix(prefix){return MediaUtils.getMimePrefix(this.props.item)===prefix},persistChange:function persistChange(){if(!this.props.site||!this.state.modifiedItem){return}debug("Update media to %o",this.state.modifiedItem);MediaActions.update(this.props.site.ID,this.state.modifiedItem)},onChange:function onChange(event){var modifiedItem=assign({ID:this.props.item.ID},this.state.modifiedItem,(0,_defineProperty3.default)({},event.target.name,event.target.value));this.setState({modifiedItem:modifiedItem});this.persistChange()},getItemValue:function getItemValue(attribute){if(this.state.modifiedItem&&attribute in this.state.modifiedItem){return this.state.modifiedItem[attribute]}if(this.props.item){return this.props.item[attribute]}},scrollToShowVisibleDropdown:function scrollToShowVisibleDropdown(event){if(!event.open||!("scrollIntoView"in window.Element.prototype)){return}ReactDom.findDOMNode(event.target).scrollIntoView()},renderImageAltText:function renderImageAltText(){if(!this.isMimePrefix("image")){return}return React.createElement(EditorMediaModalFieldset,{legend:this.translate("Alt text")},React.createElement(TrackInputChanges,{onNewValue:this.bumpStat.bind(this,"alt")},React.createElement(FormTextInput,{name:"alt",value:this.getItemValue("alt"),onChange:this.onChange})))},render:function render(){return React.createElement("div",{className:"editor-media-modal-detail__fields"},React.createElement(EditorMediaModalFieldset,{legend:this.translate("Caption")},React.createElement(TrackInputChanges,{onNewValue:this.bumpStat.bind(this,"caption")},React.createElement(FormTextarea,{name:"caption",value:this.getItemValue("caption"),onChange:this.onChange}))),this.renderImageAltText(),React.createElement(EditorMediaModalFieldset,{legend:this.translate("Description")},React.createElement(TrackInputChanges,{onNewValue:this.bumpStat.bind(this,"description")},React.createElement(FormTextInput,{name:"description",value:this.getItemValue("description"),onChange:this.onChange}))),React.createElement(EditorMediaModalFieldset,{legend:this.translate("URL")},React.createElement(ClipboardButtonInput,{value:MediaUtils.url(this.props.item)})))}})},3152:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1),createFragment=__webpack_require__(745),classNames=__webpack_require__(10);var MediaUtils=__webpack_require__(1647);module.exports=React.createClass({displayName:"EditorMediaModalDetailFileInfo",propTypes:{item:React.PropTypes.object},getItemValue:function getItemValue(attribute){var value=void 0;if(!this.props.item){return this.translate("Loading")}switch(attribute){case"extension":value=(this.props.item[attribute]||"").toUpperCase();break;case"dimensions":value=createFragment({width:React.createElement("abbr",{title:this.translate("Width in pixels")},this.props.item.width),separator:"  ",height:React.createElement("abbr",{title:this.translate("Height in pixels")},this.props.item.height)});break;case"date":value=this.moment(this.props.item[attribute]).format("D MMMM YYYY");break;case"length":value=MediaUtils.playtime(this.props.item[attribute]);break;default:value=this.props.item[attribute]}return value},renderDimensions:function renderDimensions(){if(!this.props.item||!this.props.item.width&&!this.props.item.height){return}return React.createElement("tr",null,React.createElement("th",null,this.translate("Dimensions")),React.createElement("td",null,this.getItemValue("dimensions")))},renderDuration:function renderDuration(){if(!this.props.item||!this.props.item.length){return}return React.createElement("tr",null,React.createElement("th",null,this.translate("Duration")),React.createElement("td",null,this.getItemValue("length")))},render:function render(){var classes=classNames("editor-media-modal-detail__file-info",{"is-loading":!this.props.item});return React.createElement("table",{className:classes},React.createElement("tbody",null,React.createElement("tr",null,React.createElement("th",null,this.translate("File Name")),React.createElement("td",{title:this.getItemValue("file")},this.getItemValue("file"))),React.createElement("tr",null,React.createElement("th",null,this.translate("File Type")),React.createElement("td",null,this.getItemValue("extension"))),this.renderDimensions(),this.renderDuration(),React.createElement("tr",null,React.createElement("th",null,this.translate("Upload Date")),React.createElement("td",null,this.getItemValue("date")))))}})},3153:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _noop2=__webpack_require__(38);var _noop3=_interopRequireDefault(_noop2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _debug=__webpack_require__(3);var _debug2=_interopRequireDefault(_debug);var _i18nCalypso=__webpack_require__(11);var _detailFields=__webpack_require__(3151);var _detailFields2=_interopRequireDefault(_detailFields);var _detailFileInfo=__webpack_require__(3152);var _detailFileInfo2=_interopRequireDefault(_detailFileInfo);var _detailPreviewImage=__webpack_require__(3156);var _detailPreviewImage2=_interopRequireDefault(_detailPreviewImage);var _detailPreviewVideo=__webpack_require__(3157);var _detailPreviewVideo2=_interopRequireDefault(_detailPreviewVideo);var _detailPreviewAudio=__webpack_require__(3154);var _detailPreviewAudio2=_interopRequireDefault(_detailPreviewAudio);var _detailPreviewDocument=__webpack_require__(3155);var _detailPreviewDocument2=_interopRequireDefault(_detailPreviewDocument);var _button=__webpack_require__(69);var _button2=_interopRequireDefault(_button);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _utils=__webpack_require__(208);var _utils2=__webpack_require__(1647);var _utils3=_interopRequireDefault(_utils2);var _config=__webpack_require__(12);var _config2=_interopRequireDefault(_config);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var debug=(0,_debug2.default)("calypso:post-editor:media:detail-item");var EditorMediaModalDetailItem=function(_Component){(0,_inherits3.default)(EditorMediaModalDetailItem,_Component);function EditorMediaModalDetailItem(){(0,_classCallCheck3.default)(this,EditorMediaModalDetailItem);return(0,_possibleConstructorReturn3.default)(this,(EditorMediaModalDetailItem.__proto__||(0,_getPrototypeOf2.default)(EditorMediaModalDetailItem)).apply(this,arguments))}(0,_createClass3.default)(EditorMediaModalDetailItem,[{key:"renderEditButton",value:function renderEditButton(className){var _props=this.props;var item=_props.item;var onEdit=_props.onEdit;var site=_props.site;var translate=_props.translate;if(site.is_private){debug("Do not show `Edit button` for private sites");return null}if(!_config2.default.isEnabled("post-editor/image-editor")||!(0,_utils.userCan)("upload_files",site)||(0,_utils.isJetpack)(site)||!item){return null}var mimePrefix=_utils3.default.getMimePrefix(item);if("image"!==mimePrefix){return null}return _react2.default.createElement(_button2.default,{className:(0,_classnames2.default)("editor-media-modal-detail__edit",className),onClick:onEdit,disabled:(0,_utils2.isItemBeingUploaded)(item)},_react2.default.createElement(_gridicon2.default,{icon:"pencil",size:36})," ",translate("Edit Image"))}},{key:"renderFields",value:function renderFields(){var _props2=this.props;var site=_props2.site;var item=_props2.item;if(!(0,_utils.userCan)("upload_files",site)){return null}return _react2.default.createElement(_detailFields2.default,{site:site,item:item})}},{key:"renderPreviousItemButton",value:function renderPreviousItemButton(){var _props3=this.props;var hasPreviousItem=_props3.hasPreviousItem;var onShowPreviousItem=_props3.onShowPreviousItem;var translate=_props3.translate;if(!hasPreviousItem){return null}return _react2.default.createElement("button",{onClick:onShowPreviousItem,className:"editor-media-modal-detail__previous"},_react2.default.createElement(_gridicon2.default,{icon:"chevron-left",size:36}),_react2.default.createElement("span",{className:"screen-reader-text"},translate("Previous")))}},{key:"renderNextItemButton",value:function renderNextItemButton(){var _props4=this.props;var hasNextItem=_props4.hasNextItem;var onShowNextItem=_props4.onShowNextItem;var translate=_props4.translate;if(!hasNextItem){return null}return _react2.default.createElement("button",{onClick:onShowNextItem,className:"editor-media-modal-detail__next"},_react2.default.createElement(_gridicon2.default,{icon:"chevron-right",size:36}),_react2.default.createElement("span",{className:"screen-reader-text"},translate("Next")))}},{key:"renderItem",value:function renderItem(){var _props5=this.props;var item=_props5.item;var site=_props5.site;if(!item){return null}var mimePrefix=_utils3.default.getMimePrefix(item);var Item=void 0;switch(mimePrefix){case"image":Item=_detailPreviewImage2.default;break;case"video":Item=_detailPreviewVideo2.default;break;case"audio":Item=_detailPreviewAudio2.default;break;default:Item=_detailPreviewDocument2.default;break}return _react2.default.createElement(Item,{site:site,item:item})}},{key:"render",value:function render(){var item=this.props.item;var classes=(0,_classnames2.default)("editor-media-modal-detail__item",{"is-loading":!item});return _react2.default.createElement("figure",{className:classes},_react2.default.createElement("div",{className:"editor-media-modal-detail__content editor-media-modal__content"},_react2.default.createElement("div",{className:"editor-media-modal-detail__preview-wrapper"},this.renderItem(),this.renderEditButton("is-desktop"),this.renderPreviousItemButton(),this.renderNextItemButton()),_react2.default.createElement("div",{className:"editor-media-modal-detail__sidebar"},this.renderEditButton("is-mobile"),this.renderFields(),_react2.default.createElement(_detailFileInfo2.default,{item:item}))))}}]);return EditorMediaModalDetailItem}(_react.Component);EditorMediaModalDetailItem.propTypes={site:_react.PropTypes.object,item:_react.PropTypes.object,hasPreviousItem:_react.PropTypes.bool,hasNextItem:_react.PropTypes.bool,onShowPreviousItem:_react.PropTypes.func,onShowNextItem:_react.PropTypes.func,onEdit:_react.PropTypes.func};EditorMediaModalDetailItem.defaultProps={hasPreviousItem:false,hasNextItem:false,onShowPreviousItem:_noop3.default,onShowNextItem:_noop3.default,onEdit:_noop3.default};exports.default=(0,_i18nCalypso.localize)(EditorMediaModalDetailItem);module.exports=exports["default"]},3154:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1);var MediaUtils=__webpack_require__(1647);module.exports=React.createClass({displayName:"EditorMediaModalDetailPreviewAudio",propTypes:{item:React.PropTypes.object.isRequired},render:function render(){return React.createElement("audio",{src:MediaUtils.url(this.props.item),controls:true,className:"editor-media-modal-detail__preview is-audio"})}})},3155:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"EditorMediaModalDetailPreviewDocument",render:function render(){return _react2.default.createElement("div",{className:"editor-media-modal-detail__preview is-document"},_react2.default.createElement(_gridicon2.default,{icon:"pages",size:120}))}});module.exports=exports["default"]},3156:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _imagePreloader=__webpack_require__(2224);var _imagePreloader2=_interopRequireDefault(_imagePreloader);var _spinner=__webpack_require__(282);var _spinner2=_interopRequireDefault(_spinner);var _utils=__webpack_require__(1647);var _utils2=_interopRequireDefault(_utils);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"EditorMediaModalDetailPreviewImage",propTypes:{site:_react.PropTypes.object,item:_react.PropTypes.object.isRequired},render:function render(){var src=_utils2.default.url(this.props.item,{photon:this.props.site&&!this.props.site.is_private});return _react2.default.createElement(_imagePreloader2.default,{src:src,width:this.props.item.width,height:this.props.item.height,placeholder:_react2.default.createElement(_spinner2.default,null),alt:this.props.item.alt||this.props.item.title,className:"editor-media-modal-detail__preview is-image"})}});module.exports=exports["default"]},3157:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1);var MediaUtils=__webpack_require__(1647),EditorMediaModalDetailItemVideoPress=__webpack_require__(3158);module.exports=React.createClass({displayName:"EditorMediaModalDetailPreviewVideo",propTypes:{item:React.PropTypes.object.isRequired},render:function render(){if(MediaUtils.isVideoPressItem(this.props.item)){return React.createElement(EditorMediaModalDetailItemVideoPress,this.props)}return React.createElement("video",{src:MediaUtils.url(this.props.item),controls:true,className:"editor-media-modal-detail__preview is-video"})}})},3158:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1);var loadScript=__webpack_require__(227).loadScript;module.exports=React.createClass({displayName:"EditorMediaModalDetailPreviewVideoPress",propTypes:{item:React.PropTypes.object.isRequired},componentDidMount:function componentDidMount(){this.loadInitializeScript()},componentDidUpdate:function componentDidUpdate(prevProps){if(this.props.item.videopress_guid!==prevProps.item.videopress_guid){this.loadInitializeScript()}},loadInitializeScript:function loadInitializeScript(){loadScript("https://videopress.com/videopress-iframe.js")},getEmbedUrl:function getEmbedUrl(){return"https://videopress.com/embed/"+this.props.item.videopress_guid},render:function render(){return React.createElement("iframe",{src:this.getEmbedUrl(),frameBorder:"0",width:this.props.item.width,
height:this.props.item.height,allowFullScreen:true,className:"editor-media-modal-detail__preview is-video"})}})},3159:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _debounce=__webpack_require__(278);var _debounce2=_interopRequireDefault(_debounce);var _analytics=__webpack_require__(20);var _analytics2=_interopRequireDefault(_analytics);var _actions=__webpack_require__(1662);var _actions2=_interopRequireDefault(_actions);var _utils=__webpack_require__(208);var _trackInputChanges=__webpack_require__(1782);var _trackInputChanges2=_interopRequireDefault(_trackInputChanges);var _formTextInput=__webpack_require__(206);var _formTextInput2=_interopRequireDefault(_formTextInput);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"EditorMediaModalDetailTitle",propTypes:{site:_react2.default.PropTypes.object,item:_react2.default.PropTypes.object},getInitialState:function getInitialState(){return{}},getTitleValue:function getTitleValue(){if("title"in this.state){return this.state.title}if(this.props.item){return this.props.item.title}},bumpStat:function bumpStat(){_analytics2.default.mc.bumpStat("calypso_media_edit_details","title");_analytics2.default.ga.recordEvent("Media","Changed Item Title")},onChange:function onChange(event){this.setState({title:event.target.value})},onKeyUp:function onKeyUp(event){switch(event.key){case"Enter":this.saveTitle();event.target.blur();break;case"Escape":this.resetTitle();event.target.blur();break}},saveTitle:(0,_debounce2.default)(function(){if(this.props.site&&this.props.item&&"title"in this.state&&this.state.title!==this.props.item.title){_actions2.default.update(this.props.site.ID,{ID:this.props.item.ID,title:this.state.title})}if(this.isMounted()){this.resetTitle()}},0),resetTitle:function resetTitle(){this.replaceState(this.getInitialState())},render:function render(){return _react2.default.createElement(_trackInputChanges2.default,{onNewValue:this.bumpStat},_react2.default.createElement(_formTextInput2.default,{onKeyUp:this.onKeyUp,onChange:this.onChange,onBlur:this.saveTitle,value:this.getTitleValue(),placeholder:this.translate("Untitled"),readOnly:!(0,_utils.userCan)("upload_files",this.props.site),className:"editor-media-modal-detail__title-input"}))}});module.exports=exports["default"]},3160:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1),noop=__webpack_require__(38);var DetailItem=__webpack_require__(3153),MediaUtils=__webpack_require__(1647),HeaderCake=__webpack_require__(1650),EditorMediaModalDetailTitle=__webpack_require__(3159),preloadImage=__webpack_require__(3171),ModalViews=__webpack_require__(1916).Views;module.exports=React.createClass({displayName:"EditorMediaModalDetail",propTypes:{site:React.PropTypes.object,items:React.PropTypes.array,onChangeView:React.PropTypes.func,selectedIndex:React.PropTypes.number,onSelectedIndexChange:React.PropTypes.func},getDefaultProps:function getDefaultProps(){return{onChangeView:noop,selectedIndex:0,onSelectedIndexChange:noop}},componentDidMount:function componentDidMount(){this.preloadImages()},componentDidUpdate:function componentDidUpdate(){this.preloadImages()},preloadImages:function preloadImages(){MediaUtils.filterItemsByMimePrefix(this.props.items,"image").forEach(function(image){var src=MediaUtils.url(image,{photon:this.props.site&&!this.props.site.is_private});preloadImage(src)},this)},returnToList:function returnToList(){this.props.onChangeView(ModalViews.LIST)},incrementIndex:function incrementIndex(increment){this.props.onSelectedIndexChange(this.props.selectedIndex+increment)},render:function render(){var items=this.props.items;return React.createElement("div",{className:"editor-media-modal-detail"},React.createElement(HeaderCake,{onClick:this.returnToList,backText:this.translate("Media Library")},React.createElement(EditorMediaModalDetailTitle,{site:this.props.site,item:items[this.props.selectedIndex]})),React.createElement(DetailItem,{site:this.props.site,item:items[this.props.selectedIndex],hasPreviousItem:this.props.selectedIndex-1>=0,hasNextItem:this.props.selectedIndex+1<items.length,onShowPreviousItem:this.incrementIndex.bind(this,-1),onShowNextItem:this.incrementIndex.bind(this,1),onEdit:this.props.onEdit}))}})},3161:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _assign=__webpack_require__(5);var _assign2=_interopRequireDefault(_assign);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _actions=__webpack_require__(1662);var _actions2=_interopRequireDefault(_actions);var _formTextInput=__webpack_require__(206);var _formTextInput2=_interopRequireDefault(_formTextInput);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"EditorMediaModalGalleryCaption",propTypes:{siteId:_react.PropTypes.number,item:_react.PropTypes.object},getInitialState:function getInitialState(){return{caption:null}},getValue:function getValue(){if(null!==this.state.caption){return this.state.caption}if(this.props.item){return this.props.item.caption}},setCaption:function setCaption(event){this.setState({caption:event.target.value})},saveCaption:function saveCaption(){var _props=this.props;var siteId=_props.siteId;var item=_props.item;if(!siteId||!item){return}var caption=this.getValue();if(item&&caption===item.caption){return}_actions2.default.update(siteId,(0,_assign2.default)({},item,{caption:caption}))},render:function render(){return _react2.default.createElement(_formTextInput2.default,{value:this.getValue(),placeholder:this.translate("Caption this image"),onChange:this.setCaption,onBlur:this.saveCaption,onMouseDown:function onMouseDown(event){return event.stopPropagation()},className:"editor-media-modal-gallery__caption"})}});module.exports=exports["default"]},3162:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _isEqual=__webpack_require__(98);var _isEqual2=_interopRequireDefault(_isEqual);var _dropZone=__webpack_require__(1910);var _dropZone2=_interopRequireDefault(_dropZone);var _librarySelectedStore=__webpack_require__(1784);var _librarySelectedStore2=_interopRequireDefault(_librarySelectedStore);var _actions=__webpack_require__(1662);var _actions2=_interopRequireDefault(_actions);var _utils=__webpack_require__(1647);var _utils2=_interopRequireDefault(_utils);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"EditorMediaModalGalleryDropZone",propTypes:{site:_react.PropTypes.object,onInvalidItemAdded:_react.PropTypes.func},getDefaultProps:function getDefaultProps(){return{onInvalidItemAdded:function onInvalidItemAdded(){}}},filterDroppedImagesSelected:function filterDroppedImagesSelected(){var site=this.props.site;if(!site){return}var selectedItems=_librarySelectedStore2.default.getAll(site.ID);var filteredItems=_utils2.default.filterItemsByMimePrefix(selectedItems,"image");if(!(0,_isEqual2.default)(selectedItems,filteredItems)){_actions2.default.setLibrarySelectedItems(site.ID,filteredItems);this.props.onInvalidItemAdded()}},render:function render(){return _react2.default.createElement(_dropZone2.default,{site:this.props.site,onAddMedia:this.filterDroppedImagesSelected,fullScreen:false})}});module.exports=exports["default"]},3163:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _utils=__webpack_require__(208);var _listItem=__webpack_require__(1986);var _listItem2=_interopRequireDefault(_listItem);var _caption=__webpack_require__(3161);var _caption2=_interopRequireDefault(_caption);var _removeButton=__webpack_require__(3170);var _removeButton2=_interopRequireDefault(_removeButton);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"EditorMediaModalGalleryEditItem",propTypes:{site:_react.PropTypes.object,item:_react.PropTypes.object,showRemoveButton:_react.PropTypes.bool},getDefaultProps:function getDefaultProps(){return{showRemoveButton:true}},renderCaption:function renderCaption(){var _props=this.props;var site=_props.site;var item=_props.item;if(!(0,_utils.userCan)("upload_files",site)){return}return _react2.default.createElement(_caption2.default,{siteId:site.ID,item:item})},render:function render(){var _props2=this.props;var site=_props2.site;var item=_props2.item;var showRemoveButton=_props2.showRemoveButton;return _react2.default.createElement("div",{className:"editor-media-modal-gallery__edit-item"},_react2.default.createElement(_listItem2.default,{media:item,scale:1,photon:false}),this.renderCaption(),showRemoveButton&&_react2.default.createElement(_removeButton2.default,{siteId:site.ID,itemId:item.ID}))}});module.exports=exports["default"]},3164:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _freeze=__webpack_require__(276);var _freeze2=_interopRequireDefault(_freeze);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _noop=__webpack_require__(38);var _noop2=_interopRequireDefault(_noop);var _sortableList=__webpack_require__(2051);var _sortableList2=_interopRequireDefault(_sortableList);var _editItem=__webpack_require__(3163);var _editItem2=_interopRequireDefault(_editItem);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"EditorMediaModalGalleryEdit",propTypes:{site:_react2.default.PropTypes.object,settings:_react.PropTypes.object,onUpdateSetting:_react.PropTypes.func},getDefaultProps:function getDefaultProps(){return{settings:(0,_freeze2.default)({}),onUpdateSetting:_noop2.default}},onOrderChanged:function onOrderChanged(order){var items=[];this.props.settings.items.forEach(function(item,i){items[order[i]]=item});this.props.onUpdateSetting({items:items,orderBy:null})},render:function render(){var _props=this.props;var site=_props.site;var settings=_props.settings;if(!site||!settings.items){return null}return _react2.default.createElement(_sortableList2.default,{onChange:this.onOrderChanged},settings.items.map(function(item){return _react2.default.createElement(_editItem2.default,{key:item.ID,site:site,item:item,showRemoveButton:settings.items.length>2})}))}});module.exports=exports["default"]},3165:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _keys=__webpack_require__(39);var _keys2=_interopRequireDefault(_keys);var _freeze=__webpack_require__(276);var _freeze2=_interopRequireDefault(_freeze);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _assign=__webpack_require__(34);var _assign2=_interopRequireDefault(_assign);var _noop=__webpack_require__(38);var _noop2=_interopRequireDefault(_noop);var _includes=__webpack_require__(30);var _includes2=_interopRequireDefault(_includes);var _times=__webpack_require__(716);var _times2=_interopRequireDefault(_times);var _fromPairs=__webpack_require__(402);var _fromPairs2=_interopRequireDefault(_fromPairs);var _fieldset=__webpack_require__(2344);var _fieldset2=_interopRequireDefault(_fieldset);var _selectDropdown=__webpack_require__(1761);var _selectDropdown2=_interopRequireDefault(_selectDropdown);var _item=__webpack_require__(1809);var _item2=_interopRequireDefault(_item);var _formCheckbox=__webpack_require__(1654);var _formCheckbox2=_interopRequireDefault(_formCheckbox);var _constants=__webpack_require__(1716);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"EditorMediaModalGalleryFields",propTypes:{site:_react.PropTypes.object,settings:_react.PropTypes.object,onUpdateSetting:_react.PropTypes.func,numberOfItems:_react.PropTypes.number},getDefaultProps:function getDefaultProps(){return{settings:(0,_freeze2.default)({}),onUpdateSetting:_noop2.default,numberOfItems:0}},getTypeOptions:function getTypeOptions(){var site=this.props.site;var options={individual:this.translate("Individual Images"),default:this.translate("Thumbnail Grid")};if(site&&(!site.jetpack||site.isModuleActive("tiled-gallery"))){(0,_assign2.default)(options,{rectangular:this.translate("Tiled Mosaic"),square:this.translate("Square Tiles"),circle:this.translate("Circles"),columns:this.translate("Tiled Columns")})}if(site&&(!site.jetpack||site.isModuleActive("shortcodes"))){(0,_assign2.default)(options,{slideshow:this.translate("Slideshow")})}return options},getLinkOptions:function getLinkOptions(){if("individual"===this.props.settings.type){return{}}return{"":this.translate("Attachment Page"),file:this.translate("Media File"),none:this.translate("None")}},getSizeOptions:function getSizeOptions(){if(!(0,_includes2.default)(_constants.GallerySizeableTypes,this.props.settings.type)){return{}}return{thumbnail:this.translate("Thumbnail"),medium:this.translate("Medium"),large:this.translate("Large"),full:this.translate("Full Size")}},getColumnOptions:function getColumnOptions(){var max=Math.min(this.props.numberOfItems,9);return(0,_fromPairs2.default)((0,_times2.default)(max,function(n){return[n+1,(n+1).toString()]}))},updateRandomOrder:function updateRandomOrder(event){this.props.onUpdateSetting("orderBy",event.target.checked?"rand":null)},renderDropdown:function renderDropdown(legend,options,settingName){var _props=this.props;var settings=_props.settings;var onUpdateSetting=_props.onUpdateSetting;if(!(0,_keys2.default)(options).length){return}return _react2.default.createElement(_fieldset2.default,{legend:legend,className:"for-setting-"+settingName},_react2.default.createElement(_selectDropdown2.default,{selectedText:options[settings[settingName]]},(0,_keys2.default)(options).map(function(value){var label=options[value];return _react2.default.createElement(_item2.default,{key:"value-"+value,selected:value===settings[settingName],onClick:function onClick(){return onUpdateSetting(settingName,isFinite(parseInt(value))?+value:value)}},label)})))},renderColumnsOption:function renderColumnsOption(){if(!(0,_includes2.default)(_constants.GalleryColumnedTypes,this.props.settings.type)){return}return this.renderDropdown(this.translate("Columns"),this.getColumnOptions(),"columns")},renderRandomOption:function renderRandomOption(){var settings=this.props.settings;if("individual"===settings.type){return}return _react2.default.createElement(_fieldset2.default,{legend:this.translate("Random Order")},_react2.default.createElement(_formCheckbox2.default,{onChange:this.updateRandomOrder,checked:settings.orderBy==="rand"}))},render:function render(){var types=this.getTypeOptions();var links=this.getLinkOptions();var sizes=this.getSizeOptions();return _react2.default.createElement("div",{className:"editor-media-modal-gallery__fields"},this.renderDropdown(this.translate("Layout"),types,"type"),this.renderColumnsOption(),this.renderRandomOption(),this.renderDropdown(this.translate("Link To"),links,"link"),this.renderDropdown(this.translate("Size"),sizes,"size"))}});module.exports=exports["default"]},3166:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _defineProperty2=__webpack_require__(7);var _defineProperty3=_interopRequireDefault(_defineProperty2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _noop=__webpack_require__(38);var _noop2=_interopRequireDefault(_noop);var _assign=__webpack_require__(34);var _assign2=_interopRequireDefault(_assign);var _omitBy=__webpack_require__(102);var _omitBy2=_interopRequireDefault(_omitBy);var _some=__webpack_require__(63);var _some2=_interopRequireDefault(_some);var _isEqual=__webpack_require__(98);var _isEqual2=_interopRequireDefault(_isEqual);var _headerCake=__webpack_require__(1650);var _headerCake2=_interopRequireDefault(_headerCake);var _store=__webpack_require__(1717);var _store2=_interopRequireDefault(_store);var _dropZone=__webpack_require__(3162);var _dropZone2=_interopRequireDefault(_dropZone);var _fields=__webpack_require__(3165);var _fields2=_interopRequireDefault(_fields);var _preview=__webpack_require__(3169);var _preview2=_interopRequireDefault(_preview);var _constants=__webpack_require__(1916);var _constants2=__webpack_require__(1716);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"EditorMediaModalGallery",propTypes:{site:_react2.default.PropTypes.object,items:_react2.default.PropTypes.array,settings:_react2.default.PropTypes.object,onUpdateSettings:_react2.default.PropTypes.func,onChangeView:_react2.default.PropTypes.func},getInitialState:function getInitialState(){return{invalidItemDropped:false}},getDefaultProps:function getDefaultProps(){return{onUpdateSettings:_noop2.default,onChangeView:_noop2.default}},componentWillMount:function componentWillMount(){if(this.props.settings){this.maybeUpdateColumnsSetting();this.reconcileSettingsItems(this.props.settings,this.props.items)}else{this.setDefaultSettings()}},componentDidUpdate:function componentDidUpdate(prevProps){if(!this.props.settings){return}this.maybeUpdateColumnsSetting();if(!(0,_isEqual2.default)(prevProps.items,this.props.items)){this.reconcileSettingsItems(this.props.settings,this.props.items)}},reconcileSettingsItems:function reconcileSettingsItems(settings,items){var _this=this;var newItems=settings.items.filter(function(item){return(0,_some2.default)(items,{ID:item.ID})}).concat(items.filter(function(item){return!(0,_some2.default)(settings.items,{ID:item.ID})})).map(function(item){return _store2.default.get(_this.props.site.ID,item.ID)});if(!(0,_isEqual2.default)(newItems,settings.items)){this.updateSetting("items",newItems)}},maybeUpdateColumnsSetting:function maybeUpdateColumnsSetting(){if(this.props.items.length<this.props.settings.columns){this.updateSetting("columns",this.props.items.length)}},setDefaultSettings:function setDefaultSettings(){var _props=this.props;var site=_props.site;var settings=_props.settings;var items=_props.items;var onUpdateSettings=_props.onUpdateSettings;if(settings){return}var defaultSettings=(0,_assign2.default)({},_constants2.GalleryDefaultAttrs,{items:items});if(site&&(!site.jetpack||site.isModuleActive("tiled-gallery"))){defaultSettings.type="rectangular"}onUpdateSettings(defaultSettings)},updateSetting:function updateSetting(setting,value){if("string"===typeof setting){setting=(0,_defineProperty3.default)({},setting,value)}var updatedSettings=(0,_assign2.default)({},this.props.settings,setting);updatedSettings=(0,_omitBy2.default)(updatedSettings,function(updatedValue){return null===updatedValue});this.props.onUpdateSettings(updatedSettings)},returnToList:function returnToList(){this.props.onChangeView(_constants.Views.LIST)},render:function render(){var _this2=this;var _props2=this.props;var site=_props2.site;var items=_props2.items;var settings=_props2.settings;return _react2.default.createElement("div",{className:"editor-media-modal-gallery"},_react2.default.createElement(_dropZone2.default,{site:site,onInvalidItemAdded:function onInvalidItemAdded(){return _this2.setState({invalidItemDropped:true})}}),_react2.default.createElement(_headerCake2.default,{onClick:this.returnToList,backText:this.translate("Media Library")}),_react2.default.createElement("div",{className:"editor-media-modal-gallery__content editor-media-modal__content"},_react2.default.createElement(_preview2.default,{site:site,items:items,settings:settings,onUpdateSetting:this.updateSetting,invalidItemDropped:this.state.invalidItemDropped,onDismissInvalidItemDropped:function onDismissInvalidItemDropped(){return _this2.setState({invalidItemDropped:false})}}),_react2.default.createElement("div",{className:"editor-media-modal-gallery__sidebar"},_react2.default.createElement(_fields2.default,{site:site,settings:settings,onUpdateSetting:this.updateSetting,numberOfItems:items.length}))))}});module.exports=exports["default"]},3167:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _markup=__webpack_require__(1917);var _markup2=_interopRequireDefault(_markup);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"EditorMediaModalGalleryPreviewIndividual",propTypes:{items:_react.PropTypes.arrayOf(_react.PropTypes.object)},render:function render(){var items=this.props.items.map(function(item){var caption=_markup2.default.caption(item);if(null===caption){return _react2.default.createElement("div",{key:item.ID,dangerouslySetInnerHTML:{__html:_markup2.default.get(item)}})}return _react2.default.cloneElement(caption,{key:item.ID})});return _react2.default.createElement("div",{className:"editor-media-modal-gallery__preview-individual"},_react2.default.createElement("div",{className:"editor-media-modal-gallery__preview-individual-content"},items))}});module.exports=exports["default"]},3168:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _some=__webpack_require__(63);var _some2=_interopRequireDefault(_some);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _utils=__webpack_require__(1647);var _galleryShortcode=__webpack_require__(2223);var _galleryShortcode2=_interopRequireDefault(_galleryShortcode);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"EditorMediaModalGalleryPreviewShortcode",propTypes:{siteId:_react.PropTypes.number,settings:_react.PropTypes.object},getInitialState:function getInitialState(){return{isLoading:true,shortcode:(0,_utils.generateGalleryShortcode)(this.props.settings)}},componentWillReceiveProps:function componentWillReceiveProps(nextProps){var shortcode=(0,_utils.generateGalleryShortcode)(nextProps.settings);if(this.state.shortcode===shortcode){return}this.setState({isLoading:true,shortcode:shortcode})},setLoaded:function setLoaded(){if(!this.isMounted()){return}this.setState({isLoading:false})},render:function render(){var _props=this.props;var siteId=_props.siteId;var settings=_props.settings;var _state=this.state;var isLoading=_state.isLoading;var shortcode=_state.shortcode;var classes=(0,_classnames2.default)("editor-media-modal-gallery__preview-shortcode",{"is-loading":isLoading||(0,_some2.default)(settings.items,"transient")});return _react2.default.createElement("div",{className:classes},_react2.default.createElement(_galleryShortcode2.default,{siteId:siteId,onLoad:this.setLoaded},shortcode))}});module.exports=exports["default"]},3169:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _freeze=__webpack_require__(276);var _freeze2=_interopRequireDefault(_freeze);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _notice=__webpack_require__(76);var _notice2=_interopRequireDefault(_notice);var _segmentedControl=__webpack_require__(1682);var _segmentedControl2=_interopRequireDefault(_segmentedControl);var _item=__webpack_require__(1665);var _item2=_interopRequireDefault(_item);var _edit=__webpack_require__(3164);var _edit2=_interopRequireDefault(_edit);var _previewShortcode=__webpack_require__(3168);var _previewShortcode2=_interopRequireDefault(_previewShortcode);var _previewIndividual=__webpack_require__(3167);var _previewIndividual2=_interopRequireDefault(_previewIndividual);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"EditorMediaModalGalleryPreview",propTypes:{site:_react.PropTypes.object,settings:_react.PropTypes.object,onUpdateSetting:_react.PropTypes.func,invalidItemDropped:_react.PropTypes.bool,onDismissInvalidItemDropped:_react.PropTypes.func},getInitialState:function getInitialState(){return{isEditing:false}},getDefaultProps:function getDefaultProps(){return{settings:(0,_freeze2.default)({}),onUpdateSetting:function onUpdateSetting(){},invalidItemDropped:false,onDismissInvalidItemDropped:function onDismissInvalidItemDropped(){}}},renderPreviewModeToggle:function renderPreviewModeToggle(){var _this=this;return _react2.default.createElement(_segmentedControl2.default,{className:"editor-media-modal-gallery__preview-toggle",compact:true},_react2.default.createElement(_item2.default,{selected:!this.state.isEditing,onClick:function onClick(){return _this.setState({isEditing:false})}},this.translate("Preview")),_react2.default.createElement(_item2.default,{selected:this.state.isEditing,onClick:function onClick(){return _this.setState({isEditing:true})}},this.translate("Edit")))},renderPreview:function renderPreview(){var _props=this.props;var site=_props.site;var settings=_props.settings;var onUpdateSetting=_props.onUpdateSetting;if(!site||!settings.items){return}if(this.state.isEditing){return _react2.default.createElement(_edit2.default,{site:site,settings:settings,onUpdateSetting:onUpdateSetting})}if("individual"===settings.type){return _react2.default.createElement(_previewIndividual2.default,{items:settings.items})}return _react2.default.createElement(_previewShortcode2.default,{siteId:site.ID,settings:settings})},render:function render(){return _react2.default.createElement("div",{className:"editor-media-modal-gallery__preview"},this.props.invalidItemDropped&&_react2.default.createElement(_notice2.default,{status:"is-warning",onDismissClick:this.props.onDismissInvalidItemDropped,isCompact:true},this.translate("Galleries can only include images. All other uploads will be added to your media library.")),_react2.default.createElement("div",{className:"editor-media-modal-gallery__preview-wrapper"},this.renderPreview()),this.renderPreviewModeToggle())}});module.exports=exports["default"]},3170:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _mixin=__webpack_require__(111);var _mixin2=_interopRequireDefault(_mixin);var _reject=__webpack_require__(209);var _reject2=_interopRequireDefault(_reject);var _actions=__webpack_require__(1662);var _actions2=_interopRequireDefault(_actions);var _librarySelectedStore=__webpack_require__(1784);var _librarySelectedStore2=_interopRequireDefault(_librarySelectedStore);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"EditorMediaModalGalleryRemoveButton",mixins:[_mixin2.default],propTypes:{siteId:_react.PropTypes.number,itemId:_react.PropTypes.number},remove:function remove(){var _props=this.props;var siteId=_props.siteId;var itemId=_props.itemId;if(!siteId||!itemId){return}var selected=_librarySelectedStore2.default.getAll(siteId);var items=(0,_reject2.default)(selected,function(item){return item.ID===itemId});_actions2.default.setLibrarySelectedItems(siteId,items)},render:function render(){return _react2.default.createElement("button",{onClick:this.remove,onMouseDown:function onMouseDown(event){return event.stopPropagation()},className:"editor-media-modal-gallery__remove"},_react2.default.createElement("span",{className:"screen-reader-text"},this.translate("Remove")),_react2.default.createElement(_gridicon2.default,{icon:"cross"}))}});module.exports=exports["default"]},3171:function(module,exports,__webpack_require__){"use strict";var memoize=__webpack_require__(405);module.exports=memoize(function(src){(new window.Image).src=src})},3172:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _assign=__webpack_require__(5);var _assign2=_interopRequireDefault(_assign);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactRedux=__webpack_require__(15);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _values=__webpack_require__(210);var _values2=_interopRequireDefault(_values);var _noop=__webpack_require__(38);var _noop2=_interopRequireDefault(_noop);var _some=__webpack_require__(63);var _some2=_interopRequireDefault(_some);var _every=__webpack_require__(218);var _every2=_interopRequireDefault(_every);var _page=__webpack_require__(33);var _page2=_interopRequireDefault(_page);var _analytics=__webpack_require__(20);var _analytics2=_interopRequireDefault(_analytics);var _trackComponentView=__webpack_require__(284);var _trackComponentView2=_interopRequireDefault(_trackComponentView);var _constants=__webpack_require__(1916);var _menu=__webpack_require__(1673);var _menu2=_interopRequireDefault(_menu);var _menuItem=__webpack_require__(1652);var _menuItem2=_interopRequireDefault(_menuItem);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _utils=__webpack_require__(1647);var _selectors=__webpack_require__(90);var _selectors2=__webpack_require__(79);var _planStorage=__webpack_require__(2843);var _planStorage2=_interopRequireDefault(_planStorage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var MediaModalSecondaryActions=_react2.default.createClass({displayName:"MediaModalSecondaryActions",propTypes:{user:_react.PropTypes.object,site:_react.PropTypes.object,selectedItems:_react.PropTypes.array,activeView:_react2.default.PropTypes.oneOf((0,_values2.default)(_constants.Views)),disabled:_react.PropTypes.bool,onDelete:_react.PropTypes.func,onChangeView:_react.PropTypes.func},getDefaultProps:function getDefaultProps(){return{disabled:false,onDelete:_noop2.default,onChangeView:_noop2.default}},getInitialState:function getInitialState(){return{isMobilePopoverVisible:false}},setMobilePopoverContext:function setMobilePopoverContext(component){if(!component){return}this.setState({mobilePopoverContext:component})},onEdit:function onEdit(){_analytics2.default.mc.bumpStat("editor_media_actions","edit_button_dialog");_analytics2.default.ga.recordEvent("Media","Clicked Dialog Edit Button");this.props.onChangeView(_constants.Views.DETAIL)},navigateToPlans:function navigateToPlans(){_analytics2.default.ga.recordEvent("Media","Clicked Plan Storage Button");_analytics2.default.tracks.recordEvent("calypso_upgrade_nudge_cta_click",{cta_name:"plan-media-storage"});(0,_page2.default)("/plans/"+this.props.siteSlug)},getButtons:function getButtons(){var _props=this.props;var user=_props.user;var site=_props.site;var selectedItems=_props.selectedItems;var activeView=_props.activeView;var disabled=_props.disabled;var onDelete=_props.onDelete;var buttons=[];if(_constants.Views.LIST===activeView&&selectedItems.length){buttons.push({key:"edit",value:this.translate("Edit"),disabled:disabled,onClick:this.onEdit})}var canDeleteItems=selectedItems.length&&(0,_every2.default)(selectedItems,function(item){return(0,_utils.canUserDeleteItem)(item,user,site)});if(_constants.Views.GALLERY!==activeView&&canDeleteItems){buttons.push({key:"delete",value:this.translate("Delete"),
className:"is-link editor-media-modal__delete",disabled:disabled||(0,_some2.default)(selectedItems,"transient"),onClick:onDelete})}return buttons},toggleMobilePopover:function toggleMobilePopover(){this.setState({isMobilePopoverVisible:!this.state.isMobilePopoverVisible})},renderMobileButtons:function renderMobileButtons(){var _this=this;var buttons=this.getButtons();if(!buttons.length){return}var classes=(0,_classnames2.default)("editor-media-modal__secondary-action","button","is-mobile","is-link",{"is-active":this.state.isMobilePopoverVisible});var menuItems=buttons.map(function(button){var onClick=function onClick(){_this.toggleMobilePopover();if(button.onClick){button.onClick()}};return _react2.default.createElement(_menuItem2.default,{key:button.key,action:button.key,onClick:onClick},button.value)});return _react2.default.createElement("button",{ref:this.setMobilePopoverContext,onClick:this.toggleMobilePopover,className:classes},_react2.default.createElement("span",{className:"screen-reader-text"},this.translate("More Options")),_react2.default.createElement(_gridicon2.default,{icon:"ellipsis",size:24}),_react2.default.createElement(_menu2.default,{context:this.state.mobilePopoverContext,isVisible:this.state.isMobilePopoverVisible,onClose:this.toggleMobilePopover,position:"top right",className:"popover is-dialog-visible"},menuItems))},renderDesktopButtons:function renderDesktopButtons(){return this.getButtons().map(function(button){return _react2.default.createElement("input",(0,_assign2.default)({type:"button"},button,{className:(0,_classnames2.default)("editor-media-modal__secondary-action","button","is-desktop",button.className)}))})},renderPlanStorage:function renderPlanStorage(){if(this.props.selectedItems.length===0){var eventName="calypso_upgrade_nudge_impression";var eventProperties={cta_name:"plan-media-storage"};return _react2.default.createElement(_planStorage2.default,{className:"editor-media-modal__plan-storage",onClick:this.navigateToPlans,siteId:this.props.site.ID},_react2.default.createElement(_trackComponentView2.default,{eventName:eventName,eventProperties:eventProperties}))}return null},render:function render(){return _react2.default.createElement("div",{className:"editor-media-modal__secondary-actions"},this.renderMobileButtons(),this.renderDesktopButtons(),this.renderPlanStorage())}});exports.default=(0,_reactRedux.connect)(function(state,ownProps){return{user:(0,_selectors.getCurrentUser)(state),siteSlug:ownProps.site?(0,_selectors2.getSiteSlug)(state,ownProps.site.ID):""}})(MediaModalSecondaryActions);module.exports=exports["default"]},3173:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);var _reactRedux=__webpack_require__(15);var _redux=__webpack_require__(6);var _selectors=__webpack_require__(47);var _actions=__webpack_require__(834);var _selectors2=__webpack_require__(277);var _actions2=__webpack_require__(2183);var _actions3=__webpack_require__(285);var _selectors3=__webpack_require__(112);var _header=__webpack_require__(3142);var _header2=_interopRequireDefault(_header);var _editorDocumentHead=__webpack_require__(3108);var _editorDocumentHead2=_interopRequireDefault(_editorDocumentHead);var _editorPostTypeUnsupported=__webpack_require__(3131);var _editorPostTypeUnsupported2=_interopRequireDefault(_editorPostTypeUnsupported);var _editorForbidden=__webpack_require__(3115);var _editorForbidden2=_interopRequireDefault(_editorForbidden);var _editorNotice=__webpack_require__(3123);var _editorNotice2=_interopRequireDefault(_editorNotice);var _actions4=__webpack_require__(226);var _selectors4=__webpack_require__(138);var _queryPreferences=__webpack_require__(414);var _queryPreferences2=_interopRequireDefault(_queryPreferences);var _footer=__webpack_require__(783);var _footer2=_interopRequireDefault(_footer);var _actions5=__webpack_require__(82);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ReactDom=__webpack_require__(44),React=__webpack_require__(1),debug=__webpack_require__(3)("calypso:post-editor"),page=__webpack_require__(33),debounce=__webpack_require__(278),throttle=__webpack_require__(388);var actions=__webpack_require__(1648),route=__webpack_require__(132),PostEditStore=__webpack_require__(1687),EditorActionBar=__webpack_require__(3102),EditorDrawer=__webpack_require__(3110),FeaturedImage=__webpack_require__(2340),EditorGroundControl=__webpack_require__(3116),EditorTitleContainer=__webpack_require__(3146),EditorPageSlug=__webpack_require__(3126),protectForm=__webpack_require__(714),TinyMCE=__webpack_require__(2543),EditorWordCount=__webpack_require__(3149),SegmentedControl=__webpack_require__(1682),SegmentedControlItem=__webpack_require__(1665),EditorMobileNavigation=__webpack_require__(3121),observe=__webpack_require__(131),DraftList=__webpack_require__(2771),InvalidURLDialog=__webpack_require__(3150),RestorePostDialog=__webpack_require__(3174),VerifyEmailDialog=__webpack_require__(3175),utils=__webpack_require__(1649),EditorPreview=__webpack_require__(3133),stats=__webpack_require__(1651),analytics=__webpack_require__(20);var PostEditor=React.createClass({displayName:"PostEditor",propTypes:{siteId:React.PropTypes.number,preferences:React.PropTypes.object,setEditorModePreference:React.PropTypes.func,setLayoutFocus:React.PropTypes.func.isRequired,editorModePreference:React.PropTypes.string,sites:React.PropTypes.object,user:React.PropTypes.object,userUtils:React.PropTypes.object,editPath:React.PropTypes.string},_previewWindow:null,mixins:[protectForm.mixin,observe("sites")],getInitialState:function getInitialState(){return(0,_extends3.default)({},this.getPostEditState(),{isSaving:false,isPublishing:false,notice:null,showVerifyEmailDialog:false,showAutosaveDialog:true,isLoadingAutosave:false,isTitleFocused:false})},getPostEditState:function getPostEditState(){return{savedPost:PostEditStore.getSavedPost(),loadingError:PostEditStore.getLoadingError(),isDirty:PostEditStore.isDirty(),isSaveBlocked:PostEditStore.isSaveBlocked(),hasContent:PostEditStore.hasContent(),previewUrl:PostEditStore.getPreviewUrl(),post:PostEditStore.get(),isNew:PostEditStore.isNew(),isAutosaving:PostEditStore.isAutosaving(),isLoading:PostEditStore.isLoading()}},componentWillMount:function componentWillMount(){PostEditStore.on("change",this.onEditedPostChange);this.debouncedSaveRawContent=debounce(this.saveRawContent,200);this.throttledAutosave=throttle(this.autosave,2e4);this.debouncedAutosave=debounce(this.throttledAutosave,3e3);this.switchEditorVisualMode=this.switchEditorMode.bind(this,"tinymce");this.switchEditorHtmlMode=this.switchEditorMode.bind(this,"html");this.setState({isEditorInitialized:false})},componentWillUpdate:function componentWillUpdate(nextProps,nextState){var isNew=nextState.isNew;var savedPost=nextState.savedPost;if(!isNew&&savedPost&&savedPost!==this.state.savedPost){nextProps.receivePost(savedPost)}if(nextState.isDirty||nextProps.dirty){this.markChanged()}else{this.markSaved()}},componentDidMount:function componentDidMount(){debug("PostEditor react component mounted.");if(this.state.post&&this.state.post.content){this.refs.editor.setEditorContent(this.state.post.content,{initial:true})}},componentWillUnmount:function componentWillUnmount(){PostEditStore.removeListener("change",this.onEditedPostChange);this.props.resetPostEdits(this.props.siteId,this.props.postId);actions.stopEditing();this.debouncedAutosave.cancel();this.throttledAutosave.cancel();this.debouncedSaveRawContent.cancel();this._previewWindow=null;clearTimeout(this._switchEditorTimeout);this.hideDrafts()},componentWillReceiveProps:function componentWillReceiveProps(nextProps){var _props=this.props;var siteId=_props.siteId;var postId=_props.postId;if(nextProps.siteId===siteId&&nextProps.postId!==postId){page.replace(nextProps.editPath,null,false,false)}},toggleSidebar:function toggleSidebar(){this.hideDrafts();this.props.setLayoutFocus("content")},hideDrafts:function hideDrafts(){if(this.props.showDrafts){this.props.toggleDrafts()}},render:function render(){var site=this.props.sites.getSelectedSite()||undefined,mode=this.getEditorMode(),isInvalidURL=this.state.loadingError,siteURL=site?site.URL+"/":null,isPage,isTrashed,hasAutosave;if(this.state.post){isPage=utils.isPage(this.state.post);isTrashed=this.state.post.status==="trash";hasAutosave=this.state.post.meta&&this.state.post.meta.data&&this.state.post.meta.data.autosave}return React.createElement("div",{className:"post-editor"},React.createElement(_queryPreferences2.default,null),React.createElement(_editorDocumentHead2.default,null),React.createElement(_editorPostTypeUnsupported2.default,null),React.createElement(_editorForbidden2.default,null),React.createElement("div",{className:"post-editor__inner"},React.createElement("div",{className:"post-editor__content"},React.createElement(EditorMobileNavigation,{site:site,onClose:this.onClose}),React.createElement("div",{className:"editor"},React.createElement(EditorActionBar,{isNew:this.state.isNew,onTrashingPost:this.onTrashingPost,onPrivatePublish:this.onPublish,post:this.state.post,savedPost:this.state.savedPost,site:site,type:this.props.type}),React.createElement(_editorNotice2.default,(0,_extends3.default)({},this.state.notice,{onDismissClick:this.onNoticeClick})),React.createElement(FeaturedImage,{site:site,post:this.state.post,maxWidth:1462}),React.createElement("div",{className:"editor__header"},React.createElement(EditorTitleContainer,{onChange:this.debouncedAutosave,tabIndex:1}),this.state.post&&isPage&&site?React.createElement(EditorPageSlug,{path:this.state.post.URL&&this.state.post.URL!==siteURL?utils.getPagePath(this.state.post):siteURL}):null,React.createElement(SegmentedControl,{className:"editor__switch-mode",compact:true},React.createElement(SegmentedControlItem,{selected:mode==="tinymce",onClick:this.switchEditorVisualMode,title:this.translate("Edit with a visual editor")},this.translate("Visual",{context:"Editor writing mode"})),React.createElement(SegmentedControlItem,{selected:mode==="html",onClick:this.switchEditorHtmlMode,title:this.translate("Edit the raw HTML code")},"HTML"))),React.createElement("hr",{className:"editor__header-divider"}),React.createElement(TinyMCE,{ref:"editor",mode:mode,tabIndex:2,isNew:this.state.isNew,onSetContent:this.debouncedSaveRawContent,onInit:this.onEditorInitialized,onChange:this.onEditorContentChange,onKeyUp:this.debouncedSaveRawContent,onFocus:this.onEditorFocus,onTextEditorChange:this.onEditorContentChange})),React.createElement(EditorWordCount,null),this.iframePreviewEnabled()?React.createElement(EditorPreview,{showPreview:this.state.showPreview,onClose:this.onPreviewClose,isSaving:this.state.isSaving||this.state.isAutosaving,isLoading:this.state.isLoading,previewUrl:this.state.previewUrl,externalUrl:this.state.previewUrl}):null),React.createElement("div",{className:"post-editor__sidebar"},React.createElement(_header2.default,{allPostsUrl:this.getAllPostsUrl(),toggleSidebar:this.toggleSidebar}),this.props.showDrafts?React.createElement(DraftList,(0,_extends3.default)({},this.props,{onTitleClick:this.toggleSidebar,showAllActionsMenu:false,siteID:site?site.ID:null,selectedId:this.state.post&&this.state.post.ID||null})):React.createElement("div",null,React.createElement(EditorGroundControl,{savedPost:this.state.savedPost,post:this.state.post,isNew:this.state.isNew,isDirty:this.state.isDirty||this.props.dirty,isSaveBlocked:this.isSaveBlocked(),hasContent:this.state.hasContent,isSaving:this.state.isSaving,isPublishing:this.state.isPublishing,onSave:this.onSave,onPreview:this.onPreview,onPublish:this.onPublish,onTrashingPost:this.onTrashingPost,onMoreInfoAboutEmailVerify:this.onMoreInfoAboutEmailVerify,site:site,user:this.props.user,userUtils:this.props.userUtils,type:this.props.type}),React.createElement(EditorDrawer,{type:this.props.type,site:site,post:this.state.post,isNew:this.state.isNew})),React.createElement(_footer2.default,null))),isTrashed?React.createElement(RestorePostDialog,{post:this.state.post,onClose:this.onClose,onRestore:this.onSaveTrashed}):null,this.state.showVerifyEmailDialog?React.createElement(VerifyEmailDialog,{user:this.props.user,onClose:this.closeVerifyEmailDialog}):null,isInvalidURL?React.createElement(InvalidURLDialog,{post:this.state.post,onClose:this.onClose}):null,hasAutosave&&this.state.showAutosaveDialog?React.createElement(RestorePostDialog,{post:this.state.post,onRestore:this.restoreAutosave,onClose:this.closeAutosaveDialog,isAutosave:true}):null)},restoreAutosave:function restoreAutosave(){var edits,autosaveData=this.state.post.meta.data.autosave;this.setState({showAutosaveDialog:false,isLoadingAutosave:true});edits={title:autosaveData.title,excerpt:autosaveData.excerpt,content:autosaveData.content};actions.edit(edits)},closeAutosaveDialog:function closeAutosaveDialog(){this.setState({showAutosaveDialog:false})},closeVerifyEmailDialog:function closeVerifyEmailDialog(){this.setState({showVerifyEmailDialog:false})},onNoticeClick:function onNoticeClick(event){event.preventDefault();this.setState({notice:null})},onEditedPostChange:function onEditedPostChange(){var didLoad=this.state.isLoading&&!PostEditStore.isLoading(),loadingError=PostEditStore.getLoadingError(),postEditState,post,site;if(loadingError){this.setState({loadingError:loadingError})}else if(PostEditStore.isNew()&&!this.state.isNew||PostEditStore.isLoading()){this.setState(this.getInitialState(),function(){this.refs.editor.setEditorContent("")})}else{postEditState=this.getPostEditState();post=postEditState.post;site=post?this.props.sites.getSite(post.site_ID):false;if(didLoad&&site&&this.props.type==="page"!==utils.isPage(post)){page.redirect(utils.getEditURL(post,site))}this.setState(postEditState,function(){if(didLoad||this.state.isLoadingAutosave){this.refs.editor.setEditorContent(this.state.post.content,{initial:true})}if(this.state.isLoadingAutosave){this.setState({isLoadingAutosave:false})}})}},isSaveBlocked:function isSaveBlocked(){return this.state.isSaveBlocked||!this.state.isEditorInitialized},onEditorInitialized:function onEditorInitialized(){this.setState({isEditorInitialized:true})},onEditorContentChange:function onEditorContentChange(){debug("editor content changed");this.debouncedSaveRawContent();this.debouncedAutosave()},onEditorFocus:function onEditorFocus(){ReactDom.findDOMNode(this.refs.editor).click()},saveRawContent:function saveRawContent(){actions.editRawContent(this.refs.editor.getContent({format:"raw"}))},autosave:function autosave(){var callback;if(this.state.isSaving===true||this.isSaveBlocked()){return}this.saveRawContent();var edits=(0,_extends3.default)({},this.props.edits,{content:this.refs.editor.getContent()});actions.edit(edits);if(!PostEditStore.isDirty()||!PostEditStore.hasContent()||!this.state.post){return}if(utils.isPublished(this.state.savedPost)||utils.isPublished(this.state.post)){callback=function callback(){}}else{this.setState({isSaving:true});callback=function(error){if(error&&"NO_CHANGE"!==error.message){this.onSaveDraftFailure(error)}else{this.onSaveDraftSuccess()}}.bind(this)}actions.autosave(callback)},onClose:function onClose(){page.back(this.getAllPostsUrl())},getAllPostsUrl:function getAllPostsUrl(){var _props2=this.props;var type=_props2.type;var sites=_props2.sites;var site=sites.getSelectedSite();var path=void 0;switch(type){case"page":path="/pages";break;case"post":path="/posts";break;default:path="/types/"+type}if(type==="post"&&site&&!site.jetpack&&!site.single_user_site){path+="/my"}if(site){path=route.addSiteFragment(path,site.slug)}return path},onMoreInfoAboutEmailVerify:function onMoreInfoAboutEmailVerify(){this.setState({showVerifyEmailDialog:true})},onTrashingPost:function onTrashingPost(error){var isPage=utils.isPage(this.state.post);if(error){this.setState({notice:{status:"is-error",message:"trashFailure"}})}else{stats.recordStat(isPage?"page_trashed":"post_trashed");stats.recordEvent(isPage?"Clicked Trash Page Button":"Clicked Trash Post Button");this.markSaved();this.onClose()}},onSaveTrashed:function onSaveTrashed(status,callback){this.hideDrafts();this.onSave(status,callback)},onSave:function onSave(status,callback){var edits=(0,_extends3.default)({},this.props.edits);if(status){edits.status=status}if(!utils.isPublished(this.state.savedPost)&&(!status&&utils.isPublished(this.state.post)||utils.isPublished(edits))){return}edits.content=this.refs.editor.getContent();actions.saveEdited(edits,function(error){if(error&&"NO_CHANGE"!==error.message){this.onSaveDraftFailure(error)}else{this.onSaveDraftSuccess()}if("function"===typeof callback){callback(error)}}.bind(this));this.setState({isSaving:true})},onPreview:function onPreview(event){var status="draft",previewPost;if(this.iframePreviewEnabled()&&!event.metaKey&&!event.ctrlKey){return this.iframePreview()}if(!this._previewWindow||this._previewWindow.closed){this._previewWindow=window.open("about:blank","WordPress.com Post Preview")}if(this.state.savedPost&&this.state.savedPost.status){status=this.state.savedPost.status}previewPost=function(){if(this._previewWindow){this._previewWindow.location=this.state.previewUrl;this._previewWindow.focus()}else{this._previewWindow=window.open(this.state.previewUrl,"WordPress.com Post Preview")}}.bind(this);if(status==="publish"){actions.edit({content:this.refs.editor.getContent()});actions.autosave(previewPost)}else{this.onSave(null,previewPost)}},iframePreviewEnabled:function iframePreviewEnabled(){var site=this.props.sites.getSelectedSite();return site&&!site.jetpack},iframePreview:function iframePreview(){if(this.state.isDirty||this.props.dirty){this.autosave();setTimeout(function(){this.setState({showPreview:true},function(){this.props.setLayoutFocus("content")})}.bind(this),150)}else{this.setState({showPreview:true},function(){this.props.setLayoutFocus("content")})}},onPreviewClose:function onPreviewClose(){this.setState({showPreview:false})},onSaveDraftFailure:function onSaveDraftFailure(error){this.onSaveFailure(error,"saveFailure")},onSaveDraftSuccess:function onSaveDraftSuccess(){var post=this.state.post;if(utils.isPublished(post)){this.onSaveSuccess("updated","view",post.URL)}else{this.onSaveSuccess()}},onPublish:function onPublish(){var edits=(0,_extends3.default)({},this.props.edits,{status:"publish"});if(utils.isPrivate(this.state.post)){edits.status="private"}else if(utils.isFutureDated(this.state.post)){edits.status="future"}edits.content=this.refs.editor.getContent();actions.saveEdited(edits,function(error){if(error&&"NO_CHANGE"!==error.message){this.onPublishFailure(error)}else{this.onPublishSuccess()}}.bind(this));this.setState({isSaving:true,isPublishing:true})},onPublishFailure:function onPublishFailure(error){this.onSaveFailure(error,"publishFailure");this.toggleSidebar()},onPublishSuccess:function onPublishSuccess(){var savedPost=this.state.savedPost;var message=void 0;if(utils.isPrivate(savedPost)){message="publishedPrivately"}else if(utils.isFutureDated(savedPost)){message="scheduled"}else{message="published"}this.onSaveSuccess(message,message==="published"?"view":"preview",savedPost.URL);this.toggleSidebar()},onSaveFailure:function onSaveFailure(error,message){this.setState({isSaving:false,isPublishing:false,notice:{status:"is-error",error:error,message:message}});window.scrollTo(0,0)},onSaveSuccess:function onSaveSuccess(message,action,link){var post=PostEditStore.get();if("draft"===post.status){this.props.setEditorLastDraft(post.site_ID,post.ID)}else{this.props.resetEditorLastDraft()}if(post.ID!==this.props.postId){this.props.setEditorPostId(post.ID)}this.props.receivePost(post);this.props.resetPostEdits(this.props.siteId);this.props.resetPostEdits(post.site_ID,post.ID);var nextState={isSaving:false,isPublishing:false};if(message){nextState.notice={status:"is-success",message:message,action:action,link:link};window.scrollTo(0,0)}else{nextState.notice=null}this.setState(nextState)},getEditorMode:function getEditorMode(){var editorMode="tinymce";if(this.props.editorModePreference){editorMode=this.props.editorModePreference;if(!this.recordedDefaultEditorMode){analytics.mc.bumpStat("calypso_default_editor_mode",editorMode);this.recordedDefaultEditorMode=true}}return editorMode},switchEditorMode:function switchEditorMode(mode){var content=this.refs.editor.getContent();if(mode==="html"){this.refs.editor.setEditorContent(content)}this.props.setEditorModePreference(mode);this._switchEditorTimeout=setTimeout(function(){actions.edit({content:content});if(mode==="html"){actions.editRawContent(content)}else{this.saveRawContent()}}.bind(this),0)}});exports.default=(0,_reactRedux.connect)(function(state){var siteId=(0,_selectors.getSelectedSiteId)(state);var postId=(0,_selectors2.getEditorPostId)(state);return{siteId:siteId,postId:postId,showDrafts:(0,_selectors2.isEditorDraftsVisible)(state),editorModePreference:(0,_selectors4.getPreference)(state,"editor-mode"),editPath:(0,_selectors2.getEditorPath)(state,siteId,postId),edits:(0,_selectors3.getPostEdits)(state,siteId,postId),dirty:(0,_selectors3.isEditedPostDirty)(state,siteId,postId)}},function(dispatch){return(0,_redux.bindActionCreators)({toggleDrafts:_actions2.toggleEditorDraftsVisible,setEditorLastDraft:_actions.setEditorLastDraft,resetEditorLastDraft:_actions.resetEditorLastDraft,receivePost:_actions3.receivePost,resetPostEdits:_actions3.resetPostEdits,setEditorPostId:_actions2.setEditorPostId,setEditorModePreference:_actions4.savePreference.bind(null,"editor-mode"),setLayoutFocus:_actions5.setLayoutFocus},dispatch)},null,{pure:false})(PostEditor);module.exports=exports["default"]},3174:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _noop=__webpack_require__(38);var _noop2=_interopRequireDefault(_noop);var _dialog=__webpack_require__(168);var _dialog2=_interopRequireDefault(_dialog);var _formButton=__webpack_require__(379);var _formButton2=_interopRequireDefault(_formButton);var _utils=__webpack_require__(1649);var _utils2=_interopRequireDefault(_utils);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"EditorRestorePostDialog",getDefaultProps:function getDefaultProps(){return{onClose:_noop2.default,onRestore:_noop2.default,isAutosave:false}},propTypes:{post:_react2.default.PropTypes.object.isRequired,onClose:_react2.default.PropTypes.func,onRestore:_react2.default.PropTypes.func,isAutosave:_react2.default.PropTypes.bool},restorePost:function restorePost(){if(this.props.isAutosave){this.props.onRestore()}else if(_utils2.default.userCan("delete_post",this.props.post)){this.props.onRestore("draft")}},getDialogButtons:function getDialogButtons(){return[_react2.default.createElement(_formButton2.default,{key:"restore",isPrimary:true,onClick:this.restorePost},this.translate("Restore")),_react2.default.createElement(_formButton2.default,{key:"back",isPrimary:false,onClick:this.props.onClose},this.translate("Don't restore"))]},getStrings:function getStrings(){if(this.props.isAutosave){if(_utils2.default.isPage(this.props.post)){return{dialogTitle:this.translate("Saved Draft"),dialogContent:this.translate("A more recent revision of this page exists. Restore?")}}return{dialogTitle:this.translate("Saved Draft"),dialogContent:this.translate("A more recent revision of this post exists. Restore?")}}if(_utils2.default.isPage(this.props.post)){return{dialogTitle:this.translate("Deleted Page"),dialogContent:this.translate("This page has been sent to the trash. Restore it to continue writing.")}}return{dialogTitle:this.translate("Deleted Post"),dialogContent:this.translate("This post has been sent to the trash. Restore it to continue writing.")}},render:function render(){var strings=this.getStrings();return _react2.default.createElement(_dialog2.default,{isVisible:true,buttons:this.getDialogButtons()},_react2.default.createElement("h1",null,strings.dialogTitle),_react2.default.createElement("p",null,strings.dialogContent))}});module.exports=exports["default"]},3175:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _noop=__webpack_require__(38);var _noop2=_interopRequireDefault(_noop);var _i18nCalypso=__webpack_require__(11);var _i18nCalypso2=_interopRequireDefault(_i18nCalypso);var _dialog=__webpack_require__(168);var _dialog2=_interopRequireDefault(_dialog);var _formButton=__webpack_require__(379);var _formButton2=_interopRequireDefault(_formButton);var _spinner=__webpack_require__(282);var _spinner2=_interopRequireDefault(_spinner);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var VerifyEmailDialog=function(_React$Component){(0,_inherits3.default)(VerifyEmailDialog,_React$Component);function VerifyEmailDialog(props){(0,_classCallCheck3.default)(this,VerifyEmailDialog);var _this=(0,_possibleConstructorReturn3.default)(this,(VerifyEmailDialog.__proto__||(0,_getPrototypeOf2.default)(VerifyEmailDialog)).call(this,props));_this.state={pendingRequest:false,emailSent:false,error:false};_this.handleSendVerification=_this.sendVerification.bind(_this);return _this}(0,_createClass3.default)(VerifyEmailDialog,[{key:"sendVerification",value:function sendVerification(e){e.preventDefault();if(this.state.pendingRequest){return}this.setState({pendingRequest:true});this.props.user.sendVerificationEmail(function(error,response){this.setState({emailSent:response&&response.success,error:error,pendingRequest:false})}.bind(this))}},{key:"getResendButtonLabel",value:function getResendButtonLabel(){if(this.state.emailSent){return _i18nCalypso2.default.translate("Email Sent")}if(this.state.pendingRequest){return _react2.default.createElement(_spinner2.default,{className:"post-editor__confirmation-dialog-spinner"})}return _i18nCalypso2.default.translate("Resend Email")}},{key:"getDialogButtons",value:function getDialogButtons(){return[_react2.default.createElement(_formButton2.default,{key:"close",isPrimary:true,onClick:this.props.onClose},_i18nCalypso2.default.translate("OK")),_react2.default.createElement(_formButton2.default,{key:"resend",isPrimary:false,disabled:this.state.pendingRequest||this.state.emailSent,onClick:this.handleSendVerification},this.getResendButtonLabel())]}},{key:"render",value:function render(){var strings={confirmHeading:_i18nCalypso2.default.translate("Please confirm your email address"),confirmExplanation:_i18nCalypso2.default.translate("We sent you an email when you first signed up. Please open the message and click the blue button."),confirmReasoning:_i18nCalypso2.default.translate("Email confirmation allows us to assist when recovering your account in the event you forget your password."),confirmEmail:_i18nCalypso2.default.translate("{{wrapper}}%(email)s{{/wrapper}} {{emailPreferences}}change{{/emailPreferences}}",{components:{wrapper:_react2.default.createElement("span",{className:"post-editor__confirmation-dialog-email-wrapper"}),emailPreferences:_react2.default.createElement("a",{href:"/me/account"})},args:{email:this.props.user.data.email}})};return _react2.default.createElement(_dialog2.default,{isVisible:true,buttons:this.getDialogButtons(),additionalClassNames:"post-editor__confirmation-dialog is-narrow"},_react2.default.createElement("h1",{className:"post-editor__confirmation-dialog-heading is-variable-height"},strings.confirmHeading),_react2.default.createElement("p",{className:"post-editor__confirmation-dialog-email"},strings.confirmEmail),_react2.default.createElement("p",{className:"post-editor__confirmation-dialog-explanation"},strings.confirmExplanation),_react2.default.createElement("p",{className:"post-editor__confirmation-dialog-reasoning"},strings.confirmReasoning))}}]);return VerifyEmailDialog}(_react2.default.Component);VerifyEmailDialog.propTypes={user:_react2.default.PropTypes.object.isRequired,onClose:_react2.default.PropTypes.func};VerifyEmailDialog.defaultProps={onClose:_noop2.default};exports.default=VerifyEmailDialog;module.exports=exports["default"]},3294:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.receivePageTemplates=receivePageTemplates;exports.requestPageTemplates=requestPageTemplates;var _wp=__webpack_require__(28);var _wp2=_interopRequireDefault(_wp);var _actionTypes=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function receivePageTemplates(siteId,templates){return{type:_actionTypes.PAGE_TEMPLATES_RECEIVE,siteId:siteId,templates:templates}}function requestPageTemplates(siteId){return function(dispatch){dispatch({type:_actionTypes.PAGE_TEMPLATES_REQUEST,siteId:siteId});return _wp2.default.site(siteId).pageTemplates().then(function(_ref){var templates=_ref.templates;dispatch(receivePageTemplates(siteId,templates));dispatch({type:_actionTypes.PAGE_TEMPLATES_REQUEST_SUCCESS,siteId:siteId})}).catch(function(error){dispatch({type:_actionTypes.PAGE_TEMPLATES_REQUEST_FAILURE,siteId:siteId,error:error})})}}},3295:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.receivePostTypeTaxonomies=receivePostTypeTaxonomies;exports.requestPostTypeTaxonomies=requestPostTypeTaxonomies;var _wp=__webpack_require__(28);var _wp2=_interopRequireDefault(_wp);var _actionTypes=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function receivePostTypeTaxonomies(siteId,postType,taxonomies){return{type:_actionTypes.POST_TYPES_TAXONOMIES_RECEIVE,siteId:siteId,postType:postType,taxonomies:taxonomies}}function requestPostTypeTaxonomies(siteId,postType){return function(dispatch){dispatch({type:_actionTypes.POST_TYPES_TAXONOMIES_REQUEST,siteId:siteId,postType:postType});return _wp2.default.withLocale().site(siteId).postType(postType).taxonomiesList().then(function(_ref){var taxonomies=_ref.taxonomies;dispatch(receivePostTypeTaxonomies(siteId,postType,taxonomies));dispatch({type:_actionTypes.POST_TYPES_TAXONOMIES_REQUEST_SUCCESS,siteId:siteId,postType:postType})}).catch(function(error){dispatch({type:_actionTypes.POST_TYPES_TAXONOMIES_REQUEST_FAILURE,siteId:siteId,postType:postType,error:error})})}}},3306:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.receiveMediaStorage=receiveMediaStorage;exports.requestMediaStorage=requestMediaStorage;var _wp=__webpack_require__(28);var _wp2=_interopRequireDefault(_wp);var _actionTypes=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function receiveMediaStorage(mediaStorage,siteId){return{type:_actionTypes.SITE_MEDIA_STORAGE_RECEIVE,mediaStorage:mediaStorage,siteId:siteId}}function requestMediaStorage(siteId){return function(dispatch){dispatch({type:_actionTypes.SITE_MEDIA_STORAGE_REQUEST,siteId:siteId});return _wp2.default.undocumented().site(siteId).mediaStorage().then(function(mediaStorage){dispatch(receiveMediaStorage(mediaStorage,siteId));dispatch({type:_actionTypes.SITE_MEDIA_STORAGE_REQUEST_SUCCESS,
siteId:siteId})}).catch(function(error){dispatch({type:_actionTypes.SITE_MEDIA_STORAGE_REQUEST_FAILURE,siteId:siteId,error:error})})}}},3309:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.formClear=formClear;exports.formLoad=formLoad;exports.fieldAdd=fieldAdd;exports.fieldRemove=fieldRemove;exports.fieldUpdate=fieldUpdate;exports.settingsUpdate=settingsUpdate;var _actionTypes=__webpack_require__(2);function formClear(){return{type:_actionTypes.EDITOR_CONTACT_FORM_CLEAR}}function formLoad(contactForm){return{type:_actionTypes.EDITOR_CONTACT_FORM_LOAD,contactForm:contactForm}}function fieldAdd(){return{type:_actionTypes.EDITOR_CONTACT_FORM_FIELD_ADD}}function fieldRemove(index){return{type:_actionTypes.EDITOR_CONTACT_FORM_FIELD_REMOVE,index:index}}function fieldUpdate(index,field){return{type:_actionTypes.EDITOR_CONTACT_FORM_FIELD_UPDATE,index:index,field:field}}function settingsUpdate(settings){return{type:_actionTypes.EDITOR_CONTACT_FORM_SETTINGS_UPDATE,settings:settings}}},3316:function(module,exports,__webpack_require__){module.exports={default:__webpack_require__(3352),__esModule:true}},3318:function(module,exports,__webpack_require__){var options=exports.options=__webpack_require__(3319);exports.parser=__webpack_require__(1671);exports.refiner=__webpack_require__(1798);exports.Parser=exports.parser.Parser;exports.Refiner=exports.refiner.Refiner;exports.Filter=exports.refiner.Filter;exports.ParsedResult=__webpack_require__(1658).ParsedResult;exports.ParsedComponents=__webpack_require__(1658).ParsedComponents;var Chrono=function(option){option=option||exports.options.casualOption();this.option=option;this.parsers=new Object(option.parsers);this.refiners=new Object(option.refiners)};Chrono.prototype.parse=function(text,refDate,opt){refDate=refDate||new Date;opt=opt||{};var allResults=[];this.parsers.forEach(function(parser){var results=parser.execute(text,refDate,opt);allResults=allResults.concat(results)});allResults.sort(function(a,b){return a.index-b.index});this.refiners.forEach(function(refiner){allResults=refiner.refine(text,allResults,opt)});return allResults};Chrono.prototype.parseDate=function(text,refDate,opt){var results=this.parse(text,refDate,opt);if(results.length>0){return results[0].start.date()}return null};exports.Chrono=Chrono;exports.strict=new Chrono(options.strictOption());exports.casual=new Chrono(options.casualOption());exports.parse=function(){return exports.casual.parse.apply(exports.casual,arguments)};exports.parseDate=function(){return exports.casual.parseDate.apply(exports.casual,arguments)}},3319:function(module,exports,__webpack_require__){var parser=__webpack_require__(1671);var refiner=__webpack_require__(1798);function baseOption(strictMode){return{parsers:[new parser.ENISOFormatParser(strictMode),new parser.ENDeadlineFormatParser(strictMode),new parser.ENMonthNameLittleEndianParser(strictMode),new parser.ENMonthNameMiddleEndianParser(strictMode),new parser.ENMonthNameParser(strictMode),new parser.ENSlashDateFormatParser(strictMode),new parser.ENSlashDateFormatStartWithYearParser(strictMode),new parser.ENSlashMonthFormatParser(strictMode),new parser.ENTimeAgoFormatParser(strictMode),new parser.ENTimeExpressionParser(strictMode),new parser.JPStandardParser(strictMode),new parser.ESTimeAgoFormatParser(strictMode),new parser.ESDeadlineFormatParser(strictMode),new parser.ESTimeExpressionParser(strictMode),new parser.ESMonthNameLittleEndianParser(strictMode),new parser.ESSlashDateFormatParser(strictMode)],refiners:[new refiner.OverlapRemovalRefiner,new refiner.ENMergeDateTimeRefiner,new refiner.ENMergeDateRangeRefiner,new refiner.JPMergeDateRangeRefiner,new refiner.ExtractTimezoneOffsetRefiner,new refiner.ExtractTimezoneAbbrRefiner,new refiner.UnlikelyFormatFilter]}}exports.strictOption=function(){return baseOption(true)};exports.casualOption=function(){var options=baseOption(false);options.parsers.unshift(new parser.ENCasualDateParser);options.parsers.unshift(new parser.ENWeekdayParser);options.parsers.unshift(new parser.JPCasualDateParser);options.parsers.unshift(new parser.ESCasualDateParser);options.parsers.unshift(new parser.ESWeekdayParser);return options}},3320:function(module,exports,__webpack_require__){var moment=__webpack_require__(4);var Parser=__webpack_require__(1671).Parser;var ParsedResult=__webpack_require__(1658).ParsedResult;var PATTERN=/(\W|^)(now|today|tonight|tomorrow|tmr|yesterday|last\s*night|this\s*(morning|afternoon|evening))(?=\W|$)/i;exports.Parser=function ENCasualDateParser(){Parser.apply(this,arguments);this.pattern=function(){return PATTERN};this.extract=function(text,ref,match,opt){var text=match[0].substr(match[1].length);var index=match.index+match[1].length;var result=new ParsedResult({index:index,text:text,ref:ref});var refMoment=moment(ref);var startMoment=refMoment.clone();var lowerText=text.toLowerCase();if(lowerText=="tonight"){result.start.imply("hour",22);result.start.imply("meridiem",1)}else if(lowerText=="tomorrow"||lowerText=="tmr"){if(refMoment.hour()>1){startMoment.add(1,"day")}}else if(lowerText=="yesterday"){startMoment.add(-1,"day")}else if(lowerText.match(/last\s*night/)){result.start.imply("hour",0);if(refMoment.hour()>6){startMoment.add(-1,"day")}}else if(lowerText.match("this")){var secondMatch=match[3].toLowerCase();if(secondMatch=="afternoon"){result.start.imply("hour",15)}else if(secondMatch=="evening"){result.start.imply("hour",18)}else if(secondMatch=="morning"){result.start.imply("hour",6)}}else if(lowerText.match("now")){result.start.imply("hour",refMoment.hour());result.start.imply("minute",refMoment.minute());result.start.imply("second",refMoment.second());result.start.imply("millisecond",refMoment.millisecond())}result.start.assign("day",startMoment.date());result.start.assign("month",startMoment.month()+1);result.start.assign("year",startMoment.year());result.tags["ENCasualDateParser"]=true;return result}}},3321:function(module,exports,__webpack_require__){var moment=__webpack_require__(4);var Parser=__webpack_require__(1671).Parser;var ParsedResult=__webpack_require__(1658).ParsedResult;var util=__webpack_require__(1930);var PATTERN=new RegExp("(\\W|^)"+"(within|in)\\s*"+"("+util.INTEGER_WORDS_PATTERN+"|[0-9]+|an?(?:\\s*few)?|half(?:\\s*an?)?)\\s*"+"(seconds?|min(?:ute)?s?|hours?|days?|weeks?|months?|years?)\\s*"+"(?=\\W|$)","i");var STRICT_PATTERN=new RegExp("(\\W|^)"+"(within|in)\\s*"+"("+util.INTEGER_WORDS_PATTERN+"|[0-9]+|an?)\\s*"+"(seconds?|minutes?|hours?|days?)\\s*"+"(?=\\W|$)","i");exports.Parser=function ENDeadlineFormatParser(){Parser.apply(this,arguments);this.pattern=function(){return this.isStrictMode()?STRICT_PATTERN:PATTERN};this.extract=function(text,ref,match,opt){var index=match.index+match[1].length;var text=match[0];text=match[0].substr(match[1].length,match[0].length-match[1].length);var result=new ParsedResult({index:index,text:text,ref:ref});var num=match[3].toLowerCase();if(util.INTEGER_WORDS[num]!==undefined){num=util.INTEGER_WORDS[num]}else if(num==="a"||num==="an"){num=1}else if(num.match(/few/i)){num=3}else if(num.match(/half/i)){num=.5}else{num=parseInt(num)}var date=moment(ref);if(match[4].match(/day|week|month|year/i)){if(match[4].match(/day/i)){date.add(num,"d")}else if(match[4].match(/week/i)){date.add(num*7,"d")}else if(match[4].match(/month/i)){date.add(num,"month")}else if(match[4].match(/year/i)){date.add(num,"year")}result.start.assign("year",date.year());result.start.assign("month",date.month()+1);result.start.assign("day",date.date());return result}if(match[4].match(/hour/i)){date.add(num,"hour")}else if(match[4].match(/min/i)){date.add(num,"minute")}else if(match[4].match(/second/i)){date.add(num,"second")}result.start.imply("year",date.year());result.start.imply("month",date.month()+1);result.start.imply("day",date.date());result.start.assign("hour",date.hour());result.start.assign("minute",date.minute());result.start.assign("second",date.second());result.tags["ENDeadlineFormatParser"]=true;return result}}},3322:function(module,exports,__webpack_require__){var moment=__webpack_require__(4);var Parser=__webpack_require__(1671).Parser;var ParsedResult=__webpack_require__(1658).ParsedResult;var PATTERN=new RegExp("(\\W|^)"+"([0-9]{4})\\-([0-9]{1,2})\\-([0-9]{1,2})"+"(?:T"+"([0-9]{1,2}):([0-9]{1,2})"+"(?::([0-9]{1,2})(?:\\.(\\d{1,4}))?)?"+"(?:Z|([+-]\\d{2}):?(\\d{2})?)?"+")?"+"(?=\\W|$)","i");var YEAR_NUMBER_GROUP=2;var MONTH_NUMBER_GROUP=3;var DATE_NUMBER_GROUP=4;var HOUR_NUMBER_GROUP=5;var MINUTE_NUMBER_GROUP=6;var SECOND_NUMBER_GROUP=7;var MILLISECOND_NUMBER_GROUP=8;var TZD_HOUR_OFFSET_GROUP=9;var TZD_MINUTE_OFFSET_GROUP=10;exports.Parser=function ENISOFormatParser(){Parser.apply(this,arguments);this.pattern=function(){return PATTERN};this.extract=function(text,ref,match,opt){var text=match[0].substr(match[1].length);var index=match.index+match[1].length;var result=new ParsedResult({text:text,index:index,ref:ref});result.start.assign("year",parseInt(match[YEAR_NUMBER_GROUP]));result.start.assign("month",parseInt(match[MONTH_NUMBER_GROUP]));result.start.assign("day",parseInt(match[DATE_NUMBER_GROUP]));if(moment(result.start.get("month"))>12||moment(result.start.get("month"))<1||moment(result.start.get("day"))>31||moment(result.start.get("day"))<1){return null}if(match[HOUR_NUMBER_GROUP]!=null){result.start.assign("hour",parseInt(match[HOUR_NUMBER_GROUP]));result.start.assign("minute",parseInt(match[MINUTE_NUMBER_GROUP]));if(match[SECOND_NUMBER_GROUP]!=null){result.start.assign("second",parseInt(match[SECOND_NUMBER_GROUP]))}if(match[MILLISECOND_NUMBER_GROUP]!=null){result.start.assign("millisecond",parseInt(match[MILLISECOND_NUMBER_GROUP]))}if(match[TZD_HOUR_OFFSET_GROUP]==null){result.start.assign("timezoneOffset",0)}else{var minuteOffset=0;var hourOffset=parseInt(match[TZD_HOUR_OFFSET_GROUP]);if(match[TZD_MINUTE_OFFSET_GROUP]!=null)minuteOffset=parseInt(match[TZD_MINUTE_OFFSET_GROUP]);var offset=hourOffset*60;if(offset<0){offset-=minuteOffset}else{offset+=minuteOffset}result.start.assign("timezoneOffset",offset)}}result.tags["ENISOFormatParser"]=true;return result}}},3323:function(module,exports,__webpack_require__){var moment=__webpack_require__(4);var Parser=__webpack_require__(1671).Parser;var ParsedResult=__webpack_require__(1658).ParsedResult;var util=__webpack_require__(1930);var PATTERN=new RegExp("(\\W|^)"+"(?:(Sunday|Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sun|Mon|Tue|Wed|Thu|Fri|Sat)\\s*,?\\s*)?"+"([0-9]{1,2})(?:st|nd|rd|th)?"+"(?:\\s*(?:to|\\-|\\|until|through|till|\\s)\\s*([0-9]{1,2})(?:st|nd|rd|th)?)?\\s*(?:of)?\\s*"+"(Jan(?:uary|\\.)?|Feb(?:ruary|\\.)?|Mar(?:ch|\\.)?|Apr(?:il|\\.)?|May|Jun(?:e|\\.)?|Jul(?:y|\\.)?|Aug(?:ust|\\.)?|Sep(?:tember|\\.)?|Oct(?:ober|\\.)?|Nov(?:ember|\\.)?|Dec(?:ember|\\.)?)"+"(?:"+",?\\s*([0-9]{2,4}(?![^\\s]\\d))"+"(\\s*BE)?"+")?"+"(?=\\W|$)","i");var WEEKDAY_GROUP=2;var DATE_GROUP=3;var DATE_TO_GROUP=4;var MONTH_NAME_GROUP=5;var YEAR_GROUP=6;var YEAR_BE_GROUP=7;exports.Parser=function ENMonthNameLittleEndianParser(){Parser.apply(this,arguments);this.pattern=function(){return PATTERN};this.extract=function(text,ref,match,opt){var result=new ParsedResult({text:match[0].substr(match[1].length,match[0].length-match[1].length),index:match.index+match[1].length,ref:ref});var month=match[MONTH_NAME_GROUP];month=util.MONTH_OFFSET[month.toLowerCase()];var day=match[DATE_GROUP];day=parseInt(day);var year=null;if(match[YEAR_GROUP]){year=match[YEAR_GROUP];year=parseInt(year);if(match[YEAR_BE_GROUP]){year=year-543}else if(year<100){year=year+2e3}}if(year){result.start.assign("day",day);result.start.assign("month",month);result.start.assign("year",year)}else{var refMoment=moment(ref);refMoment.month(month-1);refMoment.date(day);refMoment.year(moment(ref).year());var nextYear=refMoment.clone().add(1,"y");var lastYear=refMoment.clone().add(-1,"y");if(Math.abs(nextYear.diff(moment(ref)))<Math.abs(refMoment.diff(moment(ref)))){refMoment=nextYear}else if(Math.abs(lastYear.diff(moment(ref)))<Math.abs(refMoment.diff(moment(ref)))){refMoment=lastYear}result.start.assign("day",day);result.start.assign("month",month);result.start.imply("year",refMoment.year())}if(match[WEEKDAY_GROUP]){var weekday=match[WEEKDAY_GROUP];weekday=util.WEEKDAY_OFFSET[weekday.toLowerCase()];result.start.assign("weekday",weekday)}if(match[DATE_TO_GROUP]){result.end=result.start.clone();result.end.assign("day",parseInt(match[DATE_TO_GROUP]))}result.tags["ENMonthNameLittleEndianParser"]=true;return result}}},3324:function(module,exports,__webpack_require__){var moment=__webpack_require__(4);var Parser=__webpack_require__(1671).Parser;var ParsedResult=__webpack_require__(1658).ParsedResult;var util=__webpack_require__(1930);var PATTERN=new RegExp("(\\W|^)"+"(?:"+"(Sunday|Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sun\\.?|Mon\\.?|Tue\\.?|Wed\\.?|Thu\\.?|Fri\\.?|Sat\\.?)"+"\\s*,?\\s*)?"+"(Jan\\.?|January|Feb\\.?|February|Mar\\.?|March|Apr\\.?|April|May\\.?|Jun\\.?|June|Jul\\.?|July|Aug\\.?|August|Sep\\.?|Sept\\.?|September|Oct\\.?|October|Nov\\.?|November|Dec\\.?|December)"+"\\s*"+"([0-9]{1,2})(?:st|nd|rd|th)?\\s*"+"(?:"+"(?:to|\\-)\\s*"+"([0-9]{1,2})(?:st|nd|rd|th)?\\s*"+")?"+"(?:"+"\\s*,?\\s*([0-9]{4})(\\s*BE)?\\s*"+")?"+"(?=\\W|$)(?!\\:\\d)","i");var WEEKDAY_GROUP=2;var MONTH_NAME_GROUP=3;var DATE_GROUP=4;var DATE_TO_GROUP=5;var YEAR_GROUP=6;var YEAR_BE_GROUP=7;exports.Parser=function ENMonthNameMiddleEndianParser(){Parser.apply(this,arguments);this.pattern=function(){return PATTERN};this.extract=function(text,ref,match,opt){if(text.indexOf("5 May 12:00")>=0){console.log(match)}var result=new ParsedResult({text:match[0].substr(match[1].length,match[0].length-match[1].length),index:match.index+match[1].length,ref:ref});var month=match[MONTH_NAME_GROUP];month=util.MONTH_OFFSET[month.toLowerCase()];var day=match[DATE_GROUP];day=parseInt(day);var year=null;if(match[YEAR_GROUP]){year=match[YEAR_GROUP];year=parseInt(year);if(match[YEAR_BE_GROUP]){year=year-543}else if(year<100){year=year+2e3}}if(year){result.start.assign("day",day);result.start.assign("month",month);result.start.assign("year",year)}else{var refMoment=moment(ref);refMoment.month(month-1);refMoment.date(day);var nextYear=refMoment.clone().add(1,"y");var lastYear=refMoment.clone().add(-1,"y");if(Math.abs(nextYear.diff(moment(ref)))<Math.abs(refMoment.diff(moment(ref)))){refMoment=nextYear}else if(Math.abs(lastYear.diff(moment(ref)))<Math.abs(refMoment.diff(moment(ref)))){refMoment=lastYear}result.start.assign("day",day);result.start.assign("month",month);result.start.imply("year",refMoment.year())}if(match[WEEKDAY_GROUP]){var weekday=match[WEEKDAY_GROUP];weekday=util.WEEKDAY_OFFSET[weekday.toLowerCase()];result.start.assign("weekday",weekday)}if(match[DATE_TO_GROUP]){result.end=result.start.clone();result.end.assign("day",parseInt(match[DATE_TO_GROUP]))}result.tags["ENMonthNameMiddleEndianParser"]=true;return result}}},3325:function(module,exports,__webpack_require__){var moment=__webpack_require__(4);var Parser=__webpack_require__(1671).Parser;var ParsedResult=__webpack_require__(1658).ParsedResult;var util=__webpack_require__(1930);var PATTERN=new RegExp("(^|\\D\\s+|[^\\w\\s])"+"(Jan\\.?|January|Feb\\.?|February|Mar\\.?|March|Apr\\.?|April|May\\.?|Jun\\.?|June|Jul\\.?|July|Aug\\.?|August|Sep\\.?|Sept\\.?|September|Oct\\.?|October|Nov\\.?|November|Dec\\.?|December)"+"\\s*"+"(?:"+",?\\s*([0-9]{4})(\\s*BE)?"+")?"+"(?=[^\\s\\w]|$)","i");var MONTH_NAME_GROUP=2;var YEAR_GROUP=3;var YEAR_BE_GROUP=4;exports.Parser=function ENMonthNameParser(){Parser.apply(this,arguments);this.pattern=function(){return PATTERN};this.extract=function(text,ref,match,opt){var result=new ParsedResult({text:match[0].substr(match[1].length,match[0].length-match[1].length),index:match.index+match[1].length,ref:ref});var month=match[MONTH_NAME_GROUP];month=util.MONTH_OFFSET[month.toLowerCase()];var day=1;var year=null;if(match[YEAR_GROUP]){year=match[YEAR_GROUP];year=parseInt(year);if(match[YEAR_BE_GROUP]){year=year-543}else if(year<100){year=year+2e3}}if(year){result.start.imply("day",day);result.start.assign("month",month);result.start.assign("year",year)}else{var refMoment=moment(ref);refMoment.month(month-1);refMoment.date(day);var nextYear=refMoment.clone().add(1,"y");var lastYear=refMoment.clone().add(-1,"y");if(Math.abs(nextYear.diff(moment(ref)))<Math.abs(refMoment.diff(moment(ref)))){refMoment=nextYear}else if(Math.abs(lastYear.diff(moment(ref)))<Math.abs(refMoment.diff(moment(ref)))){refMoment=lastYear}result.start.imply("day",day);result.start.assign("month",month);result.start.imply("year",refMoment.year())}result.tags["ENMonthNameParser"]=true;return result}}},3326:function(module,exports,__webpack_require__){var moment=__webpack_require__(4);var Parser=__webpack_require__(1671).Parser;var ParsedResult=__webpack_require__(1658).ParsedResult;var PATTERN=new RegExp("(\\W|^)"+"(?:"+"((?:sun|mon|tues?|wed(?:nes)?|thu(?:rs?)?|fri|sat(?:ur)?)(?:day)?)"+"\\s*\\,?\\s*"+")?"+"([0-9]{1,2})[\\/\\.\\-]([0-9]{1,2})"+"(?:"+"[\\/\\.\\-]"+"([0-9]{4}|[0-9]{2})"+")?"+"(\\W|$)","i");var DAYS_OFFSET={sunday:0,sun:0,monday:1,mon:1,tuesday:2,wednesday:3,wed:3,thursday:4,thur:4,friday:5,fri:5,saturday:6,sat:6};var OPENNING_GROUP=1;var ENDING_GROUP=6;var WEEKDAY_GROUP=2;var MONTH_GROUP=3;var DAY_GROUP=4;var YEAR_GROUP=5;exports.Parser=function ENSlashDateFormatParser(argument){Parser.apply(this,arguments);this.pattern=function(){return PATTERN};this.extract=function(text,ref,match,opt){if(match[OPENNING_GROUP]=="/"||match[ENDING_GROUP]=="/"){match.index+=match[0].length;return}var index=match.index+match[OPENNING_GROUP].length;var text=match[0].substr(match[OPENNING_GROUP].length,match[0].length-match[ENDING_GROUP].length);var result=new ParsedResult({text:text,index:index,ref:ref});if(text.match(/^\d\.\d$/))return;if(text.match(/^\d\.\d{1,2}\.\d{1,2}$/))return;if(!match[YEAR_GROUP]&&match[0].indexOf("/")<0)return;var date=null;var year=match[YEAR_GROUP]||moment(ref).year()+"";var month=match[MONTH_GROUP];var day=match[DAY_GROUP];month=parseInt(month);day=parseInt(day);year=parseInt(year);if(month<1||month>12){if(month>12){if(day>=1&&day<=12&&month>=13&&month<=31){var tday=month;month=day;day=tday}else{return null}}}if(day<1||day>31)return null;if(year<100){if(year>50){year=year+1900}else{year=year+2e3}}result.start.assign("day",day);result.start.assign("month",month);result.start.assign("year",year);if(match[WEEKDAY_GROUP]){result.start.assign("weekday",DAYS_OFFSET[match[WEEKDAY_GROUP].toLowerCase()])}result.tags["ENSlashDateFormatParser"]=true;return result}}},3327:function(module,exports,__webpack_require__){var moment=__webpack_require__(4);var Parser=__webpack_require__(1671).Parser;var ParsedResult=__webpack_require__(1658).ParsedResult;var PATTERN=new RegExp("(\\W|^)"+"([0-9]{4})[\\-\\.\\/]([0-9]{1,2})[\\-\\.\\/]([0-9]{1,2})"+"(?=\\W|$)","i");var YEAR_NUMBER_GROUP=2;var MONTH_NUMBER_GROUP=3;var DATE_NUMBER_GROUP=4;exports.Parser=function ENSlashDateFormatStartWithYearParser(){Parser.apply(this,arguments);this.pattern=function(){return PATTERN};this.extract=function(text,ref,match,opt){var text=match[0].substr(match[1].length);var index=match.index+match[1].length;var result=new ParsedResult({text:text,index:index,ref:ref});result.start.assign("year",parseInt(match[YEAR_NUMBER_GROUP]));result.start.assign("month",parseInt(match[MONTH_NUMBER_GROUP]));result.start.assign("day",parseInt(match[DATE_NUMBER_GROUP]));if(moment(result.start.get("month"))>12||moment(result.start.get("month"))<1||moment(result.start.get("day"))>31||moment(result.start.get("day"))<1){return null}result.tags["ENDateFormatParser"]=true;return result}}},3328:function(module,exports,__webpack_require__){var moment=__webpack_require__(4);var Parser=__webpack_require__(1671).Parser;var ParsedResult=__webpack_require__(1658).ParsedResult;var PATTERN=new RegExp("(^|[^\\d/]\\s+|[^\\w\\s])"+"([0-9]|0[1-9]|1[012])/([0-9]{4})"+"([^\\d/]|$)","i");var OPENNING_GROUP=1;var ENDING_GROUP=4;var MONTH_GROUP=2;var YEAR_GROUP=3;exports.Parser=function ENSlashMonthFormatParser(argument){Parser.apply(this,arguments);this.pattern=function(){return PATTERN};this.extract=function(text,ref,match,opt){var index=match.index+match[OPENNING_GROUP].length;var text=match[0].substr(match[OPENNING_GROUP].length,match[0].length-(1+match[ENDING_GROUP].length)).trim();var result=new ParsedResult({text:text,index:index,ref:ref});var date=null;var year=match[YEAR_GROUP];var month=match[MONTH_GROUP];var day=1;month=parseInt(month);year=parseInt(year);result.start.imply("day",day);result.start.assign("month",month);result.start.assign("year",year);result.tags["ENSlashMonthFormatParser"]=true;return result}}},3329:function(module,exports,__webpack_require__){var moment=__webpack_require__(4);var Parser=__webpack_require__(1671).Parser;var ParsedResult=__webpack_require__(1658).ParsedResult;var util=__webpack_require__(1930);var PATTERN=new RegExp(""+"(\\W|^)"+"(?:within\\s*)?"+"("+util.INTEGER_WORDS_PATTERN+"|[0-9]+|an?(?:\\s*few)?|half(?:\\s*an?)?)\\s*"+"(seconds?|min(?:ute)?s?|hours?|weeks?|days?|months?|years?)\\s*"+"(?:ago|before|earlier)(?=(?:\\W|$))","i");var STRICT_PATTERN=new RegExp(""+"(\\W|^)"+"(?:within\\s*)?"+"([0-9]+|an?)\\s*"+"(seconds?|minutes?|hours?|days?)\\s*"+"ago(?=(?:\\W|$))","i");exports.Parser=function ENTimeAgoFormatParser(){Parser.apply(this,arguments);this.pattern=function(){return this.isStrictMode()?STRICT_PATTERN:PATTERN};this.extract=function(text,ref,match,opt){if(match.index>0&&text[match.index-1].match(/\w/))return null;var text=match[0];text=match[0].substr(match[1].length,match[0].length-match[1].length);index=match.index+match[1].length;var result=new ParsedResult({index:index,text:text,ref:ref});var num=match[2].toLowerCase();if(util.INTEGER_WORDS[num]!==undefined){num=util.INTEGER_WORDS[num]}else if(num==="a"||num==="an"){num=1}else if(num.match(/few/)){num=3}else if(num.match(/half/)){num=.5}else{num=parseInt(num)}var date=moment(ref);if(match[3].match(/hour|min|second/i)){if(match[3].match(/hour/i)){date.add(-num,"hour")}else if(match[3].match(/min/i)){date.add(-num,"minute")}else if(match[3].match(/second/i)){date.add(-num,"second")}result.start.imply("day",date.date());result.start.imply("month",date.month()+1);result.start.imply("year",date.year());result.start.assign("hour",date.hour());result.start.assign("minute",date.minute());result.start.assign("second",date.second());result.tags["ENTimeAgoFormatParser"]=true;return result}if(match[3].match(/week/i)){date.add(-num,"week");result.start.imply("day",date.date());result.start.imply("month",date.month()+1);result.start.imply("year",date.year());result.start.imply("weekday",date.day());return result}if(match[3].match(/day/i)){date.add(-num,"d")}if(match[3].match(/month/i)){date.add(-num,"month")}if(match[3].match(/year/i)){date.add(-num,"year")}result.start.assign("day",date.date());result.start.assign("month",date.month()+1);result.start.assign("year",date.year());return result}}},3330:function(module,exports,__webpack_require__){var moment=__webpack_require__(4);var Parser=__webpack_require__(1671).Parser;var ParsedResult=__webpack_require__(1658).ParsedResult;var ParsedComponents=__webpack_require__(1658).ParsedComponents;var FIRST_REG_PATTERN=new RegExp("(^|\\s|T)"+"(?:(?:at|from)\\s*)?"+"(\\d{1,4}|noon|midnight)"+"(?:"+"(?:\\.|\\:|\\)(\\d{1,2})"+"(?:"+"(?:\\:|\\)(\\d{2})"+")?"+")?"+"(?:\\s*(A\\.M\\.|P\\.M\\.|AM?|PM?))?"+"(?=\\W|$)","i");var SECOND_REG_PATTERN=new RegExp("^\\s*"+"(\\-|\\|\\~|\\|to|\\?)\\s*"+"(\\d{1,4})"+"(?:"+"(?:\\.|\\:|\\)(\\d{1,2})"+"(?:"+"(?:\\.|\\:|\\)(\\d{1,2})"+")?"+")?"+"(?:\\s*(A\\.M\\.|P\\.M\\.|AM?|PM?))?"+"(?=\\W|$)","i");var HOUR_GROUP=2;var MINUTE_GROUP=3;var SECOND_GROUP=4;var AM_PM_HOUR_GROUP=5;exports.Parser=function ENTimeExpressionParser(){Parser.apply(this,arguments);this.pattern=function(){return FIRST_REG_PATTERN};this.extract=function(text,ref,match,opt){if(match.index>0&&text[match.index-1].match(/\w/))return null;var refMoment=moment(ref);var result=new ParsedResult;result.ref=ref;result.index=match.index+match[1].length;result.text=match[0].substring(match[1].length);result.tags["ENTimeExpressionParser"]=true;result.start.imply("day",refMoment.date());result.start.imply("month",refMoment.month()+1);result.start.imply("year",refMoment.year());var hour=0;var minute=0;var meridiem=-1;if(match[SECOND_GROUP]!=null){var second=parseInt(match[SECOND_GROUP]);if(second>=60)return null;result.start.assign("second",second)}if(match[HOUR_GROUP].toLowerCase()=="noon"){meridiem=1;hour=12}else if(match[HOUR_GROUP].toLowerCase()=="midnight"){meridiem=0;hour=0}else{hour=parseInt(match[HOUR_GROUP])}if(match[MINUTE_GROUP]!=null){minute=parseInt(match[MINUTE_GROUP])}else if(hour>100){minute=hour%100;hour=parseInt(hour/100)}if(minute>=60){return null}if(hour>24){return null}if(hour>=12){meridiem=1}if(match[AM_PM_HOUR_GROUP]!=null){if(hour>12)return null;var ampm=match[AM_PM_HOUR_GROUP][0].toLowerCase();if(ampm=="a"){meridiem=0;if(hour==12)hour=0}if(ampm=="p"){meridiem=1;if(hour!=12)hour+=12}}result.start.assign("hour",hour);result.start.assign("minute",minute);if(meridiem>=0){result.start.assign("meridiem",meridiem)}else{if(hour<12){result.start.imply("meridiem",0)}else{result.start.imply("meridiem",1)}}match=SECOND_REG_PATTERN.exec(text.substring(result.index+result.text.length));if(!match){if(result.text.match(/^\d+$/)){return null}return result}if(match[0].match(/^\s*(\+|\-)\s*\d{3,4}$/)){return result}if(result.end==null){result.end=new ParsedComponents(null,result.start.date())}var hour=0;var minute=0;var meridiem=-1;if(match[SECOND_GROUP]!=null){var second=parseInt(match[SECOND_GROUP]);if(second>=60)return null;result.end.assign("second",second)}hour=parseInt(match[2]);if(match[MINUTE_GROUP]!=null){minute=parseInt(match[MINUTE_GROUP]);if(minute>=60)return result}else if(hour>100){minute=hour%100;hour=parseInt(hour/100)}if(minute>=60){return null}if(hour>24){return null}if(hour>=12){meridiem=1}if(match[AM_PM_HOUR_GROUP]!=null){if(hour>12)return null;if(match[AM_PM_HOUR_GROUP][0].toLowerCase()=="a"){meridiem=0;if(hour==12){hour=0;if(!result.end.isCertain("day")){result.end.imply("day",result.end.get("day")+1)}}}if(match[AM_PM_HOUR_GROUP][0].toLowerCase()=="p"){meridiem=1;if(hour!=12)hour+=12}if(!result.start.isCertain("meridiem")){if(meridiem==0){result.start.imply("meridiem",0);if(result.start.get("hour")==12){result.start.assign("hour",0)}}else{result.start.imply("meridiem",1);if(result.start.get("hour")!=12){result.start.assign("hour",result.start.get("hour")+12)}}}}result.text=result.text+match[0];result.end.assign("hour",hour);result.end.assign("minute",minute);if(meridiem>=0){result.end.assign("meridiem",meridiem)}else{var startAtPM=result.start.isCertain("meridiem")&&result.start.get("meridiem")==1;if(startAtPM&&result.start.get("hour")>hour){result.end.imply("meridiem",0)}else if(hour>12){result.end.imply("meridiem",1)}}if(result.end.date().getTime()<result.start.date().getTime()){result.end.imply("day",result.end.get("day")+1)}return result}}},3331:function(module,exports,__webpack_require__){var moment=__webpack_require__(4);var Parser=__webpack_require__(1671).Parser;var ParsedResult=__webpack_require__(1658).ParsedResult;var DAYS_OFFSET={sunday:0,sun:0,monday:1,mon:1,tuesday:2,tues:2,tue:2,wednesday:3,wed:3,thursday:4,thurs:4,thur:4,thu:4,friday:5,fri:5,saturday:6,sat:6};var PATTERN=new RegExp("(\\W|^)"+"(?:(?:\\,|\\(|\\)\\s*)?"+"(?:(this|last|next)\\s*)?"+"("+Object.keys(DAYS_OFFSET).join("|")+")"+"(?:\\s*(?:\\,|\\)|\\))?"+"(?:\\s*(this|last|next)\\s*week)?"+"(?=\\W|$)","i");var PREFIX_GROUP=2;var WEEKDAY_GROUP=3;var POSTFIX_GROUP=4;exports.Parser=function ENWeekdayParser(){Parser.apply(this,arguments);this.pattern=function(){return PATTERN};this.extract=function(text,ref,match,opt){var index=match.index+match[1].length;var text=match[0].substr(match[1].length,match[0].length-match[1].length);var result=new ParsedResult({index:index,text:text,ref:ref});var dayOfWeek=match[WEEKDAY_GROUP].toLowerCase();var offset=DAYS_OFFSET[dayOfWeek];if(offset===undefined)return null;var startMoment=moment(ref);var prefix=match[PREFIX_GROUP];var postfix=match[POSTFIX_GROUP];if(prefix||postfix){var norm=prefix||postfix;norm=norm.toLowerCase();if(norm=="last")startMoment.day(offset-7);else if(norm=="next")startMoment.day(offset+7);else if(norm=="this")startMoment.day(offset)}else{var refOffset=startMoment.day();if(opt.forwardDatesOnly&&refOffset>offset){startMoment.day(offset+7)}else if(!opt.forwardDatesOnly&&Math.abs(offset-7-refOffset)<Math.abs(offset-refOffset)){startMoment.day(offset-7)}else if(!opt.forwardDatesOnly&&Math.abs(offset+7-refOffset)<Math.abs(offset-refOffset)){startMoment.day(offset+7)}else{startMoment.day(offset)}}result.start.assign("weekday",offset);result.start.imply("day",startMoment.date());result.start.imply("month",startMoment.month()+1);result.start.imply("year",startMoment.year());return result}}},3332:function(module,exports,__webpack_require__){var moment=__webpack_require__(4);var Parser=__webpack_require__(1671).Parser;var ParsedResult=__webpack_require__(1658).ParsedResult;var PATTERN=/(\W|^)(ahora|esta\s*(maana|tarde|noche)|(ayer|maana)\s*por\s*la\s*(maana|tarde|noche)|hoy|maana|ayer|anoche)(?=\W|$)/i;exports.Parser=function ESCasualDateParser(){Parser.apply(this,arguments);this.pattern=function(){return PATTERN};this.extract=function(text,ref,match,opt){var text=match[0].substr(match[1].length);var index=match.index+match[1].length;var result=new ParsedResult({index:index,text:text,ref:ref});var refMoment=moment(ref);var startMoment=refMoment.clone();var lowerText=text.toLowerCase().replace(/\s+/g," ");if(lowerText=="maana"){if(refMoment.hour()>1){startMoment.add(1,"day")}}else if(lowerText=="ayer"){startMoment.add(-1,"day")}else if(lowerText=="anoche"){result.start.imply("hour",0);if(refMoment.hour()>6){startMoment.add(-1,"day")}}else if(lowerText.match("esta")){var secondMatch=match[3].toLowerCase();if(secondMatch=="tarde"){result.start.imply("hour",18)}else if(secondMatch=="maana"){result.start.imply("hour",6)}else if(secondMatch=="noche"){result.start.imply("hour",22);result.start.imply("meridiem",1)}}else if(lowerText.match(/por\s*la/)){var firstMatch=match[4].toLowerCase();if(firstMatch==="ayer"){startMoment.add(-1,"day")}else if(firstMatch==="maana"){startMoment.add(1,"day")}var secondMatch=match[5].toLowerCase();if(secondMatch=="tarde"){result.start.imply("hour",18)}else if(secondMatch=="maana"){result.start.imply("hour",9)}else if(secondMatch=="noche"){result.start.imply("hour",22);result.start.imply("meridiem",1)}}else if(lowerText.match("ahora")){result.start.imply("hour",refMoment.hour());result.start.imply("minute",refMoment.minute());result.start.imply("second",refMoment.second());result.start.imply("millisecond",refMoment.millisecond())}result.start.assign("day",startMoment.date());result.start.assign("month",startMoment.month()+1);result.start.assign("year",startMoment.year());result.tags["ESCasualDateParser"]=true;return result}}},3333:function(module,exports,__webpack_require__){var moment=__webpack_require__(4);var Parser=__webpack_require__(1671).Parser;var ParsedResult=__webpack_require__(1658).ParsedResult;var PATTERN=/(\W|^)(dentro\s*de|en)\s*([0-9]+|medi[oa]|una?)\s*(minutos?|horas?|d[i]as?)\s*(?=(?:\W|$))/i;exports.Parser=function ESDeadlineFormatParser(){Parser.apply(this,arguments);this.pattern=function(){return PATTERN};this.extract=function(text,ref,match,opt){var index=match.index+match[1].length;var text=match[0];text=match[0].substr(match[1].length,match[0].length-match[1].length);var result=new ParsedResult({index:index,text:text,ref:ref});var num=parseInt(match[3]);if(isNaN(num)){if(match[3].match(/medi/)){num=.5}else{num=1}}var date=moment(ref);if(match[4].match(/d[i]a/)){date.add(num,"d");result.start.assign("year",date.year());
result.start.assign("month",date.month()+1);result.start.assign("day",date.date());return result}if(match[4].match(/hora/)){date.add(num,"hour")}else if(match[4].match(/minuto/)){date.add(num,"minute")}result.start.imply("year",date.year());result.start.imply("month",date.month()+1);result.start.imply("day",date.date());result.start.assign("hour",date.hour());result.start.assign("minute",date.minute());result.tags["ESDeadlineFormatParser"]=true;return result}}},3334:function(module,exports,__webpack_require__){var moment=__webpack_require__(4);var Parser=__webpack_require__(1671).Parser;var ParsedResult=__webpack_require__(1658).ParsedResult;var util=__webpack_require__(3347);var DAYS_OFFSET=util.WEEKDAY_OFFSET;var PATTERN=new RegExp("(\\W|^)"+"(?:(Domingo|Lunes|Martes|Mircoles|Miercoles|Jueves|Viernes|Sbado|Sabado|Dom|Lun|Mar|Mie|Jue|Vie|Sab)\\s*,?\\s*)?"+"([0-9]{1,2})(?:||)?"+"(?:\\s*(?:desde|de|\\-|\\|al?|hasta|\\s)\\s*([0-9]{1,2})(?:||)?)?\\s*(?:de)?\\s*"+"(Ene(?:ro|\\.)?|Feb(?:rero|\\.)?|Mar(?:zo|\\.)?|Abr(?:il|\\.)?|May(?:o|\\.)?|Jun(?:io|\\.)?|Jul(?:io|\\.)?|Ago(?:sto|\\.)?|Sep(?:tiembre|\\.)?|Oct(?:ubre|\\.)?|Nov(?:iembre|\\.)?|Dic(?:iembre|\\.)?)"+"(?:\\s*(?:del?)?(\\s*[0-9]{2,4}(?![^\\s]\\d))(\\s*AC)?)?"+"(?=\\W|$)","i");var WEEKDAY_GROUP=2;var DATE_GROUP=3;var DATE_TO_GROUP=4;var MONTH_NAME_GROUP=5;var YEAR_GROUP=6;var YEAR_BE_GROUP=7;exports.Parser=function ESMonthNameLittleEndianParser(){Parser.apply(this,arguments);this.pattern=function(){return PATTERN};this.extract=function(text,ref,match,opt){var result=new ParsedResult({text:match[0].substr(match[1].length,match[0].length-match[1].length),index:match.index+match[1].length,ref:ref});var month=match[MONTH_NAME_GROUP];month=util.MONTH_OFFSET[month.toLowerCase()];var day=match[DATE_GROUP];day=parseInt(day);var year=null;if(match[YEAR_GROUP]){year=match[YEAR_GROUP];year=parseInt(year);if(match[YEAR_BE_GROUP]){year=year-543}else if(year<100){year=year+2e3}}if(year){result.start.assign("day",day);result.start.assign("month",month);result.start.assign("year",year)}else{var refMoment=moment(ref);refMoment.month(month-1);refMoment.date(day);refMoment.year(moment(ref).year());var nextYear=refMoment.clone().add(1,"y");var lastYear=refMoment.clone().add(-1,"y");if(Math.abs(nextYear.diff(moment(ref)))<Math.abs(refMoment.diff(moment(ref)))){refMoment=nextYear}else if(Math.abs(lastYear.diff(moment(ref)))<Math.abs(refMoment.diff(moment(ref)))){refMoment=lastYear}result.start.assign("day",day);result.start.assign("month",month);result.start.imply("year",refMoment.year())}if(match[WEEKDAY_GROUP]){var weekday=match[WEEKDAY_GROUP];weekday=util.WEEKDAY_OFFSET[weekday.toLowerCase()];result.start.assign("weekday",weekday)}if(match[DATE_TO_GROUP]){result.end=result.start.clone();result.end.assign("day",parseInt(match[DATE_TO_GROUP]))}result.tags["ESMonthNameLittleEndianParser"]=true;return result}}},3335:function(module,exports,__webpack_require__){var moment=__webpack_require__(4);var Parser=__webpack_require__(1671).Parser;var ParsedResult=__webpack_require__(1658).ParsedResult;var PATTERN=new RegExp("(\\W|^)"+"(?:"+"((?:domingo|dom|lunes|lun|martes|mar|mi[e]rcoles|mie|jueves|jue|viernes|vie|s[a]bado|sab))"+"\\s*\\,?\\s*"+")?"+"([0-9]{1,2})[\\/\\.\\-]([0-9]{1,2})"+"(?:"+"[\\/\\.\\-]"+"([0-9]{4}|[0-9]{2})"+")?"+"(\\W|$)","i");var DAYS_OFFSET={domingo:0,dom:0,lunes:1,lun:1,martes:2,mar:2,miercoles:3,"mircoles":3,mie:3,jueves:4,jue:4,viernes:5,vier:5,"sbado":6,sabado:6,sab:6};var OPENNING_GROUP=1;var ENDING_GROUP=6;var WEEKDAY_GROUP=2;var MONTH_GROUP=4;var DAY_GROUP=3;var YEAR_GROUP=5;exports.Parser=function ESSlashDateFormatParser(argument){Parser.apply(this,arguments);this.pattern=function(){return PATTERN};this.extract=function(text,ref,match,opt){if(match[OPENNING_GROUP]=="/"||match[ENDING_GROUP]=="/"){match.index+=match[0].length;return}var index=match.index+match[OPENNING_GROUP].length;var text=match[0].substr(match[OPENNING_GROUP].length,match[0].length-match[ENDING_GROUP].length);var result=new ParsedResult({text:text,index:index,ref:ref});if(text.match(/^\d\.\d$/))return;if(text.match(/^\d\.\d{1,2}\.\d{1,2}$/))return;if(!match[YEAR_GROUP]&&match[0].indexOf("/")<0)return;var date=null;var year=match[YEAR_GROUP]||moment(ref).year()+"";var month=match[MONTH_GROUP];var day=match[DAY_GROUP];month=parseInt(month);day=parseInt(day);year=parseInt(year);if(month<1||month>12){if(month>12){if(day>=1&&day<=12&&month>=13&&month<=31){var tday=month;month=day;day=tday}else{return null}}}if(day<1||day>31)return null;if(year<100){if(year>50){year=year+2500-543}else{year=year+2e3}}result.start.assign("day",day);result.start.assign("month",month);result.start.assign("year",year);if(match[WEEKDAY_GROUP]){result.start.assign("weekday",DAYS_OFFSET[match[WEEKDAY_GROUP].toLowerCase()])}result.tags["ESSlashDateFormatParser"]=true;return result}}},3336:function(module,exports,__webpack_require__){var moment=__webpack_require__(4);var Parser=__webpack_require__(1671).Parser;var ParsedResult=__webpack_require__(1658).ParsedResult;var PATTERN=/(\W|^)hace\s*([0-9]+|medi[oa]|una?)\s*(minutos?|horas?|semanas?|d[i]as?|mes(es)?|aos?)(?=(?:\W|$))/i;exports.Parser=function ESTimeAgoFormatParser(){Parser.apply(this,arguments);this.pattern=function(){return PATTERN};this.extract=function(text,ref,match,opt){if(match.index>0&&text[match.index-1].match(/\w/))return null;var text=match[0];text=match[0].substr(match[1].length,match[0].length-match[1].length);index=match.index+match[1].length;var result=new ParsedResult({index:index,text:text,ref:ref});var num=parseInt(match[2]);if(isNaN(num)){if(match[2].match(/medi/)){num=.5}else{num=1}}var date=moment(ref);if(match[3].match(/hora/)||match[3].match(/minuto/)){if(match[3].match(/hora/)){date.add(-num,"hour")}else if(match[3].match(/minuto/)){date.add(-num,"minute")}result.start.imply("day",date.date());result.start.imply("month",date.month()+1);result.start.imply("year",date.year());result.start.assign("hour",date.hour());result.start.assign("minute",date.minute());result.tags["ESTimeAgoFormatParser"]=true;return result}if(match[3].match(/semana/)){date.add(-num,"week");result.start.imply("day",date.date());result.start.imply("month",date.month()+1);result.start.imply("year",date.year());result.start.imply("weekday",date.day());return result}if(match[3].match(/d[i]a/)){date.add(-num,"d")}if(match[3].match(/mes/)){date.add(-num,"month")}if(match[3].match(/ao/)){date.add(-num,"year")}result.start.assign("day",date.date());result.start.assign("month",date.month()+1);result.start.assign("year",date.year());return result}}},3337:function(module,exports,__webpack_require__){var moment=__webpack_require__(4);var Parser=__webpack_require__(1671).Parser;var ParsedResult=__webpack_require__(1658).ParsedResult;var ParsedComponents=__webpack_require__(1658).ParsedComponents;var FIRST_REG_PATTERN=new RegExp("(^|\\s|T)"+"(?:(?:a las?|al?|desde|de)\\s*)?"+"(\\d{1,4}|mediod[i]a|medianoche)"+"(?:"+"(?:\\.|\\:|\\)(\\d{1,2})"+"(?:"+"(?:\\:|\\)(\\d{2})"+")?"+")?"+"(?:\\s*(A\\.M\\.|P\\.M\\.|AM?|PM?))?"+"(?=\\W|$)","i");var SECOND_REG_PATTERN=new RegExp("^\\s*"+"(\\-|\\|\\~|\\|a(?:s*las)?|\\?)\\s*"+"(\\d{1,4})"+"(?:"+"(?:\\.|\\:|\\)(\\d{1,2})"+"(?:"+"(?:\\.|\\:|\\)(\\d{1,2})"+")?"+")?"+"(?:\\s*(A\\.M\\.|P\\.M\\.|AM?|PM?))?"+"(?=\\W|$)","i");var HOUR_GROUP=2;var MINUTE_GROUP=3;var SECOND_GROUP=4;var AM_PM_HOUR_GROUP=5;exports.Parser=function ESTimeExpressionParser(){Parser.apply(this,arguments);this.pattern=function(){return FIRST_REG_PATTERN};this.extract=function(text,ref,match,opt){if(match.index>0&&text[match.index-1].match(/\w/))return null;var refMoment=moment(ref);var result=new ParsedResult;result.ref=ref;result.index=match.index+match[1].length;result.text=match[0].substring(match[1].length);result.tags["ESTimeExpressionParser"]=true;result.start.imply("day",refMoment.date());result.start.imply("month",refMoment.month()+1);result.start.imply("year",refMoment.year());var hour=0;var minute=0;var meridiem=-1;if(match[SECOND_GROUP]!=null){var second=parseInt(match[SECOND_GROUP]);if(second>=60)return null;result.start.assign("second",second)}if(match[HOUR_GROUP].toLowerCase().match(/mediod/)){meridiem=1;hour=12}else if(match[HOUR_GROUP].toLowerCase()=="medianoche"){meridiem=0;hour=0}else{hour=parseInt(match[HOUR_GROUP])}if(match[MINUTE_GROUP]!=null){minute=parseInt(match[MINUTE_GROUP])}else if(hour>100){minute=hour%100;hour=parseInt(hour/100)}if(minute>=60){return null}if(hour>24){return null}if(hour>=12){meridiem=1}if(match[AM_PM_HOUR_GROUP]!=null){if(hour>12)return null;var ampm=match[AM_PM_HOUR_GROUP][0].toLowerCase();if(ampm=="a"){meridiem=0;if(hour==12)hour=0}if(ampm=="p"){meridiem=1;if(hour!=12)hour+=12}}result.start.assign("hour",hour);result.start.assign("minute",minute);if(meridiem>=0){result.start.assign("meridiem",meridiem)}match=SECOND_REG_PATTERN.exec(text.substring(result.index+result.text.length));if(!match){if(result.text.match(/^\d+$/)){return null}return result}if(match[0].match(/^\s*(\+|\-)\s*\d{3,4}$/)){return result}if(result.end==null){result.end=new ParsedComponents(null,result.start.date())}var hour=0;var minute=0;var meridiem=-1;if(match[SECOND_GROUP]!=null){var second=parseInt(match[SECOND_GROUP]);if(second>=60)return null;result.end.assign("second",second)}hour=parseInt(match[2]);if(match[MINUTE_GROUP]!=null){minute=parseInt(match[MINUTE_GROUP]);if(minute>=60)return result}else if(hour>100){minute=hour%100;hour=parseInt(hour/100)}if(minute>=60){return null}if(hour>24){return null}if(hour>=12){meridiem=1}if(match[AM_PM_HOUR_GROUP]!=null){if(hour>12)return null;if(match[AM_PM_HOUR_GROUP][0].toLowerCase()=="a"){meridiem=0;if(hour==12){hour=0;if(!result.end.isCertain("day")){result.end.imply("day",result.end.get("day")+1)}}}if(match[AM_PM_HOUR_GROUP][0].toLowerCase()=="p"){meridiem=1;if(hour!=12)hour+=12}if(!result.start.isCertain("meridiem")){if(meridiem==0){result.start.imply("meridiem",0);if(result.start.get("hour")==12){result.start.assign("hour",0)}}else{result.start.imply("meridiem",1);if(result.start.get("hour")!=12){result.start.assign("hour",result.start.get("hour")+12)}}}}else if(hour>=12){meridiem=1}result.text=result.text+match[0];result.end.assign("hour",hour);result.end.assign("minute",minute);if(meridiem>=0){result.end.assign("meridiem",meridiem)}if(result.end.date().getTime()<result.start.date().getTime()){result.end.imply("day",result.end.get("day")+1)}return result}}},3338:function(module,exports,__webpack_require__){var moment=__webpack_require__(4);var Parser=__webpack_require__(1671).Parser;var ParsedResult=__webpack_require__(1658).ParsedResult;var DAYS_OFFSET={domingo:0,dom:0,lunes:1,lun:1,martes:2,mar:2,miercoles:3,"mircoles":3,mie:3,jueves:4,jue:4,viernes:5,vier:5,sabado:6,"sbado":6,sab:6};var PATTERN=new RegExp("(\\W|^)"+"(?:(?:\\,|\\(|\\)\\s*)?"+"(?:(este|pasado|pr[o]ximo)\\s*)?"+"("+Object.keys(DAYS_OFFSET).join("|")+")"+"(?:\\s*(?:\\,|\\)|\\))?"+"(?:\\s*(este|pasado|pr[o]ximo)\\s*week)?"+"(?=\\W|$)","i");var PREFIX_GROUP=2;var WEEKDAY_GROUP=3;var POSTFIX_GROUP=4;exports.Parser=function ESWeekdayParser(){Parser.apply(this,arguments);this.pattern=function(){return PATTERN};this.extract=function(text,ref,match,opt){var index=match.index+match[1].length;var text=match[0].substr(match[1].length,match[0].length-match[1].length);var result=new ParsedResult({index:index,text:text,ref:ref});var dayOfWeek=match[WEEKDAY_GROUP].toLowerCase();var offset=DAYS_OFFSET[dayOfWeek];if(offset===undefined)return null;var startMoment=moment(ref);var prefix=match[PREFIX_GROUP];var postfix=match[POSTFIX_GROUP];if(prefix||postfix){var norm=prefix||postfix;norm=norm.toLowerCase();if(norm=="pasado")startMoment.day(offset-7);else if(norm=="prximo"||norm=="proximo")startMoment.day(offset+7);else if(norm=="este")startMoment.day(offset)}else{var refOffset=startMoment.day();if(opt.forwardDatesOnly&&refOffset>offset){startMoment.day(offset+7)}else if(!opt.forwardDatesOnly&&Math.abs(offset-7-refOffset)<Math.abs(offset-refOffset)){startMoment.day(offset-7)}else if(!opt.forwardDatesOnly&&Math.abs(offset+7-refOffset)<Math.abs(offset-refOffset)){startMoment.day(offset+7)}else{startMoment.day(offset)}}result.start.assign("weekday",offset);result.start.imply("day",startMoment.date());result.start.imply("month",startMoment.month()+1);result.start.imply("year",startMoment.year());return result}}},3339:function(module,exports,__webpack_require__){var moment=__webpack_require__(4);var Parser=__webpack_require__(1671).Parser;var ParsedResult=__webpack_require__(1658).ParsedResult;var PATTERN=/|||||||/i;exports.Parser=function JPCasualDateParser(){Parser.apply(this,arguments);this.pattern=function(){return PATTERN};this.extract=function(text,ref,match,opt){var index=match.index;var text=match[0];var result=new ParsedResult({index:index,text:text,ref:ref});var refMoment=moment(ref);var startMoment=refMoment.clone();if(text==""||text==""||text==""){result.start.imply("hour",22);result.start.imply("meridiem",1)}else if(text==""){if(refMoment.hour()>4){startMoment.add(1,"day")}}else if(text==""){startMoment.add(-1,"day")}else if(text.match("")){result.start.imply("hour",6);result.start.imply("meridiem",0)}result.start.assign("day",startMoment.date());result.start.assign("month",startMoment.month()+1);result.start.assign("year",startMoment.year());result.tags["JPCasualDateParser"]=true;return result}}},3340:function(module,exports,__webpack_require__){var moment=__webpack_require__(4);var Parser=__webpack_require__(1671).Parser;var ParsedResult=__webpack_require__(1658).ParsedResult;var util=__webpack_require__(3348);var PATTERN=/(?:(|((|)?([0-9-]{2,4})))\s*)?([0-9-]{1,2})\s*([0-9-]{1,2})/i;var YEAR_GROUP=2;var ERA_GROUP=3;var YEAR_NUMBER_GROUP=4;var MONTH_GROUP=5;var DAY_GROUP=6;exports.Parser=function JPStandardParser(){Parser.apply(this,arguments);this.pattern=function(){return PATTERN};this.extract=function(text,ref,match,opt){var startMoment=moment(ref);var result=new ParsedResult({text:match[0],index:match.index,ref:ref});var month=match[MONTH_GROUP];month=util.toHankaku(month);month=parseInt(month);var day=match[DAY_GROUP];day=util.toHankaku(day);day=parseInt(day);startMoment.set("date",day);startMoment.set("month",month-1);result.start.assign("day",startMoment.date());result.start.assign("month",startMoment.month()+1);if(!match[YEAR_GROUP]){startMoment.year(moment(ref).year());var nextYear=startMoment.clone().add(1,"y");var lastYear=startMoment.clone().add(-1,"y");if(Math.abs(nextYear.diff(moment(ref)))<Math.abs(startMoment.diff(moment(ref)))){startMoment=nextYear}else if(Math.abs(lastYear.diff(moment(ref)))<Math.abs(startMoment.diff(moment(ref)))){startMoment=lastYear}result.start.assign("day",startMoment.date());result.start.assign("month",startMoment.month()+1);result.start.imply("year",startMoment.year())}else if(match[YEAR_GROUP].match("")){result.start.assign("year",startMoment.year())}else{var year=match[YEAR_NUMBER_GROUP];year=util.toHankaku(year);year=parseInt(year);if(match[ERA_GROUP]==""){year+=1988}else if(match[ERA_GROUP]==""){year+=1925}result.start.assign("year",year)}result.tags["JPStandardParser"]=true;return result}}},3341:function(module,exports,__webpack_require__){var ParsedComponents=__webpack_require__(1658).ParsedComponents;var Refiner=__webpack_require__(1798).Refiner;var PATTERN=new RegExp("^\\s*(T|at|on|of|,|-)?\\s*$");function isDateOnly(result){return!result.start.isCertain("hour")}function isTimeOnly(result){return!result.start.isCertain("month")&&!result.start.isCertain("weekday")}function isAbleToMerge(text,prevResult,curResult){var textBetween=text.substring(prevResult.index+prevResult.text.length,curResult.index);return textBetween.match(PATTERN)}function mergeResult(text,dateResult,timeResult){var beginDate=dateResult.start;var beginTime=timeResult.start;var beginDateTime=beginDate.clone();beginDateTime.assign("hour",beginTime.get("hour"));beginDateTime.assign("minute",beginTime.get("minute"));beginDateTime.assign("second",beginTime.get("second"));if(beginTime.isCertain("meridiem")){beginDateTime.assign("meridiem",beginTime.get("meridiem"))}else if(beginTime.get("meridiem")!==undefined&&beginDateTime.get("meridiem")===undefined){beginDateTime.imply("meridiem",beginTime.get("meridiem"))}if(beginDateTime.get("meridiem")==1&&beginDateTime.get("hour")<12){beginDateTime.assign("hour",beginDateTime.get("hour")+12)}if(dateResult.end!=null||timeResult.end!=null){var endDate=dateResult.end==null?dateResult.start:dateResult.end;var endTime=timeResult.end==null?timeResult.start:timeResult.end;var endDateTime=endDate.clone();endDateTime.assign("hour",endTime.get("hour"));endDateTime.assign("minute",endTime.get("minute"));endDateTime.assign("second",endTime.get("second"));if(endTime.isCertain("meridiem")){endDateTime.assign("meridiem",endTime.get("meridiem"))}else if(beginTime.get("meridiem")!=null){endDateTime.imply("meridiem",endTime.get("meridiem"))}if(dateResult.end==null&&endDateTime.date().getTime()<beginDateTime.date().getTime()){if(endDateTime.isCertain("day")){endDateTime.assign("day",endDateTime.get("day")+1)}else{endDateTime.imply("day",endDateTime.get("day")+1)}}dateResult.end=endDateTime}dateResult.start=beginDateTime;var startIndex=Math.min(dateResult.index,timeResult.index);var endIndex=Math.max(dateResult.index+dateResult.text.length,timeResult.index+timeResult.text.length);dateResult.index=startIndex;dateResult.text=text.substring(startIndex,endIndex);for(var tag in timeResult.tags){dateResult.tags[tag]=true}dateResult.tags["ENMergeDateAndTimeRefiner"]=true;return dateResult}exports.Refiner=function ENMergeDateTimeRefiner(){Refiner.call(this);this.refine=function(text,results,opt){if(results.length<2)return results;var mergedResult=[];var currResult=null;var prevResult=null;for(var i=1;i<results.length;i++){currResult=results[i];prevResult=results[i-1];if(isDateOnly(prevResult)&&isTimeOnly(currResult)&&isAbleToMerge(text,prevResult,currResult)){prevResult=mergeResult(text,prevResult,currResult);currResult=null;i+=1}else if(isDateOnly(currResult)&&isTimeOnly(prevResult)&&isAbleToMerge(text,prevResult,currResult)){prevResult=mergeResult(text,currResult,prevResult);currResult=null;i+=1}mergedResult.push(prevResult)}if(currResult!=null){mergedResult.push(currResult)}return mergedResult}}},3342:function(module,exports,__webpack_require__){var Refiner=__webpack_require__(1798).Refiner;var TIMEZONE_ABBR_MAP={};var TIMEZONE_NAME_PATTERN=new RegExp("^\\s*\\(?([A-Z]{2,4})\\)?(?=\\W|$)","i");exports.Refiner=function ExtractTimezoneAbbrRefiner(){Refiner.call(this);this.refine=function(text,results,opt){results.forEach(function(result){if(!result.tags["ENTimeExpressionParser"]){return}var match=TIMEZONE_NAME_PATTERN.exec(text.substring(result.index+result.text.length));if(match){var timezoneAbbr=match[1].toUpperCase();if(TIMEZONE_ABBR_MAP[timezoneAbbr]===undefined){return}var timezoneOffset=TIMEZONE_ABBR_MAP[timezoneAbbr];if(!result.start.isCertain("timezoneOffset")){result.start.assign("timezoneOffset",timezoneOffset)}if(result.end!=null&&!result.end.isCertain("timezoneOffset")){result.end.assign("timezoneOffset",timezoneOffset)}result.text+=match[0];result.tags["ExtractTimezoneAbbrRefiner"]=true}});return results}};TIMEZONE_ABBR_MAP={ACDT:630,ACST:570,ADT:-180,AEDT:660,AEST:600,AFT:270,AKDT:-480,AKST:-540,ALMT:360,AMST:-180,AMT:-240,ANAST:720,ANAT:720,AQTT:300,ART:-180,AST:-240,AWDT:540,AWST:480,AZOST:0,AZOT:-60,AZST:300,AZT:240,BNT:480,BOT:-240,BRST:-120,BRT:-180,BST:60,BTT:360,CAST:480,CAT:120,CCT:390,CDT:-300,CEST:120,CET:60,CHADT:825,CHAST:765,CKT:-600,CLST:-180,CLT:-240,COT:-300,CST:-360,CVT:-60,CXT:420,ChST:600,DAVT:420,EASST:-300,EAST:-360,EAT:180,ECT:-300,EDT:-240,EEST:180,EET:120,EGST:0,EGT:-60,EST:-300,ET:-300,FJST:780,FJT:720,FKST:-180,FKT:-240,FNT:-120,GALT:-360,GAMT:-540,GET:240,GFT:-180,GILT:720,GMT:0,GST:240,GYT:-240,HAA:-180,HAC:-300,HADT:-540,HAE:-240,HAP:-420,HAR:-360,HAST:-600,HAT:-90,HAY:-480,HKT:480,HLV:-210,HNA:-240,HNC:-360,HNE:-300,HNP:-480,HNR:-420,HNT:-150,HNY:-540,HOVT:420,ICT:420,IDT:180,IOT:360,IRDT:270,IRKST:540,IRKT:540,IRST:210,IST:60,JST:540,KGT:360,KRAST:480,KRAT:480,KST:540,KUYT:240,LHDT:660,LHST:630,LINT:840,MAGST:720,MAGT:720,MART:-510,MAWT:300,MDT:-360,MESZ:120,MEZ:60,MHT:720,MMT:390,MSD:240,MSK:240,MST:-420,MUT:240,MVT:300,MYT:480,NCT:660,NDT:-90,NFT:690,NOVST:420,NOVT:360,NPT:345,NST:-150,NUT:-660,NZDT:780,NZST:720,OMSST:420,OMST:420,PDT:-420,PET:-300,PETST:720,PETT:720,PGT:600,PHOT:780,PHT:480,PKT:300,PMDT:-120,PMST:-180,PONT:660,PST:-480,PT:-480,PWT:540,PYST:-180,PYT:-240,RET:240,SAMT:240,SAST:120,SBT:660,SCT:240,SGT:480,SRT:-180,SST:-660,TAHT:-600,TFT:300,TJT:300,TKT:780,TLT:540,TMT:300,TVT:720,ULAT:480,UTC:0,UYST:-120,UYT:-180,UZT:300,VET:-210,VLAST:660,VLAT:660,VUT:660,WAST:120,WAT:60,WEST:60,WESZ:60,WET:0,WEZ:0,WFT:720,WGST:-120,WGT:-180,WIB:420,WIT:540,WITA:480,WST:780,WT:0,YAKST:600,YAKT:600,YAPT:600,YEKST:360,YEKT:360}},3343:function(module,exports,__webpack_require__){var Refiner=__webpack_require__(1798).Refiner;var TIMEZONE_OFFSET_PATTERN=new RegExp("^\\s*(GMT|UTC)?(\\+|\\-)(\\d{1,2}):?(\\d{2})","i");var TIMEZONE_OFFSET_SIGN_GROUP=2;var TIMEZONE_OFFSET_HOUR_OFFSET_GROUP=3;var TIMEZONE_OFFSET_MINUTE_OFFSET_GROUP=4;exports.Refiner=function ExtractTimezoneOffsetRefiner(){Refiner.call(this);this.refine=function(text,results,opt){results.forEach(function(result){if(result.start.isCertain("timezoneOffset")){return}var match=TIMEZONE_OFFSET_PATTERN.exec(text.substring(result.index+result.text.length));if(!match){return}var hourOffset=parseInt(match[TIMEZONE_OFFSET_HOUR_OFFSET_GROUP]);var minuteOffset=parseInt(match[TIMEZONE_OFFSET_MINUTE_OFFSET_GROUP]);var timezoneOffset=hourOffset*60+minuteOffset;if(match[TIMEZONE_OFFSET_SIGN_GROUP]==="-"){timezoneOffset=-timezoneOffset}if(result.end!=null){result.end.assign("timezoneOffset",timezoneOffset)}result.start.assign("timezoneOffset",timezoneOffset);result.text+=match[0];result.tags["ExtractTimezoneOffsetRefiner"]=true});return results}}},3344:function(module,exports,__webpack_require__){var ENMergeDateRangeRefiner=__webpack_require__(2377).Refiner;exports.Refiner=function JPMergeDateRangeRefiner(){ENMergeDateRangeRefiner.call(this);this.pattern=function(){return/^\s*(|)\s*$/i}}},3345:function(module,exports,__webpack_require__){var Refiner=__webpack_require__(1798).Refiner;exports.Refiner=function OverlapRemovalRefiner(){Refiner.call(this);this.refine=function(text,results,opt){if(results.length<2)return results;var filteredResults=[];var prevResult=results[0];for(var i=1;i<results.length;i++){var result=results[i];if(result.index<prevResult.index+prevResult.text.length){if(result.text.length>prevResult.text.length){prevResult=result}}else{filteredResults.push(prevResult);prevResult=result}}if(prevResult!=null){filteredResults.push(prevResult)}return filteredResults}}},3346:function(module,exports,__webpack_require__){var Filter=__webpack_require__(1798).Filter;exports.Refiner=function UnlikelyFormatFilter(){Filter.call(this);this.isValid=function(text,result,opt){if(result.text.replace(" ","").match(/^\d*(\.\d*)?$/)){return false}return true}}},3347:function(module,exports){exports.WEEKDAY_OFFSET={domingo:0,dom:0,lunes:1,lun:1,martes:2,mar:2,"mircoles":3,miercoles:3,mie:3,jueves:4,jue:4,viernes:5,vie:5,"sbado":6,sabado:6,sab:6};exports.MONTH_OFFSET={enero:1,ene:1,"ene.":1,febrero:2,feb:2,"feb.":2,marzo:3,mar:3,"mar.":3,abril:4,abr:4,"abr.":4,mayo:5,may:5,"may.":5,junio:6,jun:6,"jun.":6,julio:7,jul:7,"jul.":7,agosto:8,ago:8,"ago.":8,septiembre:9,sep:9,sept:9,"sep.":9,"sept.":9,octubre:10,oct:10,"oct.":10,noviembre:11,nov:11,"nov.":11,diciembre:12,dic:12,"dic.":12}},3348:function(module,exports){exports.toHankaku=function(String,fromCharCode){function toHankaku(string){return String(string).replace(/\u2019/g,"'").replace(/\u201D/g,'"').replace(/\u3000/g," ").replace(/\uFFE5/g,"").replace(/[\uFF01\uFF03-\uFF06\uFF08\uFF09\uFF0C-\uFF19\uFF1C-\uFF1F\uFF21-\uFF3B\uFF3D\uFF3F\uFF41-\uFF5B\uFF5D\uFF5E]/g,alphaNum)}function alphaNum(token){return fromCharCode(token.charCodeAt(0)-65248)}return toHankaku}(String,String.fromCharCode);exports.toZenkaku=function(String,fromCharCode){function toZenkaku(string){return String(string).replace(/\u0020/g,"").replace(/\u0022/g,"").replace(/\u0027/g,"").replace(/\u00A5/g,"").replace(/[!#-&(),-9\u003C-?A-[\u005D_a-{}~]/g,alphaNum)}function alphaNum(token){return fromCharCode(token.charCodeAt(0)+65248)}return toZenkaku}(String,String.fromCharCode)},3352:function(module,exports,__webpack_require__){__webpack_require__(3359);module.exports=__webpack_require__(31).Number.isInteger},3359:function(module,exports,__webpack_require__){var $export=__webpack_require__(55);$export($export.S,"Number",{isInteger:__webpack_require__(840)})},3442:function(module,exports,__webpack_require__){var fbemitter={EventEmitter:__webpack_require__(3443),EmitterSubscription:__webpack_require__(2400)};module.exports=fbemitter},3443:function(module,exports,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var EmitterSubscription=__webpack_require__(2400);var EventSubscriptionVendor=__webpack_require__(3445);var emptyFunction=__webpack_require__(59);var invariant=__webpack_require__(14);var BaseEventEmitter=function(){function BaseEventEmitter(){_classCallCheck(this,BaseEventEmitter);this._subscriber=new EventSubscriptionVendor;this._currentSubscription=null}BaseEventEmitter.prototype.addListener=function addListener(eventType,listener,context){return this._subscriber.addSubscription(eventType,new EmitterSubscription(this._subscriber,listener,context))};BaseEventEmitter.prototype.once=function once(eventType,listener,context){var emitter=this;return this.addListener(eventType,function(){emitter.removeCurrentListener();listener.apply(context,arguments)})};BaseEventEmitter.prototype.removeAllListeners=function removeAllListeners(eventType){this._subscriber.removeAllSubscriptions(eventType)};BaseEventEmitter.prototype.removeCurrentListener=function removeCurrentListener(){!!!this._currentSubscription?false?invariant(false,"Not in an emitting cycle; there is no current subscription"):invariant(false):undefined;this._subscriber.removeSubscription(this._currentSubscription)};BaseEventEmitter.prototype.listeners=function listeners(eventType){var subscriptions=this._subscriber.getSubscriptionsForType(eventType);return subscriptions?subscriptions.filter(emptyFunction.thatReturnsTrue).map(function(subscription){return subscription.listener}):[]};BaseEventEmitter.prototype.emit=function emit(eventType){var subscriptions=this._subscriber.getSubscriptionsForType(eventType);if(subscriptions){var keys=Object.keys(subscriptions);for(var ii=0;ii<keys.length;ii++){var key=keys[ii];var subscription=subscriptions[key];if(subscription){this._currentSubscription=subscription;this.__emitToSubscription.apply(this,[subscription].concat(Array.prototype.slice.call(arguments)))}}this._currentSubscription=null}};BaseEventEmitter.prototype.__emitToSubscription=function __emitToSubscription(subscription,eventType){var args=Array.prototype.slice.call(arguments,2);subscription.listener.apply(subscription.context,args)};return BaseEventEmitter}();module.exports=BaseEventEmitter},3444:function(module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var EventSubscription=function(){function EventSubscription(subscriber){_classCallCheck(this,EventSubscription);this.subscriber=subscriber}EventSubscription.prototype.remove=function remove(){if(this.subscriber){this.subscriber.removeSubscription(this);this.subscriber=null}};return EventSubscription}();module.exports=EventSubscription},3445:function(module,exports,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var invariant=__webpack_require__(14);var EventSubscriptionVendor=function(){function EventSubscriptionVendor(){_classCallCheck(this,EventSubscriptionVendor);this._subscriptionsForType={};this._currentSubscription=null}EventSubscriptionVendor.prototype.addSubscription=function addSubscription(eventType,subscription){!(subscription.subscriber===this)?false?invariant(false,"The subscriber of the subscription is incorrectly set."):invariant(false):undefined;if(!this._subscriptionsForType[eventType]){this._subscriptionsForType[eventType]=[]}var key=this._subscriptionsForType[eventType].length;this._subscriptionsForType[eventType].push(subscription);subscription.eventType=eventType;subscription.key=key;return subscription};EventSubscriptionVendor.prototype.removeAllSubscriptions=function removeAllSubscriptions(eventType){if(eventType===undefined){this._subscriptionsForType={}}else{delete this._subscriptionsForType[eventType]}};EventSubscriptionVendor.prototype.removeSubscription=function removeSubscription(subscription){var eventType=subscription.eventType;var key=subscription.key;var subscriptionsForType=this._subscriptionsForType[eventType];if(subscriptionsForType){delete subscriptionsForType[key]}};EventSubscriptionVendor.prototype.getSubscriptionsForType=function getSubscriptionsForType(eventType){return this._subscriptionsForType[eventType]};return EventSubscriptionVendor}();module.exports=EventSubscriptionVendor},3458:function(module,exports,__webpack_require__){(function(global){"use strict";(function(global){var b=/^(b|B)$/;var symbol={bits:["b","Kb","Mb","Gb","Tb","Pb","Eb","Zb","Yb"],bytes:["B","KB","MB","GB","TB","PB","EB","ZB","YB"]};function filesize(arg){var descriptor=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];var result=[],val=0,e=undefined,base=undefined,bits=undefined,ceil=undefined,neg=undefined,num=undefined,output=undefined,round=undefined,unix=undefined,spacer=undefined,symbols=undefined;if(isNaN(arg)){throw new Error("Invalid arguments")}bits=descriptor.bits===true;unix=descriptor.unix===true;base=descriptor.base||2;round=descriptor.round!==undefined?descriptor.round:unix?1:2;spacer=descriptor.spacer!==undefined?descriptor.spacer:unix?"":" ";symbols=descriptor.symbols||descriptor.suffixes||{};output=descriptor.output||"string";e=descriptor.exponent!==undefined?descriptor.exponent:-1;num=Number(arg);neg=num<0;ceil=base>2?1e3:1024;if(neg){num=-num}if(num===0){result[0]=0;result[1]=unix?"":!bits?"B":"b"}else{if(e===-1||isNaN(e)){e=Math.floor(Math.log(num)/Math.log(ceil));if(e<0){e=0}}if(e>8){e=8}val=base===2?num/Math.pow(2,e*10):num/Math.pow(1e3,e);if(bits){val=val*8;if(val>ceil&&e<8){val=val/ceil;e++}}result[0]=Number(val.toFixed(e>0?round:0));result[1]=base===10&&e===1?bits?"kb":"kB":symbol[bits?"bits":"bytes"][e];if(unix){result[1]=result[1].charAt(0);if(b.test(result[1])){result[0]=Math.floor(result[0]);result[1]=""}}}if(neg){result[0]=-result[0]}result[1]=symbols[result[1]]||result[1];if(output==="array"){return result}if(output==="exponent"){return e}if(output==="object"){return{value:result[0],suffix:result[1],symbol:result[1]}}return result.join(spacer)}if(true){module.exports=filesize}else if(typeof define==="function"&&define.amd){define(function(){return filesize})}else{global.filesize=filesize}})(typeof window!=="undefined"?window:global)}).call(exports,function(){return this}())},3460:function(module,exports,__webpack_require__){"use strict";var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");
}}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var FluxStoreGroup=__webpack_require__(2406);var invariant=__webpack_require__(749);var shallowEqual=__webpack_require__(3464);var DEFAULT_OPTIONS={pure:true,withProps:false};function create(Base,options){enforceInterface(Base);var realOptions=_extends({},DEFAULT_OPTIONS,options||{});var FluxContainerClass=function(_Base){_inherits(FluxContainerClass,_Base);function FluxContainerClass(props){_classCallCheck(this,FluxContainerClass);_Base.call(this,props);this.state=realOptions.withProps?Base.calculateState(null,props):Base.calculateState(null,undefined)}FluxContainerClass.prototype.componentDidMount=function componentDidMount(){var _this=this;if(_Base.prototype.componentDidMount){_Base.prototype.componentDidMount.call(this)}var stores=Base.getStores();var changed=false;var setChanged=function(){changed=true};this._fluxContainerSubscriptions=stores.map(function(store){return store.addListener(setChanged)});var callback=function(){if(changed){_this.setState(function(prevState){return realOptions.withProps?Base.calculateState(prevState,_this.props):Base.calculateState(prevState,undefined)})}changed=false};this._fluxContainerStoreGroup=new FluxStoreGroup(stores,callback)};FluxContainerClass.prototype.componentWillReceiveProps=function componentWillReceiveProps(nextProps,nextContext){if(_Base.prototype.componentWillReceiveProps){_Base.prototype.componentWillReceiveProps.call(this,nextProps,nextContext)}if(!realOptions.withProps){return}if(realOptions.pure&&shallowEqual(this.props,nextProps)){return}this.setState(function(prevState){return Base.calculateState(prevState,nextProps)})};FluxContainerClass.prototype.componentWillUnmount=function componentWillUnmount(){if(_Base.prototype.componentWillUnmount){_Base.prototype.componentWillUnmount.call(this)}this._fluxContainerStoreGroup.release();for(var _iterator=this._fluxContainerSubscriptions,_isArray=Array.isArray(_iterator),_i=0,_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref;if(_isArray){if(_i>=_iterator.length)break;_ref=_iterator[_i++]}else{_i=_iterator.next();if(_i.done)break;_ref=_i.value}var subscription=_ref;subscription.remove()}this._fluxContainerSubscriptions=[]};return FluxContainerClass}(Base);var container=realOptions.pure?createPureContainer(FluxContainerClass):FluxContainerClass;var componentName=Base.displayName||Base.name;container.displayName="FluxContainer("+componentName+")";return container}function createPureContainer(FluxContainerBase){var PureFluxContainerClass=function(_FluxContainerBase){_inherits(PureFluxContainerClass,_FluxContainerBase);function PureFluxContainerClass(){_classCallCheck(this,PureFluxContainerClass);_FluxContainerBase.apply(this,arguments)}PureFluxContainerClass.prototype.shouldComponentUpdate=function shouldComponentUpdate(nextProps,nextState){return!shallowEqual(this.props,nextProps)||!shallowEqual(this.state,nextState)};return PureFluxContainerClass}(FluxContainerBase);return PureFluxContainerClass}function enforceInterface(o){!o.getStores?false?invariant(false,"Components that use FluxContainer must implement `static getStores()`"):invariant(false):undefined;!o.calculateState?false?invariant(false,"Components that use FluxContainer must implement `static calculateState()`"):invariant(false):undefined}module.exports={create:create}},3461:function(module,exports,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var FluxReduceStore=__webpack_require__(2404);var Immutable=__webpack_require__(113);var invariant=__webpack_require__(749);var FluxMapStore=function(_FluxReduceStore){_inherits(FluxMapStore,_FluxReduceStore);function FluxMapStore(){_classCallCheck(this,FluxMapStore);_FluxReduceStore.apply(this,arguments)}FluxMapStore.prototype.getInitialState=function getInitialState(){return Immutable.Map()};FluxMapStore.prototype.at=function at(key){!this.has(key)?false?invariant(false,"Expected store to have key %s",key):invariant(false):undefined;return this.get(key)};FluxMapStore.prototype.has=function has(key){return this.getState().has(key)};FluxMapStore.prototype.get=function get(key){return this.getState().get(key)};FluxMapStore.prototype.getAll=function getAll(keys,prev){var _this=this;var newKeys=Immutable.Set(keys);var start=prev||Immutable.Map();return start.withMutations(function(map){for(var _iterator=start,_isArray=Array.isArray(_iterator),_i=0,_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref;if(_isArray){if(_i>=_iterator.length)break;_ref=_iterator[_i++]}else{_i=_iterator.next();if(_i.done)break;_ref=_i.value}var entry=_ref;var oldKey=entry[0];if(!newKeys.has(oldKey)||!_this.has(oldKey)){map["delete"](oldKey)}}for(var _iterator2=newKeys,_isArray2=Array.isArray(_iterator2),_i2=0,_iterator2=_isArray2?_iterator2:_iterator2[Symbol.iterator]();;){var _ref2;if(_isArray2){if(_i2>=_iterator2.length)break;_ref2=_iterator2[_i2++]}else{_i2=_iterator2.next();if(_i2.done)break;_ref2=_i2.value}var key=_ref2;if(_this.has(key)){map.set(key,_this.at(key))}}})};return FluxMapStore}(FluxReduceStore);module.exports=FluxMapStore},3462:function(module,exports,__webpack_require__){"use strict";var FluxStoreGroup=__webpack_require__(2406);var invariant=__webpack_require__(749);function FluxMixinLegacy(stores){return{getInitialState:function(){enforceInterface(this);return this.constructor.calculateState(null)},componentDidMount:function(){var _this=this;var changed=false;var setChanged=function(){changed=true};this._fluxMixinSubscriptions=stores.map(function(store){return store.addListener(setChanged)});var callback=function(){if(changed){_this.setState(function(prevState){return _this.constructor.calculateState(_this.state)})}changed=false};this._fluxMixinStoreGroup=new FluxStoreGroup(stores,callback)},componentWillUnmount:function(){this._fluxMixinStoreGroup.release();for(var _iterator=this._fluxMixinSubscriptions,_isArray=Array.isArray(_iterator),_i=0,_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref;if(_isArray){if(_i>=_iterator.length)break;_ref=_iterator[_i++]}else{_i=_iterator.next();if(_i.done)break;_ref=_i.value}var subscription=_ref;subscription.remove()}this._fluxMixinSubscriptions=[]}}}function enforceInterface(o){!o.constructor.calculateState?false?invariant(false,"Components that use FluxMixinLegacy must implement "+"`calculateState()` on the statics object"):invariant(false):undefined}module.exports=FluxMixinLegacy},3463:function(module,exports,__webpack_require__){"use strict";var invariant=__webpack_require__(749);function abstractMethod(className,methodName){true?false?invariant(false,"Subclasses of %s must override %s() with their own implementation.",className,methodName):invariant(false):undefined}module.exports=abstractMethod},3464:function(module,exports){"use strict";var hasOwnProperty=Object.prototype.hasOwnProperty;function shallowEqual(objA,objB){if(objA===objB){return true}if(typeof objA!=="object"||objA===null||typeof objB!=="object"||objB===null){return false}var keysA=Object.keys(objA);var keysB=Object.keys(objB);if(keysA.length!==keysB.length){return false}var bHasOwnProperty=hasOwnProperty.bind(objB);for(var i=0;i<keysA.length;i++){if(!bHasOwnProperty(keysA[i])||objA[keysA[i]]!==objB[keysA[i]]){return false}}return true}module.exports=shallowEqual},3470:function(module,exports){(function(){tinymce.PluginManager.add("colorpicker",function(editor){function colorPickerCallback(callback,value){function setColor(value){var color=new tinymce.util.Color(value),rgb=color.toRgb();win.fromJSON({r:rgb.r,g:rgb.g,b:rgb.b,hex:color.toHex().substr(1)});showPreview(color.toHex())}function showPreview(hexColor){win.find("#preview")[0].getEl().style.background=hexColor}var win=editor.windowManager.open({title:"Color",items:{type:"container",layout:"flex",direction:"row",align:"stretch",padding:5,spacing:10,items:[{type:"colorpicker",value:value,onchange:function(){var rgb=this.rgb();if(win){win.find("#r").value(rgb.r);win.find("#g").value(rgb.g);win.find("#b").value(rgb.b);win.find("#hex").value(this.value().substr(1));showPreview(this.value())}}},{type:"form",padding:0,labelGap:5,defaults:{type:"textbox",size:7,value:"0",flex:1,spellcheck:false,onchange:function(){var colorPickerCtrl=win.find("colorpicker")[0];var name,value;name=this.name();value=this.value();if(name=="hex"){value="#"+value;setColor(value);colorPickerCtrl.value(value);return}value={r:win.find("#r").value(),g:win.find("#g").value(),b:win.find("#b").value()};colorPickerCtrl.value(value);setColor(value)}},items:[{name:"r",label:"R",autofocus:1},{name:"g",label:"G"},{name:"b",label:"B"},{name:"hex",label:"#",value:"000000"},{name:"preview",type:"container",border:1}]}]},onSubmit:function(){callback("#"+this.toJSON().hex)}});setColor(value)}if(!editor.settings.color_picker_callback){editor.settings.color_picker_callback=colorPickerCallback}})}).call(window)},3471:function(module,exports){(function(){tinymce.PluginManager.add("hr",function(editor){editor.addCommand("InsertHorizontalRule",function(){editor.execCommand("mceInsertContent",false,"<hr />")});editor.addButton("hr",{icon:"hr",tooltip:"Horizontal line",cmd:"InsertHorizontalRule"});editor.addMenuItem("hr",{icon:"hr",text:"Horizontal line",cmd:"InsertHorizontalRule",context:"insert"})})}).call(window)},3472:function(module,exports){(function(){tinymce.PluginManager.add("lists",function(editor){var self=this;function isChildOfBody(elm){return editor.$.contains(editor.getBody(),elm)}function isBr(node){return node&&node.nodeName=="BR"}function isListNode(node){return node&&/^(OL|UL|DL)$/.test(node.nodeName)&&isChildOfBody(node)}function isFirstChild(node){return node.parentNode.firstChild==node}function isLastChild(node){return node.parentNode.lastChild==node}function isTextBlock(node){return node&&!!editor.schema.getTextBlockElements()[node.nodeName]}function isEditorBody(elm){return elm===editor.getBody()}editor.on("init",function(){var dom=editor.dom,selection=editor.selection;function isEmpty(elm,keepBookmarks){var empty=dom.isEmpty(elm);if(keepBookmarks&&dom.select("span[data-mce-type=bookmark]").length>0){return false}return empty}function createBookmark(rng){var bookmark={};function setupEndPoint(start){var offsetNode,container,offset;container=rng[start?"startContainer":"endContainer"];offset=rng[start?"startOffset":"endOffset"];if(container.nodeType==1){offsetNode=dom.create("span",{"data-mce-type":"bookmark"});if(container.hasChildNodes()){offset=Math.min(offset,container.childNodes.length-1);if(start){container.insertBefore(offsetNode,container.childNodes[offset])}else{dom.insertAfter(offsetNode,container.childNodes[offset])}}else{container.appendChild(offsetNode)}container=offsetNode;offset=0}bookmark[start?"startContainer":"endContainer"]=container;bookmark[start?"startOffset":"endOffset"]=offset}setupEndPoint(true);if(!rng.collapsed){setupEndPoint()}return bookmark}function moveToBookmark(bookmark){function restoreEndPoint(start){var container,offset,node;function nodeIndex(container){var node=container.parentNode.firstChild,idx=0;while(node){if(node==container){return idx}if(node.nodeType!=1||node.getAttribute("data-mce-type")!="bookmark"){idx++}node=node.nextSibling}return-1}container=node=bookmark[start?"startContainer":"endContainer"];offset=bookmark[start?"startOffset":"endOffset"];if(!container){return}if(container.nodeType==1){offset=nodeIndex(container);container=container.parentNode;dom.remove(node)}bookmark[start?"startContainer":"endContainer"]=container;bookmark[start?"startOffset":"endOffset"]=offset}restoreEndPoint(true);restoreEndPoint();var rng=dom.createRng();rng.setStart(bookmark.startContainer,bookmark.startOffset);if(bookmark.endContainer){rng.setEnd(bookmark.endContainer,bookmark.endOffset)}selection.setRng(rng)}function createNewTextBlock(contentNode,blockName){var node,textBlock,fragment=dom.createFragment(),hasContentNode;var blockElements=editor.schema.getBlockElements();if(editor.settings.forced_root_block){blockName=blockName||editor.settings.forced_root_block}if(blockName){textBlock=dom.create(blockName);if(textBlock.tagName===editor.settings.forced_root_block){dom.setAttribs(textBlock,editor.settings.forced_root_block_attrs)}fragment.appendChild(textBlock)}if(contentNode){while(node=contentNode.firstChild){var nodeName=node.nodeName;if(!hasContentNode&&(nodeName!="SPAN"||node.getAttribute("data-mce-type")!="bookmark")){hasContentNode=true}if(blockElements[nodeName]){fragment.appendChild(node);textBlock=null}else{if(blockName){if(!textBlock){textBlock=dom.create(blockName);fragment.appendChild(textBlock)}textBlock.appendChild(node)}else{fragment.appendChild(node)}}}}if(!editor.settings.forced_root_block){fragment.appendChild(dom.create("br"))}else{if(!hasContentNode&&(!tinymce.Env.ie||tinymce.Env.ie>10)){textBlock.appendChild(dom.create("br",{"data-mce-bogus":"1"}))}}return fragment}function getSelectedListItems(){return tinymce.grep(selection.getSelectedBlocks(),function(block){return/^(LI|DT|DD)$/.test(block.nodeName)})}function splitList(ul,li,newBlock){var tmpRng,fragment,bookmarks,node;function removeAndKeepBookmarks(targetNode){tinymce.each(bookmarks,function(node){targetNode.parentNode.insertBefore(node,li.parentNode)});dom.remove(targetNode)}bookmarks=dom.select('span[data-mce-type="bookmark"]',ul);newBlock=newBlock||createNewTextBlock(li);tmpRng=dom.createRng();tmpRng.setStartAfter(li);tmpRng.setEndAfter(ul);fragment=tmpRng.extractContents();for(node=fragment.firstChild;node;node=node.firstChild){if(node.nodeName=="LI"&&dom.isEmpty(node)){dom.remove(node);break}}if(!dom.isEmpty(fragment)){dom.insertAfter(fragment,ul)}dom.insertAfter(newBlock,ul);if(isEmpty(li.parentNode)){removeAndKeepBookmarks(li.parentNode)}dom.remove(li);if(isEmpty(ul)){dom.remove(ul)}}function mergeWithAdjacentLists(listBlock){var sibling,node;sibling=listBlock.nextSibling;if(sibling&&isListNode(sibling)&&sibling.nodeName==listBlock.nodeName){while(node=sibling.firstChild){listBlock.appendChild(node)}dom.remove(sibling)}sibling=listBlock.previousSibling;if(sibling&&isListNode(sibling)&&sibling.nodeName==listBlock.nodeName){while(node=sibling.firstChild){listBlock.insertBefore(node,listBlock.firstChild)}dom.remove(sibling)}}function normalizeList(element){tinymce.each(tinymce.grep(dom.select("ol,ul",element)),function(ul){var sibling,parentNode=ul.parentNode;if(parentNode.nodeName=="LI"&&parentNode.firstChild==ul){sibling=parentNode.previousSibling;if(sibling&&sibling.nodeName=="LI"){sibling.appendChild(ul);if(isEmpty(parentNode)){dom.remove(parentNode)}}}if(isListNode(parentNode)){sibling=parentNode.previousSibling;if(sibling&&sibling.nodeName=="LI"){sibling.appendChild(ul)}}})}function outdent(li){var ul=li.parentNode,ulParent=ul.parentNode,newBlock;function removeEmptyLi(li){if(isEmpty(li)){dom.remove(li)}}if(isEditorBody(ul)){return true}if(li.nodeName=="DD"){dom.rename(li,"DT");return true}if(isFirstChild(li)&&isLastChild(li)){if(ulParent.nodeName=="LI"){dom.insertAfter(li,ulParent);removeEmptyLi(ulParent);dom.remove(ul)}else if(isListNode(ulParent)){dom.remove(ul,true)}else{ulParent.insertBefore(createNewTextBlock(li),ul);dom.remove(ul)}return true}else if(isFirstChild(li)){if(ulParent.nodeName=="LI"){dom.insertAfter(li,ulParent);li.appendChild(ul);removeEmptyLi(ulParent)}else if(isListNode(ulParent)){ulParent.insertBefore(li,ul)}else{ulParent.insertBefore(createNewTextBlock(li),ul);dom.remove(li)}return true}else if(isLastChild(li)){if(ulParent.nodeName=="LI"){dom.insertAfter(li,ulParent)}else if(isListNode(ulParent)){dom.insertAfter(li,ul)}else{dom.insertAfter(createNewTextBlock(li),ul);dom.remove(li)}return true}if(ulParent.nodeName=="LI"){ul=ulParent;newBlock=createNewTextBlock(li,"LI")}else if(isListNode(ulParent)){newBlock=createNewTextBlock(li,"LI")}else{newBlock=createNewTextBlock(li)}splitList(ul,li,newBlock);normalizeList(ul.parentNode);return true}function indent(li){var sibling,newList;function mergeLists(from,to){var node;if(isListNode(from)){while(node=li.lastChild.firstChild){to.appendChild(node)}dom.remove(from)}}if(li.nodeName=="DT"){dom.rename(li,"DD");return true}sibling=li.previousSibling;if(sibling&&isListNode(sibling)){sibling.appendChild(li);return true}if(sibling&&sibling.nodeName=="LI"&&isListNode(sibling.lastChild)){sibling.lastChild.appendChild(li);mergeLists(li.lastChild,sibling.lastChild);return true}sibling=li.nextSibling;if(sibling&&isListNode(sibling)){sibling.insertBefore(li,sibling.firstChild);return true}sibling=li.previousSibling;if(sibling&&sibling.nodeName=="LI"){newList=dom.create(li.parentNode.nodeName);sibling.appendChild(newList);newList.appendChild(li);mergeLists(li.lastChild,newList);return true}return false}function indentSelection(){var listElements=getSelectedListItems();if(listElements.length){var bookmark=createBookmark(selection.getRng(true));for(var i=0;i<listElements.length;i++){if(!indent(listElements[i])&&i===0){break}}moveToBookmark(bookmark);editor.nodeChanged();return true}}function outdentSelection(){var listElements=getSelectedListItems();if(listElements.length){var bookmark=createBookmark(selection.getRng(true));var i,y,root=editor.getBody();i=listElements.length;while(i--){var node=listElements[i].parentNode;while(node&&node!=root){y=listElements.length;while(y--){if(listElements[y]===node){listElements.splice(i,1);break}}node=node.parentNode}}for(i=0;i<listElements.length;i++){if(!outdent(listElements[i])&&i===0){break}}moveToBookmark(bookmark);editor.nodeChanged();return true}}function applyList(listName){var rng=selection.getRng(true),bookmark,listItemName="LI";if(dom.getContentEditable(selection.getNode())==="false"){return}listName=listName.toUpperCase();if(listName=="DL"){listItemName="DT"}function getSelectedTextBlocks(){var textBlocks=[],root=editor.getBody();function getEndPointNode(start){var container,offset;container=rng[start?"startContainer":"endContainer"];offset=rng[start?"startOffset":"endOffset"];if(container.nodeType==1){container=container.childNodes[Math.min(offset,container.childNodes.length-1)]||container}while(container.parentNode!=root){if(isTextBlock(container)){return container}if(/^(TD|TH)$/.test(container.parentNode.nodeName)){return container}container=container.parentNode}return container}var startNode=getEndPointNode(true);var endNode=getEndPointNode();var block,siblings=[];for(var node=startNode;node;node=node.nextSibling){siblings.push(node);if(node==endNode){break}}tinymce.each(siblings,function(node){if(isTextBlock(node)){textBlocks.push(node);block=null;return}if(dom.isBlock(node)||isBr(node)){if(isBr(node)){dom.remove(node)}block=null;return}var nextSibling=node.nextSibling;if(tinymce.dom.BookmarkManager.isBookmarkNode(node)){if(isTextBlock(nextSibling)||!nextSibling&&node.parentNode==root){block=null;return}}if(!block){block=dom.create("p");node.parentNode.insertBefore(block,node);textBlocks.push(block)}block.appendChild(node)});return textBlocks}bookmark=createBookmark(rng);tinymce.each(getSelectedTextBlocks(),function(block){var listBlock,sibling;sibling=block.previousSibling;if(sibling&&isListNode(sibling)&&sibling.nodeName==listName){listBlock=sibling;block=dom.rename(block,listItemName);sibling.appendChild(block)}else{listBlock=dom.create(listName);block.parentNode.insertBefore(listBlock,block);listBlock.appendChild(block);block=dom.rename(block,listItemName)}mergeWithAdjacentLists(listBlock)});moveToBookmark(bookmark)}function removeList(){var bookmark=createBookmark(selection.getRng(true)),root=editor.getBody();tinymce.each(getSelectedListItems(),function(li){var node,rootList;if(isEditorBody(li.parentNode)){return}if(isEmpty(li)){outdent(li);return}for(node=li;node&&node!=root;node=node.parentNode){if(isListNode(node)){rootList=node}}splitList(rootList,li)});moveToBookmark(bookmark)}function toggleList(listName){var parentList=dom.getParent(selection.getStart(),"OL,UL,DL");if(isEditorBody(parentList)){return}if(parentList){if(parentList.nodeName==listName){removeList(listName)}else{var bookmark=createBookmark(selection.getRng(true));mergeWithAdjacentLists(dom.rename(parentList,listName));moveToBookmark(bookmark)}}else{applyList(listName)}}function queryListCommandState(listName){return function(){var parentList=dom.getParent(editor.selection.getStart(),"UL,OL,DL");return parentList&&parentList.nodeName==listName}}function isBogusBr(node){if(!isBr(node)){return false}if(dom.isBlock(node.nextSibling)&&!isBr(node.previousSibling)){return true}return false}self.backspaceDelete=function(isForward){function findNextCaretContainer(rng,isForward){var node=rng.startContainer,offset=rng.startOffset;var nonEmptyBlocks,walker;if(node.nodeType==3&&(isForward?offset<node.data.length:offset>0)){return node}nonEmptyBlocks=editor.schema.getNonEmptyElements();if(node.nodeType==1){node=tinymce.dom.RangeUtils.getNode(node,offset)}walker=new tinymce.dom.TreeWalker(node,editor.getBody());if(isForward){if(isBogusBr(node)){walker.next()}}while(node=walker[isForward?"next":"prev2"]()){if(node.nodeName=="LI"&&!node.hasChildNodes()){return node}if(nonEmptyBlocks[node.nodeName]){return node}if(node.nodeType==3&&node.data.length>0){return node}}}function mergeLiElements(fromElm,toElm){var node,listNode,ul=fromElm.parentNode;if(!isChildOfBody(fromElm)||!isChildOfBody(toElm)){return}if(isListNode(toElm.lastChild)){listNode=toElm.lastChild}if(ul==toElm.lastChild){if(isBr(ul.previousSibling)){dom.remove(ul.previousSibling)}}node=toElm.lastChild;if(node&&isBr(node)&&fromElm.hasChildNodes()){dom.remove(node)}if(isEmpty(toElm,true)){dom.$(toElm).empty()}if(!isEmpty(fromElm,true)){while(node=fromElm.firstChild){toElm.appendChild(node)}}if(listNode){toElm.appendChild(listNode)}dom.remove(fromElm);if(isEmpty(ul)&&!isEditorBody(ul)){dom.remove(ul)}}if(selection.isCollapsed()){var li=dom.getParent(selection.getStart(),"LI"),ul,rng,otherLi;if(li){ul=li.parentNode;if(isEditorBody(ul)&&dom.isEmpty(ul)){return true}rng=selection.getRng(true);otherLi=dom.getParent(findNextCaretContainer(rng,isForward),"LI");if(otherLi&&otherLi!=li){var bookmark=createBookmark(rng);if(isForward){mergeLiElements(otherLi,li)}else{mergeLiElements(li,otherLi)}moveToBookmark(bookmark);return true}else if(!otherLi){if(!isForward&&removeList(ul.nodeName)){return true}}}}};editor.on("BeforeExecCommand",function(e){var cmd=e.command.toLowerCase(),isHandled;if(cmd=="indent"){if(indentSelection()){isHandled=true}}else if(cmd=="outdent"){if(outdentSelection()){isHandled=true}}if(isHandled){editor.fire("ExecCommand",{command:e.command});e.preventDefault();return true}});editor.addCommand("InsertUnorderedList",function(){toggleList("UL")});editor.addCommand("InsertOrderedList",function(){toggleList("OL")});editor.addCommand("InsertDefinitionList",function(){toggleList("DL")});editor.addQueryStateHandler("InsertUnorderedList",queryListCommandState("UL"));editor.addQueryStateHandler("InsertOrderedList",queryListCommandState("OL"));editor.addQueryStateHandler("InsertDefinitionList",queryListCommandState("DL"));editor.on("keydown",function(e){if(e.keyCode!=9||tinymce.util.VK.metaKeyPressed(e)){return}if(editor.dom.getParent(editor.selection.getStart(),"LI,DT,DD")){e.preventDefault();if(e.shiftKey){outdentSelection()}else{indentSelection()}}})});editor.addButton("indent",{icon:"indent",title:"Increase indent",cmd:"Indent",onPostRender:function(){var ctrl=this;editor.on("nodechange",function(){var blocks=editor.selection.getSelectedBlocks();var disable=false;for(var i=0,l=blocks.length;!disable&&i<l;i++){var tag=blocks[i].nodeName;disable=tag=="LI"&&isFirstChild(blocks[i])||tag=="UL"||tag=="OL"||tag=="DD"}ctrl.disabled(disable)})}});editor.on("keydown",function(e){if(e.keyCode==tinymce.util.VK.BACKSPACE){if(self.backspaceDelete()){e.preventDefault()}}else if(e.keyCode==tinymce.util.VK.DELETE){if(self.backspaceDelete(true)){e.preventDefault()}}})})}).call(window)},3473:function(module,exports){(function(){tinymce.PluginManager.add("media",function(editor,url){var urlPatterns=[{regex:/youtu\.be\/([\w\-.]+)/,type:"iframe",w:560,h:314,url:"//www.youtube.com/embed/$1",allowFullscreen:true},{regex:/youtube\.com(.+)v=([^&]+)/,type:"iframe",w:560,h:314,url:"//www.youtube.com/embed/$2",allowFullscreen:true},{regex:/youtube.com\/embed\/([a-z0-9\-_]+)/i,type:"iframe",w:560,h:314,url:"//www.youtube.com/embed/$1",allowFullscreen:true},{regex:/vimeo\.com\/([0-9]+)/,type:"iframe",w:425,h:350,url:"//player.vimeo.com/video/$1?title=0&byline=0&portrait=0&color=8dc7dc",allowfullscreen:true},{regex:/vimeo\.com\/(.*)\/([0-9]+)/,type:"iframe",w:425,h:350,url:"//player.vimeo.com/video/$2?title=0&amp;byline=0",allowfullscreen:true},{regex:/maps\.google\.([a-z]{2,3})\/maps\/(.+)msid=(.+)/,type:"iframe",w:425,h:350,url:'//maps.google.com/maps/ms?msid=$2&output=embed"',allowFullscreen:false},{regex:/dailymotion\.com\/video\/([^_]+)/,type:"iframe",w:480,h:270,url:"//www.dailymotion.com/embed/video/$1",allowFullscreen:true}];var embedChange=tinymce.Env.ie&&tinymce.Env.ie<=8?"onChange":"onInput";function guessMime(url){url=url.toLowerCase();if(url.indexOf(".mp3")!=-1){return"audio/mpeg"}if(url.indexOf(".wav")!=-1){return"audio/wav"}if(url.indexOf(".mp4")!=-1){return"video/mp4"}if(url.indexOf(".webm")!=-1){return"video/webm"}if(url.indexOf(".ogg")!=-1){return"video/ogg"}if(url.indexOf(".swf")!=-1){return"application/x-shockwave-flash"}return""}function getVideoScriptMatch(src){var prefixes=editor.settings.media_scripts;if(prefixes){for(var i=0;i<prefixes.length;i++){if(src.indexOf(prefixes[i].filter)!==-1){return prefixes[i]}}}}function showDialog(){var win,width,height,data;var generalFormItems=[{name:"source1",type:"filepicker",filetype:"media",size:40,autofocus:true,label:"Source",onchange:function(e){tinymce.each(e.meta,function(value,key){win.find("#"+key).value(value)})}}];function recalcSize(e){var widthCtrl,heightCtrl,newWidth,newHeight;widthCtrl=win.find("#width")[0];heightCtrl=win.find("#height")[0];newWidth=widthCtrl.value();newHeight=heightCtrl.value();if(win.find("#constrain")[0].checked()&&width&&height&&newWidth&&newHeight){if(e.control==widthCtrl){newHeight=Math.round(newWidth/width*newHeight);if(!isNaN(newHeight)){heightCtrl.value(newHeight)}}else{newWidth=Math.round(newHeight/height*newWidth);if(!isNaN(newWidth)){widthCtrl.value(newWidth)}}}width=newWidth;height=newHeight}if(editor.settings.media_alt_source!==false){generalFormItems.push({name:"source2",type:"filepicker",filetype:"media",size:40,label:"Alternative source"})}if(editor.settings.media_poster!==false){generalFormItems.push({name:"poster",type:"filepicker",filetype:"image",size:40,label:"Poster"})}if(editor.settings.media_dimensions!==false){generalFormItems.push({type:"container",label:"Dimensions",layout:"flex",align:"center",spacing:5,items:[{name:"width",type:"textbox",maxLength:5,size:3,onchange:recalcSize,ariaLabel:"Width"},{type:"label",text:"x"},{name:"height",type:"textbox",maxLength:5,size:3,onchange:recalcSize,ariaLabel:"Height"},{name:"constrain",type:"checkbox",checked:true,text:"Constrain proportions"}]})}data=getData(editor.selection.getNode());width=data.width;height=data.height;var embedTextBox={id:"mcemediasource",type:"textbox",flex:1,name:"embed",value:getSource(),multiline:true,label:"Source"};function updateValueOnChange(){data=htmlToData(this.value());this.parent().parent().fromJSON(data)}embedTextBox[embedChange]=updateValueOnChange;win=editor.windowManager.open({title:"Insert/edit video",data:data,bodyType:"tabpanel",body:[{title:"General",type:"form",onShowTab:function(){data=htmlToData(this.next().find("#embed").value());this.fromJSON(data)},items:generalFormItems},{title:"Embed",type:"container",layout:"flex",direction:"column",align:"stretch",padding:10,spacing:10,onShowTab:function(){this.find("#embed").value(dataToHtml(this.parent().toJSON()))},items:[{type:"label",text:"Paste your embed code below:",forId:"mcemediasource"},embedTextBox]}],onSubmit:function(){var beforeObjects,afterObjects,i,y;beforeObjects=editor.dom.select("img[data-mce-object]");editor.insertContent(dataToHtml(this.toJSON()));afterObjects=editor.dom.select("img[data-mce-object]");for(i=0;i<beforeObjects.length;i++){for(y=afterObjects.length-1;y>=0;y--){if(beforeObjects[i]==afterObjects[y]){afterObjects.splice(y,1)}}}editor.selection.select(afterObjects[0]);editor.nodeChanged()}})}function getSource(){var elm=editor.selection.getNode();if(elm.getAttribute("data-mce-object")){return editor.selection.getContent()}}function dataToHtml(data){var html="";if(!data.source1){tinymce.extend(data,htmlToData(data.embed));if(!data.source1){return""}}if(!data.source2){data.source2=""}if(!data.poster){data.poster=""}data.source1=editor.convertURL(data.source1,"source");data.source2=editor.convertURL(data.source2,"source");data.source1mime=guessMime(data.source1);data.source2mime=guessMime(data.source2);data.poster=editor.convertURL(data.poster,"poster");data.flashPlayerUrl=editor.convertURL(url+"/moxieplayer.swf","movie");tinymce.each(urlPatterns,function(pattern){var match,i,url;if(match=pattern.regex.exec(data.source1)){url=pattern.url;for(i=0;match[i];i++){url=url.replace("$"+i,function(){return match[i]})}data.source1=url;data.type=pattern.type;data.allowFullscreen=pattern.allowFullscreen;data.width=data.width||pattern.w;data.height=data.height||pattern.h}});if(data.embed){html=updateHtml(data.embed,data,true)}else{var videoScript=getVideoScriptMatch(data.source1);if(videoScript){data.type="script";data.width=videoScript.width;data.height=videoScript.height}data.width=data.width||300;data.height=data.height||150;tinymce.each(data,function(value,key){data[key]=editor.dom.encode(value)});if(data.type=="iframe"){var allowFullscreen=data.allowFullscreen?' allowFullscreen="1"':"";html+='<iframe src="'+data.source1+'" width="'+data.width+'" height="'+data.height+'"'+allowFullscreen+"></iframe>"}else if(data.source1mime=="application/x-shockwave-flash"){html+='<object data="'+data.source1+'" width="'+data.width+'" height="'+data.height+'" type="application/x-shockwave-flash">';if(data.poster){html+='<img src="'+data.poster+'" width="'+data.width+'" height="'+data.height+'" />'}html+="</object>"}else if(data.source1mime.indexOf("audio")!=-1){if(editor.settings.audio_template_callback){html=editor.settings.audio_template_callback(data)}else{html+='<audio controls="controls" src="'+data.source1+'">'+(data.source2?'\n<source src="'+data.source2+'"'+(data.source2mime?' type="'+data.source2mime+'"':"")+" />\n":"")+"</audio>"}}else if(data.type=="script"){html+='<script src="'+data.source1+'"></script>'}else{if(editor.settings.video_template_callback){html=editor.settings.video_template_callback(data)}else{html='<video width="'+data.width+'" height="'+data.height+'"'+(data.poster?' poster="'+data.poster+'"':"")+' controls="controls">\n'+'<source src="'+data.source1+'"'+(data.source1mime?' type="'+data.source1mime+'"':"")+" />\n"+(data.source2?'<source src="'+data.source2+'"'+(data.source2mime?' type="'+data.source2mime+'"':"")+" />\n":"")+"</video>";
}}}return html}function htmlToData(html){var data={};new tinymce.html.SaxParser({validate:false,allow_conditional_comments:true,special:"script,noscript",start:function(name,attrs){if(!data.source1&&name=="param"){data.source1=attrs.map.movie}if(name=="iframe"||name=="object"||name=="embed"||name=="video"||name=="audio"){if(!data.type){data.type=name}data=tinymce.extend(attrs.map,data)}if(name=="script"){var videoScript=getVideoScriptMatch(attrs.map.src);if(!videoScript){return}data={type:"script",source1:attrs.map.src,width:videoScript.width,height:videoScript.height}}if(name=="source"){if(!data.source1){data.source1=attrs.map.src}else if(!data.source2){data.source2=attrs.map.src}}if(name=="img"&&!data.poster){data.poster=attrs.map.src}}}).parse(html);data.source1=data.source1||data.src||data.data;data.source2=data.source2||"";data.poster=data.poster||"";return data}function getData(element){if(element.getAttribute("data-mce-object")){return htmlToData(editor.serializer.serialize(element,{selection:true}))}return{}}function sanitize(html){if(editor.settings.media_filter_html===false){return html}var writer=new tinymce.html.Writer,blocked;new tinymce.html.SaxParser({validate:false,allow_conditional_comments:false,special:"script,noscript",comment:function(text){writer.comment(text)},cdata:function(text){writer.cdata(text)},text:function(text,raw){writer.text(text,raw)},start:function(name,attrs,empty){blocked=true;if(name=="script"||name=="noscript"){return}for(var i=0;i<attrs.length;i++){if(attrs[i].name.indexOf("on")===0){return}if(attrs[i].name=="style"){attrs[i].value=editor.dom.serializeStyle(editor.dom.parseStyle(attrs[i].value),name)}}writer.start(name,attrs,empty);blocked=false},end:function(name){if(blocked){return}writer.end(name)}},new tinymce.html.Schema({})).parse(html);return writer.getContent()}function updateHtml(html,data,updateAll){var writer=new tinymce.html.Writer;var sourceCount=0,hasImage;function setAttributes(attrs,updatedAttrs){var name,i,value,attr;for(name in updatedAttrs){value=""+updatedAttrs[name];if(attrs.map[name]){i=attrs.length;while(i--){attr=attrs[i];if(attr.name==name){if(value){attrs.map[name]=value;attr.value=value}else{delete attrs.map[name];attrs.splice(i,1)}}}}else if(value){attrs.push({name:name,value:value});attrs.map[name]=value}}}new tinymce.html.SaxParser({validate:false,allow_conditional_comments:true,special:"script,noscript",comment:function(text){writer.comment(text)},cdata:function(text){writer.cdata(text)},text:function(text,raw){writer.text(text,raw)},start:function(name,attrs,empty){switch(name){case"video":case"object":case"embed":case"img":case"iframe":setAttributes(attrs,{width:data.width,height:data.height});break}if(updateAll){switch(name){case"video":setAttributes(attrs,{poster:data.poster,src:""});if(data.source2){setAttributes(attrs,{src:""})}break;case"iframe":setAttributes(attrs,{src:data.source1});break;case"source":sourceCount++;if(sourceCount<=2){setAttributes(attrs,{src:data["source"+sourceCount],type:data["source"+sourceCount+"mime"]});if(!data["source"+sourceCount]){return}}break;case"img":if(!data.poster){return}hasImage=true;break}}writer.start(name,attrs,empty)},end:function(name){if(name=="video"&&updateAll){for(var index=1;index<=2;index++){if(data["source"+index]){var attrs=[];attrs.map={};if(sourceCount<index){setAttributes(attrs,{src:data["source"+index],type:data["source"+index+"mime"]});writer.start("source",attrs,true)}}}}if(data.poster&&name=="object"&&updateAll&&!hasImage){var imgAttrs=[];imgAttrs.map={};setAttributes(imgAttrs,{src:data.poster,width:data.width,height:data.height});writer.start("img",imgAttrs,true)}writer.end(name)}},new tinymce.html.Schema({})).parse(html);return writer.getContent()}editor.on("ResolveName",function(e){var name;if(e.target.nodeType==1&&(name=e.target.getAttribute("data-mce-object"))){e.name=name}});function retainAttributesAndInnerHtml(sourceNode,targetNode){var attrName,attrValue,attribs,ai,innerHtml;attribs=sourceNode.attributes;ai=attribs.length;while(ai--){attrName=attribs[ai].name;attrValue=attribs[ai].value;if(attrName!=="width"&&attrName!=="height"&&attrName!=="style"){if(attrName=="data"||attrName=="src"){attrValue=editor.convertURL(attrValue,attrName)}targetNode.attr("data-mce-p-"+attrName,attrValue)}}innerHtml=sourceNode.firstChild&&sourceNode.firstChild.value;if(innerHtml){targetNode.attr("data-mce-html",escape(innerHtml));targetNode.firstChild=null}}function createPlaceholderNode(node){var placeHolder,name=node.name;placeHolder=new tinymce.html.Node("img",1);placeHolder.shortEnded=true;retainAttributesAndInnerHtml(node,placeHolder);placeHolder.attr({width:node.attr("width")||"300",height:node.attr("height")||(name=="audio"?"30":"150"),style:node.attr("style"),src:tinymce.Env.transparentSrc,"data-mce-object":name,class:"mce-object mce-object-"+name});return placeHolder}function createPreviewNode(node){var previewWrapper,previewNode,shimNode,name=node.name;previewWrapper=new tinymce.html.Node("span",1);previewWrapper.attr({contentEditable:"false",style:node.attr("style"),"data-mce-object":name,class:"mce-preview-object mce-object-"+name});retainAttributesAndInnerHtml(node,previewWrapper);previewNode=new tinymce.html.Node(name,1);previewNode.attr({src:node.attr("src"),allowfullscreen:node.attr("allowfullscreen"),width:node.attr("width")||"300",height:node.attr("height")||(name=="audio"?"30":"150"),frameborder:"0"});shimNode=new tinymce.html.Node("span",1);shimNode.attr("class","mce-shim");previewWrapper.append(previewNode);previewWrapper.append(shimNode);return previewWrapper}editor.on("preInit",function(){var specialElements=editor.schema.getSpecialElements();tinymce.each("video audio iframe object".split(" "),function(name){specialElements[name]=new RegExp("</"+name+"[^>]*>","gi")});var boolAttrs=editor.schema.getBoolAttrs();tinymce.each("webkitallowfullscreen mozallowfullscreen allowfullscreen".split(" "),function(name){boolAttrs[name]={}});editor.parser.addNodeFilter("iframe,video,audio,object,embed,script",function(nodes){var i=nodes.length,node,placeHolder,videoScript;while(i--){node=nodes[i];if(!node.parent){continue}if(node.parent.attr("data-mce-object")){continue}if(node.name=="script"){videoScript=getVideoScriptMatch(node.attr("src"));if(!videoScript){continue}}if(videoScript){if(videoScript.width){node.attr("width",videoScript.width.toString())}if(videoScript.height){node.attr("height",videoScript.height.toString())}}if(node.name=="iframe"&&editor.settings.media_live_embeds!==false&&tinymce.Env.ceFalse){placeHolder=createPreviewNode(node)}else{placeHolder=createPlaceholderNode(node)}node.replace(placeHolder)}});editor.serializer.addAttributeFilter("data-mce-object",function(nodes,name){var i=nodes.length,node,realElm,ai,attribs,innerHtml,innerNode,realElmName,className;while(i--){node=nodes[i];if(!node.parent){continue}realElmName=node.attr(name);realElm=new tinymce.html.Node(realElmName,1);if(realElmName!="audio"&&realElmName!="script"){className=node.attr("class");if(className&&className.indexOf("mce-preview-object")!==-1){realElm.attr({width:node.firstChild.attr("width"),height:node.firstChild.attr("height")})}else{realElm.attr({width:node.attr("width"),height:node.attr("height")})}}realElm.attr({style:node.attr("style")});attribs=node.attributes;ai=attribs.length;while(ai--){var attrName=attribs[ai].name;if(attrName.indexOf("data-mce-p-")===0){realElm.attr(attrName.substr(11),attribs[ai].value)}}if(realElmName=="script"){realElm.attr("type","text/javascript")}innerHtml=node.attr("data-mce-html");if(innerHtml){innerNode=new tinymce.html.Node("#text",3);innerNode.raw=true;innerNode.value=sanitize(unescape(innerHtml));realElm.append(innerNode)}node.replace(realElm)}})});editor.on("click keyup",function(){var selectedNode=editor.selection.getNode();if(selectedNode&&editor.dom.hasClass(selectedNode,"mce-preview-object")){if(editor.dom.getAttrib(selectedNode,"data-mce-selected")){selectedNode.setAttribute("data-mce-selected","2")}}});editor.on("ObjectSelected",function(e){var objectType=e.target.getAttribute("data-mce-object");if(objectType=="audio"||objectType=="script"){e.preventDefault()}});editor.on("objectResized",function(e){var target=e.target,html;if(target.getAttribute("data-mce-object")){html=target.getAttribute("data-mce-html");if(html){html=unescape(html);target.setAttribute("data-mce-html",escape(updateHtml(html,{width:e.width,height:e.height})))}}});editor.addButton("media",{tooltip:"Insert/edit video",onclick:showDialog,stateSelector:["img[data-mce-object]","span[data-mce-object]"]});editor.addMenuItem("media",{icon:"media",text:"Insert/edit video",onclick:showDialog,context:"insert",prependToContext:true});editor.on("setContent",function(){editor.$("span.mce-preview-object").each(function(index,elm){var $elm=editor.$(elm);if($elm.find("span.mce-shim",elm).length===0){$elm.append('<span class="mce-shim"></span>')}})});editor.addCommand("mceMedia",showDialog);this.showDialog=showDialog})}).call(window)},3474:function(module,exports){(function(){(function(exports,undefined){"use strict";var modules={};function require(ids,callback){var module,defs=[];for(var i=0;i<ids.length;++i){module=modules[ids[i]]||resolve(ids[i]);if(!module){throw"module definition dependecy not found: "+ids[i]}defs.push(module)}callback.apply(null,defs)}function define(id,dependencies,definition){if(typeof id!=="string"){throw"invalid module definition, module id must be defined and be a string"}if(dependencies===undefined){throw"invalid module definition, dependencies must be specified"}if(definition===undefined){throw"invalid module definition, definition function must be specified"}require(dependencies,function(){modules[id]=definition.apply(null,arguments)})}function defined(id){return!!modules[id]}function resolve(id){var target=exports;var fragments=id.split(/[.\/]/);for(var fi=0;fi<fragments.length;++fi){if(!target[fragments[fi]]){return}target=target[fragments[fi]]}return target}function expose(ids){var i,target,id,fragments,privateModules;for(i=0;i<ids.length;i++){target=exports;id=ids[i];fragments=id.split(/[.\/]/);for(var fi=0;fi<fragments.length-1;++fi){if(target[fragments[fi]]===undefined){target[fragments[fi]]={}}target=target[fragments[fi]]}target[fragments[fragments.length-1]]=modules[id]}if(exports.AMDLC_TESTS){privateModules=exports.privateModules||{};for(id in modules){privateModules[id]=modules[id]}for(i=0;i<ids.length;i++){delete privateModules[ids[i]]}exports.privateModules=privateModules}}define("tinymce/pasteplugin/Utils",["tinymce/util/Tools","tinymce/html/DomParser","tinymce/html/Schema"],function(Tools,DomParser,Schema){function filter(content,items){Tools.each(items,function(v){if(v.constructor==RegExp){content=content.replace(v,"")}else{content=content.replace(v[0],v[1])}});return content}function innerText(html){var schema=new Schema,domParser=new DomParser({},schema),text="";var shortEndedElements=schema.getShortEndedElements();var ignoreElements=Tools.makeMap("script noscript style textarea video audio iframe object"," ");var blockElements=schema.getBlockElements();function walk(node){var name=node.name,currentNode=node;if(name==="br"){text+="\n";return}if(shortEndedElements[name]){text+=" "}if(ignoreElements[name]){text+=" ";return}if(node.type==3){text+=node.value}if(!node.shortEnded){if(node=node.firstChild){do{walk(node)}while(node=node.next)}}if(blockElements[name]&&currentNode.next){text+="\n";if(name=="p"){text+="\n"}}}html=filter(html,[/<!\[[^\]]+\]>/g]);walk(domParser.parse(html));return text}function trimHtml(html){function trimSpaces(all,s1,s2){if(!s1&&!s2){return" "}return""}html=filter(html,[/^[\s\S]*<body[^>]*>\s*|\s*<\/body[^>]*>[\s\S]*$/g,/<!--StartFragment-->|<!--EndFragment-->/g,[/( ?)<span class="Apple-converted-space">\u00a0<\/span>( ?)/g,trimSpaces],/<br class="Apple-interchange-newline">/g,/<br>$/i]);return html}function createIdGenerator(prefix){var count=0;return function(){return prefix+count++}}return{filter:filter,innerText:innerText,trimHtml:trimHtml,createIdGenerator:createIdGenerator}});define("tinymce/pasteplugin/Clipboard",["tinymce/Env","tinymce/dom/RangeUtils","tinymce/util/VK","tinymce/pasteplugin/Utils","tinymce/util/Delay"],function(Env,RangeUtils,VK,Utils,Delay){return function(editor){var self=this,pasteBinElm,lastRng,keyboardPasteTimeStamp=0,draggingInternally=false;var pasteBinDefaultContent="%MCEPASTEBIN%",keyboardPastePlainTextState;var mceInternalUrlPrefix="data:text/mce-internal,";var uniqueId=Utils.createIdGenerator("mceclip");function pasteHtml(html){var args,dom=editor.dom;args=editor.fire("BeforePastePreProcess",{content:html});args=editor.fire("PastePreProcess",args);html=args.content;if(!args.isDefaultPrevented()){if(editor.hasEventListeners("PastePostProcess")&&!args.isDefaultPrevented()){var tempBody=dom.add(editor.getBody(),"div",{style:"display:none"},html);args=editor.fire("PastePostProcess",{node:tempBody});dom.remove(tempBody);html=args.node.innerHTML}if(!args.isDefaultPrevented()){editor.insertContent(html,{merge:editor.settings.paste_merge_formats!==false,data:{paste:true}})}}}function pasteText(text){text=editor.dom.encode(text).replace(/\r\n/g,"\n");var startBlock=editor.dom.getParent(editor.selection.getStart(),editor.dom.isBlock);var forcedRootBlockName=editor.settings.forced_root_block;var forcedRootBlockStartHtml;if(forcedRootBlockName){forcedRootBlockStartHtml=editor.dom.createHTML(forcedRootBlockName,editor.settings.forced_root_block_attrs);forcedRootBlockStartHtml=forcedRootBlockStartHtml.substr(0,forcedRootBlockStartHtml.length-3)+">"}if(startBlock&&/^(PRE|DIV)$/.test(startBlock.nodeName)||!forcedRootBlockName){text=Utils.filter(text,[[/\n/g,"<br>"]])}else{text=Utils.filter(text,[[/\n\n/g,"</p>"+forcedRootBlockStartHtml],[/^(.*<\/p>)(<p>)$/,forcedRootBlockStartHtml+"$1"],[/\n/g,"<br />"]]);if(text.indexOf("<p>")!=-1){text=forcedRootBlockStartHtml+text}}pasteHtml(text)}function createPasteBin(){var dom=editor.dom,body=editor.getBody();var viewport=editor.dom.getViewPort(editor.getWin()),scrollTop=viewport.y,top=20;var scrollContainer;lastRng=editor.selection.getRng();if(editor.inline){scrollContainer=editor.selection.getScrollContainer();if(scrollContainer&&scrollContainer.scrollTop>0){scrollTop=scrollContainer.scrollTop}}function getCaretRect(rng){var rects,textNode,node,container=rng.startContainer;rects=rng.getClientRects();if(rects.length){return rects[0]}if(!rng.collapsed||container.nodeType!=1){return}node=container.childNodes[lastRng.startOffset];while(node&&node.nodeType==3&&!node.data.length){node=node.nextSibling}if(!node){return}if(node.tagName=="BR"){textNode=dom.doc.createTextNode("\ufeff");node.parentNode.insertBefore(textNode,node);rng=dom.createRng();rng.setStartBefore(textNode);rng.setEndAfter(textNode);rects=rng.getClientRects();dom.remove(textNode)}if(rects.length){return rects[0]}}if(lastRng.getClientRects){var rect=getCaretRect(lastRng);if(rect){top=scrollTop+(rect.top-dom.getPos(body).y)}else{top=scrollTop;var container=lastRng.startContainer;if(container){if(container.nodeType==3&&container.parentNode!=body){container=container.parentNode}if(container.nodeType==1){top=dom.getPos(container,scrollContainer||body).y}}}}pasteBinElm=dom.add(editor.getBody(),"div",{id:"mcepastebin",contentEditable:true,"data-mce-bogus":"all",style:"position: absolute; top: "+top+"px;"+"width: 10px; height: 10px; overflow: hidden; opacity: 0"},pasteBinDefaultContent);if(Env.ie||Env.gecko){dom.setStyle(pasteBinElm,"left",dom.getStyle(body,"direction",true)=="rtl"?65535:-65535)}dom.bind(pasteBinElm,"beforedeactivate focusin focusout",function(e){e.stopPropagation()});pasteBinElm.focus();editor.selection.select(pasteBinElm,true)}function removePasteBin(){if(pasteBinElm){var pasteBinClone;while(pasteBinClone=editor.dom.get("mcepastebin")){editor.dom.remove(pasteBinClone);editor.dom.unbind(pasteBinClone)}if(lastRng){editor.selection.setRng(lastRng)}}pasteBinElm=lastRng=null}function getPasteBinHtml(){var html="",pasteBinClones,i,clone,cloneHtml;pasteBinClones=editor.dom.select("div[id=mcepastebin]");for(i=0;i<pasteBinClones.length;i++){clone=pasteBinClones[i];if(clone.firstChild&&clone.firstChild.id=="mcepastebin"){clone=clone.firstChild}cloneHtml=clone.innerHTML;if(html!=pasteBinDefaultContent){html+=cloneHtml}}return html}function getDataTransferItems(dataTransfer){var items={};if(dataTransfer){if(dataTransfer.getData){var legacyText=dataTransfer.getData("Text");if(legacyText&&legacyText.length>0){if(legacyText.indexOf(mceInternalUrlPrefix)==-1){items["text/plain"]=legacyText}}}if(dataTransfer.types){for(var i=0;i<dataTransfer.types.length;i++){var contentType=dataTransfer.types[i];items[contentType]=dataTransfer.getData(contentType)}}}return items}function getClipboardContent(clipboardEvent){return getDataTransferItems(clipboardEvent.clipboardData||editor.getDoc().dataTransfer)}function hasHtmlOrText(content){return hasContentType(content,"text/html")||hasContentType(content,"text/plain")}function pasteImageData(e,rng){var dataTransfer=e.clipboardData||e.dataTransfer;function getBase64FromUri(uri){var idx;idx=uri.indexOf(",");if(idx!==-1){return uri.substr(idx+1)}return null}function processItems(items){var i,item,reader,hadImage=false;function pasteImage(reader,blob){if(rng){editor.selection.setRng(rng);rng=null}var blobCache=editor.editorUpload.blobCache;var blobInfo=blobCache.create(uniqueId(),blob,getBase64FromUri(reader.result));blobCache.add(blobInfo);pasteHtml('<img src="'+blobInfo.blobUri()+'">')}if(items){for(i=0;i<items.length;i++){item=items[i];if(/^image\/(jpeg|png|gif|bmp)$/.test(item.type)){var blob=item.getAsFile?item.getAsFile():item;reader=new FileReader;reader.onload=pasteImage.bind(null,reader,blob);reader.readAsDataURL(blob);e.preventDefault();hadImage=true}}}return hadImage}if(editor.settings.paste_data_images&&dataTransfer){return processItems(dataTransfer.items)||processItems(dataTransfer.files)}}function isBrokenAndroidClipboardEvent(e){var clipboardData=e.clipboardData;return navigator.userAgent.indexOf("Android")!=-1&&clipboardData&&clipboardData.items&&clipboardData.items.length===0}function getCaretRangeFromEvent(e){return RangeUtils.getCaretRangeFromPoint(e.clientX,e.clientY,editor.getDoc())}function hasContentType(clipboardContent,mimeType){return mimeType in clipboardContent&&clipboardContent[mimeType].length>0}function isKeyboardPasteEvent(e){return VK.metaKeyPressed(e)&&e.keyCode==86||e.shiftKey&&e.keyCode==45}function registerEventHandlers(){editor.on("keydown",function(e){function removePasteBinOnKeyUp(e){if(isKeyboardPasteEvent(e)&&!e.isDefaultPrevented()){removePasteBin()}}if(isKeyboardPasteEvent(e)&&!e.isDefaultPrevented()){keyboardPastePlainTextState=e.shiftKey&&e.keyCode==86;if(keyboardPastePlainTextState&&Env.webkit&&navigator.userAgent.indexOf("Version/")!=-1){return}e.stopImmediatePropagation();keyboardPasteTimeStamp=(new Date).getTime();if(Env.ie&&keyboardPastePlainTextState){e.preventDefault();editor.fire("paste",{ieFake:true});return}removePasteBin();createPasteBin();editor.once("keyup",removePasteBinOnKeyUp);editor.once("paste",function(){editor.off("keyup",removePasteBinOnKeyUp)})}});function insertClipboardContent(clipboardContent,isKeyBoardPaste,plainTextMode){var content;if(hasContentType(clipboardContent,"text/html")){content=clipboardContent["text/html"]}else{content=getPasteBinHtml();if(content==pasteBinDefaultContent){plainTextMode=true}}content=Utils.trimHtml(content);if(pasteBinElm&&pasteBinElm.firstChild&&pasteBinElm.firstChild.id==="mcepastebin"){plainTextMode=true}removePasteBin();if(!content.length){plainTextMode=true}if(plainTextMode){if(hasContentType(clipboardContent,"text/plain")&&content.indexOf("</p>")==-1){content=clipboardContent["text/plain"]}else{content=Utils.innerText(content)}}if(content==pasteBinDefaultContent){if(!isKeyBoardPaste){editor.windowManager.alert("Please use Ctrl+V/Cmd+V keyboard shortcuts to paste contents.")}return}if(plainTextMode){pasteText(content)}else{pasteHtml(content)}}var getLastRng=function(){return lastRng||editor.selection.getRng()};editor.on("paste",function(e){var clipboardTimer=(new Date).getTime();var clipboardContent=getClipboardContent(e);var clipboardDelay=(new Date).getTime()-clipboardTimer;var isKeyBoardPaste=(new Date).getTime()-keyboardPasteTimeStamp-clipboardDelay<1e3;var plainTextMode=self.pasteFormat=="text"||keyboardPastePlainTextState;keyboardPastePlainTextState=false;if(e.isDefaultPrevented()||isBrokenAndroidClipboardEvent(e)){removePasteBin();return}if(!hasHtmlOrText(clipboardContent)&&pasteImageData(e,getLastRng())){removePasteBin();return}if(!isKeyBoardPaste){e.preventDefault()}if(Env.ie&&(!isKeyBoardPaste||e.ieFake)){createPasteBin();editor.dom.bind(pasteBinElm,"paste",function(e){e.stopPropagation()});editor.getDoc().execCommand("Paste",false,null);clipboardContent["text/html"]=getPasteBinHtml()}if(hasContentType(clipboardContent,"text/html")){e.preventDefault();insertClipboardContent(clipboardContent,isKeyBoardPaste,plainTextMode)}else{Delay.setEditorTimeout(editor,function(){insertClipboardContent(clipboardContent,isKeyBoardPaste,plainTextMode)},0)}});editor.on("dragstart dragend",function(e){draggingInternally=e.type=="dragstart"});function isPlainTextFileUrl(content){return content["text/plain"].indexOf("file://")===0}editor.on("drop",function(e){var dropContent,rng;rng=getCaretRangeFromEvent(e);if(e.isDefaultPrevented()||draggingInternally){return}dropContent=getDataTransferItems(e.dataTransfer);if((!hasHtmlOrText(dropContent)||isPlainTextFileUrl(dropContent))&&pasteImageData(e,rng)){return}if(rng&&editor.settings.paste_filter_drop!==false){var content=dropContent["mce-internal"]||dropContent["text/html"]||dropContent["text/plain"];if(content){e.preventDefault();Delay.setEditorTimeout(editor,function(){editor.undoManager.transact(function(){if(dropContent["mce-internal"]){editor.execCommand("Delete")}editor.selection.setRng(rng);content=Utils.trimHtml(content);if(!dropContent["text/html"]){pasteText(content)}else{pasteHtml(content)}})})}}});editor.on("dragover dragend",function(e){if(editor.settings.paste_data_images){e.preventDefault()}})}self.pasteHtml=pasteHtml;self.pasteText=pasteText;editor.on("preInit",function(){registerEventHandlers();editor.parser.addNodeFilter("img",function(nodes,name,args){function isPasteInsert(args){return args.data&&args.data.paste===true}function remove(node){if(!node.attr("data-mce-object")&&src!==Env.transparentSrc){node.remove()}}function isWebKitFakeUrl(src){return src.indexOf("webkit-fake-url")===0}function isDataUri(src){return src.indexOf("data:")===0}if(!editor.settings.paste_data_images&&isPasteInsert(args)){var i=nodes.length;while(i--){var src=nodes[i].attributes.map.src;if(!src){continue}if(isWebKitFakeUrl(src)){remove(nodes[i])}else if(!editor.settings.allow_html_data_urls&&isDataUri(src)){remove(nodes[i])}}}})})}});define("tinymce/pasteplugin/WordFilter",["tinymce/util/Tools","tinymce/html/DomParser","tinymce/html/Schema","tinymce/html/Serializer","tinymce/html/Node","tinymce/pasteplugin/Utils"],function(Tools,DomParser,Schema,Serializer,Node,Utils){function isWordContent(content){return/<font face="Times New Roman"|class="?Mso|style="[^"]*\bmso-|style='[^'']*\bmso-|w:WordDocument/i.test(content)||/class="OutlineElement/.test(content)||/id="?docs\-internal\-guid\-/.test(content)}function isNumericList(text){var found,patterns;patterns=[/^[IVXLMCD]{1,2}\.[ \u00a0]/,/^[ivxlmcd]{1,2}\.[ \u00a0]/,/^[a-z]{1,2}[\.\)][ \u00a0]/,/^[A-Z]{1,2}[\.\)][ \u00a0]/,/^[0-9]+\.[ \u00a0]/,/^[\u3007\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d]+\.[ \u00a0]/,/^[\u58f1\u5f10\u53c2\u56db\u4f0d\u516d\u4e03\u516b\u4e5d\u62fe]+\.[ \u00a0]/];text=text.replace(/^[\u00a0 ]+/,"");Tools.each(patterns,function(pattern){if(pattern.test(text)){found=true;return false}});return found}function isBulletList(text){return/^[\s\u00a0]*[\u2022\u00b7\u00a7\u25CF]\s*/.test(text)}function WordFilter(editor){var settings=editor.settings;editor.on("BeforePastePreProcess",function(e){var content=e.content,retainStyleProperties,validStyles;content=content.replace(/<b[^>]+id="?docs-internal-[^>]*>/gi,"");content=content.replace(/<br class="?Apple-interchange-newline"?>/gi,"");retainStyleProperties=settings.paste_retain_style_properties;if(retainStyleProperties){validStyles=Tools.makeMap(retainStyleProperties.split(/[, ]/))}function convertFakeListsToProperLists(node){var currentListNode,prevListNode,lastLevel=1;function getText(node){var txt="";if(node.type===3){return node.value}if(node=node.firstChild){do{txt+=getText(node)}while(node=node.next)}return txt}function trimListStart(node,regExp){if(node.type===3){if(regExp.test(node.value)){node.value=node.value.replace(regExp,"");return false}}if(node=node.firstChild){do{if(!trimListStart(node,regExp)){return false}}while(node=node.next)}return true}function removeIgnoredNodes(node){if(node._listIgnore){node.remove();return}if(node=node.firstChild){do{removeIgnoredNodes(node)}while(node=node.next)}}function convertParagraphToLi(paragraphNode,listName,start){var level=paragraphNode._listLevel||lastLevel;if(level!=lastLevel){if(level<lastLevel){if(currentListNode){currentListNode=currentListNode.parent.parent}}else{prevListNode=currentListNode;currentListNode=null}}if(!currentListNode||currentListNode.name!=listName){prevListNode=prevListNode||currentListNode;currentListNode=new Node(listName,1);if(start>1){currentListNode.attr("start",""+start)}paragraphNode.wrap(currentListNode)}else{currentListNode.append(paragraphNode)}paragraphNode.name="li";if(level>lastLevel&&prevListNode){prevListNode.lastChild.append(currentListNode)}lastLevel=level;removeIgnoredNodes(paragraphNode);trimListStart(paragraphNode,/^\u00a0+/);trimListStart(paragraphNode,/^\s*([\u2022\u00b7\u00a7\u25CF]|\w+\.)/);trimListStart(paragraphNode,/^\u00a0+/)}var elements=[],child=node.firstChild;while(typeof child!=="undefined"&&child!==null){elements.push(child);child=child.walk();if(child!==null){while(typeof child!=="undefined"&&child.parent!==node){child=child.walk()}}}for(var i=0;i<elements.length;i++){node=elements[i];if(node.name=="p"&&node.firstChild){var nodeText=getText(node);if(isBulletList(nodeText)){convertParagraphToLi(node,"ul");continue}if(isNumericList(nodeText)){var matches=/([0-9]+)\./.exec(nodeText);var start=1;if(matches){start=parseInt(matches[1],10)}convertParagraphToLi(node,"ol",start);continue}if(node._listLevel){convertParagraphToLi(node,"ul",1);continue}currentListNode=null}else{prevListNode=currentListNode;currentListNode=null}}}function filterStyles(node,styleValue){var outputStyles={},matches,styles=editor.dom.parseStyle(styleValue);Tools.each(styles,function(value,name){switch(name){case"mso-list":matches=/\w+ \w+([0-9]+)/i.exec(styleValue);if(matches){node._listLevel=parseInt(matches[1],10)}if(/Ignore/i.test(value)&&node.firstChild){node._listIgnore=true;node.firstChild._listIgnore=true}break;case"horiz-align":name="text-align";break;case"vert-align":name="vertical-align";break;case"font-color":case"mso-foreground":name="color";break;case"mso-background":case"mso-highlight":name="background";break;case"font-weight":case"font-style":if(value!="normal"){outputStyles[name]=value}return;case"mso-element":if(/^(comment|comment-list)$/i.test(value)){node.remove();return}break}if(name.indexOf("mso-comment")===0){node.remove();return}if(name.indexOf("mso-")===0){return}if(retainStyleProperties=="all"||validStyles&&validStyles[name]){outputStyles[name]=value}});if(/(bold)/i.test(outputStyles["font-weight"])){delete outputStyles["font-weight"];node.wrap(new Node("b",1))}if(/(italic)/i.test(outputStyles["font-style"])){delete outputStyles["font-style"];node.wrap(new Node("i",1))}outputStyles=editor.dom.serializeStyle(outputStyles,node.name);if(outputStyles){return outputStyles}return null}if(settings.paste_enable_default_filters===false){return}if(isWordContent(e.content)){e.wordContent=true;content=Utils.filter(content,[/<!--[\s\S]+?-->/gi,/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|img|meta|link|style|\w:\w+)(?=[\s\/>]))[^>]*>/gi,[/<(\/?)s>/gi,"<$1strike>"],[/&nbsp;/gi,""],[/<span\s+style\s*=\s*"\s*mso-spacerun\s*:\s*yes\s*;?\s*"\s*>([\s\u00a0]*)<\/span>/gi,function(str,spaces){return spaces.length>0?spaces.replace(/./," ").slice(Math.floor(spaces.length/2)).split("").join(""):""}]]);var validElements=settings.paste_word_valid_elements;if(!validElements){validElements="-strong/b,-em/i,-u,-span,-p,-ol,-ul,-li,-h1,-h2,-h3,-h4,-h5,-h6,"+"-p/div,-a[href|name],sub,sup,strike,br,del,table[width],tr,"+"td[colspan|rowspan|width],th[colspan|rowspan|width],thead,tfoot,tbody"}var schema=new Schema({valid_elements:validElements,valid_children:"-li[p]"});Tools.each(schema.elements,function(rule){if(!rule.attributes["class"]){rule.attributes["class"]={};rule.attributesOrder.push("class")}if(!rule.attributes.style){rule.attributes.style={};rule.attributesOrder.push("style")}});var domParser=new DomParser({},schema);domParser.addAttributeFilter("style",function(nodes){var i=nodes.length,node;while(i--){node=nodes[i];node.attr("style",filterStyles(node,node.attr("style")));if(node.name=="span"&&node.parent&&!node.attributes.length){node.unwrap()}}});domParser.addAttributeFilter("class",function(nodes){var i=nodes.length,node,className;while(i--){node=nodes[i];className=node.attr("class");if(/^(MsoCommentReference|MsoCommentText|msoDel)$/i.test(className)){node.remove()}node.attr("class",null)}});domParser.addNodeFilter("del",function(nodes){var i=nodes.length;while(i--){nodes[i].remove()}});domParser.addNodeFilter("a",function(nodes){var i=nodes.length,node,href,name;while(i--){node=nodes[i];href=node.attr("href");name=node.attr("name");if(href&&href.indexOf("#_msocom_")!=-1){node.remove();continue}if(href&&href.indexOf("file://")===0){href=href.split("#")[1];if(href){href="#"+href}}if(!href&&!name){node.unwrap()}else{if(name&&!/^_?(?:toc|edn|ftn)/i.test(name)){node.unwrap();continue}node.attr({href:href,name:name})}}});var rootNode=domParser.parse(content);if(settings.paste_convert_word_fake_lists!==false){convertFakeListsToProperLists(rootNode)}e.content=new Serializer({validate:settings.validate},schema).serialize(rootNode)}})}WordFilter.isWordContent=isWordContent;return WordFilter});define("tinymce/pasteplugin/Quirks",["tinymce/Env","tinymce/util/Tools","tinymce/pasteplugin/WordFilter","tinymce/pasteplugin/Utils"],function(Env,Tools,WordFilter,Utils){"use strict";return function(editor){function addPreProcessFilter(filterFunc){editor.on("BeforePastePreProcess",function(e){e.content=filterFunc(e.content)})}function removeExplorerBrElementsAfterBlocks(html){if(!WordFilter.isWordContent(html)){return html}var blockElements=[];Tools.each(editor.schema.getBlockElements(),function(block,blockName){blockElements.push(blockName)});var explorerBlocksRegExp=new RegExp("(?:<br>&nbsp;[\\s\\r\\n]+|<br>)*(<\\/?("+blockElements.join("|")+")[^>]*>)(?:<br>&nbsp;[\\s\\r\\n]+|<br>)*","g");html=Utils.filter(html,[[explorerBlocksRegExp,"$1"]]);html=Utils.filter(html,[[/<br><br>/g,"<BR><BR>"],[/<br>/g," "],[/<BR><BR>/g,"<br>"]]);return html}function removeWebKitStyles(content){if(WordFilter.isWordContent(content)){return content}var webKitStyles=editor.settings.paste_webkit_styles;if(editor.settings.paste_remove_styles_if_webkit===false||webKitStyles=="all"){return content}if(webKitStyles){webKitStyles=webKitStyles.split(/[, ]/)}if(webKitStyles){var dom=editor.dom,node=editor.selection.getNode();content=content.replace(/(<[^>]+) style="([^"]*)"([^>]*>)/gi,function(all,before,value,after){var inputStyles=dom.parseStyle(value,"span"),outputStyles={};if(webKitStyles==="none"){return before+after}for(var i=0;i<webKitStyles.length;i++){var inputValue=inputStyles[webKitStyles[i]],currentValue=dom.getStyle(node,webKitStyles[i],true);if(/color/.test(webKitStyles[i])){inputValue=dom.toHex(inputValue);currentValue=dom.toHex(currentValue);
}if(currentValue!=inputValue){outputStyles[webKitStyles[i]]=inputValue}}outputStyles=dom.serializeStyle(outputStyles,"span");if(outputStyles){return before+' style="'+outputStyles+'"'+after}return before+after})}else{content=content.replace(/(<[^>]+) style="([^"]*)"([^>]*>)/gi,"$1$3")}content=content.replace(/(<[^>]+) data-mce-style="([^"]+)"([^>]*>)/gi,function(all,before,value,after){return before+' style="'+value+'"'+after});return content}if(Env.webkit){addPreProcessFilter(removeWebKitStyles)}if(Env.ie){addPreProcessFilter(removeExplorerBrElementsAfterBlocks)}}});define("tinymce/pasteplugin/Plugin",["tinymce/PluginManager","tinymce/pasteplugin/Clipboard","tinymce/pasteplugin/WordFilter","tinymce/pasteplugin/Quirks"],function(PluginManager,Clipboard,WordFilter,Quirks){var userIsInformed;PluginManager.add("paste",function(editor){var self=this,clipboard,settings=editor.settings;function isUserInformedAboutPlainText(){return userIsInformed||editor.settings.paste_plaintext_inform===false}function togglePlainTextPaste(){if(clipboard.pasteFormat=="text"){this.active(false);clipboard.pasteFormat="html";editor.fire("PastePlainTextToggle",{state:false})}else{clipboard.pasteFormat="text";this.active(true);if(!isUserInformedAboutPlainText()){var message=editor.translate("Paste is now in plain text mode. Contents will now "+"be pasted as plain text until you toggle this option off.");editor.notificationManager.open({text:message,type:"info"});userIsInformed=true;editor.fire("PastePlainTextToggle",{state:true})}}editor.focus()}self.clipboard=clipboard=new Clipboard(editor);self.quirks=new Quirks(editor);self.wordFilter=new WordFilter(editor);if(editor.settings.paste_as_text){self.clipboard.pasteFormat="text"}if(settings.paste_preprocess){editor.on("PastePreProcess",function(e){settings.paste_preprocess.call(self,self,e)})}if(settings.paste_postprocess){editor.on("PastePostProcess",function(e){settings.paste_postprocess.call(self,self,e)})}editor.addCommand("mceInsertClipboardContent",function(ui,value){if(value.content){self.clipboard.pasteHtml(value.content)}if(value.text){self.clipboard.pasteText(value.text)}});if(editor.settings.paste_block_drop){editor.on("dragend dragover draggesture dragdrop drop drag",function(e){e.preventDefault();e.stopPropagation()})}if(!editor.settings.paste_data_images){editor.on("drop",function(e){var dataTransfer=e.dataTransfer;if(dataTransfer&&dataTransfer.files&&dataTransfer.files.length>0){e.preventDefault()}})}editor.addButton("pastetext",{icon:"pastetext",tooltip:"Paste as text",onclick:togglePlainTextPaste,active:self.clipboard.pasteFormat=="text"});editor.addMenuItem("pastetext",{text:"Paste as text",selectable:true,active:clipboard.pasteFormat,onclick:togglePlainTextPaste})})});expose(["tinymce/pasteplugin/Utils"])})(this)}).call(window)},3475:function(module,exports){(function(){tinymce.PluginManager.add("tabfocus",function(editor){var DOM=tinymce.DOM,each=tinymce.each,explode=tinymce.explode;function tabCancel(e){if(e.keyCode===9&&!e.ctrlKey&&!e.altKey&&!e.metaKey){e.preventDefault()}}function tabHandler(e){var x,el,v,i;if(e.keyCode!==9||e.ctrlKey||e.altKey||e.metaKey||e.isDefaultPrevented()){return}function find(direction){el=DOM.select(":input:enabled,*[tabindex]:not(iframe)");function canSelectRecursive(e){return e.nodeName==="BODY"||e.type!="hidden"&&e.style.display!="none"&&e.style.visibility!="hidden"&&canSelectRecursive(e.parentNode)}function canSelect(el){return/INPUT|TEXTAREA|BUTTON/.test(el.tagName)&&tinymce.get(e.id)&&el.tabIndex!=-1&&canSelectRecursive(el)}each(el,function(e,i){if(e.id==editor.id){x=i;return false}});if(direction>0){for(i=x+1;i<el.length;i++){if(canSelect(el[i])){return el[i]}}}else{for(i=x-1;i>=0;i--){if(canSelect(el[i])){return el[i]}}}return null}v=explode(editor.getParam("tab_focus",editor.getParam("tabfocus_elements",":prev,:next")));if(v.length==1){v[1]=v[0];v[0]=":prev"}if(e.shiftKey){if(v[0]==":prev"){el=find(-1)}else{el=DOM.get(v[0])}}else{if(v[1]==":next"){el=find(1)}else{el=DOM.get(v[1])}}if(el){var focusEditor=tinymce.get(el.id||el.name);if(el.id&&focusEditor){focusEditor.focus()}else{tinymce.util.Delay.setTimeout(function(){if(!tinymce.Env.webkit){window.focus()}el.focus()},10)}e.preventDefault()}}editor.on("init",function(){if(editor.inline){tinymce.DOM.setAttrib(editor.getBody(),"tabIndex",null)}editor.on("keyup",tabCancel);if(tinymce.Env.gecko){editor.on("keypress keydown",tabHandler)}else{editor.on("keydown",tabHandler)}})})}).call(window)},3476:function(module,exports){(function(){tinymce.PluginManager.add("textcolor",function(editor){var cols,rows;rows={forecolor:editor.settings.forecolor_rows||editor.settings.textcolor_rows||5,backcolor:editor.settings.backcolor_rows||editor.settings.textcolor_rows||5};cols={forecolor:editor.settings.forecolor_cols||editor.settings.textcolor_cols||8,backcolor:editor.settings.backcolor_cols||editor.settings.textcolor_cols||8};function getCurrentColor(format){var color;editor.dom.getParents(editor.selection.getStart(),function(elm){var value;if(value=elm.style[format=="forecolor"?"color":"background-color"]){color=value}});return color}function mapColors(type){var i,colors=[],colorMap;colorMap=["000000","Black","993300","Burnt orange","333300","Dark olive","003300","Dark green","003366","Dark azure","000080","Navy Blue","333399","Indigo","333333","Very dark gray","800000","Maroon","FF6600","Orange","808000","Olive","008000","Green","008080","Teal","0000FF","Blue","666699","Grayish blue","808080","Gray","FF0000","Red","FF9900","Amber","99CC00","Yellow green","339966","Sea green","33CCCC","Turquoise","3366FF","Royal blue","800080","Purple","999999","Medium gray","FF00FF","Magenta","FFCC00","Gold","FFFF00","Yellow","00FF00","Lime","00FFFF","Aqua","00CCFF","Sky blue","993366","Red violet","FFFFFF","White","FF99CC","Pink","FFCC99","Peach","FFFF99","Light yellow","CCFFCC","Pale green","CCFFFF","Pale cyan","99CCFF","Light sky blue","CC99FF","Plum"];colorMap=editor.settings.textcolor_map||colorMap;colorMap=editor.settings[type+"_map"]||colorMap;for(i=0;i<colorMap.length;i+=2){colors.push({text:colorMap[i+1],color:"#"+colorMap[i]})}return colors}function renderColorPicker(){var ctrl=this,colors,color,html,last,x,y,i,id=ctrl._id,count=0,type;type=ctrl.settings.origin;function getColorCellHtml(color,title){var isNoColor=color=="transparent";return'<td class="mce-grid-cell'+(isNoColor?" mce-colorbtn-trans":"")+'">'+'<div id="'+id+"-"+count++ +'"'+' data-mce-color="'+(color?color:"")+'"'+' role="option"'+' tabIndex="-1"'+' style="'+(color?"background-color: "+color:"")+'"'+' title="'+tinymce.translate(title)+'">'+(isNoColor?"&#215;":"")+"</div>"+"</td>"}colors=mapColors(type);colors.push({text:tinymce.translate("No color"),color:"transparent"});html='<table class="mce-grid mce-grid-border mce-colorbutton-grid" role="list" cellspacing="0"><tbody>';last=colors.length-1;for(y=0;y<rows[type];y++){html+="<tr>";for(x=0;x<cols[type];x++){i=y*cols[type]+x;if(i>last){html+="<td></td>"}else{color=colors[i];html+=getColorCellHtml(color.color,color.text)}}html+="</tr>"}if(editor.settings.color_picker_callback){html+="<tr>"+'<td colspan="'+cols[type]+'" class="mce-custom-color-btn">'+'<div id="'+id+'-c" class="mce-widget mce-btn mce-btn-small mce-btn-flat" '+'role="button" tabindex="-1" aria-labelledby="'+id+'-c" style="width: 100%">'+'<button type="button" role="presentation" tabindex="-1">'+tinymce.translate("Custom...")+"</button>"+"</div>"+"</td>"+"</tr>";html+="<tr>";for(x=0;x<cols[type];x++){html+=getColorCellHtml("","Custom color")}html+="</tr>"}html+="</tbody></table>";return html}function applyFormat(format,value){editor.undoManager.transact(function(){editor.focus();editor.formatter.apply(format,{value:value});editor.nodeChanged()})}function removeFormat(format){editor.undoManager.transact(function(){editor.focus();editor.formatter.remove(format,{value:null},null,true);editor.nodeChanged()})}function onPanelClick(e){var buttonCtrl=this.parent(),value,type;type=buttonCtrl.settings.origin;function selectColor(value){buttonCtrl.hidePanel();buttonCtrl.color(value);applyFormat(buttonCtrl.settings.format,value)}function resetColor(){buttonCtrl.hidePanel();buttonCtrl.resetColor();removeFormat(buttonCtrl.settings.format)}function setDivColor(div,value){div.style.background=value;div.setAttribute("data-mce-color",value)}if(tinymce.DOM.getParent(e.target,".mce-custom-color-btn")){buttonCtrl.hidePanel();editor.settings.color_picker_callback.call(editor,function(value){var tableElm=buttonCtrl.panel.getEl().getElementsByTagName("table")[0];var customColorCells,div,i;customColorCells=tinymce.map(tableElm.rows[tableElm.rows.length-1].childNodes,function(elm){return elm.firstChild});for(i=0;i<customColorCells.length;i++){div=customColorCells[i];if(!div.getAttribute("data-mce-color")){break}}if(i==cols[type]){for(i=0;i<cols[type]-1;i++){setDivColor(customColorCells[i],customColorCells[i+1].getAttribute("data-mce-color"))}}setDivColor(div,value);selectColor(value)},getCurrentColor(buttonCtrl.settings.format))}value=e.target.getAttribute("data-mce-color");if(value){if(this.lastId){document.getElementById(this.lastId).setAttribute("aria-selected",false)}e.target.setAttribute("aria-selected",true);this.lastId=e.target.id;if(value=="transparent"){resetColor()}else{selectColor(value)}}else if(value!==null){buttonCtrl.hidePanel()}}function onButtonClick(){var self=this;if(self._color){applyFormat(self.settings.format,self._color)}else{removeFormat(self.settings.format)}}editor.addButton("forecolor",{type:"colorbutton",tooltip:"Text color",format:"forecolor",panel:{origin:"forecolor",role:"application",ariaRemember:true,html:renderColorPicker,onclick:onPanelClick},onclick:onButtonClick});editor.addButton("backcolor",{type:"colorbutton",tooltip:"Background color",format:"hilitecolor",panel:{origin:"backcolor",role:"application",ariaRemember:true,html:renderColorPicker,onclick:onPanelClick},onclick:onButtonClick})})}).call(window)},3477:function(module,exports){(function(){tinymce.ThemeManager.add("modern",function(editor){var self=this,settings=editor.settings,Factory=tinymce.ui.Factory,each=tinymce.each,DOM=tinymce.DOM,Rect=tinymce.geom.Rect,FloatPanel=tinymce.ui.FloatPanel;var defaultMenus={file:{title:"File",items:"newdocument"},edit:{title:"Edit",items:"undo redo | cut copy paste pastetext | selectall"},insert:{title:"Insert",items:"|"},view:{title:"View",items:"visualaid |"},format:{title:"Format",items:"bold italic underline strikethrough superscript subscript | formats | removeformat"},table:{title:"Table"},tools:{title:"Tools"}};var defaultToolbar="undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | "+"bullist numlist outdent indent | link image";function createToolbar(items,size){var toolbarItems=[],buttonGroup;if(!items){return}each(items.split(/[ ,]/),function(item){var itemName;function bindSelectorChanged(){var selection=editor.selection;function setActiveItem(name){return function(state,args){var nodeName,i=args.parents.length;while(i--){nodeName=args.parents[i].nodeName;if(nodeName=="OL"||nodeName=="UL"){break}}item.active(state&&nodeName==name)}}if(itemName=="bullist"){selection.selectorChanged("ul > li",setActiveItem("UL"))}if(itemName=="numlist"){selection.selectorChanged("ol > li",setActiveItem("OL"))}if(item.settings.stateSelector){selection.selectorChanged(item.settings.stateSelector,function(state){item.active(state)},true)}if(item.settings.disabledStateSelector){selection.selectorChanged(item.settings.disabledStateSelector,function(state){item.disabled(state)})}}if(item=="|"){buttonGroup=null}else{if(Factory.has(item)){item={type:item,size:size};toolbarItems.push(item);buttonGroup=null}else{if(!buttonGroup){buttonGroup={type:"buttongroup",items:[]};toolbarItems.push(buttonGroup)}if(editor.buttons[item]){itemName=item;item=editor.buttons[itemName];if(typeof item=="function"){item=item()}item.type=item.type||"button";item.size=size;item=Factory.create(item);buttonGroup.items.push(item);if(editor.initialized){bindSelectorChanged()}else{editor.on("init",bindSelectorChanged)}}}}});return{type:"toolbar",layout:"flow",items:toolbarItems}}function createToolbars(size){var toolbars=[];function addToolbar(items){if(items){toolbars.push(createToolbar(items,size));return true}}if(tinymce.isArray(settings.toolbar)){if(settings.toolbar.length===0){return}tinymce.each(settings.toolbar,function(toolbar,i){settings["toolbar"+(i+1)]=toolbar});delete settings.toolbar}for(var i=1;i<10;i++){if(!addToolbar(settings["toolbar"+i])){break}}if(!toolbars.length&&settings.toolbar!==false){addToolbar(settings.toolbar||defaultToolbar)}if(toolbars.length){return{type:"panel",layout:"stack",classes:"toolbar-grp",ariaRoot:true,ariaRemember:true,items:toolbars}}}function createMenuButtons(){var name,menuButtons=[];function createMenuItem(name){var menuItem;if(name=="|"){return{text:"|"}}menuItem=editor.menuItems[name];return menuItem}function createMenu(context){var menuButton,menu,menuItems,isUserDefined,removedMenuItems;removedMenuItems=tinymce.makeMap((settings.removed_menuitems||"").split(/[ ,]/));if(settings.menu){menu=settings.menu[context];isUserDefined=true}else{menu=defaultMenus[context]}if(menu){menuButton={text:menu.title};menuItems=[];each((menu.items||"").split(/[ ,]/),function(item){var menuItem=createMenuItem(item);if(menuItem&&!removedMenuItems[item]){menuItems.push(createMenuItem(item))}});if(!isUserDefined){each(editor.menuItems,function(menuItem){if(menuItem.context==context){if(menuItem.separator=="before"){menuItems.push({text:"|"})}if(menuItem.prependToContext){menuItems.unshift(menuItem)}else{menuItems.push(menuItem)}if(menuItem.separator=="after"){menuItems.push({text:"|"})}}})}for(var i=0;i<menuItems.length;i++){if(menuItems[i].text=="|"){if(i===0||i==menuItems.length-1){menuItems.splice(i,1)}}}menuButton.menu=menuItems;if(!menuButton.menu.length){return null}}return menuButton}var defaultMenuBar=[];if(settings.menu){for(name in settings.menu){defaultMenuBar.push(name)}}else{for(name in defaultMenus){defaultMenuBar.push(name)}}var enabledMenuNames=typeof settings.menubar=="string"?settings.menubar.split(/[ ,]/):defaultMenuBar;for(var i=0;i<enabledMenuNames.length;i++){var menu=enabledMenuNames[i];menu=createMenu(menu);if(menu){menuButtons.push(menu)}}return menuButtons}function addAccessibilityKeys(panel){function focus(type){var item=panel.find(type)[0];if(item){item.focus(true)}}editor.shortcuts.add("Alt+F9","",function(){focus("menubar")});editor.shortcuts.add("Alt+F10","",function(){focus("toolbar")});editor.shortcuts.add("Alt+F11","",function(){focus("elementpath")});panel.on("cancel",function(){editor.focus()})}function resizeTo(width,height){var containerElm,iframeElm,containerSize,iframeSize;function getSize(elm){return{width:elm.clientWidth,height:elm.clientHeight}}containerElm=editor.getContainer();iframeElm=editor.getContentAreaContainer().firstChild;containerSize=getSize(containerElm);iframeSize=getSize(iframeElm);if(width!==null){width=Math.max(settings.min_width||100,width);width=Math.min(settings.max_width||65535,width);DOM.setStyle(containerElm,"width",width+(containerSize.width-iframeSize.width));DOM.setStyle(iframeElm,"width",width)}height=Math.max(settings.min_height||100,height);height=Math.min(settings.max_height||65535,height);DOM.setStyle(iframeElm,"height",height);editor.fire("ResizeEditor")}function resizeBy(dw,dh){var elm=editor.getContentAreaContainer();self.resizeTo(elm.clientWidth+dw,elm.clientHeight+dh)}function addContextualToolbars(){var scrollContainer;function getContextToolbars(){return editor.contextToolbars||[]}function getElementRect(elm){var pos,targetRect,root;pos=tinymce.DOM.getPos(editor.getContentAreaContainer());targetRect=editor.dom.getRect(elm);root=editor.dom.getRoot();if(root.nodeName=="BODY"){targetRect.x-=root.ownerDocument.documentElement.scrollLeft||root.scrollLeft;targetRect.y-=root.ownerDocument.documentElement.scrollTop||root.scrollTop}targetRect.x+=pos.x;targetRect.y+=pos.y;return targetRect}function hideAllFloatingPanels(){each(editor.contextToolbars,function(toolbar){if(toolbar.panel){toolbar.panel.hide()}})}function togglePositionClass(panel,relPos,predicate){relPos=relPos?relPos.substr(0,2):"";each({t:"down",b:"up"},function(cls,pos){panel.classes.toggle("arrow-"+cls,predicate(pos,relPos.substr(0,1)))});each({l:"left",r:"right"},function(cls,pos){panel.classes.toggle("arrow-"+cls,predicate(pos,relPos.substr(1,1)))})}function toClientRect(geomRect){return{left:geomRect.x,top:geomRect.y,width:geomRect.w,height:geomRect.h,right:geomRect.x+geomRect.w,bottom:geomRect.y+geomRect.h}}function userConstrain(x,y,elementRect,contentAreaRect,panelRect){panelRect=toClientRect({x:x,y:y,w:panelRect.w,h:panelRect.h});if(settings.inline_toolbar_position_handler){panelRect=settings.inline_toolbar_position_handler({elementRect:toClientRect(elementRect),contentAreaRect:toClientRect(contentAreaRect),panelRect:panelRect})}return panelRect}function movePanelTo(panel,pos){panel.moveTo(pos.left,pos.top)}function reposition(match){var relPos,panelRect,elementRect,contentAreaRect,panel,relRect,testPositions;if(editor.removed){return}if(!match||!match.toolbar.panel){hideAllFloatingPanels();return}testPositions=["bc-tc","tc-bc","tl-bl","bl-tl","tr-br","br-tr"];panel=match.toolbar.panel;panel.show();elementRect=getElementRect(match.element);panelRect=tinymce.DOM.getRect(panel.getEl());contentAreaRect=tinymce.DOM.getRect(editor.getContentAreaContainer()||editor.getBody());elementRect.w=match.element.clientWidth;elementRect.h=match.element.clientHeight;if(!editor.inline){contentAreaRect.w=editor.getDoc().documentElement.offsetWidth}if(editor.selection.controlSelection.isResizable(match.element)){elementRect=Rect.inflate(elementRect,0,8)}relPos=Rect.findBestRelativePosition(panelRect,elementRect,contentAreaRect,testPositions);elementRect=Rect.clamp(elementRect,contentAreaRect);if(relPos){relRect=Rect.relativePosition(panelRect,elementRect,relPos);movePanelTo(panel,userConstrain(relRect.x,relRect.y,elementRect,contentAreaRect,panelRect))}else{contentAreaRect.h+=40;elementRect=Rect.intersect(contentAreaRect,elementRect);if(elementRect){relPos=Rect.findBestRelativePosition(panelRect,elementRect,contentAreaRect,["bc-tc","bl-tl","br-tr"]);if(relPos){relRect=Rect.relativePosition(panelRect,elementRect,relPos);movePanelTo(panel,userConstrain(relRect.x,relRect.y,elementRect,contentAreaRect,panelRect))}else{movePanelTo(panel,userConstrain(elementRect.x,elementRect.y,elementRect,contentAreaRect,panelRect))}}else{panel.hide()}}togglePositionClass(panel,relPos,function(pos1,pos2){return(!elementRect||elementRect.w>40)&&pos1===pos2})}function repositionHandler(){function execute(){if(editor.selection){reposition(findFrontMostMatch(editor.selection.getNode()))}}tinymce.util.Delay.requestAnimationFrame(execute)}function bindScrollEvent(){if(!scrollContainer){scrollContainer=editor.selection.getScrollContainer()||editor.getWin();tinymce.$(scrollContainer).on("scroll",repositionHandler);editor.on("remove",function(){tinymce.$(scrollContainer).off("scroll")})}}function showContextToolbar(match){var panel;if(match.toolbar.panel){match.toolbar.panel.show();reposition(match);return}bindScrollEvent();panel=Factory.create({type:"floatpanel",role:"dialog",classes:"tinymce tinymce-inline arrow",ariaLabel:"Inline toolbar",layout:"flex",direction:"column",align:"stretch",autohide:false,autofix:true,fixed:true,border:1,items:createToolbar(match.toolbar.items),oncancel:function(){editor.focus()}});match.toolbar.panel=panel;panel.renderTo(document.body).reflow();reposition(match)}function hideAllContextToolbars(){tinymce.each(getContextToolbars(),function(toolbar){if(toolbar.panel){toolbar.panel.hide()}})}function findFrontMostMatch(targetElm){var i,y,parentsAndSelf,toolbars=getContextToolbars();parentsAndSelf=editor.$(targetElm).parents().add(targetElm);for(i=parentsAndSelf.length-1;i>=0;i--){for(y=toolbars.length-1;y>=0;y--){if(toolbars[y].predicate(parentsAndSelf[i])){return{toolbar:toolbars[y],element:parentsAndSelf[i]}}}}return null}editor.on("click keyup setContent",function(e){if(e.type=="setcontent"&&!e.selection){return}tinymce.util.Delay.setEditorTimeout(editor,function(){var match;match=findFrontMostMatch(editor.selection.getNode());if(match){hideAllContextToolbars();showContextToolbar(match)}else{hideAllContextToolbars()}})});editor.on("blur hide",hideAllContextToolbars);editor.on("ObjectResizeStart",function(){var match=findFrontMostMatch(editor.selection.getNode());if(match&&match.toolbar.panel){match.toolbar.panel.hide()}});editor.on("nodeChange ResizeEditor ResizeWindow",repositionHandler);editor.on("remove",function(){tinymce.each(getContextToolbars(),function(toolbar){if(toolbar.panel){toolbar.panel.remove()}});editor.contextToolbars={}});editor.shortcuts.add("ctrl+shift+e > ctrl+shift+p","",function(){var match=findFrontMostMatch(editor.selection.getNode());if(match&&match.toolbar.panel){match.toolbar.panel.items()[0].focus()}})}function fireSkinLoaded(editor){return function(){if(editor.initialized){editor.fire("SkinLoaded")}else{editor.on("init",function(){editor.fire("SkinLoaded")})}}}function renderInlineUI(args){var panel,inlineToolbarContainer;if(settings.fixed_toolbar_container){inlineToolbarContainer=DOM.select(settings.fixed_toolbar_container)[0]}function reposition(){if(panel&&panel.moveRel&&panel.visible()&&!panel._fixed){var scrollContainer=editor.selection.getScrollContainer(),body=editor.getBody();var deltaX=0,deltaY=0;if(scrollContainer){var bodyPos=DOM.getPos(body),scrollContainerPos=DOM.getPos(scrollContainer);deltaX=Math.max(0,scrollContainerPos.x-bodyPos.x);deltaY=Math.max(0,scrollContainerPos.y-bodyPos.y)}panel.fixed(false).moveRel(body,editor.rtl?["tr-br","br-tr"]:["tl-bl","bl-tl","tr-br"]).moveBy(deltaX,deltaY)}}function show(){if(panel){panel.show();reposition();DOM.addClass(editor.getBody(),"mce-edit-focus")}}function hide(){if(panel){panel.hide();FloatPanel.hideAll();DOM.removeClass(editor.getBody(),"mce-edit-focus")}}function render(){if(panel){if(!panel.visible()){show()}return}panel=self.panel=Factory.create({type:inlineToolbarContainer?"panel":"floatpanel",role:"application",classes:"tinymce tinymce-inline",layout:"flex",direction:"column",align:"stretch",autohide:false,autofix:true,fixed:!!inlineToolbarContainer,border:1,items:[settings.menubar===false?null:{type:"menubar",border:"0 0 1 0",items:createMenuButtons()},createToolbars(settings.toolbar_items_size)]});editor.fire("BeforeRenderUI");panel.renderTo(inlineToolbarContainer||document.body).reflow();addAccessibilityKeys(panel);show();addContextualToolbars();editor.on("nodeChange",reposition);editor.on("activate",show);editor.on("deactivate",hide);editor.nodeChanged()}settings.content_editable=true;editor.on("focus",function(){if(args.skinUiCss){tinymce.DOM.styleSheetLoader.load(args.skinUiCss,render,render)}else{render()}});editor.on("blur hide",hide);editor.on("remove",function(){if(panel){panel.remove();panel=null}});if(args.skinUiCss){tinymce.DOM.styleSheetLoader.load(args.skinUiCss,fireSkinLoaded(editor))}return{}}function renderIframeUI(args){var panel,resizeHandleCtrl,startSize;function switchMode(){return function(e){if(e.mode=="readonly"){panel.find("*").disabled(true)}else{panel.find("*").disabled(false)}}}if(args.skinUiCss){tinymce.DOM.styleSheetLoader.load(args.skinUiCss,fireSkinLoaded(editor))}panel=self.panel=Factory.create({type:"panel",role:"application",classes:"tinymce",style:"visibility: hidden",layout:"stack",border:1,items:[settings.menubar===false?null:{type:"menubar",border:"0 0 1 0",items:createMenuButtons()},createToolbars(settings.toolbar_items_size),{type:"panel",name:"iframe",layout:"stack",classes:"edit-area",html:"",border:"1 0 0 0"}]});if(settings.resize!==false){resizeHandleCtrl={type:"resizehandle",direction:settings.resize,onResizeStart:function(){var elm=editor.getContentAreaContainer().firstChild;startSize={width:elm.clientWidth,height:elm.clientHeight}},onResize:function(e){if(settings.resize=="both"){resizeTo(startSize.width+e.deltaX,startSize.height+e.deltaY)}else{resizeTo(null,startSize.height+e.deltaY)}}}}if(settings.statusbar!==false){panel.add({type:"panel",name:"statusbar",classes:"statusbar",layout:"flow",border:"1 0 0 0",ariaRoot:true,items:[{type:"elementpath"},resizeHandleCtrl]})}editor.fire("BeforeRenderUI");editor.on("SwitchMode",switchMode());panel.renderBefore(args.targetNode).reflow();if(settings.readonly){editor.setMode("readonly")}if(settings.width){tinymce.DOM.setStyle(panel.getEl(),"width",settings.width)}editor.on("remove",function(){panel.remove();panel=null});addAccessibilityKeys(panel);addContextualToolbars();return{iframeContainer:panel.find("#iframe")[0].getEl(),editorContainer:panel.getEl()}}self.renderUI=function(args){var skin=settings.skin!==false?settings.skin||"lightgray":false;if(skin){var skinUrl=settings.skin_url;if(skinUrl){skinUrl=editor.documentBaseURI.toAbsolute(skinUrl)}else{skinUrl=tinymce.baseURL+"/skins/"+skin}if(tinymce.Env.documentMode<=7){args.skinUiCss=skinUrl+"/skin.ie7.min.css"}else{args.skinUiCss=skinUrl+"/skin.min.css"}editor.contentCSS.push(skinUrl+"/content"+(editor.inline?".inline":"")+".min.css")}editor.on("ProgressState",function(e){self.throbber=self.throbber||new tinymce.ui.Throbber(self.panel.getEl("body"));if(e.state){self.throbber.show(e.time)}else{self.throbber.hide()}});if(settings.inline){return renderInlineUI(args)}return renderIframeUI(args)};self.resizeTo=resizeTo;self.resizeBy=resizeBy})}).call(window)},3492:function(module,exports,__webpack_require__){var basePropertyOf=__webpack_require__(850);var htmlUnescapes={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#96;":"`"};var unescapeHtmlChar=basePropertyOf(htmlUnescapes);module.exports=unescapeHtmlChar},3522:function(module,exports,__webpack_require__){var toString=__webpack_require__(68),unescapeHtmlChar=__webpack_require__(3492);var reEscapedHtml=/&(?:amp|lt|gt|quot|#39|#96);/g,reHasEscapedHtml=RegExp(reEscapedHtml.source);function unescape(string){string=toString(string);return string&&reHasEscapedHtml.test(string)?string.replace(reEscapedHtml,unescapeHtmlChar):string}module.exports=unescape},3541:function(module,exports,__webpack_require__){var DayPicker=__webpack_require__(3544);var DateUtils=__webpack_require__(2212);var LocaleUtils=__webpack_require__(2213);var Weekday=__webpack_require__(2427);var Navbar=__webpack_require__(2426);var PropTypes=__webpack_require__(1833);module.exports=DayPicker.default||DayPicker;module.exports.DateUtils=DateUtils.default||DateUtils;module.exports.LocaleUtils=LocaleUtils.default||LocaleUtils;module.exports.WeekdayPropTypes=Weekday.WeekdayPropTypes;module.exports.NavbarPropTypes=Navbar.NavbarPropTypes;module.exports.PropTypes=PropTypes},3542:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=Caption;var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _PropTypes=__webpack_require__(1833);var _PropTypes2=_interopRequireDefault(_PropTypes);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function Caption(_ref){var date=_ref.date;var locale=_ref.locale;var localeUtils=_ref.localeUtils;var onClick=_ref.onClick;return _react2.default.createElement("div",{className:"DayPicker-Caption",onClick:onClick,role:"heading"},localeUtils.formatMonthTitle(date,locale))}Caption.propTypes={date:_react.PropTypes.instanceOf(Date),locale:_react.PropTypes.string,localeUtils:_PropTypes2.default.localeUtils,onClick:_react.PropTypes.func}},3543:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=Day;var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function handleEvent(handler,day,modifiers){if(!handler){return undefined}var dayState={};modifiers.forEach(function(modifier){dayState[modifier]=true});return function(e){e.persist();handler(e,day,dayState)}}function Day(_ref){var day=_ref.day;var tabIndex=_ref.tabIndex;var empty=_ref.empty;var modifiers=_ref.modifiers;var onMouseEnter=_ref.onMouseEnter;var onMouseLeave=_ref.onMouseLeave;var onClick=_ref.onClick;var onKeyDown=_ref.onKeyDown;var onTouchStart=_ref.onTouchStart;var onTouchEnd=_ref.onTouchEnd;var onFocus=_ref.onFocus;var ariaLabel=_ref.ariaLabel;var ariaDisabled=_ref.ariaDisabled;var ariaSelected=_ref.ariaSelected;var children=_ref.children;var className="DayPicker-Day";className+=modifiers.map(function(modifier){return" "+className+"--"+modifier}).join("");if(empty){return _react2.default.createElement("div",{role:"gridcell","aria-disabled":true,className:className})}return _react2.default.createElement("div",{className:className,tabIndex:tabIndex,role:"gridcell","aria-label":ariaLabel,"aria-disabled":ariaDisabled.toString(),"aria-selected":ariaSelected.toString(),onClick:handleEvent(onClick,day,modifiers),onKeyDown:handleEvent(onKeyDown,day,modifiers),onMouseEnter:handleEvent(onMouseEnter,day,modifiers),onMouseLeave:handleEvent(onMouseLeave,day,modifiers),onTouchEnd:handleEvent(onTouchEnd,day,modifiers),onTouchStart:handleEvent(onTouchStart,day,modifiers),onFocus:handleEvent(onFocus,day,modifiers)},children)}Day.propTypes={day:_react.PropTypes.instanceOf(Date).isRequired,children:_react.PropTypes.node.isRequired,ariaDisabled:_react.PropTypes.bool,ariaLabel:_react.PropTypes.string,ariaSelected:_react.PropTypes.bool,empty:_react.PropTypes.bool,modifiers:_react.PropTypes.array,onClick:_react.PropTypes.func,onKeyDown:_react.PropTypes.func,onMouseEnter:_react.PropTypes.func,onMouseLeave:_react.PropTypes.func,onTouchEnd:_react.PropTypes.func,onTouchStart:_react.PropTypes.func,onFocus:_react.PropTypes.func,tabIndex:_react.PropTypes.number};Day.defaultProps={modifiers:[],empty:false}},3544:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactIsDeprecated=__webpack_require__(3548);var _Caption=__webpack_require__(3542);var _Caption2=_interopRequireDefault(_Caption);var _Navbar=__webpack_require__(2426);var _Navbar2=_interopRequireDefault(_Navbar);var _Month=__webpack_require__(3545);var _Month2=_interopRequireDefault(_Month);var _Day=__webpack_require__(3543);var _Day2=_interopRequireDefault(_Day);var _Weekday=__webpack_require__(2427);var _Weekday2=_interopRequireDefault(_Weekday);var _Helpers=__webpack_require__(2425);var Helpers=_interopRequireWildcard(_Helpers);var _DateUtils=__webpack_require__(2212);var DateUtils=_interopRequireWildcard(_DateUtils);var _LocaleUtils=__webpack_require__(2213);var LocaleUtils=_interopRequireWildcard(_LocaleUtils);var _keys=__webpack_require__(3547);var _keys2=_interopRequireDefault(_keys);var _PropTypes=__webpack_require__(1833);var _PropTypes2=_interopRequireDefault(_PropTypes);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key];
}}newObj.default=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DayPicker=function(_Component){_inherits(DayPicker,_Component);function DayPicker(props){_classCallCheck(this,DayPicker);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(DayPicker).call(this,props));_initialiseProps.call(_this);_this.renderDayInMonth=_this.renderDayInMonth.bind(_this);_this.showNextMonth=_this.showNextMonth.bind(_this);_this.showPreviousMonth=_this.showPreviousMonth.bind(_this);_this.handleKeyDown=_this.handleKeyDown.bind(_this);_this.handleDayClick=_this.handleDayClick.bind(_this);_this.handleDayKeyDown=_this.handleDayKeyDown.bind(_this);_this.state=_this.getStateFromProps(props);return _this}_createClass(DayPicker,[{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){if(this.props.initialMonth!==nextProps.initialMonth){this.setState(this.getStateFromProps(nextProps))}}},{key:"getModifiersFromProps",value:function getModifiersFromProps(props){var modifiers=_extends({},props.modifiers);if(props.selectedDays){modifiers.selected=props.selectedDays}if(props.disabledDays){modifiers.disabled=props.disabledDays}return modifiers}},{key:"getDayNodes",value:function getDayNodes(){return this.refs.dayPicker.querySelectorAll(".DayPicker-Day:not(.DayPicker-Day--outside)")}},{key:"getNextNavigableMonth",value:function getNextNavigableMonth(){return DateUtils.addMonths(this.state.currentMonth,this.props.numberOfMonths)}},{key:"getPreviousNavigableMonth",value:function getPreviousNavigableMonth(){return DateUtils.addMonths(this.state.currentMonth,-1)}},{key:"allowPreviousMonth",value:function allowPreviousMonth(){var previousMonth=DateUtils.addMonths(this.state.currentMonth,-1);return this.allowMonth(previousMonth)}},{key:"allowNextMonth",value:function allowNextMonth(){var nextMonth=DateUtils.addMonths(this.state.currentMonth,this.props.numberOfMonths);return this.allowMonth(nextMonth)}},{key:"allowMonth",value:function allowMonth(d){var _props=this.props;var fromMonth=_props.fromMonth;var toMonth=_props.toMonth;var canChangeMonth=_props.canChangeMonth;if(!canChangeMonth||fromMonth&&Helpers.getMonthsDiff(fromMonth,d)<0||toMonth&&Helpers.getMonthsDiff(toMonth,d)>0){return false}return true}},{key:"allowYearChange",value:function allowYearChange(){return this.props.canChangeMonth}},{key:"showMonth",value:function showMonth(d,callback){var _this2=this;if(!this.allowMonth(d)){return}this.setState({currentMonth:Helpers.startOfMonth(d)},function(){if(callback){callback()}if(_this2.props.onMonthChange){_this2.props.onMonthChange(_this2.state.currentMonth)}})}},{key:"showNextMonth",value:function showNextMonth(callback){if(!this.allowNextMonth()){return}var deltaMonths=this.props.pagedNavigation?this.props.numberOfMonths:1;var nextMonth=DateUtils.addMonths(this.state.currentMonth,deltaMonths);this.showMonth(nextMonth,callback)}},{key:"showPreviousMonth",value:function showPreviousMonth(callback){if(!this.allowPreviousMonth()){return}var deltaMonths=this.props.pagedNavigation?this.props.numberOfMonths:1;var previousMonth=DateUtils.addMonths(this.state.currentMonth,-deltaMonths);this.showMonth(previousMonth,callback)}},{key:"showNextYear",value:function showNextYear(){if(!this.allowYearChange()){return}var nextMonth=DateUtils.addMonths(this.state.currentMonth,12);this.showMonth(nextMonth)}},{key:"showPreviousYear",value:function showPreviousYear(){if(!this.allowYearChange()){return}var nextMonth=DateUtils.addMonths(this.state.currentMonth,-12);this.showMonth(nextMonth)}},{key:"focusFirstDayOfMonth",value:function focusFirstDayOfMonth(){this.getDayNodes()[0].focus()}},{key:"focusLastDayOfMonth",value:function focusLastDayOfMonth(){var dayNodes=this.getDayNodes();dayNodes[dayNodes.length-1].focus()}},{key:"focusPreviousDay",value:function focusPreviousDay(dayNode){var _this3=this;var dayNodes=this.getDayNodes();var dayNodeIndex=[].concat(_toConsumableArray(dayNodes)).indexOf(dayNode);if(dayNodeIndex===0){this.showPreviousMonth(function(){return _this3.focusLastDayOfMonth()})}else{dayNodes[dayNodeIndex-1].focus()}}},{key:"focusNextDay",value:function focusNextDay(dayNode){var _this4=this;var dayNodes=this.getDayNodes();var dayNodeIndex=[].concat(_toConsumableArray(dayNodes)).indexOf(dayNode);if(dayNodeIndex===dayNodes.length-1){this.showNextMonth(function(){return _this4.focusFirstDayOfMonth()})}else{dayNodes[dayNodeIndex+1].focus()}}},{key:"focusNextWeek",value:function focusNextWeek(dayNode){var _this5=this;var dayNodes=this.getDayNodes();var dayNodeIndex=[].concat(_toConsumableArray(dayNodes)).indexOf(dayNode);var isInLastWeekOfMonth=dayNodeIndex>dayNodes.length-8;if(isInLastWeekOfMonth){this.showNextMonth(function(){var daysAfterIndex=dayNodes.length-dayNodeIndex;var nextMonthDayNodeIndex=7-daysAfterIndex;_this5.getDayNodes()[nextMonthDayNodeIndex].focus()})}else{dayNodes[dayNodeIndex+7].focus()}}},{key:"focusPreviousWeek",value:function focusPreviousWeek(dayNode){var _this6=this;var dayNodes=this.getDayNodes();var dayNodeIndex=[].concat(_toConsumableArray(dayNodes)).indexOf(dayNode);var isInFirstWeekOfMonth=dayNodeIndex<=6;if(isInFirstWeekOfMonth){this.showPreviousMonth(function(){var previousMonthDayNodes=_this6.getDayNodes();var startOfLastWeekOfMonth=previousMonthDayNodes.length-7;var previousMonthDayNodeIndex=startOfLastWeekOfMonth+dayNodeIndex;previousMonthDayNodes[previousMonthDayNodeIndex].focus()})}else{dayNodes[dayNodeIndex-7].focus()}}},{key:"handleKeyDown",value:function handleKeyDown(e){e.persist();switch(e.keyCode){case _keys2.default.LEFT:this.showPreviousMonth();break;case _keys2.default.RIGHT:this.showNextMonth();break;case _keys2.default.UP:this.showPreviousYear();break;case _keys2.default.DOWN:this.showNextYear();break;default:break}if(this.props.onKeyDown){this.props.onKeyDown(e)}}},{key:"handleDayKeyDown",value:function handleDayKeyDown(e,day,modifiers){e.persist();switch(e.keyCode){case _keys2.default.LEFT:Helpers.cancelEvent(e);this.focusPreviousDay(e.target);break;case _keys2.default.RIGHT:Helpers.cancelEvent(e);this.focusNextDay(e.target);break;case _keys2.default.UP:Helpers.cancelEvent(e);this.focusPreviousWeek(e.target);break;case _keys2.default.DOWN:Helpers.cancelEvent(e);this.focusNextWeek(e.target);break;case _keys2.default.ENTER:case _keys2.default.SPACE:Helpers.cancelEvent(e);if(this.props.onDayClick){this.handleDayClick(e,day,modifiers)}break;default:break}if(this.props.onDayKeyDown){this.props.onDayKeyDown(e,day,modifiers)}}},{key:"handleDayClick",value:function handleDayClick(e,day,modifiers){e.persist();if(modifiers.outside){this.handleOutsideDayClick(day)}this.props.onDayClick(e,day,modifiers)}},{key:"handleOutsideDayClick",value:function handleOutsideDayClick(day){var currentMonth=this.state.currentMonth;var numberOfMonths=this.props.numberOfMonths;var diffInMonths=Helpers.getMonthsDiff(currentMonth,day);if(diffInMonths>0&&diffInMonths>=numberOfMonths){this.showNextMonth()}else if(diffInMonths<0){this.showPreviousMonth()}}},{key:"renderNavbar",value:function renderNavbar(){var _props2=this.props;var locale=_props2.locale;var localeUtils=_props2.localeUtils;var canChangeMonth=_props2.canChangeMonth;var navbarComponent=_props2.navbarComponent;var navbarElement=_props2.navbarElement;var attributes=_objectWithoutProperties(_props2,["locale","localeUtils","canChangeMonth","navbarComponent","navbarElement"]);if(!canChangeMonth)return null;var props={className:"DayPicker-NavBar",nextMonth:this.getNextNavigableMonth(),previousMonth:this.getPreviousNavigableMonth(),showPreviousButton:this.allowPreviousMonth(),showNextButton:this.allowNextMonth(),onNextClick:this.showNextMonth,onPreviousClick:this.showPreviousMonth,dir:attributes.dir,locale:locale,localeUtils:localeUtils};if(navbarElement){return _react2.default.cloneElement(navbarElement,props)}return _react2.default.createElement(navbarComponent,props)}},{key:"renderDayInMonth",value:function renderDayInMonth(day,month){var dayModifiers=[];if(DateUtils.isSameDay(day,new Date)){dayModifiers.push("today")}if(day.getMonth()!==month.getMonth()){dayModifiers.push("outside")}dayModifiers=[].concat(_toConsumableArray(dayModifiers),_toConsumableArray(Helpers.getModifiersForDay(day,this.getModifiersFromProps(this.props))));var isOutside=day.getMonth()!==month.getMonth();var tabIndex=null;if(this.props.onDayClick&&!isOutside){tabIndex=-1;if(day.getDate()===1){tabIndex=this.props.tabIndex}}var key=""+day.getFullYear()+day.getMonth()+day.getDate();return _react2.default.createElement(_Day2.default,{key:""+(isOutside?"outside-":"")+key,day:day,modifiers:dayModifiers,empty:isOutside&&!this.props.enableOutsideDays&&!this.props.fixedWeeks,tabIndex:tabIndex,ariaLabel:this.props.localeUtils.formatDay(day,this.props.locale),ariaDisabled:isOutside||dayModifiers.indexOf("disabled")>-1,ariaSelected:dayModifiers.indexOf("selected")>-1,onMouseEnter:this.props.onDayMouseEnter,onMouseLeave:this.props.onDayMouseLeave,onKeyDown:this.handleDayKeyDown,onTouchStart:this.props.onDayTouchStart,onTouchEnd:this.props.onDayTouchEnd,onFocus:this.props.onDayFocus,onClick:this.props.onDayClick?this.handleDayClick:undefined},this.props.renderDay(day))}},{key:"renderMonths",value:function renderMonths(){var months=[];var firstDayOfWeek=this.props.localeUtils.getFirstDayOfWeek(this.props.locale);for(var i=0;i<this.props.numberOfMonths;i++){var month=DateUtils.addMonths(this.state.currentMonth,i);months.push(_react2.default.createElement(_Month2.default,{key:i,month:month,locale:this.props.locale,localeUtils:this.props.localeUtils,firstDayOfWeek:firstDayOfWeek,fixedWeeks:this.props.fixedWeeks,className:"DayPicker-Month",wrapperClassName:"DayPicker-Body",weekClassName:"DayPicker-Week",weekdayComponent:this.props.weekdayComponent,weekdayElement:this.props.weekdayElement,captionElement:this.props.captionElement,onCaptionClick:this.props.onCaptionClick},this.renderDayInMonth))}if(this.props.reverseMonths){months.reverse()}return months}},{key:"render",value:function render(){var customProps=Helpers.getCustomProps(this.props,DayPicker.propTypes);var className="DayPicker DayPicker--"+this.props.locale;if(!this.props.onDayClick){className=className+" DayPicker--interactionDisabled"}if(this.props.className){className=className+" "+this.props.className}return _react2.default.createElement("div",_extends({},customProps,{className:className,ref:"dayPicker",role:"application",tabIndex:this.props.canChangeMonth&&this.props.tabIndex,onKeyDown:this.handleKeyDown}),this.renderNavbar(),this.renderMonths())}}]);return DayPicker}(_react.Component);DayPicker.VERSION="2.3.3";DayPicker.propTypes={initialMonth:_react.PropTypes.instanceOf(Date),numberOfMonths:_react.PropTypes.number,selectedDays:_react.PropTypes.func,disabledDays:_react.PropTypes.func,modifiers:_react.PropTypes.object,locale:_react.PropTypes.string,localeUtils:_PropTypes2.default.localeUtils,enableOutsideDays:_react.PropTypes.bool,fixedWeeks:_react.PropTypes.bool,canChangeMonth:_react.PropTypes.bool,reverseMonths:_react.PropTypes.bool,pagedNavigation:_react.PropTypes.bool,fromMonth:_react.PropTypes.instanceOf(Date),toMonth:_react.PropTypes.instanceOf(Date),onKeyDown:_react.PropTypes.func,onDayClick:_react.PropTypes.func,onDayKeyDown:_react.PropTypes.func,onDayMouseEnter:_react.PropTypes.func,onDayMouseLeave:_react.PropTypes.func,onDayTouchStart:_react.PropTypes.func,onDayTouchEnd:_react.PropTypes.func,onDayFocus:_react.PropTypes.func,onMonthChange:_react.PropTypes.func,onCaptionClick:_react.PropTypes.func,renderDay:_react.PropTypes.func,weekdayComponent:(0,_reactIsDeprecated.deprecate)(_react.PropTypes.func,"react-day-picker: the `weekdayComponent` prop is deprecated from v2.3. Please pass a React element to the `weekdayElement` prop instead."),weekdayElement:_react.PropTypes.element,navbarComponent:(0,_reactIsDeprecated.deprecate)(_react.PropTypes.func,"react-day-picker: the `navbarComponent` prop is deprecated from v2.3. Please pass a React element to the `navbarElement` prop instead."),navbarElement:_react.PropTypes.element,captionElement:_react.PropTypes.element,dir:_react.PropTypes.string,className:_react.PropTypes.string,tabIndex:_react.PropTypes.number};DayPicker.defaultProps={tabIndex:0,initialMonth:new Date,numberOfMonths:1,locale:"en",localeUtils:LocaleUtils,enableOutsideDays:false,fixedWeeks:false,canChangeMonth:true,reverseMonths:false,pagedNavigation:false,renderDay:function renderDay(day){return day.getDate()},weekdayElement:_react2.default.createElement(_Weekday2.default,null),navbarElement:_react2.default.createElement(_Navbar2.default,null),captionElement:_react2.default.createElement(_Caption2.default,null)};var _initialiseProps=function _initialiseProps(){this.getStateFromProps=function(props){var initialMonth=Helpers.startOfMonth(props.initialMonth);var currentMonth=initialMonth;if(props.pagedNavigation&&props.numberOfMonths>1&&props.fromMonth){var diffInMonths=Helpers.getMonthsDiff(props.fromMonth,currentMonth);currentMonth=DateUtils.addMonths(props.fromMonth,Math.floor(diffInMonths/props.numberOfMonths)*props.numberOfMonths)}return{currentMonth:currentMonth}}};exports.default=DayPicker},3545:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=Month;var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _PropTypes=__webpack_require__(1833);var _PropTypes2=_interopRequireDefault(_PropTypes);var _Weekdays=__webpack_require__(3546);var _Weekdays2=_interopRequireDefault(_Weekdays);var _Helpers=__webpack_require__(2425);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function Month(_ref){var month=_ref.month;var locale=_ref.locale;var localeUtils=_ref.localeUtils;var captionElement=_ref.captionElement;var onCaptionClick=_ref.onCaptionClick;var children=_ref.children;var firstDayOfWeek=_ref.firstDayOfWeek;var className=_ref.className;var wrapperClassName=_ref.wrapperClassName;var weekClassName=_ref.weekClassName;var weekdayComponent=_ref.weekdayComponent;var weekdayElement=_ref.weekdayElement;var fixedWeeks=_ref.fixedWeeks;var captionProps={date:month,localeUtils:localeUtils,locale:locale,onClick:onCaptionClick?function(e){return onCaptionClick(e,month)}:undefined};var weeks=(0,_Helpers.getWeekArray)(month,firstDayOfWeek,fixedWeeks);return _react2.default.createElement("div",{className:className},_react2.default.cloneElement(captionElement,captionProps),_react2.default.createElement(_Weekdays2.default,{locale:locale,localeUtils:localeUtils,weekdayComponent:weekdayComponent,weekdayElement:weekdayElement}),_react2.default.createElement("div",{className:wrapperClassName,role:"grid"},weeks.map(function(week,j){return _react2.default.createElement("div",{key:j,className:weekClassName,role:"gridcell"},week.map(function(day){return children(day,month)}))})))}Month.propTypes={month:_react.PropTypes.instanceOf(Date).isRequired,captionElement:_react.PropTypes.node.isRequired,firstDayOfWeek:_react.PropTypes.number.isRequired,locale:_react.PropTypes.string.isRequired,localeUtils:_PropTypes2.default.localeUtils.isRequired,onCaptionClick:_react.PropTypes.func,children:_react.PropTypes.func.isRequired,className:_react.PropTypes.string,wrapperClassName:_react.PropTypes.string,weekClassName:_react.PropTypes.string,weekdayComponent:_react.PropTypes.func,weekdayElement:_react.PropTypes.element,fixedWeeks:_react.PropTypes.bool}},3546:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=Weekdays;var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _PropTypes=__webpack_require__(1833);var _PropTypes2=_interopRequireDefault(_PropTypes);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function Weekdays(_ref){var locale=_ref.locale;var localeUtils=_ref.localeUtils;var weekdayComponent=_ref.weekdayComponent;var weekdayElement=_ref.weekdayElement;var days=[];for(var i=0;i<7;i++){var elementProps={key:i,className:"DayPicker-Weekday",weekday:i,localeUtils:localeUtils,locale:locale};var element=weekdayElement?_react2.default.cloneElement(weekdayElement,elementProps):_react2.default.createElement(weekdayComponent,elementProps);days.push(element)}return _react2.default.createElement("div",{className:"DayPicker-Weekdays",role:"rowgroup"},_react2.default.createElement("div",{className:"DayPicker-WeekdaysRow",role:"columnheader"},days))}Weekdays.propTypes={locale:_react.PropTypes.string.isRequired,localeUtils:_PropTypes2.default.localeUtils.isRequired,weekdayComponent:_react.PropTypes.func,weekdayElement:_react.PropTypes.element}},3547:function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={LEFT:37,UP:38,RIGHT:39,DOWN:40,ENTER:13,SPACE:32}},3548:function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};exports.deprecate=deprecate;exports.addIsDeprecated=addIsDeprecated;function deprecate(propType,message){var warned=false;return function(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}var props=args[0];var propName=args[1];var prop=props[propName];if(prop!==undefined&&prop!==null&&!warned){warned=true;console.warn(message)}return propType.call.apply(propType,[this].concat(args))}}function addIsDeprecated(PropTypes){var newPropTypes=_extends({},PropTypes);for(var type in newPropTypes){if(newPropTypes.hasOwnProperty(type)){var propType=newPropTypes[type];propType=propType.bind(newPropTypes);propType.isDeprecated=deprecate.bind(newPropTypes,propType);newPropTypes[type]=propType}}return newPropTypes}},3550:function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)subClass.__proto__=superClass}var _function=__webpack_require__(867);var _function2=_interopRequireDefault(_function);var _react=__webpack_require__(1);var PureComponent=function(_Component){function PureComponent(){_classCallCheck(this,PureComponent);if(_Component!=null){_Component.apply(this,arguments)}}_inherits(PureComponent,_Component);return PureComponent}(_react.Component);exports["default"]=PureComponent;PureComponent.prototype.shouldComponentUpdate=_function2["default"];module.exports=exports["default"]},3553:function(module,exports,__webpack_require__){"use strict";var ReactDefaultInjection=__webpack_require__(870);var ReactServerRendering=__webpack_require__(3555);var ReactVersion=__webpack_require__(448);ReactDefaultInjection.inject();var ReactDOMServer={renderToString:ReactServerRendering.renderToString,renderToStaticMarkup:ReactServerRendering.renderToStaticMarkup,version:ReactVersion};module.exports=ReactDOMServer},3554:function(module,exports){"use strict";var ReactServerBatchingStrategy={isBatchingUpdates:false,batchedUpdates:function(callback){}};module.exports=ReactServerBatchingStrategy},3555:function(module,exports,__webpack_require__){"use strict";var _prodInvariant=__webpack_require__(17);var ReactDOMContainerInfo=__webpack_require__(868);var ReactDefaultBatchingStrategy=__webpack_require__(869);var ReactElement=__webpack_require__(74);var ReactInstrumentation=__webpack_require__(60);var ReactMarkupChecksum=__webpack_require__(871);var ReactReconciler=__webpack_require__(149);var ReactServerBatchingStrategy=__webpack_require__(3554);var ReactServerRenderingTransaction=__webpack_require__(872);var ReactUpdates=__webpack_require__(85);var emptyObject=__webpack_require__(184);var instantiateReactComponent=__webpack_require__(449);var invariant=__webpack_require__(14);var pendingTransactions=0;function renderToStringImpl(element,makeStaticMarkup){var transaction;try{ReactUpdates.injection.injectBatchingStrategy(ReactServerBatchingStrategy);transaction=ReactServerRenderingTransaction.getPooled(makeStaticMarkup);pendingTransactions++;return transaction.perform(function(){var componentInstance=instantiateReactComponent(element,true);var markup=ReactReconciler.mountComponent(componentInstance,transaction,null,ReactDOMContainerInfo(),emptyObject);if(false){ReactInstrumentation.debugTool.onUnmountComponent(componentInstance._debugID)}if(!makeStaticMarkup){markup=ReactMarkupChecksum.addChecksumToMarkup(markup)}return markup},null)}finally{pendingTransactions--;ReactServerRenderingTransaction.release(transaction);if(!pendingTransactions){ReactUpdates.injection.injectBatchingStrategy(ReactDefaultBatchingStrategy)}}}function renderToString(element){!ReactElement.isValidElement(element)?false?invariant(false,"renderToString(): You must pass a valid ReactElement."):_prodInvariant("46"):void 0;return renderToStringImpl(element,false)}function renderToStaticMarkup(element){!ReactElement.isValidElement(element)?false?invariant(false,"renderToStaticMarkup(): You must pass a valid ReactElement."):_prodInvariant("47"):void 0;return renderToStringImpl(element,true)}module.exports={renderToString:renderToString,renderToStaticMarkup:renderToStaticMarkup}}});