webpackJsonp([1],{825:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(){(0,_pageNotifier2.default)(function removeFullPostOnLeave(newContext,oldContext){var fullPostViewRegex=/^\/read\/(blogs|feeds)\/([0-9]+)\/posts\/([0-9]+)$/i;if((!oldContext||oldContext.path.match(fullPostViewRegex))&&!newContext.path.match(fullPostViewRegex)){newContext.store.dispatch((0,_actions.hideReaderFullPost)())}});if(useRefresh===null){useRefresh=_config2.default.isEnabled("reader/refresh/force-full-post")||_config2.default.isEnabled("reader/refresh/full-post-ab-test")&&(0,_abtest.abtest)("readerFullPost")==="refreshed"}(0,_page2.default)("/read/post/feed/:feed_id/:post_id",_controller3.default.legacyRedirects);(0,_page2.default)("/read/feeds/:feed/posts/:post",_controller3.default.updateLastRoute,useRefresh?_controller3.default.unmountSidebar:_controller3.default.sidebar,useRefresh?_controller.feedPostNew:_controller.feedPost);_page2.default.exit("/read/feeds/:feed/posts/:post",_controller.resetTitle);(0,_page2.default)("/read/post/id/:blog_id/:post_id",_controller3.default.legacyRedirects);(0,_page2.default)("/read/blogs/:blog/posts/:post",_controller3.default.updateLastRoute,useRefresh?_controller3.default.unmountSidebar:_controller3.default.sidebar,useRefresh?_controller.blogPostNew:_controller.blogPost);_page2.default.exit("/read/blogs/:blog/posts/:post",_controller.resetTitle)};var _page=__webpack_require__(33);var _page2=_interopRequireDefault(_page);var _config=__webpack_require__(12);var _config2=_interopRequireDefault(_config);var _abtest=__webpack_require__(280);var _controller=__webpack_require__(3191);var _controller2=__webpack_require__(1752);var _controller3=_interopRequireDefault(_controller2);var _pageNotifier=__webpack_require__(819);var _pageNotifier2=_interopRequireDefault(_pageNotifier);var _actions=__webpack_require__(2186);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var useRefresh=null;module.exports=exports["default"]},826:function(module,exports,__webpack_require__){"use strict";var _page=__webpack_require__(33);var _page2=_interopRequireDefault(_page);var _controller=__webpack_require__(1752);var _controller2=_interopRequireDefault(_controller);var _config=__webpack_require__(12);var _config2=_interopRequireDefault(_config);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function forceTeamA8C(context,next){context.params.team="a8c";next()}module.exports=function(){if(_config2.default.isEnabled("reader")){(0,_page2.default)("/",_controller2.default.preloadReaderBundle,_controller2.default.loadSubscriptions,_controller2.default.checkForColdStart,_controller2.default.initAbTests,_controller2.default.updateLastRoute,_controller2.default.removePost,_controller2.default.sidebar,_controller2.default.following);(0,_page2.default)("/read/following","/");(0,_page2.default)("/read","/");(0,_page2.default)("/read/blogs","/");(0,_page2.default)("/read/feeds","/");(0,_page2.default)("/read/blog","/");(0,_page2.default)("/read/post","/");(0,_page2.default)("/read/feed","/");(0,_page2.default)("/read/*",_controller2.default.preloadReaderBundle,_controller2.default.loadSubscriptions,_controller2.default.initAbTests);(0,_page2.default)("/read/blog/feed/:feed_id",_controller2.default.legacyRedirects);(0,_page2.default)("/read/feeds/:feed_id/posts",_controller2.default.incompleteUrlRedirects);(0,_page2.default)("/read/feeds/:feed_id",_controller2.default.updateLastRoute,_controller2.default.prettyRedirects,_controller2.default.removePost,_controller2.default.sidebar,_controller2.default.feedDiscovery,_controller2.default.feedListing);(0,_page2.default)("/read/blog/id/:blog_id",_controller2.default.legacyRedirects);(0,_page2.default)("/read/blogs/:blog_id/posts",_controller2.default.incompleteUrlRedirects);(0,_page2.default)("/read/blogs/:blog_id",_controller2.default.updateLastRoute,_controller2.default.prettyRedirects,_controller2.default.removePost,_controller2.default.sidebar,_controller2.default.blogListing)}(0,_page2.default)("/read/a8c",_controller2.default.updateLastRoute,_controller2.default.removePost,_controller2.default.sidebar,forceTeamA8C,_controller2.default.readA8C)}},1755:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.requestPostComments=requestPostComments;exports.removeComment=removeComment;exports.writeComment=writeComment;exports.likeComment=likeComment;exports.unlikeComment=unlikeComment;var _wp=__webpack_require__(28);var _wp2=_interopRequireDefault(_wp);var _actionTypes=__webpack_require__(2);var _utils=__webpack_require__(766);var _selectors=__webpack_require__(1756);var _constants=__webpack_require__(741);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function commentsRequestSuccess(options){var dispatch=options.dispatch;var requestId=options.requestId;var siteId=options.siteId;var postId=options.postId;var comments=options.comments;var totalCommentsCount=options.totalCommentsCount;dispatch({type:_actionTypes.COMMENTS_REQUEST_SUCCESS,requestId:requestId});dispatch({type:_actionTypes.COMMENTS_RECEIVE,siteId:siteId,postId:postId,comments:comments});if(totalCommentsCount>-1){dispatch({type:_actionTypes.COMMENTS_COUNT_RECEIVE,siteId:siteId,postId:postId,totalCommentsCount:totalCommentsCount})}}function commentsRequestFailure(dispatch,requestId,err){dispatch({type:_actionTypes.COMMENTS_REQUEST_FAILURE,requestId:requestId,error:err})}function requestPostComments(siteId,postId){return function(dispatch,getState){var postCommentRequests=(0,_selectors.getPostCommentRequests)(getState(),siteId,postId);var oldestCommentDateForPost=(0,_selectors.getPostOldestCommentDate)(getState(),siteId,postId);var query={order:"DESC",number:_constants.NUMBER_OF_COMMENTS_PER_FETCH};if(oldestCommentDateForPost&&oldestCommentDateForPost.toISOString){query.before=oldestCommentDateForPost.toISOString()}var requestId=(0,_utils.createRequestId)(siteId,postId,query);if(postCommentRequests&&[_actionTypes.COMMENTS_REQUEST,_actionTypes.COMMENTS_REQUEST_SUCCESS].indexOf(postCommentRequests.get(requestId))!==-1){return}dispatch({type:_actionTypes.COMMENTS_REQUEST,requestId:requestId});return _wp2.default.site(siteId).post(postId).comment().replies(query).then(function(_ref){var comments=_ref.comments;var found=_ref.found;return commentsRequestSuccess({dispatch:dispatch,requestId:requestId,siteId:siteId,postId:postId,comments:comments,totalCommentsCount:found})}).catch(function(err){return commentsRequestFailure(dispatch,requestId,err)})}}function createPlaceholderComment(commentText,postId,parentCommentId){return{ID:"placeholder-"+(new Date).getTime(),parent:parentCommentId?{ID:parentCommentId}:false,date:(new Date).toISOString(),content:commentText,status:"pending",type:"comment",post:{ID:postId},isPlaceholder:true,placeholderState:_constants.PLACEHOLDER_STATE.PENDING}}function removeComment(siteId,postId,commentId){return{type:_actionTypes.COMMENTS_REMOVE,siteId:siteId,postId:postId,commentId:commentId}}function writeComment(commentText,siteId,postId,parentCommentId){if(!commentText||!siteId||!postId){return}return function(dispatch){var placeholderComment=createPlaceholderComment(commentText,postId,parentCommentId),skipSort=!!parentCommentId;dispatch({type:_actionTypes.COMMENTS_RECEIVE,siteId:siteId,postId:postId,comments:[placeholderComment],skipSort:skipSort});var apiPromise=void 0;if(parentCommentId){apiPromise=_wp2.default.site(siteId).post(postId).comment(parentCommentId).reply({},commentText)}else{apiPromise=_wp2.default.site(siteId).post(postId).comment().add(commentText)}return apiPromise.then(function(comment){dispatch({type:_actionTypes.COMMENTS_REMOVE,siteId:siteId,postId:postId,commentId:placeholderComment.ID});dispatch({type:_actionTypes.COMMENTS_RECEIVE,siteId:siteId,postId:postId,comments:[comment],skipSort:skipSort});return comment}).catch(function(error){dispatch({type:_actionTypes.COMMENTS_ERROR,siteId:siteId,postId:postId,commentId:placeholderComment.ID,error:error});throw error})}}function likeComment(siteId,postId,commentId){return function(dispatch){dispatch({type:_actionTypes.COMMENTS_LIKE,siteId:siteId,postId:postId,commentId:commentId});return _wp2.default.site(siteId).comment(commentId).like().add({source:"reader"}).then(function(data){return dispatch({type:_actionTypes.COMMENTS_LIKE_UPDATE,siteId:siteId,postId:postId,commentId:commentId,iLike:data.i_like,likeCount:data.like_count})}).catch(function(){return dispatch({type:_actionTypes.COMMENTS_UNLIKE,siteId:siteId,postId:postId,commentId:commentId})})}}function unlikeComment(siteId,postId,commentId){return function(dispatch){dispatch({type:_actionTypes.COMMENTS_UNLIKE,siteId:siteId,postId:postId,commentId:commentId});return _wp2.default.site(siteId).comment(commentId).like().del({source:"reader"}).then(function(data){return dispatch({type:_actionTypes.COMMENTS_LIKE_UPDATE,siteId:siteId,postId:postId,commentId:commentId,iLike:data.i_like,likeCount:data.like_count})}).catch(function(){return dispatch({type:_actionTypes.COMMENTS_LIKE,siteId:siteId,postId:postId,commentId:commentId})})}}},1756:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getCommentLike=exports.haveMoreCommentsToFetch=exports.getPostCommentsTree=exports.getPostOldestCommentDate=exports.getPostMostRecentCommentDate=exports.getPostTotalCommentsCount=exports.getPostCommentRequests=exports.getPostCommentItems=undefined;var _createSelector=__webpack_require__(100);var _createSelector2=_interopRequireDefault(_createSelector);var _utils=__webpack_require__(766);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var getPostCommentItems=exports.getPostCommentItems=function getPostCommentItems(state,siteId,postId){return state.comments.items.get((0,_utils.getCommentParentKey)(siteId,postId))};var getPostCommentRequests=exports.getPostCommentRequests=function getPostCommentRequests(state,siteId,postId){return state.comments.requests.get((0,_utils.getCommentParentKey)(siteId,postId))};var getPostTotalCommentsCount=exports.getPostTotalCommentsCount=function getPostTotalCommentsCount(state,siteId,postId){return state.comments.totalCommentsCount.get((0,_utils.getCommentParentKey)(siteId,postId))};var getPostMostRecentCommentDate=exports.getPostMostRecentCommentDate=(0,_createSelector2.default)(function(state,siteId,postId){var items=getPostCommentItems(state,siteId,postId);return items&&items.first()?new Date(items.first().get("date")):undefined},getPostCommentItems);var getPostOldestCommentDate=exports.getPostOldestCommentDate=(0,_createSelector2.default)(function(state,siteId,postId){var items=getPostCommentItems(state,siteId,postId);return items&&items.last()?new Date(items.last().get("date")):undefined},getPostCommentItems);var getPostCommentsTree=exports.getPostCommentsTree=(0,_createSelector2.default)(function(state,siteId,postId){var items=getPostCommentItems(state,siteId,postId);return items?(0,_utils.buildCommentsTree)(items):undefined},getPostCommentItems);var haveMoreCommentsToFetch=exports.haveMoreCommentsToFetch=(0,_createSelector2.default)(function(state,siteId,postId){var items=getPostCommentItems(state,siteId,postId);var totalCommentsCount=getPostTotalCommentsCount(state,siteId,postId);return items&&totalCommentsCount?items.size<totalCommentsCount:undefined},function(state,siteId,postId){return[getPostCommentItems(state,siteId,postId),getPostTotalCommentsCount(state,siteId,postId)]});var getCommentLike=exports.getCommentLike=(0,_createSelector2.default)(function(state,siteId,postId,commentId){var items=getPostCommentItems(state,siteId,postId);var comment=items.find(function(c){return c.get("ID")===commentId});if(!comment){return undefined}return comment.filter(function(v,k){return["i_like","like_count"].indexOf(k)>-1})},getPostCommentItems)},1822:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getOwnPropertyNames=__webpack_require__(1827);var _getOwnPropertyNames2=_interopRequireDefault(_getOwnPropertyNames);var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _reactRedux=__webpack_require__(15);var _redux=__webpack_require__(6);var _noop=__webpack_require__(38);var _noop2=_interopRequireDefault(_noop);var _i18nCalypso=__webpack_require__(11);var _gravatar=__webpack_require__(710);var _gravatar2=_interopRequireDefault(_gravatar);var _notice=__webpack_require__(76);var _notice2=_interopRequireDefault(_notice);var _selectors=__webpack_require__(90);var _actions=__webpack_require__(1755);var _stats=__webpack_require__(1643);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var PostCommentForm=function(_React$Component){(0,_inherits3.default)(PostCommentForm,_React$Component);function PostCommentForm(props){(0,_classCallCheck3.default)(this,PostCommentForm);var _this=(0,_possibleConstructorReturn3.default)(this,(PostCommentForm.__proto__||(0,_getPrototypeOf2.default)(PostCommentForm)).call(this));_this.state={commentText:props.commentText||"",haveFocus:false};(0,_getOwnPropertyNames2.default)(PostCommentForm.prototype).filter(function(prop){return prop.indexOf("handle")===0}).filter(function(prop){return typeof _this[prop]==="function"}).forEach(function(prop){return _this[prop]=_this[prop].bind(_this)});return _this}(0,_createClass3.default)(PostCommentForm,[{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){this.setState({commentText:nextProps.commentText||""})}},{key:"componentDidMount",value:function componentDidMount(){if(this.props.parentCommentID&&this._textareaNode){this._textareaNode.focus()}}},{key:"componentDidUpdate",value:function componentDidUpdate(){var commentTextNode=this.refs.commentText;if(!commentTextNode){return}var commentText=this.getCommentText();var currentHeight=parseInt(commentTextNode.style.height,10)||0;commentTextNode.style.height=commentText.length?Math.max(commentTextNode.scrollHeight,currentHeight)+"px":null}},{key:"handleTextAreaNode",value:function handleTextAreaNode(textareaNode){this._textareaNode=textareaNode}},{key:"handleSubmit",value:function handleSubmit(event){event.preventDefault();this.submit()}},{key:"handleKeyDown",value:function handleKeyDown(event){if(event.keyCode===13&&(event.ctrlKey||event.metaKey)){event.preventDefault();this.submit()}if(event.keyCode===27){if(this.props.placeholderId){this.props.onUpdateCommentText(this.props.commentText);this.props.removeComment(this.props.post.site_ID,this.props.post.ID,this.props.placeholderId)}}}},{key:"handleFocus",value:function handleFocus(){this.setState({haveFocus:true})}},{key:"handleTextChange",value:function handleTextChange(event){var commentText=event.target.value;this.setState({commentText:commentText});this.props.onUpdateCommentText(commentText)}},{key:"resetCommentText",value:function resetCommentText(){this.setState({commentText:""});this.props.onUpdateCommentText("")}},{key:"hasCommentText",value:function hasCommentText(){return this.state.commentText.trim().length>0}},{key:"submit",value:function submit(){var post=this.props.post;var commentText=this.state.commentText.trim();if(!commentText){this.resetCommentText();return false}if(this.props.placeholderId){this.props.removeComment(post.site_ID,post.ID,this.props.placeholderId)}this.props.writeComment(commentText,post.site_ID,post.ID,this.props.parentCommentID);(0,_stats.recordAction)("posted_comment");(0,_stats.recordGaEvent)("Clicked Post Comment Button");(0,_stats.recordTrackForPost)("calypso_reader_article_commented_on",post,{parent_post_id:this.props.parentCommentID?this.props.parentCommentID:undefined});this.resetCommentText();this.props.onCommentSubmit();return true}},{key:"renderError",value:function renderError(){var error=this.props.error;var message=void 0;if(!error){return null}switch(error.error){case"comment_duplicate":message=(0,_i18nCalypso.translate)("Duplicate comment detected. It looks like you've already said that!");break;default:message=(0,_i18nCalypso.translate)("Sorry - there was a problem posting your comment.");break}return _react2.default.createElement(_notice2.default,{text:message,className:"reader-comments__notice",showDismiss:false,status:"is-error"})}},{key:"render",value:function render(){var post=this.props.post;if(post&&post.discussion&&post.discussion.comments_open===false){if(post.discussion.comment_count&&post.discussion.comment_count>0){return _react2.default.createElement("p",{className:"comments__form-closed"},(0,_i18nCalypso.translate)("Comments are closed."))}return null}var buttonClasses=(0,_classnames2.default)({"is-active":this.hasCommentText(),"is-visible":this.state.haveFocus||this.hasCommentText()});var expandingAreaClasses=(0,_classnames2.default)({focused:this.state.haveFocus,"expanding-area":true});return _react2.default.createElement("form",{className:"comments__form",ref:"commentForm"},_react2.default.createElement("fieldset",null,_react2.default.createElement(_gravatar2.default,{user:this.props.currentUser}),_react2.default.createElement("label",null,_react2.default.createElement("div",{className:expandingAreaClasses},_react2.default.createElement("pre",null,_react2.default.createElement("span",null,this.state.commentText),_react2.default.createElement("br",null)),_react2.default.createElement("textarea",{value:this.state.commentText,placeholder:(0,_i18nCalypso.translate)("Enter your comment here…"),ref:this.handleTextAreaNode,onKeyUp:this.handleKeyUp,onKeyDown:this.handleKeyDown,onFocus:this.handleFocus,onBlur:this.handleBlur,onChange:this.handleTextChange})),_react2.default.createElement("button",{ref:"commentButton",className:buttonClasses,disabled:this.state.commentText.length===0,onClick:this.handleSubmit},(0,_i18nCalypso.translate)("Send")),this.renderError())))}}]);return PostCommentForm}(_react2.default.Component);PostCommentForm.propTypes={post:_react2.default.PropTypes.object.isRequired,parentCommentID:_react2.default.PropTypes.number,placeholderId:_react2.default.PropTypes.string,commentText:_react2.default.PropTypes.string,onUpdateCommentText:_react2.default.PropTypes.func.isRequired,onCommentSubmit:_react2.default.PropTypes.func,currentUser:_react2.default.PropTypes.object.isRequired,writeComment:_react2.default.PropTypes.func.isRequired,removeComment:_react2.default.PropTypes.func.isRequired};PostCommentForm.defaultProps={onCommentSubmit:_noop2.default};exports.default=(0,_reactRedux.connect)(function(state){return{currentUser:(0,_selectors.getCurrentUser)(state)}},function(dispatch){return(0,_redux.bindActionCreators)({writeComment:_actions.writeComment,removeComment:_actions.removeComment},dispatch)})(PostCommentForm);module.exports=exports["default"]},1827:function(module,exports,__webpack_require__){module.exports={default:__webpack_require__(2188),__esModule:true}},1873:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.AuthorAndSite=AuthorAndSite;var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _partial=__webpack_require__(286);var _partial2=_interopRequireDefault(_partial);var _noop=__webpack_require__(38);var _noop2=_interopRequireDefault(_noop);var _i18nCalypso=__webpack_require__(11);var _immutable=__webpack_require__(113);var _immutable2=_interopRequireDefault(_immutable);var _gravatar=__webpack_require__(710);var _gravatar2=_interopRequireDefault(_gravatar);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function AuthorAndSite(_ref){var translate=_ref.translate;var post=_ref.post;var site=_ref.site;var feed=_ref.feed;var _ref$showGravatar=_ref.showGravatar;var showGravatar=_ref$showGravatar===undefined?false:_ref$showGravatar;var _ref$onClick=_ref.onClick;var onClick=_ref$onClick===undefined?_noop2.default:_ref$onClick;var displayName=post.author&&post.author.name;if(_immutable2.default.Iterable.isIterable(site)){site=site.toJS()}var siteName=site&&site.title||post.site_name;var username=_react2.default.createElement("span",{className:"reader-card-search__byline-author"},_react2.default.createElement("a",{className:"reader-related-card__byline-link",href:"/read/blogs/"+post.site_ID,onClick:(0,_partial2.default)(onClick,{post:post,site:site,feed:feed})},showGravatar&&_react2.default.createElement(_gravatar2.default,{user:post.author,size:16}),displayName));var sitename=_react2.default.createElement("span",{className:"reader-related-card__byline-site"},_react2.default.createElement("a",{className:"reader-related-card__byline-link",href:"/read/blogs/"+post.site_ID,onClick:(0,_partial2.default)(onClick,{post:post,site:site,feed:feed})},siteName));return _react2.default.createElement("span",{className:"reader-related-card__byline-author-and-site"},displayName===""||siteName===displayName?sitename:translate("{{username/}}, {{sitename/}}",{components:{username:username,sitename:sitename}}))}exports.default=(0,_i18nCalypso.localize)(AuthorAndSite)},1947:function(module,exports,__webpack_require__){var baseSlice=__webpack_require__(140),toInteger=__webpack_require__(65);function take(array,n,guard){if(!(array&&array.length)){return[]}n=guard||n===undefined?1:toInteger(n);return baseSlice(array,0,n<0?0:n)}module.exports=take},2013:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getPost=getPost;exports.getPostBySiteAndId=getPostBySiteAndId;var _keyBy=__webpack_require__(103);var _keyBy2=_interopRequireDefault(_keyBy);var _filter=__webpack_require__(77);var _filter2=_interopRequireDefault(_filter);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function getPost(state,postGlobalId){return state.reader.posts.items[postGlobalId]}var previousItems=null,postMapBySiteAndPost={};function getPostBySiteAndId(state,siteId,postId){if(state.reader.posts.items!==previousItems){var items=state.reader.posts.items,internalPosts=(0,_filter2.default)(items,function(post){return post&&post.site_ID&&post.ID&&!post.is_external});postMapBySiteAndPost=(0,_keyBy2.default)(internalPosts,function(post){return post.site_ID+"-"+post.ID});previousItems=items}return postMapBySiteAndPost[siteId+"-"+postId]}},2014:function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.shouldSiteBeFetched=shouldSiteBeFetched;exports.getSite=getSite;function shouldSiteBeFetched(state,siteId){return!state.reader.sites.queuedRequests[siteId]&&!state.reader.sites.items[siteId]}function getSite(state,siteId){return state.reader.sites.items[siteId]}},2017:function(module,exports){"use strict";exports.__esModule=true;exports.default=function(obj){if(obj==null)throw new TypeError("Cannot destructure undefined")}},2025:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getOwnPropertyNames=__webpack_require__(1827);var _getOwnPropertyNames2=_interopRequireDefault(_getOwnPropertyNames);var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _noop2=__webpack_require__(38);var _noop3=_interopRequireDefault(_noop2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _reactRedux=__webpack_require__(15);var _redux=__webpack_require__(6);var _i18nCalypso=__webpack_require__(11);var _gravatar=__webpack_require__(710);var _gravatar2=_interopRequireDefault(_gravatar);var _notice=__webpack_require__(76);var _notice2=_interopRequireDefault(_notice);var _selectors=__webpack_require__(90);var _actions=__webpack_require__(1755);var _stats=__webpack_require__(1643);var _helper=__webpack_require__(2026);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var PostCommentForm=function(_React$Component){(0,_inherits3.default)(PostCommentForm,_React$Component);function PostCommentForm(props){(0,_classCallCheck3.default)(this,PostCommentForm);var _this=(0,_possibleConstructorReturn3.default)(this,(PostCommentForm.__proto__||(0,_getPrototypeOf2.default)(PostCommentForm)).call(this));_this.state={commentText:props.commentText||"",haveFocus:false};(0,_getOwnPropertyNames2.default)(PostCommentForm.prototype).filter(function(prop){return prop.indexOf("handle")===0}).filter(function(prop){return typeof _this[prop]==="function"}).forEach(function(prop){return _this[prop]=_this[prop].bind(_this)});return _this}(0,_createClass3.default)(PostCommentForm,[{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){this.setState({commentText:nextProps.commentText||""})}},{key:"componentDidMount",value:function componentDidMount(){if(this.props.parentCommentID&&this._textareaNode){this._textareaNode.focus()}}},{key:"componentDidUpdate",value:function componentDidUpdate(){var commentTextNode=this.refs.commentText;if(!commentTextNode){return}var commentText=this.getCommentText();var currentHeight=parseInt(commentTextNode.style.height,10)||0;commentTextNode.style.height=commentText.length?Math.max(commentTextNode.scrollHeight,currentHeight)+"px":null}},{key:"handleTextAreaNode",value:function handleTextAreaNode(textareaNode){this._textareaNode=textareaNode}},{key:"handleSubmit",value:function handleSubmit(event){event.preventDefault();this.submit()}},{key:"handleKeyDown",value:function handleKeyDown(event){if(event.keyCode===13&&(event.ctrlKey||event.metaKey)){event.preventDefault();this.submit()}if(event.keyCode===27){if(this.props.placeholderId){this.props.onUpdateCommentText(this.props.commentText);this.props.removeComment(this.props.post.site_ID,this.props.post.ID,this.props.placeholderId)}}}},{key:"handleFocus",value:function handleFocus(){this.setState({haveFocus:true})}},{key:"handleTextChange",value:function handleTextChange(event){var commentText=event.target.value;this.setState({commentText:commentText});this.props.onUpdateCommentText(commentText)}},{key:"resetCommentText",value:function resetCommentText(){this.setState({commentText:""});this.props.onUpdateCommentText("")}},{key:"hasCommentText",value:function hasCommentText(){return this.state.commentText.trim().length>0}},{key:"submit",value:function submit(){var post=this.props.post;var commentText=this.state.commentText.trim();if(!commentText){this.resetCommentText();return false}if(this.props.placeholderId){this.props.removeComment(post.site_ID,post.ID,this.props.placeholderId)}this.props.writeComment(commentText,post.site_ID,post.ID,this.props.parentCommentID);(0,_stats.recordAction)("posted_comment");(0,_stats.recordGaEvent)("Clicked Post Comment Button");(0,_stats.recordTrackForPost)("calypso_reader_article_commented_on",post,{parent_post_id:this.props.parentCommentID?this.props.parentCommentID:undefined});this.resetCommentText();this.props.onCommentSubmit();return true}},{key:"renderError",value:function renderError(){var error=this.props.error;var message=void 0;if(!error){return null}switch(error.error){case"comment_duplicate":message=(0,_i18nCalypso.translate)("Duplicate comment detected. It looks like you've already said that!");break;default:message=(0,_i18nCalypso.translate)("Sorry - there was a problem posting your comment.");break}return _react2.default.createElement(_notice2.default,{text:message,className:"comments__notice",showDismiss:false,status:"is-error"})}},{key:"render",value:function render(){var post=this.props.post;if(post&&post.discussion&&post.discussion.comments_open===false&&!(0,_helper.isCommentableDiscoverPost)(post)){if(post.discussion.comment_count&&post.discussion.comment_count>0){return _react2.default.createElement("p",{className:"comments__form-closed"},(0,_i18nCalypso.translate)("Comments are closed."))}return null}var buttonClasses=(0,_classnames2.default)({"is-active":this.hasCommentText(),"is-visible":this.state.haveFocus||this.hasCommentText()});var expandingAreaClasses=(0,_classnames2.default)({focused:this.state.haveFocus,"expanding-area":true});return _react2.default.createElement("form",{className:"comments__form",ref:"commentForm"},_react2.default.createElement("fieldset",null,_react2.default.createElement(_gravatar2.default,{user:this.props.currentUser}),_react2.default.createElement("label",null,_react2.default.createElement("div",{className:expandingAreaClasses},_react2.default.createElement("pre",null,_react2.default.createElement("span",null,this.state.commentText),_react2.default.createElement("br",null)),_react2.default.createElement("textarea",{value:this.state.commentText,placeholder:(0,_i18nCalypso.translate)("Enter your comment here…"),ref:this.handleTextAreaNode,onKeyUp:this.handleKeyUp,onKeyDown:this.handleKeyDown,onFocus:this.handleFocus,onBlur:this.handleBlur,onChange:this.handleTextChange})),_react2.default.createElement("button",{ref:"commentButton",className:buttonClasses,disabled:this.state.commentText.length===0,onClick:this.handleSubmit},(0,_i18nCalypso.translate)("Send")),this.renderError())))}}]);return PostCommentForm}(_react2.default.Component);PostCommentForm.propTypes={post:_react2.default.PropTypes.object.isRequired,parentCommentID:_react2.default.PropTypes.number,placeholderId:_react2.default.PropTypes.string,commentText:_react2.default.PropTypes.string,onUpdateCommentText:_react2.default.PropTypes.func.isRequired,onCommentSubmit:_react2.default.PropTypes.func,currentUser:_react2.default.PropTypes.object.isRequired,writeComment:_react2.default.PropTypes.func.isRequired,removeComment:_react2.default.PropTypes.func.isRequired};PostCommentForm.defaultProps={onCommentSubmit:_noop3.default};exports.default=(0,_reactRedux.connect)(function(state){return{currentUser:(0,_selectors.getCurrentUser)(state)}},function(dispatch){return(0,_redux.bindActionCreators)({writeComment:_actions.writeComment,removeComment:_actions.removeComment},dispatch)})(PostCommentForm);module.exports=exports["default"]},2026:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.shouldShowComments=shouldShowComments;exports.isCommentableDiscoverPost=isCommentableDiscoverPost;var _helper=__webpack_require__(1674);var DiscoverHelper=_interopRequireWildcard(_helper);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function shouldShowComments(post){if(isCommentableDiscoverPost(post)){return true}if(!post.is_jetpack&&post.discussion&&(post.discussion.comments_open||post.discussion.comment_count>0)){
return true}return false}function isCommentableDiscoverPost(post){var isDiscoverPost=DiscoverHelper.isDiscoverPost(post);if(isDiscoverPost){if(DiscoverHelper.isInternalDiscoverPost(post)&&!DiscoverHelper.isDiscoverSitePick(post)){return true}}return false}},2156:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _pick=__webpack_require__(91);var _pick2=_interopRequireDefault(_pick);var _reactRedux=__webpack_require__(15);var _redux=__webpack_require__(6);var _i18nCalypso=__webpack_require__(11);var _button=__webpack_require__(1962);var _button2=_interopRequireDefault(_button);var _stats=__webpack_require__(1643);var _actions=__webpack_require__(1755);var _selectors=__webpack_require__(1756);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var CommentLikeButtonContainer=function(_React$Component){(0,_inherits3.default)(CommentLikeButtonContainer,_React$Component);function CommentLikeButtonContainer(){(0,_classCallCheck3.default)(this,CommentLikeButtonContainer);var _this=(0,_possibleConstructorReturn3.default)(this,(CommentLikeButtonContainer.__proto__||(0,_getPrototypeOf2.default)(CommentLikeButtonContainer)).call(this));_this.boundHandleLikeToggle=_this.handleLikeToggle.bind(_this);return _this}(0,_createClass3.default)(CommentLikeButtonContainer,[{key:"handleLikeToggle",value:function handleLikeToggle(liked){if(liked){this.props.likeComment(this.props.siteId,this.props.postId,this.props.commentId)}else{this.props.unlikeComment(this.props.siteId,this.props.postId,this.props.commentId)}(0,_stats.recordAction)(liked?"liked_comment":"unliked_comment");(0,_stats.recordGaEvent)(liked?"Clicked Comment Like":"Clicked Comment Unlike");(0,_stats.recordTrack)("calypso_reader_"+(liked?"liked":"unliked")+"_comment",{blog_id:this.props.siteId,comment_id:this.props.commentId})}},{key:"render",value:function render(){var props=(0,_pick2.default)(this.props,["showZeroCount","tagName"]);var likeCount=this.props.commentLike.get("like_count");var iLike=this.props.commentLike.get("i_like");var likedLabel=(0,_i18nCalypso.translate)("Liked");return _react2.default.createElement(_button2.default,(0,_extends3.default)({},props,{likeCount:likeCount,liked:iLike,onLikeToggle:this.boundHandleLikeToggle,likedLabel:likedLabel,isMini:true}))}}]);return CommentLikeButtonContainer}(_react2.default.Component);CommentLikeButtonContainer.propTypes={siteId:_react2.default.PropTypes.number.isRequired,postId:_react2.default.PropTypes.number.isRequired,commentId:_react2.default.PropTypes.number.isRequired,showZeroCount:_react2.default.PropTypes.bool,tagName:_react2.default.PropTypes.string,commentLike:_react2.default.PropTypes.object.isRequired,likeComment:_react2.default.PropTypes.func.isRequired,unlikeComment:_react2.default.PropTypes.func.isRequired};exports.default=(0,_reactRedux.connect)(function(state,props){return{commentLike:(0,_selectors.getCommentLike)(state,props.siteId,props.postId,props.commentId)}},function(dispatch){return(0,_redux.bindActionCreators)({likeComment:_actions.likeComment,unlikeComment:_actions.unlikeComment},dispatch)})(CommentLikeButtonContainer);module.exports=exports["default"]},2157:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _postCommentList=__webpack_require__(2159);var _postCommentList2=_interopRequireDefault(_postCommentList);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_postCommentList2.default;module.exports=exports["default"]},2158:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var PostCommentContent=function(_React$Component){(0,_inherits3.default)(PostCommentContent,_React$Component);function PostCommentContent(){(0,_classCallCheck3.default)(this,PostCommentContent);return(0,_possibleConstructorReturn3.default)(this,(PostCommentContent.__proto__||(0,_getPrototypeOf2.default)(PostCommentContent)).apply(this,arguments))}(0,_createClass3.default)(PostCommentContent,[{key:"render",value:function render(){if(this.props.isPlaceholder){return _react2.default.createElement("div",{className:"comment__content"},this.props.content)}return _react2.default.createElement("div",{className:"comment__content",dangerouslySetInnerHTML:{__html:this.props.content}})}}]);return PostCommentContent}(_react2.default.Component);exports.default=PostCommentContent;PostCommentContent.propTypes={content:_react.PropTypes.string.isRequired,isPlaceholder:_react.PropTypes.bool};module.exports=exports["default"]},2159:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactRedux=__webpack_require__(15);var _redux=__webpack_require__(6);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _i18nCalypso=__webpack_require__(11);var _selectors=__webpack_require__(1756);var _actions=__webpack_require__(1755);var _constants=__webpack_require__(741);var _stats=__webpack_require__(1643);var _postComment=__webpack_require__(2161);var _postComment2=_interopRequireDefault(_postComment);var _form=__webpack_require__(1822);var _form2=_interopRequireDefault(_form);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var PostCommentList=function(_React$Component){(0,_inherits3.default)(PostCommentList,_React$Component);function PostCommentList(props){(0,_classCallCheck3.default)(this,PostCommentList);var _this=(0,_possibleConstructorReturn3.default)(this,(PostCommentList.__proto__||(0,_getPrototypeOf2.default)(PostCommentList)).call(this));_this.state={activeReplyCommentID:null,amountOfCommentsToTake:props.initialSize};_this.viewEarlierCommentsHandler=_this.viewEarlierCommentsHandler.bind(_this);return _this}(0,_createClass3.default)(PostCommentList,[{key:"componentWillMount",value:function componentWillMount(){var siteId=this.props.post.site_ID;var postId=this.props.post.ID;this.props.requestPostComments(siteId,postId)}},{key:"renderComment",value:function renderComment(commentId){if(!commentId){return null}var onReplyClick=this.onReplyClick.bind(this);var onReplyCancel=this.onReplyCancel.bind(this);var commentText=this.state.commentText;var onUpdateCommentText=this.onUpdateCommentText.bind(this);var resetActiveReplyComment=this.resetActiveReplyComment.bind(this);return _react2.default.createElement(_postComment2.default,{post:this.props.post,commentsTree:this.props.commentsTree,commentId:commentId,key:commentId,activeReplyCommentID:this.state.activeReplyCommentID,onReplyClick:onReplyClick,onReplyCancel:onReplyCancel,commentText:commentText,onUpdateCommentText:onUpdateCommentText,onCommentSubmit:resetActiveReplyComment,depth:0})}},{key:"onReplyClick",value:function onReplyClick(commentID){this.setState({activeReplyCommentID:commentID});(0,_stats.recordAction)("comment_reply_click");(0,_stats.recordGaEvent)("Clicked Reply to Comment");(0,_stats.recordTrack)("calypso_reader_comment_reply_click",{blog_id:this.props.post.site_ID,comment_id:commentID})}},{key:"onReplyCancel",value:function onReplyCancel(){(0,_stats.recordAction)("comment_reply_cancel_click");(0,_stats.recordGaEvent)("Clicked Cancel Reply to Comment");(0,_stats.recordTrack)("calypso_reader_comment_reply_cancel_click",{blog_id:this.props.post.site_ID,comment_id:this.state.activeReplyCommentID});this.resetActiveReplyComment()}},{key:"onUpdateCommentText",value:function onUpdateCommentText(commentText){this.setState({commentText:commentText})}},{key:"resetActiveReplyComment",value:function resetActiveReplyComment(){this.setState({activeReplyCommentID:null})}},{key:"renderCommentsList",value:function renderCommentsList(commentIds){var _this2=this;return _react2.default.createElement("ol",{className:"comments__list is-root"},commentIds.reverse().map(function(commentId){return _this2.renderComment(commentId)}))}},{key:"renderCommentForm",value:function renderCommentForm(){var post=this.props.post;var commentText=this.state.commentText;var onUpdateCommentText=this.onUpdateCommentText.bind(this);if(this.state.activeReplyCommentID&&!this.state.errors){return null}return _react2.default.createElement(_form2.default,{ref:"postCommentForm",post:post,parentCommentID:null,commentText:commentText,onUpdateCommentText:onUpdateCommentText})}},{key:"getCommentsCount",value:function getCommentsCount(commentIds){var _this3=this;return commentIds.reduce(function(prevSum,commentId){return prevSum+_this3.getCommentsCount(_this3.props.commentsTree.getIn([commentId,"children"]))+1},0)}},{key:"getDisplayedComments",value:function getDisplayedComments(commentIds,take){if(!commentIds){return null}var displayedComments=commentIds.take(take);return{displayedComments:displayedComments,displayedCommentsCount:this.getCommentsCount(displayedComments)}}},{key:"viewEarlierCommentsHandler",value:function viewEarlierCommentsHandler(){var siteId=this.props.post.site_ID;var postId=this.props.post.ID;var amountOfCommentsToTake=this.state.amountOfCommentsToTake+this.props.pageSize;this.setState({amountOfCommentsToTake:amountOfCommentsToTake});if(this.props.haveMoreCommentsToFetch){this.props.requestPostComments(siteId,postId)}}},{key:"render",value:function render(){if(!this.props.commentsTree){return null}var _getDisplayedComments=this.getDisplayedComments(this.props.commentsTree.get("children"),this.state.amountOfCommentsToTake);var displayedComments=_getDisplayedComments.displayedComments;var displayedCommentsCount=_getDisplayedComments.displayedCommentsCount;var showViewEarlier=this.props.commentsTree.get("children").size>this.state.amountOfCommentsToTake||this.props.haveMoreCommentsToFetch;var totalCommentsCount=this.props.haveMoreCommentsToFetch?this.props.totalCommentsCount:this.getCommentsCount(this.props.commentsTree.get("children"));return _react2.default.createElement("div",{className:"comments"},_react2.default.createElement("div",{className:(0,_classnames2.default)("comments__top-bar",{"is-no-comments":displayedCommentsCount===0})},showViewEarlier?_react2.default.createElement("span",{className:"comments__view-earlier",onClick:this.viewEarlierCommentsHandler},(0,_i18nCalypso.translate)("View earlier comments (Showing %(shown)d of %(total)d)",{args:{shown:displayedCommentsCount,total:totalCommentsCount}})):null),this.renderCommentsList(displayedComments),this.renderCommentForm())}}]);return PostCommentList}(_react2.default.Component);PostCommentList.propTypes={post:_react2.default.PropTypes.shape({ID:_react2.default.PropTypes.number.isRequired,site_ID:_react2.default.PropTypes.number.isRequired}).isRequired,onCommentsUpdate:_react2.default.PropTypes.func.isRequired,pageSize:_react2.default.PropTypes.number,initialSize:_react2.default.PropTypes.number,commentsTree:_react2.default.PropTypes.object,totalCommentsCount:_react2.default.PropTypes.number,haveMoreCommentsToFetch:_react2.default.PropTypes.bool,requestPostComments:_react2.default.PropTypes.func.isRequired};PostCommentList.defaultProps={pageSize:_constants.NUMBER_OF_COMMENTS_PER_FETCH,initialSize:_constants.NUMBER_OF_COMMENTS_PER_FETCH,haveMoreCommentsToFetch:false};exports.default=(0,_reactRedux.connect)(function(state,ownProps){return{commentsTree:(0,_selectors.getPostCommentsTree)(state,ownProps.post.site_ID,ownProps.post.ID),totalCommentsCount:(0,_selectors.getPostTotalCommentsCount)(state,ownProps.post.site_ID,ownProps.post.ID),haveMoreCommentsToFetch:(0,_selectors.haveMoreCommentsToFetch)(state,ownProps.post.site_ID,ownProps.post.ID)}},function(dispatch){return(0,_redux.bindActionCreators)({requestPostComments:_actions.requestPostComments},dispatch)})(PostCommentList);module.exports=exports["default"]},2160:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _form=__webpack_require__(1822);var _form2=_interopRequireDefault(_form);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var PostCommentWithError=function(_React$Component){(0,_inherits3.default)(PostCommentWithError,_React$Component);function PostCommentWithError(){(0,_classCallCheck3.default)(this,PostCommentWithError);return(0,_possibleConstructorReturn3.default)(this,(PostCommentWithError.__proto__||(0,_getPrototypeOf2.default)(PostCommentWithError)).apply(this,arguments))}(0,_createClass3.default)(PostCommentWithError,[{key:"renderCommentForm",value:function renderCommentForm(){var post=this.props.post;var commentText=this.props.commentsTree.getIn([this.props.commentId,"data","content"]);var commentParentId=this.props.commentsTree.getIn([this.props.commentId,"parentId"]);var placeholderError=this.props.commentsTree.getIn([this.props.commentId,"data","placeholderError"]);var onUpdateCommentText=this.props.onUpdateCommentText;return _react2.default.createElement(_form2.default,{ref:"postCommentForm",post:post,parentCommentID:commentParentId,commentText:commentText,onUpdateCommentText:onUpdateCommentText,placeholderId:this.props.commentId,error:placeholderError})}},{key:"render",value:function render(){return _react2.default.createElement("li",{className:"comment is-error"},this.renderCommentForm(),this.props.repliesList)}}]);return PostCommentWithError}(_react2.default.Component);exports.default=PostCommentWithError;PostCommentWithError.propTypes={post:_react2.default.PropTypes.object.isRequired,repliesList:_react2.default.PropTypes.object.isRequired,commentsTree:_react2.default.PropTypes.object.isRequired,onUpdateCommentText:_react2.default.PropTypes.func.isRequired,commentId:_react2.default.PropTypes.oneOfType([_react2.default.PropTypes.string,_react2.default.PropTypes.number]).isRequired};module.exports=exports["default"]},2161:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);var _getOwnPropertyNames=__webpack_require__(1827);var _getOwnPropertyNames2=_interopRequireDefault(_getOwnPropertyNames);var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _noop=__webpack_require__(38);var _noop2=_interopRequireDefault(_noop);var _reactRedux=__webpack_require__(15);var _i18nCalypso=__webpack_require__(11);var _selectors=__webpack_require__(90);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _postTime=__webpack_require__(1790);var _postTime2=_interopRequireDefault(_postTime);var _gravatar=__webpack_require__(710);var _gravatar2=_interopRequireDefault(_gravatar);var _stats=__webpack_require__(1643);var _commentLikes=__webpack_require__(2156);var _commentLikes2=_interopRequireDefault(_commentLikes);var _postCommentContent=__webpack_require__(2158);var _postCommentContent2=_interopRequireDefault(_postCommentContent);var _form=__webpack_require__(1822);var _form2=_interopRequireDefault(_form);var _constants=__webpack_require__(741);var _formatting=__webpack_require__(81);var _postCommentWithError=__webpack_require__(2160);var _postCommentWithError2=_interopRequireDefault(_postCommentWithError);var _postTrackback=__webpack_require__(2162);var _postTrackback2=_interopRequireDefault(_postTrackback);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var PostComment=function(_React$Component){(0,_inherits3.default)(PostComment,_React$Component);function PostComment(){(0,_classCallCheck3.default)(this,PostComment);var _this=(0,_possibleConstructorReturn3.default)(this,(PostComment.__proto__||(0,_getPrototypeOf2.default)(PostComment)).call(this));_this.state={showReplies:false};(0,_getOwnPropertyNames2.default)(PostComment.prototype).filter(function(prop){return prop.indexOf("handle")===0}).filter(function(prop){return typeof _this[prop]==="function"}).forEach(function(prop){return _this[prop]=_this[prop].bind(_this)});return _this}(0,_createClass3.default)(PostComment,[{key:"handleToggleRepliesClick",value:function handleToggleRepliesClick(){this.setState({showReplies:!this.state.showReplies})}},{key:"handleReply",value:function handleReply(){this.props.onReplyClick(this.props.commentId);this.setState({showReplies:true})}},{key:"handleAuthorClick",value:function handleAuthorClick(){(0,_stats.recordAction)("comment_author_click");(0,_stats.recordGaEvent)("Clicked Author Name");(0,_stats.recordTrack)("calypso_reader_comment_author_click",{blog_id:this.props.post.site_ID,post_id:this.props.post.ID,comment_id:this.props.comment.ID,author_url:this.props.comment.author.URL})}},{key:"renderRepliesList",value:function renderRepliesList(){var _this2=this;var commentChildrenIds=this.props.commentsTree.getIn([this.props.commentId,"children"]).toJS();var exceedsMaxChildrenToShow=commentChildrenIds.length<this.props.maxChildrenToShow;var showReplies=this.state.showReplies||exceedsMaxChildrenToShow;if(!commentChildrenIds||commentChildrenIds.length<1){return null}var showRepliesText=(0,_i18nCalypso.translate)("show %(numOfReplies)d reply","show %(numOfReplies)d replies",{count:commentChildrenIds.length,args:{numOfReplies:commentChildrenIds.length}});var hideRepliesText=(0,_i18nCalypso.translate)("hide %(numOfReplies)d reply","hide %(numOfReplies)d replies",{count:commentChildrenIds.length,args:{numOfReplies:commentChildrenIds.length}});var replyVisibilityText=null;if(!exceedsMaxChildrenToShow){replyVisibilityText=this.state.showReplies?hideRepliesText:showRepliesText}return _react2.default.createElement("div",null,!!replyVisibilityText?_react2.default.createElement("button",{className:"comments__view-replies-btn",onClick:this.handleToggleRepliesClick},_react2.default.createElement(_gridicon2.default,{icon:"reply",size:18})," ",replyVisibilityText):null,showReplies?_react2.default.createElement("ol",{className:"comments__list"},commentChildrenIds.reverse().map(function(childId){return _react2.default.createElement(PostComment,(0,_extends3.default)({},_this2.props,{depth:_this2.props.depth+1,key:childId,commentId:childId}))})):null)}},{key:"renderCommentForm",value:function renderCommentForm(){if(this.props.activeReplyCommentID!==this.props.commentId){return null}return _react2.default.createElement(_form2.default,{ref:"postCommentForm",post:this.props.post,parentCommentID:this.props.commentId,commentText:this.props.commentText,onUpdateCommentText:this.props.onUpdateCommentText,onCommentSubmit:this.props.onCommentSubmit})}},{key:"renderCommentActions",value:function renderCommentActions(comment){var post=this.props.post;var showReplyButton=post&&post.discussion&&post.discussion.comments_open===true;var showCancelReplyButton=this.props.activeReplyCommentID===this.props.commentId;if(comment.isPlaceholder||comment.status!=="approved"){return null}return _react2.default.createElement("div",{className:"comment__actions"},showReplyButton?_react2.default.createElement("button",{className:"comment__actions-reply",onClick:this.handleReply},_react2.default.createElement(_gridicon2.default,{icon:"reply",size:18}),_react2.default.createElement("span",{className:"comment__actions-reply-label"},(0,_i18nCalypso.translate)("Reply"))):null,showCancelReplyButton?_react2.default.createElement("button",{className:"comment__actions-cancel-reply",onClick:this.props.onReplyCancel},(0,_i18nCalypso.translate)("Cancel reply")):null,_react2.default.createElement(_commentLikes2.default,{className:"comment__actions-like",tagName:"button",siteId:this.props.post.site_ID,postId:this.props.post.ID,commentId:comment.ID}))}},{key:"render",value:function render(){var commentsTree=this.props.commentsTree;var comment=commentsTree.getIn([this.props.commentId,"data"]).toJS();var haveReplyWithError=commentsTree.getIn([this.props.commentId,"children"]).some(function(childId){return commentsTree.getIn([childId,"data","placeholderState"])===_constants.PLACEHOLDER_STATE.ERROR});if(comment.isPlaceholder){comment.author=this.props.currentUser;comment.author.name=this.props.currentUser.display_name}else{comment.author.name=(0,_formatting.decodeEntities)(comment.author.name)}if(comment.isPlaceholder&&comment.placeholderState===_constants.PLACEHOLDER_STATE.ERROR){return _react2.default.createElement(_postCommentWithError2.default,(0,_extends3.default)({},this.props,{repliesList:this.renderRepliesList()}))}if(comment.type==="trackback"||comment.type==="pingback"){return _react2.default.createElement(_postTrackback2.default,this.props)}return _react2.default.createElement("li",{className:"comment depth-"+this.props.depth},_react2.default.createElement("div",{className:"comment__author"},_react2.default.createElement(_gravatar2.default,{user:comment.author}),comment.author.URL?_react2.default.createElement("a",{href:comment.author.URL,target:"_blank",rel:"noopener noreferrer",className:"comment__username",onClick:this.handleAuthorClick},comment.author.name,_react2.default.createElement(_gridicon2.default,{icon:"external"})):_react2.default.createElement("strong",{className:"comment__username"},comment.author.name),_react2.default.createElement("small",{className:"comment__timestamp"},_react2.default.createElement("a",{href:comment.URL},_react2.default.createElement(_postTime2.default,{date:comment.date})))),comment.status&&comment.status==="unapproved"?_react2.default.createElement("p",{className:"comment__moderation"},(0,_i18nCalypso.translate)("Your comment is awaiting moderation.")):null,_react2.default.createElement(_postCommentContent2.default,{content:comment.content,isPlaceholder:comment.isPlaceholder}),this.renderCommentActions(comment),haveReplyWithError?null:this.renderCommentForm(),this.renderRepliesList())}}]);return PostComment}(_react2.default.Component);PostComment.propTypes={commentsTree:_react2.default.PropTypes.object.isRequired,commentId:_react2.default.PropTypes.oneOfType([_react2.default.PropTypes.string,_react2.default.PropTypes.number]).isRequired,onReplyClick:_react2.default.PropTypes.func,depth:_react2.default.PropTypes.number,post:_react2.default.PropTypes.object,maxChildrenToShow:_react2.default.PropTypes.number,onCommentSubmit:_react2.default.PropTypes.func,currentUser:_react2.default.PropTypes.object.isRequired};PostComment.defaultProps={onReplyClick:_noop2.default,errors:[],depth:1,maxChildrenToShow:5,onCommentSubmit:_noop2.default};exports.default=(0,_reactRedux.connect)(function(state){return{currentUser:(0,_selectors.getCurrentUser)(state)}})(PostComment);module.exports=exports["default"]},2162:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _postTime=__webpack_require__(1790);var _postTime2=_interopRequireDefault(_postTime);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function unescape(str){return str.replace(/&#(\d+);/g,function(match,entity){return String.fromCharCode(entity)})}var PostTrackback=function(_React$Component){(0,_inherits3.default)(PostTrackback,_React$Component);function PostTrackback(){(0,_classCallCheck3.default)(this,PostTrackback);return(0,_possibleConstructorReturn3.default)(this,(PostTrackback.__proto__||(0,_getPrototypeOf2.default)(PostTrackback)).apply(this,arguments))}(0,_createClass3.default)(PostTrackback,[{key:"render",value:function render(){var commentsTree=this.props.commentsTree;var comment=commentsTree.getIn([this.props.commentId,"data"]).toJS();return _react2.default.createElement("li",{className:"comment depth-0"},_react2.default.createElement("div",{className:"comment__author"},_react2.default.createElement("div",{className:"comment__trackbackicon"},_react2.default.createElement(_gridicon2.default,{icon:"link",size:24})),comment.author.URL?_react2.default.createElement("a",{href:comment.author.URL,target:"_blank",rel:"noopener noreferrer",className:"comment__username"},unescape(comment.author.name),_react2.default.createElement(_gridicon2.default,{icon:"external"})):_react2.default.createElement("strong",{className:"comment__username"},unescape(comment.author.name)),_react2.default.createElement("small",{className:"comment__timestamp"},_react2.default.createElement("a",{href:comment.URL},_react2.default.createElement(_postTime2.default,{date:comment.date})))))}}]);return PostTrackback}(_react2.default.Component);exports.default=PostTrackback;PostTrackback.propTypes={commentId:_react2.default.PropTypes.number};module.exports=exports["default"]},2179:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.shouldFetchRelated=shouldFetchRelated;exports.relatedPostsForPost=relatedPostsForPost;var _utils=__webpack_require__(767);function shouldFetchRelated(state,siteId,postId){var scope=arguments.length>3&&arguments[3]!==undefined?arguments[3]:_utils.SCOPE_ALL;return state.reader.relatedPosts.items[(0,_utils.key)(siteId,postId,scope)]===undefined&&!state.reader.relatedPosts.queuedRequests[(0,_utils.key)(siteId,postId,scope)]}function relatedPostsForPost(state,siteId,postId){var scope=arguments.length>3&&arguments[3]!==undefined?arguments[3]:_utils.SCOPE_ALL;return state.reader.relatedPosts.items[(0,_utils.key)(siteId,postId,scope)]}},2188:function(module,exports,__webpack_require__){__webpack_require__(2189);var $Object=__webpack_require__(31).Object;module.exports=function getOwnPropertyNames(it){return $Object.getOwnPropertyNames(it)}},2189:function(module,exports,__webpack_require__){__webpack_require__(230)("getOwnPropertyNames",function(){return __webpack_require__(798).f})},2221:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);exports.QueryReaderRelatedPostsSameSite=QueryReaderRelatedPostsSameSite;exports.QueryReaderRelatedPostsOtherSites=QueryReaderRelatedPostsOtherSites;var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactRedux=__webpack_require__(15);var _redux=__webpack_require__(6);var _selectors=__webpack_require__(2179);var _actions=__webpack_require__(3298);var _utils=__webpack_require__(767);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var QueryReaderRelatedPosts=function(_Component){(0,_inherits3.default)(QueryReaderRelatedPosts,_Component);function QueryReaderRelatedPosts(){(0,_classCallCheck3.default)(this,QueryReaderRelatedPosts);return(0,_possibleConstructorReturn3.default)(this,(QueryReaderRelatedPosts.__proto__||(0,_getPrototypeOf2.default)(QueryReaderRelatedPosts)).apply(this,arguments))}(0,_createClass3.default)(QueryReaderRelatedPosts,[{key:"componentWillMount",value:function componentWillMount(){if(this.props.shouldFetch){this.props.requestRelatedPosts(this.props.siteId,this.props.postId,this.props.scope)}}},{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){if(!nextProps.shouldFetch||this.props.siteId===nextProps.siteId&&this.props.postId===nextProps.postId&&this.props.scope===nextProps.scope){return}nextProps.requestRelatedPosts(nextProps.siteId,nextProps.postId,nextProps.scope)}},{key:"render",value:function render(){return null}}]);return QueryReaderRelatedPosts}(_react.Component);QueryReaderRelatedPosts.propTypes={siteId:_react.PropTypes.number,postId:_react.PropTypes.number,scope:_react.PropTypes.oneOf([_utils.SCOPE_ALL,_utils.SCOPE_SAME,_utils.SCOPE_OTHER]),shouldFetch:_react.PropTypes.bool,requestRelatedPosts:_react.PropTypes.func};QueryReaderRelatedPosts.defaultProps={
scope:_utils.SCOPE_ALL,requestRelatedPosts:function requestRelatedPosts(){}};exports.default=(0,_reactRedux.connect)(function(state,ownProps){var siteId=ownProps.siteId;var postId=ownProps.postId;var scope=ownProps.scope;return{shouldFetch:(0,_selectors.shouldFetchRelated)(state,siteId,postId,scope)}},function(dispatch){return(0,_redux.bindActionCreators)({requestRelatedPosts:_actions.requestRelatedPosts},dispatch)})(QueryReaderRelatedPosts);function QueryReaderRelatedPostsSameSite(props){return _react2.default.createElement(QueryReaderRelatedPosts,(0,_extends3.default)({scope:_utils.SCOPE_SAME},props))}function QueryReaderRelatedPostsOtherSites(props){return _react2.default.createElement(QueryReaderRelatedPosts,(0,_extends3.default)({scope:_utils.SCOPE_OTHER},props))}},2353:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _stats=__webpack_require__(1643);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var PostExcerptLink=_react2.default.createClass({displayName:"PostExcerptLink",propTypes:{siteName:_react2.default.PropTypes.string,postUrl:_react2.default.PropTypes.string},getInitialState:function getInitialState(){return{isShowingNotice:false}},toggleNotice:function toggleNotice(event){event.preventDefault();this.setState({isShowingNotice:!this.state.isShowingNotice})},recordClick:function recordClick(){(0,_stats.recordPermalinkClick)("summary_card_site_name");(0,_stats.recordGaEvent)("Clicked Excerpt Notice Permalink")},render:function render(){if(!this.props.siteName||!this.props.postUrl){return null}var siteName=_react2.default.createElement("a",{onClick:this.recordClick,href:this.props.postUrl,target:"_blank",rel:"external noopener noreferrer"},_react2.default.createElement("span",{className:"post-excerpt-only-site-name"},this.props.siteName||"(untitled)"));var classes=(0,_classnames2.default)({"post-excerpt-link":true,"is-showing-notice":this.state.isShowingNotice});return _react2.default.createElement("div",{className:classes},this.translate("Visit {{siteName/}} for the full post.",{components:{siteName:siteName}}),_react2.default.createElement("svg",{onClick:this.toggleNotice,className:"gridicon gridicon__help ignore-click",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",enableBackground:"new 0 0 24 24"},_react2.default.createElement("path",{d:"M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm1 15h-2v-2h2v2zm2.003-6.41c-.23.36-.6.704-1.108 1.028-.43.28-.7.482-.808.61-.108.13-.163.283-.163.46V13H11.04v-.528c0-.4.08-.74.245-1.017.163-.276.454-.546.872-.808.332-.21.57-.397.716-.565.145-.168.217-.36.217-.577 0-.172-.077-.308-.233-.41-.156-.1-.358-.15-.608-.15-.62 0-1.342.22-2.17.658l-.854-1.67c1.02-.58 2.084-.872 3.194-.872.913 0 1.63.202 2.15.603.52.4.78.948.78 1.64 0 .495-.116.924-.347 1.286z"})),_react2.default.createElement("p",{className:"post-excerpt-link__helper"},this.translate("The owner of this site only allows us to show a brief summary of their content. To view the full post, you'll have to visit their site.")))}});exports.default=PostExcerptLink;module.exports=exports["default"]},2430:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _includes2=__webpack_require__(30);var _includes3=_interopRequireDefault(_includes2);var _has2=__webpack_require__(175);var _has3=_interopRequireDefault(_has2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _readerAvatar=__webpack_require__(2468);var _readerAvatar2=_interopRequireDefault(_readerAvatar);var _readerAuthorLink=__webpack_require__(2467);var _readerAuthorLink2=_interopRequireDefault(_readerAuthorLink);var _readerSiteStreamLink=__webpack_require__(2476);var _readerSiteStreamLink2=_interopRequireDefault(_readerSiteStreamLink);var _followButton=__webpack_require__(1723);var _followButton2=_interopRequireDefault(_followButton);var _i18nCalypso=__webpack_require__(11);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _route=__webpack_require__(1740);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var AuthorCompactProfile=_react2.default.createClass({displayName:"AuthorCompactProfile",propTypes:{author:_react2.default.PropTypes.object.isRequired,siteName:_react2.default.PropTypes.string,siteUrl:_react2.default.PropTypes.string,feedUrl:_react2.default.PropTypes.string,followCount:_react2.default.PropTypes.number,feedId:_react2.default.PropTypes.number,siteId:_react2.default.PropTypes.number,siteIcon:_react2.default.PropTypes.string,feedIcon:_react2.default.PropTypes.string,post:_react2.default.PropTypes.object},render:function render(){var _props=this.props;var author=_props.author;var siteIcon=_props.siteIcon;var feedIcon=_props.feedIcon;var siteName=_props.siteName;var siteUrl=_props.siteUrl;var feedUrl=_props.feedUrl;var followCount=_props.followCount;var feedId=_props.feedId;var siteId=_props.siteId;var post=_props.post;if(!author){return null}var hasAuthorName=(0,_has3.default)(author,"name");var hasMatchingAuthorAndSiteNames=hasAuthorName&&siteName.toLowerCase()===author.name.toLowerCase();var classes=(0,_classnames2.default)("author-compact-profile",{"has-author-link":!hasMatchingAuthorAndSiteNames,"has-author-icon":siteIcon||feedIcon||author&&author.has_avatar});var streamUrl=(0,_route.getStreamUrl)(feedId,siteId);var authorNameBlacklist=["admin"];var followUrl=feedUrl||siteUrl;return _react2.default.createElement("div",{className:classes},_react2.default.createElement("a",{href:streamUrl,className:"author-compact-profile__avatar-link"},_react2.default.createElement(_readerAvatar2.default,{siteIcon:siteIcon,feedIcon:feedIcon,author:author})),hasAuthorName&&!hasMatchingAuthorAndSiteNames&&!(0,_includes3.default)(authorNameBlacklist,author.name.toLowerCase())&&_react2.default.createElement(_readerAuthorLink2.default,{author:author,siteUrl:streamUrl,post:post},author.name),siteName&&_react2.default.createElement(_readerSiteStreamLink2.default,{className:"author-compact-profile__site-link",feedId:feedId,siteId:siteId,post:post},siteName),_react2.default.createElement("div",{className:"author-compact-profile__follow"},followCount?_react2.default.createElement("div",{className:"author-compact-profile__follow-count"},this.props.translate("%(followCount)s follower","%(followCount)s followers",{count:followCount,args:{followCount:(0,_i18nCalypso.numberFormat)(followCount)}})):null,followUrl&&_react2.default.createElement(_followButton2.default,{siteUrl:followUrl})))}});exports.default=(0,_i18nCalypso.localize)(AuthorCompactProfile);module.exports=exports["default"]},2431:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _i18nCalypso=__webpack_require__(11);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var CommentCount=function CommentCount(_ref){var count=_ref.count;var translate=_ref.translate;var countPhrase=void 0;if(count>0){countPhrase=translate("%(commentCount)d comment","%(commentCount)d comments",{count:count,args:{commentCount:count}})}else{countPhrase=translate("No comments")}return _react2.default.createElement("div",{className:"comments__comment-count"},_react2.default.createElement("span",{className:"comments__comment-count-phrase"},countPhrase),count===0&&translate(" - Add the first! "))};CommentCount.propTypes={count:_react2.default.PropTypes.number.isRequired};exports.default=(0,_i18nCalypso.localize)(CommentCount);module.exports=exports["default"]},2432:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _pick2=__webpack_require__(91);var _pick3=_interopRequireDefault(_pick2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactRedux=__webpack_require__(15);var _redux=__webpack_require__(6);var _i18nCalypso=__webpack_require__(11);var _button=__webpack_require__(1962);var _button2=_interopRequireDefault(_button);var _stats=__webpack_require__(1643);var _actions=__webpack_require__(1755);var _selectors=__webpack_require__(1756);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var CommentLikeButtonContainer=function(_React$Component){(0,_inherits3.default)(CommentLikeButtonContainer,_React$Component);function CommentLikeButtonContainer(){(0,_classCallCheck3.default)(this,CommentLikeButtonContainer);var _this=(0,_possibleConstructorReturn3.default)(this,(CommentLikeButtonContainer.__proto__||(0,_getPrototypeOf2.default)(CommentLikeButtonContainer)).call(this));_this.boundHandleLikeToggle=_this.handleLikeToggle.bind(_this);return _this}(0,_createClass3.default)(CommentLikeButtonContainer,[{key:"handleLikeToggle",value:function handleLikeToggle(liked){if(liked){this.props.likeComment(this.props.siteId,this.props.postId,this.props.commentId)}else{this.props.unlikeComment(this.props.siteId,this.props.postId,this.props.commentId)}(0,_stats.recordAction)(liked?"liked_comment":"unliked_comment");(0,_stats.recordGaEvent)(liked?"Clicked Comment Like":"Clicked Comment Unlike");(0,_stats.recordTrack)("calypso_reader_"+(liked?"liked":"unliked")+"_comment",{blog_id:this.props.siteId,comment_id:this.props.commentId})}},{key:"render",value:function render(){var props=(0,_pick3.default)(this.props,["showZeroCount","tagName"]);var likeCount=this.props.commentLike.get("like_count");var iLike=this.props.commentLike.get("i_like");var likedLabel=(0,_i18nCalypso.translate)("Liked");return _react2.default.createElement(_button2.default,(0,_extends3.default)({},props,{likeCount:likeCount,liked:iLike,onLikeToggle:this.boundHandleLikeToggle,likedLabel:likedLabel,isMini:true}))}}]);return CommentLikeButtonContainer}(_react2.default.Component);CommentLikeButtonContainer.propTypes={siteId:_react2.default.PropTypes.number.isRequired,postId:_react2.default.PropTypes.number.isRequired,commentId:_react2.default.PropTypes.number.isRequired,showZeroCount:_react2.default.PropTypes.bool,tagName:_react2.default.PropTypes.string,commentLike:_react2.default.PropTypes.object.isRequired,likeComment:_react2.default.PropTypes.func.isRequired,unlikeComment:_react2.default.PropTypes.func.isRequired};exports.default=(0,_reactRedux.connect)(function(state,props){return{commentLike:(0,_selectors.getCommentLike)(state,props.siteId,props.postId,props.commentId)}},function(dispatch){return(0,_redux.bindActionCreators)({likeComment:_actions.likeComment,unlikeComment:_actions.unlikeComment},dispatch)})(CommentLikeButtonContainer);module.exports=exports["default"]},2433:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _postCommentList=__webpack_require__(2435);var _postCommentList2=_interopRequireDefault(_postCommentList);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_postCommentList2.default;module.exports=exports["default"]},2434:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var PostCommentContent=function(_React$Component){(0,_inherits3.default)(PostCommentContent,_React$Component);function PostCommentContent(){(0,_classCallCheck3.default)(this,PostCommentContent);return(0,_possibleConstructorReturn3.default)(this,(PostCommentContent.__proto__||(0,_getPrototypeOf2.default)(PostCommentContent)).apply(this,arguments))}(0,_createClass3.default)(PostCommentContent,[{key:"render",value:function render(){if(this.props.isPlaceholder){return _react2.default.createElement("div",{className:"comments__comment-content"},this.props.content)}return _react2.default.createElement("div",{className:"comments__comment-content",dangerouslySetInnerHTML:{__html:this.props.content}})}}]);return PostCommentContent}(_react2.default.Component);exports.default=PostCommentContent;PostCommentContent.propTypes={content:_react.PropTypes.string.isRequired,isPlaceholder:_react.PropTypes.bool};module.exports=exports["default"]},2435:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _get2=__webpack_require__(24);var _get3=_interopRequireDefault(_get2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactRedux=__webpack_require__(15);var _redux=__webpack_require__(6);var _i18nCalypso=__webpack_require__(11);var _selectors=__webpack_require__(1756);var _actions=__webpack_require__(1755);var _constants=__webpack_require__(741);var _stats=__webpack_require__(1643);var _postComment=__webpack_require__(2437);var _postComment2=_interopRequireDefault(_postComment);var _form=__webpack_require__(2025);var _form2=_interopRequireDefault(_form);var _commentCount=__webpack_require__(2431);var _commentCount2=_interopRequireDefault(_commentCount);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var PostCommentList=function(_React$Component){(0,_inherits3.default)(PostCommentList,_React$Component);function PostCommentList(props){(0,_classCallCheck3.default)(this,PostCommentList);var _this=(0,_possibleConstructorReturn3.default)(this,(PostCommentList.__proto__||(0,_getPrototypeOf2.default)(PostCommentList)).call(this));_this.state={activeReplyCommentID:null,amountOfCommentsToTake:props.initialSize};_this.viewEarlierCommentsHandler=_this.viewEarlierCommentsHandler.bind(_this);return _this}(0,_createClass3.default)(PostCommentList,[{key:"componentWillMount",value:function componentWillMount(){var siteId=this.props.post.site_ID;var postId=this.props.post.ID;this.props.requestPostComments(siteId,postId)}},{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){var nextSiteId=(0,_get3.default)(nextProps,"post.site_ID");var nextPostId=(0,_get3.default)(nextProps,"post.ID");if(nextSiteId&&nextPostId&&(this.props.post.site_ID!==nextSiteId||this.props.post.ID!==nextPostId)){this.props.requestPostComments(nextSiteId,nextPostId)}}},{key:"renderComment",value:function renderComment(commentId){if(!commentId){return null}var onReplyClick=this.onReplyClick.bind(this);var onReplyCancel=this.onReplyCancel.bind(this);var commentText=this.state.commentText;var onUpdateCommentText=this.onUpdateCommentText.bind(this);var resetActiveReplyComment=this.resetActiveReplyComment.bind(this);return _react2.default.createElement(_postComment2.default,{post:this.props.post,commentsTree:this.props.commentsTree,commentId:commentId,key:commentId,activeReplyCommentID:this.state.activeReplyCommentID,onReplyClick:onReplyClick,onReplyCancel:onReplyCancel,commentText:commentText,onUpdateCommentText:onUpdateCommentText,onCommentSubmit:resetActiveReplyComment,depth:0})}},{key:"onReplyClick",value:function onReplyClick(commentID){this.setState({activeReplyCommentID:commentID});(0,_stats.recordAction)("comment_reply_click");(0,_stats.recordGaEvent)("Clicked Reply to Comment");(0,_stats.recordTrack)("calypso_reader_comment_reply_click",{blog_id:this.props.post.site_ID,comment_id:commentID})}},{key:"onReplyCancel",value:function onReplyCancel(){(0,_stats.recordAction)("comment_reply_cancel_click");(0,_stats.recordGaEvent)("Clicked Cancel Reply to Comment");(0,_stats.recordTrack)("calypso_reader_comment_reply_cancel_click",{blog_id:this.props.post.site_ID,comment_id:this.state.activeReplyCommentID});this.resetActiveReplyComment()}},{key:"onUpdateCommentText",value:function onUpdateCommentText(commentText){this.setState({commentText:commentText})}},{key:"resetActiveReplyComment",value:function resetActiveReplyComment(){this.setState({activeReplyCommentID:null})}},{key:"renderCommentsList",value:function renderCommentsList(commentIds){var _this2=this;return _react2.default.createElement("ol",{className:"comments__list is-root"},commentIds.reverse().map(function(commentId){return _this2.renderComment(commentId)}))}},{key:"renderCommentForm",value:function renderCommentForm(){var post=this.props.post;var commentText=this.state.commentText;var onUpdateCommentText=this.onUpdateCommentText.bind(this);if(this.state.activeReplyCommentID&&!this.state.errors){return null}return _react2.default.createElement(_form2.default,{ref:"postCommentForm",post:post,parentCommentID:null,commentText:commentText,onUpdateCommentText:onUpdateCommentText})}},{key:"getCommentsCount",value:function getCommentsCount(commentIds){var _this3=this;return commentIds.reduce(function(prevSum,commentId){return prevSum+_this3.getCommentsCount(_this3.props.commentsTree.getIn([commentId,"children"]))+1},0)}},{key:"getDisplayedComments",value:function getDisplayedComments(commentIds,take){if(!commentIds){return null}var displayedComments=commentIds.take(take);return{displayedComments:displayedComments,displayedCommentsCount:this.getCommentsCount(displayedComments)}}},{key:"viewEarlierCommentsHandler",value:function viewEarlierCommentsHandler(){var siteId=this.props.post.site_ID;var postId=this.props.post.ID;var amountOfCommentsToTake=this.state.amountOfCommentsToTake+this.props.pageSize;this.setState({amountOfCommentsToTake:amountOfCommentsToTake});if(this.props.haveMoreCommentsToFetch){this.props.requestPostComments(siteId,postId)}}},{key:"render",value:function render(){if(!this.props.commentsTree){return null}var _getDisplayedComments=this.getDisplayedComments(this.props.commentsTree.get("children"),this.state.amountOfCommentsToTake);var displayedComments=_getDisplayedComments.displayedComments;var displayedCommentsCount=_getDisplayedComments.displayedCommentsCount;var showViewEarlier=this.props.commentsTree.get("children").size>this.state.amountOfCommentsToTake||this.props.haveMoreCommentsToFetch;var totalCommentsCount=this.props.haveMoreCommentsToFetch?this.props.totalCommentsCount:this.getCommentsCount(this.props.commentsTree.get("children"));return _react2.default.createElement("div",{className:"comments__comment-list"},(this.props.showCommentCount||showViewEarlier)&&_react2.default.createElement("div",{className:"comments__info-bar"},this.props.showCommentCount&&_react2.default.createElement(_commentCount2.default,{count:totalCommentsCount}),showViewEarlier?_react2.default.createElement("span",{className:"comments__view-earlier",onClick:this.viewEarlierCommentsHandler},(0,_i18nCalypso.translate)("View earlier comments (Showing %(shown)d of %(total)d)",{args:{shown:displayedCommentsCount,total:totalCommentsCount}})):null),this.renderCommentsList(displayedComments),this.renderCommentForm())}}]);return PostCommentList}(_react2.default.Component);PostCommentList.propTypes={post:_react2.default.PropTypes.shape({ID:_react2.default.PropTypes.number.isRequired,site_ID:_react2.default.PropTypes.number.isRequired}).isRequired,onCommentsUpdate:_react2.default.PropTypes.func.isRequired,pageSize:_react2.default.PropTypes.number,initialSize:_react2.default.PropTypes.number,showCommentCount:_react2.default.PropTypes.bool,commentsTree:_react2.default.PropTypes.object,totalCommentsCount:_react2.default.PropTypes.number,haveMoreCommentsToFetch:_react2.default.PropTypes.bool,requestPostComments:_react2.default.PropTypes.func.isRequired};PostCommentList.defaultProps={pageSize:_constants.NUMBER_OF_COMMENTS_PER_FETCH,initialSize:_constants.NUMBER_OF_COMMENTS_PER_FETCH,haveMoreCommentsToFetch:false,showCommentCount:true};exports.default=(0,_reactRedux.connect)(function(state,ownProps){return{commentsTree:(0,_selectors.getPostCommentsTree)(state,ownProps.post.site_ID,ownProps.post.ID),totalCommentsCount:(0,_selectors.getPostTotalCommentsCount)(state,ownProps.post.site_ID,ownProps.post.ID),haveMoreCommentsToFetch:(0,_selectors.haveMoreCommentsToFetch)(state,ownProps.post.site_ID,ownProps.post.ID)}},function(dispatch){return(0,_redux.bindActionCreators)({requestPostComments:_actions.requestPostComments},dispatch)})(PostCommentList);module.exports=exports["default"]},2436:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _form=__webpack_require__(2025);var _form2=_interopRequireDefault(_form);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var PostCommentWithError=function(_React$Component){(0,_inherits3.default)(PostCommentWithError,_React$Component);function PostCommentWithError(){(0,_classCallCheck3.default)(this,PostCommentWithError);return(0,_possibleConstructorReturn3.default)(this,(PostCommentWithError.__proto__||(0,_getPrototypeOf2.default)(PostCommentWithError)).apply(this,arguments))}(0,_createClass3.default)(PostCommentWithError,[{key:"renderCommentForm",value:function renderCommentForm(){var post=this.props.post;var commentText=this.props.commentsTree.getIn([this.props.commentId,"data","content"]);var commentParentId=this.props.commentsTree.getIn([this.props.commentId,"parentId"]);var placeholderError=this.props.commentsTree.getIn([this.props.commentId,"data","placeholderError"]);var onUpdateCommentText=this.props.onUpdateCommentText;return _react2.default.createElement(_form2.default,{ref:"postCommentForm",post:post,parentCommentID:commentParentId,commentText:commentText,onUpdateCommentText:onUpdateCommentText,placeholderId:this.props.commentId,error:placeholderError})}},{key:"render",value:function render(){return _react2.default.createElement("li",{className:"comments__comment is-error"},this.renderCommentForm(),this.props.repliesList)}}]);return PostCommentWithError}(_react2.default.Component);exports.default=PostCommentWithError;PostCommentWithError.propTypes={post:_react2.default.PropTypes.object.isRequired,repliesList:_react2.default.PropTypes.object.isRequired,commentsTree:_react2.default.PropTypes.object.isRequired,onUpdateCommentText:_react2.default.PropTypes.func.isRequired,commentId:_react2.default.PropTypes.oneOfType([_react2.default.PropTypes.string,_react2.default.PropTypes.number]).isRequired};module.exports=exports["default"]},2437:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);var _getOwnPropertyNames=__webpack_require__(1827);var _getOwnPropertyNames2=_interopRequireDefault(_getOwnPropertyNames);var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _noop2=__webpack_require__(38);var _noop3=_interopRequireDefault(_noop2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactRedux=__webpack_require__(15);var _i18nCalypso=__webpack_require__(11);var _selectors=__webpack_require__(90);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _postTime=__webpack_require__(1790);var _postTime2=_interopRequireDefault(_postTime);var _gravatar=__webpack_require__(710);var _gravatar2=_interopRequireDefault(_gravatar);var _stats=__webpack_require__(1643);var _route=__webpack_require__(1740);var _commentLikes=__webpack_require__(2432);var _commentLikes2=_interopRequireDefault(_commentLikes);var _postCommentContent=__webpack_require__(2434);var _postCommentContent2=_interopRequireDefault(_postCommentContent);var _form=__webpack_require__(2025);var _form2=_interopRequireDefault(_form);var _constants=__webpack_require__(741);var _formatting=__webpack_require__(81);var _postCommentWithError=__webpack_require__(2436);var _postCommentWithError2=_interopRequireDefault(_postCommentWithError);var _postTrackback=__webpack_require__(2438);var _postTrackback2=_interopRequireDefault(_postTrackback);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var PostComment=function(_React$Component){(0,_inherits3.default)(PostComment,_React$Component);function PostComment(){(0,_classCallCheck3.default)(this,PostComment);var _this=(0,_possibleConstructorReturn3.default)(this,(PostComment.__proto__||(0,_getPrototypeOf2.default)(PostComment)).call(this));_this.state={showReplies:false};(0,_getOwnPropertyNames2.default)(PostComment.prototype).filter(function(prop){return prop.indexOf("handle")===0}).filter(function(prop){return typeof _this[prop]==="function"}).forEach(function(prop){return _this[prop]=_this[prop].bind(_this)});return _this}(0,_createClass3.default)(PostComment,[{key:"handleToggleRepliesClick",value:function handleToggleRepliesClick(){this.setState({showReplies:!this.state.showReplies})}},{key:"handleReply",value:function handleReply(){this.props.onReplyClick(this.props.commentId);this.setState({showReplies:true})}},{key:"handleAuthorClick",value:function handleAuthorClick(event){(0,_stats.recordAction)("comment_author_click");(0,_stats.recordGaEvent)("Clicked Author Name");(0,_stats.recordTrack)("calypso_reader_comment_author_click",{blog_id:this.props.post.site_ID,post_id:this.props.post.ID,comment_id:this.props.commentId,author_url:event.target.href})}},{key:"renderRepliesList",value:function renderRepliesList(){var _this2=this;var commentChildrenIds=this.props.commentsTree.getIn([this.props.commentId,"children"]).toJS();var exceedsMaxChildrenToShow=commentChildrenIds.length<this.props.maxChildrenToShow;var showReplies=this.state.showReplies||exceedsMaxChildrenToShow;if(!commentChildrenIds||commentChildrenIds.length<1){return null}var showRepliesText=(0,_i18nCalypso.translate)("show %(numOfReplies)d reply","show %(numOfReplies)d replies",{count:commentChildrenIds.length,args:{numOfReplies:commentChildrenIds.length}});var hideRepliesText=(0,_i18nCalypso.translate)("hide %(numOfReplies)d reply","hide %(numOfReplies)d replies",{count:commentChildrenIds.length,args:{numOfReplies:commentChildrenIds.length}});var replyVisibilityText=null;if(!exceedsMaxChildrenToShow){replyVisibilityText=this.state.showReplies?hideRepliesText:showRepliesText}return _react2.default.createElement("div",null,!!replyVisibilityText?_react2.default.createElement("button",{className:"comments__view-replies-btn",onClick:this.handleToggleRepliesClick},_react2.default.createElement(_gridicon2.default,{icon:"reply",size:18})," ",replyVisibilityText):null,showReplies?_react2.default.createElement("ol",{className:"comments__list"},commentChildrenIds.reverse().map(function(childId){return _react2.default.createElement(PostComment,(0,_extends3.default)({},_this2.props,{depth:_this2.props.depth+1,key:childId,commentId:childId}))})):null)}},{key:"renderCommentForm",value:function renderCommentForm(){if(this.props.activeReplyCommentID!==this.props.commentId){return null}return _react2.default.createElement(_form2.default,{ref:"postCommentForm",post:this.props.post,parentCommentID:this.props.commentId,commentText:this.props.commentText,onUpdateCommentText:this.props.onUpdateCommentText,onCommentSubmit:this.props.onCommentSubmit})}},{key:"renderCommentActions",value:function renderCommentActions(comment){var post=this.props.post;var showReplyButton=post&&post.discussion&&post.discussion.comments_open===true;var showCancelReplyButton=this.props.activeReplyCommentID===this.props.commentId;if(comment.isPlaceholder||comment.status!=="approved"){return null}return _react2.default.createElement("div",{className:"comments__comment-actions"},showReplyButton?_react2.default.createElement("button",{className:"comments__comment-actions-reply",onClick:this.handleReply},_react2.default.createElement(_gridicon2.default,{icon:"reply",size:18}),_react2.default.createElement("span",{className:"comments__comment-actions-reply-label"},(0,_i18nCalypso.translate)("Reply"))):null,showCancelReplyButton&&_react2.default.createElement("button",{className:"comments__comment-actions-cancel-reply",onClick:this.props.onReplyCancel},(0,_i18nCalypso.translate)("Cancel reply")),_react2.default.createElement(_commentLikes2.default,{className:"comments__comment-actions-like",tagName:"button",siteId:this.props.post.site_ID,postId:this.props.post.ID,commentId:comment.ID}))}},{key:"render",value:function render(){var commentsTree=this.props.commentsTree;var comment=commentsTree.getIn([this.props.commentId,"data"]).toJS();var haveReplyWithError=commentsTree.getIn([this.props.commentId,"children"]).some(function(childId){return commentsTree.getIn([childId,"data","placeholderState"])===_constants.PLACEHOLDER_STATE.ERROR});if(comment.isPlaceholder){comment.author=this.props.currentUser;comment.author.name=this.props.currentUser.display_name}else{comment.author.name=(0,_formatting.decodeEntities)(comment.author.name)}if(comment.isPlaceholder&&comment.placeholderState===_constants.PLACEHOLDER_STATE.ERROR){return _react2.default.createElement(_postCommentWithError2.default,(0,_extends3.default)({},this.props,{repliesList:this.renderRepliesList()}))}if(comment.type==="trackback"||comment.type==="pingback"){return _react2.default.createElement(_postTrackback2.default,this.props);
}var authorUrl=void 0;if(comment.author.site_ID){authorUrl=(0,_route.getStreamUrl)(null,comment.author.site_ID)}else if(comment.author.URL){authorUrl=comment.author.URL}return _react2.default.createElement("li",{className:"comments__comment depth-"+this.props.depth},_react2.default.createElement("div",{className:"comments__comment-author"},authorUrl?_react2.default.createElement("a",{href:authorUrl,onClick:this.handleAuthorClick},_react2.default.createElement(_gravatar2.default,{user:comment.author})):_react2.default.createElement(_gravatar2.default,{user:comment.author}),authorUrl?_react2.default.createElement("a",{href:authorUrl,className:"comments__comment-username",onClick:this.handleAuthorClick},comment.author.name):_react2.default.createElement("strong",{className:"comments__comment-username"},comment.author.name),_react2.default.createElement("div",{className:"comments__comment-timestamp"},_react2.default.createElement("a",{href:comment.URL},_react2.default.createElement(_postTime2.default,{date:comment.date})))),comment.status&&comment.status==="unapproved"?_react2.default.createElement("p",{className:"comments__comment-moderation"},(0,_i18nCalypso.translate)("Your comment is awaiting moderation.")):null,_react2.default.createElement(_postCommentContent2.default,{content:comment.content,isPlaceholder:comment.isPlaceholder}),this.renderCommentActions(comment),haveReplyWithError?null:this.renderCommentForm(),this.renderRepliesList())}}]);return PostComment}(_react2.default.Component);PostComment.propTypes={commentsTree:_react2.default.PropTypes.object.isRequired,commentId:_react2.default.PropTypes.oneOfType([_react2.default.PropTypes.string,_react2.default.PropTypes.number]).isRequired,onReplyClick:_react2.default.PropTypes.func,depth:_react2.default.PropTypes.number,post:_react2.default.PropTypes.object,maxChildrenToShow:_react2.default.PropTypes.number,onCommentSubmit:_react2.default.PropTypes.func,currentUser:_react2.default.PropTypes.object.isRequired};PostComment.defaultProps={onReplyClick:_noop3.default,errors:[],depth:1,maxChildrenToShow:5,onCommentSubmit:_noop3.default};exports.default=(0,_reactRedux.connect)(function(state){return{currentUser:(0,_selectors.getCurrentUser)(state)}})(PostComment);module.exports=exports["default"]},2438:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _postTime=__webpack_require__(1790);var _postTime2=_interopRequireDefault(_postTime);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function unescape(str){return str.replace(/&#(\d+);/g,function(match,entity){return String.fromCharCode(entity)})}var PostTrackback=function(_React$Component){(0,_inherits3.default)(PostTrackback,_React$Component);function PostTrackback(){(0,_classCallCheck3.default)(this,PostTrackback);return(0,_possibleConstructorReturn3.default)(this,(PostTrackback.__proto__||(0,_getPrototypeOf2.default)(PostTrackback)).apply(this,arguments))}(0,_createClass3.default)(PostTrackback,[{key:"render",value:function render(){var commentsTree=this.props.commentsTree;var comment=commentsTree.getIn([this.props.commentId,"data"]).toJS();var unescapedAuthorName=unescape(comment.author.name);return _react2.default.createElement("li",{className:"comments__comment depth-0"},_react2.default.createElement("div",{className:"comments__comment-author"},_react2.default.createElement("div",{className:"comments__comment-trackbackicon"},_react2.default.createElement(_gridicon2.default,{icon:"link",size:24})),comment.author.URL?_react2.default.createElement("a",{href:comment.author.URL,target:"_blank",rel:"noopener noreferrer",className:"comments__comment-username"},unescapedAuthorName):_react2.default.createElement("strong",{className:"comments__comment-username"},unescapedAuthorName),_react2.default.createElement("div",{className:"comments__comment-timestamp"},_react2.default.createElement("a",{href:comment.URL},_react2.default.createElement(_postTime2.default,{date:comment.date})))))}}]);return PostTrackback}(_react2.default.Component);exports.default=PostTrackback;PostTrackback.propTypes={commentId:_react2.default.PropTypes.number};module.exports=exports["default"]},2447:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _i18nCalypso=__webpack_require__(11);var _utils=__webpack_require__(1649);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var PostEditButton=function PostEditButton(_ref){var post=_ref.post;var site=_ref.site;var size=_ref.size;var onClick=_ref.onClick;var translate=_ref.translate;var editUrl=(0,_utils.getEditURL)(post,site);return _react2.default.createElement("a",{className:"post-edit-button",href:editUrl,onClick:onClick},_react2.default.createElement(_gridicon2.default,{icon:"pencil",size:size,className:"post-edit-button__icon"}),_react2.default.createElement("span",{className:"post-edit-button__label"},translate("Edit")))};PostEditButton.propTypes={post:_react2.default.PropTypes.object.isRequired,site:_react2.default.PropTypes.object.isRequired,size:_react2.default.PropTypes.number,onClick:_react2.default.PropTypes.func};PostEditButton.defaultProps={size:24};exports.default=(0,_i18nCalypso.localize)(PostEditButton);module.exports=exports["default"]},2467:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _objectDestructuringEmpty2=__webpack_require__(2017);var _objectDestructuringEmpty3=_interopRequireDefault(_objectDestructuringEmpty2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _stats=__webpack_require__(1643);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ReaderAuthorLink=function ReaderAuthorLink(_ref){var author=_ref.author;var post=_ref.post;var siteUrl=_ref.siteUrl;var children=_ref.children;var recordAuthorClick=function recordAuthorClick(_ref2){(0,_objectDestructuringEmpty3.default)(_ref2);(0,_stats.recordAction)("click_author");(0,_stats.recordGaEvent)("Clicked Author Link");if(post){(0,_stats.recordTrackForPost)("calypso_reader_author_link_clicked",post)}};if(!siteUrl){siteUrl=author.URL}if(!siteUrl){return children}return _react2.default.createElement("a",{className:"reader-author-link",href:siteUrl,onClick:recordAuthorClick},children)};ReaderAuthorLink.propTypes={author:_react2.default.PropTypes.object.isRequired,post:_react2.default.PropTypes.object,siteUrl:_react2.default.PropTypes.string};exports.default=ReaderAuthorLink;module.exports=exports["default"]},2468:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _slicedToArray2=__webpack_require__(137);var _slicedToArray3=_interopRequireDefault(_slicedToArray2);var _startsWith2=__webpack_require__(83);var _startsWith3=_interopRequireDefault(_startsWith2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _gravatar=__webpack_require__(710);var _gravatar2=_interopRequireDefault(_gravatar);var _siteIcon=__webpack_require__(281);var _siteIcon2=_interopRequireDefault(_siteIcon);var _i18nCalypso=__webpack_require__(11);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ReaderAvatar=_react2.default.createClass({displayName:"ReaderAvatar",propTypes:{author:_react2.default.PropTypes.object.isRequired,siteIcon:_react2.default.PropTypes.string,feedIcon:_react2.default.PropTypes.string},render:function render(){var _props=this.props;var author=_props.author;var siteIcon=_props.siteIcon;var feedIcon=_props.feedIcon;var fakeSite=void 0;if(siteIcon){fakeSite={icon:{img:siteIcon}}}else if(feedIcon){fakeSite={icon:{img:feedIcon}}}var hasSiteIcon=!!siteIcon;var hasAvatar=!!(author&&author.has_avatar);if(hasSiteIcon&&hasAvatar){var _siteIcon$split=siteIcon.split("?");var _siteIcon$split2=(0,_slicedToArray3.default)(_siteIcon$split,1);var withoutQuery=_siteIcon$split2[0];if((0,_startsWith3.default)(author.avatar_URL,withoutQuery)){hasAvatar=false}}var hasBothIcons=hasSiteIcon&&hasAvatar;var classes=(0,_classnames2.default)("reader-avatar",{"has-site-and-author-icon":hasBothIcons,"has-site-icon":hasSiteIcon,"has-gravatar":hasAvatar});return _react2.default.createElement("div",{className:classes},hasSiteIcon&&_react2.default.createElement(_siteIcon2.default,{size:96,site:fakeSite}),hasAvatar&&_react2.default.createElement(_gravatar2.default,{user:author,size:hasBothIcons?32:96}))}});exports.default=(0,_i18nCalypso.localize)(ReaderAvatar);module.exports=exports["default"]},2469:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var FeaturedImage=function(_React$Component){(0,_inherits3.default)(FeaturedImage,_React$Component);function FeaturedImage(props){(0,_classCallCheck3.default)(this,FeaturedImage);var _this=(0,_possibleConstructorReturn3.default)(this,(FeaturedImage.__proto__||(0,_getPrototypeOf2.default)(FeaturedImage)).call(this));_this.state={src:props.src};_this.handleImageError=function(){_this.setState({src:""})};return _this}(0,_createClass3.default)(FeaturedImage,[{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){if(nextProps.src!==this.props.src){this.setState({src:nextProps.src})}}},{key:"render",value:function render(){if(!this.state.src){return null}return _react2.default.createElement("div",{className:"reader-full-post__featured-image"},_react2.default.createElement("img",{src:this.state.src,onError:this.handleImageError}))}}]);return FeaturedImage}(_react2.default.Component);exports.default=FeaturedImage;FeaturedImage.propTypes={src:_react2.default.PropTypes.string};module.exports=exports["default"]},2470:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _values2=__webpack_require__(210);var _values3=_interopRequireDefault(_values2);var _map2=__webpack_require__(45);var _map3=_interopRequireDefault(_map2);var _take2=__webpack_require__(1947);var _take3=_interopRequireDefault(_take2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ReaderFullPostHeaderTags=function ReaderFullPostHeaderTags(_ref){var tags=_ref.tags;var numberOfTagsToDisplay=5;var tagsToDisplay=(0,_take3.default)((0,_values3.default)(tags),numberOfTagsToDisplay);var listItems=(0,_map3.default)(tagsToDisplay,function(tag){return _react2.default.createElement("li",{key:"post-tag-"+tag.slug,className:"reader-full-post__header-tag-list-item"},_react2.default.createElement("a",{href:"/tag/"+tag.slug,className:"reader-full-post__header-tag-list-item-link"},tag.name))});return _react2.default.createElement("ul",{className:"reader-full-post__header-tag-list"},listItems)};ReaderFullPostHeaderTags.propTypes={tags:_react2.default.PropTypes.object.isRequired};exports.default=ReaderFullPostHeaderTags;module.exports=exports["default"]},2471:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _objectDestructuringEmpty2=__webpack_require__(2017);var _objectDestructuringEmpty3=_interopRequireDefault(_objectDestructuringEmpty2);var _trim2=__webpack_require__(219);var _trim3=_interopRequireDefault(_trim2);var _keys2=__webpack_require__(64);var _keys3=_interopRequireDefault(_keys2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _externalLink=__webpack_require__(394);var _externalLink2=_interopRequireDefault(_externalLink);var _stats=__webpack_require__(1643);var _postTime=__webpack_require__(1790);var _postTime2=_interopRequireDefault(_postTime);var _headerTags=__webpack_require__(2470);var _headerTags2=_interopRequireDefault(_headerTags);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ReaderFullPostHeader=function ReaderFullPostHeader(_ref){var post=_ref.post;var handlePermalinkClick=function handlePermalinkClick(_ref2){(0,_objectDestructuringEmpty3.default)(_ref2);(0,_stats.recordPermalinkClick)("full_post_title")};var recordDateClick=function recordDateClick(_ref3){(0,_objectDestructuringEmpty3.default)(_ref3);(0,_stats.recordPermalinkClick)("timestamp");(0,_stats.recordGaEvent)("Clicked Post Permalink","timestamp")};var classes={"reader-full-post__header":true};if(!post.title||(0,_trim3.default)(post.title).length<1){classes["is-missing-title"]=true}return _react2.default.createElement("div",{className:(0,_classnames2.default)(classes)},post.title?_react2.default.createElement("h1",{className:"reader-full-post__header-title",onClick:handlePermalinkClick},_react2.default.createElement(_externalLink2.default,{className:"reader-full-post__header-title-link",href:post.URL,target:"_blank",icon:false},post.title)):null,_react2.default.createElement("div",{className:"reader-full-post__header-meta"},post.date?_react2.default.createElement("span",{className:"reader-full-post__header-date"},_react2.default.createElement("a",{className:"reader-full-post__header-date-link",onClick:recordDateClick,href:post.URL,target:"_blank",rel:"noopener noreferrer"},_react2.default.createElement(_postTime2.default,{date:post.date}))):null,post.tags&&(0,_keys3.default)(post.tags).length>0?_react2.default.createElement("div",{className:"reader-full-post__header-tags"},_react2.default.createElement(_gridicon2.default,{icon:"tag",size:18}),_react2.default.createElement(_headerTags2.default,{tags:post.tags})):null))};ReaderFullPostHeader.propTypes={post:_react2.default.PropTypes.object.isRequired};exports.default=ReaderFullPostHeader;module.exports=exports["default"]},2472:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.FullPostFluxContainer=exports.FullPostView=undefined;var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _get2=__webpack_require__(24);var _get3=_interopRequireDefault(_get2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactDom=__webpack_require__(44);var _reactDom2=_interopRequireDefault(_reactDom);var _reactRedux=__webpack_require__(15);var _redux=__webpack_require__(6);var _i18nCalypso=__webpack_require__(11);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _config=__webpack_require__(12);var _config2=_interopRequireDefault(_config);var _twemoji=__webpack_require__(2023);var _twemoji2=_interopRequireDefault(_twemoji);var _readerMain=__webpack_require__(2528);var _readerMain2=_interopRequireDefault(_readerMain);var _button=__webpack_require__(69);var _button2=_interopRequireDefault(_button);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _embedContainer=__webpack_require__(2043);var _embedContainer2=_interopRequireDefault(_embedContainer);var _postExcerpt=__webpack_require__(1889);var _postExcerpt2=_interopRequireDefault(_postExcerpt);var _actions=__webpack_require__(225);var _reactSmartSetState=__webpack_require__(1710);var _reactSmartSetState2=_interopRequireDefault(_reactSmartSetState);var _feedPostStore=__webpack_require__(1763);var _feedPostStore2=_interopRequireDefault(_feedPostStore);var _readerSiteStore=__webpack_require__(1711);var _readerSiteStore2=_interopRequireDefault(_readerSiteStore);var _feedStore=__webpack_require__(1750);var _feedStore2=_interopRequireDefault(_feedStore);var _actions2=__webpack_require__(1897);var _actions3=__webpack_require__(1815);var _actions4=__webpack_require__(1813);var _actions5=_interopRequireDefault(_actions4);var _header=__webpack_require__(2471);var _header2=_interopRequireDefault(_header);var _authorCompactProfile=__webpack_require__(2430);var _authorCompactProfile2=_interopRequireDefault(_authorCompactProfile);var _likeButton=__webpack_require__(1857);var _likeButton2=_interopRequireDefault(_likeButton);var _helper=__webpack_require__(1674);var _helper2=__webpack_require__(2001);var _siteAttribution=__webpack_require__(2164);var _siteAttribution2=_interopRequireDefault(_siteAttribution);var _dailyPost=__webpack_require__(2163);var _dailyPost2=_interopRequireDefault(_dailyPost);var _likeHelper=__webpack_require__(1919);var _helper3=__webpack_require__(2026);var _commentButton=__webpack_require__(1834);var _commentButton2=_interopRequireDefault(_commentButton);var _stats=__webpack_require__(1643);var _comments=__webpack_require__(2433);var _comments2=_interopRequireDefault(_comments);var _scrollTo=__webpack_require__(410);var _scrollTo2=_interopRequireDefault(_scrollTo);var _postExcerptLink=__webpack_require__(2353);var _postExcerptLink2=_interopRequireDefault(_postExcerptLink);var _utils=__webpack_require__(2005);var _keyboardShortcuts=__webpack_require__(296);var _keyboardShortcuts2=_interopRequireDefault(_keyboardShortcuts);var _readerPostActions=__webpack_require__(2473);var _readerPostActions2=_interopRequireDefault(_readerPostActions);var _constants=__webpack_require__(1738);var _relatedPostsV=__webpack_require__(2529);var _route=__webpack_require__(1740);var _displayTypes=__webpack_require__(2012);var _actions6=__webpack_require__(1975);var _likeStore=__webpack_require__(2070);var _likeStore2=_interopRequireDefault(_likeStore);var _featuredImage=__webpack_require__(2469);var _featuredImage2=_interopRequireDefault(_featuredImage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var FullPostView=exports.FullPostView=function(_React$Component){(0,_inherits3.default)(FullPostView,_React$Component);function FullPostView(props){(0,_classCallCheck3.default)(this,FullPostView);var _this=(0,_possibleConstructorReturn3.default)(this,(FullPostView.__proto__||(0,_getPrototypeOf2.default)(FullPostView)).call(this,props));["handleBack","handleCommentClick","handleLike","handleRelatedPostFromSameSiteClicked","handleRelatedPostFromOtherSiteClicked"].forEach(function(fn){_this[fn]=_this[fn].bind(_this)});_this.hasScrolledToCommentAnchor=false;return _this}(0,_createClass3.default)(FullPostView,[{key:"componentDidMount",value:function componentDidMount(){_keyboardShortcuts2.default.on("close-full-post",this.handleBack);_keyboardShortcuts2.default.on("like-selection",this.handleLike);this.parseEmoji();this.hasSentPageView=false;this.hasLoaded=false;this.attemptToSendPageView();this.checkForCommentAnchor();if(this.hasCommentAnchor&&!this.hasScrolledToCommentAnchor){this.scrollToComments()}}},{key:"componentDidUpdate",value:function componentDidUpdate(prevProps){this.parseEmoji();if((0,_get3.default)(prevProps,"post.ID")!==(0,_get3.default)(this.props,"post.ID")||(0,_get3.default)(prevProps,"feed.ID")!==(0,_get3.default)(this.props,"feed.ID")||(0,_get3.default)(prevProps,"site.ID")!==(0,_get3.default)(this.props,"site.ID")){this.hasSentPageView=false;this.hasLoaded=false;this.attemptToSendPageView()}this.checkForCommentAnchor();if(this.hasCommentAnchor&&!this.hasScrolledToCommentAnchor){this.scrollToComments()}}},{key:"componentWillReceiveProps",value:function componentWillReceiveProps(newProps){if(newProps.shouldShowComments){this.hasScrolledToCommentAnchor=false;this.checkForCommentAnchor()}}},{key:"componentWillUnmount",value:function componentWillUnmount(){_keyboardShortcuts2.default.off("close-full-post",this.handleBack);_keyboardShortcuts2.default.off("like-selection",this.handleLike)}},{key:"handleBack",value:function handleBack(){(0,_stats.recordAction)("full_post_close");(0,_stats.recordGaEvent)("Closed Full Post Dialog");(0,_stats.recordTrackForPost)("calypso_reader_article_closed",this.props.post);this.props.onClose&&this.props.onClose()}},{key:"handleCommentClick",value:function handleCommentClick(){(0,_stats.recordAction)("click_comments");(0,_stats.recordGaEvent)("Clicked Post Comment Button");(0,_stats.recordTrackForPost)("calypso_reader_full_post_comments_button_clicked",this.props.post);this.scrollToComments()}},{key:"handleLike",value:function handleLike(){var _props$post=this.props.post;var siteId=_props$post.site_ID;var postId=_props$post.ID;var liked=void 0;if(_likeStore2.default.isPostLikedByCurrentUser(siteId,postId)){(0,_actions6.unlikePost)(siteId,postId);liked=false}else{(0,_actions6.likePost)(siteId,postId);liked=true}(0,_stats.recordAction)(liked?"liked_post":"unliked_post");(0,_stats.recordGaEvent)(liked?"Clicked Like Post":"Clicked Unlike Post");(0,_stats.recordTrackForPost)(liked?"calypso_reader_article_liked":"calypso_reader_article_unliked",this.props.post,{context:"full-post",event_source:"keyboard"})}},{key:"handleRelatedPostFromSameSiteClicked",value:function handleRelatedPostFromSameSiteClicked(){(0,_stats.recordTrackForPost)("calypso_reader_related_post_from_same_site_clicked",this.props.post)}},{key:"handleRelatedPostFromOtherSiteClicked",value:function handleRelatedPostFromOtherSiteClicked(){(0,_stats.recordTrackForPost)("calypso_reader_related_post_from_other_site_clicked",this.props.post)}},{key:"checkForCommentAnchor",value:function checkForCommentAnchor(){var hash=window.location.hash.substr(1);if(hash.indexOf("comments")>-1){this.hasCommentAnchor=true}}},{key:"scrollToComments",value:function scrollToComments(){var _this2=this;if(!this.props.post){return}if(this.props.post._state){return}if(this._scrolling){return}this._scrolling=true;setTimeout(function(){var commentsNode=_reactDom2.default.findDOMNode(_this2.refs.commentsWrapper);if(commentsNode&&commentsNode.offsetTop){(0,_scrollTo2.default)({x:0,y:commentsNode.offsetTop-48,duration:300,onComplete:function onComplete(){var commentsNodeAfterScroll=_reactDom2.default.findDOMNode(_this2.refs.commentsWrapper);if(commentsNodeAfterScroll&&commentsNodeAfterScroll.offsetTop){window.scrollTo(0,commentsNodeAfterScroll.offsetTop-48)}_this2._scrolling=false}});if(_this2.hasCommentAnchor){_this2.hasScrolledToCommentAnchor=true}}},0)}},{key:"parseEmoji",value:function parseEmoji(){_twemoji2.default.parse(this.refs.article,{base:(0,_config2.default)("twemoji_cdn_url")})}},{key:"attemptToSendPageView",value:function attemptToSendPageView(){var _props=this.props;var post=_props.post;var site=_props.site;if(post&&post._state!=="pending"&&site&&site.state===_constants.state.COMPLETE&&!this.hasSentPageView){_actions5.default.markSeen(post);this.hasSentPageView=true}if(!this.hasLoaded&&post&&post._state!=="pending"){(0,_stats.recordTrackForPost)("calypso_reader_article_opened",post);this.hasLoaded=true}}},{key:"render",value:function render(){var _props2=this.props;var post=_props2.post;var site=_props2.site;var feed=_props2.feed;var siteName=(0,_utils.siteNameFromSiteAndPost)(site,post);var classes={"reader-full-post":true};var showRelatedPosts=!post.is_external&&post.site_ID;var relatedPostsFromOtherSitesTitle=(0,_i18nCalypso.translate)("More on {{wpLink}}WordPress.com{{/wpLink}}",{components:{wpLink:_react2.default.createElement("a",{href:"/",className:"reader-related-card-v2__link"})}});if(post.site_ID){classes["blog-"+post.site_ID]=true}if(post.feed_ID){classes["feed-"+post.feed_ID]=true}return _react2.default.createElement(_readerMain2.default,{className:(0,_classnames2.default)(classes)},_react2.default.createElement("div",{className:"reader-full-post__back-container"},_react2.default.createElement(_button2.default,{className:"reader-full-post__back",borderless:true,compact:true,onClick:this.handleBack},_react2.default.createElement(_gridicon2.default,{icon:"arrow-left"})," ",(0,_i18nCalypso.translate)("Back"))),_react2.default.createElement("div",{className:"reader-full-post__content"},_react2.default.createElement("div",{className:"reader-full-post__sidebar"},post.author&&_react2.default.createElement(_authorCompactProfile2.default,{author:post.author,siteIcon:(0,_get3.default)(site,"icon.img"),feedIcon:(0,_get3.default)(feed,"image"),siteName:post.site_name,siteUrl:post.site_URL,feedUrl:(0,_get3.default)(feed,"feed_URL"),followCount:site&&site.subscribers_count,feedId:+post.feed_ID,siteId:+post.site_ID,post:post}),(0,_helper3.shouldShowComments)(post)&&_react2.default.createElement(_commentButton2.default,{key:"comment-button",commentCount:post.discussion.comment_count,onClick:this.handleCommentClick,tagName:"div"}),(0,_likeHelper.shouldShowLikes)(post)&&_react2.default.createElement(_likeButton2.default,{siteId:+post.site_ID,postId:+post.ID,fullPost:true,tagName:"div"})),_react2.default.createElement("article",{className:"reader-full-post__story",ref:"article"},_react2.default.createElement(_header2.default,{post:post}),post.featured_image&&!(post.display_type&_displayTypes.CANONICAL_IN_CONTENT)&&_react2.default.createElement(_featuredImage2.default,{src:post.featured_image}),post.use_excerpt?_react2.default.createElement(_postExcerpt2.default,{content:post.better_excerpt?post.better_excerpt:post.excerpt}):_react2.default.createElement(_embedContainer2.default,null,_react2.default.createElement("div",{className:"reader-full-post__story-content reader__full-post-content",dangerouslySetInnerHTML:{__html:post.content}})),post.use_excerpt&&!(0,_helper.isDiscoverPost)(post)?_react2.default.createElement(_postExcerptLink2.default,{siteName:siteName,postUrl:post.URL}):null,(0,_helper.isDiscoverSitePick)(post)?_react2.default.createElement(_siteAttribution2.default,{attribution:post.discover_metadata.attribution,siteUrl:(0,_helper.getSiteUrl)(post),followUrl:(0,_helper.getSourceFollowUrl)(post)}):null,(0,_helper2.isDailyPostChallengeOrPrompt)(post)?_react2.default.createElement(_dailyPost2.default,{post:post,tagName:"span"}):null,_react2.default.createElement(_readerPostActions2.default,{post:post,site:site,onCommentClick:this.handleCommentClick}),showRelatedPosts&&_react2.default.createElement(_relatedPostsV.RelatedPostsFromSameSite,{siteId:+post.site_ID,postId:+post.ID,title:(0,_i18nCalypso.translate)("More in {{ siteLink /}}",{components:{siteLink:_react2.default.createElement("a",{href:(0,_route.getStreamUrlFromPost)(post),className:"reader-related-card-v2__link"},siteName)}}),className:"is-same-site",onPostClick:this.handleRelatedPostFromSameSiteClicked}),_react2.default.createElement("div",{className:"reader-full-post__comments-wrapper",ref:"commentsWrapper"},(0,_helper3.shouldShowComments)(post)?_react2.default.createElement(_comments2.default,{ref:"commentsList",post:post,initialSize:25,pageSize:25,onCommentsUpdate:this.checkForCommentAnchor}):null),showRelatedPosts&&_react2.default.createElement(_relatedPostsV.RelatedPostsFromOtherSites,{siteId:+post.site_ID,postId:+post.ID,title:relatedPostsFromOtherSitesTitle,className:"is-other-site",onPostClick:this.handleRelatedPostFromOtherSiteClicked}))))}}]);return FullPostView}(_react2.default.Component);var FullPostFluxContainer=exports.FullPostFluxContainer=function(_React$Component2){(0,_inherits3.default)(FullPostFluxContainer,_React$Component2);function FullPostFluxContainer(props){(0,_classCallCheck3.default)(this,FullPostFluxContainer);var _this3=(0,_possibleConstructorReturn3.default)(this,(FullPostFluxContainer.__proto__||(0,_getPrototypeOf2.default)(FullPostFluxContainer)).call(this,props));_this3.state=_this3.getStateFromStores(props);_this3.updateState=_this3.updateState.bind(_this3);_this3.smartSetState=_reactSmartSetState2.default;return _this3}(0,_createClass3.default)(FullPostFluxContainer,[{key:"getStateFromStores",value:function getStateFromStores(){var props=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.props;var postKey={blogId:props.blogId,feedId:props.feedId,postId:props.postId};var post=_feedPostStore2.default.get(postKey);if(!post){(0,_actions4.fetchPost)(postKey)}var feed=void 0,site=void 0;if(post&&post.feed_ID){feed=_feedStore2.default.get(post.feed_ID);if(!feed){(0,_actions2.fetch)(post.feed_ID)}}if(post&&post.site_ID&&!post.is_external){site=_readerSiteStore2.default.get(post.site_ID);if(!site){(0,_actions3.fetch)(post.site_ID)}}return{post:post,site:site,feed:feed}}},{key:"updateState",value:function updateState(){var newState=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.getStateFromStores();this.smartSetState(newState)}},{key:"componentWillMount",value:function componentWillMount(){_feedPostStore2.default.on("change",this.updateState);_readerSiteStore2.default.on("change",this.updateState);_feedStore2.default.on("change",this.updateState)}},{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){this.updateState(this.getStateFromStores(nextProps))}},{key:"componentWillUnmount",value:function componentWillUnmount(){_feedPostStore2.default.off("change",this.updateState);_readerSiteStore2.default.off("change",this.updateState);_feedStore2.default.off("change",this.updateState)}},{key:"render",value:function render(){return this.state.post?_react2.default.createElement(FullPostView,{onClose:this.props.onClose,post:this.state.post,site:this.state.site&&this.state.site.toJS(),feed:this.state.feed&&this.state.feed.toJS()}):null}}]);return FullPostFluxContainer}(_react2.default.Component);exports.default=(0,_reactRedux.connect)(function(state){return{}},function(dispatch){return(0,_redux.bindActionCreators)({setSection:_actions.setSection},dispatch)})(FullPostFluxContainer)},2473:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _commentButton=__webpack_require__(1834);var _commentButton2=_interopRequireDefault(_commentButton);var _likeButton=__webpack_require__(1857);var _likeButton2=_interopRequireDefault(_likeButton);
var _share=__webpack_require__(2173);var _share2=_interopRequireDefault(_share);var _postEditButton=__webpack_require__(2447);var _postEditButton2=_interopRequireDefault(_postEditButton);var _helper=__webpack_require__(2026);var _likeHelper=__webpack_require__(1919);var _helper2=__webpack_require__(2172);var _utils=__webpack_require__(1649);var _stats=__webpack_require__(1643);var stats=_interopRequireWildcard(_stats);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ReaderPostActions=function ReaderPostActions(_ref){var post=_ref.post;var site=_ref.site;var onCommentClick=_ref.onCommentClick;var showEdit=_ref.showEdit;var onEditClick=function onEditClick(){stats.recordAction("edit_post");stats.recordGaEvent("Clicked Edit Post","full_post");stats.recordTrackForPost("calypso_reader_edit_post_clicked",post)};return _react2.default.createElement("ul",{className:"reader-post-actions"},showEdit&&site&&(0,_utils.userCan)("edit_post",post)&&_react2.default.createElement("li",{className:"reader-post-actions__item"},_react2.default.createElement(_postEditButton2.default,{post:post,site:site,onClick:onEditClick})),(0,_helper2.shouldShowShare)(post)&&_react2.default.createElement("li",{className:"reader-post-actions__item"},_react2.default.createElement(_share2.default,{post:post,position:"bottom",tagName:"div"})),(0,_helper.shouldShowComments)(post)&&_react2.default.createElement("li",{className:"reader-post-actions__item"},_react2.default.createElement(_commentButton2.default,{key:"comment-button",commentCount:post.discussion.comment_count,onClick:onCommentClick,tagName:"div"})),(0,_likeHelper.shouldShowLikes)(post)&&_react2.default.createElement("li",{className:"reader-post-actions__item"},_react2.default.createElement(_likeButton2.default,{key:"like-button",siteId:+post.site_ID,postId:+post.ID,fullPost:true,tagName:"div",forceCounter:true})))};ReaderPostActions.propTypes={post:_react2.default.PropTypes.object.isRequired,site:_react2.default.PropTypes.object,onCommentClick:_react2.default.PropTypes.func,showEdit:_react2.default.PropTypes.bool};ReaderPostActions.defaultProps={showEdit:true};exports.default=ReaderPostActions;module.exports=exports["default"]},2474:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.LocalizedRelatedPostCard=undefined;exports.RelatedPostCard=RelatedPostCard;var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactRedux=__webpack_require__(15);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _noop=__webpack_require__(38);var _noop2=_interopRequireDefault(_noop);var _partial=__webpack_require__(286);var _partial2=_interopRequireDefault(_partial);var _i18nCalypso=__webpack_require__(11);var _selectors=__webpack_require__(2013);var _selectors2=__webpack_require__(2014);var _compact=__webpack_require__(1642);var _compact2=_interopRequireDefault(_compact);var _gravatar=__webpack_require__(710);var _gravatar2=_interopRequireDefault(_gravatar);var _followButton=__webpack_require__(1723);var _followButton2=_interopRequireDefault(_followButton);var _route=__webpack_require__(1740);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function FeaturedImage(_ref){var image=_ref.image;var href=_ref.href;return _react2.default.createElement("div",{className:"reader-related-card-v2__featured-image",href:href,style:{backgroundImage:"url("+image.uri+")",backgroundSize:"cover",backgroundRepeat:"no-repeat",backgroundPosition:"50% 50%"}})}function AuthorAndSiteFollow(_ref2){var post=_ref2.post;var site=_ref2.site;var siteUrl=(0,_route.getStreamUrl)(post.feed_ID,post.site_ID);var authorAndSiteAreDifferent=site.title.toLowerCase()!==post.author.name.toLowerCase();return _react2.default.createElement("div",{className:"reader-related-card-v2__meta"},_react2.default.createElement("a",{href:siteUrl},_react2.default.createElement(_gravatar2.default,{user:post.author})),_react2.default.createElement("div",{className:"reader-related-card-v2__byline"},_react2.default.createElement("span",{className:"reader-related-card-v2__byline-author"},_react2.default.createElement("a",{href:siteUrl,className:"reader-related-card-v2__link"},post.author.name)),authorAndSiteAreDifferent&&_react2.default.createElement("span",{className:"reader-related-card-v2__byline-site"},_react2.default.createElement("a",{href:siteUrl,className:"reader-related-card-v2__link"},site.title))),_react2.default.createElement(_followButton2.default,{siteUrl:post.site_URL}))}function AuthorAndSiteFollowPlaceholder(){return _react2.default.createElement("div",{className:"reader-related-card-v2__meta is-placeholder"},_react2.default.createElement(_gravatar2.default,{user:null}),_react2.default.createElement("div",{className:"reader-related-card-v2__byline"},_react2.default.createElement("span",{className:"reader-related-card-v2__byline-author"},"Author name"),_react2.default.createElement("span",{className:"reader-related-card-v2__byline-site"},"Site title")))}function RelatedPostCardPlaceholder(){return _react2.default.createElement(_compact2.default,{className:"reader-related-card-v2 is-placeholder"},_react2.default.createElement(AuthorAndSiteFollowPlaceholder,null),_react2.default.createElement("a",{className:"reader-related-card-v2__post reader-related-card-v2__link-block"},_react2.default.createElement("div",{className:"reader-related-card-v2__featured-image"}),_react2.default.createElement("div",{className:"reader-related-card-v2__site-info"},_react2.default.createElement("h1",{className:"reader-related-card-v2__title"},"Title"),_react2.default.createElement("div",{className:"reader-related-card-v2__excerpt post-excerpt"},"Excerpt"))))}function RelatedPostCard(_ref3){var post=_ref3.post;var site=_ref3.site;var _ref3$onPostClick=_ref3.onPostClick;var onPostClick=_ref3$onPostClick===undefined?_noop2.default:_ref3$onPostClick;var _ref3$onSiteClick=_ref3.onSiteClick;var onSiteClick=_ref3$onSiteClick===undefined?_noop2.default:_ref3$onSiteClick;if(!post||post._state==="minimal"||post._state==="pending"){return _react2.default.createElement(RelatedPostCardPlaceholder,null)}var featuredImage=post.canonical_image;var postLink=(0,_route.getPostUrl)(post);var classes=(0,_classnames2.default)("reader-related-card-v2",{"has-thumbnail":!!featuredImage});return _react2.default.createElement(_compact2.default,{className:classes},_react2.default.createElement(AuthorAndSiteFollow,{post:post,site:site}),_react2.default.createElement("a",{href:postLink,className:"reader-related-card-v2__post reader-related-card-v2__link-block",onClick:(0,_partial2.default)(onPostClick,post)},featuredImage&&_react2.default.createElement(FeaturedImage,{image:featuredImage,href:post.URL,onClick:(0,_partial2.default)(onPostClick,post)}),_react2.default.createElement("div",{className:"reader-related-card-v2__site-info"},_react2.default.createElement("h1",{className:"reader-related-card-v2__title"},post.title),_react2.default.createElement("div",{className:"reader-related-card-v2__excerpt post-excerpt"},featuredImage?post.short_excerpt:post.excerpt))))}var LocalizedRelatedPostCard=exports.LocalizedRelatedPostCard=(0,_i18nCalypso.localize)(RelatedPostCard);exports.default=(0,_reactRedux.connect)(function(state,ownProps){var post=ownProps.post;var actualPost=(0,_selectors.getPost)(state,post);var site=actualPost&&(0,_selectors2.getSite)(state,actualPost.site_ID);return{post:actualPost,site:site}})(LocalizedRelatedPostCard)},2475:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.SmallPostCard=SmallPostCard;var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _noop=__webpack_require__(38);var _noop2=_interopRequireDefault(_noop);var _partial=__webpack_require__(286);var _partial2=_interopRequireDefault(_partial);var _i18nCalypso=__webpack_require__(11);var _compact=__webpack_require__(1642);var _compact2=_interopRequireDefault(_compact);var _safeImageUrl=__webpack_require__(290);var _safeImageUrl2=_interopRequireDefault(_safeImageUrl);var _resizeImageUrl=__webpack_require__(1769);var _resizeImageUrl2=_interopRequireDefault(_resizeImageUrl);var _readerAuthorAndSite=__webpack_require__(1873);var _readerAuthorAndSite2=_interopRequireDefault(_readerAuthorAndSite);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function SmallPostCard(_ref){var post=_ref.post;var site=_ref.site;var _ref$onPostClick=_ref.onPostClick;var onPostClick=_ref$onPostClick===undefined?_noop2.default:_ref$onPostClick;var _ref$onSiteClick=_ref.onSiteClick;var onSiteClick=_ref$onSiteClick===undefined?_noop2.default:_ref$onSiteClick;var classes=(0,_classnames2.default)("reader-related-card",{"has-image":post.canonical_image});var thumbnailUrl=post.canonical_image&&(0,_resizeImageUrl2.default)((0,_safeImageUrl2.default)(post.canonical_image.uri),{resize:"96,72"});return _react2.default.createElement(_compact2.default,{className:classes},_react2.default.createElement("div",{className:"reader-related-card__site-info-title"},_react2.default.createElement("h1",{className:"reader-related-card__title"},_react2.default.createElement("a",{className:"reader-related-card__anchor",href:"/read/blogs/"+post.site_ID+"/posts/"+post.ID,onClick:(0,_partial2.default)(onPostClick,post)},post.title)),_react2.default.createElement("div",{className:"reader-related-card__site-info"},_react2.default.createElement(_readerAuthorAndSite2.default,{post:post,site:site}))),_react2.default.createElement("div",null,post.canonical_image&&_react2.default.createElement("a",{href:"/read/blogs/"+post.site_ID+"/posts/"+post.ID,onClick:(0,_partial2.default)(onPostClick,post)},_react2.default.createElement("img",{className:"reader-related-card__thumbnail",src:thumbnailUrl}))))}exports.default=(0,_i18nCalypso.localize)(SmallPostCard)},2476:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);var _omit2=__webpack_require__(18);var _omit3=_interopRequireDefault(_omit2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _route=__webpack_require__(1740);var _stats=__webpack_require__(1643);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ReaderSiteStreamLink=_react2.default.createClass({displayName:"ReaderSiteStreamLink",propTypes:{feedId:_react2.default.PropTypes.number,siteId:_react2.default.PropTypes.number,post:_react2.default.PropTypes.object},recordClick:function recordClick(){(0,_stats.recordAction)("visit_blog_feed");(0,_stats.recordGaEvent)("Clicked Feed Link");if(this.props.post){(0,_stats.recordTrackForPost)("calypso_reader_feed_link_clicked",this.props.post)}},render:function render(){var link=(0,_route.getStreamUrl)(this.props.feedId,this.props.siteId);var omitProps=["feedId","siteId","post"];return _react2.default.createElement("a",(0,_extends3.default)({},(0,_omit3.default)(this.props,omitProps),{href:link,onClick:this.recordClick}),this.props.children)}});exports.default=ReaderSiteStreamLink;module.exports=exports["default"]},2528:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _main=__webpack_require__(166);var _main2=_interopRequireDefault(_main);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ReaderMain=function(_React$Component){(0,_inherits3.default)(ReaderMain,_React$Component);function ReaderMain(){(0,_classCallCheck3.default)(this,ReaderMain);return(0,_possibleConstructorReturn3.default)(this,(ReaderMain.__proto__||(0,_getPrototypeOf2.default)(ReaderMain)).apply(this,arguments))}(0,_createClass3.default)(ReaderMain,[{key:"componentWillMount",value:function componentWillMount(){document.querySelector("body").classList.add("is-reader-page")}},{key:"componentWillUnmount",value:function componentWillUnmount(){document.querySelector("body").classList.remove("is-reader-page")}},{key:"render",value:function render(){return _react2.default.createElement(_main2.default,this.props)}}]);return ReaderMain}(_react2.default.Component);exports.default=ReaderMain;module.exports=exports["default"]},2529:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.RelatedPostsFromOtherSites=exports.RelatedPostsFromSameSite=undefined;var _times2=__webpack_require__(716);var _times3=_interopRequireDefault(_times2);var _noop2=__webpack_require__(38);var _noop3=_interopRequireDefault(_noop2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactRedux=__webpack_require__(15);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _selectors=__webpack_require__(2179);var _utils=__webpack_require__(767);var _readerRelatedCardV=__webpack_require__(2474);var _readerRelatedCardV2=_interopRequireDefault(_readerRelatedCardV);var _queryReaderRelatedPosts=__webpack_require__(2221);var _queryReaderRelatedPosts2=_interopRequireDefault(_queryReaderRelatedPosts);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function RelatedPosts(_ref){var siteId=_ref.siteId;var postId=_ref.postId;var posts=_ref.posts;var title=_ref.title;var scope=_ref.scope;var _ref$className=_ref.className;var className=_ref$className===undefined?"":_ref$className;var _ref$onPostClick=_ref.onPostClick;var onPostClick=_ref$onPostClick===undefined?_noop3.default:_ref$onPostClick;var _ref$onSiteClick=_ref.onSiteClick;var onSiteClick=_ref$onSiteClick===undefined?_noop3.default:_ref$onSiteClick;var listItems=void 0;if(!posts){listItems=(0,_times3.default)(2,function(i){return _react2.default.createElement("li",{className:"reader-related-card-v2__list-item",key:"related-post-placeholder-"+i},_react2.default.createElement(_readerRelatedCardV2.default,{post:null}))})}else if(posts.length===0){return null}else{listItems=posts.map(function(post_id){return _react2.default.createElement("li",{key:post_id,className:"reader-related-card-v2__list-item"},_react2.default.createElement(_readerRelatedCardV2.default,{post:post_id,onPostClick:onPostClick,onSiteClick:onSiteClick}))})}return _react2.default.createElement("div",{className:(0,_classnames2.default)("reader-related-card-v2__blocks",className)},!posts&&_react2.default.createElement(_queryReaderRelatedPosts2.default,{siteId:siteId,postId:postId,scope:scope}),_react2.default.createElement("h1",{className:"reader-related-card-v2__heading"},title),_react2.default.createElement("ul",{className:"reader-related-card-v2__list"},listItems))}var RelatedPostsFromSameSite=exports.RelatedPostsFromSameSite=(0,_reactRedux.connect)(function(state,ownProps){return{posts:(0,_selectors.relatedPostsForPost)(state,ownProps.siteId,ownProps.postId,_utils.SCOPE_SAME),scope:_utils.SCOPE_SAME}})(RelatedPosts);var RelatedPostsFromOtherSites=exports.RelatedPostsFromOtherSites=(0,_reactRedux.connect)(function(state,ownProps){return{posts:(0,_selectors.relatedPostsForPost)(state,ownProps.siteId,ownProps.postId,_utils.SCOPE_OTHER),scope:_utils.SCOPE_OTHER}})(RelatedPosts)},2530:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactRedux=__webpack_require__(15);var _i18nCalypso=__webpack_require__(11);var _i18nCalypso2=_interopRequireDefault(_i18nCalypso);var _noop=__webpack_require__(38);var _noop2=_interopRequireDefault(_noop);var _selectors=__webpack_require__(2179);var _selectors2=__webpack_require__(2013);var _selectors3=__webpack_require__(2014);var _readerRelatedCard=__webpack_require__(2475);var _readerRelatedCard2=_interopRequireDefault(_readerRelatedCard);var _queryReaderRelatedPosts=__webpack_require__(2221);var _queryReaderRelatedPosts2=_interopRequireDefault(_queryReaderRelatedPosts);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var RelatedPost=_react2.default.createClass({displayName:"RelatedPost",render:function render(){return _react2.default.createElement(_readerRelatedCard2.default,{post:this.props.post,site:this.props.site,onPostClick:this.props.onPostClick,onSiteClick:this.props.onSiteClick})}});var ConnectedRelatedPost=(0,_reactRedux.connect)(function(state,ownProps){var post=ownProps.post;var actualPost=(0,_selectors2.getPost)(state,post);var site=actualPost&&(0,_selectors3.getSite)(state,actualPost.site_ID);return{post:actualPost,site:site}})(RelatedPost);function RelatedPosts(_ref){var siteId=_ref.siteId;var postId=_ref.postId;var posts=_ref.posts;var _ref$onPostClick=_ref.onPostClick;var onPostClick=_ref$onPostClick===undefined?_noop2.default:_ref$onPostClick;var _ref$onSiteClick=_ref.onSiteClick;var onSiteClick=_ref$onSiteClick===undefined?_noop2.default:_ref$onSiteClick;if(!posts){return _react2.default.createElement(_queryReaderRelatedPosts2.default,{siteId:siteId,postId:postId})}if(!posts.length){return null}return _react2.default.createElement("div",{className:"related-posts"},_react2.default.createElement("h1",{className:"related-posts__heading"},_i18nCalypso2.default.translate("Related Reading")),_react2.default.createElement("ul",{className:"related-posts__list"},posts.map(function(post_id){return _react2.default.createElement("li",{key:post_id,className:"related-posts__list-item"},_react2.default.createElement(ConnectedRelatedPost,{post:post_id,onPostClick:onPostClick,onSiteClick:onSiteClick}))})))}exports.default=(0,_reactRedux.connect)(function(state,ownProps){return{posts:(0,_selectors.relatedPostsForPost)(state,ownProps.siteId,ownProps.postId)}})(RelatedPosts);module.exports=exports["default"]},3191:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _defer2=__webpack_require__(385);var _defer3=_interopRequireDefault(_defer2);exports.resetTitle=resetTitle;exports.blogPost=blogPost;exports.blogPostNew=blogPostNew;exports.feedPost=feedPost;exports.feedPostNew=feedPostNew;var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactDom=__webpack_require__(44);var _reactDom2=_interopRequireDefault(_reactDom);var _reactRedux=__webpack_require__(15);var _i18nCalypso=__webpack_require__(11);var _i18nCalypso2=_interopRequireDefault(_i18nCalypso);var _page=__webpack_require__(33);var _page2=_interopRequireDefault(_page);var _feedError=__webpack_require__(2002);var _feedError2=_interopRequireDefault(_feedError);var _controllerHelper=__webpack_require__(1751);var _selectors=__webpack_require__(774);var _actions=__webpack_require__(712);var _main=__webpack_require__(3192);var _main2=_interopRequireDefault(_main);var _readerFullPost=__webpack_require__(2472);var _readerFullPost2=_interopRequireDefault(_readerFullPost);var _reactHelpers=__webpack_require__(711);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var analyticsPageTitle="Reader";var __lastTitle=null;function renderPostNotFound(){var sidebarAndPageTitle=_i18nCalypso2.default.translate("Post not found");(0,_controllerHelper.setPageTitle)(context,sidebarAndPageTitle);(0,_reactHelpers.renderWithReduxStore)(_react2.default.createElement(_feedError2.default,{sidebarTitle:sidebarAndPageTitle,message:_i18nCalypso2.default.translate("Post Not Found")}),document.getElementById("primary"),context.store)}function removeFullPostDialog(){_reactDom2.default.unmountComponentAtNode(document.getElementById("tertiary"))}function resetTitle(context,next){if(__lastTitle){context.store.dispatch((0,_actions.setDocumentHeadTitle)(__lastTitle));__lastTitle=null}next()}function blogPost(context){var blogId=context.params.blog,postId=context.params.post,basePath="/read/blogs/:blog_id/posts/:post_id",fullPageTitle=analyticsPageTitle+" > Blog Post > "+blogId+" > "+postId;__lastTitle=(0,_selectors.getDocumentHeadTitle)(context.store.getState());(0,_controllerHelper.trackPageLoad)(basePath,fullPageTitle,"full_post");_reactDom2.default.render(_react2.default.createElement(_reactRedux.Provider,{store:context.store},_react2.default.createElement(_main2.default,{blogId:blogId,postId:postId,context:context,onClose:function onClose(){_page2.default.back(context.lastRoute||"/")},onClosed:removeFullPostDialog,onPostNotFound:renderPostNotFound})),document.getElementById("tertiary"))}function blogPostNew(context){var blogId=context.params.blog,postId=context.params.post,basePath="/read/blogs/:blog_id/posts/:post_id",fullPageTitle=analyticsPageTitle+" > Blog Post > "+blogId+" > "+postId;__lastTitle=(0,_selectors.getDocumentHeadTitle)(context.store.getState());(0,_controllerHelper.trackPageLoad)(basePath,fullPageTitle,"full_post");_reactDom2.default.render(_react2.default.createElement(_reactRedux.Provider,{store:context.store},_react2.default.createElement(_readerFullPost2.default,{blogId:blogId,postId:postId,context:context,onClose:function onClose(){_page2.default.back(context.lastRoute||"/")},onClosed:removeFullPostDialog,onPostNotFound:renderPostNotFound})),document.getElementById("primary"));(0,_defer3.default)(function(){if(typeof window!=="undefined"){window.scrollTo(0,0)}})}function feedPost(context){var feedId=context.params.feed,postId=context.params.post,basePath="/read/feeds/:feed_id/posts/:feed_item_id",fullPageTitle=analyticsPageTitle+" > Feed Post > "+feedId+" > "+postId;__lastTitle=(0,_selectors.getDocumentHeadTitle)(context.store.getState());(0,_controllerHelper.trackPageLoad)(basePath,fullPageTitle,"full_post");_reactDom2.default.render(_react2.default.createElement(_reactRedux.Provider,{store:context.store},_react2.default.createElement(_main2.default,{feedId:feedId,postId:postId,onClose:function onClose(){_page2.default.back(context.lastRoute||"/")},onClosed:removeFullPostDialog,onPostNotFound:renderPostNotFound})),document.getElementById("tertiary"))}function feedPostNew(context){var feedId=context.params.feed,postId=context.params.post,basePath="/read/feeds/:feed_id/posts/:feed_item_id",fullPageTitle=analyticsPageTitle+" > Feed Post > "+feedId+" > "+postId;__lastTitle=(0,_selectors.getDocumentHeadTitle)(context.store.getState());(0,_controllerHelper.trackPageLoad)(basePath,fullPageTitle,"full_post");function closer(){_page2.default.back(context.lastRoute||"/")}_reactDom2.default.render(_react2.default.createElement(_reactRedux.Provider,{store:context.store},_react2.default.createElement(_readerFullPost2.default,{feedId:feedId,postId:postId,onClose:closer,onPostNotFound:renderPostNotFound})),document.getElementById("primary"));(0,_defer3.default)(function(){if(typeof window!=="undefined"){window.scrollTo(0,0)}})}},3192:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);var _postExcerpt=__webpack_require__(1889);var _postExcerpt2=_interopRequireDefault(_postExcerpt);var _selectors=__webpack_require__(1756);var _relatedPosts=__webpack_require__(2530);var _relatedPosts2=_interopRequireDefault(_relatedPosts);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ReactDom=__webpack_require__(44),React=__webpack_require__(1),PureRenderMixin=__webpack_require__(111),defer=__webpack_require__(385),closest=__webpack_require__(729),debug=__webpack_require__(3)("calypso:reader-full-post"),moment=__webpack_require__(4),omit=__webpack_require__(18),twemoji=__webpack_require__(2023),page=__webpack_require__(33),bindActionCreators=__webpack_require__(6).bindActionCreators,connect=__webpack_require__(15).connect;var config=__webpack_require__(12),CommentButton=__webpack_require__(1834),Dialog=__webpack_require__(168),DISPLAY_TYPES=__webpack_require__(2067),EmbedContainer=__webpack_require__(2043),ExternalLink=__webpack_require__(394),LikeButton=__webpack_require__(1857),PostByline=__webpack_require__(2351),PostCommentHelper=__webpack_require__(2347),PostCommentList=__webpack_require__(2157),PostOptions=__webpack_require__(2354),PostErrors=__webpack_require__(2352),PostStore=__webpack_require__(1763),PostStoreActions=__webpack_require__(1813),Site=__webpack_require__(279),SiteState=__webpack_require__(1738).state,SiteStore=__webpack_require__(1711),SiteStoreActions=__webpack_require__(1815),FeedStore=__webpack_require__(1750),FeedStoreActions=__webpack_require__(1897),FollowButton=__webpack_require__(1723),utils=__webpack_require__(2005),LikeHelper=__webpack_require__(1919),stats=__webpack_require__(1643),PostExcerptLink=__webpack_require__(2353),ShareButton=__webpack_require__(2173),ShareHelper=__webpack_require__(2172),DailyPostHelper=__webpack_require__(2001),DailyPostButton=__webpack_require__(2163),DiscoverHelper=__webpack_require__(1674),DiscoverSiteAttribution=__webpack_require__(2164),readerRoute=__webpack_require__(1740),showReaderFullPost=__webpack_require__(2186).showReaderFullPost,smartSetState=__webpack_require__(1710),scrollTo=__webpack_require__(410),setTitle=__webpack_require__(712).setDocumentHeadTitle;var loadingPost={URL:"",title:"hi there",author:{name:"",URL:""},content:"<p>Loading...</p>",comment_count:0,date:moment().toISOString(),site_name:""},postNotFound={URL:"",title:"404: No Post Found",content:"<p>No post could be found.</p>"},errorPost={URL:"",title:"Error",content:"<p>Error Loading Post</p>"},FullPostView=void 0,FullPostDialog=void 0,FullPostContainer=void 0;var relatedPostsEnabled=config.isEnabled("reader/related-posts");FullPostView=React.createClass({displayName:"FullPostView",mixins:[PureRenderMixin],hasScrolledToAnchor:false,componentDidMount:function componentDidMount(){this._parseEmoji();this.checkForCommentAnchor()},componentDidUpdate:function componentDidUpdate(){this._parseEmoji();this.checkForCommentAnchor()},componentWillReceiveProps:function componentWillReceiveProps(newProps){if(newProps.shouldShowComments){this.checkForCommentAnchor()}},checkForCommentAnchor:function checkForCommentAnchor(){var hash=window.location.hash.substr(1);if(this.refs.commentList&&hash.indexOf("comments")>-1&&!this.hasScrolledToAnchor){this.scrollToComments()}},scrollToComments:function scrollToComments(){if(!this.isMounted()){return}var commentListNode=ReactDom.findDOMNode(this.refs.commentList);if(commentListNode){this.hasScrolledToAnchor=true;var top=commentListNode.offsetTop;scrollTo({x:0,y:top-48,duration:250,container:document.querySelector(".detail-page__content")})}},handlePermalinkClick:function handlePermalinkClick(){stats.recordPermalinkClick("full_post_title")},pickSite:function pickSite(event){if(utils.isSpecialClick(event)){return}var url=readerRoute.getStreamUrlFromPost(this.props.post);page.show(url)},handleSiteClick:function handleSiteClick(event){if(!utils.isSpecialClick(event)){event.preventDefault()}},render:function render(){var post=this.props.post,site=this.props.site,siteish=utils.siteishFromSiteAndPost(site,post),feed=this.props.feed,hasFeaturedImage=post&&post.canonical_image&&!(post.display_type&DISPLAY_TYPES.CANONICAL_IN_CONTENT),articleClasses=["reader__full-post","is-group-reader"],shouldShowExcerptOnly=post&&post.use_excerpt?post.use_excerpt:false,siteName=utils.siteNameFromSiteAndPost(site,post),isDiscoverPost=DiscoverHelper.isDiscoverPost(post),isDiscoverSitePick=DiscoverHelper.isDiscoverSitePick(post),discoverSiteUrl;if(isDiscoverPost&&post.discover_metadata){discoverSiteUrl=DiscoverHelper.getSiteUrl(post)}if(!post||post._state==="minimal"||post._state==="pending"){post=loadingPost;articleClasses.push("is-placeholder")}else if(post._state==="error"){if(post.statusCode===404){post=postNotFound}else{post=errorPost}}else{if(post.site_ID){articleClasses.push("blog-"+post.site_ID)}if(post.feed_ID){articleClasses.push("feed-"+post.feed_ID)}}if(hasFeaturedImage){articleClasses.push("has-featured-image")}articleClasses=articleClasses.join(" ");return React.createElement("div",null,React.createElement("article",{className:articleClasses,id:"modal-full-post",ref:"article"},React.createElement(PostErrors,{post:post}),React.createElement("div",{className:"full-post__header"},React.createElement(Site,{site:siteish,href:post.site_URL,onSelect:this.pickSite,onClick:this.handleSiteClick}),React.createElement("div",{className:"full-post__follow"},feed&&feed.feed_URL&&React.createElement(FollowButton,{siteUrl:feed&&feed.feed_URL}))),hasFeaturedImage?React.createElement("div",{className:"full-post__featured-image"},React.createElement("img",{src:this.props.post.canonical_image.uri,height:this.props.post.canonical_image.height,width:this.props.post.canonical_image.width})):null,post.title?React.createElement("h1",{className:"reader__post-title",onClick:this.handlePermalinkClick},React.createElement(ExternalLink,{className:"reader__post-title-link",href:post.URL,target:"_blank",icon:false},post.title)):null,React.createElement(PostByline,{post:post,site:site,icon:true,isDiscoverPost:isDiscoverPost}),post&&post.use_excerpt?React.createElement(_postExcerpt2.default,{content:post.better_excerpt?post.better_excerpt:post.excerpt}):React.createElement(EmbedContainer,null,React.createElement("div",{className:"reader__full-post-content",dangerouslySetInnerHTML:{__html:post.content}})),shouldShowExcerptOnly&&!isDiscoverPost?React.createElement(PostExcerptLink,{siteName:siteName,postUrl:post.URL}):null,isDiscoverSitePick?React.createElement(DiscoverSiteAttribution,{attribution:post.discover_metadata.attribution,siteUrl:discoverSiteUrl,followUrl:DiscoverHelper.getSourceFollowUrl(post)}):null,DailyPostHelper.isDailyPostChallengeOrPrompt(post)?React.createElement(DailyPostButton,{post:post,tagName:"span"}):null,relatedPostsEnabled&&!post.is_external&&post.site_ID&&React.createElement(_relatedPosts2.default,{siteId:post.site_ID,postId:post.ID,onPostClick:this.recordRelatedPostClicks,onSiteClick:this.recordRelatedPostSiteClicks}),this.props.shouldShowComments?React.createElement(PostCommentList,{ref:"commentList",post:post,initialSize:25,pageSize:25,onCommentsUpdate:this.checkForCommentAnchor}):null))},recordRelatedPostClicks:function recordRelatedPostClicks(post){stats.recordTrackForPost("calypso_reader_related_post_clicked",post)},recordRelatedPostSiteClicks:function recordRelatedPostSiteClicks(site,post){stats.recordTrackForPost("calypso_reader_related_post_site_clicked",post)},_generateButtonClickHandler:function _generateButtonClickHandler(clickHandler){return function(event){event.preventDefault();clickHandler()}},_parseEmoji:function _parseEmoji(){twemoji.parse(ReactDom.findDOMNode(this.refs.article))}});FullPostDialog=React.createClass({displayName:"FullPostDialog",mixins:[PureRenderMixin],componentWillMount:function componentWillMount(){document.documentElement.classList.add("detail-page-active");
},componentWillUnmount:function componentWillUnmount(){document.documentElement.classList.remove("detail-page-active")},componentWillUpdate:function componentWillUpdate(nextProps){var action=nextProps.isVisible?"add":"remove",currentID=this.props.post&&(this.props.post.feed_item_ID||this.props.post.ID),nextID=nextProps.post&&(nextProps.post.feed_item_ID||nextProps.post.ID),detailPageContent;document.documentElement.classList[action]("detail-page-open");if(currentID!==nextID){detailPageContent=document.querySelector(".detail-page__content");if(detailPageContent){detailPageContent.scrollTop=0}}},handleCommentButtonClick:function handleCommentButtonClick(){this.refs.fullPost.scrollToComments();stats.recordAction("click_comments");stats.recordGaEvent("Clicked Post Comment Button");stats.recordTrackForPost("calypso_reader_full_post_comments_button_clicked",this.props.post)},handleClose:function handleClose(action){stats.recordAction("full_post_close");stats.recordGaEvent("Closed Full Post Dialog",action||"backdrop");stats.recordTrackForPost("calypso_reader_article_closed",this.props.post);this.props.onClose(action)},handleClickOutside:function handleClickOutside(event){if(closest(event.target,".popover")){return true}},render:function render(){var post=this.props.post,site=this.props.site,shouldShowComments=false,shouldShowLikes=false,shouldShowShare=false,buttons=[{label:this.translate("Back",{context:"Go back in browser history"}),action:"close",isPrimary:true}];if(post&&!post._state){shouldShowComments=PostCommentHelper.shouldShowComments(post);shouldShowLikes=LikeHelper.shouldShowLikes(post);shouldShowShare=ShareHelper.shouldShowShare(post);buttons.push(React.createElement(PostOptions,{key:"post-options",position:"bottom left",post:post,site:site,onBlock:this.props.onClose}));if(shouldShowLikes){buttons.push(React.createElement(LikeButton,{key:"like-button",siteId:post.site_ID,postId:post.ID,fullPost:true,tagName:"div",forceCounter:true}))}if(shouldShowComments){buttons.push(React.createElement(CommentButton,{key:"comment-button",commentCount:this.props.commentCount,onClick:this.handleCommentButtonClick,tagName:"div"}))}if(shouldShowShare){buttons.push(React.createElement(ShareButton,{post:post,position:"bottom",tagName:"div"}))}}buttons=buttons.map(function(button){if(button.action){button.additionalClassNames="action-button detail-page-"+button.action}return button});return React.createElement(Dialog,{isVisible:this.props.isVisible,buttons:buttons,baseClassName:"detail-page",onClose:this.handleClose,onClickOutside:this.handleClickOutside,onClosed:this.props.onClosed},React.createElement(FullPostView,{ref:"fullPost",post:this.props.post,site:this.props.site,feed:this.props.feed,shouldShowComments:shouldShowComments}))}});FullPostDialog=connect(function(state,ownProps){return{commentCount:ownProps.post?(0,_selectors.getPostTotalCommentsCount)(state,ownProps.post.site_ID,ownProps.post.ID):0}})(FullPostDialog);function getPost(postKey){var post=PostStore.get(postKey);if(!post||post._state==="minimal"){PostStoreActions.fetchPost(postKey)}return post}function getSite(siteId){var site=SiteStore.get(siteId);if(!site){SiteStoreActions.fetch(siteId)}return site}function getFeed(feedId){var feed=FeedStore.get(feedId);if(!feed){FeedStoreActions.fetch(feedId)}return feed}FullPostContainer=React.createClass({displayName:"FullPostContainer",mixins:[PureRenderMixin],smartSetState:smartSetState,getInitialState:function getInitialState(){return this.getStateFromStores()},getStateFromStores:function getStateFromStores(props){var post,site,feed,title;props=props||this.props;if(props.blogId){post=getPost({blogId:props.blogId,postId:props.postId})}else{post=getPost({feedId:props.feedId,postId:props.postId})}if(post&&post.title){title=post.title}else{title=this.translate("Post")}if(post&&post.site_ID&&!post.is_external){site=getSite(post.site_ID)}if(post&&post.feed_ID){feed=getFeed(post.feed_ID)}return{post:post,site:site,feed:feed,title:title}},attemptToSendPageView:function attemptToSendPageView(){var post=this.state.post,site=this.state.site;if(post&&post._state!=="pending"&&site&&site.get("state")===SiteState.COMPLETE&&!this.hasSentPageView){PostStoreActions.markSeen(this.state.post);this.hasSentPageView=true}if(!this.hasLoaded&&post&&post._state!=="pending"){stats.recordTrackForPost("calypso_reader_article_opened",post);this.hasLoaded=true}},componentDidMount:function componentDidMount(){PostStore.on("change",this._onChange);SiteStore.on("change",this._onChange);FeedStore.on("change",this._onChange);this.hasSentPageView=false;this.hasLoaded=false;this.attemptToSendPageView();defer(this.props.showReaderFullPost)},componentWillReceiveProps:function componentWillReceiveProps(nextProps){this.smartSetState(this.getStateFromStores(nextProps))},componentDidUpdate:function componentDidUpdate(prevProps){if(prevProps.postId!==this.props.postId||prevProps.feedId!==this.props.feedId||prevProps.blogId!==this.props.blogId){this.hasSentPageView=false;this.hasLoaded=false;this.attemptToSendPageView()}},componentWillUnmount:function componentWillUnmount(){PostStore.off("change",this._onChange);SiteStore.off("change",this._onChange);FeedStore.off("change",this._onChange);if(utils.isPostNotFound(this.state.post)){this.props.onPostNotFound()}},_onChange:function _onChange(){var newState=this.getStateFromStores();if(this.smartSetState(newState)){this.attemptToSendPageView()}},render:function render(){var passedProps=omit(this.props,["postId","feedId"]),post=this.state.post;if(this.props.setTitle&&this.props.isVisible){this.props.setTitle(this.translate("%s ‹ Reader",{args:this.state.title}))}return React.createElement(FullPostDialog,(0,_extends3.default)({},passedProps,{isVisible:utils.isPostNotFound(post)?false:this.props.isVisible,post:post,site:this.state.site,feed:this.state.feed}))}});exports.default=connect(function(state){return{isVisible:state.ui.reader.fullpost.isVisible}},function(dispatch){return bindActionCreators({showReaderFullPost:showReaderFullPost,setTitle:setTitle},dispatch)})(FullPostContainer);module.exports=exports["default"]},3298:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _map2=__webpack_require__(45);var _map3=_interopRequireDefault(_map2);var _filter2=__webpack_require__(77);var _filter3=_interopRequireDefault(_filter2);exports.requestRelatedPosts=requestRelatedPosts;var _actionTypes=__webpack_require__(2);var _actions=__webpack_require__(2365);var _wp=__webpack_require__(28);var _wp2=_interopRequireDefault(_wp);var _utils=__webpack_require__(767);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function requestRelatedPosts(siteId,postId){var scope=arguments.length>2&&arguments[2]!==undefined?arguments[2]:_utils.SCOPE_ALL;return function(dispatch){dispatch({type:_actionTypes.READER_RELATED_POSTS_REQUEST,payload:{siteId:siteId,postId:postId,scope:scope}});var query={site_id:siteId,post_id:postId,meta:"site"};if(scope===_utils.SCOPE_SAME){query.size_local=2;query.size_global=0}else if(scope===_utils.SCOPE_OTHER){query.size_local=0;query.size_global=2}return _wp2.default.undocumented().readSitePostRelated(query).then(function(response){dispatch({type:_actionTypes.READER_RELATED_POSTS_REQUEST_SUCCESS,payload:{siteId:siteId,postId:postId,scope:scope}});var sites=(0,_filter3.default)((0,_map3.default)(response&&response.posts,"meta.data.site"),Boolean);if(sites&&sites.length!==0){dispatch({type:_actionTypes.READER_SITE_UPDATE,payload:sites})}dispatch((0,_actions.receivePosts)(response&&response.posts)).then(function(){dispatch({type:_actionTypes.READER_RELATED_POSTS_RECEIVE,payload:{siteId:siteId,postId:postId,scope:scope,posts:response&&response.posts||[]}})})},function(err){dispatch({type:_actionTypes.READER_RELATED_POSTS_REQUEST_FAILURE,payload:{siteId:siteId,postId:postId,scope:scope,error:err},error:true});dispatch({type:_actionTypes.READER_RELATED_POSTS_RECEIVE,payload:{siteId:siteId,postId:postId,scope:scope,posts:[]}})})}}}});