webpackJsonp([3],{1623:function(module,exports,__webpack_require__){"use strict";var page=__webpack_require__(33);var controller=__webpack_require__(720),pagesController=__webpack_require__(2825),config=__webpack_require__(12);module.exports=function(){if(config.isEnabled("manage/pages")){page("/pages/:status?/:domain?",controller.siteSelection,controller.navigation,pagesController.pages)}}},1628:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(){(0,_page2.default)("/posts/:author?/:status?/:domain?",_controller2.default.siteSelection,_controller2.default.navigation,_controller4.default.posts)};var _page=__webpack_require__(33);var _page2=_interopRequireDefault(_page);var _controller=__webpack_require__(720);var _controller2=_interopRequireDefault(_controller);var _controller3=__webpack_require__(2887);var _controller4=_interopRequireDefault(_controller3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}module.exports=exports["default"]},1648:function(module,exports,__webpack_require__){"use strict";var _keys=__webpack_require__(39);var _keys2=_interopRequireDefault(_keys);var _utils=__webpack_require__(294);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var debug=__webpack_require__(3)("calypso:posts"),defer=__webpack_require__(385),store=__webpack_require__(46),clone=__webpack_require__(212),fromPairs=__webpack_require__(402),assign=__webpack_require__(34);var wpcom=__webpack_require__(28),PostsStore=__webpack_require__(1727),PostEditStore=__webpack_require__(1687),postListStoreFactory=__webpack_require__(1726),PreferencesStore=__webpack_require__(747),sites=__webpack_require__(53)(),utils=__webpack_require__(1649),versionCompare=__webpack_require__(398),Dispatcher=__webpack_require__(42),stats=__webpack_require__(1651);var PostActions;function handleMetadataOperation(key,value,operation){var post=PostEditStore.get(),metadata;if("string"===typeof key||Array.isArray(key)){key=fromPairs([].concat(key).map(function(meta){return[meta,value]}))}metadata=(post.metadata||[]).filter(function(meta){return!key.hasOwnProperty(meta.key)});(0,_keys2.default)(key).forEach(function(objectKey){var meta={key:objectKey,operation:operation};if("delete"!==operation){meta.value=key[objectKey]}metadata.push(meta)});Dispatcher.handleViewAction({type:"EDIT_POST",post:{metadata:metadata}})}function normalizeApiAttributes(attributes){attributes=clone(attributes);attributes=(0,_utils.normalizeTermsForApi)(attributes);if(attributes.author){attributes.author=attributes.author.ID}return attributes}PostActions={startEditingNew:function startEditingNew(siteId,options){var args;options=options||{};args={type:"DRAFT_NEW_POST",siteId:siteId,postType:options.type||"post",title:options.title,content:options.content};Dispatcher.handleViewAction(args)},startEditingExisting:function startEditingExisting(siteId,postId){var currentPost=PostEditStore.get(),postHandle;if(!siteId){return}if(currentPost&&currentPost.site_ID===siteId&&currentPost.ID===postId){return}Dispatcher.handleViewAction({type:"START_EDITING_POST",siteId:siteId,postId:postId});postHandle=wpcom.site(siteId).post(postId);postHandle.get({context:"edit",meta:"autosave"},function(error,data){Dispatcher.handleServerAction({type:"RECEIVE_POST_TO_EDIT",error:error,post:data})})},stopEditing:function stopEditing(){Dispatcher.handleViewAction({type:"STOP_EDITING_POST"})},autosave:function autosave(callback){var post=PostEditStore.get(),savedPost=PostEditStore.getSavedPost(),siteHandle=wpcom.undocumented().site(post.site_ID),site;callback=callback||function(){};if(!PostEditStore.isDirty()){return callback(new Error("NOT_DIRTY"))}store.set("wpcom-autosave:"+post.site_ID+":"+post.ID,post);if(utils.isPublished(savedPost)||utils.isPublished(post)){site=sites.getSite(post.site_ID);if(!post.ID||!site||site.jetpack&&versionCompare(site.options.jetpack_version,"3.7.0-dev","<")){return callback(new Error("NO_AUTOSAVE"))}Dispatcher.handleViewAction({type:"POST_AUTOSAVE",post:post});siteHandle.postAutosave(post.ID,{content:post.content,title:post.title,excerpt:post.excerpt},function(error,data){Dispatcher.handleServerAction({type:"RECEIVE_POST_AUTOSAVE",error:error,autosave:data});callback(error,data)})}else{PostActions.saveEdited(null,callback,{recordSaveEvent:false})}},blockSave:function blockSave(key){Dispatcher.handleViewAction({type:"BLOCK_EDIT_POST_SAVE",key:key})},unblockSave:function unblockSave(key){Dispatcher.handleViewAction({type:"UNBLOCK_EDIT_POST_SAVE",key:key})},edit:function edit(attributes){Dispatcher.handleViewAction({type:"EDIT_POST",post:attributes})},editRawContent:function editRawContent(content){Dispatcher.handleViewAction({type:"EDIT_POST_RAW_CONTENT",content:content})},resetRawContent:function resetRawContent(){Dispatcher.handleViewAction({type:"RESET_POST_RAW_CONTENT"})},updateMetadata:function updateMetadata(key,value){handleMetadataOperation(key,value,"update")},deleteMetadata:function deleteMetadata(key){handleMetadataOperation(key,null,"delete")},saveEdited:function saveEdited(attributes,callback,options){var post,postHandle,query,changedAttributes,rawContent,mode,isNew;Dispatcher.handleViewAction({type:"EDIT_POST",post:attributes});post=PostEditStore.get();if(!PostEditStore.hasContent()){defer(callback,new Error("NO_CONTENT"),post);return}if(PostEditStore.isSaveBlocked()){defer(callback,new Error("SAVE_BLOCKED"),post);return}changedAttributes=PostEditStore.getChangedAttributes();if(!(0,_keys2.default)(changedAttributes).length){defer(callback,new Error("NO_CHANGE"),post);return}changedAttributes=normalizeApiAttributes(changedAttributes);rawContent=PostEditStore.getRawContent();mode=PreferencesStore.get("editor-mode");isNew=!post.ID;Dispatcher.handleViewAction({type:"EDIT_POST_SAVE"});postHandle=wpcom.site(post.site_ID).post(post.ID);query={context:"edit",apiVersion:"1.2"};if(!options||options.recordSaveEvent!==false){stats.recordSaveEvent()}if(changedAttributes&&changedAttributes.status==="future"&&utils.isFutureDated(post)||changedAttributes&&changedAttributes.status==="publish"&&utils.isBackDated(post)){changedAttributes=assign({},changedAttributes,{status:"publish",date:post.date})}postHandle[isNew?"add":"update"](query,changedAttributes,function(error,data){var original,currentMode;currentMode=PreferencesStore.get("editor-mode");if(!error){original=PostsStore.get(data.global_ID)}Dispatcher.handleServerAction({type:"RECEIVE_POST_BEING_EDITED",error:error,rawContent:mode===currentMode?rawContent:null,isNew:isNew,original:original,post:data});callback(error,data)})},update:function update(post,attributes,callback){var postHandle=wpcom.site(post.site_ID).post(post.ID);postHandle.update(attributes,PostActions.receiveUpdate.bind(null,callback))},trash:function trash(post,callback){var postHandle=wpcom.site(post.site_ID).post(post.ID);postHandle.delete(PostActions.receiveUpdate.bind(null,callback))},restore:function restore(post,callback){var postHandle=wpcom.site(post.site_ID).post(post.ID);postHandle.restore(PostActions.receiveUpdate.bind(null,callback))},queryPosts:function queryPosts(options){var postListStoreId=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"default";Dispatcher.handleViewAction({type:"QUERY_POSTS",options:options,postListStoreId:postListStoreId})},fetchNextPage:function fetchNextPage(){var postListStoreId=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"default";var params,id,siteID,postListStore;postListStore=postListStoreFactory(postListStoreId);if(postListStore.isLastPage()||postListStore.isFetchingNextPage()){return}Dispatcher.handleViewAction({type:"FETCH_NEXT_POSTS_PAGE",postListStoreId:postListStoreId});id=postListStore.getID();params=postListStore.getNextPageParams();siteID=postListStore.getSiteID();if(siteID){wpcom.site(siteID).postsList(params,PostActions.receivePage.bind(null,id,postListStoreId))}else{wpcom.me().postsList(params,PostActions.receivePage.bind(null,id,postListStoreId))}},receivePage:function receivePage(id,postListStoreId,error,data){Dispatcher.handleServerAction({type:"RECEIVE_POSTS_PAGE",id:id,postListStoreId:postListStoreId,error:error,data:data})},fetchUpdated:function fetchUpdated(){var postListStoreId=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"default";var id,params,siteID,postListStore;postListStore=postListStoreFactory(postListStoreId);if(postListStore.isFetchingNextPage()){return}Dispatcher.handleViewAction({type:"FETCH_UPDATED_POSTS",postListStoreId:postListStoreId});id=postListStore.getID();params=postListStore.getUpdatesParams();siteID=postListStore.getSiteID();if(siteID){debug("Fetching posts that have been updated for %s since %s %o",siteID,params.modified_after,params);wpcom.site(siteID).postsList(params,PostActions.receiveUpdated.bind(null,id,postListStoreId))}else{debug("Fetching posts that have been updated since %s %o",params.modified_after,params);wpcom.me().postsList(params,PostActions.receiveUpdated.bind(null,id,postListStoreId))}},receiveUpdated:function receiveUpdated(id,postListStoreId,error,data){Dispatcher.handleServerAction({type:"RECEIVE_UPDATED_POSTS",id:id,postListStoreId:postListStoreId,error:error,data:data})},receiveUpdate:function receiveUpdate(callback,error,data){var original;if(!error){original=PostsStore.get(data.global_ID)}Dispatcher.handleServerAction({type:"RECEIVE_UPDATED_POST",error:error,original:original,post:data});callback(error,data)},fetchCounts:function fetchCounts(siteId,options){Dispatcher.handleViewAction({type:"FETCH_POST_COUNTS",siteId:siteId});wpcom.undocumented().site(siteId).postCounts(options,function(error,data){Dispatcher.handleServerAction({type:"RECEIVE_POST_COUNTS",error:error,data:data,siteId:siteId})})}};module.exports=PostActions},1651:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.recordStat=recordStat;exports.recordEvent=recordEvent;exports.recordSaveEvent=recordSaveEvent;exports.recordTinyMCEButtonClick=recordTinyMCEButtonClick;exports.recordTinyMCEHTMLButtonClick=recordTinyMCEHTMLButtonClick;var _debug=__webpack_require__(3);var _debug2=_interopRequireDefault(_debug);var _noop=__webpack_require__(38);var _noop2=_interopRequireDefault(_noop);var _config=__webpack_require__(12);var _config2=_interopRequireDefault(_config);var _analytics=__webpack_require__(20);var _analytics2=_interopRequireDefault(_analytics);var _postEditStore=__webpack_require__(1687);var _postEditStore2=_interopRequireDefault(_postEditStore);var _utils=__webpack_require__(1649);var _utils2=_interopRequireDefault(_utils);var _sitesList=__webpack_require__(53);var _sitesList2=_interopRequireDefault(_sitesList);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var debug=(0,_debug2.default)("calypso:posts:stats");var sites=new _sitesList2.default;function recordUsageStats(action,postType){var source=void 0;var site=sites.getSelectedSite();_analytics2.default.mc.bumpStat("editor_usage",action);if(site){source=site.jetpack?"jetpack":"wpcom";_analytics2.default.mc.bumpStat("editor_usage_"+source,action);if(postType){_analytics2.default.mc.bumpStat("editor_cpt_usage_"+source,postType+"_"+action)}}}function recordStat(action){_analytics2.default.mc.bumpStat("editor_actions",action)}function recordEvent(action,label,value){_analytics2.default.ga.recordEvent("Editor",action,label,value)}function recordSaveEvent(){var post=_postEditStore2.default.get();var savedPost=_postEditStore2.default.getSavedPost();if(!post||!savedPost){return}var currentStatus=savedPost.status;var nextStatus=post.status;var tracksEventName="calypso_editor_"+post.type+"_";var statName=false;var statEvent=false;var usageAction=false;if(!post.ID&&!_utils2.default.isPublished(post)){tracksEventName+="savedraft"}else if("draft"===nextStatus){tracksEventName+="savedraft"}else if(currentStatus===nextStatus){usageAction="edit";tracksEventName+="update"}else if("publish"===nextStatus||"private"===nextStatus){tracksEventName+="publish";usageAction="new"}else if("pending"===nextStatus){tracksEventName+="pending"}else if("future"===nextStatus){tracksEventName+="schedule";statName="status-schedule";statEvent="Scheduled Post"}if(usageAction){recordUsageStats(usageAction,post.type)}if(statName){recordStat(statName)}if(statEvent){recordEvent(statEvent)}debug("recordSaveEvent %s currentStatus=%s nextStatus=%s",tracksEventName,currentStatus,nextStatus);_analytics2.default.tracks.recordEvent(tracksEventName,{post_id:post.ID,post_type:post.type,visibility:_utils2.default.getVisibility(post),current_status:currentStatus,next_status:nextStatus})}var shouldBumpStat=Math.random()<=.01||(0,_config2.default)("env")==="development";var maybeBumpStat=shouldBumpStat?_analytics2.default.mc.bumpStat:_noop2.default;function recordTinyMCEButtonClick(buttonName){maybeBumpStat("editor-button","calypso_"+buttonName);_analytics2.default.ga.recordEvent("Editor","Clicked TinyMCE Button",buttonName);debug("TinyMCE button click",buttonName,"mc=",shouldBumpStat)}function recordTinyMCEHTMLButtonClick(buttonName){maybeBumpStat("html-editor-button","calypso_"+buttonName);_analytics2.default.ga.recordEvent("Editor","Clicked TinyMCE HTML Button",buttonName);debug("TinyMCE HTML button click",buttonName,"mc=",shouldBumpStat)}},1665:function(module,exports,__webpack_require__){"use strict";var _defineProperty2=__webpack_require__(7);var _defineProperty3=_interopRequireDefault(_defineProperty2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var React=__webpack_require__(1),classNames=__webpack_require__(10);var SegmentedControlItem=React.createClass({displayName:"SegmentedControlItem",propTypes:{children:React.PropTypes.node.isRequired,path:React.PropTypes.string,selected:React.PropTypes.bool,title:React.PropTypes.string,onClick:React.PropTypes.func},getDefaultProps:function getDefaultProps(){return{selected:false}},render:function render(){var itemClassName=classNames({"segmented-control__item":true,"is-selected":this.props.selected});var linkClassName=classNames("segmented-control__link",(0,_defineProperty3.default)({},"item-index-"+this.props.index,this.props.index!=null));return React.createElement("li",{className:itemClassName},React.createElement("a",{href:this.props.path,className:linkClassName,ref:"itemLink",onTouchTap:this.props.onClick,title:this.props.title,role:"radio",tabIndex:0,"aria-selected":this.props.selected},React.createElement("span",{className:"segmented-control__text"},this.props.children)))}});module.exports=SegmentedControlItem},1680:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _toConsumableArray2=__webpack_require__(41);var _toConsumableArray3=_interopRequireDefault(_toConsumableArray2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _noop=__webpack_require__(38);var _noop2=_interopRequireDefault(_noop);var _button=__webpack_require__(69);var _button2=_interopRequireDefault(_button);var _card=__webpack_require__(89);var _card2=_interopRequireDefault(_card);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _analytics=__webpack_require__(20);var _analytics2=_interopRequireDefault(_analytics);var _sitesList=__webpack_require__(53);var _sitesList2=_interopRequireDefault(_sitesList);var _plans=__webpack_require__(715);var _productsValues=__webpack_require__(62);var _trackComponentView=__webpack_require__(284);var _trackComponentView2=_interopRequireDefault(_trackComponentView);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var sites=(0,_sitesList2.default)();exports.default=_react2.default.createClass({displayName:"UpgradeNudge",propTypes:{onClick:_react2.default.PropTypes.func,className:_react2.default.PropTypes.string,message:_react2.default.PropTypes.string,icon:_react2.default.PropTypes.string,event:_react2.default.PropTypes.string,href:_react2.default.PropTypes.string,jetpack:_react2.default.PropTypes.bool,compact:_react2.default.PropTypes.bool,feature:_react2.default.PropTypes.oneOf([false].concat((0,_toConsumableArray3.default)((0,_plans.getValidFeatureKeys)()))),shouldDisplay:_react2.default.PropTypes.func},getDefaultProps:function getDefaultProps(){return{onClick:_noop2.default,message:"And get your own domain address.",icon:"star",event:null,jetpack:false,feature:false,compact:false,shouldDisplay:null}},handleClick:function handleClick(){if(this.props.event||this.props.feature){_analytics2.default.tracks.recordEvent("calypso_upgrade_nudge_cta_click",{cta_name:this.props.event,cta_feature:this.props.feature,cta_size:"regular"})}this.props.onClick()},shouldDisplay:function shouldDisplay(site){var _props=this.props;var feature=_props.feature;var jetpack=_props.jetpack;var shouldDisplay=_props.shouldDisplay;if(shouldDisplay){return shouldDisplay()}if(!site){return false}if(feature&&(0,_plans.hasFeature)(feature,site.ID)){return false}if(!feature&&!(0,_productsValues.isFreePlan)(site.plan)){return false}if(feature==="no-adverts"&&site.options.wordads){return false}if(!jetpack&&site.jetpack||jetpack&&!site.jetpack){return false}return true},render:function render(){var classes=(0,_classnames2.default)(this.props.className,"upgrade-nudge");var site=sites.getSelectedSite();var href=this.props.href;if(!this.shouldDisplay(site)){return null}if(!this.props.href&&site){if(this.props.feature){href="/plans/"+site.slug+"?feature="+this.props.feature}else{href="/plans/"+site.slug}}if(this.props.compact){return _react2.default.createElement(_button2.default,{className:classes,onClick:this.handleClick,href:href},_react2.default.createElement(_gridicon2.default,{className:"upgrade-nudge__icon",icon:this.props.icon}),_react2.default.createElement("div",{className:"upgrade-nudge__info"},_react2.default.createElement("span",{className:"upgrade-nudge__title"},this.props.title||this.translate("Upgrade to Premium")),_react2.default.createElement("span",{className:"upgrade-nudge__message"},this.props.message)))}return _react2.default.createElement(_card2.default,{compact:true,className:classes,onClick:this.handleClick,href:href},_react2.default.createElement(_gridicon2.default,{className:"upgrade-nudge__icon",icon:this.props.icon,size:18}),_react2.default.createElement("div",{className:"upgrade-nudge__info"},_react2.default.createElement("span",{className:"upgrade-nudge__title"},this.props.title||this.translate("Upgrade to Premium")),_react2.default.createElement("span",{className:"upgrade-nudge__message"},this.props.message)),(this.props.event||this.props.feature)&&_react2.default.createElement(_trackComponentView2.default,{eventName:"calypso_upgrade_nudge_impression",eventProperties:{cta_name:this.props.event,cta_feature:this.props.feature,cta_size:"regular"}}))}});module.exports=exports["default"]},1682:function(module,exports,__webpack_require__){"use strict";var ReactDom=__webpack_require__(44),React=__webpack_require__(1),filter=__webpack_require__(77),map=__webpack_require__(45),classNames=__webpack_require__(10);var ControlItem=__webpack_require__(1665);var _instance=1;var SegmentedControl=React.createClass({displayName:"SegmentedControl",propTypes:{initialSelected:React.PropTypes.string,compact:React.PropTypes.bool,className:React.PropTypes.string,style:React.PropTypes.object,onSelect:React.PropTypes.func,options:React.PropTypes.arrayOf(React.PropTypes.shape({value:React.PropTypes.string.isRequired,label:React.PropTypes.string.isRequired,path:React.PropTypes.string}))},getDefaultProps:function getDefaultProps(){return{compact:false}},getInitialState:function getInitialState(){var initialSelected;if(this.props.options){initialSelected=this.props.initialSelected||this.props.options[0].value}return{selected:initialSelected,keyboardNavigation:false}},componentWillMount:function componentWillMount(){this.id=_instance;_instance++},componentWillUnmount:function componentWillUnmount(){window.removeEventListener("keydown",this.navigateItem)},render:function render(){var segmentedClasses={"segmented-control":true,"keyboard-navigation":this.state.keyboardNavigation,"is-compact":this.props.compact,"is-primary":this.props.primary};if(this.props.className){this.props.className.split(" ").forEach(function(className){segmentedClasses[className]=true})}return React.createElement("ul",{className:classNames(segmentedClasses),style:this.props.style,role:"radiogroup",onKeyDown:this.navigateItem,onKeyUp:this.setKeyboardNavigation.bind(this,true)},this.getSegmentedItems())},getSegmentedItems:function getSegmentedItems(){var refIndex=0;if(this.props.children){return React.Children.map(this.props.children,function(child,index){var newChild=React.cloneElement(child,{ref:child.type===ControlItem?"item-"+refIndex:null,key:"item-"+index,onClick:function(event){this.setKeyboardNavigation(false);if(typeof child.props.onClick==="function"){child.props.onClick(event)}}.bind(this)});if(child.type===ControlItem){refIndex++}return newChild},this)}return this.props.options.map(function(item,index){return React.createElement(ControlItem,{key:"segmented-control-"+this.id+"-"+item.value,ref:"item-"+index,selected:this.state.selected===item.value,onClick:this.selectItem.bind(this,item),path:item.path,index:index},item.label)},this)},selectItem:function selectItem(option){if(!option){return}if(this.props.onSelect){this.props.onSelect(option)}this.setState({selected:option.value,keyboardNavigation:false})},setKeyboardNavigation:function setKeyboardNavigation(value){this.setState({keyboardNavigation:value})},navigateItem:function navigateItem(event){switch(event.keyCode){case 9:this.navigateItemByTabKey(event);break;case 32:case 13:event.preventDefault();document.activeElement.click();break;case 37:event.preventDefault();this.focusSibling("previous");break;case 39:event.preventDefault();this.focusSibling("next");break}},navigateItemByTabKey:function navigateItemByTabKey(event){var direction=event.shiftKey?"previous":"next",newIndex=this.focusSibling(direction);if(newIndex!==false){event.preventDefault()}},focusSibling:function focusSibling(direction){var increment,items,newIndex;if(this.props.options){items=filter(map(this.props.options,"value"),Boolean)}else{items=filter(this.props.children,function(item){return item.type===ControlItem})}if(typeof this.focused!=="number"){this.focused=this.getCurrentFocusedIndex()}increment=direction==="previous"?-1:1;newIndex=this.focused+increment;if(newIndex>=items.length||newIndex<0){return false}ReactDom.findDOMNode(this.refs["item-"+newIndex].refs.itemLink).focus();this.focused=newIndex;return newIndex},getCurrentFocusedIndex:function getCurrentFocusedIndex(){var activeItem=document.activeElement.parentNode,siblings=Array.prototype.slice(activeItem.parentNode.children),index=siblings.indexOf(activeItem);return index>-1?index:0}});module.exports=SegmentedControl},1687:function(module,exports,__webpack_require__){"use strict";var _freeze=__webpack_require__(276);var _freeze2=_interopRequireDefault(_freeze);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var assign=__webpack_require__(34),debug=__webpack_require__(3)("calypso:posts:post-edit-store"),emitter=__webpack_require__(36),isEqual=__webpack_require__(98),filter=__webpack_require__(77),without=__webpack_require__(172),pickBy=__webpack_require__(213);var Dispatcher=__webpack_require__(42),decodeEntities=__webpack_require__(81).decodeEntities,utils=__webpack_require__(1649);var REGEXP_EMPTY_CONTENT=/^<p>(<br[^>]*>|&nbsp;|\s)*<\/p>$/,CONTENT_LENGTH_ASSUME_SET=50;var _initialRawContent=null,_isAutosaving=false,_isLoading=false,_saveBlockers=[],_isNew=false,_loadingError=null,_post=null,_previewUrl=null,_queue=[],_queueChanges=false,_rawContent=null,_savedPost=null,PostEditStore;function resetState(){debug("Reset state");_initialRawContent=null;_isAutosaving=false;_isLoading=false;_saveBlockers=[];_isNew=false;_loadingError=null;_post=null;_previewUrl=null;_queue=[];_queueChanges=false;_rawContent=null;_savedPost=null}function getParentId(post){if(!post||!post.parent){return null}if(post.parent.ID){return post.parent.ID}return post.parent}function getPageTemplate(post){if(!post||!post.page_template||post.page_template==="default"){return""}return post.page_template}function startEditing(post){resetState();post=normalize(post);if(post.title){post.title=decodeEntities(post.title)}_previewUrl=utils.getPreviewURL(post);_savedPost=(0,_freeze2.default)(post);_post=_savedPost;_isLoading=false}function updatePost(post){post=normalize(post);if(post.title){post.title=decodeEntities(post.title)}_previewUrl=utils.getPreviewURL(post);_savedPost=(0,_freeze2.default)(post);_post=_savedPost;_isNew=false;_loadingError=null;_queue.forEach(function(change){set(change)})}function initializeNewPost(siteId,options){var args;options=options||{};args={site_ID:siteId,status:"draft",type:options.postType||"post",content:options.content||"",title:options.title||""};startEditing(args);_isNew=true}function setLoadingError(error){resetState();_loadingError=error;_isLoading=false}function set(attributes){var updatedPost;if(!_post){return false}if(_queueChanges){_queue.push(attributes)}updatedPost=assign({},_post,attributes);updatedPost=normalize(updatedPost);if(!isEqual(updatedPost,_post)){if(isEqual(updatedPost,_savedPost)){_post=_savedPost}else{_post=(0,_freeze2.default)(updatedPost)}return true}return false}function normalize(post){post.parent_id=getParentId(post);if(post.type==="page"){post.page_template=getPageTemplate(post)}return post}function setRawContent(content){var isDirty,hasContent;if(null===_initialRawContent){debug("Set initial raw content to: %s",content);_initialRawContent=content}if(content!==_rawContent){isDirty=PostEditStore.isDirty();hasContent=PostEditStore.hasContent();debug("Set raw content to: %s",content);_rawContent=content;if(PostEditStore.isDirty()!==isDirty||PostEditStore.hasContent()!==hasContent){PostEditStore.emit("change")}PostEditStore.emit("rawContentChange")}}function isContentEmpty(content){return!content||content.length<CONTENT_LENGTH_ASSUME_SET&&REGEXP_EMPTY_CONTENT.test(content)}function dispatcherCallback(payload){var action=payload.action,changed;switch(action.type){case"EDIT_POST":changed=set(action.post);if(changed){PostEditStore.emit("change")}break;case"RESET_POST_RAW_CONTENT":_initialRawContent=null;setRawContent(null);break;case"EDIT_POST_RAW_CONTENT":setRawContent(action.content);break;case"DRAFT_NEW_POST":initializeNewPost(action.siteId,{postType:action.postType,title:action.title,content:action.content});PostEditStore.emit("change");break;case"START_EDITING_POST":resetState();_isLoading=true;PostEditStore.emit("change");break;case"STOP_EDITING_POST":resetState();PostEditStore.emit("change");break;case"RECEIVE_POST_TO_EDIT":_isLoading=false;if(action.error){setLoadingError(action.error)}else{startEditing(action.post)}PostEditStore.emit("change");break;case"BLOCK_EDIT_POST_SAVE":if(-1===_saveBlockers.indexOf(action.key)){_saveBlockers.push(action.key);PostEditStore.emit("change")}break;case"UNBLOCK_EDIT_POST_SAVE":_saveBlockers=without(_saveBlockers,action.key);PostEditStore.emit("change");break;case"EDIT_POST_SAVE":_queueChanges=true;break;case"RECEIVE_UPDATED_POST":if(!action.error){if(_post&&action.post.ID===_post.ID){updatePost(action.post);PostEditStore.emit("change")}}_queueChanges=false;_queue=[];break;case"RECEIVE_POST_BEING_EDITED":if(!action.error){updatePost(action.post);if(typeof action.rawContent==="string"){_initialRawContent=action.rawContent}PostEditStore.emit("change")}_queueChanges=false;_queue=[];break;case"POST_AUTOSAVE":_isAutosaving=true;PostEditStore.emit("change");break;case"RECEIVE_POST_AUTOSAVE":_isAutosaving=false;if(!action.error){_previewUrl=utils.getPreviewURL(assign({preview_URL:action.autosave.preview_URL},_savedPost))}PostEditStore.emit("change");break}}PostEditStore={get:function get(){return _post},getSavedPost:function getSavedPost(){return _savedPost},getRawContent:function getRawContent(){return _rawContent},getChangedAttributes:function getChangedAttributes(){var changedAttributes,metadata;if(this.isNew()){return _post}if(!this.isDirty()){return(0,_freeze2.default)({})}changedAttributes=pickBy(_post,function(value,key){return value!==_savedPost[key]&&"metadata"!==key});if(_post.metadata){metadata=filter(_post.metadata,"operation");if(metadata.length){assign(changedAttributes,{metadata:metadata})}}if(!changedAttributes.content&&_rawContent!==_initialRawContent){changedAttributes.content=_post.content}return(0,_freeze2.default)(changedAttributes)},getLoadingError:function getLoadingError(){return _loadingError},isDirty:function isDirty(){return _post!==_savedPost||_rawContent!==_initialRawContent},isNew:function isNew(){return _isNew},isLoading:function isLoading(){return _isLoading},isAutosaving:function isAutosaving(){return _isAutosaving},isSaveBlocked:function isSaveBlocked(key){if(!key){return!!_saveBlockers.length}return-1!==_saveBlockers.indexOf(key)},getPreviewUrl:function getPreviewUrl(){return _previewUrl},hasContent:function hasContent(){if(!_post){return false}if(_post.title&&_post.title.trim()||_post.excerpt){return true}if(_rawContent){return!isContentEmpty(_rawContent)}return!isContentEmpty(_post.content)}};emitter(PostEditStore);PostEditStore.dispatchToken=Dispatcher.register(dispatcherCallback);module.exports=PostEditStore},1689:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1);var noResults=React.createClass({displayName:"noResults",getDefaultProps:function getDefaultProps(){return{text:"No results",image:false}},render:function render(){return React.createElement("div",{className:"no-results"},this.props.image?React.createElement("img",{className:"no-results__img",src:this.props.image}):null,React.createElement("span",null,this.props.text))}});module.exports=noResults},1692:function(module,exports,__webpack_require__){"use strict";var url=__webpack_require__(70),pick=__webpack_require__(91);module.exports=function(uri,search){var parsedUrl=url.parse(uri,true);if(search){parsedUrl.query.s=search}else{delete parsedUrl.query.s}parsedUrl=pick(parsedUrl,"pathname","hash","query");return url.format(parsedUrl).replace(/\%20/g,"+")}},1693:function(module,exports,__webpack_require__){"use strict";var debug=__webpack_require__(3)("calypso:url-search"),page=__webpack_require__(33);var buildUrl=__webpack_require__(1692);module.exports={getInitialState:function getInitialState(){return{searchOpen:false}},componentWillReceiveProps:function componentWillReceiveProps(nextProps){if(!nextProps.search){this.setState({searchOpen:false})}},doSearch:function doSearch(keywords){var searchURL;this.setState({searchOpen:false!==keywords});if(this.onSearch){this.onSearch(keywords);return}searchURL=buildUrl(window.location.href,keywords);debug("search posts for:",keywords);if(this.props.search&&keywords){debug("replacing URL: "+searchURL);page.replace(searchURL)}else{debug("setting URL: "+searchURL);page(searchURL)}},getSearchOpen:function getSearchOpen(){return this.state.searchOpen!==false||this.props.search}}},1725:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _popover=__webpack_require__(386);var _popover2=_interopRequireDefault(_popover);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _analytics=__webpack_require__(20);var _analytics2=_interopRequireDefault(_analytics);function _interopRequireDefault(obj){
return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"InfoPopover",propTypes:{id:_react2.default.PropTypes.string,position:_react2.default.PropTypes.string,className:_react2.default.PropTypes.string,rootClassName:_react2.default.PropTypes.string,gaEventCategory:_react2.default.PropTypes.string,popoverName:_react2.default.PropTypes.string,ignoreContext:_react2.default.PropTypes.shape({getDOMNode:_react2.default.PropTypes.function})},getDefaultProps:function getDefaultProps(){return{position:"bottom"}},getInitialState:function getInitialState(){return{showPopover:false}},render:function render(){return _react2.default.createElement("span",{onClick:this._onClick,ref:"infoPopover",className:(0,_classnames2.default)("info-popover",{is_active:this.state.showPopover},this.props.className)},_react2.default.createElement(_gridicon2.default,{icon:"info-outline",size:18}),_react2.default.createElement(_popover2.default,{id:this.props.id,isVisible:this.state.showPopover,context:this.refs&&this.refs.infoPopover,ignoreContext:this.props.ignoreContext,position:this.props.position,onClose:this._onClose,className:(0,_classnames2.default)("popover","info-popover__tooltip",this.props.className),rootClassName:this.props.rootClassName},this.props.children))},_onClick:function _onClick(event){event.preventDefault();this.setState({showPopover:!this.state.showPopover},this._recordStats)},_onClose:function _onClose(){this.setState({showPopover:false},this._recordStats)},_recordStats:function _recordStats(){var _props=this.props;var gaEventCategory=_props.gaEventCategory;var popoverName=_props.popoverName;if(gaEventCategory&&popoverName){var dialogState=this.state.showPopover?" Opened":" Closed";_analytics2.default.ga.recordEvent(gaEventCategory,"InfoPopover: "+popoverName+dialogState)}}});module.exports=exports["default"]},1726:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=getStore;var _postListStore=__webpack_require__(1904);var _postListStore2=_interopRequireDefault(_postListStore);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _postListStores={};function getStore(storeId){var postStoreId=storeId||"default";if(!_postListStores[postStoreId]){_postListStores[postStoreId]=new _postListStore2.default(postStoreId)}return _postListStores[postStoreId]}getStore._reset=function(){_postListStores={}};module.exports=exports["default"]},1727:function(module,exports,__webpack_require__){"use strict";var isEqual=__webpack_require__(98),debug=__webpack_require__(3)("calypso:posts");var utils=__webpack_require__(1649),Dispatcher=__webpack_require__(42);var _posts={},PostsStore;function setPost(post){var cachedPost=PostsStore.get(post.global_ID);if(cachedPost&&isEqual(post,cachedPost)){return}_posts[post.global_ID]=post}function normalizePost(responseSource,attributes){var _ref=attributes||{};var global_ID=_ref.global_ID;if(!global_ID){debug("global_ID is required for a post",attributes);return}var cachedPost=PostsStore.get(global_ID);if(cachedPost&&responseSource==="local"){debug("existing record (%o), do not overwrite with local response",cachedPost);return}utils.normalizeSync(attributes,function(error,post){setPost(post)})}function setAll(posts,responseSource){var boundNormalizePost=normalizePost.bind(null,responseSource);posts.forEach(boundNormalizePost)}PostsStore={get:function get(globalID){return _posts[globalID]}};PostsStore.dispatchToken=Dispatcher.register(function(payload){var action=payload.action;switch(action.type){case"RECEIVE_POSTS_PAGE":case"RECEIVE_UPDATED_POSTS":if(!action.error&&action.data.posts){var responseSource=action.data.__sync&&action.data.__sync.responseSource;setAll(action.data.posts,responseSource)}break;case"RECEIVE_UPDATED_POST":if(!action.error){normalizePost("server",action.post)}break}});module.exports=PostsStore},1755:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.requestPostComments=requestPostComments;exports.removeComment=removeComment;exports.writeComment=writeComment;exports.likeComment=likeComment;exports.unlikeComment=unlikeComment;var _wp=__webpack_require__(28);var _wp2=_interopRequireDefault(_wp);var _actionTypes=__webpack_require__(2);var _utils=__webpack_require__(766);var _selectors=__webpack_require__(1756);var _constants=__webpack_require__(741);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function commentsRequestSuccess(options){var dispatch=options.dispatch;var requestId=options.requestId;var siteId=options.siteId;var postId=options.postId;var comments=options.comments;var totalCommentsCount=options.totalCommentsCount;dispatch({type:_actionTypes.COMMENTS_REQUEST_SUCCESS,requestId:requestId});dispatch({type:_actionTypes.COMMENTS_RECEIVE,siteId:siteId,postId:postId,comments:comments});if(totalCommentsCount>-1){dispatch({type:_actionTypes.COMMENTS_COUNT_RECEIVE,siteId:siteId,postId:postId,totalCommentsCount:totalCommentsCount})}}function commentsRequestFailure(dispatch,requestId,err){dispatch({type:_actionTypes.COMMENTS_REQUEST_FAILURE,requestId:requestId,error:err})}function requestPostComments(siteId,postId){return function(dispatch,getState){var postCommentRequests=(0,_selectors.getPostCommentRequests)(getState(),siteId,postId);var oldestCommentDateForPost=(0,_selectors.getPostOldestCommentDate)(getState(),siteId,postId);var query={order:"DESC",number:_constants.NUMBER_OF_COMMENTS_PER_FETCH};if(oldestCommentDateForPost&&oldestCommentDateForPost.toISOString){query.before=oldestCommentDateForPost.toISOString()}var requestId=(0,_utils.createRequestId)(siteId,postId,query);if(postCommentRequests&&[_actionTypes.COMMENTS_REQUEST,_actionTypes.COMMENTS_REQUEST_SUCCESS].indexOf(postCommentRequests.get(requestId))!==-1){return}dispatch({type:_actionTypes.COMMENTS_REQUEST,requestId:requestId});return _wp2.default.site(siteId).post(postId).comment().replies(query).then(function(_ref){var comments=_ref.comments;var found=_ref.found;return commentsRequestSuccess({dispatch:dispatch,requestId:requestId,siteId:siteId,postId:postId,comments:comments,totalCommentsCount:found})}).catch(function(err){return commentsRequestFailure(dispatch,requestId,err)})}}function createPlaceholderComment(commentText,postId,parentCommentId){return{ID:"placeholder-"+(new Date).getTime(),parent:parentCommentId?{ID:parentCommentId}:false,date:(new Date).toISOString(),content:commentText,status:"pending",type:"comment",post:{ID:postId},isPlaceholder:true,placeholderState:_constants.PLACEHOLDER_STATE.PENDING}}function removeComment(siteId,postId,commentId){return{type:_actionTypes.COMMENTS_REMOVE,siteId:siteId,postId:postId,commentId:commentId}}function writeComment(commentText,siteId,postId,parentCommentId){if(!commentText||!siteId||!postId){return}return function(dispatch){var placeholderComment=createPlaceholderComment(commentText,postId,parentCommentId),skipSort=!!parentCommentId;dispatch({type:_actionTypes.COMMENTS_RECEIVE,siteId:siteId,postId:postId,comments:[placeholderComment],skipSort:skipSort});var apiPromise=void 0;if(parentCommentId){apiPromise=_wp2.default.site(siteId).post(postId).comment(parentCommentId).reply({},commentText)}else{apiPromise=_wp2.default.site(siteId).post(postId).comment().add(commentText)}return apiPromise.then(function(comment){dispatch({type:_actionTypes.COMMENTS_REMOVE,siteId:siteId,postId:postId,commentId:placeholderComment.ID});dispatch({type:_actionTypes.COMMENTS_RECEIVE,siteId:siteId,postId:postId,comments:[comment],skipSort:skipSort});return comment}).catch(function(error){dispatch({type:_actionTypes.COMMENTS_ERROR,siteId:siteId,postId:postId,commentId:placeholderComment.ID,error:error});throw error})}}function likeComment(siteId,postId,commentId){return function(dispatch){dispatch({type:_actionTypes.COMMENTS_LIKE,siteId:siteId,postId:postId,commentId:commentId});return _wp2.default.site(siteId).comment(commentId).like().add({source:"reader"}).then(function(data){return dispatch({type:_actionTypes.COMMENTS_LIKE_UPDATE,siteId:siteId,postId:postId,commentId:commentId,iLike:data.i_like,likeCount:data.like_count})}).catch(function(){return dispatch({type:_actionTypes.COMMENTS_UNLIKE,siteId:siteId,postId:postId,commentId:commentId})})}}function unlikeComment(siteId,postId,commentId){return function(dispatch){dispatch({type:_actionTypes.COMMENTS_UNLIKE,siteId:siteId,postId:postId,commentId:commentId});return _wp2.default.site(siteId).comment(commentId).like().del({source:"reader"}).then(function(data){return dispatch({type:_actionTypes.COMMENTS_LIKE_UPDATE,siteId:siteId,postId:postId,commentId:commentId,iLike:data.i_like,likeCount:data.like_count})}).catch(function(){return dispatch({type:_actionTypes.COMMENTS_LIKE,siteId:siteId,postId:postId,commentId:commentId})})}}},1756:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getCommentLike=exports.haveMoreCommentsToFetch=exports.getPostCommentsTree=exports.getPostOldestCommentDate=exports.getPostMostRecentCommentDate=exports.getPostTotalCommentsCount=exports.getPostCommentRequests=exports.getPostCommentItems=undefined;var _createSelector=__webpack_require__(100);var _createSelector2=_interopRequireDefault(_createSelector);var _utils=__webpack_require__(766);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var getPostCommentItems=exports.getPostCommentItems=function getPostCommentItems(state,siteId,postId){return state.comments.items.get((0,_utils.getCommentParentKey)(siteId,postId))};var getPostCommentRequests=exports.getPostCommentRequests=function getPostCommentRequests(state,siteId,postId){return state.comments.requests.get((0,_utils.getCommentParentKey)(siteId,postId))};var getPostTotalCommentsCount=exports.getPostTotalCommentsCount=function getPostTotalCommentsCount(state,siteId,postId){return state.comments.totalCommentsCount.get((0,_utils.getCommentParentKey)(siteId,postId))};var getPostMostRecentCommentDate=exports.getPostMostRecentCommentDate=(0,_createSelector2.default)(function(state,siteId,postId){var items=getPostCommentItems(state,siteId,postId);return items&&items.first()?new Date(items.first().get("date")):undefined},getPostCommentItems);var getPostOldestCommentDate=exports.getPostOldestCommentDate=(0,_createSelector2.default)(function(state,siteId,postId){var items=getPostCommentItems(state,siteId,postId);return items&&items.last()?new Date(items.last().get("date")):undefined},getPostCommentItems);var getPostCommentsTree=exports.getPostCommentsTree=(0,_createSelector2.default)(function(state,siteId,postId){var items=getPostCommentItems(state,siteId,postId);return items?(0,_utils.buildCommentsTree)(items):undefined},getPostCommentItems);var haveMoreCommentsToFetch=exports.haveMoreCommentsToFetch=(0,_createSelector2.default)(function(state,siteId,postId){var items=getPostCommentItems(state,siteId,postId);var totalCommentsCount=getPostTotalCommentsCount(state,siteId,postId);return items&&totalCommentsCount?items.size<totalCommentsCount:undefined},function(state,siteId,postId){return[getPostCommentItems(state,siteId,postId),getPostTotalCommentsCount(state,siteId,postId)]});var getCommentLike=exports.getCommentLike=(0,_createSelector2.default)(function(state,siteId,postId,commentId){var items=getPostCommentItems(state,siteId,postId);var comment=items.find(function(c){return c.get("ID")===commentId});if(!comment){return undefined}return comment.filter(function(v,k){return["i_like","like_count"].indexOf(k)>-1})},getPostCommentItems)},1765:function(module,exports,__webpack_require__){"use strict";var throttle=__webpack_require__(388),SCROLL_CHECK_RATE_IN_MS=400;module.exports=function(nextPageMethod){return{componentDidMount:function componentDidMount(){this.checkScrollPositionHandler=throttle(this.checkScrollPosition.bind(this,{triggeredByScroll:true}),SCROLL_CHECK_RATE_IN_MS);window.addEventListener("scroll",this.checkScrollPositionHandler);this.checkScrollPosition({triggeredByScroll:false})},componentDidUpdate:function componentDidUpdate(){this.checkScrollPosition({triggeredByScroll:false})},componentWillUnmount:function componentWillUnmount(){window.removeEventListener("scroll",this.checkScrollPositionHandler)},checkScrollPosition:function checkScrollPosition(options){var scrollPosition=window.pageYOffset,documentHeight=document.body.scrollHeight,viewportHeight=window.innerHeight,scrollOffset=2*viewportHeight,triggeredByScroll=options.triggeredByScroll,self=this;if(scrollPosition>=documentHeight-viewportHeight-scrollOffset){if(scrollPosition>viewportHeight){triggeredByScroll=true}setTimeout(function(){self[nextPageMethod]({triggeredByScroll:triggeredByScroll})},0)}}}}},1780:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _omit=__webpack_require__(18);var _omit2=_interopRequireDefault(_omit);var _noop=__webpack_require__(38);var _noop2=_interopRequireDefault(_noop);var _formTextarea=__webpack_require__(1668);var _formTextarea2=_interopRequireDefault(_formTextarea);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"CountedTextarea",propTypes:{value:_react2.default.PropTypes.string,placeholder:_react2.default.PropTypes.string,countPlaceholderLength:_react2.default.PropTypes.bool,onChange:_react2.default.PropTypes.func,acceptableLength:_react2.default.PropTypes.number,showRemainingCharacters:_react2.default.PropTypes.bool},getDefaultProps:function getDefaultProps(){return{value:"",placeholder:"",countPlaceholderLength:false,onChange:_noop2.default,showRemainingCharacters:false}},renderCountPanel:function renderCountPanel(){var length=this.props.value.length;if(!length&&this.props.countPlaceholderLength){length=this.props.placeholder.length}var panelText=void 0;if(this.props.showRemainingCharacters&&this.props.acceptableLength){panelText=this.translate("%d character remaining","%d characters remaining",{context:"Input length",args:[this.props.acceptableLength-length],count:this.props.acceptableLength-length})}else{panelText=this.translate("%d character","%d characters",{context:"Input length",args:[length],count:length})}return _react2.default.createElement("div",{className:"counted-textarea__count-panel"},panelText,this.props.children)},render:function render(){var classes=(0,_classnames2.default)("counted-textarea",this.props.className,{"is-exceeding-acceptable-length":this.props.acceptableLength&&this.props.value.length>this.props.acceptableLength});return _react2.default.createElement("div",{className:classes},_react2.default.createElement(_formTextarea2.default,(0,_extends3.default)({},(0,_omit2.default)(this.props,"className","acceptableLength","showRemainingCharacters","children","countPlaceholderLength"),{className:"counted-textarea__input"})),this.renderCountPanel())}});module.exports=exports["default"]},1782:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _assign=__webpack_require__(34);var _assign2=_interopRequireDefault(_assign);var _noop=__webpack_require__(38);var _noop2=_interopRequireDefault(_noop);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"TrackInputChanges",propTypes:{onNewValue:_react2.default.PropTypes.func},getDefaultProps:function getDefaultProps(){return{onNewValue:_noop2.default}},componentWillMount:function componentWillMount(){this.inputEdited=false},onInputChange:function onInputChange(){this.inputEdited=true},onInputBlur:function onInputBlur(event){if(this.inputEdited){this.props.onNewValue(event);this.inputEdited=false}},render:function render(){var _this=this;var child=_react2.default.Children.only(this.props.children);var props=(0,_assign2.default)({},child.props,{onChange:function onChange(event){if(typeof child.props.onChange==="function"){child.props.onChange.call(child,event)}_this.onInputChange(event)},onBlur:function onBlur(event){if(typeof child.props.onBlur==="function"){child.props.onBlur.call(child,event)}_this.onInputBlur(event)}});return _react2.default.cloneElement(child,props)}});module.exports=exports["default"]},1794:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _defineProperty2=__webpack_require__(7);var _defineProperty3=_interopRequireDefault(_defineProperty2);var _extends3=__webpack_require__(16);var _extends4=_interopRequireDefault(_extends3);exports.isRequestingPostCounts=isRequestingPostCounts;exports.getAllPostCounts=getAllPostCounts;exports.getAllPostCount=getAllPostCount;exports.getMyPostCounts=getMyPostCounts;exports.getMyPostCount=getMyPostCount;exports.getNormalizedPostCounts=getNormalizedPostCounts;exports.getNormalizedMyPostCounts=getNormalizedMyPostCounts;var _get=__webpack_require__(24);var _get2=_interopRequireDefault(_get);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var POST_STATUSES=["publish","draft","pending","private","future","trash"];function isRequestingPostCounts(state,siteId,postType){return(0,_get2.default)(state.posts.counts.requesting,[siteId,postType],false)}function getAllPostCounts(state,siteId,postType){return(0,_get2.default)(state.posts.counts.counts,[siteId,postType,"all"],null)}function getAllPostCount(state,siteId,postType,status){var counts=getAllPostCounts(state,siteId,postType);if(!counts){return null}return counts[status]||0}function getMyPostCounts(state,siteId,postType){return(0,_get2.default)(state.posts.counts.counts,[siteId,postType,"mine"],null)}function getMyPostCount(state,siteId,postType,status){var counts=getMyPostCounts(state,siteId,postType);if(!counts){return null}return counts[status]||0}function getNormalizedPostCounts(state,siteId,postType){var countSelector=arguments.length>3&&arguments[3]!==undefined?arguments[3]:getAllPostCounts;var counts=countSelector(state,siteId,postType);return POST_STATUSES.reduce(function(memo,status){var count=(0,_get2.default)(counts,status,0);var key=void 0;switch(status){case"publish":case"private":key="publish";break;case"draft":case"pending":key="draft";break;default:key=status}return(0,_extends4.default)({},memo,(0,_defineProperty3.default)({},key,(memo[key]||0)+count))},{})}function getNormalizedMyPostCounts(state,siteId,postType){return getNormalizedPostCounts(state,siteId,postType,getMyPostCounts)}},1807:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1);var postListStoreFactory=__webpack_require__(1726),PostContentImagesStore=__webpack_require__(1902),Dispatcher=__webpack_require__(42),actions=__webpack_require__(1648),pollers=__webpack_require__(221);var PostListFetcher;function dispatchQueryActions(postListStoreId,query){var postListStore=postListStoreFactory(postListStoreId);actions.queryPosts(query,postListStoreId);if(postListStore.getPage()===0){actions.fetchNextPage(postListStoreId)}}function queryPosts(props){var query={type:props.type||"post",siteID:props.siteID,status:props.status,author:props.author,search:props.search,exclude_tree:props.excludeTree,orderBy:props.orderBy,order:props.order,number:props.number,before:props.before,after:props.after};if(props.withCounts){query.meta="counts"}if(Dispatcher.isDispatching()){setTimeout(function(){dispatchQueryActions(props.postListStoreId,query)},0)}else{dispatchQueryActions(props.postListStoreId,query)}}function getPostsState(postListStoreId){var postListStore=postListStoreFactory(postListStoreId);return{listId:postListStore.getID(),posts:postListStore.getAll(),postImages:PostContentImagesStore.getAll(),page:postListStore.getPage(),lastPage:postListStore.isLastPage(),loading:postListStore.isFetchingNextPage(),hasRecentError:postListStore.hasRecentError()}}function shouldQueryPosts(props,nextProps){return props.type!==nextProps.type||props.status!==nextProps.status||props.author!==nextProps.author||props.search!==nextProps.search||props.excludeTree!==nextProps.excludeTree||props.withCounts!==nextProps.withCounts||props.orderBy!==nextProps.orderBy||props.order!==nextProps.order||props.number!==nextProps.number||props.before!==nextProps.before||props.after!==nextProps.after||props.siteID!==nextProps.siteID||props.postListStoreId!==nextProps.postListStoreId}PostListFetcher=React.createClass({displayName:"PostListFetcher",propTypes:{children:React.PropTypes.element.isRequired,type:React.PropTypes.string,status:React.PropTypes.string,author:React.PropTypes.number,search:React.PropTypes.string,siteID:React.PropTypes.any,withImages:React.PropTypes.bool,withCounts:React.PropTypes.bool,excludeTree:React.PropTypes.number,orderBy:React.PropTypes.oneOf(["title","date","modified","comment_count","ID"]),order:React.PropTypes.oneOf(["ASC","DESC"]),number:React.PropTypes.number,before:React.PropTypes.string,after:React.PropTypes.string,postListStoreId:React.PropTypes.string},getDefaultProps:function getDefaultProps(){return{orderBy:"date",order:"DESC",postListStoreId:"default"}},componentWillMount:function componentWillMount(){var postListStore=postListStoreFactory(this.props.postListStoreId);postListStore.on("change",this.onPostsChange);if(this.props.withImages){PostContentImagesStore.on("change",this.onPostsChange)}queryPosts(this.props)},componentDidMount:function componentDidMount(){var postListStore=postListStoreFactory(this.props.postListStoreId);this._poller=pollers.add(postListStore,actions.fetchUpdated,{interval:6e4})},componentWillUnmount:function componentWillUnmount(){var postListStore=postListStoreFactory(this.props.postListStoreId);pollers.remove(this._poller);postListStore.off("change",this.onPostsChange);if(this.props.withImages){PostContentImagesStore.off("change",this.onPostsChange)}},componentWillReceiveProps:function componentWillReceiveProps(nextProps){var listenerChange;if(shouldQueryPosts(this.props,nextProps)){queryPosts(nextProps)}if(nextProps.withImages!==this.props.withImages){listenerChange=nextProps.withImages?"on":"off";PostContentImagesStore[listenerChange]("change",this.onPostsChange)}},onPostsChange:function onPostsChange(){this.setState(getPostsState(this.props.postListStoreId))},render:function render(){return React.cloneElement(this.props.children,this.state)}});module.exports=PostListFetcher},1822:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getOwnPropertyNames=__webpack_require__(1827);var _getOwnPropertyNames2=_interopRequireDefault(_getOwnPropertyNames);var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _reactRedux=__webpack_require__(15);var _redux=__webpack_require__(6);var _noop=__webpack_require__(38);var _noop2=_interopRequireDefault(_noop);var _i18nCalypso=__webpack_require__(11);var _gravatar=__webpack_require__(710);var _gravatar2=_interopRequireDefault(_gravatar);var _notice=__webpack_require__(76);var _notice2=_interopRequireDefault(_notice);var _selectors=__webpack_require__(90);var _actions=__webpack_require__(1755);var _stats=__webpack_require__(1643);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var PostCommentForm=function(_React$Component){(0,_inherits3.default)(PostCommentForm,_React$Component);function PostCommentForm(props){(0,_classCallCheck3.default)(this,PostCommentForm);var _this=(0,_possibleConstructorReturn3.default)(this,(PostCommentForm.__proto__||(0,_getPrototypeOf2.default)(PostCommentForm)).call(this));_this.state={commentText:props.commentText||"",haveFocus:false};(0,_getOwnPropertyNames2.default)(PostCommentForm.prototype).filter(function(prop){return prop.indexOf("handle")===0}).filter(function(prop){return typeof _this[prop]==="function"}).forEach(function(prop){return _this[prop]=_this[prop].bind(_this)});return _this}(0,_createClass3.default)(PostCommentForm,[{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){this.setState({commentText:nextProps.commentText||""})}},{key:"componentDidMount",value:function componentDidMount(){if(this.props.parentCommentID&&this._textareaNode){this._textareaNode.focus()}}},{key:"componentDidUpdate",value:function componentDidUpdate(){var commentTextNode=this.refs.commentText;if(!commentTextNode){return}var commentText=this.getCommentText();var currentHeight=parseInt(commentTextNode.style.height,10)||0;commentTextNode.style.height=commentText.length?Math.max(commentTextNode.scrollHeight,currentHeight)+"px":null}},{key:"handleTextAreaNode",value:function handleTextAreaNode(textareaNode){this._textareaNode=textareaNode}},{key:"handleSubmit",value:function handleSubmit(event){event.preventDefault();this.submit()}},{key:"handleKeyDown",value:function handleKeyDown(event){if(event.keyCode===13&&(event.ctrlKey||event.metaKey)){event.preventDefault();this.submit()}if(event.keyCode===27){if(this.props.placeholderId){this.props.onUpdateCommentText(this.props.commentText);this.props.removeComment(this.props.post.site_ID,this.props.post.ID,this.props.placeholderId)}}}},{key:"handleFocus",value:function handleFocus(){this.setState({haveFocus:true})}},{key:"handleTextChange",value:function handleTextChange(event){var commentText=event.target.value;this.setState({commentText:commentText});this.props.onUpdateCommentText(commentText)}},{key:"resetCommentText",value:function resetCommentText(){this.setState({commentText:""});this.props.onUpdateCommentText("")}},{key:"hasCommentText",value:function hasCommentText(){return this.state.commentText.trim().length>0}},{key:"submit",value:function submit(){var post=this.props.post;var commentText=this.state.commentText.trim();if(!commentText){this.resetCommentText();return false}if(this.props.placeholderId){this.props.removeComment(post.site_ID,post.ID,this.props.placeholderId)}this.props.writeComment(commentText,post.site_ID,post.ID,this.props.parentCommentID);(0,_stats.recordAction)("posted_comment");(0,_stats.recordGaEvent)("Clicked Post Comment Button");(0,_stats.recordTrackForPost)("calypso_reader_article_commented_on",post,{parent_post_id:this.props.parentCommentID?this.props.parentCommentID:undefined});this.resetCommentText();this.props.onCommentSubmit();return true}},{key:"renderError",value:function renderError(){var error=this.props.error;var message=void 0;if(!error){return null}switch(error.error){case"comment_duplicate":message=(0,_i18nCalypso.translate)("Duplicate comment detected. It looks like you've already said that!");break;default:message=(0,_i18nCalypso.translate)("Sorry - there was a problem posting your comment.");break}return _react2.default.createElement(_notice2.default,{text:message,className:"reader-comments__notice",showDismiss:false,status:"is-error"})}},{key:"render",value:function render(){var post=this.props.post;if(post&&post.discussion&&post.discussion.comments_open===false){if(post.discussion.comment_count&&post.discussion.comment_count>0){return _react2.default.createElement("p",{className:"comments__form-closed"},(0,_i18nCalypso.translate)("Comments are closed."))}return null}var buttonClasses=(0,_classnames2.default)({"is-active":this.hasCommentText(),"is-visible":this.state.haveFocus||this.hasCommentText()});var expandingAreaClasses=(0,_classnames2.default)({focused:this.state.haveFocus,"expanding-area":true});return _react2.default.createElement("form",{className:"comments__form",ref:"commentForm"},_react2.default.createElement("fieldset",null,_react2.default.createElement(_gravatar2.default,{user:this.props.currentUser}),_react2.default.createElement("label",null,_react2.default.createElement("div",{className:expandingAreaClasses},_react2.default.createElement("pre",null,_react2.default.createElement("span",null,this.state.commentText),_react2.default.createElement("br",null)),_react2.default.createElement("textarea",{value:this.state.commentText,placeholder:(0,_i18nCalypso.translate)("Enter your comment here"),ref:this.handleTextAreaNode,onKeyUp:this.handleKeyUp,onKeyDown:this.handleKeyDown,onFocus:this.handleFocus,onBlur:this.handleBlur,onChange:this.handleTextChange})),_react2.default.createElement("button",{ref:"commentButton",className:buttonClasses,disabled:this.state.commentText.length===0,onClick:this.handleSubmit},(0,_i18nCalypso.translate)("Send")),this.renderError())))}}]);return PostCommentForm}(_react2.default.Component);PostCommentForm.propTypes={post:_react2.default.PropTypes.object.isRequired,parentCommentID:_react2.default.PropTypes.number,placeholderId:_react2.default.PropTypes.string,commentText:_react2.default.PropTypes.string,onUpdateCommentText:_react2.default.PropTypes.func.isRequired,onCommentSubmit:_react2.default.PropTypes.func,currentUser:_react2.default.PropTypes.object.isRequired,writeComment:_react2.default.PropTypes.func.isRequired,removeComment:_react2.default.PropTypes.func.isRequired};PostCommentForm.defaultProps={onCommentSubmit:_noop2.default};exports.default=(0,_reactRedux.connect)(function(state){return{currentUser:(0,_selectors.getCurrentUser)(state)}},function(dispatch){return(0,_redux.bindActionCreators)({writeComment:_actions.writeComment,removeComment:_actions.removeComment},dispatch)})(PostCommentForm);module.exports=exports["default"]},1827:function(module,exports,__webpack_require__){module.exports={default:__webpack_require__(2188),__esModule:true}},1846:function(module,exports,__webpack_require__){"use strict";var Traverser=__webpack_require__(1847);function TreeConvert(key){if(!(this instanceof TreeConvert)){return new TreeConvert(key)}this.key=key||"id"}TreeConvert.prototype.treeify=function(items){var tree=[],indexedNodes={};items.forEach(function(item,i){indexedNodes[items[i][this.key]]=item},this);items.forEach(function(item){var parentNode;if(item.parent>0&&indexedNodes[item.parent]){parentNode=indexedNodes[item.parent];parentNode.items=parentNode.items||[];parentNode.items.push(item)}else{item.parent=0;tree.push(item)}});this.sortItems(tree);this.removeOrderProperty(tree);return tree};TreeConvert.prototype.untreeify=function(tree,list){list=list||[];tree.forEach(function(item,index){if(item.items){TreeConvert.prototype.untreeify(item.items,list)}item.order=index+1;list.push(item)});return list};TreeConvert.prototype.sortItems=function(itemTrees){var root={};root.items=itemTrees;Traverser.traverse(root,[function(node){node.items&&node.items.sort(function(a,b){return a.order-b.order});return node}])};TreeConvert.prototype.removeOrderProperty=function(itemTrees){var root={};root.items=itemTrees;Traverser.traverse(root,[function(node){node.items&&node.items.forEach(function(item){delete item.order});return node}])};module.exports=TreeConvert},1847:function(module,exports,__webpack_require__){"use strict";var findIndex=__webpack_require__(214),some=__webpack_require__(63);
function parent(node,tree){return find(tree,function(it){return some(it.items,{id:node.id})})||tree}function _traverse(node,filters,root){filters.forEach(function(filter){node=filter(node,root)},this);if(node.items){node.items=node.items.map(function(item){return _traverse(item,filters,root)})}return node}function find(node,predicate){if(predicate(node)){return node}if(node.items){return mapFindAny(node.items,function(node){return find(node,predicate)})}}function replaceItem(node,newNode,predicate){var i;if(!node.items){return}for(i=0;i<node.items.length;i++){if(predicate(node.items[i])){node.items[i]=newNode;return}replaceItem(node.items[i],newNode,predicate)}}function mapFindAny(array,fn){var i,result,length=array.length;for(i=0;i<length;i++){if(result=fn(array[i])){return result}}}function childInserter(srcNode,dstId){return function(node){if(node.id===dstId){node.items=node.items||[];node.items.push(srcNode)}return node}}function siblingInserter(srcNode,dstId,position){return function(node){var index,offset=position==="before"?0:1;if(~(index=findIndex(node.items,{id:dstId}))){node.items.splice(index+offset,0,srcNode)}return node}}module.exports={traverse:function traverse(root,filters){return _traverse(root,filters,root)},parent:parent,find:find,replaceItem:replaceItem,remover:function remover(id){return function(node){var index;if(~(index=findIndex(node.items,{id:id}))){node.items.splice(index,1)}return node}},inserter:function inserter(srcItem,dstId,position){var func="child"===position?childInserter:siblingInserter;return func(srcItem,dstId,position)}}},1860:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _promise=__webpack_require__(49);var _promise2=_interopRequireDefault(_promise);exports.dismissShareConfirmation=dismissShareConfirmation;exports.sharePost=sharePost;exports.fetchConnections=fetchConnections;exports.receiveConnections=receiveConnections;exports.failConnectionsRequest=failConnectionsRequest;var _wp=__webpack_require__(28);var _wp2=_interopRequireDefault(_wp);var _actionTypes=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function dismissShareConfirmation(siteId,postId){return{type:_actionTypes.PUBLICIZE_SHARE_DISMISS,siteId:siteId,postId:postId}}function sharePost(siteId,postId,skippedConnections,message){return function(dispatch){dispatch({type:_actionTypes.PUBLICIZE_SHARE,siteId:siteId,postId:postId,skippedConnections:skippedConnections,message:message});return new _promise2.default(function(resolve){_wp2.default.undocumented().publicizePost(siteId,postId,message,skippedConnections,function(error,data){if(error||!data.success){dispatch({type:_actionTypes.PUBLICIZE_SHARE_FAILURE,siteId:siteId,postId:postId,error:error})}else{dispatch({type:_actionTypes.PUBLICIZE_SHARE_SUCCESS,siteId:siteId,postId:postId})}resolve()})})}}function fetchConnections(siteId){return function(dispatch){dispatch({type:_actionTypes.PUBLICIZE_CONNECTIONS_REQUEST,siteId:siteId});return new _promise2.default(function(resolve){_wp2.default.undocumented().siteConnections(siteId,function(error,data){if(error){dispatch(failConnectionsRequest(siteId,error))}else{dispatch(receiveConnections(siteId,data))}resolve()})})}}function receiveConnections(siteId,data){return{type:_actionTypes.PUBLICIZE_CONNECTIONS_RECEIVE,siteId:siteId,data:data}}function failConnectionsRequest(siteId,error){return{type:_actionTypes.PUBLICIZE_CONNECTIONS_REQUEST_FAILURE,siteId:siteId,error:error}}},1861:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getConnectionsBySiteId=getConnectionsBySiteId;exports.getSiteUserConnections=getSiteUserConnections;exports.hasFetchedConnections=hasFetchedConnections;exports.isFetchingConnections=isFetchingConnections;exports.isRequestingSharePost=isRequestingSharePost;exports.sharePostSuccessMessage=sharePostSuccessMessage;exports.sharePostFailure=sharePostFailure;var _filter=__webpack_require__(77);var _filter2=_interopRequireDefault(_filter);var _get=__webpack_require__(24);var _get2=_interopRequireDefault(_get);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function getConnectionsBySiteId(state,siteId){return(0,_filter2.default)(state.sharing.publicize.connections,{site_ID:siteId})}function getSiteUserConnections(state,siteId,userId){return(0,_filter2.default)(state.sharing.publicize.connections,function(connection){var site_ID=connection.site_ID;var shared=connection.shared;var keyring_connection_user_ID=connection.keyring_connection_user_ID;return site_ID===siteId&&(shared||keyring_connection_user_ID===userId)})}function hasFetchedConnections(state,siteId){var fetchingConnections=state.sharing.publicize.fetchingConnections;return fetchingConnections.hasOwnProperty(siteId)}function isFetchingConnections(state,siteId){var fetchingConnections=state.sharing.publicize.fetchingConnections;return hasFetchedConnections(state,siteId)&&fetchingConnections[siteId]}function isRequestingSharePost(state,siteId,postId){return(0,_get2.default)(state.sharing.publicize.sharePostStatus,[siteId,postId,"requesting"],false)}function sharePostSuccessMessage(state,siteId,postId){return(0,_get2.default)(state.sharing.publicize.sharePostStatus,[siteId,postId,"success"],false)}function sharePostFailure(state,siteId,postId){return(0,_get2.default)(state.sharing.publicize.sharePostStatus,[siteId,postId,"error"],false)===true}},1880:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _react=__webpack_require__(1);var _reactRedux=__webpack_require__(15);var _actions=__webpack_require__(1922);var _selectors=__webpack_require__(1794);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var QueryPostCounts=function(_Component){(0,_inherits3.default)(QueryPostCounts,_Component);function QueryPostCounts(){(0,_classCallCheck3.default)(this,QueryPostCounts);return(0,_possibleConstructorReturn3.default)(this,(QueryPostCounts.__proto__||(0,_getPrototypeOf2.default)(QueryPostCounts)).apply(this,arguments))}(0,_createClass3.default)(QueryPostCounts,[{key:"componentWillMount",value:function componentWillMount(){this.request(this.props)}},{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){if(this.props.siteId===nextProps.siteId&&this.props.type===nextProps.type){return}this.request(nextProps)}},{key:"request",value:function request(props){if(props.requesting){return}props.requestPostCounts(props.siteId,props.type)}},{key:"render",value:function render(){return null}}]);return QueryPostCounts}(_react.Component);QueryPostCounts.propTypes={siteId:_react.PropTypes.number.isRequired,type:_react.PropTypes.string.isRequired,requesting:_react.PropTypes.bool,requestPostCounts:_react.PropTypes.func};exports.default=(0,_reactRedux.connect)(function(state,ownProps){var siteId=ownProps.siteId;var type=ownProps.type;return{requesting:(0,_selectors.isRequestingPostCounts)(state,siteId,type)}},{requestPostCounts:_actions.requestPostCounts})(QueryPostCounts);module.exports=exports["default"]},1900:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1);var actions=__webpack_require__(1648),analytics=__webpack_require__(20);module.exports={getInitialState:function getInitialState(){return{updated:false,updatedStatus:null,previousStatus:null}},buildUpdateTemplate:function buildUpdateTemplate(){var post=this.props.post||this.props.page,status=this.state.updatedStatus,updateClass="conf-alert",strings=this.strings,updateText,undoTemplate,undoClick,trashText;if(!this.state.updated){return}switch(status){case"trashing":case"deleting":trashText=status==="deleting"?strings.deleting:strings.trashing;updateText=React.createElement("span",null,trashText," ",React.createElement("span",{className:"loading-dot"},"."),React.createElement("span",{className:"loading-dot"},"."),React.createElement("span",{className:"loading-dot"},"."));updateClass+=" conf-alert--trashing";break;case"trash":undoClick=this.resetToPreviousState;undoTemplate=React.createElement("a",{className:"undo",onClick:undoClick},React.createElement("span",null,strings.undo));updateText=strings.trashed;updateClass+=" conf-alert--trashed";break;case"deleted":updateText=strings.deleted;updateClass+=" conf-alert--deleted";break;case"updating":updateText=React.createElement("span",null,strings.updating," ",React.createElement("span",{className:"loading-dot"},"."),React.createElement("span",{className:"loading-dot"},"."),React.createElement("span",{className:"loading-dot"},"."));updateClass+=" conf-alert--updating";break;case"error":updateText=strings.error;updateClass+=" conf-alert--error";break;case"restoring":updateText=React.createElement("span",null,strings.restoring," ",React.createElement("span",{className:"loading-dot"},"."),React.createElement("span",{className:"loading-dot"},"."),React.createElement("span",{className:"loading-dot"},"."));updateClass+=" conf-alert--updating";break;default:if(this.state.previousStatus==="trash"){updateText=strings.restored}else{updateText=strings.updated}}return React.createElement("div",{key:post.global_ID+"-update",className:"updated-confirmation"},React.createElement("div",{className:updateClass},React.createElement("div",{className:"conf-alert_con"},React.createElement("span",{className:"conf-alert_title"},updateText),undoTemplate)))},updatePostStatus:function updatePostStatus(status){var post=this.props.post||this.props.page,previousStatus=null,strings=this.strings,setNewStatus;setNewStatus=function(error,post){if(error){this.setErrorState();return false}this.setState({previousStatus:previousStatus,updatedStatus:post.status,showMoreOptions:false});return true}.bind(this);if(status==="delete"){this.setState({updatedStatus:"deleting",updated:true});if(window.confirm(strings.deleteWarning)){actions.trash(post,setNewStatus)}else{this.resetState()}}else if(status==="trash"){this.setState({updatedStatus:"trashing",updated:true});previousStatus=post.status;actions.trash(post,setNewStatus)}else if(status==="restore"){this.setState({updatedStatus:"restoring",updated:true});previousStatus="trash";actions.restore(post,setNewStatus)}else{this.setState({updatedStatus:"updating",updated:true});actions.update(post,{status:status},function(error,post){if(!setNewStatus(error,post)){return}setTimeout(function(){this.resetState()}.bind(this),1200)}.bind(this))}},setErrorState:function setErrorState(){this.setState({updated:true,updatedStatus:"error"});setTimeout(function(){this.resetState()}.bind(this),1200)},resetState:function resetState(){this.setState({updatedStatus:null,updated:false,showMoreOptions:false,showPageActions:false})},resetToPreviousState:function resetToPreviousState(){var analyticsValues=this.props.page?{group:"Pages",eventName:"Clicked Undo Trashed Page"}:{group:"Posts",eventName:"Clicked Undo Trashed Post"};analytics.ga.recordEvent(analyticsValues.group,analyticsValues.eventName);if(this.state.previousStatus){this.updatePostStatus(this.state.previousStatus)}}}},1902:function(module,exports,__webpack_require__){"use strict";var isEqual=__webpack_require__(98),pick=__webpack_require__(91);var Emitter=__webpack_require__(36),Dispatcher=__webpack_require__(42),utils=__webpack_require__(1649),PostsStore=__webpack_require__(1727);var _contentImages={},PostContentImagesStore;function scrapeAll(posts){posts.forEach(scrapePost)}function scrapePost(post){var imagesFromPost=pick(PostsStore.get(post.global_ID),"content_images","canonical_image","featured_image","images","global_ID");utils.normalizeAsync(imagesFromPost,function(error,normalizedPostImages){var cachedImages=PostContentImagesStore.get(normalizedPostImages.global_ID);if(isEqual(normalizedPostImages,cachedImages)){return}_contentImages[normalizedPostImages.global_ID]=normalizedPostImages;PostContentImagesStore.emit("change")})}PostContentImagesStore={get:function get(postGlobalID){return _contentImages[postGlobalID]},getAll:function getAll(){return _contentImages}};Emitter(PostContentImagesStore);PostContentImagesStore.dispatchToken=Dispatcher.register(function(payload){var action=payload.action;Dispatcher.waitFor([PostsStore.dispatchToken]);switch(action.type){case"RECEIVE_POSTS_PAGE":case"RECEIVE_UPDATED_POSTS":if(!action.error&&action.data.posts){scrapeAll(action.data.posts)}break;case"RECEIVE_UPDATED_POST":if(!action.error){scrapePost(action.post)}break}});module.exports=PostContentImagesStore},1903:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _typeof2=__webpack_require__(32);var _typeof3=_interopRequireDefault(_typeof2);var _keys=__webpack_require__(39);var _keys2=_interopRequireDefault(_keys);var _toConsumableArray2=__webpack_require__(41);var _toConsumableArray3=_interopRequireDefault(_toConsumableArray2);exports.getCacheKey=getCacheKey;exports.setCanonicalList=setCanonicalList;exports.getCanonicalList=getCanonicalList;exports.deleteCanonicalList=deleteCanonicalList;var _intersection=__webpack_require__(768);var _intersection2=_interopRequireDefault(_intersection);var _debug=__webpack_require__(3);var _debug2=_interopRequireDefault(_debug);var _sitesList=__webpack_require__(53);var _sitesList2=_interopRequireDefault(_sitesList);var _dispatcher=__webpack_require__(42);var _dispatcher2=_interopRequireDefault(_dispatcher);var _cacheIndex=__webpack_require__(772);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var cache={};var _canonicalCache={};var TTL_IN_MS=5*60*1e3;var sites=(0,_sitesList2.default)();var PostsListCache={get:get,_reset:function _reset(){cache={}}};var debug=(0,_debug2.default)("calypso:posts-list:cache");function isStale(list){var now=(new Date).getTime();var timeSaved=list.timeSaved;return now-timeSaved>TTL_IN_MS}function get(listKey){if(isListKeyFresh(listKey)){return cache[listKey].list}if(cache[listKey]&&cache[listKey].dirty){debug("delete cached list %o",listKey);delete cache[listKey];delete _canonicalCache[listKey]}}function set(list){var listKey=getCacheKey(list.query);if(!cache[listKey]||!cache[listKey].dirty){cache[listKey]={timeStored:(new Date).getTime(),dirty:false,list:list,listKey:listKey}}}function markDirty(post,oldStatus){var site=sites.getSite(post.site_ID);var affectedSites=[site.slug,site.ID,false];var affectedStatuses=[post.status,oldStatus];var listStatuses=void 0,key=void 0,entry=void 0,list=void 0;for(key in cache){if(!cache.hasOwnProperty(key)){continue}entry=cache[key];list=entry.list;if(list.query.type!==post.type){continue}if(-1===affectedSites.indexOf(list.query.siteID)){continue}listStatuses=list.query.status.split(",");if((0,_intersection2.default)(listStatuses,affectedStatuses).length===0){continue}entry.dirty=true}_cacheIndex.cacheIndex.clearRecordsByParamFilter(function(reqParams){var siteIdentifiers=affectedSites.slice(0,-1);var affectedPaths=["/me/posts"].concat((0,_toConsumableArray3.default)(siteIdentifiers.map(function(status){return"/sites/"+status+"/posts"})));var recordStatuses=reqParams.query&&reqParams.query.status?reqParams.query.status.split(","):[];var intersectingStatuses=(0,_intersection2.default)(recordStatuses,affectedStatuses);if(affectedPaths.indexOf(reqParams.path)===-1){return false}if(!intersectingStatuses.length){return false}return true})}function isListKeyFresh(listKey){return cache[listKey]&&!isStale(cache[listKey])&&!cache[listKey].dirty}PostsListCache.dispatchToken=_dispatcher2.default.register(function(payload){var action=payload.action,PostListStore=__webpack_require__(1726)();_dispatcher2.default.waitFor([PostListStore.dispatchToken]);switch(action.type){case"FETCH_NEXT_POSTS_PAGE":set(PostListStore.get());break;case"RECEIVE_POSTS_PAGE":set(PostListStore.get());break;case"RECEIVE_UPDATED_POSTS":set(PostListStore.get());break;case"RECEIVE_UPDATED_POST":case"RECEIVE_POST_BEING_EDITED":if(action.post){markDirty(action.post,action.original?action.original.status:null);set(PostListStore.get())}break}});function getCacheKey(options){var cacheKey=[];var keys=(0,_keys2.default)(options).sort();keys.forEach(function(key){cacheKey.push(key+"-"+options[key])});return cacheKey.join(":")}function setCanonicalList(listKey,requestKey,list){debug("setCanonicalList %o %o (%o)",listKey,requestKey,list);_canonicalCache[listKey]=_canonicalCache[listKey]||{};_canonicalCache[listKey][requestKey]=list}function getCanonicalList(listKey,requestKey){debug("getCanonicalList %o %o",listKey,requestKey);var stream=_canonicalCache[listKey];if(!stream||(typeof stream==="undefined"?"undefined":(0,_typeof3.default)(stream))!=="object"){return false}var keys=(0,_keys2.default)(stream);if(keys[0]!==requestKey){delete cache[listKey];delete _canonicalCache[listKey];return false}return stream[requestKey]}function deleteCanonicalList(listKey,requestKey){debug("deleteCanonicalList %o %o",listKey,requestKey);var stream=_canonicalCache[listKey];if(stream&&stream[requestKey]){delete stream[requestKey]}}exports.default=PostsListCache},1904:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _typeof2=__webpack_require__(32);var _typeof3=_interopRequireDefault(_typeof2);exports.getRemovedPosts=getRemovedPosts;exports.default=function(id){if(!id){throw new Error("must supply a post-list-store id")}var _activeList={postIds:[],errors:[],query:(0,_clone2.default)(_defaultQuery),page:0,nextPageHandle:false,isLastPage:false,isFetchingNextPage:false,isFetchingUpdated:false};function queryPosts(options){var query=(0,_assign2.default)({},_defaultQuery,options);if(query.siteID&&typeof query.siteID==="string"){query.siteID=query.siteID.replace(/::/g,"/")}if(query.status==="draft,pending"){query.orderBy="modified"}var listKey=(0,_postListCacheStore.getCacheKey)(query);var list=_postListCacheStore2.default.get(listKey);if(list){_activeList=list}else{_activeList={id:_nextId,postIds:[],errors:[],page:0,isLastPage:false,isFetchingNextPage:false,isFetchingUpdated:false,query:query,listKey:listKey};_nextId++}}function cleanParams(params){return(0,_transform2.default)(params,function(result,value,key){if(value!=null){result[key]=value}},{})}function sort(){var key=_activeList.query.orderBy;_activeList.postIds.sort(function(a,b){var postA=_postsStore2.default.get(a),postB=_postsStore2.default.get(b),timeA=postA[key],timeB=postB[key];if(timeA===timeB){if(postA.title===postB.title){return 0}return postA.title>postB.title?1:-1}return timeA>timeB?-1:1})}function receivePage(listId,error,data){if(error||!data||(typeof data==="undefined"?"undefined":(0,_typeof3.default)(data))!=="object"){error=error||{message:"Error fetching PostsList: empty data response"};debug("Error fetching PostsList from api:",error);error.timestamp=Date.now();_activeList.errors.push(error);return}var found=data.found;var meta=data.meta;var posts=data.posts;var __sync=data.__sync;var _ref=__sync||{};var responseSource=_ref.responseSource;var requestKey=_ref.requestKey;if(listId!==_activeList.id){return}_activeList.isFetchingNextPage=false;_activeList.nextPageHandle=meta&&meta.next_page;if(!_activeList.nextPageHandle||!found){_activeList.isLastPage=true}var responsePostIDs=posts.map(function(post){return post.global_ID});var priorList=_activeList.postIds.slice(0);if(responseSource==="local"&&requestKey){(0,_postListCacheStore.setCanonicalList)(_activeList.listKey,requestKey,priorList)}else{var canonicalList=(0,_postListCacheStore.getCanonicalList)(_activeList.listKey,requestKey);if(canonicalList){debug("canonicalList found (%o)",canonicalList);priorList=canonicalList;(0,_postListCacheStore.deleteCanonicalList)(_activeList.listKey,requestKey)}}var removedPosts=getRemovedPosts(priorList,responsePostIDs);if(removedPosts.length){debug("removePosts (%o)",removedPosts);priorList=(0,_difference2.default)(priorList,removedPosts)}var newPosts=(0,_difference2.default)(responsePostIDs,priorList);if(newPosts.length){debug("newPosts (%o)",newPosts);priorList=priorList.concat(newPosts);_activeList.page++}_activeList.postIds=priorList;sort()}function receiveUpdates(listId,error,data){var posts=void 0;var postIds=void 0;var newPostIds=void 0;if(error){debug("An error occurred while fetching updated posts %o",error);return}if(listId!==_activeList.id){return}if(!data.posts.length){return}posts=data.posts;debug("Fetched updated posts:",posts);postIds=posts.map(function(post){return post.global_ID});newPostIds=(0,_difference2.default)(postIds,_activeList.postIds);if(newPostIds.length){_activeList.postIds=_activeList.postIds.concat(newPostIds);sort()}}return new(function(_EventEmitter){(0,_inherits3.default)(_class,_EventEmitter);function _class(){(0,_classCallCheck3.default)(this,_class);var _this=(0,_possibleConstructorReturn3.default)(this,(_class.__proto__||(0,_getPrototypeOf2.default)(_class)).call(this));_this.id=id;_this.dispatchToken=_dispatcher2.default.register(_this.handlePayload.bind(_this));return _this}(0,_createClass3.default)(_class,[{key:"get",value:function get(){return _activeList}},{key:"getID",value:function getID(){return _activeList.id}},{key:"getSiteID",value:function getSiteID(){return _activeList.query.siteID}},{key:"getAll",value:function getAll(){return _activeList.postIds.map(function(globalID){return _postsStore2.default.get(globalID)})}},{key:"getTree",value:function getTree(){var sortedPosts=[];_activeList.postIds.forEach(function(globalID){var post=(0,_clone2.default)(_postsStore2.default.get(globalID));post.parent=post.parent?post.parent.ID:0;sortedPosts.push(post)});return(0,_treeConvert2.default)("ID").treeify(sortedPosts)}},{key:"getPost",value:function getPost(globalID){if(_activeList.postIds.indexOf(globalID)>-1){return _postsStore2.default.get(globalID)}}},{key:"getPage",value:function getPage(){return _activeList.page}},{key:"off",value:function off(event,method){this.removeListener(event,method)}},{key:"isLastPage",value:function isLastPage(){return _activeList.isLastPage}},{key:"isFetchingNextPage",value:function isFetchingNextPage(){return _activeList.isFetchingNextPage}},{key:"hasRecentError",value:function hasRecentError(){var recentTimeIntervalSeconds=30;var dateNow=Date.now();return(0,_some2.default)(_activeList.errors,function(error){return dateNow-error.timestamp<recentTimeIntervalSeconds*1e3})}},{key:"getNextPageParams",value:function getNextPageParams(){var params={};var query=_activeList.query;params.status=query.status;params.order_by=query.orderBy;params.order=query.order;params.author=query.author;params.number=query.perPage;params.type=query.type;params.page_handle=_activeList.nextPageHandle;params.exclude_tree=query.exclude_tree;params.number=query.number;params.before=query.before;params.after=query.after;if(query.search){params.search=query.search}if(!params.siteID){params.site_visibility="visible"}if(query.meta){params.meta=query.meta}return cleanParams(params)}},{key:"getUpdatesParams",value:function getUpdatesParams(){var params={};var query=_activeList.query;params.status=query.status;params.author=query.author;params.type=query.type;if(query.search){params.search=query.search}if(!params.siteID){params.site_visibility="visible"}if(query.meta){params.meta=query.meta}if(_activeList.postIds.length){params.modified_after=(0,_maxBy2.default)(this.getAll(),function(post){return new Date(post.modified).getTime()}).modified;if(query.orderBy!=="modified"&&!_activeList.isLastPage){params.after=this.getPost((0,_last2.default)(_activeList.postIds)).date}}return cleanParams(params)}},{key:"handlePayload",value:function handlePayload(payload){var action=payload.action;if(action.postListStoreId&&action.postListStoreId!==this.id&&"RECEIVE_UPDATED_POST"!==action.type){return}_dispatcher2.default.waitFor([_postsStore2.default.dispatchToken]);switch(action.type){case"QUERY_POSTS":debug("QUERY_POSTS",action);queryPosts(action.options);this.emit("change");break;case"FETCH_NEXT_POSTS_PAGE":debug("FETCH_NEXT_POSTS_PAGE",action);_activeList.isFetchingNextPage=true;this.emit("change");break;case"RECEIVE_POSTS_PAGE":debug("receivePage",action);receivePage(action.id,action.error,action.data);this.emit("change");break;case"RECEIVE_UPDATED_POSTS":receiveUpdates(action.id,action.error,action.data);this.emit("change");break;case"RECEIVE_UPDATED_POST":if(action.post){if(_activeList.postIds.indexOf(action.post.global_ID)>-1){this.emit("change")}}break}}}]);return _class}(_events.EventEmitter))};var _debug=__webpack_require__(3);var _debug2=_interopRequireDefault(_debug);var _clone=__webpack_require__(212);var _clone2=_interopRequireDefault(_clone);var _assign=__webpack_require__(34);var _assign2=_interopRequireDefault(_assign);var _transform=__webpack_require__(744);var _transform2=_interopRequireDefault(_transform);var _difference=__webpack_require__(118);var _difference2=_interopRequireDefault(_difference);var _last=__webpack_require__(215);var _last2=_interopRequireDefault(_last);var _maxBy=__webpack_require__(2021);var _maxBy2=_interopRequireDefault(_maxBy);var _events=__webpack_require__(139);var _some=__webpack_require__(63);var _some2=_interopRequireDefault(_some);var _dispatcher=__webpack_require__(42);var _dispatcher2=_interopRequireDefault(_dispatcher);var _treeConvert=__webpack_require__(1846);var _treeConvert2=_interopRequireDefault(_treeConvert);var _postsStore=__webpack_require__(1727);var _postsStore2=_interopRequireDefault(_postsStore);var _postListCacheStore=__webpack_require__(1903);var _postListCacheStore2=_interopRequireDefault(_postListCacheStore);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _defaultQuery={siteID:false,type:"post",status:"publish",orderBy:"date",order:"DESC",author:false,search:false,perPage:20};var debug=(0,_debug2.default)("calypso:posts-list");var _nextId=0;function getRemovedPosts(currentList,newPosts){if(currentList.length<3||newPosts.length<2){return[]}var overlapBegin=currentList.indexOf(newPosts[0]);if(overlapBegin===-1){return getRemovedPosts(currentList,newPosts.slice(1))}var overlapEnd=currentList.indexOf(newPosts.slice(-1)[0]);if(overlapEnd===-1){return getRemovedPosts(currentList,newPosts.slice(0,-1))}var overlapList=currentList.slice(overlapBegin,overlapEnd+1);return(0,_difference2.default)(overlapList,newPosts)}},1922:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.receivePostCounts=receivePostCounts;exports.requestPostCounts=requestPostCounts;var _wp=__webpack_require__(28);var _wp2=_interopRequireDefault(_wp);var _actionTypes=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function receivePostCounts(siteId,postType,counts){return{type:_actionTypes.POST_COUNTS_RECEIVE,siteId:siteId,postType:postType,counts:counts}}function requestPostCounts(siteId,postType){return function(dispatch){dispatch({type:_actionTypes.POST_COUNTS_REQUEST,postType:postType,siteId:siteId});return _wp2.default.undocumented().site(siteId).postCounts({type:postType}).then(function(data){dispatch(receivePostCounts(siteId,postType,data.counts));dispatch({type:_actionTypes.POST_COUNTS_REQUEST_SUCCESS,siteId:siteId,postType:postType})}).catch(function(error){dispatch({type:_actionTypes.POST_COUNTS_REQUEST_FAILURE,siteId:siteId,postType:postType,error:error})})}}},1926:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.isRequestingPostStat=isRequestingPostStat;exports.getPostStat=getPostStat;var _get=__webpack_require__(24);var _get2=_interopRequireDefault(_get);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function isRequestingPostStat(state,stat,siteId,postId){return(0,_get2.default)(state.stats.posts.requesting,[siteId,postId,stat],false)}function getPostStat(state,stat,siteId,postId){return(0,_get2.default)(state.stats.posts.items,[siteId,postId,stat],null)}},1929:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _findLast2=__webpack_require__(1867);var _findLast3=_interopRequireDefault(_findLast2);var _find2=__webpack_require__(27);var _find3=_interopRequireDefault(_find2);var _takeRightWhile2=__webpack_require__(2211);var _takeRightWhile3=_interopRequireDefault(_takeRightWhile2);var _startsWith2=__webpack_require__(83);var _startsWith3=_interopRequireDefault(_startsWith2);var _some2=__webpack_require__(63);var _some3=_interopRequireDefault(_some2);exports.getConfigForCurrentView=getConfigForCurrentView;exports.isUserEligible=isUserEligible;exports.isQueryStringEnabled=isQueryStringEnabled;exports.isViewEnabled=isViewEnabled;exports.wasFirstViewHiddenSinceEnteringCurrentSection=wasFirstViewHiddenSinceEnteringCurrentSection;exports.shouldViewBeVisible=shouldViewBeVisible;exports.secondsSpentOnCurrentView=secondsSpentOnCurrentView;exports.bucketedTimeSpentOnCurrentView=bucketedTimeSpentOnCurrentView;var _moment=__webpack_require__(4);var _moment2=_interopRequireDefault(_moment);var _constants=__webpack_require__(2185);var _selectors=__webpack_require__(794);var _selectors2=__webpack_require__(138);var _selectors3=__webpack_require__(47);var _actionTypes=__webpack_require__(2);var _selectors4=__webpack_require__(90);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function getConfigForCurrentView(state){var currentRoute=(0,_findLast3.default)((0,_selectors.getActionLog)(state),{type:_actionTypes.ROUTE_SET});var path=currentRoute.path?currentRoute.path:"";var config=(0,_find3.default)(_constants.FIRST_VIEW_CONFIG,function(entry){return(0,_some3.default)(entry.paths,function(entryPath){return(0,_startsWith3.default)(path,entryPath)})});return config||false}function isUserEligible(state,config){var userStartDate=(0,_selectors4.getCurrentUserDate)(state);if(!config.startDate){return true}if(!userStartDate){return false}return(0,_moment2.default)(userStartDate).isAfter(config.startDate)}function isQueryStringEnabled(state,config){var queryArguments=(0,_selectors3.getInitialQueryArguments)(state);return queryArguments.firstView===config.name}function isViewEnabled(state,config){if(!(0,_selectors2.preferencesLastFetchedTimestamp)(state)){return false}var latestFirstViewHistory=(0,_findLast3.default)((0,_selectors2.getPreference)(state,"firstViewHistory"),{view:config.name});var isViewDisabled=latestFirstViewHistory?!!latestFirstViewHistory.disabled:false;if(isViewDisabled){return false}return isQueryStringEnabled(state,config)||config.enabled&&isUserEligible(state,config)}function wasFirstViewHiddenSinceEnteringCurrentSection(state,config){var actionsSinceEnteringCurrentSection=(0,_takeRightWhile3.default)((0,
_selectors.getActionLog)(state),function(action){return action.type!==_actionTypes.ROUTE_SET||action.type===_actionTypes.ROUTE_SET&&routeSetIsInCurrentSection(state,action)});return(0,_some3.default)(actionsSinceEnteringCurrentSection,function(action){return action.type===_actionTypes.FIRST_VIEW_HIDE&&action.view===config.name})}function routeSetIsInCurrentSection(state,routeSet){var section=state.ui.section;return(0,_some3.default)(section.paths,function(path){return(0,_startsWith3.default)(routeSet.path,path)})}function shouldViewBeVisible(state){var firstViewConfig=getConfigForCurrentView(state);if(!firstViewConfig){return false}return isViewEnabled(state,firstViewConfig)&&!wasFirstViewHiddenSinceEnteringCurrentSection(state,firstViewConfig)&&!(0,_selectors3.isSectionLoading)(state)}function secondsSpentOnCurrentView(state){var now=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Date.now();var currentRoute=(0,_findLast3.default)((0,_selectors.getActionLog)(state),{type:_actionTypes.ROUTE_SET});return currentRoute?(now-currentRoute.timestamp)/1e3:-1}function bucketedTimeSpentOnCurrentView(state){var now=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Date.now();var timeSpent=secondsSpentOnCurrentView(state,now);if(-1===timeSpent){return"unknown"}if(timeSpent<2){return"under2"}if(timeSpent<5){return"2-5"}if(timeSpent<10){return"5-10"}if(timeSpent<20){return"10-20"}if(timeSpent<60){return"20-60"}return"60plus"}},1944:function(module,exports,__webpack_require__){var baseSlice=__webpack_require__(140);function baseWhile(array,predicate,isDrop,fromRight){var length=array.length,index=fromRight?length:-1;while((fromRight?index--:++index<length)&&predicate(array[index],index,array)){}return isDrop?baseSlice(array,fromRight?0:index,fromRight?index+1:length):baseSlice(array,fromRight?index+1:0,fromRight?length:index)}module.exports=baseWhile},1987:function(module,exports){"use strict";module.exports={editLinkForPage:function editLinkForPage(page,site){if(!(page&&page.ID)||!(site&&site.ID)){return null}return"/page/"+site.slug+"/"+page.ID},isFrontPage:function isFrontPage(page,site){if(!page||!page.ID||!site||!site.options){return false}return site.options.page_on_front===page.ID}}},1991:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1),PureRenderMixin=__webpack_require__(111);var Gridicon=__webpack_require__(26);module.exports=React.createClass({displayName:"PostRelativeTime",mixins:[PureRenderMixin],propTypes:{post:React.PropTypes.object.isRequired,includeNonDraftStatuses:React.PropTypes.bool,link:React.PropTypes.string,target:React.PropTypes.string},getDefaultProps:function getDefaultProps(){return{includeNonDraftStatuses:false,link:null,target:null}},getRelativeTimeText:function getRelativeTimeText(){var status=this.props.post.status;var time=void 0;if(status==="draft"||status==="pending"){time=this.props.post.modified}else if(status!=="new"){time=this.props.post.date}if(!time){return}return React.createElement("span",{className:"post-relative-time-status__time"},React.createElement(Gridicon,{icon:"time",size:18}),React.createElement("span",{className:"post-relative-time-status__time-text"},this.moment(time).fromNow()))},getStatusText:function getStatusText(){var status=this.props.post.status,statusClassName="post-relative-time-status__status",statusIcon="aside",statusText;if(this.props.post.sticky){statusText=this.translate("sticky");statusClassName+=" is-sticky";statusIcon="bookmark-outline"}else if(status==="pending"){statusText=this.translate("pending review");statusClassName+=" is-pending"}else if(status==="future"){statusText=this.translate("scheduled");statusClassName+=" is-scheduled";statusIcon="calendar"}else if(status==="trash"){statusText=this.translate("trashed");statusClassName+=" is-trash";statusIcon="trash"}else if(this.props.includeBasicStatus){if(status==="draft"){statusText=this.translate("draft")}else if(status==="publish"){statusText=this.translate("published")}else if(status==="new"){statusText=this.translate("Publish immediately")}}if(statusText){return React.createElement("span",{className:statusClassName},React.createElement(Gridicon,{icon:statusIcon,size:18}),React.createElement("span",{className:"post-relative-time-status__status-text"},statusText))}},render:function render(){var timeText=this.getRelativeTimeText(),statusText=this.getStatusText(),realtiveTimeClass=timeText?"post-relative-time-status":null,innerText=React.createElement("span",null,timeText,statusText),details;if(this.props.link){details=React.createElement("p",{className:realtiveTimeClass},React.createElement("a",{href:this.props.link,target:this.props.target,onClick:this.props.onClick},innerText))}else{details=React.createElement("p",{className:realtiveTimeClass},innerText)}return details}})},2034:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _react=__webpack_require__(1);var _reactRedux=__webpack_require__(15);var _redux=__webpack_require__(6);var _selectors=__webpack_require__(1926);var _actions=__webpack_require__(2182);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var QueryPostStats=function(_Component){(0,_inherits3.default)(QueryPostStats,_Component);function QueryPostStats(){(0,_classCallCheck3.default)(this,QueryPostStats);return(0,_possibleConstructorReturn3.default)(this,(QueryPostStats.__proto__||(0,_getPrototypeOf2.default)(QueryPostStats)).apply(this,arguments))}(0,_createClass3.default)(QueryPostStats,[{key:"componentWillMount",value:function componentWillMount(){var _props=this.props;var requestingPostStat=_props.requestingPostStat;var siteId=_props.siteId;var postId=_props.postId;var stat=_props.stat;if(!requestingPostStat&&siteId&&postId&&stat){this.requestPostStat(this.props)}}},{key:"componentWillUnmount",value:function componentWillUnmount(){this.clearInterval()}},{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){var _props2=this.props;var siteId=_props2.siteId;var postId=_props2.postId;var stat=_props2.stat;var heartbeat=_props2.heartbeat;if(!(siteId&&postId&&stat)||siteId===nextProps.siteId&&postId===nextProps.postId&&stat===nextProps.stat&&heartbeat===nextProps.heartbeat){return}this.requestPostStat(nextProps)}},{key:"requestPostStat",value:function requestPostStat(props){var siteId=props.siteId;var postId=props.postId;var stat=props.stat;var heartbeat=props.heartbeat;props.requestPostStat(stat,siteId,postId);this.clearInterval();if(heartbeat){this.interval=setInterval(function(){props.requestPostStat(stat,siteId,postId)},heartbeat)}}},{key:"clearInterval",value:function(_clearInterval){function clearInterval(){return _clearInterval.apply(this,arguments)}clearInterval.toString=function(){return _clearInterval.toString()};return clearInterval}(function(){if(this.interval){clearInterval(this.interval)}})},{key:"render",value:function render(){return null}}]);return QueryPostStats}(_react.Component);QueryPostStats.propTypes={siteId:_react.PropTypes.number,postId:_react.PropTypes.number,stat:_react.PropTypes.string,requestingPostStat:_react.PropTypes.bool,requestPostStat:_react.PropTypes.func,heartbeat:_react.PropTypes.number};QueryPostStats.defaultProps={requestPostStat:function requestPostStat(){},heartbeat:0};exports.default=(0,_reactRedux.connect)(function(state,ownProps){return{requestingPostStat:(0,_selectors.isRequestingPostStat)(state,ownProps.stat,ownProps.siteId,ownProps.postId)}},function(dispatch){return(0,_redux.bindActionCreators)({requestPostStat:_actions.requestPostStat},dispatch)})(QueryPostStats);module.exports=exports["default"]},2035:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _react=__webpack_require__(1);var _reactRedux=__webpack_require__(15);var _redux=__webpack_require__(6);var _selectors=__webpack_require__(1861);var _actions=__webpack_require__(1860);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var QueryPublicizeConnections=function(_Component){(0,_inherits3.default)(QueryPublicizeConnections,_Component);function QueryPublicizeConnections(){(0,_classCallCheck3.default)(this,QueryPublicizeConnections);return(0,_possibleConstructorReturn3.default)(this,(QueryPublicizeConnections.__proto__||(0,_getPrototypeOf2.default)(QueryPublicizeConnections)).apply(this,arguments))}(0,_createClass3.default)(QueryPublicizeConnections,[{key:"componentWillMount",value:function componentWillMount(){if(!this.props.requestingConnections&&this.props.siteId){this.props.requestConnections(this.props.siteId)}}},{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){if(nextProps.requestingConnections||!nextProps.siteId||this.props.siteId===nextProps.siteId){return}nextProps.requestConnections(nextProps.siteId)}},{key:"render",value:function render(){return null}}]);return QueryPublicizeConnections}(_react.Component);QueryPublicizeConnections.propTypes={siteId:_react.PropTypes.number,requestingConnections:_react.PropTypes.bool,requestConnections:_react.PropTypes.func};QueryPublicizeConnections.defaultProps={requestConnections:function requestConnections(){}};exports.default=(0,_reactRedux.connect)(function(state,ownProps){return{requestingConnections:(0,_selectors.isFetchingConnections)(state,ownProps.siteId)}},function(dispatch){return(0,_redux.bindActionCreators)({requestConnections:_actions.fetchConnections},dispatch)})(QueryPublicizeConnections);module.exports=exports["default"]},2047:function(module,exports,__webpack_require__){(function(process){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _mixin=__webpack_require__(111);var _mixin2=_interopRequireDefault(_mixin);var _reactAddonsCssTransitionGroup=__webpack_require__(736);var _reactAddonsCssTransitionGroup2=_interopRequireDefault(_reactAddonsCssTransitionGroup);var _reactRedux=__webpack_require__(15);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _card=__webpack_require__(89);var _card2=_interopRequireDefault(_card);var _button=__webpack_require__(69);var _button2=_interopRequireDefault(_button);var _rootChild=__webpack_require__(177);var _rootChild2=_interopRequireDefault(_rootChild);var _selectors=__webpack_require__(47);var _selectors2=__webpack_require__(1929);var _actions=__webpack_require__(2184);var _config=__webpack_require__(12);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var TransitionGroupComponent=function TransitionGroupComponent(props){var children=_react2.default.Children.toArray(props.children);return children[0]||null};var FirstView=_react2.default.createClass({displayName:"FirstView",mixins:[_mixin2.default],getInitialState:function getInitialState(){return{isEnabled:false}},componentDidMount:function componentDidMount(){this.updateDocumentStyles()},componentDidUpdate:function componentDidUpdate(){this.updateDocumentStyles()},componentWillUnmount:function componentWillUnmount(){this.updateDocumentStylesForHiddenFirstView()},render:function render(){var classes=(0,_classnames2.default)("first-view",{"is-visible":this.props.isVisible});var firstViewContentClasses=(0,_classnames2.default)("first-view__content");var firstViewHidePreferenceClasses=(0,_classnames2.default)("first-view__hide-preference");return _react2.default.createElement(_rootChild2.default,{className:classes},_react2.default.createElement(_reactAddonsCssTransitionGroup2.default,{transitionName:"first-view-transition",component:TransitionGroupComponent,transitionEnter:false,transitionEnterTimeout:0,transitionLeaveTimeout:250},this.props.isVisible&&_react2.default.createElement(_card2.default,{key:"content",className:firstViewContentClasses},this.props.children,_react2.default.createElement(_button2.default,{primary:true,onClick:this.hide},this.translate("Got It!",{context:"Button that dismisses the introduction overlay."})),_react2.default.createElement("div",{className:firstViewHidePreferenceClasses},_react2.default.createElement("label",null,_react2.default.createElement("input",{type:"checkbox",checked:!this.state.isEnabled,onChange:this.enableOrDisableNextTime}),this.translate("Don't show this again"))))))},hide:function hide(){this.props.hideView({enabled:this.state.isEnabled})},enableOrDisableNextTime:function enableOrDisableNextTime(event){this.setState({isEnabled:!event.target.checked})},updateDocumentStyles:function updateDocumentStyles(){if(this.props.isVisible){this.updateDocumentStylesForVisibleFirstView()}else{this.updateDocumentStylesForHiddenFirstView()}},updateDocumentStylesForVisibleFirstView:function updateDocumentStylesForVisibleFirstView(){var _this=this;document.documentElement.classList.add("no-scroll");document.documentElement.classList.add("is-first-view-active");process.nextTick(function(){if(_this.props.isVisible){document.documentElement.classList.add("is-first-view-visible")}})},updateDocumentStylesForHiddenFirstView:function updateDocumentStylesForHiddenFirstView(){var _this2=this;document.documentElement.classList.remove("no-scroll");document.documentElement.classList.remove("is-first-view-visible");setTimeout(function(){if(!_this2.props.isVisible){document.documentElement.classList.remove("is-first-view-active")}},600)}});exports.default=(0,_reactRedux.connect)(function(state){return{sectionName:(0,_selectors.getSectionName)(state),isVisible:(0,_config.isEnabled)("ui/first-view")&&(0,_selectors2.shouldViewBeVisible)(state)}},{hideView:_actions.hideView})(FirstView);module.exports=exports["default"]}).call(exports,__webpack_require__(54))},2093:function(module,exports,__webpack_require__){"use strict";var _gravatar=__webpack_require__(710);var _gravatar2=_interopRequireDefault(_gravatar);var _photon=__webpack_require__(750);var _photon2=_interopRequireDefault(_photon);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var React=__webpack_require__(1),classnames=__webpack_require__(10),noop=__webpack_require__(38),url=__webpack_require__(70);var CompactCard=__webpack_require__(1642),Gridicon=__webpack_require__(26),Notice=__webpack_require__(76),NoticeAction=__webpack_require__(134),SiteIcon=__webpack_require__(281),PostRelativeTimeStatus=__webpack_require__(1991),PopoverMenu=__webpack_require__(1673),PopoverMenuItem=__webpack_require__(1652),actions=__webpack_require__(1648),updatePostStatus=__webpack_require__(1900),utils=__webpack_require__(1649),hasTouch=__webpack_require__(216).hasTouch;module.exports=React.createClass({displayName:"Draft",mixins:[updatePostStatus],propTypes:{showAllActions:React.PropTypes.bool,post:React.PropTypes.object,isPlaceholder:React.PropTypes.bool,sites:React.PropTypes.object,onTitleClick:React.PropTypes.func,postImages:React.PropTypes.object,selected:React.PropTypes.bool,showAuthor:React.PropTypes.bool},getDefaultProps:function getDefaultProps(){return{showAllActions:false,onTitleClick:noop,selected:false,showAuthor:false}},getInitialState:function getInitialState(){return{fullImage:false,showPopoverMenu:false,isRestoring:false,hasError:false}},toggleImageState:function toggleImageState(){this.setState({fullImage:!this.state.fullImage})},trashPost:function trashPost(){var updateStatus;this.setState({showPopoverMenu:false,isTrashing:true});updateStatus=function(error){if(!this.isMounted()){return}if(error){return this.setState({isTrashing:false,hasError:true})}return this.setState({isTrashing:false})}.bind(this);if(utils.userCan("delete_post",this.props.post)){actions.trash(this.props.post,updateStatus)}},restorePost:function restorePost(){var updateStatus;this.setState({showPopoverMenu:false,isRestoring:true});updateStatus=function(error){if(!this.isMounted()){return}if(error){return this.setState({isRestoring:false,hasError:true})}return this.setState({isRestoring:false})}.bind(this);if(utils.userCan("delete_post",this.props.post)){actions.restore(this.props.post,updateStatus)}},previewPost:function previewPost(){window.open(utils.getPreviewURL(this.props.post))},publishPost:function publishPost(){this.setState({showPopoverMenu:false});if(utils.userCan("publish_post",this.props.post)){this.updatePostStatus("publish")}},togglePopoverMenu:function togglePopoverMenu(){this.setState({showPopoverMenu:!this.state.showPopoverMenu})},render:function render(){var post=this.props.post,image=null,site,classes,imageUrl,editPostURL,title,excerpt;if(this.props.isPlaceholder){return this.postPlaceholder()}site=this.props.sites.getSite(post.site_ID);if(utils.userCan("edit_post",post)){editPostURL=utils.getEditURL(post,site)}if(this.props.postImages&&this.props.postImages.canonical_image){image=url.parse(this.props.postImages.canonical_image.uri,true);imageUrl="//"+image.hostname+image.pathname+"?w=680px"}if(post&&post.canonical_image){image=url.parse(post.canonical_image.uri,true);if(image.hostname.indexOf("files.wordpress.com")>0){imageUrl="//"+image.hostname+image.pathname+"?w=680px"}else{imageUrl=(0,_photon2.default)(post.canonical_image.uri,{width:680})}}classes=["draft",{"has-all-actions":this.props.showAllActions,"has-image":!!image,"is-image-expanded":this.state.fullImage,"is-trashed":this.props.post.status==="trash"||this.state.isTrashing,"is-placeholder":this.props.isPlaceholder,"is-restoring":this.state.isRestoring,"is-touch":hasTouch(),"is-selected":this.props.selected}];title=post.title||React.createElement("span",{className:"draft__untitled"},this.translate("Untitled"));excerpt=post.excerpt?React.createElement("span",{className:"draft__excerpt"},React.createElement(Gridicon,{icon:"aside",size:18}),post.excerpt):title;return React.createElement(CompactCard,{className:classnames.apply(null,classes),key:"draft-"+post.ID},this.showStatusChange(),React.createElement("h3",{className:"draft__title"},post.status==="pending"&&React.createElement("span",{className:"draft__pending-label"},this.translate("Pending")),this.props.showAuthor&&React.createElement(_gravatar2.default,{user:post.author,size:22}),React.createElement("a",{href:editPostURL,onClick:this.props.onTitleClick},post.format==="aside"?excerpt:title)),this.props.sites.selected?this.draftActions():React.createElement(SiteIcon,{site:site,size:32}),image?this.renderImage(imageUrl):null,this.props.post.status==="trash"?this.restoreButton():null)},renderImage:function renderImage(image){var style;if(!this.state.fullImage){style={backgroundImage:"url("+image+")"}}return React.createElement("div",{className:"draft__featured-image",style:style,onClick:this.toggleImageState},this.state.fullImage?React.createElement("img",{className:"draft__image",src:image}):null)},restoreButton:function restoreButton(){if(this.state.isRestoring){return null}return React.createElement("button",{className:"draft__restore",onClick:this.restorePost},React.createElement(Gridicon,{icon:"undo",size:18}),this.translate("Restore"))},showStatusChange:function showStatusChange(){if(this.props.post.status==="publish"){return React.createElement(Notice,{isCompact:true,status:"is-success",text:"Post successfully published.",button:"View",showDismiss:false},React.createElement(NoticeAction,{href:this.props.post.URL},"View"))}else if(this.state.hasError){return React.createElement(Notice,{isCompact:true,status:"is-error",text:"There was a problem.",showDismiss:false})}},postPlaceholder:function postPlaceholder(){return React.createElement(CompactCard,{className:"draft is-placeholder"},React.createElement("h3",{className:"draft__title"}),React.createElement("div",{className:"draft__actions"},React.createElement("p",{className:"post-relative-time-status"},React.createElement("span",{className:"time"},React.createElement("span",{className:"noticon noticon-time"}),React.createElement("span",{className:"time-text"})))))},renderTrashAction:function renderTrashAction(){if(!utils.userCan("delete_post",this.props.post)){return null}if(this.props.post.status==="trash"||this.state.isRestoring){return null}return React.createElement("div",{className:"draft__actions"},React.createElement(Gridicon,{icon:"trash",onClick:this.trashPost,size:18}))},renderAllActions:function renderAllActions(){return React.createElement("div",{className:"draft__all-actions"},React.createElement(PostRelativeTimeStatus,{post:this.props.post,includeEditLink:true}),React.createElement("span",{className:"draft__actions-toggle noticon noticon-ellipsis",onClick:this.togglePopoverMenu,ref:"popoverMenuButton"}),React.createElement(PopoverMenu,{isVisible:this.state.showPopoverMenu,onClose:this.togglePopoverMenu,position:"bottom left",context:this.refs&&this.refs.popoverMenuButton},React.createElement(PopoverMenuItem,{onClick:this.previewPost},this.translate("Preview")),React.createElement(PopoverMenuItem,{onClick:this.publishPost},this.translate("Publish")),React.createElement(PopoverMenuItem,{className:"draft__trash-item",onClick:this.trashPost},this.translate("Send to Trash"))))},draftActions:function draftActions(){return this.props.showAllActions?this.renderAllActions():this.renderTrashAction()}})},2153:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var React=__webpack_require__(1);var CountedTextarea=__webpack_require__(1780),FormTextarea=__webpack_require__(1668),PostActions=__webpack_require__(1648),stats=__webpack_require__(1651),TrackInputChanges=__webpack_require__(1782),InfoPopover=__webpack_require__(1725);exports.default=React.createClass({displayName:"PublicizeMessage",propTypes:{message:React.PropTypes.string,preview:React.PropTypes.string,acceptableLength:React.PropTypes.number,requireCount:React.PropTypes.bool,onChange:React.PropTypes.func},getDefaultProps:function getDefaultProps(){return{message:"",acceptableLength:140,requireCount:false}},onChange:function onChange(event){if(this.props.onChange){this.props.onChange(event.target.value)}else{PostActions.updateMetadata("_wpas_mess",event.target.value)}},recordStats:function recordStats(){stats.recordStat("sharing_message_changed");stats.recordEvent("Publicize Sharing Message Changed")},renderInfoPopover:function renderInfoPopover(){return React.createElement(InfoPopover,{className:"publicize-message-counter-info",position:"bottom left",gaEventCategory:"Editor",popoverName:"SharingMessage"},this.translate("The length includes space for the link to your post and an attached image.",{context:"Post editor sharing message counter explanation"}))},renderTextarea:function renderTextarea(){if(this.props.requireCount){return React.createElement(CountedTextarea,{value:this.props.message,placeholder:this.props.preview,countPlaceholderLength:true,onChange:this.onChange,showRemainingCharacters:true,acceptableLength:this.props.acceptableLength,className:"editor-sharing__message-input"},this.renderInfoPopover())}else{return React.createElement(FormTextarea,{value:this.props.message,placeholder:this.props.preview,onChange:this.onChange,className:"editor-sharing__message-input"})}},render:function render(){return React.createElement("div",{className:"editor-sharing__publicize-message"},React.createElement("h5",{className:"editor-sharing__message-heading"},this.translate("Customize the message",{context:"Post editor sharing message heading"})),React.createElement(TrackInputChanges,{onNewValue:this.recordStats},this.renderTextarea()))}});module.exports=exports["default"]},2156:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _pick=__webpack_require__(91);var _pick2=_interopRequireDefault(_pick);var _reactRedux=__webpack_require__(15);var _redux=__webpack_require__(6);var _i18nCalypso=__webpack_require__(11);var _button=__webpack_require__(1962);var _button2=_interopRequireDefault(_button);var _stats=__webpack_require__(1643);var _actions=__webpack_require__(1755);var _selectors=__webpack_require__(1756);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var CommentLikeButtonContainer=function(_React$Component){(0,_inherits3.default)(CommentLikeButtonContainer,_React$Component);function CommentLikeButtonContainer(){(0,_classCallCheck3.default)(this,CommentLikeButtonContainer);var _this=(0,_possibleConstructorReturn3.default)(this,(CommentLikeButtonContainer.__proto__||(0,_getPrototypeOf2.default)(CommentLikeButtonContainer)).call(this));_this.boundHandleLikeToggle=_this.handleLikeToggle.bind(_this);return _this}(0,_createClass3.default)(CommentLikeButtonContainer,[{key:"handleLikeToggle",value:function handleLikeToggle(liked){if(liked){this.props.likeComment(this.props.siteId,this.props.postId,this.props.commentId)}else{this.props.unlikeComment(this.props.siteId,this.props.postId,this.props.commentId)}(0,_stats.recordAction)(liked?"liked_comment":"unliked_comment");(0,_stats.recordGaEvent)(liked?"Clicked Comment Like":"Clicked Comment Unlike");(0,_stats.recordTrack)("calypso_reader_"+(liked?"liked":"unliked")+"_comment",{blog_id:this.props.siteId,comment_id:this.props.commentId})}},{key:"render",value:function render(){var props=(0,_pick2.default)(this.props,["showZeroCount","tagName"]);var likeCount=this.props.commentLike.get("like_count");var iLike=this.props.commentLike.get("i_like");var likedLabel=(0,_i18nCalypso.translate)("Liked");return _react2.default.createElement(_button2.default,(0,_extends3.default)({},props,{likeCount:likeCount,liked:iLike,onLikeToggle:this.boundHandleLikeToggle,likedLabel:likedLabel,isMini:true}))}}]);return CommentLikeButtonContainer}(_react2.default.Component);CommentLikeButtonContainer.propTypes={siteId:_react2.default.PropTypes.number.isRequired,postId:_react2.default.PropTypes.number.isRequired,commentId:_react2.default.PropTypes.number.isRequired,showZeroCount:_react2.default.PropTypes.bool,tagName:_react2.default.PropTypes.string,commentLike:_react2.default.PropTypes.object.isRequired,likeComment:_react2.default.PropTypes.func.isRequired,unlikeComment:_react2.default.PropTypes.func.isRequired};exports.default=(0,_reactRedux.connect)(function(state,props){return{commentLike:(0,_selectors.getCommentLike)(state,props.siteId,props.postId,props.commentId)}},function(dispatch){return(0,_redux.bindActionCreators)({likeComment:_actions.likeComment,unlikeComment:_actions.unlikeComment},dispatch)})(CommentLikeButtonContainer);module.exports=exports["default"]},2157:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _postCommentList=__webpack_require__(2159);var _postCommentList2=_interopRequireDefault(_postCommentList);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_postCommentList2.default;module.exports=exports["default"]},2158:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var PostCommentContent=function(_React$Component){(0,_inherits3.default)(PostCommentContent,_React$Component);function PostCommentContent(){(0,_classCallCheck3.default)(this,PostCommentContent);return(0,_possibleConstructorReturn3.default)(this,(PostCommentContent.__proto__||(0,_getPrototypeOf2.default)(PostCommentContent)).apply(this,arguments))}(0,_createClass3.default)(PostCommentContent,[{key:"render",value:function render(){if(this.props.isPlaceholder){return _react2.default.createElement("div",{className:"comment__content"},this.props.content)}return _react2.default.createElement("div",{className:"comment__content",dangerouslySetInnerHTML:{__html:this.props.content}})}}]);return PostCommentContent}(_react2.default.Component);exports.default=PostCommentContent;PostCommentContent.propTypes={content:_react.PropTypes.string.isRequired,isPlaceholder:_react.PropTypes.bool};module.exports=exports["default"]},2159:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactRedux=__webpack_require__(15);var _redux=__webpack_require__(6);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _i18nCalypso=__webpack_require__(11);var _selectors=__webpack_require__(1756);var _actions=__webpack_require__(1755);var _constants=__webpack_require__(741);var _stats=__webpack_require__(1643);var _postComment=__webpack_require__(2161);var _postComment2=_interopRequireDefault(_postComment);var _form=__webpack_require__(1822);var _form2=_interopRequireDefault(_form);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var PostCommentList=function(_React$Component){(0,_inherits3.default)(PostCommentList,_React$Component);function PostCommentList(props){(0,_classCallCheck3.default)(this,PostCommentList);var _this=(0,
_possibleConstructorReturn3.default)(this,(PostCommentList.__proto__||(0,_getPrototypeOf2.default)(PostCommentList)).call(this));_this.state={activeReplyCommentID:null,amountOfCommentsToTake:props.initialSize};_this.viewEarlierCommentsHandler=_this.viewEarlierCommentsHandler.bind(_this);return _this}(0,_createClass3.default)(PostCommentList,[{key:"componentWillMount",value:function componentWillMount(){var siteId=this.props.post.site_ID;var postId=this.props.post.ID;this.props.requestPostComments(siteId,postId)}},{key:"renderComment",value:function renderComment(commentId){if(!commentId){return null}var onReplyClick=this.onReplyClick.bind(this);var onReplyCancel=this.onReplyCancel.bind(this);var commentText=this.state.commentText;var onUpdateCommentText=this.onUpdateCommentText.bind(this);var resetActiveReplyComment=this.resetActiveReplyComment.bind(this);return _react2.default.createElement(_postComment2.default,{post:this.props.post,commentsTree:this.props.commentsTree,commentId:commentId,key:commentId,activeReplyCommentID:this.state.activeReplyCommentID,onReplyClick:onReplyClick,onReplyCancel:onReplyCancel,commentText:commentText,onUpdateCommentText:onUpdateCommentText,onCommentSubmit:resetActiveReplyComment,depth:0})}},{key:"onReplyClick",value:function onReplyClick(commentID){this.setState({activeReplyCommentID:commentID});(0,_stats.recordAction)("comment_reply_click");(0,_stats.recordGaEvent)("Clicked Reply to Comment");(0,_stats.recordTrack)("calypso_reader_comment_reply_click",{blog_id:this.props.post.site_ID,comment_id:commentID})}},{key:"onReplyCancel",value:function onReplyCancel(){(0,_stats.recordAction)("comment_reply_cancel_click");(0,_stats.recordGaEvent)("Clicked Cancel Reply to Comment");(0,_stats.recordTrack)("calypso_reader_comment_reply_cancel_click",{blog_id:this.props.post.site_ID,comment_id:this.state.activeReplyCommentID});this.resetActiveReplyComment()}},{key:"onUpdateCommentText",value:function onUpdateCommentText(commentText){this.setState({commentText:commentText})}},{key:"resetActiveReplyComment",value:function resetActiveReplyComment(){this.setState({activeReplyCommentID:null})}},{key:"renderCommentsList",value:function renderCommentsList(commentIds){var _this2=this;return _react2.default.createElement("ol",{className:"comments__list is-root"},commentIds.reverse().map(function(commentId){return _this2.renderComment(commentId)}))}},{key:"renderCommentForm",value:function renderCommentForm(){var post=this.props.post;var commentText=this.state.commentText;var onUpdateCommentText=this.onUpdateCommentText.bind(this);if(this.state.activeReplyCommentID&&!this.state.errors){return null}return _react2.default.createElement(_form2.default,{ref:"postCommentForm",post:post,parentCommentID:null,commentText:commentText,onUpdateCommentText:onUpdateCommentText})}},{key:"getCommentsCount",value:function getCommentsCount(commentIds){var _this3=this;return commentIds.reduce(function(prevSum,commentId){return prevSum+_this3.getCommentsCount(_this3.props.commentsTree.getIn([commentId,"children"]))+1},0)}},{key:"getDisplayedComments",value:function getDisplayedComments(commentIds,take){if(!commentIds){return null}var displayedComments=commentIds.take(take);return{displayedComments:displayedComments,displayedCommentsCount:this.getCommentsCount(displayedComments)}}},{key:"viewEarlierCommentsHandler",value:function viewEarlierCommentsHandler(){var siteId=this.props.post.site_ID;var postId=this.props.post.ID;var amountOfCommentsToTake=this.state.amountOfCommentsToTake+this.props.pageSize;this.setState({amountOfCommentsToTake:amountOfCommentsToTake});if(this.props.haveMoreCommentsToFetch){this.props.requestPostComments(siteId,postId)}}},{key:"render",value:function render(){if(!this.props.commentsTree){return null}var _getDisplayedComments=this.getDisplayedComments(this.props.commentsTree.get("children"),this.state.amountOfCommentsToTake);var displayedComments=_getDisplayedComments.displayedComments;var displayedCommentsCount=_getDisplayedComments.displayedCommentsCount;var showViewEarlier=this.props.commentsTree.get("children").size>this.state.amountOfCommentsToTake||this.props.haveMoreCommentsToFetch;var totalCommentsCount=this.props.haveMoreCommentsToFetch?this.props.totalCommentsCount:this.getCommentsCount(this.props.commentsTree.get("children"));return _react2.default.createElement("div",{className:"comments"},_react2.default.createElement("div",{className:(0,_classnames2.default)("comments__top-bar",{"is-no-comments":displayedCommentsCount===0})},showViewEarlier?_react2.default.createElement("span",{className:"comments__view-earlier",onClick:this.viewEarlierCommentsHandler},(0,_i18nCalypso.translate)("View earlier comments (Showing %(shown)d of %(total)d)",{args:{shown:displayedCommentsCount,total:totalCommentsCount}})):null),this.renderCommentsList(displayedComments),this.renderCommentForm())}}]);return PostCommentList}(_react2.default.Component);PostCommentList.propTypes={post:_react2.default.PropTypes.shape({ID:_react2.default.PropTypes.number.isRequired,site_ID:_react2.default.PropTypes.number.isRequired}).isRequired,onCommentsUpdate:_react2.default.PropTypes.func.isRequired,pageSize:_react2.default.PropTypes.number,initialSize:_react2.default.PropTypes.number,commentsTree:_react2.default.PropTypes.object,totalCommentsCount:_react2.default.PropTypes.number,haveMoreCommentsToFetch:_react2.default.PropTypes.bool,requestPostComments:_react2.default.PropTypes.func.isRequired};PostCommentList.defaultProps={pageSize:_constants.NUMBER_OF_COMMENTS_PER_FETCH,initialSize:_constants.NUMBER_OF_COMMENTS_PER_FETCH,haveMoreCommentsToFetch:false};exports.default=(0,_reactRedux.connect)(function(state,ownProps){return{commentsTree:(0,_selectors.getPostCommentsTree)(state,ownProps.post.site_ID,ownProps.post.ID),totalCommentsCount:(0,_selectors.getPostTotalCommentsCount)(state,ownProps.post.site_ID,ownProps.post.ID),haveMoreCommentsToFetch:(0,_selectors.haveMoreCommentsToFetch)(state,ownProps.post.site_ID,ownProps.post.ID)}},function(dispatch){return(0,_redux.bindActionCreators)({requestPostComments:_actions.requestPostComments},dispatch)})(PostCommentList);module.exports=exports["default"]},2160:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _form=__webpack_require__(1822);var _form2=_interopRequireDefault(_form);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var PostCommentWithError=function(_React$Component){(0,_inherits3.default)(PostCommentWithError,_React$Component);function PostCommentWithError(){(0,_classCallCheck3.default)(this,PostCommentWithError);return(0,_possibleConstructorReturn3.default)(this,(PostCommentWithError.__proto__||(0,_getPrototypeOf2.default)(PostCommentWithError)).apply(this,arguments))}(0,_createClass3.default)(PostCommentWithError,[{key:"renderCommentForm",value:function renderCommentForm(){var post=this.props.post;var commentText=this.props.commentsTree.getIn([this.props.commentId,"data","content"]);var commentParentId=this.props.commentsTree.getIn([this.props.commentId,"parentId"]);var placeholderError=this.props.commentsTree.getIn([this.props.commentId,"data","placeholderError"]);var onUpdateCommentText=this.props.onUpdateCommentText;return _react2.default.createElement(_form2.default,{ref:"postCommentForm",post:post,parentCommentID:commentParentId,commentText:commentText,onUpdateCommentText:onUpdateCommentText,placeholderId:this.props.commentId,error:placeholderError})}},{key:"render",value:function render(){return _react2.default.createElement("li",{className:"comment is-error"},this.renderCommentForm(),this.props.repliesList)}}]);return PostCommentWithError}(_react2.default.Component);exports.default=PostCommentWithError;PostCommentWithError.propTypes={post:_react2.default.PropTypes.object.isRequired,repliesList:_react2.default.PropTypes.object.isRequired,commentsTree:_react2.default.PropTypes.object.isRequired,onUpdateCommentText:_react2.default.PropTypes.func.isRequired,commentId:_react2.default.PropTypes.oneOfType([_react2.default.PropTypes.string,_react2.default.PropTypes.number]).isRequired};module.exports=exports["default"]},2161:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);var _getOwnPropertyNames=__webpack_require__(1827);var _getOwnPropertyNames2=_interopRequireDefault(_getOwnPropertyNames);var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _noop=__webpack_require__(38);var _noop2=_interopRequireDefault(_noop);var _reactRedux=__webpack_require__(15);var _i18nCalypso=__webpack_require__(11);var _selectors=__webpack_require__(90);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _postTime=__webpack_require__(1790);var _postTime2=_interopRequireDefault(_postTime);var _gravatar=__webpack_require__(710);var _gravatar2=_interopRequireDefault(_gravatar);var _stats=__webpack_require__(1643);var _commentLikes=__webpack_require__(2156);var _commentLikes2=_interopRequireDefault(_commentLikes);var _postCommentContent=__webpack_require__(2158);var _postCommentContent2=_interopRequireDefault(_postCommentContent);var _form=__webpack_require__(1822);var _form2=_interopRequireDefault(_form);var _constants=__webpack_require__(741);var _formatting=__webpack_require__(81);var _postCommentWithError=__webpack_require__(2160);var _postCommentWithError2=_interopRequireDefault(_postCommentWithError);var _postTrackback=__webpack_require__(2162);var _postTrackback2=_interopRequireDefault(_postTrackback);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var PostComment=function(_React$Component){(0,_inherits3.default)(PostComment,_React$Component);function PostComment(){(0,_classCallCheck3.default)(this,PostComment);var _this=(0,_possibleConstructorReturn3.default)(this,(PostComment.__proto__||(0,_getPrototypeOf2.default)(PostComment)).call(this));_this.state={showReplies:false};(0,_getOwnPropertyNames2.default)(PostComment.prototype).filter(function(prop){return prop.indexOf("handle")===0}).filter(function(prop){return typeof _this[prop]==="function"}).forEach(function(prop){return _this[prop]=_this[prop].bind(_this)});return _this}(0,_createClass3.default)(PostComment,[{key:"handleToggleRepliesClick",value:function handleToggleRepliesClick(){this.setState({showReplies:!this.state.showReplies})}},{key:"handleReply",value:function handleReply(){this.props.onReplyClick(this.props.commentId);this.setState({showReplies:true})}},{key:"handleAuthorClick",value:function handleAuthorClick(){(0,_stats.recordAction)("comment_author_click");(0,_stats.recordGaEvent)("Clicked Author Name");(0,_stats.recordTrack)("calypso_reader_comment_author_click",{blog_id:this.props.post.site_ID,post_id:this.props.post.ID,comment_id:this.props.comment.ID,author_url:this.props.comment.author.URL})}},{key:"renderRepliesList",value:function renderRepliesList(){var _this2=this;var commentChildrenIds=this.props.commentsTree.getIn([this.props.commentId,"children"]).toJS();var exceedsMaxChildrenToShow=commentChildrenIds.length<this.props.maxChildrenToShow;var showReplies=this.state.showReplies||exceedsMaxChildrenToShow;if(!commentChildrenIds||commentChildrenIds.length<1){return null}var showRepliesText=(0,_i18nCalypso.translate)("show %(numOfReplies)d reply","show %(numOfReplies)d replies",{count:commentChildrenIds.length,args:{numOfReplies:commentChildrenIds.length}});var hideRepliesText=(0,_i18nCalypso.translate)("hide %(numOfReplies)d reply","hide %(numOfReplies)d replies",{count:commentChildrenIds.length,args:{numOfReplies:commentChildrenIds.length}});var replyVisibilityText=null;if(!exceedsMaxChildrenToShow){replyVisibilityText=this.state.showReplies?hideRepliesText:showRepliesText}return _react2.default.createElement("div",null,!!replyVisibilityText?_react2.default.createElement("button",{className:"comments__view-replies-btn",onClick:this.handleToggleRepliesClick},_react2.default.createElement(_gridicon2.default,{icon:"reply",size:18})," ",replyVisibilityText):null,showReplies?_react2.default.createElement("ol",{className:"comments__list"},commentChildrenIds.reverse().map(function(childId){return _react2.default.createElement(PostComment,(0,_extends3.default)({},_this2.props,{depth:_this2.props.depth+1,key:childId,commentId:childId}))})):null)}},{key:"renderCommentForm",value:function renderCommentForm(){if(this.props.activeReplyCommentID!==this.props.commentId){return null}return _react2.default.createElement(_form2.default,{ref:"postCommentForm",post:this.props.post,parentCommentID:this.props.commentId,commentText:this.props.commentText,onUpdateCommentText:this.props.onUpdateCommentText,onCommentSubmit:this.props.onCommentSubmit})}},{key:"renderCommentActions",value:function renderCommentActions(comment){var post=this.props.post;var showReplyButton=post&&post.discussion&&post.discussion.comments_open===true;var showCancelReplyButton=this.props.activeReplyCommentID===this.props.commentId;if(comment.isPlaceholder||comment.status!=="approved"){return null}return _react2.default.createElement("div",{className:"comment__actions"},showReplyButton?_react2.default.createElement("button",{className:"comment__actions-reply",onClick:this.handleReply},_react2.default.createElement(_gridicon2.default,{icon:"reply",size:18}),_react2.default.createElement("span",{className:"comment__actions-reply-label"},(0,_i18nCalypso.translate)("Reply"))):null,showCancelReplyButton?_react2.default.createElement("button",{className:"comment__actions-cancel-reply",onClick:this.props.onReplyCancel},(0,_i18nCalypso.translate)("Cancel reply")):null,_react2.default.createElement(_commentLikes2.default,{className:"comment__actions-like",tagName:"button",siteId:this.props.post.site_ID,postId:this.props.post.ID,commentId:comment.ID}))}},{key:"render",value:function render(){var commentsTree=this.props.commentsTree;var comment=commentsTree.getIn([this.props.commentId,"data"]).toJS();var haveReplyWithError=commentsTree.getIn([this.props.commentId,"children"]).some(function(childId){return commentsTree.getIn([childId,"data","placeholderState"])===_constants.PLACEHOLDER_STATE.ERROR});if(comment.isPlaceholder){comment.author=this.props.currentUser;comment.author.name=this.props.currentUser.display_name}else{comment.author.name=(0,_formatting.decodeEntities)(comment.author.name)}if(comment.isPlaceholder&&comment.placeholderState===_constants.PLACEHOLDER_STATE.ERROR){return _react2.default.createElement(_postCommentWithError2.default,(0,_extends3.default)({},this.props,{repliesList:this.renderRepliesList()}))}if(comment.type==="trackback"||comment.type==="pingback"){return _react2.default.createElement(_postTrackback2.default,this.props)}return _react2.default.createElement("li",{className:"comment depth-"+this.props.depth},_react2.default.createElement("div",{className:"comment__author"},_react2.default.createElement(_gravatar2.default,{user:comment.author}),comment.author.URL?_react2.default.createElement("a",{href:comment.author.URL,target:"_blank",rel:"noopener noreferrer",className:"comment__username",onClick:this.handleAuthorClick},comment.author.name,_react2.default.createElement(_gridicon2.default,{icon:"external"})):_react2.default.createElement("strong",{className:"comment__username"},comment.author.name),_react2.default.createElement("small",{className:"comment__timestamp"},_react2.default.createElement("a",{href:comment.URL},_react2.default.createElement(_postTime2.default,{date:comment.date})))),comment.status&&comment.status==="unapproved"?_react2.default.createElement("p",{className:"comment__moderation"},(0,_i18nCalypso.translate)("Your comment is awaiting moderation.")):null,_react2.default.createElement(_postCommentContent2.default,{content:comment.content,isPlaceholder:comment.isPlaceholder}),this.renderCommentActions(comment),haveReplyWithError?null:this.renderCommentForm(),this.renderRepliesList())}}]);return PostComment}(_react2.default.Component);PostComment.propTypes={commentsTree:_react2.default.PropTypes.object.isRequired,commentId:_react2.default.PropTypes.oneOfType([_react2.default.PropTypes.string,_react2.default.PropTypes.number]).isRequired,onReplyClick:_react2.default.PropTypes.func,depth:_react2.default.PropTypes.number,post:_react2.default.PropTypes.object,maxChildrenToShow:_react2.default.PropTypes.number,onCommentSubmit:_react2.default.PropTypes.func,currentUser:_react2.default.PropTypes.object.isRequired};PostComment.defaultProps={onReplyClick:_noop2.default,errors:[],depth:1,maxChildrenToShow:5,onCommentSubmit:_noop2.default};exports.default=(0,_reactRedux.connect)(function(state){return{currentUser:(0,_selectors.getCurrentUser)(state)}})(PostComment);module.exports=exports["default"]},2162:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(21);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(23);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(22);var _inherits3=_interopRequireDefault(_inherits2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _postTime=__webpack_require__(1790);var _postTime2=_interopRequireDefault(_postTime);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function unescape(str){return str.replace(/&#(\d+);/g,function(match,entity){return String.fromCharCode(entity)})}var PostTrackback=function(_React$Component){(0,_inherits3.default)(PostTrackback,_React$Component);function PostTrackback(){(0,_classCallCheck3.default)(this,PostTrackback);return(0,_possibleConstructorReturn3.default)(this,(PostTrackback.__proto__||(0,_getPrototypeOf2.default)(PostTrackback)).apply(this,arguments))}(0,_createClass3.default)(PostTrackback,[{key:"render",value:function render(){var commentsTree=this.props.commentsTree;var comment=commentsTree.getIn([this.props.commentId,"data"]).toJS();return _react2.default.createElement("li",{className:"comment depth-0"},_react2.default.createElement("div",{className:"comment__author"},_react2.default.createElement("div",{className:"comment__trackbackicon"},_react2.default.createElement(_gridicon2.default,{icon:"link",size:24})),comment.author.URL?_react2.default.createElement("a",{href:comment.author.URL,target:"_blank",rel:"noopener noreferrer",className:"comment__username"},unescape(comment.author.name),_react2.default.createElement(_gridicon2.default,{icon:"external"})):_react2.default.createElement("strong",{className:"comment__username"},unescape(comment.author.name)),_react2.default.createElement("small",{className:"comment__timestamp"},_react2.default.createElement("a",{href:comment.URL},_react2.default.createElement(_postTime2.default,{date:comment.date})))))}}]);return PostTrackback}(_react2.default.Component);exports.default=PostTrackback;PostTrackback.propTypes={commentId:_react2.default.PropTypes.number};module.exports=exports["default"]},2182:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.receivePostStat=receivePostStat;exports.requestPostStat=requestPostStat;var _wp=__webpack_require__(28);var _wp2=_interopRequireDefault(_wp);var _actionTypes=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function receivePostStat(stat,siteId,postId,value){return{type:_actionTypes.POST_STATS_RECEIVE,stat:stat,siteId:siteId,postId:postId,value:value}}function requestPostStat(stat,siteId,postId){return function(dispatch){dispatch({type:_actionTypes.POST_STATS_REQUEST,stat:stat,postId:postId,siteId:siteId});return _wp2.default.site(siteId).statsPostViews(postId,{fields:stat}).then(function(data){if(stat in data){dispatch(receivePostStat(stat,siteId,postId,data[stat]))}dispatch({type:_actionTypes.POST_STATS_REQUEST_SUCCESS,stat:stat,siteId:siteId,postId:postId})}).catch(function(error){dispatch({type:_actionTypes.POST_STATS_REQUEST_FAILURE,stat:stat,siteId:siteId,postId:postId,error:error})})}}},2184:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _toConsumableArray2=__webpack_require__(41);var _toConsumableArray3=_interopRequireDefault(_toConsumableArray2);var _filter2=__webpack_require__(77);var _filter3=_interopRequireDefault(_filter2);exports.hideView=hideView;var _actionTypes=__webpack_require__(2);var _actions=__webpack_require__(133);var _actions2=__webpack_require__(226);var _selectors=__webpack_require__(138);var _selectors2=__webpack_require__(1929);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function hideView(_ref){var enabled=_ref.enabled;return function(dispatch,getState){var timeBucket=(0,_selectors2.bucketedTimeSpentOnCurrentView)(getState());var config=(0,_selectors2.getConfigForCurrentView)(getState());if(!config||!config.name){return false}var hideAction={type:_actionTypes.FIRST_VIEW_HIDE,view:config.name};var tracksEvent=(0,_actions.recordTracksEvent)("calypso_first_view_dismissed",{view:config.name,showAgain:enabled,timeSpent:timeBucket});dispatch((0,_actions.bumpStat)("calypso_first_view_dismissed",enabled?"show_again":"dont_show"));dispatch((0,_actions.bumpStat)("calypso_first_view_duration",timeBucket));dispatch(tracksEvent);dispatch(hideAction);dispatch(persistToPreferences({getState:getState,view:config.name,disabled:!enabled}))}}function persistToPreferences(_ref2){var getState=_ref2.getState;var view=_ref2.view;var disabled=_ref2.disabled;return(0,_actions2.savePreference)("firstViewHistory",[].concat((0,_toConsumableArray3.default)((0,_filter3.default)((0,_selectors.getPreference)(getState(),"firstViewHistory"),function(item){return item.view!==view})),[{view:view,timestamp:Date.now(),disabled:disabled}]))}},2185:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.FIRST_VIEW_CONFIG=undefined;var _config=__webpack_require__(12);var FIRST_VIEW_CONFIG=exports.FIRST_VIEW_CONFIG=[{name:"stats",paths:["/stats"],enabled:true,startDate:"2016-07-26"},{name:"pages-prototype",paths:["/pages"],enabled:(0,_config.isEnabled)("pages/first-view-prototype")}]},2188:function(module,exports,__webpack_require__){__webpack_require__(2189);var $Object=__webpack_require__(31).Object;module.exports=function getOwnPropertyNames(it){return $Object.getOwnPropertyNames(it)}},2189:function(module,exports,__webpack_require__){__webpack_require__(230)("getOwnPropertyNames",function(){return __webpack_require__(798).f})},2211:function(module,exports,__webpack_require__){var baseIteratee=__webpack_require__(35),baseWhile=__webpack_require__(1944);function takeRightWhile(array,predicate){return array&&array.length?baseWhile(array,baseIteratee(predicate,3),false,true):[]}module.exports=takeRightWhile},2531:function(module,exports,__webpack_require__){"use strict";var _extends2=__webpack_require__(16);var _extends3=_interopRequireDefault(_extends2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var React=__webpack_require__(1),classNames=__webpack_require__(10);var SegmentedControl=__webpack_require__(1682),ControlItem=__webpack_require__(1665);var _instance=1;var NavSegmented=React.createClass({displayName:"NavSegmented",propTypes:{label:React.PropTypes.string,hasSiblingControls:React.PropTypes.bool},getDefaultProps:function getDefaultProps(){return{hasSiblingControls:false}},componentWillMount:function componentWillMount(){this.id=_instance;_instance++},render:function render(){var segmentedClassName=classNames({"section-nav-group":true,"section-nav__segmented":true,"has-siblings":this.props.hasSiblingControls});return React.createElement("div",{className:segmentedClassName},this.props.label&&React.createElement("h6",{className:"section-nav-group__label"},this.props.label),React.createElement(SegmentedControl,null,this.getControlItems()))},getControlItems:function getControlItems(){return React.Children.map(this.props.children,function(child,index){return React.createElement(ControlItem,(0,_extends3.default)({},child.props,{key:"navSegmented-"+this.id+"-"+index}),child.props.children)},this)}});module.exports=NavSegmented},2538:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1),classNames=__webpack_require__(10);var StatUpdateIndicator=React.createClass({displayName:"StatUpdateIndicator",propTypes:{children:React.PropTypes.node.isRequired,updateOn:React.PropTypes.oneOfType([React.PropTypes.string,React.PropTypes.number,React.PropTypes.bool]).isRequired},getInitialState:function getInitialState(){return{updating:!this.props.updateOn}},componentDidMount:function componentDidMount(){this.clearTheUpdate()},componentWillReceiveProps:function componentWillReceiveProps(nextProps){if(this.props.updateOn!==nextProps.updateOn){clearTimeout(this.clearingUpdateTimeout);this.setState({updating:true});this.clearTheUpdate()}},clearTheUpdate:function clearTheUpdate(){clearTimeout(this.clearingUpdateTimeout);this.clearingUpdateTimeout=setTimeout(function(){if(!this.isMounted()){return}this.setState({updating:false})}.bind(this),800)},render:function render(){var className=classNames({"stat-update-indicator":true,"is-updating":this.state.updating});return React.createElement("span",{className:className},this.props.children)}});module.exports=StatUpdateIndicator},2642:function(module,exports,__webpack_require__){"use strict";var _keys=__webpack_require__(39);var _keys2=_interopRequireDefault(_keys);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var isEqual=__webpack_require__(98),debug=__webpack_require__(3)("calypso:posts:post-counts-store");var sum=function sum(obj){return(0,_keys2.default)(obj).reduce(function(_sum,key){return _sum+parseFloat(obj[key])},0)};var emitter=__webpack_require__(36),PostListStore=__webpack_require__(1726)(),PostsStore=__webpack_require__(1727),sites=__webpack_require__(53)(),postUtils=__webpack_require__(1649),Dispatcher=__webpack_require__(42);var _counts={},PostCountsStore;function getSiteId(id){var site,siteId;id=id||PostListStore.getSiteID();site=sites.getSite(id);if(site){siteId=site.ID}return siteId}PostCountsStore={get:function get(id,scope){var statuses,siteId;siteId=getSiteId(id);if(!siteId){return null}scope=scope||"all";statuses=_counts[siteId]?_counts[siteId][scope]:null;debug("[%s][%s] statuses: %o",siteId,scope,statuses);return statuses},getTotalCount:function getTotalCount(id,scope){var statuses,total,siteId;scope=scope||"all";siteId=getSiteId(id);if(!siteId){return null}statuses=_counts[siteId]?_counts[siteId][scope]:null;total=0;if(statuses){total=sum(statuses)}debug("[%s][%s] total: %o ",siteId,scope,total);return total}};emitter(PostCountsStore);PostCountsStore.dispatchToken=Dispatcher.register(function(payload){var action=payload.action;var data=action.data;Dispatcher.waitFor([PostsStore.dispatchToken]);switch(action.type){case"RECEIVE_UPDATED_POSTS":case"RECEIVE_POSTS_PAGE":if(data&&data.meta&&data.meta.data&&data.meta.data.counts){var responseSource=data.__sync&&data.__sync.responseSource;setPostCounts(responseSource,data.meta.data.counts)}break;case"RECEIVE_POST_COUNTS":if(data&&data.counts&&action.siteId){var _responseSource=data.__sync&&data.__sync.responseSource;setPostCounts(_responseSource,data,action.siteId)}break;case"RECEIVE_UPDATED_POST":if(action.post&&!postUtils.isPage(action.post)){updateCountsWhenPostChanges(action.post,action.original)}break;case"RECEIVE_POST_BEING_EDITED":if(action.post&&!postUtils.isPage(action.post)){if(action.original){updateCountsWhenPostChanges(action.post,action.original)}else if(action.isNew){updateCountsOnNewPost(action.post)}}break}});function setPostCounts(responseSource,counts,siteID){var siteId=getSiteId(siteID);if(isEqual(counts,_counts[siteId])){return debug("No changes")}if(_counts[siteId]&&responseSource==="local"){debug("do not override post-counts with local response data");return}_counts[siteId]=counts.counts;debug("[%s] update statuses: %o",siteId||"All my sites",counts.counts);PostCountsStore.emit("change")}function updateCountsWhenPostChanges(post,original){var siteId;if(!post||!original){return debug("Post states are not defined")}siteId=post.site_ID;if(!siteId){return debug("No site ID defined")}debug("comparing `%s` == `%s`",post.status,original.status);if(post.status===original.status){debug("[%s] %o post has not changed its status",post.site_ID,post.ID);return}changeCounts(post,original,PostCountsStore.get(siteId,"all"));changeCounts(post,original,PostCountsStore.get(siteId,"mine"));PostCountsStore.emit("change")}function updateCountsOnNewPost(post){var siteId=post.site_ID;if(!siteId){return debug("No site ID defined")}changeCounts(post,null,PostCountsStore.get(siteId,"all"));changeCounts(post,null,PostCountsStore.get(siteId,"mine"));PostCountsStore.emit("change")}function changeCounts(post,original,counts){if(!post||!counts){return}if("undefined"===typeof counts[post.status]){debug("Add new post status `%s`",post.status);counts[post.status]=0}counts[post.status]++;debug("%s status incremented to %o",post.status,counts[post.status]);if(original){counts[original.status]--;debug("%s status decremented to %o",original.status,counts[original.status])}}module.exports=PostCountsStore},2824:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _compact=__webpack_require__(1642);var _compact2=_interopRequireDefault(_compact);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _config=__webpack_require__(12);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var BlogPostsPage=_react2.default.createClass({displayName:"BlogPostsPage",propTypes:function propTypes(){return{homePageType:_react2.default.PropTypes.string,pageForPosts:_react2.default.PropTypes.number}},render:function render(){var isStaticHomePageWithNoPostsPage=this.props.homePageType==="page"&&this.props.pageForPosts===0;var shouldShow=this.props.homePageType==="posts"||(0,
_config.isEnabled)("manage/pages/set-homepage")&&isStaticHomePageWithNoPostsPage;if(!shouldShow){return null}var notUsedLabel=null;if(isStaticHomePageWithNoPostsPage){notUsedLabel=_react2.default.createElement("div",{className:"pages__blog-posts-page__not-used-label"},this.translate("Not Used"))}var homePageIcon=null;if(this.props.homePageType==="posts"){homePageIcon=_react2.default.createElement(_gridicon2.default,{icon:"house",size:18})}return _react2.default.createElement(_compact2.default,{className:"pages__blog-posts-page"},notUsedLabel,_react2.default.createElement("span",{className:"pages__blog-posts-page__title",href:""},homePageIcon,this.translate("Blog Posts")),_react2.default.createElement("div",{className:"pages__blog-posts-page__info"},this.translate("Your latest posts")))}});exports.default=BlogPostsPage;module.exports=exports["default"]},2825:function(module,exports,__webpack_require__){"use strict";var _reactHelpers=__webpack_require__(711);var React=__webpack_require__(1),i18n=__webpack_require__(11);var sites=__webpack_require__(53)(),route=__webpack_require__(132),analytics=__webpack_require__(20),titlecase=__webpack_require__(724),trackScrollPage=__webpack_require__(764),setTitle=__webpack_require__(712).setDocumentHeadTitle;var controller={pages:function pages(context){var Pages=__webpack_require__(2827),siteID=route.getSiteFragment(context.path),status=context.params.status,search=context.query.s,basePath=route.sectionify(context.path),analyticsPageTitle="Pages",baseAnalyticsPath;status=!status||status===siteID?"":status;context.store.dispatch(setTitle(i18n.translate("Pages",{textOnly:true})));if(siteID){baseAnalyticsPath=basePath+"/:site"}else{baseAnalyticsPath=basePath}if(status.length){analyticsPageTitle+=" > "+titlecase(status)}else{analyticsPageTitle+=" > Published"}analytics.pageView.record(baseAnalyticsPath,analyticsPageTitle);(0,_reactHelpers.renderWithReduxStore)(React.createElement(Pages,{context:context,siteID:siteID,status:status,sites:sites,search:search,trackScrollPage:trackScrollPage.bind(null,baseAnalyticsPath,analyticsPageTitle,"Pages")}),document.getElementById("primary"),context.store)}};module.exports=controller},2826:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _mixin=__webpack_require__(111);var _mixin2=_interopRequireDefault(_mixin);var _firstView=__webpack_require__(2047);var _firstView2=_interopRequireDefault(_firstView);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"first-view",mixins:[_mixin2.default],render:function render(){return _react2.default.createElement(_firstView2.default,null,_react2.default.createElement("div",null,this.renderIcon(),_react2.default.createElement("h1",null,this.translate("Pages First View Placeholder")),_react2.default.createElement("p",null,this.translate("The Pages page shows you pages."))))},renderIcon:function renderIcon(){return _react2.default.createElement("div",{className:"first-view__icon"},_react2.default.createElement("svg",{x:"0px",y:"0px",viewBox:"0 0 792 612","enable-background":"new 0 0 792 612"},_react2.default.createElement("g",null,_react2.default.createElement("circle",{fill:"#D2DCE4",cx:"395.8",cy:"305.5",r:"287.1"}),_react2.default.createElement("rect",{x:"219.8",y:"267.8",fill:"#8FACBF",width:"101",height:"219.4"}),_react2.default.createElement("rect",{x:"344.2",y:"153",fill:"#8FACBF",width:"101",height:"334.2"}),_react2.default.createElement("rect",{x:"394.7",y:"152.6",opacity:"8.000000e-02",fill:"#485566",width:"50.5",height:"334.6"}),_react2.default.createElement("rect",{x:"468.6",y:"210.6",fill:"#8FACBF",width:"101",height:"276.6"}),_react2.default.createElement("rect",{x:"271.1",y:"267.8",opacity:"8.000000e-02",fill:"#485566",width:"49.7",height:"219.4"}),_react2.default.createElement("rect",{x:"519.5",y:"210.2",opacity:"8.000000e-02",fill:"#485566",width:"50",height:"277"}),_react2.default.createElement("path",{opacity:"0.45",fill:"#647A88",d:"M406.2,402.6"}),_react2.default.createElement("g",null,_react2.default.createElement("path",{opacity:"0.4",fill:"#647A88",d:"M398.5,377.5l-27.5,19.6l-17.1-14.7c-0.8,1.1-1.6,2.3-2.3,3.5l-7.4-4.7v20.2l3.5,2.3 c1.4,15.9,14.6,28.3,30.8,28.3c17.1,0,31-13.9,31-31c0-5.1-1.2-9.8-3.4-14l39-59.2v-31l-49.4,74.8L398.5,377.5z"}),_react2.default.createElement("path",{opacity:"0.4",fill:"#647A88",d:"M548.2,317l-1.2-11.5c-1.4,1.5-2.6,3-3.7,4.7l-40.7-31.1c1.2-1.8,2.2-3.7,3.1-5.7 l-23.7-16.5h-13.5v34.1c2.8,0.8,5.7,1.3,8.7,1.3c4.1,0,8-0.8,11.6-2.3l49.7,38c0.8,16.3,14.1,29.3,30.6,29.5v-37L548.2,317z"}),_react2.default.createElement("path",{opacity:"0.4",fill:"#647A88",d:"M292.5,335.7l-56,2l-3.4-1.8c0.9,3,2.2,5.7,3.8,8.2l-17.1,17.1v24.1l30.1-30 c3.9,1.8,8.2,2.8,12.8,2.8c4.5,0,8.8-1,12.7-2.8l45.3,28.9v-20.2l-31.9-20.3C290.4,341.2,291.6,338.5,292.5,335.7z"})),_react2.default.createElement("path",{opacity:"0.17",fill:"#FFFFFF",d:"M569.2,335.7L474.8,264l-97.7,140.7l-121.2-81L139.4,434.6c47.3,93.7,144.3,158,256.4,158 c158.6,0,287.1-128.5,287.1-287.1c0-41.2-8.8-80.4-24.4-115.8L569.2,335.7z"}),_react2.default.createElement("path",{fill:"#647A88",d:"M652.4,176.7l-85.2,137.6l-96.3-73.6l-94.9,143.8L257.5,309L136.8,429.3c2.6,5.4,5.4,10.7,8.3,15.8 l114.8-114.4l121.2,77.2l94-142.6l96.7,73.9l89.1-144C658.3,189,655.5,182.8,652.4,176.7z"}),_react2.default.createElement("g",null,_react2.default.createElement("circle",{fill:"#FFFFFF",cx:"378.5",cy:"395.3",r:"25.2"})),_react2.default.createElement("g",null,_react2.default.createElement("circle",{fill:"#FFFFFF",cx:"262.7",cy:"323.7",r:"25.2"})),_react2.default.createElement("path",{fill:"#F0F3F4",d:"M262.7,298.6v50.3c13.9,0,25.2-11.3,25.2-25.2C287.9,309.8,276.6,298.6,262.7,298.6z"}),_react2.default.createElement("path",{fill:"#F0F3F4",d:"M378.5,370.1v50.3c13.9,0,25.2-11.3,25.2-25.2C403.7,381.4,392.4,370.1,378.5,370.1z"}),_react2.default.createElement("g",null,_react2.default.createElement("circle",{fill:"#FFFFFF",cx:"477.3",cy:"258.5",r:"25.2"})),_react2.default.createElement("path",{fill:"#F0F3F4",d:"M477.3,233.4v50.3c13.9,0,25.2-11.3,25.2-25.2C502.5,244.6,491.2,233.4,477.3,233.4z"}),_react2.default.createElement("g",null,_react2.default.createElement("circle",{fill:"#FFFFFF",cx:"569.5",cy:"323.7",r:"25.2"})),_react2.default.createElement("path",{fill:"#F0F3F4",d:"M569.2,298.6v50.3c13.9,0,25.2-11.3,25.2-25.2C594.4,309.8,583.1,298.6,569.2,298.6z"}))))}});module.exports=exports["default"]},2827:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1),debug=__webpack_require__(3)("calypso:my-sites:pages:pages");var PageList=__webpack_require__(2828),SectionNav=__webpack_require__(1664),NavTabs=__webpack_require__(1661),NavItem=__webpack_require__(1660),Search=__webpack_require__(717),observe=__webpack_require__(131),SidebarNavigation=__webpack_require__(1656),URLSearch=__webpack_require__(1693),config=__webpack_require__(12),notices=__webpack_require__(78),Main=__webpack_require__(166),PagesFirstView=__webpack_require__(2826);var statuses=["published","drafts","scheduled","trashed"];module.exports=React.createClass({displayName:"Pages",mixins:[observe("sites"),URLSearch],propTypes:{trackScrollPage:React.PropTypes.func.isRequired},getDefaultProps:function getDefaultProps(){return{perPage:20}},componentWillMount:function componentWillMount(){var selectedSite=this.props.sites.getSelectedSite();this._setWarning(selectedSite)},componentDidMount:function componentDidMount(){debug("Pages React component mounted.")},componentWillReceiveProps:function componentWillReceiveProps(nextProps){var selectedSite=nextProps.sites.getSelectedSite();this._setWarning(selectedSite)},render:function render(){var status=this.props.status||"published";var filterStrings={published:this.translate("Published",{context:"Filter label for pages list"}),drafts:this.translate("Drafts",{context:"Filter label for pages list"}),scheduled:this.translate("Scheduled",{context:"Filter label for pages list"}),trashed:this.translate("Trashed",{context:"Filter label for pages list"})};var searchStrings={published:this.translate("Search Published",{context:"Search placeholder for pages list",textOnly:true}),drafts:this.translate("Search Drafts",{context:"Search placeholder for pages list",textOnly:true}),scheduled:this.translate("Search Scheduled",{context:"Search placeholder for pages list",textOnly:true}),trashed:this.translate("Search Trashed",{context:"Search placeholder for pages list",textOnly:true})};return React.createElement(Main,{classname:"pages"},React.createElement(PagesFirstView,null),React.createElement(SidebarNavigation,null),React.createElement(SectionNav,{selectedText:filterStrings[status]},React.createElement(NavTabs,{label:this.translate("Status",{context:"Filter page group label for tabs"})},this.getNavItems(filterStrings,status)),React.createElement(Search,{pinned:true,fitsContainer:true,onSearch:this.doSearch,initialValue:this.props.search,placeholder:searchStrings[status],analyticsGroup:"Pages",delaySearch:true})),React.createElement(PageList,this.props))},getNavItems:function getNavItems(filterStrings,currentStatus){var siteFilter=this.props.sites.selected?"/"+this.props.sites.selected:"";return statuses.map(function(status){var path="/pages"+siteFilter;if(status!=="publish"){path="/pages/"+status+siteFilter}return React.createElement(NavItem,{path:path,selected:currentStatus===status,key:"page-filter-"+status},filterStrings[status])})},_setWarning:function _setWarning(selectedSite){if(selectedSite&&selectedSite.jetpack&&!selectedSite.hasMinimumJetpackVersion){notices.warning(this.translate("Jetpack %(version)s is required to take full advantage of all page editing features.",{args:{version:config("jetpack_min_version")}}),{button:this.translate("Update now"),href:selectedSite.options.admin_url+"plugins.php?plugin_status=upgrade"})}}})},2828:function(module,exports,__webpack_require__){"use strict";var _get=__webpack_require__(24);var _get2=_interopRequireDefault(_get);var _blogPostsPage=__webpack_require__(2824);var _blogPostsPage2=_interopRequireDefault(_blogPostsPage);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var React=__webpack_require__(1),PureRenderMixin=__webpack_require__(111),omit=__webpack_require__(18);var PostListFetcher=__webpack_require__(1807),Page=__webpack_require__(2829),infiniteScroll=__webpack_require__(1765),observe=__webpack_require__(131),EmptyContent=__webpack_require__(207),NoResults=__webpack_require__(1689),actions=__webpack_require__(1648),Placeholder=__webpack_require__(2830),mapStatus=__webpack_require__(132).mapPostStatus;var PageList=React.createClass({displayName:"PageList",mixins:[PureRenderMixin],propTypes:{context:React.PropTypes.object,search:React.PropTypes.string,sites:React.PropTypes.object,siteID:React.PropTypes.any},render:function render(){return React.createElement(PostListFetcher,{type:"page",siteID:this.props.siteID,status:mapStatus(this.props.status),search:this.props.search},React.createElement(Pages,omit(this.props,"children")))}});var Pages=React.createClass({displayName:"Pages",mixins:[infiniteScroll("fetchPages"),observe("sites")],propTypes:{context:React.PropTypes.object.isRequired,lastPage:React.PropTypes.bool.isRequired,loading:React.PropTypes.bool.isRequired,page:React.PropTypes.number.isRequired,posts:React.PropTypes.array.isRequired,search:React.PropTypes.string,siteID:React.PropTypes.any,sites:React.PropTypes.object.isRequired,trackScrollPage:React.PropTypes.func.isRequired,hasRecentError:React.PropTypes.bool.isRequired},getDefaultProps:function getDefaultProps(){return{perPage:20,loading:false,hasRecentError:false,lastPage:false,page:0,posts:[],trackScrollPage:function trackScrollPage(){}}},fetchPages:function fetchPages(options){if(this.props.loading||this.props.lastPage||this.props.hasRecentError){return}if(options.triggeredByScroll){this.props.trackScrollPage(this.props.page+1)}actions.fetchNextPage()},_insertTimeMarkers:function _insertTimeMarkers(pages){var markedPages=[],now=this.moment(),lastMarker,buildMarker;buildMarker=function(pageDate){pageDate=this.moment(pageDate);var days=now.diff(pageDate,"days");if(days<=0){return this.translate("Today")}if(days===1){return this.translate("Yesterday")}return pageDate.from(now)}.bind(this);pages.forEach(function(page){var date=this.moment(page.date),marker=buildMarker(date);if(lastMarker!==marker){markedPages.push(React.createElement("div",{key:"marker-"+date.unix(),className:"page-list__header"},React.createElement("span",{className:"noticon noticon-time"})," ",marker," "))}lastMarker=marker;markedPages.push(page)},this);return markedPages},getNoContentMessage:function getNoContentMessage(){var attributes,newPageLink;if(this.props.search){return React.createElement(NoResults,{image:"/calypso/images/pages/illustration-pages.svg",text:this.translate("No pages match your search for {{searchTerm/}}.",{components:{searchTerm:React.createElement("em",null,this.props.search)}})})}else{newPageLink=this.props.siteID?"/page/"+this.props.siteID:"/page";if(this.props.hasRecentError){attributes={title:this.translate("Oh, no! We couldn't fetch your pages."),line:this.translate("Please check your internet connection.")}}else{var status=this.props.status||"published";switch(status){case"drafts":attributes={title:this.translate("You don't have any drafts."),line:this.translate("Would you like to create one?"),action:this.translate("Start a Page"),actionURL:newPageLink};break;case"scheduled":attributes={title:this.translate("You don't have any scheduled pages yet."),line:this.translate("Would you like to create one?"),action:this.translate("Start a Page"),actionURL:newPageLink};break;case"trashed":attributes={title:this.translate("You don't have any pages in your trash folder."),line:this.translate("Everything you write is solid gold.")};break;default:attributes={title:this.translate("You haven't published any pages yet."),line:this.translate("Would you like to publish your first page?"),action:this.translate("Start a Page"),actionURL:newPageLink}}}}attributes.illustration="/calypso/images/pages/illustration-pages.svg";attributes.illustrationWidth=150;return React.createElement(EmptyContent,{title:attributes.title,line:attributes.line,action:attributes.action,actionURL:attributes.actionURL,illustration:attributes.illustration,illustrationWidth:attributes.illustrationWidth})},addLoadingRows:function addLoadingRows(rows,count){var i;for(i=0;i<count;i++){if(i%4===0){rows.push(React.createElement(Placeholder.Marker,{key:"placeholder-marker-"+i}))}rows.push(React.createElement(Placeholder.Page,{key:"placeholder-page-"+i,multisite:this.props.siteID===false}))}},render:function render(){var pages=this.props.posts,rows=[];if(pages.length&&this.props.sites.initialized){if(!this.props.search){pages=this._insertTimeMarkers(pages)}rows=pages.map(function(page){if(!("site_ID"in page)){return page}var site=this.props.sites.getSite(page.site_ID);return React.createElement(Page,{key:"page-"+page.global_ID,page:page,site:site,multisite:this.props.siteID===false})},this);if(this.props.loading){this.addLoadingRows(rows,1)}var site=this.props.sites.getSelectedSite();var status=this.props.status||"published";if(site&&status==="published"){rows.push(React.createElement(_blogPostsPage2.default,{key:"blog-posts-page",homePageType:(0,_get2.default)(site,"options.show_on_front"),pageForPosts:(0,_get2.default)(site,"options.page_for_posts")}))}}else if(!this.props.loading&&this.props.sites.initialized){rows.push(React.createElement("div",{key:"page-list-no-results"},this.getNoContentMessage()))}else{this.addLoadingRows(rows,1)}return React.createElement("div",{id:"pages",className:"page-list"},rows,this.props.lastPage&&pages.length?React.createElement("div",{className:"infinite-scroll-end"}):null)}});module.exports=PageList},2829:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1),ReactCSSTransitionGroup=__webpack_require__(736),i18n=__webpack_require__(11),page=__webpack_require__(33);var updatePostStatus=__webpack_require__(1900),CompactCard=__webpack_require__(1642),Gridicon=__webpack_require__(26),PopoverMenu=__webpack_require__(1673),PopoverMenuItem=__webpack_require__(1652),SiteIcon=__webpack_require__(281),helpers=__webpack_require__(1987),analytics=__webpack_require__(20),utils=__webpack_require__(1649),classNames=__webpack_require__(10);function recordEvent(eventAction){analytics.ga.recordEvent("Pages",eventAction)}function getReadableStatus(status){var humanReadableStatus={publish:i18n.translate("Published"),draft:i18n.translate("Draft"),pending:i18n.translate("Pending"),future:i18n.translate("Future"),private:i18n.translate("Private"),trash:i18n.translate("Trashed")};return humanReadableStatus[status]||status}module.exports=React.createClass({displayName:"Page",mixins:[updatePostStatus],analyticsEvents:{moreOptions:function moreOptions(){recordEvent("Clicked More Options Menu")},pageTitle:function pageTitle(){recordEvent("Clicked Page Title")},editPage:function editPage(){recordEvent("Clicked Edit Page")},viewPage:function viewPage(){recordEvent("Clicked View Page")}},getInitialState:function getInitialState(){return{showPageActions:false}},componentWillMount:function componentWillMount(){this.strings={trashing:this.translate("Trashing Page"),deleting:this.translate("Deleting Page"),trashed:this.translate("Moved to Trash"),undo:this.translate("undo?"),restoring:this.translate("Restoring Page"),restored:this.translate("Page Restored"),deleted:this.translate("Page Deleted"),updating:this.translate("Updating Page"),error:this.translate("Error"),updated:this.translate("Updated"),deleteWarning:this.translate("Delete this page permanently?")}},togglePageActions:function togglePageActions(){this.setState({showPageActions:!this.state.showPageActions});if(this.state.showPageActions){this.analyticsEvents.moreOptions()}},getSiteDomain:function getSiteDomain(){return this.props.site&&this.props.site.domain||"..."},viewPage:function viewPage(){window.open(this.props.page.URL)},getViewItem:function getViewItem(){if(this.props.page.status==="trash"){return null}if(this.props.page.status!=="publish"){return React.createElement(PopoverMenuItem,{onClick:this.viewPage},React.createElement(Gridicon,{icon:"external",size:18}),this.translate("Preview"))}return React.createElement(PopoverMenuItem,{onClick:this.viewPage},React.createElement(Gridicon,{icon:"external",size:18}),this.translate("View Page"))},childPageInfo:function childPageInfo(){var page=this.props.page,site=this.props.site,parentTitle,parentHref,parentLink;if(!page.parent){return null}parentTitle=page.parent.title||this.translate("( Untitled )");parentHref=utils.userCan("edit_post",this.props.page)?helpers.editLinkForPage(page.parent,site):page.parent.URL;parentLink=React.createElement("a",{href:parentHref},parentTitle);return React.createElement("div",{className:"page__popover-more-info"},this.translate("Child of {{PageTitle/}}",{components:{PageTitle:parentLink}}))},frontPageInfo:function frontPageInfo(){if(!helpers.isFrontPage(this.props.page,this.props.site)){return null}return React.createElement("div",{className:"page__popover-more-info"},this.translate("Currently set as {{link}}Front Page{{/link}}",{components:{link:React.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:this.props.site.options.admin_url+"options-reading.php"})}}))},getPublishItem:function getPublishItem(){if(this.props.page.status==="publish"||!utils.userCan("publish_post",this.props.page)||this.props.page.status==="trash"){return null}return React.createElement(PopoverMenuItem,{onClick:this.updateStatusPublish},React.createElement(Gridicon,{icon:"checkmark",size:18}),this.translate("Publish"))},getEditItem:function getEditItem(){if(!utils.userCan("edit_post",this.props.page)){return null}return React.createElement(PopoverMenuItem,{onClick:this.editPage},React.createElement(Gridicon,{icon:"pencil",size:18}),this.translate("Edit"))},getSendToTrashItem:function getSendToTrashItem(){if(!utils.userCan("delete_post",this.props.page)){return null}if(this.props.page.status!=="trash"){return React.createElement(PopoverMenuItem,{className:"page__trash-item",onClick:this.updateStatusTrash},React.createElement(Gridicon,{icon:"trash",size:18}),this.translate("Trash"))}else{return React.createElement(PopoverMenuItem,{className:"page__delete-item",onClick:this.updateStatusDelete},React.createElement(Gridicon,{icon:"trash",size:18}),this.translate("Delete"))}},getRestoreItem:function getRestoreItem(){if(this.props.page.status!=="trash"||!utils.userCan("delete_post",this.props.page)){return null}return React.createElement(PopoverMenuItem,{onClick:this.updateStatusRestore},React.createElement(Gridicon,{icon:"undo",size:18}),this.translate("Restore"))},editPage:function editPage(){this.analyticsEvents.editPage();page(helpers.editLinkForPage(this.props.page,this.props.site))},getPageStatusInfo:function getPageStatusInfo(){if(this.props.page.status==="publish"){return null}return React.createElement("div",{className:"page__popover-more-info"},getReadableStatus(this.props.page.status))},popoverMoreInfo:function popoverMoreInfo(){var status=this.getPageStatusInfo(),childPageInfo=this.childPageInfo(),frontPageInfo=this.frontPageInfo();if(!status&&!childPageInfo&&!frontPageInfo){return null}return React.createElement("div",null,React.createElement("hr",{className:"popover__hr"}),status,childPageInfo,frontPageInfo)},render:function render(){var page=this.props.page,title=page.title||this.translate("(no title)"),site=this.props.site||{},isFrontPage=helpers.isFrontPage(page,site),canEdit=utils.userCan("edit_post",this.props.page),depthIndicator;if(page.parent){depthIndicator=" "}return React.createElement(CompactCard,{className:"page"},this.props.multisite?React.createElement(SiteIcon,{site:site,size:34}):null,React.createElement("a",{className:"page__title",href:canEdit?helpers.editLinkForPage(page,site):page.URL,title:canEdit?this.translate("Edit %(title)s",{textOnly:true,args:{title:page.title}}):this.translate("View %(title)s",{textOnly:true,args:{title:page.title}}),onClick:this.analyticsEvents.pageTitle},depthIndicator,isFrontPage?React.createElement(Gridicon,{icon:"house",size:18}):null,title),this.props.multisite?React.createElement("span",{className:"page__site-url"},this.getSiteDomain()):null,React.createElement(Gridicon,{icon:"ellipsis",className:classNames({"page__actions-toggle":true,"is-active":this.state.showPageActions}),onClick:this.togglePageActions,ref:"popoverMenuButton"}),React.createElement(PopoverMenu,{isVisible:this.state.showPageActions,onClose:this.togglePageActions,position:"bottom left",context:this.refs&&this.refs.popoverMenuButton},this.getViewItem(),this.getPublishItem(),this.getEditItem(),this.getRestoreItem(),this.getSendToTrashItem(),this.popoverMoreInfo()),React.createElement(ReactCSSTransitionGroup,{transitionName:"updated-trans",transitionEnterTimeout:300,transitionLeaveTimeout:300},this.buildUpdateTemplate()))},updateStatusPublish:function updateStatusPublish(){this.setState({showPageActions:false});this.updatePostStatus("publish");recordEvent("Clicked Publish Page")},updateStatusTrash:function updateStatusTrash(){this.setState({showPageActions:false});this.updatePostStatus("trash");recordEvent("Clicked Move to Trash")},updateStatusRestore:function updateStatusRestore(){this.setState({showPageActions:false});this.updatePostStatus("restore");recordEvent("Clicked Restore")},updateStatusDelete:function updateStatusDelete(){this.setState({showPageActions:false});this.updatePostStatus("delete");recordEvent("Clicked Delete Page")}})},2830:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1);var CompactCard=__webpack_require__(1642),SiteIcon=__webpack_require__(281);module.exports={Page:React.createClass({displayName:"PagePlaceholder",render:function render(){return React.createElement(CompactCard,{className:"page is-placeholder"},this.props.multisite?React.createElement(SiteIcon,{size:34}):null,React.createElement("a",{className:"page__title"},React.createElement("span",{className:"placeholder-text"},this.translate("Loading a page of Pages"))),this.props.multisite?React.createElement("span",{className:"page__site-url "},React.createElement("span",{className:"placeholder-text"},this.translate("A domain, quite soon"))):null)}}),Marker:React.createClass({displayName:"MarkerPlaceholder",render:function render(){return React.createElement("div",{className:"page-list__header is-placeholder"},React.createElement("span",null,""))}})}},2886:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1),PureRenderMixin=__webpack_require__(111),classnames=__webpack_require__(10);var PostImage=React.createClass({displayName:"PostImage",mixins:[PureRenderMixin],propTypes:{postImages:React.PropTypes.shape({featured_image:React.PropTypes.string,canonical_image:React.PropTypes.shape({uri:React.PropTypes.string.isRequired,width:React.PropTypes.number,height:React.PropTypes.number}),content_images:React.PropTypes.arrayOf(React.PropTypes.shape({src:React.PropTypes.string.isRequired,naturalWidth:React.PropTypes.number,naturalHeight:React.PropTypes.number})),images:React.PropTypes.arrayOf(React.PropTypes.shape({src:React.PropTypes.string.isRequired,naturalWidth:React.PropTypes.number,naturalHeight:React.PropTypes.number}))})},getInitialState:function getInitialState(){return{collapsed:true}},render:function render(){var imageURL=this._getImageURL(),containerClasses,containerStyles;if(!imageURL){return null}if(this.state.collapsed){containerStyles={backgroundImage:"url("+imageURL+")"}}containerClasses=classnames({"post-image":true,"is-collapsed":this.state.collapsed});return React.createElement("div",{className:containerClasses,style:containerStyles,onClick:this._handleClick},!this.state.collapsed?React.createElement("img",{src:imageURL,className:"post-image__image"}):null)},_getImageURL:function _getImageURL(){var postImages=this.props.postImages;if(postImages.featured_image!==""){return postImages.featured_image}if(postImages.canonical_image&&postImages.canonical_image.uri){return postImages.canonical_image.uri}if(postImages.content_images&&postImages.content_images.length&&postImages.content_images[0].src){return postImages.content_images[0].src}if(postImages.images&&postImages.images.length){return postImages.images[0].src}},_handleClick:function _handleClick(){this.setState({collapsed:!this.state.collapsed})}});module.exports=PostImage},2887:function(module,exports,__webpack_require__){"use strict";var _reactRedux=__webpack_require__(15);var page=__webpack_require__(33),ReactDom=__webpack_require__(44),React=__webpack_require__(1),debug=__webpack_require__(3)("calypso:my-sites:posts"),i18n=__webpack_require__(11);var user=__webpack_require__(48)(),sites=__webpack_require__(53)(),route=__webpack_require__(132),analytics=__webpack_require__(20),titlecase=__webpack_require__(724),trackScrollPage=__webpack_require__(764),setTitle=__webpack_require__(712).setDocumentHeadTitle;module.exports={posts:function posts(context){var Posts=__webpack_require__(2888),siteID=route.getSiteFragment(context.path),author=context.params.author==="my"?user.get().ID:null,statusSlug=author?context.params.status:context.params.author,search=context.query.s,basePath=route.sectionify(context.path),analyticsPageTitle="Blog Posts",baseAnalyticsPath;function shouldRedirectMyPosts(author,sites){var selectedSite=sites.getSelectedSite()||{};if(!author){return false}if(sites.fetched&&sites.allSingleSites){return true}if(selectedSite.single_user_site||selectedSite.jetpack){return true}}debug("siteID: `%s`",siteID);debug("author: `%s`",author);statusSlug=!statusSlug||statusSlug==="my"||statusSlug===siteID?"":statusSlug;debug("statusSlug: `%s`",statusSlug);search="undefined"!==typeof search?search:"";debug("search: `%s`",search);if(shouldRedirectMyPosts(author,sites)){page.redirect(context.path.replace(/\/my\b/,""));return}context.store.dispatch(setTitle(i18n.translate("Blog Posts",{textOnly:true})));if(siteID){baseAnalyticsPath=basePath+"/:site"}else{baseAnalyticsPath=basePath}if(statusSlug.length){analyticsPageTitle+=" > "+titlecase(statusSlug)}else{analyticsPageTitle+=" > Published"}analytics.pageView.record(baseAnalyticsPath,analyticsPageTitle);ReactDom.render(React.createElement(_reactRedux.Provider,{store:context.store},React.createElement(Posts,{context:context,siteID:siteID,author:author,statusSlug:statusSlug,sites:sites,search:search,trackScrollPage:trackScrollPage.bind(null,baseAnalyticsPath,analyticsPageTitle,"Posts")})),document.getElementById("primary"))}}},2888:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactRedux=__webpack_require__(15);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _postsNavigation=__webpack_require__(2896);var _postsNavigation2=_interopRequireDefault(_postsNavigation);var _dataObserve=__webpack_require__(131);var _dataObserve2=_interopRequireDefault(_dataObserve);var _sidebarNavigation=__webpack_require__(1656);var _sidebarNavigation2=_interopRequireDefault(_sidebarNavigation);var _postList=__webpack_require__(2891);var _postList2=_interopRequireDefault(_postList);var _config=__webpack_require__(12);var _config2=_interopRequireDefault(_config);var _main=__webpack_require__(166);var _main2=_interopRequireDefault(_main);var _notices=__webpack_require__(78);var _notices2=_interopRequireDefault(_notices);var _queryPosts=__webpack_require__(762);var _queryPosts2=_interopRequireDefault(_queryPosts);var _queryPostCounts=__webpack_require__(1880);var _queryPostCounts2=_interopRequireDefault(_queryPostCounts);var _draft=__webpack_require__(2093);var _draft2=_interopRequireDefault(_draft);var _selectors=__webpack_require__(47);var _selectors2=__webpack_require__(112);var _button=__webpack_require__(69);var _button2=_interopRequireDefault(_button);var _card=__webpack_require__(89);var _card2=_interopRequireDefault(_card);var _count=__webpack_require__(730);var _count2=_interopRequireDefault(_count);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _path=__webpack_require__(222);var _selectors3=__webpack_require__(1794);var _selectors4=__webpack_require__(277);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var PostsMain=_react2.default.createClass({displayName:"PostsMain",mixins:[(0,_dataObserve2.default)("sites")],componentWillMount:function componentWillMount(){var selectedSite=this.props.sites.getSelectedSite();this.setWarning(selectedSite)},componentWillReceiveProps:function componentWillReceiveProps(nextProps){var selectedSite=nextProps.sites.getSelectedSite();this.setWarning(selectedSite)},showDrafts:function showDrafts(){var site=this.props.sites.getSelectedSite();if(site.jetpack&&!this.props.loadingDrafts&&this.props.drafts&&this.props.drafts.length===0){return false}if(!site.jetpack&&this.props.draftCount===0){return false}return true},mostRecentDrafts:function mostRecentDrafts(){var site=this.props.sites.getSelectedSite();var isLoading=this.props.draftCount!==0&&this.props.loadingDrafts;if(!site||!this.showDrafts()){return null}return _react2.default.createElement("div",{className:"posts__recent-drafts"},_react2.default.createElement(_queryPosts2.default,{siteId:site.ID,query:this.props.draftsQuery}),_react2.default.createElement(_queryPostCounts2.default,{siteId:site.ID,type:"post"}),_react2.default.createElement(_card2.default,{compact:true,className:"posts__drafts-header"
},this.translate("Latest Drafts"),_react2.default.createElement(_button2.default,{borderless:true,href:this.props.newPostPath},_react2.default.createElement(_gridicon2.default,{icon:"plus"}))),this.props.drafts&&this.props.drafts.map(this.renderDraft,this),isLoading&&_react2.default.createElement(_draft2.default,{isPlaceholder:true}),this.props.draftCount>6&&_react2.default.createElement(_button2.default,{compact:true,borderless:true,className:"posts__see-all-drafts",href:"/posts/drafts/"+site.slug},this.translate("See all drafts"),this.props.draftCount?_react2.default.createElement(_count2.default,{count:this.props.draftCount}):null))},renderDraft:function renderDraft(draft){if(!draft){return null}var site=this.props.sites.getSelectedSite();return _react2.default.createElement(_draft2.default,{key:draft.global_ID,post:draft,sites:this.props.sites,showAuthor:site&&!site.single_user_site&&!this.props.author})},render:function render(){var path=(0,_path.sectionify)(this.props.context.path);var classes=(0,_classnames2.default)("posts",{"is-multisite":!this.props.sites.selected,"is-single-site":this.props.sites.selected});return _react2.default.createElement(_main2.default,{className:classes},_react2.default.createElement(_sidebarNavigation2.default,null),_react2.default.createElement("div",{className:"posts__primary"},_react2.default.createElement(_postsNavigation2.default,this.props),_react2.default.createElement(_postList2.default,this.props)),path!=="/posts/drafts"&&this.mostRecentDrafts())},setWarning:function setWarning(selectedSite){if(selectedSite&&selectedSite.jetpack&&!selectedSite.hasMinimumJetpackVersion){_notices2.default.warning(this.translate("Jetpack %(version)s is required to take full advantage of all post editing features.",{args:{version:(0,_config2.default)("jetpack_min_version")}}),{button:this.translate("Update now"),href:selectedSite.options.admin_url+"plugins.php?plugin_status=upgrade"})}}});exports.default=(0,_reactRedux.connect)(function(state,props){var siteId=(0,_selectors.getSelectedSiteId)(state);var draftsQuery={type:"post",status:"draft",number:6,order_by:"modified",author:props.author};return{drafts:(0,_selectors2.getSitePostsForQueryIgnoringPage)(state,siteId,draftsQuery),loadingDrafts:(0,_selectors2.isRequestingSitePostsForQuery)(state,siteId,draftsQuery),draftsQuery:draftsQuery,draftCount:(0,_selectors3.getAllPostCount)(state,siteId,"post","draft"),newPostPath:(0,_selectors4.getEditorNewPostPath)(state,siteId)}})(PostsMain);module.exports=exports["default"]},2889:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1),PureRenderMixin=__webpack_require__(111),url=__webpack_require__(70);var config=__webpack_require__(12),utils=__webpack_require__(1649),Gridicon=__webpack_require__(26),recordEvent=__webpack_require__(20).ga.recordEvent;module.exports=React.createClass({displayName:"PostControls",mixins:[PureRenderMixin],propTypes:{post:React.PropTypes.object.isRequired,editURL:React.PropTypes.string.isRequired,onShowMore:React.PropTypes.func.isRequired,onHideMore:React.PropTypes.func.isRequired,onPublish:React.PropTypes.func,onTrash:React.PropTypes.func,onDelete:React.PropTypes.func,onRestore:React.PropTypes.func},view:function view(){recordEvent("Posts","Clicked View Post")},preview:function preview(){recordEvent("Posts","Clicked Preview Post")},edit:function edit(){recordEvent("Posts","Clicked Edit Post")},viewStats:function viewStats(){recordEvent("Posts","Clicked View Post Stats")},buildControls:function buildControls(controlsArray){var postId=this.props.post.ID,controls;controls=controlsArray.map(function(item,i){var itemKey="controls-"+postId+"-"+i;return React.createElement("li",{key:itemKey},React.createElement("a",{href:item.href,className:item.className,onClick:item.onClick,target:item.target?item.target:null},React.createElement(Gridicon,{icon:item.icon,size:18}),React.createElement("span",null,item.text)))},this);return controls},render:function render(){var post=this.props.post,availableControls=[],extraControls=[],parsed,previewURL,statsURL,postControlsClass,mainControls,moreControls,i,moreControlsSpliceIndex;if(utils.userCan("edit_post",post)){availableControls.push({text:this.translate("Edit"),className:"post-controls__edit",href:this.props.editURL,target:null,onClick:this.edit,icon:"pencil"})}if(post.status==="publish"){availableControls.push({text:this.translate("View"),className:"post-controls__view",href:post.URL,target:"_blank",onClick:this.view,icon:"external"});if(config.isEnabled("manage/stats")){statsURL="/stats/post/"+post.ID+"/"+this.props.site.slug}else{statsURL="//wordpress.com/my-stats/?view=post&post="+post.ID+"&blog="+post.site_ID}availableControls.push({text:this.translate("Stats"),className:"post-controls__stats",href:statsURL,onClick:this.viewStats,icon:"stats-alt"})}else{if(post.status!=="trash"){parsed=url.parse(post.URL,true);parsed.query.preview="true";parsed.search="";previewURL=url.format(parsed);availableControls.push({text:this.translate("Preview"),className:"post-controls__view",href:previewURL,target:"_blank",onClick:this.preview,icon:"external"});if(utils.userCan("publish_post",post)){availableControls.push({text:this.translate("Publish"),className:"post-controls__publish",onClick:this.props.onPublish,icon:"reader"})}}else{if(utils.userCan("delete_post",post)){availableControls.push({text:this.translate("Restore"),className:"post-controls__restore",onClick:this.props.onRestore,icon:"undo"})}}}if(utils.userCan("delete_post",post)){if(post.status==="trash"){availableControls.push({text:this.translate("Delete Permanently"),className:"post-controls__trash is-scary",onClick:this.props.onDelete,icon:"trash"})}else{availableControls.push({text:this.translate("Trash"),className:"post-controls__trash",onClick:this.props.onTrash,icon:"trash"})}}if(availableControls.length>2&&!this.props.fullWidth||availableControls.length>4&&this.props.fullWidth){moreControlsSpliceIndex=!this.props.fullWidth?2:4;for(i=moreControlsSpliceIndex;i<availableControls.length;i++){extraControls.push(availableControls[i])}availableControls.splice(moreControlsSpliceIndex)}postControlsClass="post-controls";if(extraControls.length){availableControls.push({text:this.translate("More"),className:"post-controls__more",onClick:this.props.onShowMore,icon:"ellipsis"});extraControls.push({text:this.translate("Back"),className:"post-controls__back",onClick:this.props.onHideMore,icon:"chevron-left"});mainControls=this.buildControls(availableControls);moreControls=this.buildControls(extraControls);postControlsClass+=extraControls.length<=2?" post-controls--desk-nomore":"";return React.createElement("div",{className:postControlsClass},React.createElement("ul",{className:"post-controls__pane post-controls__more-options"},moreControls),React.createElement("ul",{className:"post-controls__pane post-controls__main-options"},mainControls))}else{mainControls=this.buildControls(availableControls);return React.createElement("div",{className:postControlsClass},React.createElement("ul",{className:"post-controls__pane post-controls__main-options"},mainControls))}}})},2890:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1),classNames=__webpack_require__(10);var SiteIcon=__webpack_require__(281);module.exports=React.createClass({displayName:"PostHeader",getDefaultProps:function getDefaultProps(){return{showAuthor:false}},getAuthor:function getAuthor(){return this.translate("By %(author)s",{args:{author:this.props.author}})},render:function render(){var classes;classes=classNames({post__header:true,"has-author":this.props.showAuthor});return React.createElement("div",{className:classes},React.createElement(SiteIcon,{site:this.props.site,size:32}),React.createElement("h4",{className:"post__site-title"},React.createElement("a",{href:this.props.path+"/"+this.props.site.slug},this.props.site.title)),this.props.showAuthor?React.createElement("span",{className:"post__author"},this.getAuthor()):null)}})},2891:function(module,exports,__webpack_require__){"use strict";var _upgradeNudge=__webpack_require__(1680);var _upgradeNudge2=_interopRequireDefault(_upgradeNudge);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var React=__webpack_require__(1),PureRenderMixin=__webpack_require__(111),debug=__webpack_require__(3)("calypso:my-sites:posts"),debounce=__webpack_require__(278),omit=__webpack_require__(18),isEqual=__webpack_require__(98);var PostListFetcher=__webpack_require__(1807),Post=__webpack_require__(2895),PostPlaceholder=__webpack_require__(2892),actions=__webpack_require__(1648),observe=__webpack_require__(131),EmptyContent=__webpack_require__(207),InfiniteList=__webpack_require__(1691),NoResults=__webpack_require__(1689),route=__webpack_require__(132),mapStatus=route.mapPostStatus;var GUESSED_POST_HEIGHT=250;var PostList=React.createClass({displayName:"PostList",mixins:[PureRenderMixin],propTypes:{context:React.PropTypes.object,search:React.PropTypes.string,sites:React.PropTypes.object,statusSlug:React.PropTypes.string,siteID:React.PropTypes.any,author:React.PropTypes.number},render:function render(){return React.createElement(PostListFetcher,{siteID:this.props.siteID,status:mapStatus(this.props.statusSlug),author:this.props.author,withImages:true,withCounts:true,search:this.props.search},React.createElement(Posts,omit(this.props,"children")))}});var Posts=React.createClass({displayName:"Posts",propTypes:{author:React.PropTypes.number,context:React.PropTypes.object.isRequired,hasRecentError:React.PropTypes.bool.isRequired,lastPage:React.PropTypes.bool.isRequired,loading:React.PropTypes.bool.isRequired,page:React.PropTypes.number.isRequired,postImages:React.PropTypes.object.isRequired,posts:React.PropTypes.array.isRequired,search:React.PropTypes.string,siteID:React.PropTypes.any,sites:React.PropTypes.object.isRequired,statusSlug:React.PropTypes.string,trackScrollPage:React.PropTypes.func.isRequired},getDefaultProps:function getDefaultProps(){return{hasRecentError:false,loading:false,lastPage:false,page:0,postImages:{},posts:[],trackScrollPage:function trackScrollPage(){}}},mixins:[observe("sites")],getInitialState:function getInitialState(){return{postsAtFullWidth:window.innerWidth>=960}},componentDidMount:function componentDidMount(){debug("Posts React component mounted.");this.debouncedAfterResize=debounce(this.afterResize,300);window.addEventListener("resize",this.debouncedAfterResize)},componentWillUnmount:function componentWillUnmount(){window.removeEventListener("resize",this.debouncedAfterResize)},shouldComponentUpdate:function shouldComponentUpdate(nextProps){if(nextProps.loading!==this.props.loading){return true}if(nextProps.hasRecentError!==this.props.hasRecentError){return true}if(nextProps.lastPage!==this.props.lastPage){return true}if(nextProps.statusSlug!==this.props.statusSlug){return true}if(!isEqual(nextProps.posts.map(function(post){return post.ID}),this.props.posts.map(function(post){return post.ID}))){return true}return false},afterResize:function afterResize(){var arePostsAtFullWidth=window.innerWidth>=960;if(this.state.postsAtFullWidth!==arePostsAtFullWidth){this.setState({postsAtFullWidth:arePostsAtFullWidth})}},fetchPosts:function fetchPosts(options){if(this.props.loading||this.props.lastPage||this.props.hasRecentError){return}if(options.triggeredByScroll){this.props.trackScrollPage(this.props.page+1)}actions.fetchNextPage()},getNoContentMessage:function getNoContentMessage(){var attributes,newPostLink;if(this.props.search){return React.createElement(NoResults,{image:"/calypso/images/posts/illustration-posts.svg",text:this.translate("No posts match your search for {{searchTerm/}}.",{components:{searchTerm:React.createElement("em",null,this.props.search)}})})}else{newPostLink=this.props.siteID?"/post/"+this.props.siteID:"/post";if(this.props.hasRecentError){attributes={title:this.translate("Oh, no! We couldn't fetch your posts."),line:this.translate("Please check your internet connection.")}}else{switch(this.props.statusSlug){case"drafts":attributes={title:this.translate("You don't have any drafts."),line:this.translate("Would you like to create one?"),action:this.translate("Start a Post"),actionURL:newPostLink};break;case"scheduled":attributes={title:this.translate("You don't have any scheduled posts."),line:this.translate("Would you like to schedule a draft to publish?"),action:this.translate("Edit Drafts"),actionURL:this.props.siteID?"/posts/drafts/"+this.props.siteID:"/posts/drafts"};break;case"trashed":attributes={title:this.translate("You don't have any posts in your trash folder."),line:this.translate("Everything you write is solid gold.")};break;default:attributes={title:this.translate("You haven't published any posts yet."),line:this.translate("Would you like to publish your first post?"),action:this.translate("Start a Post"),actionURL:newPostLink}}}}attributes.illustration="/calypso/images/posts/illustration-posts.svg";attributes.illustrationWidth=150;return React.createElement(EmptyContent,{title:attributes.title,line:attributes.line,action:attributes.action,actionURL:attributes.actionURL,illustration:attributes.illustration,illustrationWidth:attributes.illustrationWidth})},getPostRef:function getPostRef(post){return post.global_ID},renderLoadingPlaceholders:function renderLoadingPlaceholders(){return React.createElement(PostPlaceholder,{key:"placeholder-scroll-"+this.props.page})},renderPost:function renderPost(post,index){var postImages=this.props.postImages[post.global_ID];var renderedPost=React.createElement(Post,{ref:post.global_ID,key:post.global_ID,post:post,postImages:postImages,sites:this.props.sites,fullWidthPost:this.state.postsAtFullWidth,path:route.sectionify(this.props.context.pathname)});if(index===2&&this.props.sites.getSelectedSite()&&!this.props.statusSlug){return React.createElement("div",{key:post.global_ID},React.createElement(_upgradeNudge2.default,{title:this.translate("No Ads with WordPress.com Premium"),message:this.translate("Prevent ads from showing on your site."),feature:"no-adverts",event:"published_posts_no_ads"}),renderedPost)}else{return renderedPost}},render:function render(){var posts=this.props.posts,placeholderCount=1,placeholders=[],postList,i;if(posts.length&&this.props.sites.initialized){postList=React.createElement(InfiniteList,{key:"list-"+this.props.listId,className:"posts__list",items:posts,lastPage:this.props.lastPage,fetchingNextPage:this.props.loading,guessedItemHeight:GUESSED_POST_HEIGHT,fetchNextPage:this.fetchPosts,getItemRef:this.getPostRef,renderItem:this.renderPost,renderLoadingPlaceholders:this.renderLoadingPlaceholders})}else{if(this.props.loading||!this.props.sites.fetched){for(i=0;i<placeholderCount;i++){placeholders.push(React.createElement(PostPlaceholder,{key:"placeholder-"+i}))}}else{placeholders=this.getNoContentMessage()}postList=React.createElement("div",{className:"posts__list"},placeholders)}return React.createElement("div",null,postList,this.props.lastPage&&posts.length?React.createElement("div",{className:"infinite-scroll-end"}):null)}});module.exports=PostList},2892:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1);var Card=__webpack_require__(89);module.exports=React.createClass({displayName:"PostPlaceholder",render:function render(){return React.createElement(Card,{tagName:"article",className:"post is-placeholder"},React.createElement("div",{className:"post__body"},React.createElement("header",{className:"post-attribution"},React.createElement("span",null,React.createElement("span",{className:"post-attribution-avatar is-rounded"}),React.createElement("span",{className:"placeholder-text"},this.translate("A Great Author on a Fantastic Site")))),React.createElement("div",{className:"post__content"},React.createElement("h4",{className:"post__title post__title-link"},React.createElement("span",{className:"placeholder-text"},this.translate("Loading Posts"))),React.createElement("div",{className:"post__excerpt"},React.createElement("p",null,React.createElement("span",{className:"placeholder-text"},this.translate("Currently fetching the latest and greatest posts from your site(s). Looking good."))))),React.createElement("footer",{className:"post__info"},React.createElement("div",{className:"post__time"},React.createElement("span",{className:"placeholder-text"},this.translate("Near future"))))),React.createElement("div",{className:"post-controls"},React.createElement("ul",{className:"post-controls__pane post-controls__main-options"},React.createElement("li",null,React.createElement("a",null)),React.createElement("li",null,React.createElement("a",null)),React.createElement("li",null,React.createElement("a",null)),React.createElement("li",null,React.createElement("a",null)))))}})},2893:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _defineProperty2=__webpack_require__(7);var _defineProperty3=_interopRequireDefault(_defineProperty2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactRedux=__webpack_require__(15);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _includes=__webpack_require__(30);var _includes2=_interopRequireDefault(_includes);var _map=__webpack_require__(45);var _map2=_interopRequireDefault(_map);var _queryPostTypes=__webpack_require__(726);var _queryPostTypes2=_interopRequireDefault(_queryPostTypes);var _button=__webpack_require__(69);var _button2=_interopRequireDefault(_button);var _selectors=__webpack_require__(47);var _selectors2=__webpack_require__(390);var _selectors3=__webpack_require__(79);var _selectors4=__webpack_require__(90);var _selectors5=__webpack_require__(1861);var _actions=__webpack_require__(1860);var _postMetadata=__webpack_require__(759);var _postMetadata2=_interopRequireDefault(_postMetadata);var _publicizeMessage=__webpack_require__(2153);var _publicizeMessage2=_interopRequireDefault(_publicizeMessage);var _notice=__webpack_require__(76);var _notice2=_interopRequireDefault(_notice);var _queryPublicizeConnections=__webpack_require__(2035);var _queryPublicizeConnections2=_interopRequireDefault(_queryPublicizeConnections);var _socialLogo=__webpack_require__(758);var _socialLogo2=_interopRequireDefault(_socialLogo);var _upgradeNudge=__webpack_require__(1680);var _upgradeNudge2=_interopRequireDefault(_upgradeNudge);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var PostSharing=_react2.default.createClass({displayName:"PostSharing",propTypes:{site:_react.PropTypes.object,post:_react.PropTypes.object,siteId:_react.PropTypes.number,isPublicizeEnabled:_react.PropTypes.bool,connections:_react.PropTypes.array,requestConnections:_react.PropTypes.func},getInitialState:function getInitialState(){return{skipped:_postMetadata2.default.publicizeSkipped(this.props.post)||[],message:_postMetadata2.default.publicizeMessage(this.props.post)||this.props.post.title}},hasConnections:function hasConnections(){return!!(this.props.connections&&this.props.connections.length)},toggleConnection:function toggleConnection(id){var skipped=this.state.skipped.slice();var index=skipped.indexOf(id);if(index!==-1){skipped.splice(index,1)}else{skipped.push(id)}this.setState({skipped:skipped})},renderServices:function renderServices(){var _this=this;if(!this.props.site||!this.hasConnections()){return}return this.props.connections.map(function(connection){var _classNames;return _react2.default.createElement("div",{key:connection.keyring_connection_ID,onClick:function onClick(){return _this.toggleConnection(connection.keyring_connection_ID)},className:(0,_classnames2.default)((_classNames={"posts__post-share-service":true},(0,_defineProperty3.default)(_classNames,connection.service,true),(0,_defineProperty3.default)(_classNames,"is-active",_this.state.skipped.indexOf(connection.keyring_connection_ID)===-1),_classNames))},_react2.default.createElement(_socialLogo2.default,{icon:connection.service}),_react2.default.createElement("div",{className:"posts__post-share-service-account-name"},_react2.default.createElement("span",null,connection&&connection.external_display)))},this)},renderMessage:function renderMessage(){var _this2=this;var skipped=this.state.skipped;var targeted=this.hasConnections()?this.props.connections.filter(function(connection){return skipped&&-1===skipped.indexOf(connection.keyring_connection_ID)}):[];var requireCount=(0,_includes2.default)((0,_map2.default)(targeted,"service"),"twitter");var acceptableLength=requireCount?140-23-23:null;if(!this.hasConnections()){return}return _react2.default.createElement(_publicizeMessage2.default,{message:this.state.message,preview:this.props.post.title,requireCount:requireCount,onChange:function onChange(message){return _this2.setState({message:message})},acceptableLength:acceptableLength})},dismiss:function dismiss(){this.props.dismissShareConfirmation(this.props.siteId,this.props.post.ID)},render:function render(){var _this3=this;if(!this.props.isPublicizeEnabled){return null}if(this.props.site&&this.props.site.options.publicize_permanently_disabled){return _react2.default.createElement("div",{className:"editor-sharing__publicize-disabled"},_react2.default.createElement("p",null,_react2.default.createElement("span",null,this.translate("Publicize is disabled on this site."))))}var classes=(0,_classnames2.default)("posts__post-share",{"has-connections":this.hasConnections()});return _react2.default.createElement("div",{className:"posts__post-share-wrapper"},this.props.requesting&&_react2.default.createElement(_notice2.default,{status:"is-warning",showDismiss:false},this.translate("Hang tight, socializing your media...")),this.props.success&&_react2.default.createElement(_notice2.default,{status:"is-success",onDismissClick:this.dismiss},this.translate("It went out! Your social media is on fire!")),this.props.failure&&_react2.default.createElement(_notice2.default,{status:"is-error",onDismissClick:this.dismiss},this.translate("Something went wrong. Please don't be mad.")),_react2.default.createElement("div",{className:classes},this.props.siteId&&_react2.default.createElement(_queryPostTypes2.default,{siteId:this.props.siteId}),_react2.default.createElement("h3",{className:"posts__post-share-title"},this.translate("Share the post and spread the word!")),_react2.default.createElement("div",{className:"posts__post-share-services"},this.renderServices()),this.renderMessage(),_react2.default.createElement(_button2.default,{onClick:function onClick(){return _this3.props.sharePost(_this3.props.siteId,_this3.props.post.ID,_this3.state.skipped,_this3.state.message)},disabled:this.props.requesting||(this.props.connections.length||0)-this.state.skipped.length<1},this.translate("Share post")),_react2.default.createElement(_upgradeNudge2.default,{title:this.translate("Upgrade to the Business plan for advanced social media"),message:this.translate("Scheduling, assisted auto-posting and other features available in Business."),href:"/plans/"+this.props.site.slug,shouldDisplay:function shouldDisplay(){return true}})),this.props.site&&_react2.default.createElement(_queryPublicizeConnections2.default,{siteId:this.props.site.ID}))}});exports.default=(0,_reactRedux.connect)(function(state,props){var siteId=(0,_selectors.getSelectedSiteId)(state);var userId=(0,_selectors4.getCurrentUserId)(state);var postType=props.post.type;var isPublicizeEnabled=false!==(0,_selectors3.isJetpackModuleActive)(state,siteId,"publicize")&&(0,_selectors2.postTypeSupports)(state,siteId,postType,"publicize");return{siteId:siteId,isPublicizeEnabled:isPublicizeEnabled,connections:(0,_selectors5.getSiteUserConnections)(state,siteId,userId),requesting:(0,_selectors5.isRequestingSharePost)(state,siteId,props.post.ID),failed:(0,_selectors5.sharePostFailure)(state,siteId,props.post.ID),success:(0,_selectors5.sharePostSuccessMessage)(state,siteId,props.post.ID)}},{requestConnections:_actions.fetchConnections,sharePost:_actions.sharePost,dismissShareConfirmation:_actions.dismissShareConfirmation})(PostSharing);module.exports=exports["default"]},2894:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactRedux=__webpack_require__(15);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _statUpdateIndicator=__webpack_require__(2538);var _statUpdateIndicator2=_interopRequireDefault(_statUpdateIndicator);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _sitesList=__webpack_require__(53);var _sitesList2=_interopRequireDefault(_sitesList);var _queryPostStats=__webpack_require__(2034);var _queryPostStats2=_interopRequireDefault(_queryPostStats);var _selectors=__webpack_require__(1926);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var sites=(0,_sitesList2.default)();var PostTotalViews=_react2.default.createClass({displayName:"PostTotalViews",propTypes:{post:_react.PropTypes.object.isRequired,viewCount:_react.PropTypes.number,clickHandler:_react.PropTypes.func},render:function render(){var _props=this.props;var viewCount=_props.viewCount;var post=_props.post;var postId=post.ID;var siteId=post.site_ID;var viewsCountDisplay="",viewsTitle=void 0;if(viewCount&&!isNaN(viewCount)){viewsCountDisplay=this.numberFormat(viewCount);viewsTitle=this.translate("1 Total View","%(count)s Total Views",{count:viewCount,args:{count:viewCount}})}else{viewsTitle=this.translate("Total Views")}var site=sites.getSite(siteId);return _react2.default.createElement("a",{href:"/stats/post/"+postId+"/"+site.slug,className:(0,_classnames2.default)({"post__total-views":true,"is-empty":!viewsCountDisplay}),title:viewsTitle,onClick:this.props.clickHandler},_react2.default.createElement(_queryPostStats2.default,{siteId:siteId,postId:postId,stat:"views"}),_react2.default.createElement(_gridicon2.default,{icon:"visible",size:24}),_react2.default.createElement(_statUpdateIndicator2.default,{updateOn:viewsCountDisplay},viewsCountDisplay))}});exports.default=(0,_reactRedux.connect)(function(state,ownProps){var post=ownProps.post;var viewCount=(0,_selectors.getPostStat)(state,"views",post.site_ID,post.ID);return{viewCount:viewCount}})(PostTotalViews);module.exports=exports["default"]},2895:function(module,exports,__webpack_require__){"use strict";var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactAddonsCssTransitionGroup=__webpack_require__(736);var _reactAddonsCssTransitionGroup2=_interopRequireDefault(_reactAddonsCssTransitionGroup);var _classnames=__webpack_require__(10);var _classnames2=_interopRequireDefault(_classnames);var _card=__webpack_require__(89);var _card2=_interopRequireDefault(_card);var _gridicon=__webpack_require__(26);var _gridicon2=_interopRequireDefault(_gridicon);var _postRelativeTimeStatus=__webpack_require__(1991);var _postRelativeTimeStatus2=_interopRequireDefault(_postRelativeTimeStatus);var _postControls=__webpack_require__(2889);var _postControls2=_interopRequireDefault(_postControls);var _postHeader=__webpack_require__(2890);var _postHeader2=_interopRequireDefault(_postHeader);var _postImage=__webpack_require__(2886);var _postImage2=_interopRequireDefault(_postImage);var _postExcerpt=__webpack_require__(1889);var _postExcerpt2=_interopRequireDefault(_postExcerpt);var _postTotalViews=__webpack_require__(2894);var _postTotalViews2=_interopRequireDefault(_postTotalViews);var _utils=__webpack_require__(1649);var _utils2=_interopRequireDefault(_utils);var _updatePostStatus=__webpack_require__(1900);var _updatePostStatus2=_interopRequireDefault(_updatePostStatus);var _analytics=__webpack_require__(20);var _analytics2=_interopRequireDefault(_analytics);var _config=__webpack_require__(12);var _config2=_interopRequireDefault(_config);var _comments=__webpack_require__(2157);var _comments2=_interopRequireDefault(_comments);var _postShare=__webpack_require__(2893);var _postShare2=_interopRequireDefault(_postShare);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function recordEvent(eventAction){_analytics2.default.ga.recordEvent("Posts",eventAction)}function checkPropsChange(currentProps,nextProps,propArr){for(var i=0;i<propArr.length;i++){var prop=propArr[i];if(nextProps[prop]!==currentProps[prop]){return true}}return false}module.exports=_react2.default.createClass({displayName:"Post",mixins:[_updatePostStatus2.default],getInitialState:function getInitialState(){return{showMoreOptions:false,showComments:false,showShare:false}},shouldComponentUpdate:function shouldComponentUpdate(nextProps,nextState){var propsToCheck=["post","postImages","fullWidthPost","path"];if(checkPropsChange(this.props,nextProps,propsToCheck)){return true}if(nextState.showMoreOptions!==this.props.showMoreOptions){return true}return false},analyticsEvents:{viewPost:function viewPost(){recordEvent("Clicked View Post")},previewPost:function previewPost(){recordEvent("Clicked Preview Post")},editPost:function editPost(){recordEvent("Clicked Edit Post")},commentIconClick:function commentIconClick(){recordEvent("Clicked Post Comment Icon/Number")},likeIconClick:function likeIconClick(){recordEvent("Clicked Post Likes Icon/Number")},dateClick:function dateClick(){recordEvent("Clicked Post Date")},featuredImageStandardClick:function featuredImageStandardClick(){recordEvent("Clicked Post Featured Image Standard")},featuredImageLargeClick:function featuredImageLargeClick(){recordEvent("Clicked Post Featured Image Large")},postTitleClick:function postTitleClick(){recordEvent("Clicked Post Title")},postExcerptClick:function postExcerptClick(){recordEvent("Clicked Post Excerpt")},viewStats:function viewStats(){recordEvent("Clicked View Post Stats")}},publishPost:function publishPost(){this.updatePostStatus("publish");recordEvent("Clicked Publish Post")},restorePost:function restorePost(){this.updatePostStatus("restore");recordEvent("Clicked Restore Post")},deletePost:function deletePost(){this.updatePostStatus("delete");recordEvent("Clicked Delete Post")},trashPost:function trashPost(){this.updatePostStatus("trash");recordEvent("Clicked Trash Post")},componentWillMount:function componentWillMount(){this.strings={trashing:this.translate("Trashing Post"),deleting:this.translate("Deleting Post"),trashed:this.translate("Moved to Trash"),undo:this.translate("undo?"),deleted:this.translate("Post Deleted"),updating:this.translate("Updating Post"),error:this.translate("Error"),updated:this.translate("Updated"),deleteWarning:this.translate("Delete this post permanently?"),restoring:this.translate("Restoring"),restored:this.translate("Restored")}},canUserEditPost:function canUserEditPost(){var post=this.props.post;return post.capabilities&&post.capabilities.edit_post&&post.status!=="trash"},getPostClass:function getPostClass(){return(0,_classnames2.default)({post:true,"is-protected":this.props.post.password?true:false,"show-more-options":this.state.showMoreOptions})},getTitle:function getTitle(){if(this.props.post.title){return _react2.default.createElement("a",{href:this.getContentLinkURL(),className:"post__title-link post__content-link",target:this.getContentLinkTarget(),onClick:this.analyticsEvents.postTitleClick},_react2.default.createElement("h4",{className:"post__title"},this.props.post.title))}},getPostImage:function getPostImage(){if(!this.props.postImages){if(this.props.post.canonical_image){return _react2.default.createElement("div",{className:"post-image is-placeholder"})}return null}return _react2.default.createElement(_postImage2.default,{postImages:this.props.postImages})},getTrimmedExcerpt:function getTrimmedExcerpt(){var excerpt=this.props.post.excerpt;return excerpt.length<=220?excerpt:excerpt.substring(0,220)+"";
},getExcerpt:function getExcerpt(){var excerptElement=void 0;if(!this.props.post.excerpt){return null}if(this.props.post.format==="quote"){excerptElement=_react2.default.createElement(_postExcerpt2.default,{content:this.getTrimmedExcerpt(),className:"post__quote"})}else{excerptElement=_react2.default.createElement(_postExcerpt2.default,{content:this.getTrimmedExcerpt()})}return _react2.default.createElement("a",{href:this.getContentLinkURL(),className:"post__excerpt post__content-link",target:this.getContentLinkTarget(),onClick:this.analyticsEvents.postExcerptClick},excerptElement)},getHeader:function getHeader(){var selectedSite=this.props.sites.getSelectedSite();var site=this.getSite();if(selectedSite&&site.single_user_site){return null}return _react2.default.createElement(_postHeader2.default,{site:site,author:this.props.post.author?this.props.post.author.name:"",path:this.props.path,showAuthor:!site.single_user_site})},getContent:function getContent(){var post=this.props.post;if(post.title||post.excerpt){return _react2.default.createElement("div",{className:"post__content"},this.getTitle(),this.getExcerpt())}},getMeta:function getMeta(){var _this=this;var post=this.props.post;var postId=this.props.post.ID;var site=this.getSite();var isJetpack=site.jetpack;var showComments=!isJetpack||site.isModuleActive("comments");var showLikes=!isJetpack||site.isModuleActive("likes");var showStats=site.capabilities&&site.capabilities.view_stats&&(!isJetpack||site.isModuleActive("stats"));var metaItems=[];var commentCountDisplay=void 0,commentTitle=void 0,commentMeta=void 0,likeCountDisplay=void 0,likeTitle=void 0,likeMeta=void 0,footerMetaItems=void 0;if(showComments){if(post.discussion&&post.discussion.comment_count>0){commentTitle=this.translate("%(count)s Comment","%(count)s Comments",{count:post.discussion.comment_count,args:{count:post.discussion.comment_count}});commentCountDisplay=this.numberFormat(post.discussion.comment_count)}else if(post.discussion.comments_open){commentTitle=this.translate("Comments")}else{showComments=false}if(showComments){commentMeta=_react2.default.createElement("a",{className:(0,_classnames2.default)({post__comments:true,"is-empty":!commentCountDisplay}),title:commentTitle,onClick:this.toggleComments},_react2.default.createElement(_gridicon2.default,{icon:"comment",size:24}),_react2.default.createElement("span",null,commentCountDisplay));metaItems.push(commentMeta)}}if(showLikes){if(post.like_count>0){likeTitle=this.translate("%(count)s Like","%(count)s Likes",{count:post.like_count,args:{count:post.like_count}});likeCountDisplay=this.numberFormat(post.like_count)}else if(post.likes_enabled){likeTitle=this.translate("Likes")}else{showLikes=false}if(showLikes){likeMeta=_react2.default.createElement("a",{href:post.URL,className:(0,_classnames2.default)({post__likes:true,"is-empty":!likeCountDisplay}),target:"_blank",rel:"noopener noreferrer",title:likeTitle,onClick:this.analyticsEvents.likeIconClick},_react2.default.createElement(_gridicon2.default,{icon:"star",size:24}),_react2.default.createElement("span",null,likeCountDisplay));metaItems.push(likeMeta)}}if(showStats){metaItems.push(_react2.default.createElement(_postTotalViews2.default,{post:post,clickHandler:this.analyticsEvents.viewStats}))}if(_config2.default.isEnabled("republicize")&&post&&post.status==="publish"){metaItems.push(_react2.default.createElement("a",{className:(0,_classnames2.default)({post__comments:true}),title:this.translate("Share"),onClick:function onClick(){return _this.setState({showShare:!_this.state.showShare})}},_react2.default.createElement(_gridicon2.default,{icon:"speaker",size:24})))}if(metaItems.length){footerMetaItems=metaItems.map(function(item,i){var itemKey="meta-"+postId+"-"+i;return _react2.default.createElement("li",{key:itemKey},_react2.default.createElement("span",null,item))},this);return _react2.default.createElement("ul",{className:"post__meta"},footerMetaItems)}},getContentLinkURL:function getContentLinkURL(){var post=this.props.post;var site=this.getSite();if(_utils2.default.userCan("edit_post",post)){return _utils2.default.getEditURL(post,site)}else if(post.status==="trash"){return null}return post.URL},getContentLinkTarget:function getContentLinkTarget(){if(_utils2.default.userCan("edit_post",this.props.post)){return null}return"_blank"},toggleMoreControls:function toggleMoreControls(visibility){this.setState({showMoreOptions:visibility==="show"})},getSite:function getSite(){return this.props.sites.getSite(this.props.post.site_ID)},toggleComments:function toggleComments(){this.setState({showComments:!this.state.showComments});this.analyticsEvents.commentIconClick()},render:function render(){var site=this.getSite();return _react2.default.createElement(_card2.default,{tagName:"article",className:this.getPostClass()},_react2.default.createElement("div",{className:"post__body"},this.getHeader(),this.getPostImage(),this.getContent(),_react2.default.createElement("footer",{className:"post__info"},_react2.default.createElement(_postRelativeTimeStatus2.default,{post:this.props.post,link:this.getContentLinkURL(),target:this.getContentLinkTarget(),onClick:this.analyticsEvents.dateClick}),this.props.post.status==="draft"?null:this.getMeta())),_react2.default.createElement(_postControls2.default,{post:this.props.post,editURL:_utils2.default.getEditURL(this.props.post,site),fullWidth:this.props.fullWidthPost,onShowMore:this.toggleMoreControls.bind(this,"show"),onHideMore:this.toggleMoreControls.bind(this,"hide"),onPublish:this.publishPost,onTrash:this.trashPost,onDelete:this.deletePost,onRestore:this.restorePost,site:site}),_react2.default.createElement(_reactAddonsCssTransitionGroup2.default,{transitionName:"updated-trans",transitionEnterTimeout:300,transitionLeaveTimeout:300},this.buildUpdateTemplate()),this.state.showComments&&_react2.default.createElement(_comments2.default,{post:this.props.post,onCommentsUpdate:function onCommentsUpdate(){}}),this.state.showShare&&_config2.default.isEnabled("republicize")&&_react2.default.createElement(_postShare2.default,{post:this.props.post,site:site}))}})},2896:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _keys=__webpack_require__(39);var _keys2=_interopRequireDefault(_keys);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _debug=__webpack_require__(3);var _debug2=_interopRequireDefault(_debug);var _sectionNav=__webpack_require__(1664);var _sectionNav2=_interopRequireDefault(_sectionNav);var _tabs=__webpack_require__(1661);var _tabs2=_interopRequireDefault(_tabs);var _segmented=__webpack_require__(2531);var _segmented2=_interopRequireDefault(_segmented);var _item=__webpack_require__(1660);var _item2=_interopRequireDefault(_item);var _search=__webpack_require__(717);var _search2=_interopRequireDefault(_search);var _urlSearch=__webpack_require__(1693);var _urlSearch2=_interopRequireDefault(_urlSearch);var _postCountsStore=__webpack_require__(2642);var _postCountsStore2=_interopRequireDefault(_postCountsStore);var _gravatar=__webpack_require__(710);var _gravatar2=_interopRequireDefault(_gravatar);var _user=__webpack_require__(48);var _user2=_interopRequireDefault(_user);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var debug=new _debug2.default("calypso:posts-navigation");var user=(0,_user2.default)();var statusToDescription={publish:"published",draft:"drafts",future:"scheduled",trash:"trashed"};exports.default=_react2.default.createClass({displayName:"PostsNavigation",propTypes:{context:_react2.default.PropTypes.object.isRequired,sites:_react2.default.PropTypes.object.isRequired,author:_react2.default.PropTypes.number,statusSlug:_react2.default.PropTypes.string,search:_react2.default.PropTypes.string},mixins:[_urlSearch2.default],getInitialState:function getInitialState(){var counts=this._getCounts(),state={show:true,loading:true,counts:null===this.props.sites.selected?this._defaultCounts():this._getCounts()};if(!this.props.sites.selected||(0,_keys2.default)(counts).length){state.loading=false}return state},componentWillMount:function componentWillMount(){_postCountsStore2.default.on("change",this._updatePostCounts)},componentWillUnmount:function componentWillUnmount(){_postCountsStore2.default.off("change",this._updatePostCounts)},componentWillReceiveProps:function componentWillReceiveProps(nextProps){if(this.props.siteID!==nextProps.siteID||this.props.author!==nextProps.author||this.props.statusSlug!==nextProps.statusSlug){this._setPostCounts(nextProps.siteID,nextProps.author?"mine":"all")}},render:function render(){if(!this.state.show){return null}if(this.state.loading){return _react2.default.createElement(_sectionNav2.default,null)}var author=this.props.author?"/my":"",statusSlug=this.props.statusSlug?"/"+this.props.statusSlug:"",siteFilter=this.props.sites.selected?"/"+this.props.sites.selected:"",selectedSite=this.props.sites.getSelectedSite(),showMyFilter=true;this.filterStatuses={publish:this.translate("Published",{context:"Filter label for posts list"}),draft:this.translate("Drafts",{context:"Filter label for posts list"}),future:this.translate("Scheduled",{context:"Filter label for posts list"}),trash:this.translate("Trashed",{context:"Filter label for posts list"})};this.filterScope={me:this.translate("Me",{context:"Filter label for posts list"}),everyone:this.translate("Everyone",{context:"Filter label for posts list"})};this.strings={status:this.translate("Status",{context:"Filter group label for tabs"}),author:this.translate("Author",{context:"Filter group label for segmented"})};var statusTabs=this._getStatusTabs(author,siteFilter);var authorSegmented=this._getAuthorSegmented(statusSlug,siteFilter);if(this.props.sites.selected){if(selectedSite.single_user_site||selectedSite.jetpack){showMyFilter=false}}else if(this.props.sites.allSingleSites){showMyFilter=false}var mobileHeaderText=this._getMobileHeaderText(showMyFilter,statusTabs.selectedText,authorSegmented.selectedText);return _react2.default.createElement(_sectionNav2.default,{selectedText:mobileHeaderText},statusTabs.element,showMyFilter?authorSegmented.element:null,_react2.default.createElement(_search2.default,{pinned:true,fitsContainer:true,onSearch:this.doSearch,initialValue:this.props.search,placeholder:"Search "+statusTabs.selectedText+"...",analyticsGroup:"Posts",delaySearch:true}))},_getStatusTabs:function _getStatusTabs(author,siteFilter){var statusItems=[],isJetpackSite=this.props.sites.getSelectedSite().jetpack,status,selectedText,selectedCount;for(status in this.filterStatuses){if("undefined"===typeof this.state.counts[status]&&!isJetpackSite&&"publish"!==status){continue}var path="/posts"+author+("publish"===status?"":"/"+statusToDescription[status])+siteFilter;var textItem=this.filterStatuses[status];var count=!isJetpackSite&&false!==this.state.counts[status]?this.state.counts[status]:false;if(path===this.props.context.pathname){selectedText=textItem;if(!isJetpackSite){selectedCount=count}}if("publish"===status&&!count){count=0}statusItems.push(_react2.default.createElement(_item2.default,{className:"is-"+status,key:"statusTabs"+path,path:path,count:null===this.props.sites.selected||isJetpackSite?null:count,value:textItem,selected:path===this.props.context.pathname},textItem))}selectedText=selectedText||"published";selectedCount=selectedCount||this.getCountByStatus("publish");var tabs=_react2.default.createElement(_tabs2.default,{label:this.strings.status,selectedText:selectedText,selectedCount:selectedCount},statusItems);return{element:tabs,selectedText:selectedText}},_getAuthorSegmented:function _getAuthorSegmented(statusSlug,siteFilter){var scopeItems=[],selectedText,scope;for(scope in this.filterScope){var textItem=this.filterScope[scope];var isMe="me"===scope;var path=(isMe?"/posts/my":"/posts")+statusSlug+siteFilter;if(path===this.props.context.pathname){selectedText=textItem}scopeItems.push(_react2.default.createElement(_item2.default,{key:"authorSegmented"+path,path:path,selected:path===this.props.context.pathname},textItem,isMe&&_react2.default.createElement(_gravatar2.default,{size:16,user:user.get()})))}return{element:_react2.default.createElement(_segmented2.default,{label:this.strings.author},scopeItems),selectedText:selectedText}},_getMobileHeaderText:function _getMobileHeaderText(showMyFilter,statusSelectedText,authorSelectedText){if(!showMyFilter){return statusSelectedText}return _react2.default.createElement("span",null,_react2.default.createElement("span",null,statusSelectedText),_react2.default.createElement("small",null,authorSelectedText))},_defaultCounts:function _defaultCounts(){var default_options={},status;for(status in statusToDescription){default_options[status]=false}return default_options},_defaultStateOptions:function _defaultStateOptions(){this.setState({show:true,loading:false,counts:this._defaultCounts()})},_setPostCounts:function _setPostCounts(siteID,scope){if(!siteID||null===this.props.sites.selected){return this._defaultStateOptions()}if(!_postCountsStore2.default.getTotalCount(siteID,"all")){return this.setState({show:true,loading:true})}this.setState({show:true,loading:false,counts:this._getCounts(siteID,scope)})},_updatePostCounts:function _updatePostCounts(){var siteID=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.props.sites.selected;var scope=arguments[1];scope=scope||(this.props.author?"mine":"all");if(null===this.props.sites.selected){return this._defaultStateOptions()}var state={show:true,loading:false,counts:{}};if(_postCountsStore2.default.getTotalCount(siteID,"all")){state.counts=this._getCounts(siteID,scope)}else{debug("[%s] clean counts",siteID||"All my sites");state.show=false;state.counts={}}this.setState(state)},_getCounts:function _getCounts(){var siteID=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.props.sites.selected;var scope=arguments[1];var counts={},status;scope=scope||(this.props.author?"mine":"all");var all=_postCountsStore2.default.get(siteID,"all");var mine=_postCountsStore2.default.get(siteID,"mine");for(status in all){counts[status]="all"===scope?all[status]:mine[status]||0}if(counts.draft||counts.pending){counts.draft=(counts.draft||0)+(counts.pending||0);delete counts.pending}if(counts.publish||counts.private){counts.publish=(counts.publish||0)+(counts.private||0);delete counts.private}return counts},getCountByStatus:function getCountByStatus(status){var count=this.state.counts[status];return count!==false?count:null}});module.exports=exports["default"]}});